<div class="p-4">
  <!-- 已连接的设备列表 -->
  <div>
    <div class="flex items-center gap-2 mb-2">
      <h3 class="text-lg font-semibold">已连接的设备</h3>
      <el-button 
        type="primary" 
        @click="handleOpenScanDialog" 
        size="small">
        扫描设备
      </el-button>
    </div>
    <el-table 
      :data="connectedDeviceList" 
      stripe 
      class="w-full" 
      v-loading="loading"
      :height="200">
      <el-table-column prop="name" label="设备名称" min-width="150" />
      <el-table-column prop="address" label="地址" min-width="120" />
      <el-table-column label="状态" width="100">
        <template #default="{ row }">
          <el-tag type="success" v-if="row.connected">已连接</el-tag>
          <el-tag type="info" v-else>未连接</el-tag>
        </template>
      </el-table-column>
      <el-table-column label="操作" width="100">
        <template #default="{ row }">
          <el-button 
            size="small" 
            type="danger" 
            @click="handleDisconnectDevice(row)"
            :loading="row.disconnecting"
            :disabled="row.disconnecting">
            断开
          </el-button>
        </template>
      </el-table-column>
    </el-table>
  </div>

  <!-- 目录选择 -->
  <div class="mt-4">
    <div class="flex items-center gap-2">
      <el-input
        v-model="selectedPath"
        placeholder="请选择目录"
        readonly
        style="flex: 1">
      </el-input>
      <el-button 
        type="primary" 
        @click="handleOpenDirectoryDialog">
        选择目录
      </el-button>
    </div>
  </div>

  <!-- 目录选择弹窗 -->
  <el-dialog
    v-model="directoryDialogVisible"
    title="选择目录"
    width="600"
    :before-close="handleCloseDirectoryDialog">
    <div class="mb-4">
      <div class="flex items-center gap-2 mb-2">
        <el-input
          v-model="currentPath"
          placeholder="当前路径"
          readonly>
        </el-input>
        <el-button 
          type="primary" 
          @click="handleRefreshDirectory"
          :loading="directoryLoading">
          刷新
        </el-button>
      </div>
      <div class="flex items-center gap-2">
        <el-button 
          size="small"
          @click="handleNavigateUp"
          :disabled="!canNavigateUp">
          上一级
        </el-button>
        <el-button 
          size="small"
          @click="handleGoToHome">
          首页
        </el-button>
      </div>
    </div>
    <el-table 
      :data="directoryList" 
      stripe 
      class="w-full" 
      v-loading="directoryLoading"
      :height="300"
      @row-click="handleDirectoryRowClick">
      <el-table-column prop="name" label="名称" min-width="200">
        <template #default="{ row }">
          <div class="flex items-center gap-2">
            <span v-if="row.isDirectory">📁</span>
            <span v-else>📄</span>
            <span>{{ row.name }}</span>
          </div>
        </template>
      </el-table-column>
      <el-table-column prop="size" label="大小" width="100">
        <template #default="{ row }">
          <span v-if="!row.isDirectory">{{ formatSize(row.size) }}</span>
          <span v-else>-</span>
        </template>
      </el-table-column>
      <el-table-column label="操作" width="100">
        <template #default="{ row }">
          <el-button 
            v-if="row.isDirectory"
            size="small" 
            type="primary" 
            @click.stop="handleSelectDirectory(row)">
            选择
          </el-button>
        </template>
      </el-table-column>
    </el-table>
  </el-dialog>

  <!-- 扫描设备弹窗 -->
  <el-dialog
    v-model="scanDialogVisible"
    title="扫描到的设备"
    width="800"
    :before-close="handleCloseScanDialog">
    <div class="mb-4">
      <el-button 
        type="primary" 
        @click="handleUpdateDeviceList" 
        :loading="loading">
        刷新扫描
      </el-button>
    </div>
    <el-table 
      :data="deviceList" 
      stripe 
      class="w-full" 
      v-loading="loading"
      :height="400">
      <el-table-column prop="name" label="设备名称" min-width="150" />
      <el-table-column prop="address" label="地址" min-width="120" />
      <el-table-column prop="rssi" label="信号强度" width="100">
        <template #default="{ row }">
          <span>{{ row.rssi }} dBm</span>
        </template>
      </el-table-column>
      <el-table-column label="操作" width="100">
        <template #default="{ row }">
          <el-button 
            size="small" 
            type="primary" 
            @click="handleConnectDevice(row)"
            :loading="row.connecting"
            :disabled="row.connecting">
            连接
          </el-button>
        </template>
      </el-table-column>
    </el-table>
    <div v-if="deviceList.length === 0 && !loading" class="text-center text-gray-400 mt-4 py-8">
      暂无扫描到的设备，点击"刷新扫描"按钮开始扫描
    </div>
  </el-dialog>
</div>
