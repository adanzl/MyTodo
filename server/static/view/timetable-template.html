<div class="p-1 max-w-7xl mx-auto">
  <div class="flex justify-between items-center mb-6">
    <div>
      <h2 class="text-2xl font-bold text-gray-800">课程表</h2>
      <p class="text-sm text-gray-600 mt-1">
        当前显示: {{ getFilterDisplayText() }} (共 {{ getCourseCount() }} 门课程)
      </p>
    </div>
    <div class="flex items-center space-x-4">
      <el-radio-group v-model="filterChild" size="default">
        <el-radio-button label="all">全部</el-radio-button>
        <el-radio-button label="zhaozhao">昭昭</el-radio-button>
        <el-radio-button label="cancan">灿灿</el-radio-button>
      </el-radio-group>
      <el-button 
        @click="reloadTimetable" 
        type="info" 
        :loading="loading"
        :disabled="loading">
        {{ loading ? '加载中...' : '重新加载' }}
      </el-button>

      <el-button 
        @click="saveTimetable" 
        type="primary" 
        :loading="loading"
        :disabled="loading">
        {{ loading ? '保存中...' : '保存课程表' }}
      </el-button>
    </div>
  </div>
  
  <div class="overflow-x-auto" v-loading="loading">
    <table class="w-full border-collapse bg-white shadow-lg rounded-lg overflow-hidden">
      <thead>
        <tr class="bg-gray-50">
          <th class="border border-gray-200 px-2 py-2 text-center font-semibold text-gray-700 min-w-20">
            时间
          </th>
          <th 
            v-for="day in weekDays" 
            :key="day" 
            class="border border-gray-200 px-2 py-2 text-center font-semibold text-gray-700 min-w-32"
            :colspan="filterChild === 'all' ? 2 : 1">
            {{ day }}
          </th>
        </tr>
        <tr class="bg-blue-50">
          <th class="border border-gray-200 px-4 py-2 text-center"></th>
          <template v-for="day in weekDays" :key="day">
            <th v-if="filterChild === 'all' || filterChild === 'zhaozhao'" class="border border-gray-200 px-1 py-1 text-center">
              <div class="text-xs text-gray-600 font-medium">昭昭</div>
            </th>
            <th v-if="filterChild === 'all' || filterChild === 'cancan'" class="border border-gray-200 px-1 py-1 text-center">
              <div class="text-xs text-gray-600 font-medium">灿灿</div>
            </th>
          </template>
        </tr>
      </thead>
      <tbody>
        <tr v-for="hour in hourSlots" :key="hour" class="hover:bg-gray-50">
          <td class="border border-gray-200 px-2 py-2 text-center text-sm font-bold text-gray-600 bg-gray-50">
            {{ hour }}
          </td>
          <template v-for="day in weekDays" :key="day">
            <td v-if="filterChild === 'all' || filterChild === 'zhaozhao'" class="border border-gray-200 relative" style="height: 80px;">
              <div 
                class="w-full h-full bg-gray-50 rounded cursor-pointer hover:bg-blue-50 transition-colors relative"
                @click="onHourCellClick(day, 'zhaozhao', hour)"
              >
                <template v-for="course in getCoursesForHour(day, 'zhaozhao', hour)" :key="course.startTime">
                  <div
                    class="absolute top-0 h-full rounded text-xs flex items-center justify-center cursor-pointer transition-colors"
                    :class="[
                      getCourseColor(course).bg,
                      getCourseColor(course).border,
                      getCourseColor(course).hover,
                      {
                        'border-dashed': course.duration >= 60
                      }
                    ]"
                    :style="getCourseBlockStyle(course, hour)"
                    @click.stop="editCourse(day, 'zhaozhao', course.startTime)"
                    :title="`${course.name} (${course.startTime}-${getEndTime(course)})`"
                    style="pointer-events: auto; z-index: 10;"
                  >
                    <div class="text-center p-2">
                      <div v-if="shouldShowCourseName(course, hour)" class="font-medium whitespace-pre-line leading-tight" :class="{ 'text-xs': course.duration <= 30, 'text-sm': course.duration > 30 }">{{ course.name }}</div>
                    </div>
                  </div>
                </template>
              </div>
            </td>
            <td v-if="filterChild === 'all' || filterChild === 'cancan'" class="border border-gray-200 relative" style="height: 80px;">
              <div 
                class="w-full h-full bg-gray-50 rounded cursor-pointer hover:bg-pink-50 transition-colors relative"
                @click="onHourCellClick(day, 'cancan', hour)"
              >
                <template v-for="course in getCoursesForHour(day, 'cancan', hour)" :key="course.startTime">
                  <div
                    class="absolute top-0 h-full rounded text-xs flex items-center justify-center cursor-pointer transition-colors"
                    :class="[
                      getCourseColor(course).bg,
                      getCourseColor(course).border,
                      getCourseColor(course).hover,
                      {
                        'border-dashed': course.duration >= 60
                      }
                    ]"
                    :style="getCourseBlockStyle(course, hour)"
                    @click.stop="editCourse(day, 'cancan', course.startTime)"
                    :title="`${course.name} (${course.startTime}-${getEndTime(course)})`"
                    style="pointer-events: auto; z-index: 10;"
                  >
                    <div class="text-center p-2">
                      <div v-if="shouldShowCourseName(course, hour)" class="font-medium whitespace-pre-line leading-tight" :class="{ 'text-xs': course.duration <= 30, 'text-sm': course.duration > 30 }">{{ course.name }}</div>
                    </div>
                  </div>
                </template>
              </div>
            </td>
          </template>
        </tr>
      </tbody>
    </table>
    
    <!-- 空状态提示 -->
    <div v-if="getCourseCount() === 0 && !loading" class="text-center py-6 bg-blue-50 rounded-lg mt-4 border border-blue-200">
      <div class="flex items-center justify-center space-x-2 text-blue-600">
        <el-icon><InfoFilled /></el-icon>
        <span class="text-sm">暂无课程数据，点击任意时间格子来添加课程</span>
      </div>
      <div class="mt-3 space-x-2">
        <el-button type="info" size="small" @click="reloadTimetable">重新加载</el-button>
        <el-button type="info" size="small" @click="printTimetable">打印课程表</el-button>
      </div>
    </div>
    
    <!-- 非空状态提示 -->
    <div v-if="getCourseCount() > 0 && !loading" class="text-center py-4 bg-gray-50 rounded-lg mt-4 border border-gray-200">
      <div class="flex items-center justify-center space-x-2 text-gray-600">
        <el-icon><InfoFilled /></el-icon>
        <span class="text-sm">当前共有 {{ getCourseCount() }} 门课程</span>
      </div>
      <div class="mt-3 space-x-2">
        <el-button type="info" size="small" @click="reloadTimetable">重新加载</el-button>
        <el-button type="info" size="small" @click="printTimetable">打印课程表</el-button>
      </div>
    </div>
  </div>

  <!-- 编辑弹窗 -->
  <el-dialog
    v-model="showEditModal"
    title="编辑课程"
    width="500px"
    :before-close="closeModal"
    center>
    <div class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">开始时间:</label>
        <el-select 
          v-model="editingCourse.startTime" 
          placeholder="请选择开始时间"
          filterable
          class="w-full">
          <el-option 
            v-for="time in startTimeOptions" 
            :key="time" 
            :label="time" 
            :value="time">
            {{ time }}
          </el-option>
        </el-select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">课程名称:</label>
        <el-input 
          v-model="editingCourse.name" 
          placeholder="请输入课程名称"
          type="textarea"
          :rows="3"
          clearable>
        </el-input>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">持续时间(分钟):</label>
        <el-input-number 
          v-model="editingCourse.duration" 
          :min="10" 
          :step="10" 
          :max="240"
          placeholder="10"
          class="w-full">
        </el-input-number>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">课程颜色:</label>
        <div class="flex space-x-2">
          <div 
            v-for="(color, id) in {1: '蓝色', 2: '绿色', 3: '紫色', 4: '橙色', 5: '粉色'}" 
            :key="id"
            class="w-8 h-8 rounded-full border-2 cursor-pointer transition-all"
            :class="[
              id == editingCourse.colorId ? 'border-gray-800 scale-110' : 'border-gray-300',
              getCourseColor({colorId: id}).bg
            ]"
            @click="editingCourse.colorId = parseInt(id)"
            :title="color">
          </div>
        </div>
      </div>
    </div>
    <template #footer>
      <div class="flex justify-end space-x-3">
        <el-button @click="deleteCourse" type="danger" size="default">
          删除课程
        </el-button>
        <el-button @click="closeModal" size="default">
          取消
        </el-button>
        <el-button @click="saveCourse" type="primary" size="default">
          保存
        </el-button>
      </div>
    </template>
  </el-dialog>
</div>
