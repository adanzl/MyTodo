import{d as B,u as D,c as C,r as b,o as M,a as f,k as y,w as Y,b as l,f as i,e as m,az as A,a_ as F,g as n,F as G,C as I,t as v,a3 as R,B as S,a$ as T,b0 as j,j as H}from"./index.e2k-DlDj.js";import{d as Z}from"./dayjs.min.DrTfEg_r.js";import{E as $,a as q}from"./index.J11CJ2Hm.js";import{v as J}from"./directive.BDGTbqBI.js";import{E as K,a as O}from"./index.g4PzMJCG.js";import{E as Q}from"./index.B_r0gvwt.js";import{f as W}from"./forEach.ChlH2wlF.js";import"./omit.BvRqBRkQ.js";import"./_baseEach.Bbw20qpw.js";import"./_createBaseEach.qzTyINie.js";import"./_castFunction.CnYLP7GE.js";const X={class:""},ee={class:"flex items-center"},ae={key:0},te={key:1},oe={class:"flex items-center gap-1 w-full"},se={class:"flex-1 text-center"},k=10,ge=B({__name:"Score",setup(le){const w=D(),L=C(()=>w.userList),u=C(()=>{const e=[...L.value];return e.unshift({id:0,name:"全部"}),e}),s=b({data:[],pageNum:1,pageSize:10,totalCount:0,totalPage:0}),g=b(!1),c=b(0),z=C(()=>u.value.find(e=>e.id===c.value)||u.value[0]),U=async()=>{await w.refreshUserList(),u.value.length>0&&(c.value=u.value[0].id)},x=e=>F(u.value,o=>o.id==e),h=async(e,o,p)=>{g.value=!0;try{let d;e&&e!==0&&(d={user_id:e});const a=await A("t_score_history",d,o,p);if(a&&a.data){const _=a.data.data||[];s.value.data=[],s.value.pageNum=a.data.pageNum??o,s.value.pageSize=a.data.pageSize??p,s.value.totalCount=a.data.totalCount??0,s.value.totalPage=a.data.totalPage??0,W(_,r=>{r.user=x(r.user_id),r.dt=Z(r.dt).format("YYYY-MM-DD HH:mm:ss"),s.value.data.push(r)})}}catch(d){console.error("获取积分记录失败:",d)}finally{g.value=!1}},N=async()=>{const e=z.value;console.log("onUserChange",e),e&&await h(e.id,1,k)},E=(e,o)=>{h(z.value.id,e,o)};return M(async()=>{await U(),await h(0,1,k)}),(e,o)=>{const p=q,d=$,a=O,_=R,r=K,P=Q,V=J;return n(),f("div",X,[y("div",ee,[l(d,{size:"large",modelValue:c.value,"onUpdate:modelValue":o[0]||(o[0]=t=>c.value=t),onChange:N},{default:i(()=>[(n(!0),f(G,null,I(u.value,t=>(n(),m(p,{key:t.id,value:t.id},{default:i(()=>[H(v(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),Y((n(),m(r,{data:s.value.data,stripe:""},{default:i(()=>[l(a,{label:"ID",prop:"id",width:"60"}),l(a,{label:"user",width:"60"},{default:i(({row:t})=>[t.user?(n(),f("span",ae,v(t.user.name),1)):(n(),f("span",te,v(t.user_id),1))]),_:1}),l(a,{label:"Action",prop:"action",width:"100"}),l(a,{label:"Date",prop:"dt",width:"180"}),l(a,{label:"Pre",prop:"pre_value",width:"70"}),l(a,{label:"Value",width:"70"},{default:i(({row:t})=>[y("div",oe,[t.value>0?(n(),m(_,{key:0,color:"#67C23A",size:16},{default:i(()=>[l(S(T))]),_:1})):(n(),m(_,{key:1,color:"#F56C6C",size:16},{default:i(()=>[l(S(j))]),_:1})),y("span",se,v(t.value),1)])]),_:1}),l(a,{label:"Current",prop:"current",width:"80"}),l(a,{label:"MSG",prop:"msg"})]),_:1},8,["data"])),[[V,g.value]]),l(P,{layout:"sizes, prev, pager, next",total:s.value.totalCount,"page-size":s.value.pageSize,"page-sizes":[10,20,50],"current-page":s.value.pageNum,class:"mt-2",background:"",onSizeChange:o[1]||(o[1]=t=>E(s.value.pageNum,t)),onCurrentChange:o[2]||(o[2]=t=>E(t,s.value.pageSize))},null,8,["total","page-size","current-page"])])}}});export{ge as default};
