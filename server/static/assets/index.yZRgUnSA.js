import{aM as Z,al as de,x as ce,z as A,A as f,bZ as k,Q as X,_ as q,d as M,U as ke,s as N,bu as K,r as pe,c as Y,e as U,g as y,f as w,a as S,J as R,F as Ee,C as Ce,aP as fe,B as a,I as m,l as g,k as j,a2 as D,b as P,a3 as O,bY as $e,t as Q,O as Re,b_ as we,bC as Fe,a4 as Le,a8 as Pe,bE as Se,b$ as Te,y as Ue,Y as J,c0 as x,b1 as _e,c1 as Oe,c2 as De,c3 as Be,Z as ee,b8 as je,ag as Ne,bd as Ae,L as qe,bf as Me,ao as te,an as se,M as Ke}from"./index.Bk_h8V15.js";import{E as He}from"./index.BSduyFTj.js";import{b as ze}from"./omit.BYRWldEZ.js";var Ie=1,Ge=4;function ae(n){return ze(n,Ie|Ge)}const me=Symbol("uploadContextKey"),Ve="ElUpload";class Xe extends Error{constructor(r,o,d,p){super(r),this.name="UploadAjaxError",this.status=o,this.method=d,this.url=p}}function oe(n,r,o){let d;return o.response?d=`${o.response.error||o.response}`:o.responseText?d=`${o.responseText}`:d=`fail to ${r.method} ${n} ${o.status}`,new Xe(d,o.status,r.method,n)}function Ye(n){const r=n.responseText||n.response;if(!r)return r;try{return JSON.parse(r)}catch{return r}}const Je=n=>{typeof XMLHttpRequest>"u"&&Z(Ve,"XMLHttpRequest is undefined");const r=new XMLHttpRequest,o=n.action;r.upload&&r.upload.addEventListener("progress",i=>{const u=i;u.percent=i.total>0?i.loaded/i.total*100:0,n.onProgress(u)});const d=new FormData;if(n.data)for(const[i,u]of Object.entries(n.data))de(u)&&u.length?d.append(i,...u):d.append(i,u);d.append(n.filename,n.file,n.file.name),r.addEventListener("error",()=>{n.onError(oe(o,n,r))}),r.addEventListener("load",()=>{if(r.status<200||r.status>=300)return n.onError(oe(o,n,r));n.onSuccess(Ye(r))}),r.open(n.method,o,!0),n.withCredentials&&"withCredentials"in r&&(r.withCredentials=!0);const p=n.headers||{};if(p instanceof Headers)p.forEach((i,u)=>r.setRequestHeader(u,i));else for(const[i,u]of Object.entries(p))ce(u)||r.setRequestHeader(i,String(u));return r.send(d),r},ve=["text","picture","picture-card"];let We=1;const W=()=>Date.now()+We++,ye=A({action:{type:String,default:"#"},headers:{type:f(Object)},method:{type:String,default:"post"},data:{type:f([Object,Function,Promise]),default:()=>X({})},multiple:Boolean,name:{type:String,default:"file"},drag:Boolean,withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},fileList:{type:f(Array),default:()=>X([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:ve,default:"text"},httpRequest:{type:f(Function),default:Je},disabled:{type:Boolean,default:void 0},limit:Number}),Ze=A({...ye,beforeUpload:{type:f(Function),default:k},beforeRemove:{type:f(Function)},onRemove:{type:f(Function),default:k},onChange:{type:f(Function),default:k},onPreview:{type:f(Function),default:k},onSuccess:{type:f(Function),default:k},onProgress:{type:f(Function),default:k},onError:{type:f(Function),default:k},onExceed:{type:f(Function),default:k},crossorigin:{type:f(String)}}),Qe=A({files:{type:f(Array),default:()=>X([])},disabled:{type:Boolean,default:void 0},handlePreview:{type:f(Function),default:k},listType:{type:String,values:ve,default:"text"},crossorigin:{type:f(String)}}),xe={remove:n=>!!n},et=["tabindex","aria-disabled","onKeydown"],tt=["src","crossorigin"],st=["onClick"],at=["title"],ot=["onClick"],nt=["onClick"],lt=M({name:"ElUploadList",__name:"upload-list",props:Qe,emits:xe,setup(n,{emit:r}){const o=n,d=r,{t:p}=ke(),i=N("upload"),u=N("icon"),F=N("list"),v=K(),$=pe(!1),b=Y(()=>[i.b("list"),i.bm("list",o.listType),i.is("disabled",v.value)]),h=c=>{d("remove",c)};return(c,E)=>(y(),U(Te,{tag:"ul",class:m(b.value),name:a(F).b()},{default:w(()=>[(y(!0),S(Ee,null,Ce(c.files,(s,e)=>(y(),S("li",{key:s.uid||s.name,class:m([a(i).be("list","item"),a(i).is(s.status),{focusing:$.value}]),tabindex:a(v)?void 0:0,"aria-disabled":a(v),role:"button",onKeydown:fe(t=>!a(v)&&h(s),["delete"]),onFocus:E[0]||(E[0]=t=>$.value=!0),onBlur:E[1]||(E[1]=t=>$.value=!1),onClick:E[2]||(E[2]=t=>$.value=!1)},[R(c.$slots,"default",{file:s,index:e},()=>[c.listType==="picture"||s.status!=="uploading"&&c.listType==="picture-card"?(y(),S("img",{key:0,class:m(a(i).be("list","item-thumbnail")),src:s.url,crossorigin:c.crossorigin,alt:""},null,10,tt)):g("v-if",!0),s.status==="uploading"||c.listType!=="picture-card"?(y(),S("div",{key:1,class:m(a(i).be("list","item-info"))},[j("a",{class:m(a(i).be("list","item-name")),onClick:D(t=>c.handlePreview(s),["prevent"])},[P(a(O),{class:m(a(u).m("document"))},{default:w(()=>[P(a($e))]),_:1},8,["class"]),j("span",{class:m(a(i).be("list","item-file-name")),title:s.name},Q(s.name),11,at)],10,st),s.status==="uploading"?(y(),U(a(He),{key:0,type:c.listType==="picture-card"?"circle":"line","stroke-width":c.listType==="picture-card"?6:2,percentage:Number(s.percentage),style:Re(c.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):g("v-if",!0)],2)):g("v-if",!0),j("label",{class:m(a(i).be("list","item-status-label"))},[c.listType==="text"?(y(),U(a(O),{key:0,class:m([a(u).m("upload-success"),a(u).m("circle-check")])},{default:w(()=>[P(a(we))]),_:1},8,["class"])):["picture-card","picture"].includes(c.listType)?(y(),U(a(O),{key:1,class:m([a(u).m("upload-success"),a(u).m("check")])},{default:w(()=>[P(a(Fe))]),_:1},8,["class"])):g("v-if",!0)],2),a(v)?g("v-if",!0):(y(),U(a(O),{key:2,class:m(a(u).m("close")),onClick:t=>h(s)},{default:w(()=>[P(a(Le))]),_:1},8,["class","onClick"])),g(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),g(" This is a bug which needs to be fixed "),g(" TODO: Fix the incorrect navigation interaction "),a(v)?g("v-if",!0):(y(),S("i",{key:3,class:m(a(u).m("close-tip"))},Q(a(p)("el.upload.deleteTip")),3)),c.listType==="picture-card"?(y(),S("span",{key:4,class:m(a(i).be("list","item-actions"))},[j("span",{class:m(a(i).be("list","item-preview")),onClick:t=>c.handlePreview(s)},[P(a(O),{class:m(a(u).m("zoom-in"))},{default:w(()=>[P(a(Pe))]),_:1},8,["class"])],10,ot),a(v)?g("v-if",!0):(y(),S("span",{key:0,class:m(a(i).be("list","item-delete")),onClick:t=>h(s)},[P(a(O),{class:m(a(u).m("delete"))},{default:w(()=>[P(a(Se))]),_:1},8,["class"])],10,nt))],2)):g("v-if",!0)])],42,et))),128)),R(c.$slots,"append")]),_:3},8,["class","name"]))}});var ne=q(lt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-list.vue"]]);const rt=A({disabled:{type:Boolean,default:void 0}}),it={file:n=>de(n)},le="ElUploadDrag",ut=M({name:le,__name:"upload-dragger",props:rt,emits:it,setup(n,{emit:r}){const o=r;Ue(me)||Z(le,"usage: <el-upload><el-upload-dragger /></el-upload>");const p=N("upload"),i=pe(!1),u=K(),F=b=>{if(u.value)return;i.value=!1,b.stopPropagation();const h=Array.from(b.dataTransfer.files),c=b.dataTransfer.items||[];h.forEach((E,s)=>{var e;const t=c[s],l=(e=t?.webkitGetAsEntry)==null?void 0:e.call(t);l&&(E.isDirectory=l.isDirectory)}),o("file",h)},v=()=>{u.value||(i.value=!0)},$=b=>{b.currentTarget.contains(b.relatedTarget)||(i.value=!1)};return(b,h)=>(y(),S("div",{class:m([a(p).b("dragger"),a(p).is("dragover",i.value)]),onDrop:D(F,["prevent"]),onDragover:D(v,["prevent"]),onDragleave:D($,["prevent"])},[R(b.$slots,"default")],34))}});var dt=q(ut,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-dragger.vue"]]);const ct=A({...ye,beforeUpload:{type:f(Function),default:k},onRemove:{type:f(Function),default:k},onStart:{type:f(Function),default:k},onSuccess:{type:f(Function),default:k},onProgress:{type:f(Function),default:k},onError:{type:f(Function),default:k},onExceed:{type:f(Function),default:k}}),pt=["tabindex","aria-disabled","onKeydown"],ft=["name","disabled","multiple","accept"],mt=M({name:"ElUploadContent",inheritAttrs:!1,__name:"upload-content",props:ct,setup(n,{expose:r}){const o=n,d=N("upload"),p=K(),i=J({}),u=J(),F=e=>{if(e.length===0)return;const{autoUpload:t,limit:l,fileList:C,multiple:L,onStart:T,onExceed:H}=o;if(l&&C.length+e.length>l){H(e,C);return}L||(e=e.slice(0,1));for(const z of e){const B=z;B.uid=W(),T(B),t&&v(B)}},v=async e=>{if(u.value.value="",!o.beforeUpload)return b(e);let t,l={};try{const L=o.data,T=o.beforeUpload(e);l=x(o.data)?ae(o.data):o.data,t=await T,x(o.data)&&_e(L,l)&&(l=ae(o.data))}catch{t=!1}if(t===!1){o.onRemove(e);return}let C=e;t instanceof Blob&&(t instanceof File?C=t:C=new File([t],e.name,{type:e.type})),b(Object.assign(C,{uid:e.uid}),l)},$=async(e,t)=>De(e)?e(t):e,b=async(e,t)=>{const{headers:l,data:C,method:L,withCredentials:T,name:H,action:z,onProgress:B,onSuccess:ge,onError:be,httpRequest:he}=o;try{t=await $(t??C,e)}catch{o.onRemove(e);return}const{uid:I}=e,G={headers:l||{},withCredentials:T,file:e,data:t,method:L,filename:H,action:z,onProgress:_=>{B(_,e)},onSuccess:_=>{ge(_,e),delete i.value[I]},onError:_=>{be(_,e),delete i.value[I]}},V=he(G);i.value[I]=V,V instanceof Promise&&V.then(G.onSuccess,G.onError)},h=e=>{const t=e.target.files;t&&F(Array.from(t))},c=()=>{p.value||(u.value.value="",u.value.click())},E=()=>{c()};return r({abort:e=>{Oe(i.value).filter(e?([l])=>String(e.uid)===l:()=>!0).forEach(([l,C])=>{C instanceof XMLHttpRequest&&C.abort(),delete i.value[l]})},upload:v}),(e,t)=>(y(),S("div",{class:m([a(d).b(),a(d).m(e.listType),a(d).is("drag",e.drag),a(d).is("disabled",a(p))]),tabindex:a(p)?void 0:0,"aria-disabled":a(p),role:"button",onClick:c,onKeydown:fe(D(E,["self"]),["enter","space"])},[e.drag?(y(),U(dt,{key:0,disabled:a(p),onFile:F},{default:w(()=>[R(e.$slots,"default")]),_:3},8,["disabled"])):R(e.$slots,"default",{key:1}),j("input",{ref_key:"inputRef",ref:u,class:m(a(d).e("input")),name:e.name,disabled:a(p),multiple:e.multiple,accept:e.accept,type:"file",onChange:h,onClick:t[0]||(t[0]=D(()=>{},["stop"]))},null,42,ft)],42,pt))}});var re=q(mt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-content.vue"]]);const ie="ElUpload",ue=n=>{var r;(r=n.url)!=null&&r.startsWith("blob:")&&URL.revokeObjectURL(n.url)},vt=(n,r)=>{const o=Be(n,"fileList",void 0,{passive:!0}),d=s=>o.value.find(e=>e.uid===s.uid);function p(s){var e;(e=r.value)==null||e.abort(s)}function i(s=["ready","uploading","success","fail"]){o.value=o.value.filter(e=>!s.includes(e.status))}function u(s){o.value=o.value.filter(e=>e.uid!==s.uid)}const F=s=>{Ne(()=>n.onChange(s,o.value))},v=(s,e)=>{const t=d(e);t&&(console.error(s),t.status="fail",u(t),n.onError(s,t,o.value),F(t))},$=(s,e)=>{const t=d(e);t&&(n.onProgress(s,t,o.value),t.status="uploading",t.percentage=Math.round(s.percent))},b=(s,e)=>{const t=d(e);t&&(t.status="success",t.response=s,n.onSuccess(s,t,o.value),F(t))},h=s=>{ce(s.uid)&&(s.uid=W());const e={name:s.name,percentage:0,status:"ready",size:s.size,raw:s,uid:s.uid};if(n.listType==="picture-card"||n.listType==="picture")try{e.url=URL.createObjectURL(s)}catch(t){je(ie,t.message),n.onError(t,e,o.value)}o.value=[...o.value,e],F(e)},c=async s=>{const e=s instanceof File?d(s):s;e||Z(ie,"file to be removed not found");const t=l=>{p(l),u(l),n.onRemove(l,o.value),ue(l)};n.beforeRemove?await n.beforeRemove(e,o.value)!==!1&&t(e):t(e)};function E(){o.value.filter(({status:s})=>s==="ready").forEach(({raw:s})=>{var e;return s&&((e=r.value)==null?void 0:e.upload(s))})}return ee(()=>n.listType,s=>{s!=="picture-card"&&s!=="picture"||(o.value=o.value.map(e=>{const{raw:t,url:l}=e;if(!l&&t)try{e.url=URL.createObjectURL(t)}catch(C){n.onError(C,e,o.value)}return e}))}),ee(o,s=>{for(const e of s)e.uid||(e.uid=W()),e.status||(e.status="success")},{immediate:!0,deep:!0}),{uploadFiles:o,abort:p,clearFiles:i,handleError:v,handleProgress:$,handleStart:h,handleSuccess:b,handleRemove:c,submit:E,revokeFileObjectURL:ue}},yt=M({name:"ElUpload",__name:"upload",props:Ze,setup(n,{expose:r}){const o=n,d=K(),p=J(),{abort:i,submit:u,clearFiles:F,uploadFiles:v,handleStart:$,handleError:b,handleRemove:h,handleSuccess:c,handleProgress:E,revokeFileObjectURL:s}=vt(o,p),e=Y(()=>o.listType==="picture-card"),t=Y(()=>({...o,fileList:v.value,onStart:$,onProgress:E,onSuccess:c,onError:b,onRemove:h}));return Ae(()=>{v.value.forEach(s)}),qe(me,{accept:Me(o,"accept")}),r({abort:i,submit:u,clearFiles:F,handleStart:$,handleRemove:h}),(l,C)=>(y(),S("div",null,[e.value&&l.showFileList?(y(),U(ne,{key:0,disabled:a(d),"list-type":l.listType,files:a(v),crossorigin:l.crossorigin,"handle-preview":l.onPreview,onRemove:a(h)},te({append:w(()=>[P(re,se({ref_key:"uploadRef",ref:p},t.value),{default:w(()=>[l.$slots.trigger?R(l.$slots,"trigger",{key:0}):g("v-if",!0),!l.$slots.trigger&&l.$slots.default?R(l.$slots,"default",{key:1}):g("v-if",!0)]),_:3},16)]),_:2},[l.$slots.file?{name:"default",fn:w(({file:L,index:T})=>[R(l.$slots,"file",{file:L,index:T})]),key:"0"}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):g("v-if",!0),!e.value||e.value&&!l.showFileList?(y(),U(re,se({key:1,ref_key:"uploadRef",ref:p},t.value),{default:w(()=>[l.$slots.trigger?R(l.$slots,"trigger",{key:0}):g("v-if",!0),!l.$slots.trigger&&l.$slots.default?R(l.$slots,"default",{key:1}):g("v-if",!0)]),_:3},16)):g("v-if",!0),l.$slots.trigger?R(l.$slots,"default",{key:2}):g("v-if",!0),R(l.$slots,"tip"),!e.value&&l.showFileList?(y(),U(ne,{key:3,disabled:a(d),"list-type":l.listType,files:a(v),crossorigin:l.crossorigin,"handle-preview":l.onPreview,onRemove:a(h)},te({_:2},[l.$slots.file?{name:"default",fn:w(({file:L,index:T})=>[R(l.$slots,"file",{file:L,index:T})]),key:"0"}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):g("v-if",!0)]))}});var gt=q(yt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload.vue"]]);const Et=Ke(gt);export{Et as E};
