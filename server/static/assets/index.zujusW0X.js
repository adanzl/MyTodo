import{z as et,bc as Hs,c as le,X as Ys,r as G,Z as Ne,$ as gt,bd as rl,q as Rt,_ as Ue,d as ke,H as Js,b7 as qs,s as tt,U as dl,e as te,g as v,f as c,b as n,a0 as Xs,B as s,w as be,a1 as Qs,k as o,an as Le,a2 as ge,a as B,l as Q,I as ie,J as xe,t as j,a3 as Be,a4 as Zs,O as $t,aQ as _e,ac as en,M as Ct,y as Ve,o as nt,L as Ze,A as Re,ae as kt,be as Ke,bf as rt,bg as tn,ag as zt,aW as Oe,ap as ln,aq as sn,aN as st,bh as it,bi as nn,bj as Bt,af as Ye,ao as an,bk as ul,bl as on,bm as rn,bn as dn,i as ze,G as cl,aJ as un,bo as fl,b5 as pl,a9 as qe,F as De,bp as Qt,N as Ut,aL as yt,as as Et,P as At,bq as Nt,aH as Lt,aI as Ot,br as cn,bs as fn,bt as pn,bu as vn,Y as mn,aP as It,bv as Qe,aK as Zt,aM as gn,b8 as yn,K as hn,v as bn,j as X,h as Vt,m as z,bw as de,C as Ae,bx as We,aB as ht,by as wn,bz as $n,bA as vl,bB as Kt,bC as bt,bD as Gt,bE as je,bF as ml,bG as gl,aX as Cn,aA as yl,bH as kn,aC as hl,bI as Dn,aG as bl,aV as wl,aS as Te,ba as dt,bJ as ft}from"./index.e2k-DlDj.js";import{i as xn,f as jt,c as wt,M as $l,E as Fn,a as Ee,_ as Cl,n as pt,u as Sn,g as _n,b as Pn}from"./useInterval.zhjTLPUH.js";import"./dayjs.min.DrTfEg_r.js";import{d as Tn,a as Bn,b as En,c as An,e as kl,E as ut}from"./index.DC5lNyCN.js";import{b as Mn,E as Nn}from"./index.J11CJ2Hm.js";import{g as Xe,f as Ln,a as el}from"./date.g5OLmH5T.js";import{b as Dt,E as Dl,a as xl}from"./index.g4PzMJCG.js";import{E as On}from"./index.CvhV0tVk.js";import{v as Wt}from"./directive.BDGTbqBI.js";import{g as In,s as Rn}from"./rds.ztEyRhaj.js";import"./omit.BvRqBRkQ.js";import"./_baseEach.Bbw20qpw.js";import"./_createBaseEach.qzTyINie.js";const zn=et({...Bn,direction:{type:String,default:"rtl",values:["ltr","rtl","ttb","btt"]},resizable:Boolean,size:{type:[String,Number],default:"30%"},withHeader:{type:Boolean,default:!0},modalFade:{type:Boolean,default:!0},headerAriaLevel:{type:String,default:"2"}}),Un={...Tn,"resize-start":(e,f)=>e instanceof MouseEvent&&typeof f=="number",resize:(e,f)=>e instanceof MouseEvent&&typeof f=="number","resize-end":(e,f)=>e instanceof MouseEvent&&typeof f=="number"};function Vn(e,f,r){const{width:u,height:h}=Hs(),i=le(()=>["ltr","rtl"].includes(e.direction)),l=le(()=>["ltr","ttb"].includes(e.direction)?1:-1),d=le(()=>i.value?u.value:h.value),g=le(()=>Ys(a.value+l.value*k.value,4,d.value)),a=G(0),k=G(0),E=G(!1),A=G(!1);let m=[],t=[];const T=()=>{var D;const _=(D=f.value)==null?void 0:D.closest('[aria-modal="true"]');return _?i.value?_.offsetWidth:_.offsetHeight:100};Ne(()=>[e.size,e.resizable],()=>{A.value=!1,a.value=0,k.value=0,M()});const b=D=>{e.resizable&&(A.value||(a.value=T(),A.value=!0),m=[D.pageX,D.pageY],E.value=!0,r("resize-start",D,a.value),t.push(gt(window,"mouseup",M),gt(window,"mousemove",V)))},V=D=>{const{pageX:_,pageY:U}=D,oe=_-m[0],R=U-m[1];k.value=i.value?oe:R,r("resize",D,g.value)},M=D=>{E.value&&(m=[],a.value=g.value,k.value=0,E.value=!1,t.forEach(_=>_?.()),t=[],D&&r("resize-end",D,a.value))},I=gt(f,"mousedown",b);return rl(()=>{I(),M()}),{size:le(()=>A.value?`${g.value}px`:Rt(e.size)),isResizing:E,isHorizontal:i}}const Kn=["aria-label","aria-labelledby","aria-describedby"],Gn=["id","aria-level"],jn=["aria-label"],Wn=["id"],Hn=ke({name:"ElDrawer",inheritAttrs:!1,__name:"drawer",props:zn,emits:Un,setup(e,{expose:f,emit:r}){const u=e,h=r,i=Js();qs({scope:"el-drawer",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/drawer.html#slots"},le(()=>!!i.title));const l=G(),d=G(),g=G(),a=tt("drawer"),{t:k}=dl(),{afterEnter:E,afterLeave:A,beforeLeave:m,visible:t,rendered:T,titleId:b,bodyId:V,zIndex:M,onModalClick:I,onOpenAutoFocus:D,onCloseAutoFocus:_,onFocusoutPrevented:U,onCloseRequested:oe,handleClose:R}=En(u,l),{isHorizontal:x,size:P,isResizing:w}=Vn(u,g,h),O=le(()=>u.modalPenetrable&&!u.modal);return f({handleClose:R,afterEnter:E,afterLeave:A}),(y,J)=>(v(),te(s(en),{to:y.appendTo,disabled:y.appendTo!=="body"?!1:!y.appendToBody},{default:c(()=>[n(Xs,{name:s(a).b("fade"),onAfterEnter:s(E),onAfterLeave:s(A),onBeforeLeave:s(m),persisted:""},{default:c(()=>{var me;return[be(n(s(An),{mask:y.modal,"overlay-class":[s(a).is("drawer"),(me=y.modalClass)!=null?me:"",`${s(a).namespace.value}-modal-drawer`,s(a).is("penetrable",O.value)],"z-index":s(M),onClick:s(I)},{default:c(()=>[n(s(Qs),{loop:"",trapped:s(t),"focus-trap-el":l.value,"focus-start-el":d.value,onFocusAfterTrapped:s(D),onFocusAfterReleased:s(_),onFocusoutPrevented:s(U),onReleaseRequested:s(oe)},{default:c(()=>[o("div",Le({ref_key:"drawerRef",ref:l,"aria-modal":"true","aria-label":y.title||void 0,"aria-labelledby":y.title?void 0:s(b),"aria-describedby":s(V)},y.$attrs,{class:[s(a).b(),y.direction,s(t)&&"open",s(a).is("dragging",s(w))],style:{[s(x)?"width":"height"]:s(P)},role:"dialog",onClick:J[1]||(J[1]=ge(()=>{},["stop"]))}),[o("span",{ref_key:"focusStartRef",ref:d,class:ie(s(a).e("sr-focus")),tabindex:"-1"},null,2),y.withHeader?(v(),B("header",{key:0,class:ie([s(a).e("header"),y.headerClass])},[y.$slots.title?xe(y.$slots,"title",{key:1},()=>[Q(" DEPRECATED SLOT ")]):xe(y.$slots,"header",{key:0,close:s(R),titleId:s(b),titleClass:s(a).e("title")},()=>[o("span",{id:s(b),role:"heading","aria-level":y.headerAriaLevel,class:ie(s(a).e("title"))},j(y.title),11,Gn)]),y.showClose?(v(),B("button",{key:2,"aria-label":s(k)("el.drawer.close"),class:ie(s(a).e("close-btn")),type:"button",onClick:J[0]||(J[0]=(...F)=>s(R)&&s(R)(...F))},[n(s(Be),{class:ie(s(a).e("close"))},{default:c(()=>[n(s(Zs))]),_:1},8,["class"])],10,jn)):Q("v-if",!0)],2)):Q("v-if",!0),s(T)?(v(),B("div",{key:1,id:s(V),class:ie([s(a).e("body"),y.bodyClass])},[xe(y.$slots,"default")],10,Wn)):Q("v-if",!0),y.$slots.footer?(v(),B("div",{key:2,class:ie([s(a).e("footer"),y.footerClass])},[xe(y.$slots,"footer")],2)):Q("v-if",!0),y.resizable?(v(),B("div",{key:3,ref_key:"draggerRef",ref:g,style:$t({zIndex:s(M)}),class:ie(s(a).e("dragger"))},null,6)):Q("v-if",!0)],16,Kn)]),_:3},8,["trapped","focus-trap-el","focus-start-el","onFocusAfterTrapped","onFocusAfterReleased","onFocusoutPrevented","onReleaseRequested"])]),_:3},8,["mask","overlay-class","z-index","onClick"]),[[_e,s(t)]])]}),_:3},8,["name","onAfterEnter","onAfterLeave","onBeforeLeave"])]),_:3},8,["to","disabled"]))}});var Yn=Ue(Hn,[["__file","/home/runner/work/element-plus/element-plus/packages/components/drawer/src/drawer.vue"]]);const Fl=Ct(Yn),Jn=ke({inheritAttrs:!1});function qn(e,f,r,u,h,i){return xe(e.$slots,"default")}var Xn=Ue(Jn,[["render",qn],["__file","/home/runner/work/element-plus/element-plus/packages/components/collection/src/collection.vue"]]);const Qn=ke({name:"ElCollectionItem",inheritAttrs:!1});function Zn(e,f,r,u,h,i){return xe(e.$slots,"default")}var ea=Ue(Qn,[["render",Zn],["__file","/home/runner/work/element-plus/element-plus/packages/components/collection/src/collection-item.vue"]]);const Sl="data-el-collection-item",ta=e=>{const f=`El${e}Collection`,r=`${f}Item`,u=Symbol(f),h=Symbol(r),i=Object.assign({},Xn,{name:f,setup(){const d=G(),g=new Map;Ze(u,{itemMap:g,getItems:()=>{const k=s(d);if(!k)return[];const E=Array.from(k.querySelectorAll(`[${Sl}]`));return[...g.values()].sort((m,t)=>E.indexOf(m.ref)-E.indexOf(t.ref))},collectionRef:d})}}),l=Object.assign({},ea,{name:r,setup(d,{attrs:g}){const a=G(),k=Ve(u,void 0);Ze(h,{collectionItemRef:a}),nt(()=>{const E=s(a);E&&k.itemMap.set(E,{ref:E,...g})}),rl(()=>{const E=s(a);k.itemMap.delete(E)})}});return{COLLECTION_INJECTION_KEY:u,COLLECTION_ITEM_INJECTION_KEY:h,ElCollection:i,ElCollectionItem:l}},la=et({style:{type:Re([String,Array,Object])},currentTabId:{type:Re(String)},defaultCurrentTabId:String,loop:Boolean,dir:{type:String,values:["ltr","rtl"],default:"ltr"},orientation:{type:Re(String)},onBlur:Function,onFocus:Function,onMousedown:Function}),{ElCollection:sa,ElCollectionItem:na,COLLECTION_INJECTION_KEY:_l,COLLECTION_ITEM_INJECTION_KEY:aa}=ta("RovingFocusGroup"),Ht=Symbol("elRovingFocusGroup"),Pl=Symbol("elRovingFocusGroupItem"),oa={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"},ia=(e,f)=>e,ra=(e,f,r)=>{const u=kt(e),h=ia(u);return oa[h]},da=(e,f)=>e.map((r,u)=>e[(u+f)%e.length]),tl=e=>{const{activeElement:f}=document;for(const r of e)if(r===f||(r.focus(),f!==document.activeElement))return},ll="currentTabIdChange",sl="rovingFocusGroup.entryFocus",ua={bubbles:!1,cancelable:!0},ca=ke({name:"ElRovingFocusGroupImpl",inheritAttrs:!1,props:la,emits:[ll,"entryFocus"],setup(e,{emit:f}){var r;const u=G((r=e.currentTabId||e.defaultCurrentTabId)!=null?r:null),h=G(!1),i=G(!1),l=G(),{getItems:d}=Ve(_l,void 0),g=le(()=>[{outline:"none"},e.style]),a=b=>{f(ll,b)},k=()=>{h.value=!0},E=Ke(b=>{var V;(V=e.onMousedown)==null||V.call(e,b)},()=>{i.value=!0}),A=Ke(b=>{var V;(V=e.onFocus)==null||V.call(e,b)},b=>{const V=!s(i),{target:M,currentTarget:I}=b;if(M===I&&V&&!s(h)){const D=new Event(sl,ua);if(I?.dispatchEvent(D),!D.defaultPrevented){const _=d().filter(P=>P.focusable),U=_.find(P=>P.active),oe=_.find(P=>P.id===s(u)),x=[U,oe,..._].filter(Boolean).map(P=>P.ref);tl(x)}}i.value=!1}),m=Ke(b=>{var V;(V=e.onBlur)==null||V.call(e,b)},()=>{h.value=!1}),t=(...b)=>{f("entryFocus",...b)},T=b=>{const V=ra(b);if(V){b.preventDefault();let I=d().filter(D=>D.focusable).map(D=>D.ref);switch(V){case"last":{I.reverse();break}case"prev":case"next":{V==="prev"&&I.reverse();const D=I.indexOf(b.currentTarget);I=e.loop?da(I,D+1):I.slice(D+1);break}}zt(()=>{tl(I)})}};Ze(Ht,{currentTabbedId:tn(u),loop:rt(e,"loop"),tabIndex:le(()=>s(h)?-1:0),rovingFocusGroupRef:l,rovingFocusGroupRootStyle:g,orientation:rt(e,"orientation"),dir:rt(e,"dir"),onItemFocus:a,onItemShiftTab:k,onBlur:m,onFocus:A,onMousedown:E,onKeydown:T}),Ne(()=>e.currentTabId,b=>{u.value=b??null}),gt(l,sl,t)}});function fa(e,f,r,u,h,i){return xe(e.$slots,"default")}var pa=Ue(ca,[["render",fa],["__file","/home/runner/work/element-plus/element-plus/packages/components/roving-focus-group/src/roving-focus-group-impl.vue"]]);const va=ke({name:"ElRovingFocusGroup",components:{ElFocusGroupCollection:sa,ElRovingFocusGroupImpl:pa}});function ma(e,f,r,u,h,i){const l=Oe("el-roving-focus-group-impl"),d=Oe("el-focus-group-collection");return v(),te(d,null,{default:c(()=>[n(l,ln(sn(e.$attrs)),{default:c(()=>[xe(e.$slots,"default")]),_:3},16)]),_:3})}var ga=Ue(va,[["render",ma],["__file","/home/runner/work/element-plus/element-plus/packages/components/roving-focus-group/src/roving-focus-group.vue"]]);const ya=et({trigger:{...Bt.trigger,type:Re([String,Array])},triggerKeys:{type:Re(Array),default:()=>[Ye.enter,Ye.numpadEnter,Ye.space,Ye.down]},virtualTriggering:Bt.virtualTriggering,virtualRef:Bt.virtualRef,effect:{...it.effect,default:"light"},type:{type:Re(String)},placement:{type:Re(String),default:"bottom"},popperOptions:{type:Re(Object),default:()=>({})},id:String,size:{type:String,default:""},splitButton:Boolean,hideOnClick:{type:Boolean,default:!0},loop:{type:Boolean,default:!0},showArrow:{type:Boolean,default:!0},showTimeout:{type:Number,default:150},hideTimeout:{type:Number,default:150},tabindex:{type:Re([Number,String]),default:0},maxHeight:{type:Re([Number,String]),default:""},popperClass:it.popperClass,popperStyle:it.popperStyle,disabled:Boolean,role:{type:String,values:nn,default:"menu"},buttonProps:{type:Re(Object)},teleported:it.teleported,appendTo:it.appendTo,persistent:{type:Boolean,default:!0}}),Tl=et({command:{type:[Object,String,Number],default:()=>({})},disabled:Boolean,divided:Boolean,textValue:String,icon:{type:st}}),ha=et({onKeydown:{type:Re(Function)}}),xt=Symbol("elDropdown"),Bl="elDropdown",{ButtonGroup:ba}=ze,wa=ke({name:"ElDropdown",components:{ElButton:ze,ElButtonGroup:ba,ElScrollbar:dn,ElTooltip:rn,ElRovingFocusGroup:ga,ElOnlyChild:on,ElIcon:Be,ArrowDown:ul},props:ya,emits:["visible-change","click","command"],setup(e,{emit:f}){const r=pl(),u=tt("dropdown"),{t:h}=dl(),i=G(),l=G(),d=G(),g=G(),a=G(null),k=G(null),E=G(!1),A=le(()=>({maxHeight:Rt(e.maxHeight)})),m=le(()=>[u.m(D.value)]),t=le(()=>un(e.trigger)),T=fl().value,b=le(()=>e.id||T);function V(){var y;(y=d.value)==null||y.onClose(void 0,0)}function M(){var y;(y=d.value)==null||y.onClose()}function I(){var y;(y=d.value)==null||y.onOpen()}const D=cl();function _(...y){f("command",...y)}function U(){}function oe(){const y=s(g);t.value.includes("hover")&&y?.focus({preventScroll:!0}),k.value=null}function R(y){k.value=y}function x(){f("visible-change",!0)}function P(y){var J;E.value=y?.type==="keydown",(J=g.value)==null||J.focus()}function w(){f("visible-change",!1)}return Ze(xt,{contentRef:g,role:le(()=>e.role),triggerId:b,isUsingKeyboard:E,onItemEnter:U,onItemLeave:oe,handleClose:M}),Ze(Bl,{instance:r,dropdownSize:D,handleClick:V,commandHandler:_,trigger:rt(e,"trigger"),hideOnClick:rt(e,"hideOnClick")}),{t:h,ns:u,scrollbar:a,wrapStyle:A,dropdownTriggerKls:m,dropdownSize:D,triggerId:b,currentTabId:k,handleCurrentTabIdChange:R,handlerMainButtonClick:y=>{f("click",y)},handleClose:M,handleOpen:I,handleBeforeShowTooltip:x,handleShowTooltip:P,handleBeforeHideTooltip:w,popperRef:d,contentRef:g,triggeringElementRef:i,referenceElementRef:l}}});function $a(e,f,r,u,h,i){var l;const d=Oe("el-roving-focus-group"),g=Oe("el-scrollbar"),a=Oe("el-only-child"),k=Oe("el-tooltip"),E=Oe("el-button"),A=Oe("arrow-down"),m=Oe("el-icon"),t=Oe("el-button-group");return v(),B("div",{class:ie([e.ns.b(),e.ns.is("disabled",e.disabled)])},[n(k,{ref:"popperRef",role:e.role,effect:e.effect,"fallback-placements":["bottom","top"],"popper-options":e.popperOptions,"gpu-acceleration":!1,placement:e.placement,"popper-class":[e.ns.e("popper"),e.popperClass],"popper-style":e.popperStyle,trigger:e.trigger,"trigger-keys":e.triggerKeys,"trigger-target-el":e.contentRef,"show-arrow":e.showArrow,"show-after":e.trigger==="hover"?e.showTimeout:0,"hide-after":e.trigger==="hover"?e.hideTimeout:0,"virtual-ref":(l=e.virtualRef)!=null?l:e.triggeringElementRef,"virtual-triggering":e.virtualTriggering||e.splitButton,disabled:e.disabled,transition:`${e.ns.namespace.value}-zoom-in-top`,teleported:e.teleported,"append-to":e.appendTo,pure:"","focus-on-target":"",persistent:e.persistent,onBeforeShow:e.handleBeforeShowTooltip,onShow:e.handleShowTooltip,onBeforeHide:e.handleBeforeHideTooltip},an({content:c(()=>[n(g,{ref:"scrollbar","wrap-style":e.wrapStyle,tag:"div","view-class":e.ns.e("list")},{default:c(()=>[n(d,{loop:e.loop,"current-tab-id":e.currentTabId,orientation:"horizontal",onCurrentTabIdChange:e.handleCurrentTabIdChange},{default:c(()=>[xe(e.$slots,"dropdown")]),_:3},8,["loop","current-tab-id","onCurrentTabIdChange"])]),_:3},8,["wrap-style","view-class"])]),_:2},[e.splitButton?void 0:{name:"default",fn:c(()=>[n(a,{id:e.triggerId,ref:"triggeringElementRef",role:"button",tabindex:e.tabindex},{default:c(()=>[xe(e.$slots,"default")]),_:3},8,["id","tabindex"])]),key:"0"}]),1032,["role","effect","popper-options","placement","popper-class","popper-style","trigger","trigger-keys","trigger-target-el","show-arrow","show-after","hide-after","virtual-ref","virtual-triggering","disabled","transition","teleported","append-to","persistent","onBeforeShow","onShow","onBeforeHide"]),e.splitButton?(v(),te(t,{key:0},{default:c(()=>[n(E,Le({ref:"referenceElementRef"},e.buttonProps,{size:e.dropdownSize,type:e.type,disabled:e.disabled,tabindex:e.tabindex,onClick:e.handlerMainButtonClick}),{default:c(()=>[xe(e.$slots,"default")]),_:3},16,["size","type","disabled","tabindex","onClick"]),n(E,Le({id:e.triggerId,ref:"triggeringElementRef"},e.buttonProps,{role:"button",size:e.dropdownSize,type:e.type,class:e.ns.e("caret-button"),disabled:e.disabled,tabindex:e.tabindex,"aria-label":e.t("el.dropdown.toggleDropdown")}),{default:c(()=>[n(m,{class:ie(e.ns.e("icon"))},{default:c(()=>[n(A)]),_:1},8,["class"])]),_:1},16,["id","size","type","class","disabled","tabindex","aria-label"])]),_:3})):Q("v-if",!0)],2)}var Ca=Ue(wa,[["render",$a],["__file","/home/runner/work/element-plus/element-plus/packages/components/dropdown/src/dropdown.vue"]]);const ka=ke({components:{ElRovingFocusCollectionItem:na},props:{focusable:{type:Boolean,default:!0},active:Boolean},emits:["mousedown","focus","keydown"],setup(e,{emit:f}){const{currentTabbedId:r,onItemFocus:u,onItemShiftTab:h,onKeydown:i}=Ve(Ht,void 0),l=fl(),d=G(),g=Ke(A=>{f("mousedown",A)},A=>{e.focusable?u(s(l)):A.preventDefault()}),a=Ke(A=>{f("focus",A)},()=>{u(s(l))}),k=Ke(A=>{f("keydown",A)},A=>{const{shiftKey:m,target:t,currentTarget:T}=A;if(kt(A)===Ye.tab&&m){h();return}t===T&&i(A)}),E=le(()=>r.value===s(l));return Ze(Pl,{rovingFocusGroupItemRef:d,tabIndex:le(()=>s(E)?0:-1),handleMousedown:g,handleFocus:a,handleKeydown:k}),{id:l,handleKeydown:k,handleFocus:a,handleMousedown:g}}});function Da(e,f,r,u,h,i){const l=Oe("el-roving-focus-collection-item");return v(),te(l,{id:e.id,focusable:e.focusable,active:e.active},{default:c(()=>[xe(e.$slots,"default")]),_:3},8,["id","focusable","active"])}var xa=Ue(ka,[["render",Da],["__file","/home/runner/work/element-plus/element-plus/packages/components/roving-focus-group/src/roving-focus-item.vue"]]);const Fa=ke({name:"DropdownItemImpl",components:{ElIcon:Be},props:Tl,emits:["pointermove","pointerleave","click","clickimpl"],setup(e,{emit:f}){const r=tt("dropdown"),{role:u}=Ve(xt,void 0),{collectionItemRef:h}=Ve(aa,void 0),{rovingFocusGroupItemRef:i,tabIndex:l,handleFocus:d,handleKeydown:g,handleMousedown:a}=Ve(Pl,void 0),k=kl(h,i),E=le(()=>u.value==="menu"?"menuitem":u.value==="navigation"?"link":"button"),A=Ke(m=>{const t=kt(m);if([Ye.enter,Ye.numpadEnter,Ye.space].includes(t))return m.preventDefault(),m.stopImmediatePropagation(),f("clickimpl",m),!0},g);return{ns:r,itemRef:k,dataset:{[Sl]:""},role:E,tabIndex:l,handleFocus:d,handleKeydown:A,handleMousedown:a}}}),Sa=["aria-disabled","tabindex","role"];function _a(e,f,r,u,h,i){const l=Oe("el-icon");return v(),B(De,null,[e.divided?(v(),B("li",{key:0,role:"separator",class:ie(e.ns.bem("menu","item","divided"))},null,2)):Q("v-if",!0),o("li",Le({ref:e.itemRef},{...e.dataset,...e.$attrs},{"aria-disabled":e.disabled,class:[e.ns.be("menu","item"),e.ns.is("disabled",e.disabled)],tabindex:e.tabIndex,role:e.role,onClick:f[0]||(f[0]=d=>e.$emit("clickimpl",d)),onFocus:f[1]||(f[1]=(...d)=>e.handleFocus&&e.handleFocus(...d)),onKeydown:f[2]||(f[2]=ge((...d)=>e.handleKeydown&&e.handleKeydown(...d),["self"])),onMousedown:f[3]||(f[3]=(...d)=>e.handleMousedown&&e.handleMousedown(...d)),onPointermove:f[4]||(f[4]=d=>e.$emit("pointermove",d)),onPointerleave:f[5]||(f[5]=d=>e.$emit("pointerleave",d))}),[e.icon?(v(),te(l,{key:0},{default:c(()=>[(v(),te(qe(e.icon)))]),_:1})):Q("v-if",!0),xe(e.$slots,"default")],16,Sa)],64)}var Pa=Ue(Fa,[["render",_a],["__file","/home/runner/work/element-plus/element-plus/packages/components/dropdown/src/dropdown-item-impl.vue"]]);const El=()=>{const e=Ve(Bl,{}),f=le(()=>e?.dropdownSize);return{elDropdown:e,_elDropdownSize:f}},Ta=ke({name:"ElDropdownItem",components:{ElRovingFocusItem:xa,ElDropdownItemImpl:Pa},inheritAttrs:!1,props:Tl,emits:["pointermove","pointerleave","click"],setup(e,{emit:f,attrs:r}){const{elDropdown:u}=El(),h=pl(),{onItemEnter:i,onItemLeave:l}=Ve(xt,void 0),d=Ke(E=>(f("pointermove",E),E.defaultPrevented),Qt(E=>{if(e.disabled){l(E);return}const A=E.currentTarget;A===document.activeElement||A.contains(document.activeElement)||(i(E),E.defaultPrevented||A?.focus({preventScroll:!0}))})),g=Ke(E=>(f("pointerleave",E),E.defaultPrevented),Qt(l)),a=Ke(E=>{if(!e.disabled)return f("click",E),E.type!=="keydown"&&E.defaultPrevented},E=>{var A,m,t;if(e.disabled){E.stopImmediatePropagation();return}(A=u?.hideOnClick)!=null&&A.value&&((m=u.handleClick)==null||m.call(u)),(t=u.commandHandler)==null||t.call(u,e.command,h,E)}),k=le(()=>({...e,...r}));return{handleClick:a,handlePointerMove:d,handlePointerLeave:g,propsAndAttrs:k}}});function Ba(e,f,r,u,h,i){const l=Oe("el-dropdown-item-impl"),d=Oe("el-roving-focus-item");return v(),te(d,{focusable:!e.disabled},{default:c(()=>[n(l,Le(e.propsAndAttrs,{onPointerleave:e.handlePointerLeave,onPointermove:e.handlePointerMove,onClickimpl:e.handleClick}),{default:c(()=>[xe(e.$slots,"default")]),_:3},16,["onPointerleave","onPointermove","onClickimpl"])]),_:3},8,["focusable"])}var Al=Ue(Ta,[["render",Ba],["__file","/home/runner/work/element-plus/element-plus/packages/components/dropdown/src/dropdown-item.vue"]]);const Ea=ke({name:"ElDropdownMenu",props:ha,setup(e){const f=tt("dropdown"),{_elDropdownSize:r}=El(),u=r.value,{contentRef:h,role:i,triggerId:l,isUsingKeyboard:d,handleClose:g}=Ve(xt,void 0),{rovingFocusGroupRef:a,rovingFocusGroupRootStyle:k,onBlur:E,onFocus:A,onKeydown:m,onMousedown:t}=Ve(Ht,void 0),{collectionRef:T}=Ve(_l,void 0),b=le(()=>[f.b("menu"),f.bm("menu",u?.value)]),V=kl(h,a,T),M=Ke(D=>{var _;(_=e.onKeydown)==null||_.call(e,D)},D=>{const{currentTarget:_,target:U}=D,oe=kt(D);if(_.contains(U),Ye.tab===oe)return g();m(D)});function I(D){d.value&&A(D)}return{size:u,rovingFocusGroupRootStyle:k,dropdownKls:b,role:i,triggerId:l,dropdownListWrapperRef:V,handleKeydown:M,onBlur:E,handleFocus:I,onMousedown:t}}}),Aa=["role","aria-labelledby"];function Ma(e,f,r,u,h,i){return v(),B("ul",{ref:e.dropdownListWrapperRef,class:ie(e.dropdownKls),style:$t(e.rovingFocusGroupRootStyle),tabindex:-1,role:e.role,"aria-labelledby":e.triggerId,onFocusin:f[0]||(f[0]=(...l)=>e.handleFocus&&e.handleFocus(...l)),onFocusout:f[1]||(f[1]=(...l)=>e.onBlur&&e.onBlur(...l)),onKeydown:f[2]||(f[2]=ge((...l)=>e.handleKeydown&&e.handleKeydown(...l),["self"])),onMousedown:f[3]||(f[3]=ge((...l)=>e.onMousedown&&e.onMousedown(...l),["self"]))},[xe(e.$slots,"default")],46,Aa)}var Ml=Ue(Ea,[["render",Ma],["__file","/home/runner/work/element-plus/element-plus/packages/components/dropdown/src/dropdown-menu.vue"]]);const Na=Ct(Ca,{DropdownItem:Al,DropdownMenu:Ml}),La=Ut(Al),Oa=Ut(Ml),Ia=et({modelValue:{type:[Boolean,String,Number],default:!1},disabled:{type:Boolean,default:void 0},loading:Boolean,size:{type:String,validator:xn},width:{type:[String,Number],default:""},inlinePrompt:Boolean,inactiveActionIcon:{type:st},activeActionIcon:{type:st},activeIcon:{type:st},inactiveIcon:{type:st},activeText:{type:String,default:""},inactiveText:{type:String,default:""},activeValue:{type:[Boolean,String,Number],default:!0},inactiveValue:{type:[Boolean,String,Number],default:!1},name:{type:String,default:""},validateEvent:{type:Boolean,default:!0},beforeChange:{type:Re(Function)},id:String,tabindex:{type:[String,Number]},...cn(["ariaLabel"])}),Ra={[Ot]:e=>yt(e)||Et(e)||At(e),[Lt]:e=>yt(e)||Et(e)||At(e),[Nt]:e=>yt(e)||Et(e)||At(e)},za=["id","aria-checked","aria-disabled","aria-label","name","true-value","false-value","disabled","tabindex"],Ua=["aria-hidden"],Va={key:1},Ka={key:1},Ga=["aria-hidden"],nl="ElSwitch",ja=ke({name:nl,__name:"switch",props:Ia,emits:Ra,setup(e,{expose:f,emit:r}){const u=e,h=r,{formItem:i}=fn(),l=cl(),d=tt("switch"),{inputId:g}=pn(u,{formItemContext:i}),a=vn(le(()=>{if(u.loading)return!0})),k=G(u.modelValue!==!1),E=mn(),A=le(()=>[d.b(),d.m(l.value),d.is("disabled",a.value),d.is("checked",V.value)]),m=le(()=>[d.e("label"),d.em("label","left"),d.is("active",!V.value)]),t=le(()=>[d.e("label"),d.em("label","right"),d.is("active",V.value)]),T=le(()=>({width:Rt(u.width)}));Ne(()=>u.modelValue,()=>{k.value=!0});const b=le(()=>k.value?u.modelValue:!1),V=le(()=>b.value===u.activeValue);[u.activeValue,u.inactiveValue].includes(b.value)||(h(Ot,u.inactiveValue),h(Lt,u.inactiveValue),h(Nt,u.inactiveValue)),Ne(V,_=>{var U;E.value.checked=_,u.validateEvent&&((U=i?.validate)==null||U.call(i,"change").catch(oe=>yn()))});const M=()=>{const _=V.value?u.inactiveValue:u.activeValue;h(Ot,_),h(Lt,_),h(Nt,_),zt(()=>{E.value.checked=V.value})},I=()=>{if(a.value)return;const{beforeChange:_}=u;if(!_){M();return}const U=_();[Zt(U),yt(U)].includes(!0)||gn(nl,"beforeChange must return type `Promise<boolean>` or `boolean`"),Zt(U)?U.then(R=>{R&&M()}).catch(R=>{}):U&&M()},D=()=>{var _,U;(U=(_=E.value)==null?void 0:_.focus)==null||U.call(_)};return nt(()=>{E.value.checked=V.value}),f({focus:D,checked:V}),(_,U)=>(v(),B("div",{class:ie(A.value),onClick:ge(I,["prevent"])},[o("input",{id:s(g),ref_key:"input",ref:E,class:ie(s(d).e("input")),type:"checkbox",role:"switch","aria-checked":V.value,"aria-disabled":s(a),"aria-label":_.ariaLabel,name:_.name,"true-value":_.activeValue,"false-value":_.inactiveValue,disabled:s(a),tabindex:_.tabindex,onChange:M,onKeydown:It(I,["enter"])},null,42,za),!_.inlinePrompt&&(_.inactiveIcon||_.inactiveText||_.$slots.inactive)?(v(),B("span",{key:0,class:ie(m.value)},[xe(_.$slots,"inactive",{},()=>[_.inactiveIcon?(v(),te(s(Be),{key:0},{default:c(()=>[(v(),te(qe(_.inactiveIcon)))]),_:1})):Q("v-if",!0),!_.inactiveIcon&&_.inactiveText?(v(),B("span",{key:1,"aria-hidden":V.value},j(_.inactiveText),9,Ua)):Q("v-if",!0)])],2)):Q("v-if",!0),o("span",{class:ie(s(d).e("core")),style:$t(T.value)},[_.inlinePrompt?(v(),B("div",{key:0,class:ie(s(d).e("inner"))},[V.value?(v(),B("div",{key:1,class:ie(s(d).e("inner-wrapper"))},[xe(_.$slots,"active",{},()=>[_.activeIcon?(v(),te(s(Be),{key:0},{default:c(()=>[(v(),te(qe(_.activeIcon)))]),_:1})):Q("v-if",!0),!_.activeIcon&&_.activeText?(v(),B("span",Ka,j(_.activeText),1)):Q("v-if",!0)])],2)):(v(),B("div",{key:0,class:ie(s(d).e("inner-wrapper"))},[xe(_.$slots,"inactive",{},()=>[_.inactiveIcon?(v(),te(s(Be),{key:0},{default:c(()=>[(v(),te(qe(_.inactiveIcon)))]),_:1})):Q("v-if",!0),!_.inactiveIcon&&_.inactiveText?(v(),B("span",Va,j(_.inactiveText),1)):Q("v-if",!0)])],2))],2)):Q("v-if",!0),o("div",{class:ie(s(d).e("action"))},[_.loading?(v(),te(s(Be),{key:0,class:ie(s(d).is("loading"))},{default:c(()=>[n(s(Qe))]),_:1},8,["class"])):V.value?xe(_.$slots,"active-action",{key:1},()=>[_.activeActionIcon?(v(),te(s(Be),{key:0},{default:c(()=>[(v(),te(qe(_.activeActionIcon)))]),_:1})):Q("v-if",!0)]):V.value?Q("v-if",!0):xe(_.$slots,"inactive-action",{key:2},()=>[_.inactiveActionIcon?(v(),te(s(Be),{key:0},{default:c(()=>[(v(),te(qe(_.inactiveActionIcon)))]),_:1})):Q("v-if",!0)])],2)],6),!_.inlinePrompt&&(_.activeIcon||_.activeText||_.$slots.active)?(v(),B("span",{key:1,class:ie(t.value)},[xe(_.$slots,"active",{},()=>[_.activeIcon?(v(),te(s(Be),{key:0},{default:c(()=>[(v(),te(qe(_.activeIcon)))]),_:1})):Q("v-if",!0),!_.activeIcon&&_.activeText?(v(),B("span",{key:1,"aria-hidden":!V.value},j(_.activeText),9,Ga)):Q("v-if",!0)])],2)):Q("v-if",!0)],2))}});var Wa=Ue(ja,[["__file","/home/runner/work/element-plus/element-plus/packages/components/switch/src/switch.vue"]]);const Nl=Ct(Wa),Ha="timeline",Ya=ke({name:"ElTimeline",props:{reverse:Boolean},setup(e,{slots:f}){const r=tt("timeline");return Ze(Ha,f),()=>{var u,h;const i=hn((h=(u=f.default)==null?void 0:u.call(f))!=null?h:[]).filter(l=>{var d;return((d=l?.type)==null?void 0:d.name)==="ElTimelineItem"});return bn("ul",{class:[r.b()]},e.reverse?i.reverse():i)}}}),Ja=et({timestamp:{type:String,default:""},hideTimestamp:Boolean,center:Boolean,placement:{type:String,values:["top","bottom"],default:"bottom"},type:{type:String,values:["primary","success","warning","danger","info"],default:""},color:{type:String,default:""},size:{type:String,values:["normal","large"],default:"normal"},icon:{type:st},hollow:Boolean}),qa=ke({name:"ElTimelineItem",__name:"timeline-item",props:Ja,setup(e){const f=e,r=tt("timeline-item"),u=le(()=>[r.e("node"),r.em("node",f.size||""),r.em("node",f.type||""),r.is("hollow",f.hollow)]);return(h,i)=>(v(),B("li",{class:ie([s(r).b(),{[s(r).e("center")]:h.center}])},[o("div",{class:ie(s(r).e("tail"))},null,2),h.$slots.dot?Q("v-if",!0):(v(),B("div",{key:0,class:ie(u.value),style:$t({backgroundColor:h.color})},[h.icon?(v(),te(s(Be),{key:0,class:ie(s(r).e("icon"))},{default:c(()=>[(v(),te(qe(h.icon)))]),_:1},8,["class"])):Q("v-if",!0)],6)),h.$slots.dot?(v(),B("div",{key:1,class:ie(s(r).e("dot"))},[xe(h.$slots,"dot")],2)):Q("v-if",!0),o("div",{class:ie(s(r).e("wrapper"))},[!h.hideTimestamp&&h.placement==="top"?(v(),B("div",{key:0,class:ie([s(r).e("timestamp"),s(r).is("top")])},j(h.timestamp),3)):Q("v-if",!0),o("div",{class:ie(s(r).e("content"))},[xe(h.$slots,"default")],2),!h.hideTimestamp&&h.placement==="bottom"?(v(),B("div",{key:1,class:ie([s(r).e("timestamp"),s(r).is("bottom")])},j(h.timestamp),3)):Q("v-if",!0)],2)],2))}});var Ll=Ue(qa,[["__file","/home/runner/work/element-plus/element-plus/packages/components/timeline/src/timeline-item.vue"]]);const Xa=Ct(Ya,{TimelineItem:Ll}),Qa=Ut(Ll);function lt(e,f,r){if(e==="*"||!e||typeof e!="string")return null;const u=new Set,h=String(e).split(",");for(const i of h){const l=i.trim();if(l.includes("/")){const[d,g]=l.split("/"),a=parseInt(g,10);if(d==="*")for(let k=f;k<=r;k+=a)u.add(k);else if(d.includes("-")){const[k,E]=d.split("-").map(A=>parseInt(A,10));for(let A=k;A<=E;A+=a)u.add(A)}}else if(l.includes("-")){const[d,g]=l.split("-").map(a=>parseInt(a,10));for(let a=d;a<=g;a++)u.add(a)}else{const d=parseInt(l,10);!isNaN(d)&&d>=f&&d<=r&&u.add(d)}}return u.size>0?Array.from(u).sort((i,l)=>i-l):null}function Yt(e,f=3){try{if(!e||typeof e!="string")throw new Error("Cron 表达式必须是字符串类型");const r=String(e).trim().split(/\s+/);if(r.length!==6)throw new Error("Cron 表达式必须包含6个字段：秒 分 时 日 月 周");const[u,h,i,l,d,g]=r,a=lt(u,0,59),k=lt(h,0,59),E=lt(i,0,23),A=lt(l,1,31),m=lt(d,1,12);let t=lt(g,0,7);t&&t.includes(7)&&(t=t.filter(I=>I!==7),t.includes(0)||t.push(0),t.sort((I,D)=>I-D));const T=[],b=new Date;b.setMilliseconds(0),a&&!a.includes(b.getSeconds())&&(b.setSeconds(0),b.setMinutes(b.getMinutes()+1));let V=0;const M=1e4;for(;T.length<f&&V<M;){V++;const I=b.getMonth()+1;if(m&&!m.includes(I)){let P=null;for(const w of m)if(w>I){P=w;break}P===null?(P=m[0],b.setFullYear(b.getFullYear()+1,P-1,1),b.setHours(0,0,a?a[0]:0)):(b.setMonth(P-1,1),b.setHours(0,0,a?a[0]:0));continue}const D=b.getDate(),_=b.getDay();let U=!0;if(l!=="*"&&g!=="*"?U=!!(A&&A.includes(D))||!!(t&&t.includes(_)):l!=="*"?U=A?A.includes(D):!1:g!=="*"&&(U=t?t.includes(_):!1),!U){b.setDate(b.getDate()+1),b.setHours(0,0,a?a[0]:0);continue}const oe=b.getHours();if(E&&!E.includes(oe)){let P=null;for(const w of E)if(w>oe){P=w;break}P===null?(b.setDate(b.getDate()+1),b.setHours(E[0],0,a?a[0]:0)):b.setHours(P,0,a?a[0]:0);continue}const R=b.getMinutes();if(k&&!k.includes(R)){let P=null;for(const w of k)if(w>R){P=w;break}if(P===null){let w=null;for(const O of E||[oe])if(O>oe){w=O;break}w===null?(b.setDate(b.getDate()+1),b.setHours(E?E[0]:0,k[0],a?a[0]:0)):b.setHours(w,k[0],a?a[0]:0)}else b.setMinutes(P,a?a[0]:0);continue}const x=b.getSeconds();if(a&&!a.includes(x)){let P=null;for(const w of a)if(w>x){P=w;break}P===null?(b.setMinutes(b.getMinutes()+1),b.setSeconds(a[0])):b.setSeconds(P);continue}if(b>new Date){const P=b.getFullYear()+"-"+String(b.getMonth()+1).padStart(2,"0")+"-"+String(b.getDate()).padStart(2,"0")+" "+String(b.getHours()).padStart(2,"0")+":"+String(b.getMinutes()).padStart(2,"0")+":"+String(b.getSeconds()).padStart(2,"0");T.push(P)}a&&a.length>0&&b.setSeconds(a[0]),b.setMinutes(b.getMinutes()+1)}return T.slice(0,f)}catch(r){throw console.error("计算 Cron 执行时间失败:",r),r}}function Za(e){const f=e.second==="custom"?e.secondCustom||"*":e.second||"*",r=e.minute==="custom"?e.minuteCustom||"*":e.minute||"*",u=e.hour==="custom"?e.hourCustom||"*":e.hour||"*",h=e.day==="custom"?e.dayCustom||"*":e.day||"*",i=e.month==="custom"?e.monthCustom||"*":e.month||"*",l=e.weekday==="custom"?e.weekdayCustom||"*":e.weekday||"*";return`${f} ${r} ${u} ${h} ${i} ${l}`}function eo(){return`pl_${Date.now()}_${Math.random().toString(36).slice(2,7)}`}const to={class:"space-y-4 m-4"},lo={class:"flex items-center gap-2"},so={class:"flex items-center gap-2"},no={class:"flex items-center gap-2"},ao={class:"flex items-center gap-2"},oo={class:"flex items-center gap-2"},io={class:"flex items-center gap-2"},ro={class:"border-t pt-4"},uo={class:"flex gap-2"},co={class:"border-t pt-4"},fo={class:"space-y-2"},po={class:"flex items-center gap-2 flex-wrap"},vo=ke({__name:"CronDialog",props:{visible:{type:Boolean,default:!1},initialCron:{default:""}},emits:["update:visible","apply","preview","close"],setup(e,{emit:f}){const r=e,u=f,h=G(r.visible),i=G({second:"*",secondCustom:"",minute:"*",minuteCustom:"",hour:"*",hourCustom:"",day:"*",dayCustom:"",month:"*",monthCustom:"",weekday:"*",weekdayCustom:"",generated:""}),l=m=>{m.second="*",m.secondCustom="",m.minute="*",m.minuteCustom="",m.hour="*",m.hourCustom="",m.day="*",m.dayCustom="",m.month="*",m.monthCustom="",m.weekday="*",m.weekdayCustom="",m.generated=""},d=(m,t)=>{try{if(!m||typeof m!="string"){l(t);return}const T=String(m).trim().split(/\s+/);let b,V,M,I,D,_;if(T.length===5){const[U,oe,R,x,P]=T;U==="0"&&oe&&oe.startsWith("*/")?(b="0",V=oe,M=R||"*",I=x||"*",D=P||"*",_="*"):(V=U,M=oe,I=R,D=x,_=P,b="0")}else if(T.length===6)[b,V,M,I,D,_]=T;else{console.warn("Cron 表达式格式错误，部分数量:",T.length),l(t);return}T.length===5||T.length===6?(b==="*"?(t.second="*",t.secondCustom=""):b==="0"?(t.second="0",t.secondCustom=""):(t.second="custom",t.secondCustom=b),V==="*"?(t.minute="*",t.minuteCustom=""):V==="0"?(t.minute="0",t.minuteCustom=""):(V.startsWith("*/"),t.minute="custom",t.minuteCustom=V),M==="*"?(t.hour="*",t.hourCustom=""):M==="0"?(t.hour="0",t.hourCustom=""):(t.hour="custom",t.hourCustom=M),I==="*"?(t.day="*",t.dayCustom=""):(t.day="custom",t.dayCustom=I),D==="*"?(t.month="*",t.monthCustom=""):(t.month="custom",t.monthCustom=D),_==="*"?(t.weekday="*",t.weekdayCustom=""):_==="1-5"?(t.weekday="1-5",t.weekdayCustom=""):_==="0,6"||_==="6,0"?(t.weekday="0,6",t.weekdayCustom=""):(t.weekday="custom",t.weekdayCustom=_)):(console.warn("Cron 表达式格式错误，部分数量:",T.length),l(t))}catch(T){console.error("解析 Cron 表达式失败:",T),l(t)}},g=()=>{i.value.generated=Za(i.value)},a=()=>{h.value=!1,u("close")},k=()=>{if(!i.value.generated){z.warning("请先生成 Cron 表达式");return}u("apply",i.value.generated),a()},E=()=>{const m=i.value.generated;if(!m){z.warning("请先生成 Cron 表达式");return}try{const t=Yt(m,5);u("preview",t)}catch(t){de(t,"预览失败")}},A=m=>{try{d(m,i.value),g(),zt(()=>{i.value.generated&&(u("apply",i.value.generated),z.success("示例已应用"))})}catch(t){de(t,"应用示例失败")}};return Ne(()=>r.visible,m=>{h.value=m,m&&(r.initialCron?d(r.initialCron,i.value):l(i.value),g())},{immediate:!0}),Ne(()=>r.initialCron,m=>{r.visible&&m&&(d(m,i.value),g())}),Ne(h,m=>{m!==r.visible&&u("update:visible",m)}),(m,t)=>{const T=Mn,b=Nn,V=Vt,M=ze,I=ut;return v(),te(I,{modelValue:h.value,"onUpdate:modelValue":t[17]||(t[17]=D=>h.value=D),title:"Cron 表达式生成器",width:"700","before-close":a},{default:c(()=>[o("div",to,[o("div",null,[t[22]||(t[22]=o("div",{class:"text-sm font-medium mb-2"},"秒 (0-59)",-1)),o("div",lo,[n(b,{modelValue:i.value.second,"onUpdate:modelValue":t[0]||(t[0]=D=>i.value.second=D),onChange:g,class:"flex items-center"},{default:c(()=>[n(T,{label:"*",class:"!w-[80px]"},{default:c(()=>[...t[18]||(t[18]=[X("每秒钟",-1)])]),_:1}),n(T,{label:"0",class:"!w-[80px]"},{default:c(()=>[...t[19]||(t[19]=[X("第0秒",-1)])]),_:1}),n(T,{label:"30",class:"!w-[80px]"},{default:c(()=>[...t[20]||(t[20]=[X("第30秒",-1)])]),_:1}),n(T,{label:"custom",class:"!w-[80px]"},{default:c(()=>[...t[21]||(t[21]=[X("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),n(V,{modelValue:i.value.secondCustom,"onUpdate:modelValue":t[1]||(t[1]=D=>i.value.secondCustom=D),placeholder:"例如: 0,30 或 */10",disabled:i.value.second!=="custom",class:"!w-[200px]",onInput:g},null,8,["modelValue","disabled"])])]),o("div",null,[t[27]||(t[27]=o("div",{class:"text-sm font-medium mb-2"},"分 (0-59)",-1)),o("div",so,[n(b,{modelValue:i.value.minute,"onUpdate:modelValue":t[2]||(t[2]=D=>i.value.minute=D),onChange:g,class:"flex items-center"},{default:c(()=>[n(T,{label:"*",class:"!w-[80px]"},{default:c(()=>[...t[23]||(t[23]=[X("每分钟",-1)])]),_:1}),n(T,{label:"0",class:"!w-[80px]"},{default:c(()=>[...t[24]||(t[24]=[X("第0分",-1)])]),_:1}),n(T,{label:"30",class:"!w-[80px]"},{default:c(()=>[...t[25]||(t[25]=[X("第30分",-1)])]),_:1}),n(T,{label:"custom",class:"!w-[80px]"},{default:c(()=>[...t[26]||(t[26]=[X("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),n(V,{modelValue:i.value.minuteCustom,"onUpdate:modelValue":t[3]||(t[3]=D=>i.value.minuteCustom=D),placeholder:"例如: 0,30 或 */15",disabled:i.value.minute!=="custom",class:"!w-[200px]",onInput:g},null,8,["modelValue","disabled"])])]),o("div",null,[t[32]||(t[32]=o("div",{class:"text-sm font-medium mb-2"},"时 (0-23)",-1)),o("div",no,[n(b,{modelValue:i.value.hour,"onUpdate:modelValue":t[4]||(t[4]=D=>i.value.hour=D),onChange:g,class:"flex items-center"},{default:c(()=>[n(T,{label:"*",class:"!w-[80px]"},{default:c(()=>[...t[28]||(t[28]=[X("每小时",-1)])]),_:1}),n(T,{label:"0",class:"!w-[80px]"},{default:c(()=>[...t[29]||(t[29]=[X("0点",-1)])]),_:1}),n(T,{label:"9",class:"!w-[80px]"},{default:c(()=>[...t[30]||(t[30]=[X("9点",-1)])]),_:1}),n(T,{label:"custom",class:"!w-[80px]"},{default:c(()=>[...t[31]||(t[31]=[X("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),n(V,{modelValue:i.value.hourCustom,"onUpdate:modelValue":t[5]||(t[5]=D=>i.value.hourCustom=D),placeholder:"例如: 9,12,18 或 */2",disabled:i.value.hour!=="custom",class:"!w-[200px]",onInput:g},null,8,["modelValue","disabled"])])]),o("div",null,[t[37]||(t[37]=o("div",{class:"text-sm font-medium mb-2"},"日 (1-31)",-1)),o("div",ao,[n(b,{modelValue:i.value.day,"onUpdate:modelValue":t[6]||(t[6]=D=>i.value.day=D),onChange:g,class:"flex items-center"},{default:c(()=>[n(T,{label:"*",class:"!w-[80px]"},{default:c(()=>[...t[33]||(t[33]=[X("每天",-1)])]),_:1}),n(T,{label:"1",class:"!w-[80px]"},{default:c(()=>[...t[34]||(t[34]=[X("每月1号",-1)])]),_:1}),n(T,{label:"15",class:"!w-[80px]"},{default:c(()=>[...t[35]||(t[35]=[X("每月15号",-1)])]),_:1}),n(T,{label:"custom",class:"!w-[80px]"},{default:c(()=>[...t[36]||(t[36]=[X("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),n(V,{modelValue:i.value.dayCustom,"onUpdate:modelValue":t[7]||(t[7]=D=>i.value.dayCustom=D),placeholder:"例如: 1,15 或 */5",disabled:i.value.day!=="custom",class:"!w-[200px]",onInput:g},null,8,["modelValue","disabled"])])]),o("div",null,[t[42]||(t[42]=o("div",{class:"text-sm font-medium mb-2"},"月 (1-12)",-1)),o("div",oo,[n(b,{modelValue:i.value.month,"onUpdate:modelValue":t[8]||(t[8]=D=>i.value.month=D),onChange:g,class:"flex items-center"},{default:c(()=>[n(T,{label:"*",class:"!w-[80px]"},{default:c(()=>[...t[38]||(t[38]=[X("每月",-1)])]),_:1}),n(T,{label:"1",class:"!w-[80px]"},{default:c(()=>[...t[39]||(t[39]=[X("1月",-1)])]),_:1}),n(T,{label:"6",class:"!w-[80px]"},{default:c(()=>[...t[40]||(t[40]=[X("6月",-1)])]),_:1}),n(T,{label:"custom",class:"!w-[80px]"},{default:c(()=>[...t[41]||(t[41]=[X("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),n(V,{modelValue:i.value.monthCustom,"onUpdate:modelValue":t[9]||(t[9]=D=>i.value.monthCustom=D),placeholder:"例如: 1,6,12 或 */3",disabled:i.value.month!=="custom",class:"!w-[200px]",onInput:g},null,8,["modelValue","disabled"])])]),o("div",null,[t[47]||(t[47]=o("div",{class:"text-sm font-medium mb-2"},"周 (0-7, 0和7表示周日)",-1)),o("div",io,[n(b,{modelValue:i.value.weekday,"onUpdate:modelValue":t[10]||(t[10]=D=>i.value.weekday=D),onChange:g,class:"flex items-center"},{default:c(()=>[n(T,{label:"*",class:"!w-[80px]"},{default:c(()=>[...t[43]||(t[43]=[X("每天",-1)])]),_:1}),n(T,{label:"1-5",class:"!w-[80px]"},{default:c(()=>[...t[44]||(t[44]=[X("工作日",-1)])]),_:1}),n(T,{label:"0,6",class:"!w-[80px]"},{default:c(()=>[...t[45]||(t[45]=[X("周末",-1)])]),_:1}),n(T,{label:"custom",class:"!w-[80px]"},{default:c(()=>[...t[46]||(t[46]=[X("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),n(V,{modelValue:i.value.weekdayCustom,"onUpdate:modelValue":t[11]||(t[11]=D=>i.value.weekdayCustom=D),placeholder:"例如: 1,3,5 或 1-5",disabled:i.value.weekday!=="custom",class:"!w-[200px]",onInput:g},null,8,["modelValue","disabled"])])]),o("div",ro,[t[50]||(t[50]=o("div",{class:"text-sm font-medium mb-2"},"生成的 Cron 表达式：",-1)),n(V,{modelValue:i.value.generated,"onUpdate:modelValue":t[12]||(t[12]=D=>i.value.generated=D),readonly:"",class:"mb-2"},null,8,["modelValue"]),o("div",uo,[n(M,{type:"primary",size:"small",onClick:k},{default:c(()=>[...t[48]||(t[48]=[X(" 应用 ",-1)])]),_:1}),n(M,{type:"info",size:"small",onClick:E},{default:c(()=>[...t[49]||(t[49]=[X(" 预览执行时间 ",-1)])]),_:1})])]),o("div",co,[t[55]||(t[55]=o("div",{class:"text-sm font-medium mb-2"},"常用示例：",-1)),o("div",fo,[o("div",po,[n(M,{size:"small",onClick:t[13]||(t[13]=D=>A("0 0 * * *"))},{default:c(()=>[...t[51]||(t[51]=[X(" 每天0点 ",-1)])]),_:1}),n(M,{size:"small",onClick:t[14]||(t[14]=D=>A("0 */30 * * *"))},{default:c(()=>[...t[52]||(t[52]=[X(" 每30分钟 ",-1)])]),_:1}),n(M,{size:"small",onClick:t[15]||(t[15]=D=>A("0 0 9 * * 1-5"))},{default:c(()=>[...t[53]||(t[53]=[X(" 工作日9点 ",-1)])]),_:1}),n(M,{size:"small",onClick:t[16]||(t[16]=D=>A("0 0 0 1 * *"))},{default:c(()=>[...t[54]||(t[54]=[X(" 每月1号0点 ",-1)])]),_:1})])])])])]),_:1},8,["modelValue"])}}}),mo={key:0},go={class:"font-medium"},yo={key:1,class:"text-center text-gray-400 py-4"},ho=ke({__name:"CronPreviewDialog",props:{visible:{type:Boolean,default:!1},times:{default:()=>[]}},emits:["update:visible","close"],setup(e,{emit:f}){const r=f,u=()=>{r("update:visible",!1),r("close")};return(h,i)=>{const l=Qa,d=Xa,g=ut;return v(),te(g,{"model-value":e.visible,title:"Cron 执行时间预览",width:"500","onUpdate:modelValue":i[0]||(i[0]=a=>h.$emit("update:visible",a)),"before-close":u},{default:c(()=>[e.times&&e.times.length>0?(v(),B("div",mo,[i[1]||(i[1]=o("div",{class:"text-sm text-gray-600 mb-3"},"下5次执行时间：",-1)),n(d,null,{default:c(()=>[(v(!0),B(De,null,Ae(e.times,(a,k)=>(v(),te(l,{key:k,timestamp:a,placement:"top"},{default:c(()=>[o("div",go,"第 "+j(k+1)+" 次执行",1)]),_:2},1032,["timestamp"]))),128))]),_:1})])):(v(),B("div",yo," 无法解析 Cron 表达式，请检查格式是否正确 "))]),_:1},8,["model-value"])}}}),bo={class:"w-64 border rounded p-3 flex flex-col"},wo={class:"flex items-center justify-between mb-3"},$o={class:"flex items-center gap-1"},Co={key:0,class:"flex-1 overflow-y-auto space-y-2 pr-1"},ko=["onClick"],Do={class:"flex items-center justify-between gap-2"},xo={class:"text-sm font-medium truncate flex-1 min-w-0"},Fo={class:"flex items-center gap-2 flex-shrink-0"},So={class:"text-xs text-gray-500 whitespace-nowrap flex items-center gap-1"},_o={class:"whitespace-nowrap w-5 flex items-center justify-center"},Po={class:"flex items-center justify-center"},To={class:"text-[10px] text-blue-600 min-h-[14px] flex items-center justify-between"},Bo={key:0,class:"flex items-center gap-1"},Eo={key:1,class:"invisible"},Ao={key:2,class:"text-gray-500 flex items-center gap-1"},Mo={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},No=ke({__name:"PlaylistList",props:{playlistCollection:{},activePlaylistId:{},refreshing:{type:Boolean},autoRefreshEnabled:{type:Boolean}},emits:["select","create","refresh","toggle-auto-refresh","menu-command"],setup(e){const f=r=>{if(!r||!r.schedule||r.schedule.enabled!==1||!r.schedule.cron||typeof r.schedule.cron!="string")return null;try{const u=String(r.schedule.cron).trim();if(!u)return null;const h=Yt(u,1);return h&&h.length>0?Ln(h[0]):null}catch{return null}};return(r,u)=>{const h=Nl,i=Be,l=ze,d=La,g=Oa,a=Na;return v(),B("div",bo,[o("div",wo,[u[4]||(u[4]=o("h3",{class:"text-base font-semibold"},"播放列表",-1)),o("div",$o,[n(h,{"model-value":e.autoRefreshEnabled,"onUpdate:modelValue":u[0]||(u[0]=k=>r.$emit("toggle-auto-refresh",k)),"active-text":"","inactive-text":"","active-color":"#409eff",size:"small",title:"自动刷新",class:"mr-1"},null,8,["model-value"]),n(l,{type:"primary",size:"small",plain:"",onClick:u[1]||(u[1]=k=>r.$emit("refresh")),loading:e.refreshing,title:"刷新播放列表",class:"!w-8 !h-6 !p-0"},{default:c(()=>[e.refreshing?Q("",!0):(v(),te(i,{key:0},{default:c(()=>[n(s(We))]),_:1}))]),_:1},8,["loading"]),n(l,{type:"success",size:"small",onClick:u[2]||(u[2]=k=>r.$emit("create")),title:"新建播放列表",class:"!w-8 !h-6 !p-0"},{default:c(()=>[n(i,null,{default:c(()=>[n(s(ht))]),_:1})]),_:1})])]),e.playlistCollection&&e.playlistCollection.length>0?(v(),B("div",Co,[(v(!0),B(De,null,Ae(e.playlistCollection,k=>(v(),B("div",{key:k.id,class:ie(["border rounded px-3 py-2 cursor-pointer hover:bg-gray-50 group min-h-[60px] flex flex-col justify-between",{"border-blue-500 bg-blue-50":k.id===e.activePlaylistId}]),onClick:E=>r.$emit("select",k.id)},[o("div",Do,[o("div",xo,j(k.name),1),o("div",Fo,[o("span",So,[n(i,null,{default:c(()=>[n(s(wn),{class:"!w-3 !h-3"})]),_:1}),o("span",_o,j((k.pre_lists&&k.pre_lists[s(Xe)()]&&k.pre_lists[s(Xe)()].length||0)+(k.playlist&&k.playlist.length||0)),1)]),o("div",Po,[n(a,{trigger:"click",onCommand:E=>r.$emit("menu-command",E,k.id),onClick:u[3]||(u[3]=ge(()=>{},["stop"]))},{dropdown:c(()=>[n(g,null,{default:c(()=>[n(d,{command:"copy"},{default:c(()=>[...u[6]||(u[6]=[o("span",null,"复制",-1)])]),_:1}),e.playlistCollection.length>1?(v(),te(d,{key:0,command:"delete",divided:""},{default:c(()=>[...u[7]||(u[7]=[o("span",{class:"text-[#f56c6c]"},"删除",-1)])]),_:1})):Q("",!0)]),_:1})]),default:c(()=>[n(l,{type:"default",size:"small",plain:"",circle:"",class:"!w-5 !h-5 !min-w-5 !p-0 text-xs",title:"更多"},{default:c(()=>[...u[5]||(u[5]=[o("span",{class:"text-base leading-none mb-1"},"»",-1)])]),_:1})]),_:1},8,["onCommand"])])])]),o("div",To,[f(k)?(v(),B("span",Bo,[n(i,{class:"!w-3 !h-4"},{default:c(()=>[n(s($n))]),_:1}),X(" "+j(f(k)),1)])):(v(),B("span",Eo,"占位")),k.trigger_button?(v(),B("span",Ao,[n(i,{class:"!w-3 !h-4"},{default:c(()=>[n(s(vl))]),_:1}),X(" "+j(k.trigger_button),1)])):Q("",!0)])],10,ko))),128))])):(v(),B("div",Mo,' 暂无播放列表，请点击"新建"创建 '))])}}}),Lo={class:"border rounded p-2 mb-2"},Oo={class:"flex items-center justify-between mb-2"},Io={class:"flex items-center gap-1"},Ro={class:"flex items-center gap-1"},zo={class:"text-[10px]"},Uo={class:"flex items-center justify-between text-xs text-gray-500 mb-2 pr-2.5"},Vo={class:"flex items-center"},Ko={key:0},Go={class:"flex items-center gap-1"},jo=["draggable","onClick","onDragstart","onDrop"],Wo={class:"text-xs text-gray-500 w-8"},Ho=["title"],Yo={key:1,class:"w-full border-t border-gray-200"},Jo={key:2,class:"text-sm text-gray-400 text-center py-1"},qo=ke({__name:"PreFilesList",props:{playlistStatus:{},selectedWeekdayIndex:{},preFilesDragMode:{type:Boolean},preFilesBatchDeleteMode:{type:Boolean},selectedPreFileIndices:{},preFilesExpanded:{type:Boolean},playlistLoading:{type:Boolean},showMoreActions:{type:Boolean},audioPlayer:{}},emits:["select-weekday","open-file-browser","toggle-drag-mode","toggle-batch-delete-mode","batch-delete","clear","toggle-expand","toggle-selection","drag-start","drag-end","drag-over","drop","play-file","seek-file","move-up","move-down","replace","open-playlist-selector","delete"],setup(e){const f=e,r=()=>f.selectedWeekdayIndex!==null?f.selectedWeekdayIndex:Xe(),u=()=>{const l=f.playlistStatus;if(!l||!l.pre_lists)return[];const d=r();return!Array.isArray(l.pre_lists)||l.pre_lists.length!==7?[]:l.pre_lists[d]||[]},h=l=>{const d=f.playlistStatus;if(!d||!d.pre_lists||!Array.isArray(d.pre_lists)||d.pre_lists.length!==7)return 0;const g=d.pre_lists[l];return Array.isArray(g)?g.length:0},i=()=>{const l=u();return wt(l)};return(l,d)=>{const g=ze,a=Kt,k=Be,E=Dt;return v(),B("div",Lo,[o("div",Oo,[d[12]||(d[12]=o("div",{class:"text-xs font-semibold text-gray-600 w-39"},"前置文件（播放时优先播放）",-1)),o("div",Io,[o("div",Ro,[(v(),B(De,null,Ae(["周一","周二","周三","周四","周五","周六","周日"],(A,m)=>n(g,{key:m,type:e.selectedWeekdayIndex===m||e.selectedWeekdayIndex===null&&s(Xe)()===m?"primary":"default",size:"small",plain:"",onClick:t=>l.$emit("select-weekday",m),title:A,class:"!w-16 !h-6 !p-0 text-xs"},{default:c(()=>[X(j(A),1),o("span",zo,"["+j(h(m))+"]",1)]),_:2},1032,["type","onClick","title"])),64))])])]),o("div",Uo,[o("div",Vo,[i()>0?(v(),B("span",Ko," 总时长："+j(s(jt)(i())),1)):Q("",!0),u()&&u().length>0?(v(),B("span",{key:1,class:ie(i()>0?"ml-2":"")}," 共 "+j(u().length)+" 首， 当前: "+j(e.playlistStatus?.pre_index!==void 0&&e.playlistStatus.pre_index!==null&&e.playlistStatus.pre_index>=0?e.playlistStatus.pre_index+1:"-")+" / "+j(u().length),3)):Q("",!0),e.playlistStatus?.isPlaying&&e.playlistStatus.in_pre_files===!0?(v(),te(a,{key:2,type:"success",size:"small",class:"ml-2"},{default:c(()=>[...d[13]||(d[13]=[X(" 播放中 ",-1)])]),_:1})):Q("",!0)]),o("div",Go,[n(g,{type:"primary",size:"small",plain:"",onClick:d[0]||(d[0]=A=>l.$emit("open-file-browser")),disabled:!e.playlistStatus||e.preFilesDragMode||e.preFilesBatchDeleteMode},{default:c(()=>[...d[14]||(d[14]=[X(" + ",-1)])]),_:1},8,["disabled"]),n(g,{type:e.preFilesDragMode?"success":"default",size:"small",plain:"",class:"!w-8 !h-6",onClick:d[1]||(d[1]=A=>l.$emit("toggle-drag-mode")),disabled:!e.playlistStatus||!u()||u().length===0||e.preFilesBatchDeleteMode,title:e.preFilesDragMode?"点击退出拖拽排序模式":"点击进入拖拽排序模式"},{default:c(()=>[e.preFilesDragMode?(v(),te(k,{key:0},{default:c(()=>[n(s(bt))]),_:1})):(v(),te(k,{key:1},{default:c(()=>[n(s(Gt))]),_:1}))]),_:1},8,["type","disabled","title"]),n(g,{type:e.preFilesBatchDeleteMode?"success":"default",size:"small",plain:"",class:"!w-8 !h-6",onClick:d[2]||(d[2]=A=>l.$emit("toggle-batch-delete-mode")),disabled:!e.playlistStatus||!u()||u().length===0||e.preFilesDragMode,title:e.preFilesBatchDeleteMode?"点击退出批量删除模式":"点击进入批量删除模式"},{default:c(()=>[e.preFilesBatchDeleteMode?(v(),te(k,{key:0},{default:c(()=>[n(s(bt))]),_:1})):(v(),te(k,{key:1},{default:c(()=>[n(s(je))]),_:1}))]),_:1},8,["type","disabled","title"]),be(n(g,{type:"danger",size:"small",plain:"",class:"!w-8 !h-6",onClick:d[3]||(d[3]=A=>l.$emit("batch-delete")),disabled:e.playlistLoading||e.selectedPreFileIndices.length===0,title:`删除选中的 ${e.selectedPreFileIndices.length} 项`},{default:c(()=>[n(k,null,{default:c(()=>[n(s(je))]),_:1})]),_:1},8,["disabled","title"]),[[_e,e.preFilesBatchDeleteMode]]),be(n(g,{type:"default",size:"small",plain:"",class:"!w-8 !h-6",onClick:d[4]||(d[4]=A=>l.$emit("clear")),disabled:!e.playlistStatus||!u()||u().length===0||e.playlistLoading||e.preFilesDragMode,title:"清空列表"},{default:c(()=>[n(k,null,{default:c(()=>[n(s(je))]),_:1})]),_:1},8,["disabled"]),[[_e,e.showMoreActions&&!e.preFilesBatchDeleteMode]])])]),u()&&u().length>0?(v(),B("div",{key:0,class:ie(["overflow-y-scroll scrollbar-overlay",{"max-h-[192px]":!e.preFilesExpanded}])},[(v(!0),B(De,null,Ae(u(),(A,m)=>(v(),B("div",{key:"pre-"+m,class:ie(["flex items-center gap-2 p-1 hover:bg-gray-100 rounded",{"bg-blue-50":Number(e.playlistStatus?.pre_index)===m,"bg-blue-100":e.preFilesBatchDeleteMode&&e.selectedPreFileIndices.includes(Number(m)),"cursor-move":e.preFilesDragMode,"cursor-pointer":e.preFilesBatchDeleteMode&&!e.preFilesDragMode,"cursor-default":!e.preFilesDragMode&&!e.preFilesBatchDeleteMode,"select-none":!0}]),draggable:e.preFilesDragMode,onClick:t=>e.preFilesBatchDeleteMode&&!e.preFilesDragMode?l.$emit("toggle-selection",Number(m)):null,onDragstart:t=>l.$emit("drag-start",t,Number(m)),onDragend:d[8]||(d[8]=t=>l.$emit("drag-end",t)),onDragover:d[9]||(d[9]=ge(t=>l.$emit("drag-over",t),["prevent"])),onDragleave:d[10]||(d[10]=t=>{const T=t.currentTarget;T&&T.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")}),onDrop:ge(t=>l.$emit("drop",t,Number(m)),["prevent"])},[o("span",Wo,j(Number(m)+1),1),o("span",{class:ie(["flex-1 text-sm truncate",{"text-blue-600":Number(e.playlistStatus?.pre_index)===m}]),title:A.uri||""},j(A.uri?A.uri.split("/").pop():""),11,Ho),o("div",{class:"flex items-center gap-1 flex-shrink-0",onMousedown:d[6]||(d[6]=ge(()=>{},["stop"])),onClick:d[7]||(d[7]=ge(()=>{},["stop"]))},[be(n($l,{file:A,player:e.audioPlayer,disabled:e.playlistLoading,onPlay:t=>l.$emit("play-file",A),onSeek:(t,T)=>l.$emit("seek-file",t,T)},null,8,["file","player","disabled","onPlay","onSeek"]),[[_e,!e.preFilesBatchDeleteMode]]),be(n(E,{class:"!h-6","model-value":e.selectedPreFileIndices.includes(Number(m)),onChange:t=>l.$emit("toggle-selection",Number(m)),onClick:d[5]||(d[5]=ge(()=>{},["stop"]))},null,8,["model-value","onChange"]),[[_e,e.preFilesBatchDeleteMode]]),be(n(g,{type:"default",size:"small",plain:"",circle:"",onClick:ge(t=>l.$emit("move-up",Number(m)),["stop"]),disabled:Number(m)===0||e.playlistLoading,title:"上移"},{default:c(()=>[...d[15]||(d[15]=[X(" ↑ ",-1)])]),_:1},8,["onClick","disabled"]),[[_e,e.showMoreActions&&!e.preFilesDragMode&&!e.preFilesBatchDeleteMode]]),be(n(g,{type:"default",size:"small",plain:"",circle:"",onClick:ge(t=>l.$emit("move-down",Number(m)),["stop"]),disabled:Number(m)===u().length-1||e.playlistLoading,title:"下移"},{default:c(()=>[...d[16]||(d[16]=[X(" ↓ ",-1)])]),_:1},8,["onClick","disabled"]),[[_e,e.showMoreActions&&!e.preFilesDragMode&&!e.preFilesBatchDeleteMode]]),be(n(g,{type:"default",size:"small",plain:"",circle:"",onClick:ge(t=>l.$emit("replace",Number(m)),["stop"]),disabled:e.playlistLoading,title:"替换"},{default:c(()=>[n(k,null,{default:c(()=>[n(s(We))]),_:1})]),_:1},8,["onClick","disabled"]),[[_e,e.showMoreActions&&!e.preFilesDragMode&&!e.preFilesBatchDeleteMode]]),be(n(g,{type:"info",size:"small",plain:"",circle:"",onClick:ge(t=>l.$emit("open-playlist-selector",A),["stop"]),disabled:e.playlistLoading,title:"应用到列表"},{default:c(()=>[n(k,null,{default:c(()=>[n(s(ml))]),_:1})]),_:1},8,["onClick","disabled"]),[[_e,!e.preFilesBatchDeleteMode&&!e.preFilesDragMode]]),be(n(g,{type:"default",size:"small",plain:"",circle:"",onClick:ge(t=>l.$emit("delete",Number(m)),["stop"]),disabled:e.playlistLoading||e.preFilesDragMode,title:"删除"},{default:c(()=>[n(k,null,{default:c(()=>[n(s(gl))]),_:1})]),_:1},8,["onClick","disabled"]),[[_e,!e.preFilesBatchDeleteMode]])],32)],42,jo))),128))],2)):Q("",!0),u()&&u().length>0?(v(),B("div",Yo,[n(g,{type:"default",size:"small",plain:"",class:"!w-full !h-4 !p-0 !text-xs",onClick:d[11]||(d[11]=A=>l.$emit("toggle-expand")),title:e.preFilesExpanded?"折叠":"展开"},{default:c(()=>[e.preFilesExpanded?(v(),te(k,{key:0},{default:c(()=>[n(s(Cn))]),_:1})):(v(),te(k,{key:1},{default:c(()=>[n(s(ul))]),_:1}))]),_:1},8,["title"])])):(v(),B("div",Jo,"前置文件列表为空"))])}}}),Xo={key:0,class:"border rounded p-2"},Qo={class:"flex items-center justify-between mb-2 pr-2.5"},Zo={class:"text-xs font-semibold text-gray-600"},ei={key:0,class:"ml-2 text-gray-500"},ti={key:1,class:"ml-2 text-gray-500"},li={class:"flex items-center gap-1"},si={key:0,class:"overflow-y-scroll scrollbar-overlay"},ni=["draggable","onClick","onDragstart","onDrop"],ai={class:"text-xs text-gray-500 w-8"},oi=["title"],ii={key:1,class:"text-sm text-gray-400 text-center py-1"},ri=ke({__name:"FilesList",props:{playlistStatus:{},filesDragMode:{type:Boolean},filesBatchDeleteMode:{type:Boolean},selectedFileIndices:{},playlistLoading:{type:Boolean},showMoreActions:{type:Boolean},audioPlayer:{}},emits:["open-file-browser","toggle-drag-mode","toggle-batch-delete-mode","batch-delete","clear","toggle-selection","drag-start","drag-end","drag-over","drop","play-file","seek-file","move-up","move-down","replace","open-playlist-selector","delete"],setup(e,{emit:f}){const r=e,u=f,h={plain:!0,size:"small",class:"!w-8 !h-6"},i={type:"default",size:"small",plain:!0,circle:!0},l=le(()=>r.playlistStatus?.playlist||[]),d=le(()=>l.value.length),g=le(()=>r.playlistStatus?.current_index??-1),a=le(()=>g.value>=0?g.value+1:"-"),k=le(()=>r.playlistStatus?.isPlaying&&!r.playlistStatus.in_pre_files),E=le(()=>d.value>0),A=le(()=>E.value?wt(l.value):0),m=le(()=>r.filesBatchDeleteMode&&E.value&&!r.filesDragMode),t=le(()=>r.showMoreActions&&!r.filesDragMode&&!r.filesBatchDeleteMode),T=le(()=>r.showMoreActions&&!r.filesBatchDeleteMode),b=le(()=>!r.filesBatchDeleteMode&&!r.filesDragMode),V=le(()=>!r.playlistStatus||r.filesDragMode||r.filesBatchDeleteMode),M=le(()=>!E.value||r.filesBatchDeleteMode),I=le(()=>!E.value||r.filesDragMode),D=le(()=>r.playlistLoading||r.selectedFileIndices.length===0),_=le(()=>`删除选中的 ${r.selectedFileIndices.length} 项`),U=le(()=>!E.value||r.playlistLoading||r.filesDragMode),oe=L=>L?L.split("/").pop():"",R=L=>r.selectedFileIndices.includes(L),x=L=>L===g.value,P=L=>({"bg-blue-50":x(L),"bg-blue-100":m.value&&R(L),"cursor-move":r.filesDragMode,"cursor-pointer":m.value,"cursor-default":!r.filesDragMode&&!r.filesBatchDeleteMode}),w=le(()=>r.playlistLoading||r.filesDragMode),O=L=>{m.value&&u("toggle-selection",L)},y=(L,N)=>{u("drag-start",L,N)},J=L=>{u("drag-end",L)},me=L=>{u("drag-over",L)},F=L=>{const N=L.currentTarget;N?.classList&&N.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")},$=(L,N)=>{u("drop",L,N)},p=(L,N)=>{u("seek-file",L,N)};return(L,N)=>{const q=Kt,ae=ze,ce=Be,Ie=Dt;return e.playlistStatus?.playlist?(v(),B("div",Xo,[o("div",Qo,[o("div",Zo,[N[9]||(N[9]=X(" 正式文件（播放时记录进度） ",-1)),A.value>0?(v(),B("span",ei," 总时长："+j(s(jt)(A.value)),1)):Q("",!0),E.value?(v(),B("span",ti," 共 "+j(d.value)+" 首， 当前: "+j(a.value)+" / "+j(d.value),1)):Q("",!0),k.value?(v(),te(q,{key:2,type:"success",size:"small",class:"ml-2"},{default:c(()=>[...N[8]||(N[8]=[X(" 播放中 ",-1)])]),_:1})):Q("",!0)]),o("div",li,[n(ae,Le({type:"primary"},h,{onClick:N[0]||(N[0]=Fe=>u("open-file-browser")),disabled:V.value}),{default:c(()=>[...N[10]||(N[10]=[X(" + ",-1)])]),_:1},16,["disabled"]),n(ae,Le({type:e.filesDragMode?"success":"default"},h,{onClick:N[1]||(N[1]=Fe=>u("toggle-drag-mode")),disabled:M.value,title:e.filesDragMode?"点击退出拖拽排序模式":"点击进入拖拽排序模式"}),{default:c(()=>[e.filesDragMode?(v(),te(ce,{key:0},{default:c(()=>[n(s(bt))]),_:1})):(v(),te(ce,{key:1},{default:c(()=>[n(s(Gt))]),_:1}))]),_:1},16,["type","disabled","title"]),n(ae,Le({type:e.filesBatchDeleteMode?"success":"default"},h,{onClick:N[2]||(N[2]=Fe=>u("toggle-batch-delete-mode")),disabled:I.value,title:e.filesBatchDeleteMode?"点击退出批量删除模式":"点击进入批量删除模式"}),{default:c(()=>[e.filesBatchDeleteMode?(v(),te(ce,{key:0},{default:c(()=>[n(s(bt))]),_:1})):(v(),te(ce,{key:1},{default:c(()=>[n(s(je))]),_:1}))]),_:1},16,["type","disabled","title"]),be(n(ae,Le({type:"danger"},h,{onClick:N[3]||(N[3]=Fe=>u("batch-delete")),disabled:D.value,title:_.value}),{default:c(()=>[n(ce,null,{default:c(()=>[n(s(je))]),_:1})]),_:1},16,["disabled","title"]),[[_e,e.filesBatchDeleteMode]]),be(n(ae,Le({type:"default"},h,{onClick:N[4]||(N[4]=Fe=>u("clear")),disabled:U.value,title:"清空正式文件列表"}),{default:c(()=>[n(ce,null,{default:c(()=>[n(s(je))]),_:1})]),_:1},16,["disabled"]),[[_e,T.value]])])]),E.value?(v(),B("div",si,[(v(!0),B(De,null,Ae(l.value,(Fe,we)=>(v(),B("div",{key:Fe.uri||we,class:ie(["flex items-center gap-2 p-1 hover:bg-gray-100 rounded select-none",P(we)]),draggable:e.filesDragMode,onClick:W=>O(we),onDragstart:W=>y(W,we),onDragend:J,onDragover:ge(me,["prevent"]),onDragleave:F,onDrop:ge(W=>$(W,we),["prevent"])},[o("span",ai,j(we+1),1),o("span",{class:ie(["flex-1 text-sm truncate",{"text-blue-600":x(we)}]),title:Fe.uri||""},j(oe(Fe.uri)),11,oi),o("div",{class:"flex items-center gap-1 flex-shrink-0",onMousedown:N[6]||(N[6]=ge(()=>{},["stop"])),onClick:N[7]||(N[7]=ge(()=>{},["stop"]))},[be(n($l,{file:Fe,player:e.audioPlayer,disabled:e.playlistLoading,onPlay:W=>u("play-file",Fe),onSeek:p},null,8,["file","player","disabled","onPlay"]),[[_e,!e.filesBatchDeleteMode]]),be(n(Ie,{class:"!h-6","model-value":R(we),onChange:W=>u("toggle-selection",we),onClick:N[5]||(N[5]=ge(()=>{},["stop"]))},null,8,["model-value","onChange"]),[[_e,e.filesBatchDeleteMode]]),be(n(ae,Le({ref_for:!0},i,{onClick:ge(W=>u("move-up",we),["stop"]),disabled:we===0||e.playlistLoading,title:"上移"}),{default:c(()=>[...N[11]||(N[11]=[X(" ↑ ",-1)])]),_:1},16,["onClick","disabled"]),[[_e,t.value]]),be(n(ae,Le({ref_for:!0},i,{onClick:ge(W=>u("move-down",we),["stop"]),disabled:we===d.value-1||e.playlistLoading,title:"下移"}),{default:c(()=>[...N[12]||(N[12]=[X(" ↓ ",-1)])]),_:1},16,["onClick","disabled"]),[[_e,t.value]]),be(n(ae,Le({ref_for:!0},i,{onClick:ge(W=>u("replace",we),["stop"]),disabled:e.playlistLoading,title:"替换"}),{default:c(()=>[n(ce,null,{default:c(()=>[n(s(We))]),_:1})]),_:1},16,["onClick","disabled"]),[[_e,t.value]]),be(n(ae,{type:"info",size:"small",plain:"",circle:"",onClick:ge(W=>u("open-playlist-selector",Fe),["stop"]),disabled:e.playlistLoading,title:"应用到列表"},{default:c(()=>[n(ce,null,{default:c(()=>[n(s(ml))]),_:1})]),_:1},8,["onClick","disabled"]),[[_e,b.value]]),be(n(ae,Le({ref_for:!0},i,{onClick:ge(W=>u("delete",we),["stop"]),disabled:w.value,title:"删除"}),{default:c(()=>[n(ce,null,{default:c(()=>[n(s(gl))]),_:1})]),_:1},16,["onClick","disabled"]),[[_e,!e.filesBatchDeleteMode]])],32)],42,ni))),128))])):(v(),B("div",ii,"正式文件列表为空"))])):Q("",!0)}}}),di={class:"flex-1 border rounded p-3 flex flex-col"},ui={class:"flex items-center justify-between mb-3"},ci={class:"flex-1"},fi={key:0,class:"flex items-center gap-2 mb-1"},pi={class:"flex items-center gap-2 flex-1"},vi={class:"text-lg font-semibold truncate"},mi={key:1},gi={key:2,class:"text-sm text-gray-500"},yi={key:0,class:"mr-2"},hi={class:"flex flex-wrap gap-2"},bi={key:1},wi={key:1},$i={key:1},Ci={key:1},ki={key:0,class:"flex-1 overflow-y-scroll scrollbar-overlay"},Di={key:0,class:"text-sm text-gray-400 text-center py-8"},xi={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},Fi=ke({__name:"FileListPanel",props:{playlistStatus:{},activePlaylistId:{},editingPlaylistId:{},editingPlaylistName:{},selectedWeekdayIndex:{},preFilesDragMode:{type:Boolean},preFilesBatchDeleteMode:{type:Boolean},selectedPreFileIndices:{},preFilesExpanded:{type:Boolean},filesDragMode:{type:Boolean},filesBatchDeleteMode:{type:Boolean},selectedFileIndices:{},playlistLoading:{type:Boolean},playing:{type:Boolean},stopping:{type:Boolean},showMoreActions:{type:Boolean},audioPlayer:{}},emits:["update:editingPlaylistName","start-edit-name","save-name","cancel-edit-name","open-batch-drawer","play","play-pre","play-next","stop","clear","toggle-more-actions","select-weekday","open-file-browser-for-pre-files","toggle-pre-files-drag-mode","toggle-pre-files-batch-delete-mode","batch-delete-pre-files","clear-pre-files","toggle-pre-files-expand","toggle-pre-file-selection","pre-file-drag-start","pre-file-drag-end","pre-file-drag-over","pre-file-drop","open-file-browser","toggle-files-drag-mode","toggle-files-batch-delete-mode","batch-delete-files","clear-files","toggle-file-selection","file-drag-start","file-drag-end","file-drag-over","file-drop","play-file","seek-file","move-pre-file-up","move-pre-file-down","replace-pre-file","open-playlist-selector-for-pre-file","delete-pre-file","move-file-up","move-file-down","replace-file","open-playlist-selector-for-file","delete-file"],setup(e){const f=e,r=()=>f.selectedWeekdayIndex!==null?f.selectedWeekdayIndex:Xe(),u=()=>{const i=f.playlistStatus;if(!i||!i.pre_lists)return[];const l=r();return!Array.isArray(i.pre_lists)||i.pre_lists.length!==7?[]:i.pre_lists[l]||[]},h=()=>{const i=f.playlistStatus;if(!i)return 0;const l=u(),d=wt(l),g=i.playlist||[],a=wt(g);return d+a};return(i,l)=>{const d=Be,g=ze;return v(),B("div",di,[o("div",ui,[o("div",ci,[e.playlistStatus?(v(),B("div",fi,[o("div",pi,[o("h3",vi,j(e.playlistStatus.name),1),n(g,{type:"default",size:"small",plain:"",circle:"",onClick:l[0]||(l[0]=a=>i.$emit("start-edit-name",e.activePlaylistId)),title:"编辑名称"},{default:c(()=>[n(d,null,{default:c(()=>[n(s(yl))]),_:1})]),_:1})])])):(v(),B("div",mi,[...l[44]||(l[44]=[o("h3",{class:"text-lg font-semibold"},"播放列表文件",-1)])])),e.playlistStatus?(v(),B("div",gi,[h()>0?(v(),B("span",yi," 总时长："+j(s(jt)(h())),1)):Q("",!0),e.playlistStatus?(v(),B(De,{key:1},[(u()?.length||0)+(e.playlistStatus.playlist?.length||0)>0?(v(),B(De,{key:0},[X(" 共 "+j((u()?.length||0)+(e.playlistStatus.playlist?.length||0))+" 首， 当前: ",1),e.playlistStatus.pre_index!==void 0&&e.playlistStatus.pre_index!==null&&e.playlistStatus.pre_index>=0?(v(),B(De,{key:0},[X(j(e.playlistStatus.pre_index+1),1)],64)):e.playlistStatus.current_index!==void 0&&e.playlistStatus.current_index!==null&&e.playlistStatus.current_index>=0?(v(),B(De,{key:1},[X(j((u()?.length||0)+e.playlistStatus.current_index+1),1)],64)):(v(),B(De,{key:2},[X(" - ")],64)),X(" / "+j((u()?.length||0)+(e.playlistStatus.playlist?.length||0)),1)],64)):(v(),B(De,{key:1},[X(" 共 0 首， 当前: - / 0 ")],64))],64)):Q("",!0)])):Q("",!0)]),o("div",hi,[n(g,{type:"default",size:"small",plain:"",circle:"",onClick:l[1]||(l[1]=a=>i.$emit("open-batch-drawer")),title:"批量模式"},{default:c(()=>[n(d,null,{default:c(()=>[n(s(kn))]),_:1})]),_:1}),n(g,{type:"default",size:"small",plain:"",circle:"",onClick:l[2]||(l[2]=a=>i.$emit("play")),class:"items-center justify-center",disabled:!e.playlistStatus||!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0||!!e.playlistStatus.isPlaying,title:"播放"},{default:c(()=>[e.playing?(v(),te(d,{key:0,size:"12",class:"animate-spin"},{default:c(()=>[n(s(Qe))]),_:1})):(v(),B("span",bi,"▶"))]),_:1},8,["disabled"]),n(g,{type:"default",size:"small",plain:"",circle:"",onClick:l[3]||(l[3]=a=>i.$emit("play-pre")),disabled:!e.playlistStatus||(!u()||u().length===0)&&(!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0),title:"上一首"},{default:c(()=>[e.playing?(v(),te(d,{key:0,size:"12",class:"animate-spin"},{default:c(()=>[n(s(Qe))]),_:1})):(v(),B("span",wi,"⏮"))]),_:1},8,["disabled"]),n(g,{type:"default",size:"small",plain:"",circle:"",onClick:l[4]||(l[4]=a=>i.$emit("play-next")),disabled:!e.playlistStatus||(!u()||u().length===0)&&(!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0),title:"下一首"},{default:c(()=>[e.playing?(v(),te(d,{key:0,size:"12",class:"animate-spin"},{default:c(()=>[n(s(Qe))]),_:1})):(v(),B("span",$i,"⏭"))]),_:1},8,["disabled"]),n(g,{type:"default",size:"small",plain:"",circle:"",onClick:l[5]||(l[5]=a=>i.$emit("stop")),title:"停止"},{default:c(()=>[e.stopping?(v(),te(d,{key:0,size:"12",class:"animate-spin"},{default:c(()=>[n(s(Qe))]),_:1})):(v(),B("span",Ci,"⏹"))]),_:1}),be(n(g,{type:"default",size:"small",plain:"",circle:"",onClick:l[6]||(l[6]=a=>i.$emit("clear")),disabled:!e.playlistStatus||(!u()||u().length===0)&&(!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0)||e.playlistLoading,title:"清空列表（包括前置文件和正式文件）"},{default:c(()=>[n(d,null,{default:c(()=>[n(s(je))]),_:1})]),_:1},8,["disabled"]),[[_e,e.showMoreActions]]),n(g,{type:"default",size:"small",plain:"",circle:"",onClick:l[7]||(l[7]=a=>i.$emit("toggle-more-actions")),title:"更多"},{default:c(()=>[n(d,null,{default:c(()=>[n(s(Gt))]),_:1})]),_:1})])]),e.playlistStatus?(v(),B("div",ki,[n(qo,{"playlist-status":e.playlistStatus,"selected-weekday-index":e.selectedWeekdayIndex,"pre-files-drag-mode":e.preFilesDragMode,"pre-files-batch-delete-mode":e.preFilesBatchDeleteMode,"selected-pre-file-indices":e.selectedPreFileIndices,"pre-files-expanded":e.preFilesExpanded,"playlist-loading":e.playlistLoading,"show-more-actions":e.showMoreActions,"audio-player":e.audioPlayer,onSelectWeekday:l[8]||(l[8]=a=>i.$emit("select-weekday",a)),onOpenFileBrowser:l[9]||(l[9]=a=>i.$emit("open-file-browser-for-pre-files")),onToggleDragMode:l[10]||(l[10]=a=>i.$emit("toggle-pre-files-drag-mode")),onToggleBatchDeleteMode:l[11]||(l[11]=a=>i.$emit("toggle-pre-files-batch-delete-mode")),onBatchDelete:l[12]||(l[12]=a=>i.$emit("batch-delete-pre-files")),onClear:l[13]||(l[13]=a=>i.$emit("clear-pre-files")),onToggleExpand:l[14]||(l[14]=a=>i.$emit("toggle-pre-files-expand")),onToggleSelection:l[15]||(l[15]=a=>i.$emit("toggle-pre-file-selection",a)),onDragStart:l[16]||(l[16]=(a,k)=>i.$emit("pre-file-drag-start",a,k)),onDragEnd:l[17]||(l[17]=a=>i.$emit("pre-file-drag-end",a)),onDragOver:l[18]||(l[18]=a=>i.$emit("pre-file-drag-over",a)),onDrop:l[19]||(l[19]=(a,k)=>i.$emit("pre-file-drop",a,k)),onPlayFile:l[20]||(l[20]=a=>i.$emit("play-file",a)),onSeekFile:l[21]||(l[21]=(a,k)=>i.$emit("seek-file",a,k)),onMoveUp:l[22]||(l[22]=a=>i.$emit("move-pre-file-up",a)),onMoveDown:l[23]||(l[23]=a=>i.$emit("move-pre-file-down",a)),onReplace:l[24]||(l[24]=a=>i.$emit("replace-pre-file",a)),onOpenPlaylistSelector:l[25]||(l[25]=a=>i.$emit("open-playlist-selector-for-pre-file",a)),onDelete:l[26]||(l[26]=a=>i.$emit("delete-pre-file",a))},null,8,["playlist-status","selected-weekday-index","pre-files-drag-mode","pre-files-batch-delete-mode","selected-pre-file-indices","pre-files-expanded","playlist-loading","show-more-actions","audio-player"]),n(ri,{"playlist-status":e.playlistStatus,"files-drag-mode":e.filesDragMode,"files-batch-delete-mode":e.filesBatchDeleteMode,"selected-file-indices":e.selectedFileIndices,"playlist-loading":e.playlistLoading,"show-more-actions":e.showMoreActions,"audio-player":e.audioPlayer,onOpenFileBrowser:l[27]||(l[27]=a=>i.$emit("open-file-browser")),onToggleDragMode:l[28]||(l[28]=a=>i.$emit("toggle-files-drag-mode")),onToggleBatchDeleteMode:l[29]||(l[29]=a=>i.$emit("toggle-files-batch-delete-mode")),onBatchDelete:l[30]||(l[30]=a=>i.$emit("batch-delete-files")),onClear:l[31]||(l[31]=a=>i.$emit("clear-files")),onToggleSelection:l[32]||(l[32]=a=>i.$emit("toggle-file-selection",a)),onDragStart:l[33]||(l[33]=(a,k)=>i.$emit("file-drag-start",a,k)),onDragEnd:l[34]||(l[34]=a=>i.$emit("file-drag-end",a)),onDragOver:l[35]||(l[35]=a=>i.$emit("file-drag-over",a)),onDrop:l[36]||(l[36]=(a,k)=>i.$emit("file-drop",a,k)),onPlayFile:l[37]||(l[37]=a=>i.$emit("play-file",a)),onSeekFile:l[38]||(l[38]=(a,k)=>i.$emit("seek-file",a,k)),onMoveUp:l[39]||(l[39]=a=>i.$emit("move-file-up",a)),onMoveDown:l[40]||(l[40]=a=>i.$emit("move-file-down",a)),onReplace:l[41]||(l[41]=a=>i.$emit("replace-file",a)),onOpenPlaylistSelector:l[42]||(l[42]=a=>i.$emit("open-playlist-selector-for-file",a)),onDelete:l[43]||(l[43]=a=>i.$emit("delete-file",a))},null,8,["playlist-status","files-drag-mode","files-batch-delete-mode","selected-file-indices","playlist-loading","show-more-actions","audio-player"]),(!u()||u().length===0)&&(!e.playlistStatus?.playlist||e.playlistStatus.playlist.length===0)?(v(),B("div",Di,' 当前播放列表为空，点击"添加文件"开始构建播放列表 ')):Q("",!0)])):(v(),B("div",xi," 请先在左侧选择一个播放列表查看详情 "))])}}}),Si=["agent","dlna","bluetooth","mi"],_i=1e4,al=5,Pi=5e3,Je="默认播放列表",Ti=1440,vt=7,Bi=[...Si],Ei="dlna",Ol="active_playlist_id",mt={NONE:"",BUTTON_1:"B1",BUTTON_2:"B2",BUTTON_3:"B3"},Ai={class:"w-80 min-w-75 border rounded p-3 flex flex-col"},Mi={key:0,class:"mb-3 flex items-center gap-2 flex-wrap"},Ni={key:1,class:"flex-1 overflow-y-auto space-y-4"},Li={class:"border rounded p-3"},Oi={class:"flex items-center justify-between mb-2"},Ii={class:"space-y-2"},Ri={class:"flex items-center gap-2"},zi={class:"flex items-start gap-4"},Ui={class:"flex-1"},Vi={class:"flex-1"},Ki={key:0},Gi={class:"border rounded p-3"},ji={class:"space-y-2"},Wi={class:"text-xs text-gray-600 mb-1 flex items-center gap-2"},Hi={key:0,class:"text-xs text-gray-500"},Yi={class:"flex items-center gap-2"},Ji={class:"mt-3"},qi={class:"flex items-center justify-between mb-2"},Xi={class:"text-xs font-semibold text-gray-700"},Qi={key:0},Zi={class:"space-y-2 max-h-[200px] overflow-y-auto"},er={class:"flex-1 min-w-0"},tr={class:"text-sm font-medium truncate"},lr={class:"text-xs text-gray-500 truncate"},sr={class:"flex-shrink-0"},nr={key:0,class:"text-xs text-gray-400 text-center py-4"},ar={key:1},or={class:"space-y-2 max-h-[200px] overflow-y-auto"},ir={class:"flex-1 min-w-0"},rr={class:"text-sm font-medium truncate"},dr=["title"],ur={class:"flex-shrink-0"},cr={key:0,class:"text-xs text-gray-400 text-center py-4"},fr={key:2},pr={class:"space-y-2 max-h-[200px] overflow-y-auto"},vr={class:"flex-1 min-w-0"},mr={class:"text-sm font-medium truncate"},gr=["title"],yr={class:"flex-shrink-0"},hr={key:0,class:"text-xs text-gray-400 text-center py-4"},br={key:2,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},wr=ke({__name:"ConfigPanel",props:{playlistStatus:{},connectedDeviceList:{},dlnaDeviceList:{},miDeviceList:{},loading:{type:Boolean},dlnaScanning:{type:Boolean},miScanning:{type:Boolean},onToggleCronEnabled:{type:Function},onUpdateCron:{type:Function},onUpdateDuration:{type:Function},onUpdateTriggerButton:{type:Function},onOpenCronBuilder:{type:Function},onPreviewCron:{type:Function},onUpdateDeviceType:{type:Function},onUpdateDeviceAddress:{type:Function},onSelectBluetoothDevice:{type:Function},onSelectAgentDevice:{type:Function},onSelectMiDevice:{type:Function},onScanDlnaDevices:{type:Function},onScanMiDevices:{type:Function},onOpenScanDialog:{type:Function},onOpenDeviceList:{type:Function}},setup(e){const f=e,r=le(()=>f.playlistStatus?.device?.type||f.playlistStatus?.device_type||null),u=le(()=>f.playlistStatus?.device?.address||f.playlistStatus?.device_address||""),h=A=>le(()=>r.value===A),i=le(()=>{const A=r.value;return A==="agent"||A==="bluetooth"}),l=h("dlna"),d=h("mi"),g=le(()=>i.value?"已配对的设备":l.value?"DLNA 设备":d.value?"小米设备":"设备列表"),a=le(()=>i.value?"扫描设备":l.value?"扫描 DLNA 设备":d.value?"扫描小米设备":"扫描设备"),k=le(()=>f.dlnaScanning||f.miScanning),E=()=>{i.value?f.onOpenScanDialog():l.value?f.onScanDlnaDevices():d.value&&f.onScanMiDevices()};return(A,m)=>{const t=Be,T=ze,b=Nl,V=Vt,M=On,I=bl,D=hl,_=Wt;return v(),B("div",Ai,[m[20]||(m[20]=o("h3",{class:"text-lg font-semibold mb-3"},"配置详情",-1)),e.playlistStatus?(v(),B("div",Mi,[n(T,{type:"default",onClick:e.onOpenDeviceList,title:"打开设备列表"},{default:c(()=>[n(t,null,{default:c(()=>[n(s(Dn))]),_:1}),m[4]||(m[4]=o("span",{class:"ml-1"},"设备列表",-1))]),_:1},8,["onClick"])])):Q("",!0),e.playlistStatus?(v(),B("div",Ni,[o("div",Li,[o("div",Oi,[m[5]||(m[5]=o("h4",{class:"text-sm font-semibold"},"定时任务 (Cron)",-1)),n(b,{"model-value":e.playlistStatus.schedule?.enabled===1,onChange:m[0]||(m[0]=U=>e.onToggleCronEnabled(U)),"active-text":"开启","inactive-text":"关闭"},null,8,["model-value"])]),o("div",Ii,[o("div",null,[m[7]||(m[7]=o("div",{class:"text-xs text-gray-600 mb-1"},"Cron 表达式",-1)),o("div",Ri,[n(V,{"model-value":e.playlistStatus.schedule?.cron||"",onInput:m[1]||(m[1]=U=>e.onUpdateCron(U)),placeholder:"例如: 0 0 * * *",size:"small",disabled:e.playlistStatus.schedule?.enabled!==1},null,8,["model-value","disabled"]),n(T,{type:"info",size:"small",onClick:e.onOpenCronBuilder,disabled:e.playlistStatus.schedule?.enabled!==1},{default:c(()=>[...m[6]||(m[6]=[X(" 助手 ",-1)])]),_:1},8,["onClick","disabled"])])]),o("div",zi,[o("div",Ui,[m[8]||(m[8]=o("div",{class:"text-xs text-gray-600 mb-1"},"持续时间（分钟）",-1)),n(M,{"model-value":e.playlistStatus.schedule?.duration||0,onChange:e.onUpdateDuration,min:0,max:s(Ti),step:1,size:"small",disabled:e.playlistStatus.schedule?.enabled!==1,class:"w-full"},null,8,["model-value","onChange","max","disabled"]),m[9]||(m[9]=o("div",{class:"text-xs text-gray-500 mt-1"},"0表示不自动停止",-1))]),o("div",Vi,[m[10]||(m[10]=o("div",{class:"text-xs text-gray-600 mb-1"},"触发按钮",-1)),n(D,{"model-value":e.playlistStatus.trigger_button||"",onChange:e.onUpdateTriggerButton,placeholder:"选择触发按钮",size:"small",class:"w-full",clearable:""},{default:c(()=>[n(I,{label:"空",value:s(mt).NONE},null,8,["value"]),n(I,{label:"按钮对-1",value:s(mt).BUTTON_1},null,8,["value"]),n(I,{label:"按钮对-2",value:s(mt).BUTTON_2},null,8,["value"]),n(I,{label:"按钮对-3",value:s(mt).BUTTON_3},null,8,["value"])]),_:1},8,["model-value","onChange"])])]),e.playlistStatus.schedule?.cron&&e.playlistStatus.schedule?.enabled===1?(v(),B("div",Ki,[n(T,{type:"success",size:"small",onClick:e.onPreviewCron,class:"w-full"},{default:c(()=>[...m[11]||(m[11]=[X(" 预览执行时间 ",-1)])]),_:1},8,["onClick"])])):Q("",!0)])]),o("div",Gi,[m[19]||(m[19]=o("h4",{class:"text-sm font-semibold mb-2"},"设备配置",-1)),o("div",ji,[o("div",null,[m[12]||(m[12]=o("div",{class:"text-xs text-gray-600 mb-1"},"设备类型",-1)),n(D,{"model-value":r.value,onChange:e.onUpdateDeviceType,placeholder:"选择设备类型",size:"small",class:"w-full"},{default:c(()=>[n(I,{label:"蓝牙",value:"bluetooth"}),n(I,{label:"DLNA",value:"dlna"}),n(I,{label:"设备代理",value:"agent"}),n(I,{label:"小米设备",value:"mi"})]),_:1},8,["model-value","onChange"])]),o("div",null,[o("div",Wi,[m[13]||(m[13]=o("span",null,"设备地址",-1)),e.playlistStatus.device?.name?(v(),B("span",Hi,j(e.playlistStatus.device.name),1)):Q("",!0)]),o("div",Yi,[n(V,{"model-value":u.value,onInput:m[2]||(m[2]=U=>e.onUpdateDeviceAddress(U)),placeholder:"设备地址",size:"small",class:"flex-1"},null,8,["model-value"]),n(T,{size:"small",type:"danger",plain:"",onClick:m[3]||(m[3]=U=>e.onUpdateDeviceAddress("")),disabled:!u.value,title:"清空设备地址"},{default:c(()=>[...m[14]||(m[14]=[X(" 清空 ",-1)])]),_:1},8,["disabled"])])])]),o("div",Ji,[o("div",qi,[o("h5",Xi,j(g.value),1),r.value?(v(),te(T,{key:0,size:"small",type:"primary",plain:"",onClick:E,loading:k.value,disabled:k.value,title:a.value},{default:c(()=>[k.value?Q("",!0):(v(),te(t,{key:0},{default:c(()=>[n(s(We))]),_:1})),m[15]||(m[15]=o("span",{class:"ml-1"},"扫描设备",-1))]),_:1},8,["loading","disabled","title"])):Q("",!0)]),i.value?(v(),B("div",Qi,[be((v(),B("div",Zi,[(v(!0),B(De,null,Ae(e.connectedDeviceList,U=>(v(),B("div",{key:U.address,class:"flex items-center gap-2 p-2 border rounded hover:bg-gray-50"},[o("div",er,[o("div",tr,j(U.name),1),o("div",lr,j(U.address),1)]),o("div",sr,[n(T,{size:"small",type:"primary",onClick:oe=>r.value==="agent"?e.onSelectAgentDevice(U):e.onSelectBluetoothDevice(U.address),disabled:U.address===u.value},{default:c(()=>[...m[16]||(m[16]=[X(" 选择 ",-1)])]),_:1},8,["onClick","disabled"])])]))),128)),e.connectedDeviceList.length===0?(v(),B("div",nr," 暂无设备 ")):Q("",!0)])),[[_,e.loading]])])):s(l)?(v(),B("div",ar,[be((v(),B("div",or,[(v(!0),B(De,null,Ae(e.dlnaDeviceList,U=>(v(),B("div",{key:U.location,class:"flex items-center gap-2 p-2 border rounded hover:bg-gray-50"},[o("div",ir,[o("div",rr,j(U.name),1),o("div",{class:"text-xs text-gray-500 truncate",title:U.location},j(U.location),9,dr)]),o("div",ur,[n(T,{size:"small",type:"primary",onClick:oe=>e.onUpdateDeviceAddress(U.location||U.address||"",U.name),disabled:(U.location||U.address)===u.value},{default:c(()=>[...m[17]||(m[17]=[X(" 选择 ",-1)])]),_:1},8,["onClick","disabled"])])]))),128)),e.dlnaDeviceList.length===0&&!e.dlnaScanning?(v(),B("div",cr,' 暂无设备，点击"扫描设备"开始扫描 ')):Q("",!0)])),[[_,e.dlnaScanning]])])):s(d)?(v(),B("div",fr,[be((v(),B("div",pr,[(v(!0),B(De,null,Ae(e.miDeviceList,U=>(v(),B("div",{key:U.deviceID||U.address,class:"flex items-center gap-2 p-2 border rounded hover:bg-gray-50"},[o("div",vr,[o("div",mr,j(U.name),1),o("div",{class:"text-xs text-gray-500 truncate",title:U.deviceID||U.address},j(U.deviceID||U.address),9,gr)]),o("div",yr,[n(T,{size:"small",type:"primary",onClick:oe=>e.onSelectMiDevice(U),disabled:(U.deviceID||U.address)===u.value},{default:c(()=>[...m[18]||(m[18]=[X(" 选择 ",-1)])]),_:1},8,["onClick","disabled"])])]))),128)),e.miDeviceList.length===0&&!e.miScanning?(v(),B("div",hr,' 暂无设备，点击"扫描设备"开始扫描 ')):Q("",!0)])),[[_,e.miScanning]])])):Q("",!0)])])])):(v(),B("div",br," 请先选择一个播放列表 "))])}}}),$r={class:"mb-4"},Cr={key:0,class:"text-center text-gray-400 mt-4 py-8"},kr=ke({__name:"ScanDeviceDialog",props:{visible:{type:Boolean},deviceList:{},loading:{type:Boolean}},emits:["update:visible","refresh","connect","close"],setup(e,{emit:f}){const r=f,u=l=>{r("update:visible",l),l||r("close")},h=()=>{r("refresh")},i=l=>{r("connect",l)};return(l,d)=>{const g=ze,a=xl,k=Dl,E=ut,A=Wt;return v(),te(E,{"model-value":e.visible,"onUpdate:modelValue":u,title:"扫描到的设备",width:"800"},{default:c(()=>[o("div",$r,[n(g,{type:"primary",onClick:h,loading:e.loading},{default:c(()=>[...d[0]||(d[0]=[X("刷新扫描",-1)])]),_:1},8,["loading"])]),be((v(),te(k,{data:e.deviceList,stripe:"",class:"w-full",height:400},{default:c(()=>[n(a,{prop:"name",label:"设备名称","min-width":"150"}),n(a,{prop:"address",label:"地址","min-width":"120"}),n(a,{prop:"rssi",label:"信号强度",width:"100"},{default:c(({row:m})=>[o("span",null,j(m.rssi)+" dBm",1)]),_:1}),n(a,{label:"操作",width:"100"},{default:c(({row:m})=>[n(g,{size:"small",type:"primary",onClick:t=>i(m),loading:m.connecting,disabled:m.connecting},{default:c(()=>[...d[1]||(d[1]=[X(" 连接 ",-1)])]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1},8,["data"])),[[A,e.loading]]),e.deviceList.length===0&&!e.loading?(v(),B("div",Cr,' 暂无扫描到的设备，点击"刷新扫描"按钮开始扫描 ')):Q("",!0)]),_:1},8,["model-value"])}}}),Dr={class:"flex flex-col gap-4 h-full overflow-y-auto"},xr={class:"flex items-center justify-between mb-2"},Fr={class:"flex items-center gap-2"},Sr={class:"flex flex-col gap-1"},_r={class:"text-sm flex items-start"},Pr={class:"text-gray-800"},Tr={class:"text-sm flex items-start"},Br={class:"text-gray-800"},Er={key:0,class:"text-gray-400"},Ar={class:"flex flex-col items-center gap-1"},Mr={class:"text-xs text-gray-500"},Nr={class:"flex flex-col gap-1"},Lr={class:"text-[12px] mr-1 !w-4"},Or={class:"flex items-center justify-between mb-2"},Ir={class:"flex items-center gap-2"},Rr={class:"flex flex-col gap-1"},zr={class:"text-sm flex items-start"},Ur={class:"text-gray-800"},Vr={class:"text-sm flex items-start"},Kr={class:"text-gray-800 w-40"},Gr={class:"text-gray-800 w-40"},jr={class:"flex flex-col gap-2"},Wr={class:"flex items-center gap-2"},Hr={class:"text-gray-800 w-5"},Yr={key:1},Jr={class:"flex items-center gap-2"},qr={class:"flex items-center justify-between mb-2"},Xr={class:"flex items-center gap-2"},Qr={class:"flex flex-col gap-1"},Zr={class:"text-sm flex items-start"},ed=["title"],td={key:0,class:"text-sm flex items-start"},ld={class:"text-gray-800"},sd={class:"flex flex-col gap-2"},nd={class:"flex items-center gap-2"},ad={class:"text-gray-800 w-5"},od={key:1},id={class:"flex items-center gap-2"},rd=ke({__name:"DevicesDrawer",props:{visible:{type:Boolean,default:!1}},emits:["update:visible"],setup(e,{emit:f}){const r=e,u=f,h=G(r.visible),i=G([]),l=G(!1),d=G([]),g=G(!1),a=G([]),k=G(!1);let E=null;const A=[{label:"B1",keys:["F13","F14"]},{label:"B2",keys:["F15","F16"]},{label:"B3",keys:["F17","F18"]}],m=async($=!0,p=!1)=>{try{$&&(k.value=!0);const N=(await Te.get("/agent/list")).data;N?.code===0?(a.value=N.data||[],p&&z.success(`已获取 ${a.value.length} 个 Agent 设备`)):((p||$)&&z.error(N?.msg||"获取设备列表失败"),a.value=[])}catch(L){console.error("获取Agent设备列表失败:",L),(p||$)&&de(L,"获取设备列表失败"),a.value=[]}finally{$&&(k.value=!1)}},t=async($,p)=>{const L=a.value.find(ae=>ae.agent_id===$);if(!L){z.error("设备不存在");return}const N=`testing_${p}`,q=L;q[N]=!0;try{const ce=(await Te.post("/agent/mock",{agent_id:$,action:"keyboard",key:p,value:"test"})).data;ce?.code===0?z.success(`测试按钮 ${p} 成功`):z.error(ce?.msg||`测试按钮 ${p} 失败`)}catch(ae){de(ae,`测试按钮 ${p} 失败`)}finally{q[N]=!1}},T=()=>{m(!0,!1),b(),E=setInterval(()=>{m(!1,!1)},_i)},b=()=>{E&&(clearInterval(E),E=null)},V=()=>m(!0,!1),M=($,p)=>t($,p),I=$=>$.deviceID||$.address||"",D=$=>Math.max(0,Math.min(100,$)),_=$=>({...$,volume:void 0,_volumeChanging:!1,_volumeRefreshing:!1}),U=async()=>{try{l.value=!0;const p=(await Te.get("/mi/scan",{params:{timeout:al}})).data;if(p?.code===0){const L=(p.data||[]).map(N=>_(N));i.value=L,await Promise.allSettled(L.map(N=>oe(N))),z.success(`扫描到 ${L.length} 个小米设备`)}else z.error(p?.msg||"扫描小米设备失败")}catch($){de($,"扫描小米设备失败")}finally{l.value=!1}},oe=async $=>{const p=I($);if(!p)return;const L=i.value.find(N=>I(N)===p);if(L){L._volumeRefreshing=!0;try{const q=(await Te.get("/mi/volume",{params:{device_id:p}})).data;if(q?.code===0)L.volume=q.data?.volume??q.data??void 0;else{const ae=L.name||p;z.error(q?.msg||`获取设备 ${ae} 音量失败`)}}catch(N){const q=L.name||p;de(N,`获取设备 ${q} 音量失败`)}finally{L._volumeRefreshing=!1}}},R=async($,p)=>{const L=I($);if(!L){z.error("设备ID无效");return}const N=D(p);$._volumeChanging=!0;try{const ae=(await Te.post("/mi/volume",{device_id:L,volume:N})).data;ae?.code===0?($.volume=N,z.success("音量设置成功")):z.error(ae?.msg||"设置音量失败")}catch(q){de(q,"设置小米设备音量失败")}finally{$._volumeChanging=!1}},x=async $=>{const p=I($);if(!p){z.warning("设备ID无效");return}try{$._stopping=!0;const N=(await Te.post("/mi/stop",{device_id:p})).data;N?.code===0?z.success("停止播放成功"):z.error(N?.msg||"停止播放失败")}catch(L){de(L,"停止小米设备播放失败")}finally{$._stopping=!1}},P=$=>$.location||$.address||"",w=$=>({...$,volume:void 0,_volumeChanging:!1,_volumeRefreshing:!1}),O=async()=>{try{g.value=!0;const p=(await Te.get("/dlna/scan",{params:{timeout:al}})).data;if(p?.code===0){const L=(p.data||[]).map(N=>w(N));d.value=L,await Promise.allSettled(L.map(N=>y(N))),z.success(`扫描到 ${L.length} 个 DLNA 设备`)}else z.error(p?.msg||"扫描 DLNA 设备失败")}catch($){de($,"扫描 DLNA 设备失败")}finally{g.value=!1}},y=async $=>{const p=P($);if(!p)return;const L=d.value.find(N=>P(N)===p);if(L){L._volumeRefreshing=!0;try{const q=(await Te.get("/dlna/volume",{params:{location:p}})).data;if(q?.code===0)L.volume=q.data?.volume??q.data??void 0;else{const ae=L.name||p;z.error(q?.msg||`获取设备 ${ae} 音量失败`)}}catch(N){const q=L.name||p;de(N,`获取设备 ${q} 音量失败`)}finally{L._volumeRefreshing=!1}}},J=async($,p)=>{const L=P($);if(!L){z.error("设备位置无效");return}const N=D(p);$._volumeChanging=!0;try{const ae=(await Te.post("/dlna/volume",{location:L,volume:N})).data;ae?.code===0?($.volume=N,z.success("音量设置成功")):z.error(ae?.msg||"设置音量失败")}catch(q){de(q,"设置 DLNA 设备音量失败")}finally{$._volumeChanging=!1}},me=async $=>{const p=P($);if(!p){z.warning("设备位置无效");return}try{$._stopping=!0;const N=(await Te.post("/dlna/stop",{location:p})).data;N?.code===0?z.success("停止播放成功"):z.error(N?.msg||"停止播放失败")}catch(L){de(L,"停止 DLNA 设备播放失败")}finally{$._stopping=!1}},F=()=>{h.value=!1};return Ne(()=>r.visible,$=>{h.value=$,$?T():b()},{immediate:!0}),Ne(h,$=>{$!==r.visible&&u("update:visible",$)}),nt(()=>{r.visible&&T()}),wl(()=>{b()}),($,p)=>{const L=Be,N=ze,q=xl,ae=Kt,ce=Dl,Ie=Fn,Fe=Fl,we=Wt;return v(),te(Fe,{modelValue:h.value,"onUpdate:modelValue":p[0]||(p[0]=W=>h.value=W),size:900,direction:"rtl","before-close":F,title:"设备管理","header-class":"h-12 !mb-1"},{default:c(()=>[o("div",Dr,[o("div",null,[o("div",xr,[o("div",Fr,[p[2]||(p[2]=o("h4",{class:"text-base font-semibold w-24"},"Agent设备",-1)),n(N,{type:"primary",plain:"",size:"small",onClick:V,loading:k.value},{default:c(()=>[k.value?Q("",!0):(v(),te(L,{key:0},{default:c(()=>[n(s(We))]),_:1})),p[1]||(p[1]=o("span",{class:"ml-1"},"刷新",-1))]),_:1},8,["loading"])])]),be((v(),te(ce,{data:a.value,stripe:"",class:"w-full",height:200},{empty:c(()=>[...p[5]||(p[5]=[o("div",{class:"text-center text-gray-400 py-8"},"暂无设备，请等待设备注册",-1)])]),default:c(()=>[n(q,{prop:"name",label:"设备名称","min-width":"150"}),n(q,{label:"详情","min-width":"250"},{default:c(({row:W})=>[o("div",Sr,[o("div",_r,[p[3]||(p[3]=o("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"地址：",-1)),o("span",Pr,j(W.address),1)]),o("div",Tr,[p[4]||(p[4]=o("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"ID：",-1)),o("span",Br,j(W.agent_id),1)])])]),_:1}),n(q,{label:"支持的操作","min-width":"100"},{default:c(({row:W})=>[(v(!0),B(De,null,Ae(W.actions,S=>(v(),te(ae,{key:S,size:"small",type:"info",class:"mr-1"},{default:c(()=>[X(j(S),1)]),_:2},1024))),128)),!W.actions||W.actions.length===0?(v(),B("span",Er,"无")):Q("",!0)]),_:1}),n(q,{label:"状态/心跳",width:"90"},{default:c(({row:W})=>[o("div",Ar,[n(ae,{type:W.is_online?"success":"danger",size:"small"},{default:c(()=>[X(j(W.is_online?"在线":"离线"),1)]),_:2},1032,["type"]),o("span",Mr,j(W.last_heartbeat_ago)+"秒前 ",1)])]),_:1}),n(q,{label:"测试按钮",width:"180"},{default:c(({row:W})=>[o("div",Nr,[(v(),B(De,null,Ae(A,(S,Y)=>o("div",{key:Y,class:"flex gap-1 items-center"},[n(L,{class:"!w-4 !h-5"},{default:c(()=>[n(s(vl))]),_:1}),o("span",Lr,j(S.label),1),(v(!0),B(De,null,Ae(S.keys,(K,se)=>(v(),te(N,{key:se,size:"small",type:"primary",plain:"",onClick:ne=>M(W.agent_id,K),loading:W[`testing_${K}`],class:"flex-1"},{default:c(()=>[X(j(K),1)]),_:2},1032,["onClick","loading"]))),128))])),64))])]),_:1})]),_:1},8,["data"])),[[we,k.value]])]),o("div",null,[o("div",Or,[o("div",Ir,[p[7]||(p[7]=o("h4",{class:"text-base font-semibold w-24"},"小米设备",-1)),n(N,{type:"primary",plain:"",size:"small",onClick:U,loading:l.value},{default:c(()=>[l.value?Q("",!0):(v(),te(L,{key:0},{default:c(()=>[n(s(We))]),_:1})),p[6]||(p[6]=o("span",{class:"ml-1"},"扫描",-1))]),_:1},8,["loading"])])]),be((v(),te(ce,{data:i.value,stripe:"",class:"w-full",height:280},{empty:c(()=>[...p[12]||(p[12]=[o("div",{class:"text-center text-gray-400 py-8"},'暂无设备，点击"扫描设备"开始扫描',-1)])]),default:c(()=>[n(q,{prop:"name",label:"设备名称","min-width":"150"}),n(q,{label:"详情","min-width":"400"},{default:c(({row:W})=>[o("div",Rr,[o("div",zr,[p[8]||(p[8]=o("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"ID：",-1)),o("span",Ur,j(W.deviceID||"-"),1)]),o("div",Vr,[p[9]||(p[9]=o("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"地址：",-1)),o("span",Kr,j(W.mac||"-"),1),p[10]||(p[10]=o("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"DTD：",-1)),o("span",Gr,j(W.miotDID||"-"),1)])])]),_:1}),n(q,{label:"功能","min-width":"200"},{default:c(({row:W})=>[o("div",jr,[o("div",Wr,[p[11]||(p[11]=o("span",{class:"text-gray-600 inline-block w-11 flex-shrink-0"},"音量：",-1)),o("span",Hr,j(W.volume!==void 0?W.volume:"-"),1),n(N,{size:"small",type:"info",plain:"",circle:"",onClick:S=>oe(W),loading:W._volumeRefreshing,disabled:W._volumeRefreshing||W._volumeChanging,title:"刷新音量",class:"p-0.5 !w-[17px] !h-[17px]"},{default:c(()=>[W._volumeRefreshing?Q("",!0):(v(),te(L,{key:0},{default:c(()=>[n(s(We))]),_:1}))]),_:2},1032,["onClick","loading","disabled"]),n(N,{size:"small",class:"!w-8 !h-6",type:"danger",plain:"",onClick:S=>x(W),disabled:W._stopping,title:"停止播放"},{default:c(()=>[W._stopping?(v(),te(L,{key:0,class:"animate-spin"},{default:c(()=>[n(s(Qe))]),_:1})):(v(),B("span",Yr,"⏹"))]),_:2},1032,["onClick","disabled"])]),o("div",Jr,[n(Ie,{"model-value":W.volume??0,onInput:S=>W.volume=S,onChange:S=>R(W,S),min:5,max:100,step:1,disabled:W._volumeChanging||W._volumeRefreshing||W.volume===void 0,size:"small",class:"flex-1 max-w-[200px]"},null,8,["model-value","onInput","onChange","disabled"])])])]),_:1})]),_:1},8,["data"])),[[we,l.value]])]),o("div",null,[o("div",qr,[o("div",Xr,[p[14]||(p[14]=o("h4",{class:"text-base font-semibold w-24"},"DLNA设备",-1)),n(N,{type:"primary",plain:"",size:"small",onClick:O,loading:g.value},{default:c(()=>[g.value?Q("",!0):(v(),te(L,{key:0},{default:c(()=>[n(s(We))]),_:1})),p[13]||(p[13]=o("span",{class:"ml-1"},"扫描",-1))]),_:1},8,["loading"])])]),be((v(),te(ce,{data:d.value,stripe:"",class:"w-full",height:280},{empty:c(()=>[...p[18]||(p[18]=[o("div",{class:"text-center text-gray-400 py-8"},'暂无设备，点击"扫描设备"开始扫描',-1)])]),default:c(()=>[n(q,{prop:"name",label:"设备名称","min-width":"150"}),n(q,{label:"详情","min-width":"400"},{default:c(({row:W})=>[o("div",Qr,[o("div",Zr,[p[15]||(p[15]=o("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"位置：",-1)),o("span",{class:"text-gray-800 flex-1 truncate",title:W.location},j(W.location||"-"),9,ed)]),W.manufacturer||W.model_name?(v(),B("div",td,[p[16]||(p[16]=o("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"型号：",-1)),o("span",ld,j(W.manufacturer||"")+" "+j(W.model_name||""),1)])):Q("",!0)])]),_:1}),n(q,{label:"功能","min-width":"200"},{default:c(({row:W})=>[o("div",sd,[o("div",nd,[p[17]||(p[17]=o("span",{class:"text-gray-600 inline-block w-11 flex-shrink-0"},"音量：",-1)),o("span",ad,j(W.volume!==void 0?W.volume:"-"),1),n(N,{size:"small",type:"info",plain:"",circle:"",onClick:S=>y(W),loading:W._volumeRefreshing,disabled:W._volumeRefreshing||W._volumeChanging,title:"刷新音量",class:"p-0.5 !w-[17px] !h-[17px]"},{default:c(()=>[W._volumeRefreshing?Q("",!0):(v(),te(L,{key:0},{default:c(()=>[n(s(We))]),_:1}))]),_:2},1032,["onClick","loading","disabled"]),n(N,{size:"small",class:"!w-8 !h-6",type:"danger",plain:"",onClick:S=>me(W),disabled:W._stopping,title:"停止播放"},{default:c(()=>[W._stopping?(v(),te(L,{key:0,class:"animate-spin"},{default:c(()=>[n(s(Qe))]),_:1})):(v(),B("span",od,"⏹"))]),_:2},1032,["onClick","disabled"])]),o("div",id,[n(Ie,{"model-value":W.volume??0,onInput:S=>W.volume=S,onChange:S=>J(W,S),min:5,max:100,step:1,disabled:W._volumeChanging||W._volumeRefreshing||W.volume===void 0,size:"small",class:"flex-1 max-w-[200px]"},null,8,["model-value","onInput","onChange","disabled"])])])]),_:1})]),_:1},8,["data"])),[[we,g.value]])])])]),_:1},8,["modelValue"])}}}),dd={class:"flex gap-4 h-[500px]"},ud={class:"w-64 flex flex-col border rounded p-3"},cd={class:"flex-1 overflow-y-auto space-y-2"},fd=["onClick"],pd={class:"text-sm flex-1 truncate"},vd={class:"text-xs text-gray-500 ml-2 whitespace-nowrap"},md={key:0,class:"text-blue-600 font-medium"},gd={key:1},yd={key:0,class:"text-xs text-gray-400 text-center py-2"},hd={class:"flex-1 flex flex-col border rounded p-3"},bd={key:0,class:"flex-1 overflow-y-auto"},wd={class:"mb-3"},$d={class:"space-y-1"},Cd=["onClick"],kd={class:"text-xs text-gray-500 whitespace-nowrap"},Dd={key:0,class:"text-blue-600 font-medium"},xd={key:1},Fd={class:"border-t pt-3"},Sd={class:"flex items-center gap-2 py-1"},_d={class:"text-xs text-gray-500 whitespace-nowrap"},Pd={key:0,class:"text-blue-600 font-medium"},Td={key:1},Bd={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},Ed={class:"flex items-center justify-between"},Ad={class:"text-sm text-gray-500"},Md={key:0},Nd={class:"flex gap-2"},Ld=ke({__name:"PlaylistSelectDialog",props:{visible:{type:Boolean,default:!1},playlistCollection:{default:()=>[]},selectedFiles:{default:()=>[]},onCopy:{type:Function,default:void 0},onRemove:{type:Function,default:void 0}},emits:["update:visible"],setup(e,{emit:f}){const r=e,u=f,h=G(r.visible),i=G(null),l=G([]),d=G(!1),g=le(()=>r.playlistCollection.find(R=>R.id===i.value)||null),a=le(()=>l.value.length>0||d.value),k=R=>{const x=g.value;if(!x||!x.pre_lists||!Array.isArray(x.pre_lists)||x.pre_lists.length!==7)return 0;const P=x.pre_lists[R];return Array.isArray(P)?P.length:0},E=()=>{const R=g.value;return!R||!R.playlist?0:Array.isArray(R.playlist)?R.playlist.length:0},A=R=>{if(!R)return 0;const x=R.pre_lists&&Array.isArray(R.pre_lists)&&R.pre_lists.length===7?R.pre_lists.reduce((w,O)=>w+(Array.isArray(O)?O.length:0),0):0,P=Array.isArray(R.playlist)?R.playlist.length:0;return x+P},m=()=>!r.selectedFiles||r.selectedFiles.length===0?new Set:new Set(r.selectedFiles.map(R=>typeof R=="string"?R:R.uri||String(R))),t=R=>{if(!R||!r.selectedFiles||r.selectedFiles.length===0)return 0;const x=m();let P=0;return R.pre_lists&&Array.isArray(R.pre_lists)&&R.pre_lists.length===7&&R.pre_lists.forEach(w=>{Array.isArray(w)&&w.forEach(O=>{const y=O.uri||String(O);x.has(y)&&P++})}),Array.isArray(R.playlist)&&R.playlist.forEach(w=>{const O=w.uri||String(w);x.has(O)&&P++}),P},T=R=>{const x=g.value;if(!x||!r.selectedFiles||r.selectedFiles.length===0||!x.pre_lists||!Array.isArray(x.pre_lists)||x.pre_lists.length!==7)return 0;const P=x.pre_lists[R];if(!Array.isArray(P))return 0;const w=m();let O=0;return P.forEach(y=>{const J=y.uri||String(y);w.has(J)&&O++}),O},b=()=>{const R=g.value;if(!R||!r.selectedFiles||r.selectedFiles.length===0||!Array.isArray(R.playlist))return 0;const x=m();let P=0;return R.playlist.forEach(w=>{const O=w.uri||String(w);x.has(O)&&P++}),P},V=R=>{i.value=R,l.value=[],d.value=!1},M=R=>{const x=l.value.indexOf(R);x>-1?l.value.splice(x,1):l.value.push(R)},I=()=>{d.value=!d.value},D=async()=>{if(!g.value||!r.selectedFiles||r.selectedFiles.length===0||!a.value){z.warning("请选择播放列表和目标列表，并至少选中一个文件");return}try{const R=r.selectedFiles.map(O=>typeof O=="string"?O:O.uri||String(O)),x=l.value.length,P=d.value;let w="";if(x>0&&P)w=`${x}个前置文件列表和正式文件列表`;else if(x>0){const O=["周一","周二","周三","周四","周五","周六","周日"];w=`前置文件列表（${l.value.map(J=>O[J]).join("、")}）`}else P&&(w="正式文件列表");await Ee.confirm(`确定要将选中的 ${R.length} 个文件复制到播放列表"${g.value.name}"的${w}吗？`,"确认复制",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),r.onCopy&&(await r.onCopy({playlistId:i.value,files:R,preLists:l.value,filesList:d.value}),z.success("文件已复制到播放列表"),U())}catch(R){R!=="cancel"&&de(R,"复制文件失败")}},_=async()=>{if(!g.value||!r.selectedFiles||r.selectedFiles.length===0||!a.value){z.warning("请选择播放列表和目标列表，并至少选中一个文件");return}try{const R=r.selectedFiles.map(O=>typeof O=="string"?O:O.uri||String(O)),x=l.value.length,P=d.value;let w="";if(x>0&&P)w=`${x}个前置文件列表和正式文件列表`;else if(x>0){const O=["周一","周二","周三","周四","周五","周六","周日"];w=`前置文件列表（${l.value.map(J=>O[J]).join("、")}）`}else P&&(w="正式文件列表");await Ee.confirm(`确定要从播放列表"${g.value.name}"的${w}中删除选中的 ${R.length} 个文件吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),r.onRemove&&(await r.onRemove({playlistId:i.value,files:R,preLists:l.value,filesList:d.value}),z.success("文件已从播放列表删除"),U())}catch(R){R!=="cancel"&&de(R,"删除文件失败")}},U=()=>{h.value=!1,i.value=null,l.value=[],d.value=!1},oe=()=>{r.playlistCollection&&r.playlistCollection.length>0&&!i.value&&(i.value=r.playlistCollection[0].id)};return Ne(()=>r.playlistCollection,R=>{R&&R.length>0&&!i.value&&(i.value=R[0].id)},{immediate:!0}),Ne(()=>r.visible,R=>{h.value=R,R&&oe()}),Ne(h,R=>{R!==r.visible&&u("update:visible",R)}),nt(()=>{oe()}),(R,x)=>{const P=Dt,w=ze,O=ut;return v(),te(O,{modelValue:h.value,"onUpdate:modelValue":x[1]||(x[1]=y=>h.value=y),title:"应用到列表",width:"900","before-close":U},{footer:c(()=>[o("div",Ed,[o("div",Ad,[e.selectedFiles&&e.selectedFiles.length>0?(v(),B("span",Md," 已选择 "+j(e.selectedFiles.length)+" 个文件 ",1)):Q("",!0)]),o("div",Nd,[n(w,{onClick:U},{default:c(()=>[...x[7]||(x[7]=[X("取消",-1)])]),_:1}),n(w,{type:"primary",onClick:D,disabled:!a.value||!e.selectedFiles||e.selectedFiles.length===0},{default:c(()=>[...x[8]||(x[8]=[X(" 复制到列表 ",-1)])]),_:1},8,["disabled"]),n(w,{type:"danger",onClick:_,disabled:!a.value||!e.selectedFiles||e.selectedFiles.length===0},{default:c(()=>[...x[9]||(x[9]=[X(" 从列表删除 ",-1)])]),_:1},8,["disabled"])])])]),default:c(()=>[o("div",dd,[o("div",ud,[x[2]||(x[2]=o("div",{class:"text-sm font-semibold mb-2"},"选择播放列表",-1)),o("div",cd,[(v(!0),B(De,null,Ae(e.playlistCollection,y=>(v(),B("div",{key:y.id,class:ie(["flex items-center justify-between px-2 py-2 rounded cursor-pointer hover:bg-gray-50 transition-colors",{"bg-blue-50 border border-blue-200":y.id===i.value}]),onClick:J=>V(y.id)},[o("span",pd,j(y.name),1),o("span",vd,[e.selectedFiles&&e.selectedFiles.length>0?(v(),B("span",md,j(t(y))+"/"+j(A(y)),1)):(v(),B("span",gd,j(A(y)),1))])],10,fd))),128)),e.playlistCollection.length===0?(v(),B("div",yd," 暂无播放列表 ")):Q("",!0)])]),o("div",hd,[x[6]||(x[6]=o("div",{class:"text-sm font-semibold mb-3"},"选择目标列表（可多选）",-1)),g.value?(v(),B("div",bd,[o("div",wd,[x[4]||(x[4]=o("div",{class:"text-xs text-gray-600 mb-2 font-semibold"},"前置文件",-1)),o("div",$d,[(v(),B(De,null,Ae(["周一","周二","周三","周四","周五","周六","周日"],(y,J)=>o("div",{key:J,class:"flex items-center gap-2 py-1"},[n(P,{"model-value":l.value.includes(J),onChange:me=>M(J),size:"small"},null,8,["model-value","onChange"]),o("span",{class:ie(["text-xs flex-1 cursor-pointer hover:text-blue-500",{"text-blue-600 font-medium":l.value.includes(J)}]),onClick:me=>M(J)},j(y),11,Cd),o("span",kd,[e.selectedFiles&&e.selectedFiles.length>0?(v(),B("span",Dd,j(T(J))+"/"+j(k(J)),1)):(v(),B("span",xd,j(k(J)),1)),x[3]||(x[3]=o("span",{class:"text-gray-400"}," 个文件",-1))])])),64))])]),o("div",Fd,[o("div",Sd,[n(P,{"model-value":d.value,onChange:I,size:"small"},null,8,["model-value"]),o("span",{class:ie(["text-xs font-semibold text-gray-600 cursor-pointer hover:text-blue-500 flex-1",{"text-blue-600":d.value}]),onClick:x[0]||(x[0]=y=>I())}," 正式文件 ",2),o("span",_d,[e.selectedFiles&&e.selectedFiles.length>0?(v(),B("span",Pd,j(b())+"/"+j(E()),1)):(v(),B("span",Td,j(E()),1)),x[5]||(x[5]=o("span",{class:"text-gray-400"}," 个文件",-1))])])])])):(v(),B("div",Bd," 请先选择一个播放列表 "))])])]),_:1},8,["modelValue"])}}}),Od={class:"flex gap-4 h-full"},Id={class:"w-64 border rounded p-3 flex flex-col"},Rd={class:"flex items-center justify-between mb-3"},zd={class:"flex-1 overflow-y-auto space-y-2"},Ud=["onClick"],Vd={class:"text-sm font-medium truncate"},Kd={class:"text-xs text-gray-500 mt-1"},Gd={class:"flex items-center gap-1 flex-shrink-0"},jd={key:0,class:"text-sm text-gray-400 text-center py-4"},Wd={class:"flex-1 border rounded p-3 flex flex-col"},Hd={class:"mb-3 flex items-center justify-between"},Yd={class:"flex items-center gap-2"},Jd={class:"text-base font-semibold"},qd={key:0,class:"flex items-center gap-2"},Xd={class:"flex-1 overflow-y-auto"},Qd={key:0,class:"space-y-1"},Zd=["onClick"],eu={class:"text-xs text-gray-500 w-8"},tu=["title"],lu={key:1,class:"text-sm text-gray-400 text-center py-8"},su={class:"w-96 border rounded p-3 flex flex-col"},nu={class:"mb-3"},au={class:"flex gap-2 mb-3"},ou={class:"mb-3"},iu={class:"space-y-1 max-h-48 overflow-y-auto border rounded p-1"},ru=["onClick"],du={class:"text-sm flex-1"},uu={class:"text-xs text-gray-500 ml-2 whitespace-nowrap"},cu={key:0,class:"text-xs text-gray-400 text-center py-2"},fu={key:0,class:"flex-1 overflow-y-auto space-y-3"},pu={class:"border rounded p-2"},vu={class:"space-y-1"},mu=["onClick"],gu={class:"text-xs text-gray-500 whitespace-nowrap"},yu={class:"border rounded p-2"},hu={class:"flex items-center gap-2 mb-2"},bu={class:"text-xs text-gray-500 whitespace-nowrap"},wu={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},ol="t_batch_list",il="0",$u=7,Cu=ke({__name:"BatchDrawer",props:{visible:{type:Boolean,default:!1},playlistCollection:{default:()=>[]},onAddFiles:{type:Function,default:void 0},onRemoveFiles:{type:Function,default:void 0}},emits:["update:visible","refresh"],setup(e,{emit:f}){const r=e,u=f,h=G([]),i=G(null),l=G(null),d=G([]),g=G(!1),a=G([]),k=G(!1),E=G(!1),A=G(!1),m=G(r.visible),t=le(()=>h.value.find(C=>C.id===i.value)||null),T=le(()=>r.playlistCollection.find(C=>C.id===l.value)||null),b=le(()=>d.value.length>0||g.value),V=C=>typeof C=="string"?C:C?.uri||String(C),M=()=>t.value?.files?a.value.map(C=>t.value.files[C]).filter(C=>C!==null):[],I=()=>new Set(M().map(V)),D=C=>!!(C?.pre_lists&&Array.isArray(C.pre_lists)&&C.pre_lists.length===$u),_=C=>!!(C?.playlist&&Array.isArray(C.playlist)),U=(C,H)=>{if(!Array.isArray(C))return 0;let Z=0;return C.forEach(ve=>{H.has(V(ve))&&Z++}),Z},oe=C=>{const H=T.value;if(!D(H))return 0;const Z=H.pre_lists[C];return Array.isArray(Z)?Z.length:0},R=C=>{if(!t.value||!T.value)return 0;const H=I();if(H.size===0)return 0;const Z=T.value;if(!D(Z))return 0;const ve=Z.pre_lists[C];return U(ve,H)},x=()=>{const C=T.value;return _(C)?C.playlist.length:0},P=()=>{if(!t.value||!T.value)return 0;const C=I();if(C.size===0)return 0;const H=T.value;return _(H)?U(H.playlist,C):0},w=C=>{if(!C)return 0;let H=0;return D(C)&&C.pre_lists.forEach(Z=>{Array.isArray(Z)&&(H+=Z.length)}),_(C)&&(H+=C.playlist.length),H},O=C=>{if(!t.value||!C)return 0;const H=I();if(H.size===0)return 0;let Z=0;return D(C)&&C.pre_lists.forEach(ve=>{Z+=U(ve,H)}),_(C)&&(Z+=U(C.playlist,H)),Z},y=async()=>{try{A.value=!0;const C=await In(ol,il);let H=[];if(C!=null)if(typeof C=="string"&&C.trim()!=="")try{const Z=JSON.parse(C);H=Array.isArray(Z)?Z:[]}catch{H=[]}else Array.isArray(C)&&(H=C);h.value=H,me()}catch(C){h.value=[],de(C,"加载Batch列表失败")}finally{A.value=!1}},J=async()=>{try{const C=JSON.stringify(h.value);await Rn(ol,il,C)}catch(C){throw de(C,"保存Batch列表失败"),C}},me=()=>{if(h.value.length===0||i.value)return;const C=h.value[0];i.value=C.id,C?.files?.length>0&&(a.value=C.files.map((H,Z)=>Z))},F=(C,H)=>{const Z=C.indexOf(H);Z>-1?C.splice(Z,1):C.push(H)},$=async()=>{try{const{value:C}=await Ee.prompt("请输入Batch名称","创建Batch",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:"Batch名称",inputValidator:ve=>!!ve&&ve.trim().length>0||"名称不能为空"}),H=C.trim(),Z={id:Date.now().toString(),name:H,files:[],createTime:new Date().toISOString()};h.value.push(Z),await J(),z.success("Batch创建成功"),i.value=Z.id}catch(C){C!=="cancel"&&de(C,"创建Batch失败")}},p=async C=>{const H=h.value.find(Z=>Z.id===C);if(H)try{const{value:Z}=await Ee.prompt("请输入Batch名称","编辑Batch",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:H.name,inputPlaceholder:"Batch名称",inputValidator:ve=>!!ve&&ve.trim().length>0||"名称不能为空"});H.name=Z.trim(),await J(),z.success("Batch名称已更新")}catch(Z){Z!=="cancel"&&de(Z,"编辑Batch失败")}},L=async C=>{const H=h.value.find(Z=>Z.id===C);if(H)try{await Ee.confirm(`确定要删除Batch "${H.name}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const Z=h.value.findIndex(ve=>ve.id===C);Z>-1&&(h.value.splice(Z,1),await J(),i.value===C&&(i.value=null),z.success("Batch已删除"))}catch(Z){Z!=="cancel"&&de(Z,"删除Batch失败")}},N=C=>{i.value=C;const H=h.value.find(Z=>Z.id===C);H&&H.files&&H.files.length>0?a.value=H.files.map((Z,ve)=>ve):a.value=[]},q=C=>{F(a.value,C)},ae=async()=>{if(!(!t.value||a.value.length===0))try{const C=a.value.length;await Ee.confirm(`确定要删除选中的 ${C} 个文件吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),[...new Set(a.value)].sort((Z,ve)=>ve-Z).forEach(Z=>{Z>=0&&Z<t.value.files.length&&t.value.files.splice(Z,1)}),t.value.files.length>0?a.value=t.value.files.map((Z,ve)=>ve):a.value=[],await J(),z.success(`已删除 ${C} 个文件`)}catch(C){C!=="cancel"&&de(C,"删除失败")}},ce=()=>{if(!t.value){z.warning("请先选择一个Batch");return}k.value=!0},Ie=async C=>{if(!(!t.value||C.length===0))try{E.value=!0;const H=t.value,Z=new Set(H.files.map(V)),ve=C.filter(Ge=>!Z.has(Ge)).map(Ge=>({uri:Ge}));H.files.push(...ve),await J(),H.files.length>0&&(a.value=H.files.map((Ge,at)=>at)),z.success(`成功添加 ${ve.length} 个文件`),k.value=!1}catch(H){de(H,"添加文件失败")}finally{E.value=!1}},Fe=()=>{k.value=!1},we=C=>{l.value=l.value===C?null:C,d.value=[],g.value=!1},W=C=>{F(d.value,C)},S=C=>{g.value=C!==void 0?C:!g.value},Y=()=>!t.value||!l.value||a.value.length===0||!b.value?(z.warning("请选择Batch、播放列表和目标列表，并至少选中一个文件"),!1):!0,K=async()=>{if(Y())try{const C=M().map(V);await Ee.confirm(`确定要将选中的 ${C.length} 个文件添加到选中的列表吗？`,"确认添加",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),r.onAddFiles&&(await r.onAddFiles({playlistId:l.value,files:C,preLists:d.value,filesList:g.value}),z.success("文件已添加到播放列表"))}catch(C){C!=="cancel"&&de(C,"添加文件失败")}},se=async()=>{if(Y())try{const C=M().map(V);await Ee.confirm(`确定要从选中的列表中删除选中的 ${C.length} 个文件吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),r.onRemoveFiles&&(await r.onRemoveFiles({playlistId:l.value,files:C,preLists:d.value,filesList:g.value}),z.success("文件已从播放列表删除"))}catch(C){C!=="cancel"&&de(C,"删除文件失败")}},ne=()=>{m.value=!1},ee=()=>{d.value=[],g.value=!1,a.value=[]},ue=()=>{i.value=null,l.value=null,ee()},ye=()=>{r.playlistCollection?.length>0?l.value=r.playlistCollection[0].id:l.value=null};return Ne(()=>r.playlistCollection,C=>{C?.length>0&&!l.value&&(l.value=C[0].id)},{immediate:!0}),Ne(()=>r.visible,C=>{m.value=C,C?(ee(),ye(),y()):ue()},{immediate:!0}),Ne(m,C=>{C!==r.visible&&u("update:visible",C)}),nt(()=>{y()}),(C,H)=>{const Z=Be,ve=ze,Ge=Dt,at=Fl;return v(),te(at,{modelValue:m.value,"onUpdate:modelValue":H[4]||(H[4]=he=>m.value=he),title:"批量模式",size:1200,direction:"rtl","before-close":ne},{default:c(()=>[o("div",Od,[o("div",Id,[o("div",Rd,[H[5]||(H[5]=o("h3",{class:"text-base font-semibold"},"Batch列表",-1)),n(ve,{type:"primary",size:"small",onClick:$,plain:""},{default:c(()=>[n(Z,null,{default:c(()=>[n(s(ht))]),_:1})]),_:1})]),o("div",zd,[(v(!0),B(De,null,Ae(h.value,he=>(v(),B("div",{key:he.id,class:ie(["border rounded px-3 py-2 hover:bg-gray-50 flex items-center gap-2",{"border-blue-500 bg-blue-50":he.id===i.value}])},[o("div",{class:"flex-1 cursor-pointer",onClick:Pe=>N(he.id)},[o("div",Vd,j(he.name),1),o("div",Kd,j(he.files?he.files.length:0)+" 个文件 ",1)],8,Ud),o("div",Gd,[n(ve,{type:"default",plain:"",size:"small",circle:"",onClick:ge(Pe=>L(he.id),["stop"]),title:"删除"},{default:c(()=>[n(Z,null,{default:c(()=>[n(s(je))]),_:1})]),_:1},8,["onClick"])])],2))),128)),h.value.length===0?(v(),B("div",jd,' 暂无Batch，点击"+"创建 ')):Q("",!0)])]),o("div",Wd,[o("div",Hd,[o("div",Yd,[o("h3",Jd,j(t.value?t.value.name:"请选择一个Batch"),1),t.value?(v(),te(ve,{key:0,type:"default",plain:"",size:"small",circle:"",onClick:H[0]||(H[0]=he=>p(t.value.id)),title:"编辑"},{default:c(()=>[n(Z,null,{default:c(()=>[n(s(yl))]),_:1})]),_:1})):Q("",!0)]),t.value?(v(),B("div",qd,[n(ve,{type:"primary",size:"small",onClick:ce,plain:""},{default:c(()=>[n(Z,null,{default:c(()=>[n(s(ht))]),_:1})]),_:1}),n(ve,{type:"danger",size:"small",onClick:ae,disabled:a.value.length===0,plain:""},{default:c(()=>[n(Z,null,{default:c(()=>[n(s(je))]),_:1}),X(" ("+j(a.value.length)+") ",1)]),_:1},8,["disabled"])])):Q("",!0)]),o("div",Xd,[t.value&&t.value.files&&t.value.files.length>0?(v(),B("div",Qd,[(v(!0),B(De,null,Ae(t.value.files,(he,Pe)=>(v(),B("div",{key:Pe,class:ie(["flex items-center gap-2 p-2 border border-blue-500 rounded hover:bg-gray-50 cursor-pointer",{"bg-blue-50":a.value.includes(Pe)}]),onClick:ot=>q(Pe)},[n(Ge,{"model-value":a.value.includes(Pe),onChange:ot=>q(Pe),class:"!h-6",onClick:H[1]||(H[1]=ge(()=>{},["stop"])),size:"default"},null,8,["model-value","onChange"]),o("span",eu,j(Pe+1),1),o("span",{class:"flex-1 text-sm truncate",title:V(he)},j(V(he).split("/").pop()),9,tu)],10,Zd))),128))])):(v(),B("div",lu,j(t.value?"该Batch暂无文件":"请先选择一个Batch"),1))])]),o("div",su,[o("div",nu,[H[9]||(H[9]=o("h3",{class:"text-base font-semibold mb-2"},"Playlist操作",-1)),o("div",au,[n(ve,{type:"default",size:"small",onClick:K,disabled:!t.value||!l.value||a.value.length===0||!b.value,plain:""},{default:c(()=>[n(Z,{class:"mr-1"},{default:c(()=>[n(s(ht))]),_:1}),H[6]||(H[6]=X(" 添加到播放列表 ",-1))]),_:1},8,["disabled"]),n(ve,{type:"default",size:"small",onClick:se,disabled:!t.value||!l.value||a.value.length===0||!b.value,plain:""},{default:c(()=>[n(Z,{class:"mr-1"},{default:c(()=>[n(s(je))]),_:1}),H[7]||(H[7]=X(" 从播放列表删除 ",-1))]),_:1},8,["disabled"])]),o("div",ou,[H[8]||(H[8]=o("div",{class:"text-xs text-gray-500 mb-2"},"选择播放列表 进行批量操作",-1)),o("div",iu,[(v(!0),B(De,null,Ae(e.playlistCollection,he=>(v(),B("div",{key:he.id,class:ie(["flex items-center justify-between px-2 py-1.5 rounded cursor-pointer hover:bg-gray-50 transition-colors",{"bg-blue-50 border border-blue-200":he.id===l.value}]),onClick:Pe=>we(he.id)},[o("span",du,j(he.name),1),o("span",uu,j(O(he))+" / "+j(w(he)),1)],10,ru))),128)),e.playlistCollection.length===0?(v(),B("div",cu," 暂无播放列表 ")):Q("",!0)])])]),T.value?(v(),B("div",fu,[o("div",pu,[H[10]||(H[10]=o("div",{class:"text-xs font-semibold text-gray-600 mb-2"},"前置文件",-1)),o("div",vu,[(v(),B(De,null,Ae(["周一","周二","周三","周四","周五","周六","周日"],(he,Pe)=>o("div",{key:Pe,class:"flex items-center gap-2"},[n(Ge,{"model-value":d.value.includes(Pe),onChange:ot=>W(Pe),size:"small"},null,8,["model-value","onChange"]),o("span",{class:ie(["text-xs flex-1 cursor-pointer hover:text-blue-500",{"text-blue-600 font-medium":d.value.includes(Pe)}]),onClick:ot=>W(Pe)},j(he),11,mu),o("span",gu,j(R(Pe))+" / "+j(oe(Pe)),1)])),64))])]),o("div",yu,[o("div",hu,[n(Ge,{"model-value":g.value,onChange:S,size:"small"},null,8,["model-value"]),o("span",{class:ie(["text-xs font-semibold text-gray-600 cursor-pointer hover:text-blue-500 flex-1",{"text-blue-600":g.value}]),onClick:H[2]||(H[2]=he=>S())}," 正式文件 ",2),o("span",bu,j(P())+" / "+j(x()),1)])])])):(v(),B("div",wu," 请先选择一个播放列表 "))])]),n(Cl,{visible:k.value,"onUpdate:visible":H[3]||(H[3]=he=>k.value=he),title:"选择文件添加到Batch","confirm-button-text":"添加","confirm-loading":E.value,onConfirm:Ie,onClose:Fe},null,8,["visible","confirm-loading"])]),_:1},8,["modelValue"])}}});function ku(){return{...{playlistCollection:G([]),activePlaylistId:G(""),playlistStatus:G(null),playlistLoading:G(!1),playlistRefreshing:G(!1),playing:G(!1),stopping:G(!1),showMoreActions:G(!1),editingPlaylistId:G(null),editingPlaylistName:G(""),fileBrowserDialogVisible:G(!1),fileBrowserTarget:G("files"),replaceFileInfo:G(null),selectedWeekdayIndex:G(null),preFilesDragMode:G(!1),filesDragMode:G(!1),preFilesBatchDeleteMode:G(!1),filesBatchDeleteMode:G(!1),selectedPreFileIndices:G([]),selectedFileIndices:G([]),preFilesExpanded:G(!1),playlistSelectorVisible:G(!1),playlistSelectorSelectedFiles:G([]),batchDrawerVisible:G(!1),cronBuilderVisible:G(!1),cronPreviewVisible:G(!1),cronPreviewTimes:G([]),initialCronExpr:G(""),agentListDialogVisible:G(!1),scanDialogVisible:G(!1),loading:G(!1),deviceList:G([]),connectedDeviceList:G([]),dlnaDeviceList:G([]),dlnaScanning:G(!1),miDeviceList:G([]),miScanning:G(!1),pendingDeviceType:G(null),preFilesSortOrder:G(null),filesSortOrder:G(null),preFilesOriginalOrder:G(null),filesOriginalOrder:G(null)}}}async function He(e,f,r={}){let u;return f==="GET"?u=await Te.get(`/playlist/${e}`,{params:r}):u=await Te.post(`/playlist/${e}`,r),u.data}function Du(e,f,r,u,h,i,l,d){const g=F=>F.map($=>({...$})),a=F=>{const $="playlist"in F&&Array.isArray(F.playlist)&&F.playlist||"files"in F&&Array.isArray(F.files)&&F.files||[];return g(pt($,!0))},k=F=>{if(F.pre_lists&&Array.isArray(F.pre_lists)&&F.pre_lists.length===vt)return F.pre_lists.map(L=>g(pt(L||[],!0)));const $="pre_files"in F&&Array.isArray(F.pre_files)&&F.pre_files||[],p=g(pt($,!0));return Array(vt).fill(null).map(()=>[...p])},E=F=>Bi.includes(F)?F:Ei,A=F=>({enabled:F?.enabled===1?1:0,cron:F?.cron?String(F.cron):"",duration:F?.duration||0}),m=(F,$)=>{if(typeof F=="number")return F;if(F==null)return $;const p=parseInt(String(F),10);return isNaN(p)?$:p},t=F=>F===!0||F===1,T=(F,$)=>{if($===0)return 0;const p=m(F,0);return Math.max(0,Math.min(p,$-1))},b=()=>Array(vt).fill(null).map(()=>[]),V=F=>Array.isArray(F)&&F.length===vt&&F.every($=>Array.isArray($)),M=(F,$="播放列表")=>{const p=a(F),L=k(F),N=T(F?.current_index,p.length),q=F?.name&&String(F.name).trim()||$,ae=E(F?.device?.type||F?.device_type),ce=F?.device_address||F?.device?.address||null;return{id:F?.id||eo(),name:q,playlist:p,pre_lists:L,total:p.length,current_index:N,pre_index:m(F?.pre_index,-1),device_address:ce,device_type:ae,device:F?.device||{type:ae,address:ce,name:F?.device?.name||null},schedule:A(F?.schedule),trigger_button:F?.trigger_button||"",updatedAt:"updatedAt"in F&&typeof F.updatedAt=="number"?F.updatedAt:Date.now(),isPlaying:t(F?.isPlaying)}},I=F=>!Array.isArray(F)||F.length===0?[M({name:Je})]:F.map(($,p)=>"playlist"in $&&"total"in $?$:M($,$?.name||`播放列表${p+1}`)),D=F=>{if(F&&"playlists"in F&&Array.isArray(F.playlists)){const p=F,L=I(p.playlists),N=L.some(q=>q.id===p.activePlaylistId)?p.activePlaylistId:L[0]?.id||null;return{playlists:L,activePlaylistId:N}}if(F&&!Array.isArray(F)&&("playlist"in F||"files"in F)){const p=F,L="playlist"in p&&Array.isArray(p.playlist)&&p.playlist||"files"in p&&Array.isArray(p.files)&&p.files||[],N=M({id:p.id||p.playlist_id,name:p.name||Je,files:L,current_index:p.current_index,device_address:p.device_address});return{playlists:[N],activePlaylistId:N.id}}const $=M({name:Je});return{playlists:[$],activePlaylistId:$.id}},_=F=>{if(!F)return null;if(!Array.isArray(F)&&Object.keys(F).length>0){const $=Object.values(F).map(p=>M(p,p.name||Je));return{playlists:$,activePlaylistId:$[0]?.id||null}}if(Array.isArray(F)){const $=F.map(p=>M(p,p.name||Je));return{playlists:$,activePlaylistId:$[0]?.id||null}}if(!Array.isArray(F)&&"id"in F&&typeof F.id=="string"){const $=F;return{playlists:[M($,$.name||Je)],activePlaylistId:$.id}}return null},U=F=>{const $={};return F.forEach(p=>{if(!p.id)return;const L=E(p.device?.type||p.device_type),N=pt(p.playlist||[],!0),q=k(p);$[p.id]={id:p.id,name:p.name||Je,files:N,pre_lists:q,current_index:p.current_index||0,device:{address:p.device?.address||p.device_address||"",type:L,name:p.device?.name||null},schedule:p.schedule||{enabled:0,cron:"",duration:0},trigger_button:p.trigger_button||"",create_time:p.create_time||el(),updated_time:el()}}),$},oe=async F=>{try{const $=(F||e.value||[]).map(N=>({...N,total:Array.isArray(N.playlist)?N.playlist.length:0,updatedAt:Date.now()})),p=U($),L=await He("updateAll","POST",p);if(L.code!==0)throw new Error(L.msg||"保存播放列表集合失败")}catch($){de($,"保存播放列表集合失败")}},R=async F=>{try{const p=U([F])[F.id];if(!p)throw new Error("播放列表数据格式错误");const L=await He("update","POST",p);if(L.code!==0)throw new Error(L.msg||"更新播放列表失败");return!0}catch($){return de($,"更新播放列表失败"),!1}},x=F=>{const $=Array.isArray(F)?F:e.value;if(!$||$.length===0){r.value=null,f.value="";return}const p=$.find(q=>q.id===f.value)||$[0];f.value=p.id;const L=T(p.current_index,p.playlist?.length||0),N=V(p.pre_lists)?p.pre_lists.map(q=>[...q||[]]):b();r.value={...p,playlist:[...p.playlist||[]],pre_lists:N,current_index:L,pre_index:m(p.pre_index,-1),in_pre_files:!1,isPlaying:t(p.isPlaying)}},P=F=>({...F,playlist:F.playlist.map($=>({...$})),pre_lists:V(F.pre_lists)?F.pre_lists.map($=>$.map(p=>({...p}))):b()}),w=async F=>{if(typeof F!="function")return null;let $=e.value.length>0?e.value.map(P):[M({name:Je})],p=$.findIndex(ae=>ae.id===f.value);p===-1&&(p=0,f.value=$[0].id);const L=$[p],N=F(P(L))||L,q=M(N,L.name);return V(q.pre_lists)||(q.pre_lists=V(L.pre_lists)?L.pre_lists.map(ae=>ae.map(ce=>({...ce}))):b()),$[p]=q,e.value=$,await R($[p]),x($),r.value},O=(F,$)=>{const p=localStorage.getItem(Ol);p&&F.some(L=>L.id===p)?f.value=p:f.value=$||""},y=async()=>{try{const F=await He("get","GET",{});if(F.code!==0)throw new Error(F.msg||"获取播放列表失败");const $=_(F.data),p=D($||null);return e.value=p.playlists,O(p.playlists,p.activePlaylistId),x(p.playlists),p}catch(F){dt.error("从接口加载播放列表失败:",F);const $=D(null);return e.value=$.playlists,O($.playlists,$.activePlaylistId),x($.playlists),$}},J=F=>F?!!(h.value!==null||i.value||l.value):!1;return{normalizePlaylistItem:M,normalizePlaylistCollection:D,transformApiDataToPlaylistFormat:_,transformPlaylistToApiFormat:U,savePlaylist:oe,updateSinglePlaylist:R,syncActivePlaylist:x,updateActivePlaylistData:w,loadPlaylist:y,refreshPlaylistStatus:async(F=!1,$=!1)=>{try{if(J($))return;if(u.value=!0,F){const p=f.value;if(!p)return;const L=await He("get","GET",{id:p});if(L.code!==0)throw new Error(L.msg||"获取播放列表状态失败");const N=_(L.data);if(!N?.playlists?.length)return;const q=N.playlists[0],ae=e.value.map(ce=>ce.id!==p?ce:{...ce,...q,playlist:q.playlist||ce.playlist,pre_lists:V(q.pre_lists)?q.pre_lists.map(Ie=>[...Ie||[]]):ce.pre_lists,current_index:q.current_index!==void 0?q.current_index:ce.current_index,isPlaying:t(q?.isPlaying)});e.value=ae,x(ae)}else await y()}catch(p){dt.error("刷新播放列表状态失败:",p)}finally{u.value=!1}}}}function xu(e,f,r,u,h,i,l,d,g){return{loadPlaylist:async()=>{try{const M=await He("get","GET",{});if(M.code!==0)throw new Error(M.msg||"获取播放列表失败");return M.data}catch(M){throw dt.error("从接口加载播放列表失败:",M),M}},handleSelectPlaylist:async M=>{!M||M===f.value||!e.value.find(D=>D.id===M)||(f.value=M,localStorage.setItem(Ol,M),i(e.value))},handleCreatePlaylist:async()=>{try{const M=`播放列表${e.value.length+1}`,{value:I}=await Ee.prompt("请输入播放列表名称","新建播放列表",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:M,inputPlaceholder:M,inputValidator:_=>!!_&&_.trim().length>0||"名称不能为空"});return{name:(I||M).trim()}}catch(M){if(M!=="cancel")throw M;return null}},handleCopyPlaylist:async M=>{if(!M)return null;const I=e.value.find(D=>D.id===M);if(!I)return null;try{const D=`${I.name}_副本`,{value:_}=await Ee.prompt("请输入播放列表名称","复制播放列表",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:D,inputPlaceholder:D,inputValidator:oe=>!!oe&&oe.trim().length>0||"名称不能为空"}),U=(_||D).trim();return{sourcePlaylist:I,name:U}}catch(D){if(D!=="cancel")throw D;return null}},handleDeletePlaylistGroup:async M=>{if(!M)return!1;if(e.value.length<=1)return z.warning("至少保留一个播放列表"),!1;const I=e.value.find(D=>D.id===M);if(!I)return!1;try{return await Ee.confirm(`确认删除播放列表"${I.name}"吗？`,"删除播放列表",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),!0}catch(D){if(D!=="cancel")throw D;return!1}},handlePlayPlaylist:async()=>{const M=r.value;if(!M||!M.id){z.warning("播放列表不存在");return}if(!M.playlist||M.playlist.length===0){z.warning("播放列表为空，请先添加文件");return}try{u.value=!0,await l(D=>{const _=Array.isArray(D.playlist)?D.playlist:[];return D.current_index=Math.max(0,Math.min(D.current_index||0,_.length-1)),D.total=_.length,D});const I=await He("play","POST",{id:M.id});if(I.code!==0)throw new Error(I.msg||"播放失败");await d(!0),z.success("开始播放")}catch(I){de(I,"播放失败")}finally{u.value=!1}},handlePlayNext:async()=>{const M=r.value;if(!M||!M.id){z.warning("播放列表不存在");return}if(!M.playlist||M.playlist.length===0){z.warning("播放列表为空，无法播放下一首");return}try{u.value=!0;const I=await He("playNext","POST",{id:M.id});if(I.code!==0)throw new Error(I.msg||"播放下一首失败");await d(!0),z.success("已切换到下一首")}catch(I){de(I,"播放下一首失败")}finally{u.value=!1}},handlePlayPre:async()=>{const M=r.value;if(!M||!M.id){z.warning("播放列表不存在");return}const I=g().length>0,D=M.playlist&&M.playlist.length>0;if(!I&&!D){z.warning("播放列表为空，无法播放上一首");return}try{u.value=!0;const _=await He("playPre","POST",{id:M.id});if(_.code!==0)throw new Error(_.msg||"播放上一首失败");await d(!0),z.success("已切换到上一首")}catch(_){de(_,"播放上一首失败")}finally{u.value=!1}},handleStopPlaylist:async()=>{const M=r.value;if(!M||!M.id){z.warning("播放列表不存在");return}try{h.value=!0;const I=await He("stop","POST",{id:M.id});if(I.code!==0)throw new Error(I.msg||"停止播放失败");await d(!0),z.success("已停止播放")}catch(I){de(I,"停止播放列表失败")}finally{h.value=!1}}}}function Fu(e,f,r,u,h,i){const l=()=>{const T=e.value?.schedule?.cron||"";h.value=T,f.value=!0},d=()=>{f.value=!1},g=T=>{T&&(e.value?(E(T),z.success("Cron 表达式已应用到当前播放列表")):z.warning("请先选择一个播放列表"))},a=T=>{u.value=T,r.value=!0},k=async T=>{e.value&&await i(b=>(b.schedule||(b.schedule={enabled:0,cron:"",duration:0}),b.schedule.enabled=T?1:0,b))},E=async T=>{e.value&&await i(b=>(b.schedule||(b.schedule={enabled:0,cron:"",duration:0}),b.schedule.cron=T,b))};return{handleOpenCronBuilder:l,handleCloseCronBuilder:d,handleCronBuilderApply:g,handleCronBuilderPreview:a,handleTogglePlaylistCronEnabled:k,handleUpdatePlaylistCron:E,handleUpdatePlaylistDuration:async T=>{e.value&&await i(b=>(b.schedule||(b.schedule={enabled:0,cron:"",duration:0}),b.schedule.duration=T||0,b))},handleUpdateTriggerButton:async T=>{e.value&&await i(b=>(b.trigger_button=T||"",b))},handlePreviewPlaylistCron:()=>{if(!e.value||!e.value.schedule?.cron){z.warning("请先设置 Cron 表达式");return}try{const T=e.value.schedule.cron,b=Yt(T,5);b&&b.length>0?(u.value=b,r.value=!0):z.warning("无法解析 Cron 表达式")}catch(T){de(T,"预览失败")}}}}async function Mt(e,f,r){let u;const h="bluetooth";return f==="GET"?u=await Te.get(`/${h}/${e}`,{params:r}):u=await Te.post(`/${h}/${e}`,r),u.data}function Su(e,f,r,u,h,i,l,d,g,a,k,E){const A=w=>w.deviceID||w.address||"",m=async()=>{const w=e.value,O=f.value||w?.device?.type||w?.device_type||"dlna";if(!["agent","bluetooth"].includes(O)){r.value=[];return}try{l.value=!0;let y=null;O==="agent"?y=(await Te.get("/agent/list")).data:y=await Mt("paired","GET"),y.code===0?r.value=y.data||[]:z.error(y.msg||"获取设备失败")}catch(y){console.error("获取设备失败:",y),z.error("获取设备失败")}finally{l.value=!1}},t=async w=>{try{w.connecting=!0;const O=await Mt("connect","POST",{address:w.address});O.code===0?(z.success(`成功连接到设备: ${w.name}`),await m(),i.value=i.value.filter(y=>y.address!==w.address)):z.error(O.msg||"连接失败")}catch(O){console.error("连接设备失败:",O),z.error("连接设备失败")}finally{w.connecting=!1}},T=async()=>{try{d.value=!0;const w=await Te.get("/dlna/scan",{params:{timeout:5}});w.data.code===0?(u.value=w.data.data||[],z.success(`扫描到 ${u.value.length} 个 DLNA 设备`)):z.error(w.data.msg||"扫描 DLNA 设备失败")}catch(w){de(w,"扫描 DLNA 设备失败")}finally{d.value=!1}},b=async w=>{const O=A(w);if(!O)return;const y=h.value;if(!Array.isArray(y))return;const J=y.find(me=>A(me)===O);if(J){J._volumeRefreshing=!0;try{const me=await Te.get("/mi/volume",{params:{device_id:O}});me.data.code===0?J.volume=me.data.data?.volume??me.data.data??void 0:z.error(me.data.msg||`获取设备 ${J.name||O} 音量失败`)}catch(me){de(me,`获取设备 ${J.name||O} 音量失败`)}finally{J._volumeRefreshing=!1}}},V=async()=>{try{g.value=!0;const w=await Te.get("/mi/scan",{params:{timeout:5}});if(w.data.code===0){const O=(w.data.data||[]).map(y=>({...y,volume:void 0,_volumeChanging:!1,_volumeRefreshing:!1}));h.value=O,await Promise.allSettled(h.value.map(y=>b(y))),z.success(`扫描到 ${O.length} 个小米设备`)}else z.error(w.data.msg||"扫描小米设备失败")}catch(w){de(w,"扫描小米设备失败")}finally{g.value=!1}},M=async()=>{try{l.value=!0;const w=await Mt("scan","GET");if(w.code===0){const O=Array.isArray(w.data)?w.data:[];i.value=O.map(y=>({name:y.name||"",address:y.address||"",...y,connecting:!1})),z.success(`扫描完成，找到 ${i.value.length} 个设备`)}else z.error(w.msg||"扫描失败")}catch(w){console.error("扫描设备失败:",w),z.error("扫描设备失败")}finally{l.value=!1}},I=()=>{a.value=!0},D=()=>{a.value=!1},_=async w=>{if(!e.value||!w||w==="")return;if(!["agent","dlna","bluetooth","mi"].includes(w)){z.error(`无效的设备类型: ${w}`);return}const y=w;f.value=y;const J=e.value;J.device_type=y,J.device?J.device.type=y:J.device={type:y,address:"",name:null},await m()},U=async(w,O=null)=>{e.value&&(await E(y=>{const J=f.value||y.device?.type||y.device_type||"dlna";return y.device||(y.device={address:"",type:J,name:null}),y.device.type=J,y.device.address=w,O!==null&&(y.device.name=O),y.device_address=w,y.device_type=J,y}),f.value=null)};return{getMiDeviceId:A,refreshConnectedList:m,handleConnectDevice:t,scanDlnaDevices:T,getMiDeviceVolume:b,scanMiDevices:V,handleUpdateDeviceList:M,handleOpenScanDialog:I,handleCloseScanDialog:D,handleUpdatePlaylistDeviceType:_,handleUpdatePlaylistDeviceAddress:U,handleSelectBluetoothDevice:async w=>{const O=r.value.find(J=>J.address===w),y=O?O.name:null;await U(w,y)},handleSelectAgentDevice:async w=>{const O=typeof w=="string"?w:w.address,y=typeof w=="string"?null:w.name;await U(O,y)},handleSelectMiDevice:async w=>{const O=w.deviceID||w.address||"",y=w.name||"";await U(O,y)},handleOpenAgentListDialog:async()=>{k.value=!0,await m()}}}function _u(){const e=Sn({callbacks:{onPlay:()=>{z.success("开始播放")},onError:()=>{de(new Error("音频播放失败"),"播放失败"),f()},onEnded:()=>{f()}}}),f=()=>{e.clear()};return{audioPlayer:e,clearBrowserAudioPlayer:f,handlePlayFileInBrowser:d=>{const g=d?.uri||d?.path||"";if(!g||typeof g!="string"||g.trim()===""){z.warning("文件路径无效");return}if(e.playingFilePath.value===g&&e.audio&&!e.audio.paused){f(),z.info("已停止播放");return}const a=_n(g);if(!a||typeof a!="string"||a.trim()===""){z.error("无法生成媒体文件URL");return}if(a.includes("index.html")||a.endsWith(".html")){z.error("生成的媒体URL无效，可能是HTML页面");return}e.load(a,{playingFilePath:g}),e.play().catch(k=>{de(k,"播放失败"),f()})},isFilePlaying:d=>{const g=d?.uri||d?.path||"";return e.isFilePlaying(g)},getFilePlayProgress:d=>{const g=d?.uri||d?.path||"";return e.getFilePlayProgress(g)},getFileDuration:d=>{const g=d?.uri||d?.path||"",a=d?.duration||0;return e.getFileDuration(g,a)},handleSeekFile:(d,g)=>{const a=d?.uri||d?.path||"";e.seekFile(a,g)}}}function Pu(e,f,r,u,h,i,l,d,g,a,k,E,A,m,t){const T=()=>l.value!==null?l.value:Xe(),b=S=>((!S.pre_lists||!Array.isArray(S.pre_lists)||S.pre_lists.length!==7)&&(S.pre_lists=Array(7).fill(null).map(()=>[])),S.pre_lists),V=(S="请先选择一个播放列表")=>f.value?!0:(z.warning(S),!1),M=(S,Y)=>{S!=="cancel"&&de(S,Y)},I=async(S,Y)=>{try{r.value=!0,await S()}catch(K){M(K,Y)}finally{r.value=!1}},D=()=>{V()&&(u.value=!0,h.value="files",i.value=null)},_=()=>{V()&&(u.value=!0,h.value="pre_files",i.value=null)},U=async S=>{if(S.length!==0){if(!f.value){z.warning("请先创建并选择一个播放列表");return}try{r.value=!0,await E(K=>{const se=T(),ne=h.value,ee=ne==="pre_files"?Array.isArray(K.pre_lists)&&K.pre_lists.length===7?[...K.pre_lists[se]||[]]:[]:Array.isArray(K.playlist)?[...K.playlist]:[],ue=new Set;if(ee.forEach(ye=>{ye?.uri&&ue.add(ye.uri)}),i.value&&S.length>0){const ye=i.value.index;if(i.value.type==="pre_files"){b(K);const C=[...K.pre_lists[se]||[]];ye>=0&&ye<C.length&&(C[ye]={uri:S[0]},K.pre_lists[se]=C)}else{const C=[...K.playlist];ye>=0&&ye<C.length&&(C[ye]={uri:S[0]},K.playlist=C,K.total=C.length)}return i.value=null,K}for(const ye of S)if(!ue.has(ye)){const C={uri:ye};ee.push(C),ue.add(ye)}return ne==="pre_files"?(b(K),K.pre_lists[se]=ee):(K.playlist=ee,K.total=ee.length,ee.length===0?K.current_index=0:K.current_index>=ee.length&&(K.current_index=ee.length-1)),K});const Y=h.value==="pre_files"?"前置列表":"播放列表";z.success(`成功添加 ${S.length} 个文件到${Y}`),u.value=!1}catch(Y){de(Y,"添加文件到播放列表失败")}finally{r.value=!1}}},oe=()=>{u.value=!1},R=async S=>{const Y=f.value;if(!(!Y||S<=0||S>=Y.playlist.length))try{r.value=!0,await E(K=>{const se=[...K.playlist];return[se[S-1],se[S]]=[se[S],se[S-1]],K.playlist=se,K.current_index===S?K.current_index=S-1:K.current_index===S-1&&(K.current_index=S),K.total=se.length,K}),z.success("已上移")}catch(K){de(K,"上移失败")}finally{r.value=!1}},x=async S=>{const Y=f.value;if(!(!Y||S<0||S>=Y.playlist.length-1))try{r.value=!0,await E(K=>{const se=[...K.playlist];return[se[S],se[S+1]]=[se[S+1],se[S]],K.playlist=se,K.current_index===S?K.current_index=S+1:K.current_index===S+1&&(K.current_index=S),K.total=se.length,K}),z.success("已下移")}catch(K){de(K,"下移失败")}finally{r.value=!1}},P=async S=>{const Y=f.value;if(!Y||S<0||S>=Y.playlist.length)return;const se=Y.playlist[S]?.uri?.split("/").pop()||"文件";try{await Ee.confirm(`确定要删除 "${se}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),r.value=!0,await E(ne=>{const ee=[...ne.playlist];return ee.splice(S,1),ne.playlist=ee,ee.length===0?ne.current_index=0:S<ne.current_index?ne.current_index=Math.max(0,ne.current_index-1):S===ne.current_index&&(ne.current_index=Math.min(ne.current_index,ee.length-1)),ne.total=ee.length,ne}),z.success("已删除")}catch(ne){ne!=="cancel"&&de(ne,"删除失败")}finally{r.value=!1}},w=async S=>{const Y=f.value;!Y||S<0||S>=Y.playlist.length||(i.value={type:"files",index:S},h.value="files",u.value=!0)},O=async S=>{const Y=f.value,K=A();!Y||!K||S<=0||S>=K.length||await I(async()=>{await E(se=>{const ne=T();b(se);const ee=[...se.pre_lists[ne]||[]];return[ee[S-1],ee[S]]=[ee[S],ee[S-1]],se.pre_lists[ne]=ee,se})},"上移失败")},y=async S=>{const Y=f.value,K=A();!Y||!K||S<0||S>=K.length-1||await I(async()=>{await E(se=>{const ne=T();b(se);const ee=[...se.pre_lists[ne]||[]];return[ee[S],ee[S+1]]=[ee[S+1],ee[S]],se.pre_lists[ne]=ee,se})},"下移失败")},J=async S=>{const Y=f.value,K=A();if(!Y||!K||S<0||S>=K.length)return;const ne=K[S]?.uri?.split("/").pop()||"文件";try{await Ee.confirm(`确定要删除 "${ne}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await I(async()=>{await E(ee=>{const ue=T();b(ee);const ye=[...ee.pre_lists[ue]||[]];return ye.splice(S,1),ee.pre_lists[ue]=ye,ee}),z.success("已删除")},"删除失败")}catch(ee){M(ee,"删除失败")}},me=async S=>{const Y=f.value,K=A();!Y||!K||S<0||S>=K.length||(i.value={type:"pre_files",index:S},h.value="pre_files",u.value=!0)},F=()=>{d.value=!d.value,d.value||(a.value=[])},$=()=>{g.value=!g.value,g.value||(k.value=[])},p=S=>{const Y=a.value,K=Y.indexOf(S);K>-1?Y.splice(K,1):Y.push(S)},L=S=>{const Y=k.value,K=Y.indexOf(S);K>-1?Y.splice(K,1):Y.push(S)},N=async()=>{const S=f.value,Y=A(),K=a.value;if(!S||!Y||K.length===0)return;const se=K.length;try{await Ee.confirm(`确定要删除选中的 ${se} 个前置文件吗？`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await I(async()=>{const ne=[...new Set(K)].sort((ee,ue)=>ue-ee);await E(ee=>{const ue=T();b(ee);const ye=[...ee.pre_lists[ue]||[]];return ne.forEach(C=>{C>=0&&C<ye.length&&ye.splice(C,1)}),ee.pre_lists[ue]=ye,ee}),a.value=[],d.value=!1,z.success(`已删除 ${se} 个前置文件`)},"批量删除失败")}catch(ne){M(ne,"批量删除失败")}},q=async()=>{const S=f.value,Y=k.value;if(!S||!S.playlist||Y.length===0)return;const K=Y.length;try{await Ee.confirm(`确定要删除选中的 ${K} 个正式文件吗？`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await I(async()=>{const se=[...new Set(Y)].sort((ne,ee)=>ee-ne);await E(ne=>{const ee=[...ne.playlist];if(se.forEach(ue=>{ue>=0&&ue<ee.length&&ee.splice(ue,1)}),ne.playlist=ee,ee.length===0)ne.current_index=0;else{let ue=ne.current_index;se.forEach(ye=>{ye<ne.current_index?ue=Math.max(0,ue-1):ye===ne.current_index&&(ue=Math.min(ue,ee.length-1))}),ne.current_index=ue}return ne.total=ee.length,ne}),k.value=[],g.value=!1,z.success(`已删除 ${K} 个正式文件`)},"批量删除失败")}catch(se){M(se,"批量删除失败")}},ae=async()=>{const S=f.value,Y=A();if(!(!S||!Y||Y.length===0))try{await Ee.confirm(`确定要清空前置文件列表吗？此操作将删除所有 ${Y.length} 个前置文件。`,"确认清空",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await I(async()=>{await E(K=>{const se=T();return b(K),K.pre_lists[se]=[],K}),z.success("已清空前置文件列表")},"清空失败")}catch(K){M(K,"清空失败")}},ce=async()=>{const S=f.value;if(!(!S||!S.playlist||S.playlist.length===0))try{await Ee.confirm(`确定要清空正式文件列表吗？此操作将删除所有 ${S.playlist.length} 个正式文件。`,"确认清空",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await I(async()=>{await E(Y=>(Y.playlist=[],Y.total=0,Y.current_index=0,Y)),z.success("已清空正式文件列表")},"清空失败")}catch(Y){M(Y,"清空失败")}},Ie=async()=>{const S=f.value;if(!S)return;const Y=A(),K=Y&&Y.length||0,se=S.playlist&&S.playlist.length||0,ne=K+se;if(ne!==0)try{const ee=K>0&&se>0?`确定要清空播放列表 "${S.name}" 吗？此操作将删除所有 ${K} 个前置文件和 ${se} 个正式文件，共 ${ne} 个文件。`:K>0?`确定要清空播放列表 "${S.name}" 吗？此操作将删除所有 ${K} 个前置文件。`:`确定要清空播放列表 "${S.name}" 吗？此操作将删除所有 ${se} 个正式文件。`;await Ee.confirm(ee,"确认清空",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await I(async()=>{await E(ue=>(ue.playlist=[],b(ue),ue.pre_lists=ue.pre_lists.map(()=>[]),ue.total=0,ue.current_index=0,ue)),z.success("已清空播放列表（包括前置文件和正式文件）")},"清空失败")}catch(ee){M(ee,"清空失败")}},Fe=S=>typeof S=="string"?{uri:S}:{...S,uri:S.uri||""};return{handleOpenFileBrowser:D,handleOpenFileBrowserForPreFiles:_,handleFileBrowserConfirm:U,handleCloseFileBrowser:oe,handleMovePlaylistItemUp:R,handleMovePlaylistItemDown:x,handleDeletePlaylistItem:P,handleReplacePlaylistItem:w,handleMovePreFileUp:O,handleMovePreFileDown:y,handleDeletePreFile:J,handleReplacePreFile:me,handleTogglePreFilesBatchDeleteMode:F,handleToggleFilesBatchDeleteMode:$,handleTogglePreFileSelection:p,handleToggleFileSelection:L,handleBatchDeletePreFiles:N,handleBatchDeleteFiles:q,handleClearPreFiles:ae,handleClearFiles:ce,handleClearPlaylist:Ie,handleOpenPlaylistSelectorForPreFile:async S=>{try{if(!S){z.warning("文件信息无效");return}if(t&&m){const Y=Fe(S);t.value=[Y],m.value=!0}else z.info("请使用文件浏览器添加文件到播放列表")}catch(Y){dt.error("打开播放列表选择器失败:",Y),z.error("打开对话框失败")}},handleOpenPlaylistSelectorForFile:async S=>{try{if(!S){z.warning("文件信息无效");return}const Y=Fe(S);if(!Y.uri){z.warning("文件URI无效");return}t&&m?(t.value=[Y],m.value=!0):z.info("请使用文件浏览器添加文件到播放列表")}catch(Y){dt.error("打开播放列表选择器失败:",Y),z.error("打开对话框失败")}}}}function Tu(e,f,r,u,h,i,l,d,g,a,k,E,A){const m=()=>a.value!==null?a.value:Xe(),t=(x,P)=>{if(!x||!P||x.length!==P.length)return!0;for(let w=0;w<x.length;w++){const O=x[w]?.uri||x[w],y=P[w]?.uri||P[w];if(O!==y)return!0}return!1};return{handleTogglePreFilesDragMode:async()=>{if(u.value){const x=f.value,P=A();if(x&&P&&P.length>0){if(t(d.value||[],P))try{r.value=!0,await k(O=>{const y=m();return(!O.pre_lists||!Array.isArray(O.pre_lists)||O.pre_lists.length!==7)&&(O.pre_lists=Array(7).fill(null).map(()=>[])),O.pre_lists[y]=[...P],O.pre_index=x.pre_index,O}),z.success("排序已保存")}catch(O){de(O,"保存排序失败")}finally{r.value=!1}d.value=null}}else{const x=f.value,P=A();x&&P&&P.length>0&&(d.value=[...P]),i.value=null}u.value=!u.value},handleToggleFilesDragMode:async()=>{if(h.value){const x=f.value;if(x&&x.playlist&&x.playlist.length>0){if(t(g.value||[],x.playlist))try{r.value=!0,await k(w=>(w.playlist=[...x.playlist||[]],w.current_index=x.current_index,w.total=x.playlist.length,w)),z.success("排序已保存")}catch(w){de(w,"保存排序失败")}finally{r.value=!1}g.value=null}}else{const x=f.value;x&&x.playlist&&x.playlist.length>0&&(g.value=[...x.playlist||[]]),l.value=null}h.value=!h.value},handlePreFileDragStart:(x,P)=>{if(!u.value){x.preventDefault();return}try{x.dataTransfer.effectAllowed="move",x.dataTransfer.setData("text/plain",P.toString())}catch(w){console.error("拖拽开始失败:",w)}},handlePreFileDragEnd:x=>{const P=x.currentTarget;P&&P.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")},handlePreFileDragOver:x=>{if(!u.value)return;x.preventDefault(),x.dataTransfer.dropEffect="move";const P=x.currentTarget;if(P){const w=P.getBoundingClientRect(),O=x.clientY,y=w.top+w.height/2;P.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500"),O<y?P.classList.add("border-t-2","border-blue-500"):P.classList.add("border-b-2","border-blue-500")}},handlePreFileDrop:(x,P)=>{if(!u.value)return;x.preventDefault();const w=x.currentTarget;w&&w.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500");const O=parseInt(x.dataTransfer.getData("text/plain"),10);if(O===P||isNaN(O))return;const y=f.value,J=A();if(!y||!J||O<0||O>=J.length||P<0||P>=J.length)return;const me=m(),F=[...J],[$]=F.splice(O,1);F.splice(P,0,$);let p=y.pre_index;y.pre_index!==void 0&&y.pre_index!==null&&y.pre_index>=0&&(y.pre_index===O?p=P:O<y.pre_index&&P>=y.pre_index?p=y.pre_index-1:O>y.pre_index&&P<=y.pre_index&&(p=y.pre_index+1));const L=e.value.map(N=>N.id===y.id?((!N.pre_lists||!Array.isArray(N.pre_lists)||N.pre_lists.length!==7)&&(N.pre_lists=Array(7).fill(null).map(()=>[])),{...N,pre_lists:N.pre_lists.map((q,ae)=>ae===me?F:q),pre_index:p}):N);e.value=L,E(L)},handleFileDragStart:(x,P)=>{if(!h.value){x.preventDefault();return}try{x.dataTransfer.effectAllowed="move",x.dataTransfer.setData("text/plain",P.toString())}catch(w){console.error("拖拽开始失败:",w)}},handleFileDragEnd:x=>{const P=x.currentTarget;P&&P.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")},handleFileDragOver:x=>{if(!h.value)return;x.preventDefault(),x.dataTransfer.dropEffect="move";const P=x.currentTarget;if(P){const w=P.getBoundingClientRect(),O=x.clientY,y=w.top+w.height/2;P.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500"),O<y?P.classList.add("border-t-2","border-blue-500"):P.classList.add("border-b-2","border-blue-500")}},handleFileDrop:(x,P)=>{if(!h.value)return;x.preventDefault();const w=x.currentTarget;w&&w.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500");const O=parseInt(x.dataTransfer.getData("text/plain"),10);if(O===P||isNaN(O))return;const y=f.value;if(!y||!y.playlist||O<0||O>=y.playlist.length||P<0||P>=y.playlist.length)return;const J=[...y.playlist||[]],[me]=J.splice(O,1);J.splice(P,0,me);let F=y.current_index;y.current_index!==void 0&&y.current_index!==null&&y.current_index>=0&&(y.current_index===O?F=P:O<y.current_index&&P>=y.current_index?F=y.current_index-1:O>y.current_index&&P<=y.current_index&&(F=y.current_index+1));const $=e.value.map(p=>p.id===y.id?{...p,playlist:J,current_index:F,total:J.length}:p);e.value=$,E($)}}}function Bu(e,f,r,u,h,i){const l=G(!1),d=G(null),g=G("");return{editNameDialogVisible:l,editNameDialogName:g,handleStartEditPlaylistName:A=>{const m=e.value.find(t=>t.id===A);m&&(d.value=A,g.value=m.name,l.value=!0)},handleSavePlaylistName:async()=>{if(!d.value)return;const A=g.value?.trim();if(!A||A.length===0){z.warning("播放列表名称不能为空");return}const m=d.value,t=e.value.find(T=>T.id===m);if(!t||t.name===A){l.value=!1,d.value=null,g.value="";return}try{const T=e.value.map(b=>b.id===m?{...b,name:A}:b);e.value=T,m===f.value&&i(T),await h(T),l.value=!1,d.value=null,g.value="",z.success("播放列表名称已更新")}catch(T){de(T,"更新播放列表名称失败")}},handleCancelEditPlaylistName:()=>{l.value=!1,d.value=null,g.value=""}}}const Eu={class:"p-1"},Au={class:"flex gap-4 h-[calc(100vh-150px)]"},Hu=ke({__name:"index",setup(e){const{playlistCollection:f,activePlaylistId:r,playlistStatus:u,playlistLoading:h,playlistRefreshing:i,playing:l,stopping:d,showMoreActions:g,editingPlaylistId:a,editingPlaylistName:k,fileBrowserDialogVisible:E,fileBrowserTarget:A,replaceFileInfo:m,selectedWeekdayIndex:t,preFilesDragMode:T,filesDragMode:b,preFilesBatchDeleteMode:V,filesBatchDeleteMode:M,selectedPreFileIndices:I,selectedFileIndices:D,preFilesExpanded:_,playlistSelectorVisible:U,playlistSelectorSelectedFiles:oe,batchDrawerVisible:R,cronBuilderVisible:x,cronPreviewVisible:P,cronPreviewTimes:w,initialCronExpr:O,agentListDialogVisible:y,scanDialogVisible:J,loading:me,deviceList:F,connectedDeviceList:$,dlnaDeviceList:p,dlnaScanning:L,miDeviceList:N,miScanning:q,pendingDeviceType:ae,preFilesSortOrder:ce,filesSortOrder:Ie,preFilesOriginalOrder:Fe,filesOriginalOrder:we}=ku(),{audioPlayer:W,handlePlayFileInBrowser:S,handleSeekFile:Y}=_u(),K=()=>t.value!==null?t.value:Xe(),se=()=>{const fe=u.value;if(!fe||!fe.pre_lists)return[];const re=K();return!Array.isArray(fe.pre_lists)||fe.pre_lists.length!==7?[]:fe.pre_lists[re]||[]},{savePlaylist:ne,syncActivePlaylist:ee,updateActivePlaylistData:ue,loadPlaylist:ye,refreshPlaylistStatus:C}=Du(f,r,u,i,ae,T,b),H=async fe=>{await ue(fe)},{handleOpenFileBrowser:Z,handleOpenFileBrowserForPreFiles:ve,handleFileBrowserConfirm:Ge,handleCloseFileBrowser:at,handleMovePlaylistItemUp:he,handleMovePlaylistItemDown:Pe,handleDeletePlaylistItem:ot,handleReplacePlaylistItem:Il,handleMovePreFileUp:Rl,handleMovePreFileDown:zl,handleDeletePreFile:Ul,handleReplacePreFile:Vl,handleTogglePreFilesBatchDeleteMode:Kl,handleToggleFilesBatchDeleteMode:Gl,handleTogglePreFileSelection:jl,handleToggleFileSelection:Wl,handleBatchDeletePreFiles:Hl,handleBatchDeleteFiles:Yl,handleClearPreFiles:Jl,handleClearFiles:ql,handleClearPlaylist:Xl,handleOpenPlaylistSelectorForPreFile:Ql,handleOpenPlaylistSelectorForFile:Zl}=Pu(f,u,h,E,A,m,t,V,M,I,D,H,se,U,oe),{handleTogglePreFilesDragMode:es,handleToggleFilesDragMode:ts,handlePreFileDragStart:ls,handlePreFileDragEnd:ss,handlePreFileDragOver:ns,handlePreFileDrop:as,handleFileDragStart:os,handleFileDragEnd:is,handleFileDragOver:rs,handleFileDrop:ds}=Tu(f,u,h,T,b,ce,Ie,Fe,we,t,H,ee,se),{editNameDialogVisible:Ft,editNameDialogName:St,handleStartEditPlaylistName:us,handleSavePlaylistName:_t,handleCancelEditPlaylistName:ct}=Bu(f,r,a,k,ne,ee),{handleOpenCronBuilder:cs,handleCloseCronBuilder:fs,handleCronBuilderApply:ps,handleCronBuilderPreview:vs,handleTogglePlaylistCronEnabled:ms,handleUpdatePlaylistCron:gs,handleUpdatePlaylistDuration:ys,handleUpdateTriggerButton:hs,handlePreviewPlaylistCron:bs}=Fu(u,x,P,w,O,ue),{refreshConnectedList:Jt,handleConnectDevice:ws,scanDlnaDevices:$s,scanMiDevices:Cs,handleUpdateDeviceList:ks,handleOpenScanDialog:Ds,handleCloseScanDialog:xs,handleUpdatePlaylistDeviceType:Fs,handleUpdatePlaylistDeviceAddress:Ss,handleSelectBluetoothDevice:_s,handleSelectAgentDevice:Ps,handleSelectMiDevice:Ts,handleOpenAgentListDialog:Bs}=Su(u,ae,$,p,N,F,me,L,q,J,y,ue),{handleSelectPlaylist:Es,handleCreatePlaylist:As,handleCopyPlaylist:Ms,handleDeletePlaylistGroup:Ns,handlePlayPlaylist:Ls,handlePlayNext:Os,handlePlayPre:Is,handleStopPlaylist:Rs}=xu(f,r,u,l,d,ee,ue,C,se),zs=async fe=>{await Es(fe),ae.value=null,ce.value=null,Ie.value=null,T.value=!1,b.value=!1,Fe.value=null,we.value=null,V.value=!1,M.value=!1,I.value=[],D.value=[],await Jt()},Us=async(fe,re)=>{fe==="delete"?await Ns(re):fe==="copy"&&await Ms(re)},Vs=async fe=>{try{if(h.value=!0,!f.value.find($e=>$e.id===fe.playlistId)){z.warning("播放列表不存在");return}await ue($e=>{if($e.id!==fe.playlistId)return $e;if(fe.preLists.length>0&&((!$e.pre_lists||!Array.isArray($e.pre_lists)||$e.pre_lists.length!==7)&&($e.pre_lists=Array(7).fill(null).map(()=>[])),fe.preLists.forEach(pe=>{if(pe>=0&&pe<7){const Se=new Set(($e.pre_lists[pe]||[]).map(Me=>typeof Me=="string"?Me:Me?.uri||""));fe.files.forEach(Me=>{Se.has(Me)||($e.pre_lists[pe]||($e.pre_lists[pe]=[]),$e.pre_lists[pe].push({uri:Me}))})}})),fe.filesList){Array.isArray($e.playlist)||($e.playlist=[]);const pe=new Set($e.playlist.map(Se=>typeof Se=="string"?Se:Se?.uri||""));fe.files.forEach(Se=>{pe.has(Se)||$e.playlist.push({uri:Se})}),$e.total=$e.playlist.length}return $e}),ee(f.value),await ne(f.value)}catch(re){de(re,"批量添加文件失败")}finally{h.value=!1}},Ks=async fe=>{try{if(h.value=!0,!f.value.find(pe=>pe.id===fe.playlistId)){z.warning("播放列表不存在");return}const $e=new Set(fe.files);await ue(pe=>(pe.id!==fe.playlistId||(fe.preLists.length>0&&pe.pre_lists&&Array.isArray(pe.pre_lists)&&pe.pre_lists.length===7&&fe.preLists.forEach(Se=>{Se>=0&&Se<7&&pe.pre_lists[Se]&&(pe.pre_lists[Se]=pe.pre_lists[Se].filter(Me=>{const Tt=typeof Me=="string"?Me:Me?.uri||"";return!$e.has(Tt)}))}),fe.filesList&&Array.isArray(pe.playlist)&&(pe.playlist=pe.playlist.filter(Se=>{const Me=typeof Se=="string"?Se:Se?.uri||"";return!$e.has(Me)}),pe.total=pe.playlist.length,pe.playlist.length===0?pe.current_index=0:pe.current_index>=pe.playlist.length&&(pe.current_index=pe.playlist.length-1))),pe)),ee(f.value),await ne(f.value)}catch(re){de(re,"批量删除文件失败")}finally{h.value=!1}},Gs=async()=>{await Bs()},js=fe=>{t.value=fe,ee(f.value)},Pt=G(!0),{start:qt,stop:Xt}=Pn(async()=>{await C(!0,!0)},Pi,{immediate:!1,autoCleanup:!0}),Ws=fe=>{Pt.value=fe,fe?qt():Xt()};return nt(async()=>{await ye(),await Jt(),Pt.value&&qt()}),wl(()=>{Xt()}),(fe,re)=>{const $e=bl,pe=hl,Se=Vt,Me=ze,Tt=ut;return v(),B("div",Eu,[o("div",Au,[n(No,{"playlist-collection":s(f),"active-playlist-id":s(r),refreshing:s(i),"auto-refresh-enabled":Pt.value,onSelect:zs,onCreate:s(As),onRefresh:s(C),onToggleAutoRefresh:Ws,onMenuCommand:Us},null,8,["playlist-collection","active-playlist-id","refreshing","auto-refresh-enabled","onCreate","onRefresh"]),n(Fi,{"playlist-status":s(u),"active-playlist-id":s(r),"editing-playlist-id":s(a),"editing-playlist-name":s(k),"onUpdate:editingPlaylistName":re[0]||(re[0]=Ce=>ft(k)?k.value=Ce:null),"selected-weekday-index":s(t),"pre-files-drag-mode":s(T),"pre-files-batch-delete-mode":s(V),"selected-pre-file-indices":s(I),"pre-files-expanded":s(_),"files-drag-mode":s(b),"files-batch-delete-mode":s(M),"selected-file-indices":s(D),"playlist-loading":s(h),playing:s(l),stopping:s(d),"show-more-actions":s(g),"audio-player":s(W),onStartEditName:s(us),onSaveName:s(_t),onCancelEditName:s(ct),onOpenBatchDrawer:re[1]||(re[1]=Ce=>R.value=!0),onPlay:s(Ls),onPlayPre:s(Is),onPlayNext:s(Os),onStop:s(Rs),onClear:s(Xl),onToggleMoreActions:re[2]||(re[2]=Ce=>g.value=!s(g)),onSelectWeekday:js,onOpenFileBrowserForPreFiles:s(ve),onTogglePreFilesDragMode:s(es),onTogglePreFilesBatchDeleteMode:s(Kl),onBatchDeletePreFiles:s(Hl),onClearPreFiles:s(Jl),onTogglePreFilesExpand:re[3]||(re[3]=Ce=>_.value=!s(_)),onTogglePreFileSelection:s(jl),onPreFileDragStart:s(ls),onPreFileDragEnd:s(ss),onPreFileDragOver:s(ns),onPreFileDrop:s(as),onOpenFileBrowser:s(Z),onToggleFilesDragMode:s(ts),onToggleFilesBatchDeleteMode:s(Gl),onBatchDeleteFiles:s(Yl),onClearFiles:s(ql),onToggleFileSelection:s(Wl),onFileDragStart:s(os),onFileDragEnd:s(is),onFileDragOver:s(rs),onFileDrop:s(ds),onPlayFile:s(S),onSeekFile:s(Y),onMovePreFileUp:s(Rl),onMovePreFileDown:s(zl),onReplacePreFile:s(Vl),onOpenPlaylistSelectorForPreFile:s(Ql),onDeletePreFile:s(Ul),onMoveFileUp:s(he),onMoveFileDown:s(Pe),onReplaceFile:s(Il),onOpenPlaylistSelectorForFile:s(Zl),onDeleteFile:s(ot)},null,8,["playlist-status","active-playlist-id","editing-playlist-id","editing-playlist-name","selected-weekday-index","pre-files-drag-mode","pre-files-batch-delete-mode","selected-pre-file-indices","pre-files-expanded","files-drag-mode","files-batch-delete-mode","selected-file-indices","playlist-loading","playing","stopping","show-more-actions","audio-player","onStartEditName","onSaveName","onCancelEditName","onPlay","onPlayPre","onPlayNext","onStop","onClear","onOpenFileBrowserForPreFiles","onTogglePreFilesDragMode","onTogglePreFilesBatchDeleteMode","onBatchDeletePreFiles","onClearPreFiles","onTogglePreFileSelection","onPreFileDragStart","onPreFileDragEnd","onPreFileDragOver","onPreFileDrop","onOpenFileBrowser","onToggleFilesDragMode","onToggleFilesBatchDeleteMode","onBatchDeleteFiles","onClearFiles","onToggleFileSelection","onFileDragStart","onFileDragEnd","onFileDragOver","onFileDrop","onPlayFile","onSeekFile","onMovePreFileUp","onMovePreFileDown","onReplacePreFile","onOpenPlaylistSelectorForPreFile","onDeletePreFile","onMoveFileUp","onMoveFileDown","onReplaceFile","onOpenPlaylistSelectorForFile","onDeleteFile"]),n(wr,{"playlist-status":s(u),"connected-device-list":s($),"dlna-device-list":s(p),"mi-device-list":s(N),loading:s(me),"dlna-scanning":s(L),"mi-scanning":s(q),"on-toggle-cron-enabled":s(ms),"on-update-cron":s(gs),"on-update-duration":s(ys),"on-update-trigger-button":s(hs),"on-open-cron-builder":s(cs),"on-preview-cron":s(bs),"on-update-device-type":s(Fs),"on-update-device-address":s(Ss),"on-select-bluetooth-device":s(_s),"on-select-agent-device":s(Ps),"on-select-mi-device":s(Ts),"on-scan-dlna-devices":s($s),"on-scan-mi-devices":s(Cs),"on-open-scan-dialog":s(Ds),"on-open-device-list":Gs},null,8,["playlist-status","connected-device-list","dlna-device-list","mi-device-list","loading","dlna-scanning","mi-scanning","on-toggle-cron-enabled","on-update-cron","on-update-duration","on-update-trigger-button","on-open-cron-builder","on-preview-cron","on-update-device-type","on-update-device-address","on-select-bluetooth-device","on-select-agent-device","on-select-mi-device","on-scan-dlna-devices","on-scan-mi-devices","on-open-scan-dialog"])]),n(Cl,{visible:s(E),"onUpdate:visible":re[5]||(re[5]=Ce=>E.value=Ce),title:"选择文件添加到播放列表","confirm-button-text":"添加","confirm-loading":s(h),onConfirm:s(Ge),onClose:s(at)},{"footer-prepend":c(()=>[n(pe,{modelValue:s(A),"onUpdate:modelValue":re[4]||(re[4]=Ce=>ft(A)?A.value=Ce:null),size:"small",class:"w-[150px]"},{default:c(()=>[n($e,{label:"添加到主列表",value:"files"}),n($e,{label:"添加到前置列表",value:"pre_files"})]),_:1},8,["modelValue"])]),_:1},8,["visible","confirm-loading","onConfirm","onClose"]),n(vo,{visible:s(x),"initial-cron":s(O),"onUpdate:visible":re[6]||(re[6]=Ce=>x.value=Ce),onApply:s(ps),onPreview:s(vs),onClose:s(fs)},null,8,["visible","initial-cron","onApply","onPreview","onClose"]),n(ho,{visible:s(P),times:s(w),"onUpdate:visible":re[7]||(re[7]=Ce=>P.value=Ce),onClose:re[8]||(re[8]=Ce=>P.value=!1)},null,8,["visible","times"]),n(kr,{visible:s(J),"device-list":s(F),loading:s(me),"onUpdate:visible":re[9]||(re[9]=Ce=>J.value=Ce),onRefresh:s(ks),onConnect:s(ws),onClose:s(xs)},null,8,["visible","device-list","loading","onRefresh","onConnect","onClose"]),n(rd,{visible:s(y),"onUpdate:visible":re[10]||(re[10]=Ce=>y.value=Ce)},null,8,["visible"]),n(Ld,{visible:s(U),"playlist-collection":s(f),"selected-files":s(oe),"onUpdate:visible":re[11]||(re[11]=Ce=>U.value=Ce)},null,8,["visible","playlist-collection","selected-files"]),n(Tt,{modelValue:s(Ft),"onUpdate:modelValue":re[13]||(re[13]=Ce=>ft(Ft)?Ft.value=Ce:null),title:"编辑播放列表名称",width:"400",onClose:s(ct)},{footer:c(()=>[n(Me,{onClick:s(ct)},{default:c(()=>[...re[15]||(re[15]=[X("取消",-1)])]),_:1},8,["onClick"]),n(Me,{type:"primary",onClick:s(_t)},{default:c(()=>[...re[16]||(re[16]=[X("确定",-1)])]),_:1},8,["onClick"])]),default:c(()=>[n(Se,{modelValue:s(St),"onUpdate:modelValue":re[12]||(re[12]=Ce=>ft(St)?St.value=Ce:null),placeholder:"请输入播放列表名称",onKeyup:[It(s(_t),["enter"]),It(s(ct),["esc"])],clearable:"",autofocus:""},null,8,["modelValue","onKeyup"])]),_:1},8,["modelValue","onClose"]),n(Cu,{visible:s(R),"playlist-collection":s(f),"onUpdate:visible":re[14]||(re[14]=Ce=>R.value=Ce),onRefresh:s(C),"on-add-files":Vs,"on-remove-files":Ks},null,8,["visible","playlist-collection","onRefresh"])])}}});export{Hu as default};
