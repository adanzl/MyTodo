import{z as et,bc as Hs,c as le,X as Ys,r as K,Z as Le,$ as gt,bd as rl,q as Rt,_ as Ue,d as ke,H as Js,b7 as qs,s as tt,U as dl,e as te,g as v,f as c,b as n,a0 as Xs,B as s,w as be,a1 as Qs,k as o,an as Oe,a2 as ge,a as T,l as Q,I as oe,J as xe,t as G,a3 as Be,a4 as Zs,O as $t,aQ as Pe,ac as en,M as Ct,y as Ve,o as nt,L as Ze,A as Re,ae as kt,be as Ke,bf as rt,bg as tn,ag as zt,aW as Ne,ap as ln,aq as sn,aN as st,bh as it,bi as nn,bj as Bt,af as He,ao as an,bk as ul,bl as on,bm as rn,bn as dn,i as ze,G as cl,aJ as un,bo as fl,b5 as pl,a9 as Je,F as De,bp as Qt,N as Ut,aL as yt,as as Et,P as At,bq as Nt,aH as Lt,aI as Ot,br as cn,bs as fn,bt as pn,bu as vn,Y as mn,aP as It,bv as Qe,aK as Zt,aM as gn,b8 as yn,K as hn,v as bn,j as q,h as Vt,m as z,bw as re,C as Ae,bx as qe,aB as ht,by as wn,bz as $n,bA as vl,bB as Kt,bC as bt,bD as Gt,bE as je,bF as ml,bG as gl,aX as Cn,aA as yl,bH as kn,aC as hl,aG as bl,aV as wl,aS as Te,ba as dt,bI as ft}from"./index.Bk_h8V15.js";import{i as Dn,f as jt,c as wt,M as $l,E as xn,a as Ee,_ as Cl,n as pt,u as Fn,g as _n,b as Pn}from"./useInterval.DqfcxnPY.js";import"./dayjs.min.CmIfYB6q.js";import{d as Sn,a as Tn,b as Bn,c as En,e as kl,E as ut}from"./index.BFmhhbKo.js";import{b as An,E as Mn}from"./index.DWo3i1Hu.js";import{g as Xe,f as Nn,a as el}from"./date.DYSMdAfs.js";import{b as Dt,E as Dl,a as xl}from"./index.DkJRzER-.js";import{E as Ln}from"./index.CwcOvHZ1.js";import{v as Wt}from"./directive.XQ77cII-.js";import{g as On,s as In}from"./rds.Cjv7SuOv.js";import"./omit.BYRWldEZ.js";import"./_baseEach.D8pnrPCx.js";import"./_createBaseEach.BDK-o74b.js";const Rn=et({...Tn,direction:{type:String,default:"rtl",values:["ltr","rtl","ttb","btt"]},resizable:Boolean,size:{type:[String,Number],default:"30%"},withHeader:{type:Boolean,default:!0},modalFade:{type:Boolean,default:!0},headerAriaLevel:{type:String,default:"2"}}),zn={...Sn,"resize-start":(e,f)=>e instanceof MouseEvent&&typeof f=="number",resize:(e,f)=>e instanceof MouseEvent&&typeof f=="number","resize-end":(e,f)=>e instanceof MouseEvent&&typeof f=="number"};function Un(e,f,r){const{width:d,height:b}=Hs(),i=le(()=>["ltr","rtl"].includes(e.direction)),l=le(()=>["ltr","ttb"].includes(e.direction)?1:-1),u=le(()=>i.value?d.value:b.value),y=le(()=>Ys(a.value+l.value*m.value,4,u.value)),a=K(0),m=K(0),B=K(!1),M=K(!1);let $=[],t=[];const A=()=>{var g;const P=(g=f.value)==null?void 0:g.closest('[aria-modal="true"]');return P?i.value?P.offsetWidth:P.offsetHeight:100};Le(()=>[e.size,e.resizable],()=>{M.value=!1,a.value=0,m.value=0,E()});const w=g=>{e.resizable&&(M.value||(a.value=A(),M.value=!0),$=[g.pageX,g.pageY],B.value=!0,r("resize-start",g,a.value),t.push(gt(window,"mouseup",E),gt(window,"mousemove",U)))},U=g=>{const{pageX:P,pageY:ee}=g,de=P-$[0],R=ee-$[1];m.value=i.value?de:R,r("resize",g,y.value)},E=g=>{B.value&&($=[],a.value=y.value,m.value=0,B.value=!1,t.forEach(P=>P?.()),t=[],g&&r("resize-end",g,a.value))},I=gt(f,"mousedown",w);return rl(()=>{I(),E()}),{size:le(()=>M.value?`${y.value}px`:Rt(e.size)),isResizing:B,isHorizontal:i}}const Vn=["aria-label","aria-labelledby","aria-describedby"],Kn=["id","aria-level"],Gn=["aria-label"],jn=["id"],Wn=ke({name:"ElDrawer",inheritAttrs:!1,__name:"drawer",props:Rn,emits:zn,setup(e,{expose:f,emit:r}){const d=e,b=r,i=Js();qs({scope:"el-drawer",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/drawer.html#slots"},le(()=>!!i.title));const l=K(),u=K(),y=K(),a=tt("drawer"),{t:m}=dl(),{afterEnter:B,afterLeave:M,beforeLeave:$,visible:t,rendered:A,titleId:w,bodyId:U,zIndex:E,onModalClick:I,onOpenAutoFocus:g,onCloseAutoFocus:P,onFocusoutPrevented:ee,onCloseRequested:de,handleClose:R}=Bn(d,l),{isHorizontal:x,size:S,isResizing:C}=Un(d,y,b),O=le(()=>d.modalPenetrable&&!d.modal);return f({handleClose:R,afterEnter:B,afterLeave:M}),(h,Y)=>(v(),te(s(en),{to:h.appendTo,disabled:h.appendTo!=="body"?!1:!h.appendToBody},{default:c(()=>[n(Xs,{name:s(a).b("fade"),onAfterEnter:s(B),onAfterLeave:s(M),onBeforeLeave:s($),persisted:""},{default:c(()=>{var me;return[be(n(s(En),{mask:h.modal,"overlay-class":[s(a).is("drawer"),(me=h.modalClass)!=null?me:"",`${s(a).namespace.value}-modal-drawer`,s(a).is("penetrable",O.value)],"z-index":s(E),onClick:s(I)},{default:c(()=>[n(s(Qs),{loop:"",trapped:s(t),"focus-trap-el":l.value,"focus-start-el":u.value,onFocusAfterTrapped:s(g),onFocusAfterReleased:s(P),onFocusoutPrevented:s(ee),onReleaseRequested:s(de)},{default:c(()=>[o("div",Oe({ref_key:"drawerRef",ref:l,"aria-modal":"true","aria-label":h.title||void 0,"aria-labelledby":h.title?void 0:s(w),"aria-describedby":s(U)},h.$attrs,{class:[s(a).b(),h.direction,s(t)&&"open",s(a).is("dragging",s(C))],style:{[s(x)?"width":"height"]:s(S)},role:"dialog",onClick:Y[1]||(Y[1]=ge(()=>{},["stop"]))}),[o("span",{ref_key:"focusStartRef",ref:u,class:oe(s(a).e("sr-focus")),tabindex:"-1"},null,2),h.withHeader?(v(),T("header",{key:0,class:oe([s(a).e("header"),h.headerClass])},[h.$slots.title?xe(h.$slots,"title",{key:1},()=>[Q(" DEPRECATED SLOT ")]):xe(h.$slots,"header",{key:0,close:s(R),titleId:s(w),titleClass:s(a).e("title")},()=>[o("span",{id:s(w),role:"heading","aria-level":h.headerAriaLevel,class:oe(s(a).e("title"))},G(h.title),11,Kn)]),h.showClose?(v(),T("button",{key:2,"aria-label":s(m)("el.drawer.close"),class:oe(s(a).e("close-btn")),type:"button",onClick:Y[0]||(Y[0]=(...F)=>s(R)&&s(R)(...F))},[n(s(Be),{class:oe(s(a).e("close"))},{default:c(()=>[n(s(Zs))]),_:1},8,["class"])],10,Gn)):Q("v-if",!0)],2)):Q("v-if",!0),s(A)?(v(),T("div",{key:1,id:s(U),class:oe([s(a).e("body"),h.bodyClass])},[xe(h.$slots,"default")],10,jn)):Q("v-if",!0),h.$slots.footer?(v(),T("div",{key:2,class:oe([s(a).e("footer"),h.footerClass])},[xe(h.$slots,"footer")],2)):Q("v-if",!0),h.resizable?(v(),T("div",{key:3,ref_key:"draggerRef",ref:y,style:$t({zIndex:s(E)}),class:oe(s(a).e("dragger"))},null,6)):Q("v-if",!0)],16,Vn)]),_:3},8,["trapped","focus-trap-el","focus-start-el","onFocusAfterTrapped","onFocusAfterReleased","onFocusoutPrevented","onReleaseRequested"])]),_:3},8,["mask","overlay-class","z-index","onClick"]),[[Pe,s(t)]])]}),_:3},8,["name","onAfterEnter","onAfterLeave","onBeforeLeave"])]),_:3},8,["to","disabled"]))}});var Hn=Ue(Wn,[["__file","/home/runner/work/element-plus/element-plus/packages/components/drawer/src/drawer.vue"]]);const Fl=Ct(Hn),Yn=ke({inheritAttrs:!1});function Jn(e,f,r,d,b,i){return xe(e.$slots,"default")}var qn=Ue(Yn,[["render",Jn],["__file","/home/runner/work/element-plus/element-plus/packages/components/collection/src/collection.vue"]]);const Xn=ke({name:"ElCollectionItem",inheritAttrs:!1});function Qn(e,f,r,d,b,i){return xe(e.$slots,"default")}var Zn=Ue(Xn,[["render",Qn],["__file","/home/runner/work/element-plus/element-plus/packages/components/collection/src/collection-item.vue"]]);const _l="data-el-collection-item",ea=e=>{const f=`El${e}Collection`,r=`${f}Item`,d=Symbol(f),b=Symbol(r),i=Object.assign({},qn,{name:f,setup(){const u=K(),y=new Map;Ze(d,{itemMap:y,getItems:()=>{const m=s(u);if(!m)return[];const B=Array.from(m.querySelectorAll(`[${_l}]`));return[...y.values()].sort(($,t)=>B.indexOf($.ref)-B.indexOf(t.ref))},collectionRef:u})}}),l=Object.assign({},Zn,{name:r,setup(u,{attrs:y}){const a=K(),m=Ve(d,void 0);Ze(b,{collectionItemRef:a}),nt(()=>{const B=s(a);B&&m.itemMap.set(B,{ref:B,...y})}),rl(()=>{const B=s(a);m.itemMap.delete(B)})}});return{COLLECTION_INJECTION_KEY:d,COLLECTION_ITEM_INJECTION_KEY:b,ElCollection:i,ElCollectionItem:l}},ta=et({style:{type:Re([String,Array,Object])},currentTabId:{type:Re(String)},defaultCurrentTabId:String,loop:Boolean,dir:{type:String,values:["ltr","rtl"],default:"ltr"},orientation:{type:Re(String)},onBlur:Function,onFocus:Function,onMousedown:Function}),{ElCollection:la,ElCollectionItem:sa,COLLECTION_INJECTION_KEY:Pl,COLLECTION_ITEM_INJECTION_KEY:na}=ea("RovingFocusGroup"),Ht=Symbol("elRovingFocusGroup"),Sl=Symbol("elRovingFocusGroupItem"),aa={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"},oa=(e,f)=>e,ia=(e,f,r)=>{const d=kt(e),b=oa(d);return aa[b]},ra=(e,f)=>e.map((r,d)=>e[(d+f)%e.length]),tl=e=>{const{activeElement:f}=document;for(const r of e)if(r===f||(r.focus(),f!==document.activeElement))return},ll="currentTabIdChange",sl="rovingFocusGroup.entryFocus",da={bubbles:!1,cancelable:!0},ua=ke({name:"ElRovingFocusGroupImpl",inheritAttrs:!1,props:ta,emits:[ll,"entryFocus"],setup(e,{emit:f}){var r;const d=K((r=e.currentTabId||e.defaultCurrentTabId)!=null?r:null),b=K(!1),i=K(!1),l=K(),{getItems:u}=Ve(Pl,void 0),y=le(()=>[{outline:"none"},e.style]),a=w=>{f(ll,w)},m=()=>{b.value=!0},B=Ke(w=>{var U;(U=e.onMousedown)==null||U.call(e,w)},()=>{i.value=!0}),M=Ke(w=>{var U;(U=e.onFocus)==null||U.call(e,w)},w=>{const U=!s(i),{target:E,currentTarget:I}=w;if(E===I&&U&&!s(b)){const g=new Event(sl,da);if(I?.dispatchEvent(g),!g.defaultPrevented){const P=u().filter(S=>S.focusable),ee=P.find(S=>S.active),de=P.find(S=>S.id===s(d)),x=[ee,de,...P].filter(Boolean).map(S=>S.ref);tl(x)}}i.value=!1}),$=Ke(w=>{var U;(U=e.onBlur)==null||U.call(e,w)},()=>{b.value=!1}),t=(...w)=>{f("entryFocus",...w)},A=w=>{const U=ia(w);if(U){w.preventDefault();let I=u().filter(g=>g.focusable).map(g=>g.ref);switch(U){case"last":{I.reverse();break}case"prev":case"next":{U==="prev"&&I.reverse();const g=I.indexOf(w.currentTarget);I=e.loop?ra(I,g+1):I.slice(g+1);break}}zt(()=>{tl(I)})}};Ze(Ht,{currentTabbedId:tn(d),loop:rt(e,"loop"),tabIndex:le(()=>s(b)?-1:0),rovingFocusGroupRef:l,rovingFocusGroupRootStyle:y,orientation:rt(e,"orientation"),dir:rt(e,"dir"),onItemFocus:a,onItemShiftTab:m,onBlur:$,onFocus:M,onMousedown:B,onKeydown:A}),Le(()=>e.currentTabId,w=>{d.value=w??null}),gt(l,sl,t)}});function ca(e,f,r,d,b,i){return xe(e.$slots,"default")}var fa=Ue(ua,[["render",ca],["__file","/home/runner/work/element-plus/element-plus/packages/components/roving-focus-group/src/roving-focus-group-impl.vue"]]);const pa=ke({name:"ElRovingFocusGroup",components:{ElFocusGroupCollection:la,ElRovingFocusGroupImpl:fa}});function va(e,f,r,d,b,i){const l=Ne("el-roving-focus-group-impl"),u=Ne("el-focus-group-collection");return v(),te(u,null,{default:c(()=>[n(l,ln(sn(e.$attrs)),{default:c(()=>[xe(e.$slots,"default")]),_:3},16)]),_:3})}var ma=Ue(pa,[["render",va],["__file","/home/runner/work/element-plus/element-plus/packages/components/roving-focus-group/src/roving-focus-group.vue"]]);const ga=et({trigger:{...Bt.trigger,type:Re([String,Array])},triggerKeys:{type:Re(Array),default:()=>[He.enter,He.numpadEnter,He.space,He.down]},virtualTriggering:Bt.virtualTriggering,virtualRef:Bt.virtualRef,effect:{...it.effect,default:"light"},type:{type:Re(String)},placement:{type:Re(String),default:"bottom"},popperOptions:{type:Re(Object),default:()=>({})},id:String,size:{type:String,default:""},splitButton:Boolean,hideOnClick:{type:Boolean,default:!0},loop:{type:Boolean,default:!0},showArrow:{type:Boolean,default:!0},showTimeout:{type:Number,default:150},hideTimeout:{type:Number,default:150},tabindex:{type:Re([Number,String]),default:0},maxHeight:{type:Re([Number,String]),default:""},popperClass:it.popperClass,popperStyle:it.popperStyle,disabled:Boolean,role:{type:String,values:nn,default:"menu"},buttonProps:{type:Re(Object)},teleported:it.teleported,appendTo:it.appendTo,persistent:{type:Boolean,default:!0}}),Tl=et({command:{type:[Object,String,Number],default:()=>({})},disabled:Boolean,divided:Boolean,textValue:String,icon:{type:st}}),ya=et({onKeydown:{type:Re(Function)}}),xt=Symbol("elDropdown"),Bl="elDropdown",{ButtonGroup:ha}=ze,ba=ke({name:"ElDropdown",components:{ElButton:ze,ElButtonGroup:ha,ElScrollbar:dn,ElTooltip:rn,ElRovingFocusGroup:ma,ElOnlyChild:on,ElIcon:Be,ArrowDown:ul},props:ga,emits:["visible-change","click","command"],setup(e,{emit:f}){const r=pl(),d=tt("dropdown"),{t:b}=dl(),i=K(),l=K(),u=K(),y=K(),a=K(null),m=K(null),B=K(!1),M=le(()=>({maxHeight:Rt(e.maxHeight)})),$=le(()=>[d.m(g.value)]),t=le(()=>un(e.trigger)),A=fl().value,w=le(()=>e.id||A);function U(){var h;(h=u.value)==null||h.onClose(void 0,0)}function E(){var h;(h=u.value)==null||h.onClose()}function I(){var h;(h=u.value)==null||h.onOpen()}const g=cl();function P(...h){f("command",...h)}function ee(){}function de(){const h=s(y);t.value.includes("hover")&&h?.focus({preventScroll:!0}),m.value=null}function R(h){m.value=h}function x(){f("visible-change",!0)}function S(h){var Y;B.value=h?.type==="keydown",(Y=y.value)==null||Y.focus()}function C(){f("visible-change",!1)}return Ze(xt,{contentRef:y,role:le(()=>e.role),triggerId:w,isUsingKeyboard:B,onItemEnter:ee,onItemLeave:de,handleClose:E}),Ze(Bl,{instance:r,dropdownSize:g,handleClick:U,commandHandler:P,trigger:rt(e,"trigger"),hideOnClick:rt(e,"hideOnClick")}),{t:b,ns:d,scrollbar:a,wrapStyle:M,dropdownTriggerKls:$,dropdownSize:g,triggerId:w,currentTabId:m,handleCurrentTabIdChange:R,handlerMainButtonClick:h=>{f("click",h)},handleClose:E,handleOpen:I,handleBeforeShowTooltip:x,handleShowTooltip:S,handleBeforeHideTooltip:C,popperRef:u,contentRef:y,triggeringElementRef:i,referenceElementRef:l}}});function wa(e,f,r,d,b,i){var l;const u=Ne("el-roving-focus-group"),y=Ne("el-scrollbar"),a=Ne("el-only-child"),m=Ne("el-tooltip"),B=Ne("el-button"),M=Ne("arrow-down"),$=Ne("el-icon"),t=Ne("el-button-group");return v(),T("div",{class:oe([e.ns.b(),e.ns.is("disabled",e.disabled)])},[n(m,{ref:"popperRef",role:e.role,effect:e.effect,"fallback-placements":["bottom","top"],"popper-options":e.popperOptions,"gpu-acceleration":!1,placement:e.placement,"popper-class":[e.ns.e("popper"),e.popperClass],"popper-style":e.popperStyle,trigger:e.trigger,"trigger-keys":e.triggerKeys,"trigger-target-el":e.contentRef,"show-arrow":e.showArrow,"show-after":e.trigger==="hover"?e.showTimeout:0,"hide-after":e.trigger==="hover"?e.hideTimeout:0,"virtual-ref":(l=e.virtualRef)!=null?l:e.triggeringElementRef,"virtual-triggering":e.virtualTriggering||e.splitButton,disabled:e.disabled,transition:`${e.ns.namespace.value}-zoom-in-top`,teleported:e.teleported,"append-to":e.appendTo,pure:"","focus-on-target":"",persistent:e.persistent,onBeforeShow:e.handleBeforeShowTooltip,onShow:e.handleShowTooltip,onBeforeHide:e.handleBeforeHideTooltip},an({content:c(()=>[n(y,{ref:"scrollbar","wrap-style":e.wrapStyle,tag:"div","view-class":e.ns.e("list")},{default:c(()=>[n(u,{loop:e.loop,"current-tab-id":e.currentTabId,orientation:"horizontal",onCurrentTabIdChange:e.handleCurrentTabIdChange},{default:c(()=>[xe(e.$slots,"dropdown")]),_:3},8,["loop","current-tab-id","onCurrentTabIdChange"])]),_:3},8,["wrap-style","view-class"])]),_:2},[e.splitButton?void 0:{name:"default",fn:c(()=>[n(a,{id:e.triggerId,ref:"triggeringElementRef",role:"button",tabindex:e.tabindex},{default:c(()=>[xe(e.$slots,"default")]),_:3},8,["id","tabindex"])]),key:"0"}]),1032,["role","effect","popper-options","placement","popper-class","popper-style","trigger","trigger-keys","trigger-target-el","show-arrow","show-after","hide-after","virtual-ref","virtual-triggering","disabled","transition","teleported","append-to","persistent","onBeforeShow","onShow","onBeforeHide"]),e.splitButton?(v(),te(t,{key:0},{default:c(()=>[n(B,Oe({ref:"referenceElementRef"},e.buttonProps,{size:e.dropdownSize,type:e.type,disabled:e.disabled,tabindex:e.tabindex,onClick:e.handlerMainButtonClick}),{default:c(()=>[xe(e.$slots,"default")]),_:3},16,["size","type","disabled","tabindex","onClick"]),n(B,Oe({id:e.triggerId,ref:"triggeringElementRef"},e.buttonProps,{role:"button",size:e.dropdownSize,type:e.type,class:e.ns.e("caret-button"),disabled:e.disabled,tabindex:e.tabindex,"aria-label":e.t("el.dropdown.toggleDropdown")}),{default:c(()=>[n($,{class:oe(e.ns.e("icon"))},{default:c(()=>[n(M)]),_:1},8,["class"])]),_:1},16,["id","size","type","class","disabled","tabindex","aria-label"])]),_:3})):Q("v-if",!0)],2)}var $a=Ue(ba,[["render",wa],["__file","/home/runner/work/element-plus/element-plus/packages/components/dropdown/src/dropdown.vue"]]);const Ca=ke({components:{ElRovingFocusCollectionItem:sa},props:{focusable:{type:Boolean,default:!0},active:Boolean},emits:["mousedown","focus","keydown"],setup(e,{emit:f}){const{currentTabbedId:r,onItemFocus:d,onItemShiftTab:b,onKeydown:i}=Ve(Ht,void 0),l=fl(),u=K(),y=Ke(M=>{f("mousedown",M)},M=>{e.focusable?d(s(l)):M.preventDefault()}),a=Ke(M=>{f("focus",M)},()=>{d(s(l))}),m=Ke(M=>{f("keydown",M)},M=>{const{shiftKey:$,target:t,currentTarget:A}=M;if(kt(M)===He.tab&&$){b();return}t===A&&i(M)}),B=le(()=>r.value===s(l));return Ze(Sl,{rovingFocusGroupItemRef:u,tabIndex:le(()=>s(B)?0:-1),handleMousedown:y,handleFocus:a,handleKeydown:m}),{id:l,handleKeydown:m,handleFocus:a,handleMousedown:y}}});function ka(e,f,r,d,b,i){const l=Ne("el-roving-focus-collection-item");return v(),te(l,{id:e.id,focusable:e.focusable,active:e.active},{default:c(()=>[xe(e.$slots,"default")]),_:3},8,["id","focusable","active"])}var Da=Ue(Ca,[["render",ka],["__file","/home/runner/work/element-plus/element-plus/packages/components/roving-focus-group/src/roving-focus-item.vue"]]);const xa=ke({name:"DropdownItemImpl",components:{ElIcon:Be},props:Tl,emits:["pointermove","pointerleave","click","clickimpl"],setup(e,{emit:f}){const r=tt("dropdown"),{role:d}=Ve(xt,void 0),{collectionItemRef:b}=Ve(na,void 0),{rovingFocusGroupItemRef:i,tabIndex:l,handleFocus:u,handleKeydown:y,handleMousedown:a}=Ve(Sl,void 0),m=kl(b,i),B=le(()=>d.value==="menu"?"menuitem":d.value==="navigation"?"link":"button"),M=Ke($=>{const t=kt($);if([He.enter,He.numpadEnter,He.space].includes(t))return $.preventDefault(),$.stopImmediatePropagation(),f("clickimpl",$),!0},y);return{ns:r,itemRef:m,dataset:{[_l]:""},role:B,tabIndex:l,handleFocus:u,handleKeydown:M,handleMousedown:a}}}),Fa=["aria-disabled","tabindex","role"];function _a(e,f,r,d,b,i){const l=Ne("el-icon");return v(),T(De,null,[e.divided?(v(),T("li",{key:0,role:"separator",class:oe(e.ns.bem("menu","item","divided"))},null,2)):Q("v-if",!0),o("li",Oe({ref:e.itemRef},{...e.dataset,...e.$attrs},{"aria-disabled":e.disabled,class:[e.ns.be("menu","item"),e.ns.is("disabled",e.disabled)],tabindex:e.tabIndex,role:e.role,onClick:f[0]||(f[0]=u=>e.$emit("clickimpl",u)),onFocus:f[1]||(f[1]=(...u)=>e.handleFocus&&e.handleFocus(...u)),onKeydown:f[2]||(f[2]=ge((...u)=>e.handleKeydown&&e.handleKeydown(...u),["self"])),onMousedown:f[3]||(f[3]=(...u)=>e.handleMousedown&&e.handleMousedown(...u)),onPointermove:f[4]||(f[4]=u=>e.$emit("pointermove",u)),onPointerleave:f[5]||(f[5]=u=>e.$emit("pointerleave",u))}),[e.icon?(v(),te(l,{key:0},{default:c(()=>[(v(),te(Je(e.icon)))]),_:1})):Q("v-if",!0),xe(e.$slots,"default")],16,Fa)],64)}var Pa=Ue(xa,[["render",_a],["__file","/home/runner/work/element-plus/element-plus/packages/components/dropdown/src/dropdown-item-impl.vue"]]);const El=()=>{const e=Ve(Bl,{}),f=le(()=>e?.dropdownSize);return{elDropdown:e,_elDropdownSize:f}},Sa=ke({name:"ElDropdownItem",components:{ElRovingFocusItem:Da,ElDropdownItemImpl:Pa},inheritAttrs:!1,props:Tl,emits:["pointermove","pointerleave","click"],setup(e,{emit:f,attrs:r}){const{elDropdown:d}=El(),b=pl(),{onItemEnter:i,onItemLeave:l}=Ve(xt,void 0),u=Ke(B=>(f("pointermove",B),B.defaultPrevented),Qt(B=>{if(e.disabled){l(B);return}const M=B.currentTarget;M===document.activeElement||M.contains(document.activeElement)||(i(B),B.defaultPrevented||M?.focus({preventScroll:!0}))})),y=Ke(B=>(f("pointerleave",B),B.defaultPrevented),Qt(l)),a=Ke(B=>{if(!e.disabled)return f("click",B),B.type!=="keydown"&&B.defaultPrevented},B=>{var M,$,t;if(e.disabled){B.stopImmediatePropagation();return}(M=d?.hideOnClick)!=null&&M.value&&(($=d.handleClick)==null||$.call(d)),(t=d.commandHandler)==null||t.call(d,e.command,b,B)}),m=le(()=>({...e,...r}));return{handleClick:a,handlePointerMove:u,handlePointerLeave:y,propsAndAttrs:m}}});function Ta(e,f,r,d,b,i){const l=Ne("el-dropdown-item-impl"),u=Ne("el-roving-focus-item");return v(),te(u,{focusable:!e.disabled},{default:c(()=>[n(l,Oe(e.propsAndAttrs,{onPointerleave:e.handlePointerLeave,onPointermove:e.handlePointerMove,onClickimpl:e.handleClick}),{default:c(()=>[xe(e.$slots,"default")]),_:3},16,["onPointerleave","onPointermove","onClickimpl"])]),_:3},8,["focusable"])}var Al=Ue(Sa,[["render",Ta],["__file","/home/runner/work/element-plus/element-plus/packages/components/dropdown/src/dropdown-item.vue"]]);const Ba=ke({name:"ElDropdownMenu",props:ya,setup(e){const f=tt("dropdown"),{_elDropdownSize:r}=El(),d=r.value,{contentRef:b,role:i,triggerId:l,isUsingKeyboard:u,handleClose:y}=Ve(xt,void 0),{rovingFocusGroupRef:a,rovingFocusGroupRootStyle:m,onBlur:B,onFocus:M,onKeydown:$,onMousedown:t}=Ve(Ht,void 0),{collectionRef:A}=Ve(Pl,void 0),w=le(()=>[f.b("menu"),f.bm("menu",d?.value)]),U=kl(b,a,A),E=Ke(g=>{var P;(P=e.onKeydown)==null||P.call(e,g)},g=>{const{currentTarget:P,target:ee}=g,de=kt(g);if(P.contains(ee),He.tab===de)return y();$(g)});function I(g){u.value&&M(g)}return{size:d,rovingFocusGroupRootStyle:m,dropdownKls:w,role:i,triggerId:l,dropdownListWrapperRef:U,handleKeydown:E,onBlur:B,handleFocus:I,onMousedown:t}}}),Ea=["role","aria-labelledby"];function Aa(e,f,r,d,b,i){return v(),T("ul",{ref:e.dropdownListWrapperRef,class:oe(e.dropdownKls),style:$t(e.rovingFocusGroupRootStyle),tabindex:-1,role:e.role,"aria-labelledby":e.triggerId,onFocusin:f[0]||(f[0]=(...l)=>e.handleFocus&&e.handleFocus(...l)),onFocusout:f[1]||(f[1]=(...l)=>e.onBlur&&e.onBlur(...l)),onKeydown:f[2]||(f[2]=ge((...l)=>e.handleKeydown&&e.handleKeydown(...l),["self"])),onMousedown:f[3]||(f[3]=ge((...l)=>e.onMousedown&&e.onMousedown(...l),["self"]))},[xe(e.$slots,"default")],46,Ea)}var Ml=Ue(Ba,[["render",Aa],["__file","/home/runner/work/element-plus/element-plus/packages/components/dropdown/src/dropdown-menu.vue"]]);const Ma=Ct($a,{DropdownItem:Al,DropdownMenu:Ml}),Na=Ut(Al),La=Ut(Ml),Oa=et({modelValue:{type:[Boolean,String,Number],default:!1},disabled:{type:Boolean,default:void 0},loading:Boolean,size:{type:String,validator:Dn},width:{type:[String,Number],default:""},inlinePrompt:Boolean,inactiveActionIcon:{type:st},activeActionIcon:{type:st},activeIcon:{type:st},inactiveIcon:{type:st},activeText:{type:String,default:""},inactiveText:{type:String,default:""},activeValue:{type:[Boolean,String,Number],default:!0},inactiveValue:{type:[Boolean,String,Number],default:!1},name:{type:String,default:""},validateEvent:{type:Boolean,default:!0},beforeChange:{type:Re(Function)},id:String,tabindex:{type:[String,Number]},...cn(["ariaLabel"])}),Ia={[Ot]:e=>yt(e)||Et(e)||At(e),[Lt]:e=>yt(e)||Et(e)||At(e),[Nt]:e=>yt(e)||Et(e)||At(e)},Ra=["id","aria-checked","aria-disabled","aria-label","name","true-value","false-value","disabled","tabindex"],za=["aria-hidden"],Ua={key:1},Va={key:1},Ka=["aria-hidden"],nl="ElSwitch",Ga=ke({name:nl,__name:"switch",props:Oa,emits:Ia,setup(e,{expose:f,emit:r}){const d=e,b=r,{formItem:i}=fn(),l=cl(),u=tt("switch"),{inputId:y}=pn(d,{formItemContext:i}),a=vn(le(()=>{if(d.loading)return!0})),m=K(d.modelValue!==!1),B=mn(),M=le(()=>[u.b(),u.m(l.value),u.is("disabled",a.value),u.is("checked",U.value)]),$=le(()=>[u.e("label"),u.em("label","left"),u.is("active",!U.value)]),t=le(()=>[u.e("label"),u.em("label","right"),u.is("active",U.value)]),A=le(()=>({width:Rt(d.width)}));Le(()=>d.modelValue,()=>{m.value=!0});const w=le(()=>m.value?d.modelValue:!1),U=le(()=>w.value===d.activeValue);[d.activeValue,d.inactiveValue].includes(w.value)||(b(Ot,d.inactiveValue),b(Lt,d.inactiveValue),b(Nt,d.inactiveValue)),Le(U,P=>{var ee;B.value.checked=P,d.validateEvent&&((ee=i?.validate)==null||ee.call(i,"change").catch(de=>yn()))});const E=()=>{const P=U.value?d.inactiveValue:d.activeValue;b(Ot,P),b(Lt,P),b(Nt,P),zt(()=>{B.value.checked=U.value})},I=()=>{if(a.value)return;const{beforeChange:P}=d;if(!P){E();return}const ee=P();[Zt(ee),yt(ee)].includes(!0)||gn(nl,"beforeChange must return type `Promise<boolean>` or `boolean`"),Zt(ee)?ee.then(R=>{R&&E()}).catch(R=>{}):ee&&E()},g=()=>{var P,ee;(ee=(P=B.value)==null?void 0:P.focus)==null||ee.call(P)};return nt(()=>{B.value.checked=U.value}),f({focus:g,checked:U}),(P,ee)=>(v(),T("div",{class:oe(M.value),onClick:ge(I,["prevent"])},[o("input",{id:s(y),ref_key:"input",ref:B,class:oe(s(u).e("input")),type:"checkbox",role:"switch","aria-checked":U.value,"aria-disabled":s(a),"aria-label":P.ariaLabel,name:P.name,"true-value":P.activeValue,"false-value":P.inactiveValue,disabled:s(a),tabindex:P.tabindex,onChange:E,onKeydown:It(I,["enter"])},null,42,Ra),!P.inlinePrompt&&(P.inactiveIcon||P.inactiveText||P.$slots.inactive)?(v(),T("span",{key:0,class:oe($.value)},[xe(P.$slots,"inactive",{},()=>[P.inactiveIcon?(v(),te(s(Be),{key:0},{default:c(()=>[(v(),te(Je(P.inactiveIcon)))]),_:1})):Q("v-if",!0),!P.inactiveIcon&&P.inactiveText?(v(),T("span",{key:1,"aria-hidden":U.value},G(P.inactiveText),9,za)):Q("v-if",!0)])],2)):Q("v-if",!0),o("span",{class:oe(s(u).e("core")),style:$t(A.value)},[P.inlinePrompt?(v(),T("div",{key:0,class:oe(s(u).e("inner"))},[U.value?(v(),T("div",{key:1,class:oe(s(u).e("inner-wrapper"))},[xe(P.$slots,"active",{},()=>[P.activeIcon?(v(),te(s(Be),{key:0},{default:c(()=>[(v(),te(Je(P.activeIcon)))]),_:1})):Q("v-if",!0),!P.activeIcon&&P.activeText?(v(),T("span",Va,G(P.activeText),1)):Q("v-if",!0)])],2)):(v(),T("div",{key:0,class:oe(s(u).e("inner-wrapper"))},[xe(P.$slots,"inactive",{},()=>[P.inactiveIcon?(v(),te(s(Be),{key:0},{default:c(()=>[(v(),te(Je(P.inactiveIcon)))]),_:1})):Q("v-if",!0),!P.inactiveIcon&&P.inactiveText?(v(),T("span",Ua,G(P.inactiveText),1)):Q("v-if",!0)])],2))],2)):Q("v-if",!0),o("div",{class:oe(s(u).e("action"))},[P.loading?(v(),te(s(Be),{key:0,class:oe(s(u).is("loading"))},{default:c(()=>[n(s(Qe))]),_:1},8,["class"])):U.value?xe(P.$slots,"active-action",{key:1},()=>[P.activeActionIcon?(v(),te(s(Be),{key:0},{default:c(()=>[(v(),te(Je(P.activeActionIcon)))]),_:1})):Q("v-if",!0)]):U.value?Q("v-if",!0):xe(P.$slots,"inactive-action",{key:2},()=>[P.inactiveActionIcon?(v(),te(s(Be),{key:0},{default:c(()=>[(v(),te(Je(P.inactiveActionIcon)))]),_:1})):Q("v-if",!0)])],2)],6),!P.inlinePrompt&&(P.activeIcon||P.activeText||P.$slots.active)?(v(),T("span",{key:1,class:oe(t.value)},[xe(P.$slots,"active",{},()=>[P.activeIcon?(v(),te(s(Be),{key:0},{default:c(()=>[(v(),te(Je(P.activeIcon)))]),_:1})):Q("v-if",!0),!P.activeIcon&&P.activeText?(v(),T("span",{key:1,"aria-hidden":!U.value},G(P.activeText),9,Ka)):Q("v-if",!0)])],2)):Q("v-if",!0)],2))}});var ja=Ue(Ga,[["__file","/home/runner/work/element-plus/element-plus/packages/components/switch/src/switch.vue"]]);const Nl=Ct(ja),Wa="timeline",Ha=ke({name:"ElTimeline",props:{reverse:Boolean},setup(e,{slots:f}){const r=tt("timeline");return Ze(Wa,f),()=>{var d,b;const i=hn((b=(d=f.default)==null?void 0:d.call(f))!=null?b:[]).filter(l=>{var u;return((u=l?.type)==null?void 0:u.name)==="ElTimelineItem"});return bn("ul",{class:[r.b()]},e.reverse?i.reverse():i)}}}),Ya=et({timestamp:{type:String,default:""},hideTimestamp:Boolean,center:Boolean,placement:{type:String,values:["top","bottom"],default:"bottom"},type:{type:String,values:["primary","success","warning","danger","info"],default:""},color:{type:String,default:""},size:{type:String,values:["normal","large"],default:"normal"},icon:{type:st},hollow:Boolean}),Ja=ke({name:"ElTimelineItem",__name:"timeline-item",props:Ya,setup(e){const f=e,r=tt("timeline-item"),d=le(()=>[r.e("node"),r.em("node",f.size||""),r.em("node",f.type||""),r.is("hollow",f.hollow)]);return(b,i)=>(v(),T("li",{class:oe([s(r).b(),{[s(r).e("center")]:b.center}])},[o("div",{class:oe(s(r).e("tail"))},null,2),b.$slots.dot?Q("v-if",!0):(v(),T("div",{key:0,class:oe(d.value),style:$t({backgroundColor:b.color})},[b.icon?(v(),te(s(Be),{key:0,class:oe(s(r).e("icon"))},{default:c(()=>[(v(),te(Je(b.icon)))]),_:1},8,["class"])):Q("v-if",!0)],6)),b.$slots.dot?(v(),T("div",{key:1,class:oe(s(r).e("dot"))},[xe(b.$slots,"dot")],2)):Q("v-if",!0),o("div",{class:oe(s(r).e("wrapper"))},[!b.hideTimestamp&&b.placement==="top"?(v(),T("div",{key:0,class:oe([s(r).e("timestamp"),s(r).is("top")])},G(b.timestamp),3)):Q("v-if",!0),o("div",{class:oe(s(r).e("content"))},[xe(b.$slots,"default")],2),!b.hideTimestamp&&b.placement==="bottom"?(v(),T("div",{key:1,class:oe([s(r).e("timestamp"),s(r).is("bottom")])},G(b.timestamp),3)):Q("v-if",!0)],2)],2))}});var Ll=Ue(Ja,[["__file","/home/runner/work/element-plus/element-plus/packages/components/timeline/src/timeline-item.vue"]]);const qa=Ct(Ha,{TimelineItem:Ll}),Xa=Ut(Ll);function lt(e,f,r){if(e==="*"||!e||typeof e!="string")return null;const d=new Set,b=String(e).split(",");for(const i of b){const l=i.trim();if(l.includes("/")){const[u,y]=l.split("/"),a=parseInt(y,10);if(u==="*")for(let m=f;m<=r;m+=a)d.add(m);else if(u.includes("-")){const[m,B]=u.split("-").map(M=>parseInt(M,10));for(let M=m;M<=B;M+=a)d.add(M)}}else if(l.includes("-")){const[u,y]=l.split("-").map(a=>parseInt(a,10));for(let a=u;a<=y;a++)d.add(a)}else{const u=parseInt(l,10);!isNaN(u)&&u>=f&&u<=r&&d.add(u)}}return d.size>0?Array.from(d).sort((i,l)=>i-l):null}function Yt(e,f=3){try{if(!e||typeof e!="string")throw new Error("Cron 表达式必须是字符串类型");const r=String(e).trim().split(/\s+/);if(r.length!==6)throw new Error("Cron 表达式必须包含6个字段：秒 分 时 日 月 周");const[d,b,i,l,u,y]=r,a=lt(d,0,59),m=lt(b,0,59),B=lt(i,0,23),M=lt(l,1,31),$=lt(u,1,12);let t=lt(y,0,7);t&&t.includes(7)&&(t=t.filter(I=>I!==7),t.includes(0)||t.push(0),t.sort((I,g)=>I-g));const A=[],w=new Date;w.setMilliseconds(0),a&&!a.includes(w.getSeconds())&&(w.setSeconds(0),w.setMinutes(w.getMinutes()+1));let U=0;const E=1e4;for(;A.length<f&&U<E;){U++;const I=w.getMonth()+1;if($&&!$.includes(I)){let S=null;for(const C of $)if(C>I){S=C;break}S===null?(S=$[0],w.setFullYear(w.getFullYear()+1,S-1,1),w.setHours(0,0,a?a[0]:0)):(w.setMonth(S-1,1),w.setHours(0,0,a?a[0]:0));continue}const g=w.getDate(),P=w.getDay();let ee=!0;if(l!=="*"&&y!=="*"?ee=!!(M&&M.includes(g))||!!(t&&t.includes(P)):l!=="*"?ee=M?M.includes(g):!1:y!=="*"&&(ee=t?t.includes(P):!1),!ee){w.setDate(w.getDate()+1),w.setHours(0,0,a?a[0]:0);continue}const de=w.getHours();if(B&&!B.includes(de)){let S=null;for(const C of B)if(C>de){S=C;break}S===null?(w.setDate(w.getDate()+1),w.setHours(B[0],0,a?a[0]:0)):w.setHours(S,0,a?a[0]:0);continue}const R=w.getMinutes();if(m&&!m.includes(R)){let S=null;for(const C of m)if(C>R){S=C;break}if(S===null){let C=null;for(const O of B||[de])if(O>de){C=O;break}C===null?(w.setDate(w.getDate()+1),w.setHours(B?B[0]:0,m[0],a?a[0]:0)):w.setHours(C,m[0],a?a[0]:0)}else w.setMinutes(S,a?a[0]:0);continue}const x=w.getSeconds();if(a&&!a.includes(x)){let S=null;for(const C of a)if(C>x){S=C;break}S===null?(w.setMinutes(w.getMinutes()+1),w.setSeconds(a[0])):w.setSeconds(S);continue}if(w>new Date){const S=w.getFullYear()+"-"+String(w.getMonth()+1).padStart(2,"0")+"-"+String(w.getDate()).padStart(2,"0")+" "+String(w.getHours()).padStart(2,"0")+":"+String(w.getMinutes()).padStart(2,"0")+":"+String(w.getSeconds()).padStart(2,"0");A.push(S)}a&&a.length>0&&w.setSeconds(a[0]),w.setMinutes(w.getMinutes()+1)}return A.slice(0,f)}catch(r){throw console.error("计算 Cron 执行时间失败:",r),r}}function Qa(e){const f=e.second==="custom"?e.secondCustom||"*":e.second||"*",r=e.minute==="custom"?e.minuteCustom||"*":e.minute||"*",d=e.hour==="custom"?e.hourCustom||"*":e.hour||"*",b=e.day==="custom"?e.dayCustom||"*":e.day||"*",i=e.month==="custom"?e.monthCustom||"*":e.month||"*",l=e.weekday==="custom"?e.weekdayCustom||"*":e.weekday||"*";return`${f} ${r} ${d} ${b} ${i} ${l}`}function Za(){return`pl_${Date.now()}_${Math.random().toString(36).slice(2,7)}`}const eo={class:"space-y-4 m-4"},to={class:"flex items-center gap-2"},lo={class:"flex items-center gap-2"},so={class:"flex items-center gap-2"},no={class:"flex items-center gap-2"},ao={class:"flex items-center gap-2"},oo={class:"flex items-center gap-2"},io={class:"border-t pt-4"},ro={class:"flex gap-2"},uo={class:"border-t pt-4"},co={class:"space-y-2"},fo={class:"flex items-center gap-2 flex-wrap"},po=ke({__name:"CronDialog",props:{visible:{type:Boolean,default:!1},initialCron:{default:""}},emits:["update:visible","apply","preview","close"],setup(e,{emit:f}){const r=e,d=f,b=K(r.visible),i=K({second:"*",secondCustom:"",minute:"*",minuteCustom:"",hour:"*",hourCustom:"",day:"*",dayCustom:"",month:"*",monthCustom:"",weekday:"*",weekdayCustom:"",generated:""}),l=$=>{$.second="*",$.secondCustom="",$.minute="*",$.minuteCustom="",$.hour="*",$.hourCustom="",$.day="*",$.dayCustom="",$.month="*",$.monthCustom="",$.weekday="*",$.weekdayCustom="",$.generated=""},u=($,t)=>{try{if(!$||typeof $!="string"){l(t);return}const A=String($).trim().split(/\s+/);let w,U,E,I,g,P;if(A.length===5){const[ee,de,R,x,S]=A;ee==="0"&&de&&de.startsWith("*/")?(w="0",U=de,E=R||"*",I=x||"*",g=S||"*",P="*"):(U=ee,E=de,I=R,g=x,P=S,w="0")}else if(A.length===6)[w,U,E,I,g,P]=A;else{console.warn("Cron 表达式格式错误，部分数量:",A.length),l(t);return}A.length===5||A.length===6?(w==="*"?(t.second="*",t.secondCustom=""):w==="0"?(t.second="0",t.secondCustom=""):(t.second="custom",t.secondCustom=w),U==="*"?(t.minute="*",t.minuteCustom=""):U==="0"?(t.minute="0",t.minuteCustom=""):(U.startsWith("*/"),t.minute="custom",t.minuteCustom=U),E==="*"?(t.hour="*",t.hourCustom=""):E==="0"?(t.hour="0",t.hourCustom=""):(t.hour="custom",t.hourCustom=E),I==="*"?(t.day="*",t.dayCustom=""):(t.day="custom",t.dayCustom=I),g==="*"?(t.month="*",t.monthCustom=""):(t.month="custom",t.monthCustom=g),P==="*"?(t.weekday="*",t.weekdayCustom=""):P==="1-5"?(t.weekday="1-5",t.weekdayCustom=""):P==="0,6"||P==="6,0"?(t.weekday="0,6",t.weekdayCustom=""):(t.weekday="custom",t.weekdayCustom=P)):(console.warn("Cron 表达式格式错误，部分数量:",A.length),l(t))}catch(A){console.error("解析 Cron 表达式失败:",A),l(t)}},y=()=>{i.value.generated=Qa(i.value)},a=()=>{b.value=!1,d("close")},m=()=>{if(!i.value.generated){z.warning("请先生成 Cron 表达式");return}d("apply",i.value.generated),a()},B=()=>{const $=i.value.generated;if(!$){z.warning("请先生成 Cron 表达式");return}try{const t=Yt($,5);d("preview",t)}catch(t){re(t,"预览失败")}},M=$=>{try{u($,i.value),y(),zt(()=>{i.value.generated&&(d("apply",i.value.generated),z.success("示例已应用"))})}catch(t){re(t,"应用示例失败")}};return Le(()=>r.visible,$=>{b.value=$,$&&(r.initialCron?u(r.initialCron,i.value):l(i.value),y())},{immediate:!0}),Le(()=>r.initialCron,$=>{r.visible&&$&&(u($,i.value),y())}),Le(b,$=>{$!==r.visible&&d("update:visible",$)}),($,t)=>{const A=An,w=Mn,U=Vt,E=ze,I=ut;return v(),te(I,{modelValue:b.value,"onUpdate:modelValue":t[17]||(t[17]=g=>b.value=g),title:"Cron 表达式生成器",width:"700","before-close":a},{default:c(()=>[o("div",eo,[o("div",null,[t[22]||(t[22]=o("div",{class:"text-sm font-medium mb-2"},"秒 (0-59)",-1)),o("div",to,[n(w,{modelValue:i.value.second,"onUpdate:modelValue":t[0]||(t[0]=g=>i.value.second=g),onChange:y,class:"flex items-center"},{default:c(()=>[n(A,{label:"*",class:"!w-[80px]"},{default:c(()=>[...t[18]||(t[18]=[q("每秒钟",-1)])]),_:1}),n(A,{label:"0",class:"!w-[80px]"},{default:c(()=>[...t[19]||(t[19]=[q("第0秒",-1)])]),_:1}),n(A,{label:"30",class:"!w-[80px]"},{default:c(()=>[...t[20]||(t[20]=[q("第30秒",-1)])]),_:1}),n(A,{label:"custom",class:"!w-[80px]"},{default:c(()=>[...t[21]||(t[21]=[q("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),n(U,{modelValue:i.value.secondCustom,"onUpdate:modelValue":t[1]||(t[1]=g=>i.value.secondCustom=g),placeholder:"例如: 0,30 或 */10",disabled:i.value.second!=="custom",class:"!w-[200px]",onInput:y},null,8,["modelValue","disabled"])])]),o("div",null,[t[27]||(t[27]=o("div",{class:"text-sm font-medium mb-2"},"分 (0-59)",-1)),o("div",lo,[n(w,{modelValue:i.value.minute,"onUpdate:modelValue":t[2]||(t[2]=g=>i.value.minute=g),onChange:y,class:"flex items-center"},{default:c(()=>[n(A,{label:"*",class:"!w-[80px]"},{default:c(()=>[...t[23]||(t[23]=[q("每分钟",-1)])]),_:1}),n(A,{label:"0",class:"!w-[80px]"},{default:c(()=>[...t[24]||(t[24]=[q("第0分",-1)])]),_:1}),n(A,{label:"30",class:"!w-[80px]"},{default:c(()=>[...t[25]||(t[25]=[q("第30分",-1)])]),_:1}),n(A,{label:"custom",class:"!w-[80px]"},{default:c(()=>[...t[26]||(t[26]=[q("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),n(U,{modelValue:i.value.minuteCustom,"onUpdate:modelValue":t[3]||(t[3]=g=>i.value.minuteCustom=g),placeholder:"例如: 0,30 或 */15",disabled:i.value.minute!=="custom",class:"!w-[200px]",onInput:y},null,8,["modelValue","disabled"])])]),o("div",null,[t[32]||(t[32]=o("div",{class:"text-sm font-medium mb-2"},"时 (0-23)",-1)),o("div",so,[n(w,{modelValue:i.value.hour,"onUpdate:modelValue":t[4]||(t[4]=g=>i.value.hour=g),onChange:y,class:"flex items-center"},{default:c(()=>[n(A,{label:"*",class:"!w-[80px]"},{default:c(()=>[...t[28]||(t[28]=[q("每小时",-1)])]),_:1}),n(A,{label:"0",class:"!w-[80px]"},{default:c(()=>[...t[29]||(t[29]=[q("0点",-1)])]),_:1}),n(A,{label:"9",class:"!w-[80px]"},{default:c(()=>[...t[30]||(t[30]=[q("9点",-1)])]),_:1}),n(A,{label:"custom",class:"!w-[80px]"},{default:c(()=>[...t[31]||(t[31]=[q("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),n(U,{modelValue:i.value.hourCustom,"onUpdate:modelValue":t[5]||(t[5]=g=>i.value.hourCustom=g),placeholder:"例如: 9,12,18 或 */2",disabled:i.value.hour!=="custom",class:"!w-[200px]",onInput:y},null,8,["modelValue","disabled"])])]),o("div",null,[t[37]||(t[37]=o("div",{class:"text-sm font-medium mb-2"},"日 (1-31)",-1)),o("div",no,[n(w,{modelValue:i.value.day,"onUpdate:modelValue":t[6]||(t[6]=g=>i.value.day=g),onChange:y,class:"flex items-center"},{default:c(()=>[n(A,{label:"*",class:"!w-[80px]"},{default:c(()=>[...t[33]||(t[33]=[q("每天",-1)])]),_:1}),n(A,{label:"1",class:"!w-[80px]"},{default:c(()=>[...t[34]||(t[34]=[q("每月1号",-1)])]),_:1}),n(A,{label:"15",class:"!w-[80px]"},{default:c(()=>[...t[35]||(t[35]=[q("每月15号",-1)])]),_:1}),n(A,{label:"custom",class:"!w-[80px]"},{default:c(()=>[...t[36]||(t[36]=[q("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),n(U,{modelValue:i.value.dayCustom,"onUpdate:modelValue":t[7]||(t[7]=g=>i.value.dayCustom=g),placeholder:"例如: 1,15 或 */5",disabled:i.value.day!=="custom",class:"!w-[200px]",onInput:y},null,8,["modelValue","disabled"])])]),o("div",null,[t[42]||(t[42]=o("div",{class:"text-sm font-medium mb-2"},"月 (1-12)",-1)),o("div",ao,[n(w,{modelValue:i.value.month,"onUpdate:modelValue":t[8]||(t[8]=g=>i.value.month=g),onChange:y,class:"flex items-center"},{default:c(()=>[n(A,{label:"*",class:"!w-[80px]"},{default:c(()=>[...t[38]||(t[38]=[q("每月",-1)])]),_:1}),n(A,{label:"1",class:"!w-[80px]"},{default:c(()=>[...t[39]||(t[39]=[q("1月",-1)])]),_:1}),n(A,{label:"6",class:"!w-[80px]"},{default:c(()=>[...t[40]||(t[40]=[q("6月",-1)])]),_:1}),n(A,{label:"custom",class:"!w-[80px]"},{default:c(()=>[...t[41]||(t[41]=[q("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),n(U,{modelValue:i.value.monthCustom,"onUpdate:modelValue":t[9]||(t[9]=g=>i.value.monthCustom=g),placeholder:"例如: 1,6,12 或 */3",disabled:i.value.month!=="custom",class:"!w-[200px]",onInput:y},null,8,["modelValue","disabled"])])]),o("div",null,[t[47]||(t[47]=o("div",{class:"text-sm font-medium mb-2"},"周 (0-7, 0和7表示周日)",-1)),o("div",oo,[n(w,{modelValue:i.value.weekday,"onUpdate:modelValue":t[10]||(t[10]=g=>i.value.weekday=g),onChange:y,class:"flex items-center"},{default:c(()=>[n(A,{label:"*",class:"!w-[80px]"},{default:c(()=>[...t[43]||(t[43]=[q("每天",-1)])]),_:1}),n(A,{label:"1-5",class:"!w-[80px]"},{default:c(()=>[...t[44]||(t[44]=[q("工作日",-1)])]),_:1}),n(A,{label:"0,6",class:"!w-[80px]"},{default:c(()=>[...t[45]||(t[45]=[q("周末",-1)])]),_:1}),n(A,{label:"custom",class:"!w-[80px]"},{default:c(()=>[...t[46]||(t[46]=[q("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),n(U,{modelValue:i.value.weekdayCustom,"onUpdate:modelValue":t[11]||(t[11]=g=>i.value.weekdayCustom=g),placeholder:"例如: 1,3,5 或 1-5",disabled:i.value.weekday!=="custom",class:"!w-[200px]",onInput:y},null,8,["modelValue","disabled"])])]),o("div",io,[t[50]||(t[50]=o("div",{class:"text-sm font-medium mb-2"},"生成的 Cron 表达式：",-1)),n(U,{modelValue:i.value.generated,"onUpdate:modelValue":t[12]||(t[12]=g=>i.value.generated=g),readonly:"",class:"mb-2"},null,8,["modelValue"]),o("div",ro,[n(E,{type:"primary",size:"small",onClick:m},{default:c(()=>[...t[48]||(t[48]=[q(" 应用 ",-1)])]),_:1}),n(E,{type:"info",size:"small",onClick:B},{default:c(()=>[...t[49]||(t[49]=[q(" 预览执行时间 ",-1)])]),_:1})])]),o("div",uo,[t[55]||(t[55]=o("div",{class:"text-sm font-medium mb-2"},"常用示例：",-1)),o("div",co,[o("div",fo,[n(E,{size:"small",onClick:t[13]||(t[13]=g=>M("0 0 * * *"))},{default:c(()=>[...t[51]||(t[51]=[q(" 每天0点 ",-1)])]),_:1}),n(E,{size:"small",onClick:t[14]||(t[14]=g=>M("0 */30 * * *"))},{default:c(()=>[...t[52]||(t[52]=[q(" 每30分钟 ",-1)])]),_:1}),n(E,{size:"small",onClick:t[15]||(t[15]=g=>M("0 0 9 * * 1-5"))},{default:c(()=>[...t[53]||(t[53]=[q(" 工作日9点 ",-1)])]),_:1}),n(E,{size:"small",onClick:t[16]||(t[16]=g=>M("0 0 0 1 * *"))},{default:c(()=>[...t[54]||(t[54]=[q(" 每月1号0点 ",-1)])]),_:1})])])])])]),_:1},8,["modelValue"])}}}),vo={key:0},mo={class:"font-medium"},go={key:1,class:"text-center text-gray-400 py-4"},yo=ke({__name:"CronPreviewDialog",props:{visible:{type:Boolean,default:!1},times:{default:()=>[]}},emits:["update:visible","close"],setup(e,{emit:f}){const r=f,d=()=>{r("update:visible",!1),r("close")};return(b,i)=>{const l=Xa,u=qa,y=ut;return v(),te(y,{"model-value":e.visible,title:"Cron 执行时间预览",width:"500","onUpdate:modelValue":i[0]||(i[0]=a=>b.$emit("update:visible",a)),"before-close":d},{default:c(()=>[e.times&&e.times.length>0?(v(),T("div",vo,[i[1]||(i[1]=o("div",{class:"text-sm text-gray-600 mb-3"},"下5次执行时间：",-1)),n(u,null,{default:c(()=>[(v(!0),T(De,null,Ae(e.times,(a,m)=>(v(),te(l,{key:m,timestamp:a,placement:"top"},{default:c(()=>[o("div",mo,"第 "+G(m+1)+" 次执行",1)]),_:2},1032,["timestamp"]))),128))]),_:1})])):(v(),T("div",go," 无法解析 Cron 表达式，请检查格式是否正确 "))]),_:1},8,["model-value"])}}}),ho={class:"w-64 border rounded p-3 flex flex-col"},bo={class:"flex items-center justify-between mb-3"},wo={class:"flex items-center gap-1"},$o={key:0,class:"flex-1 overflow-y-auto space-y-2 pr-1"},Co=["onClick"],ko={class:"flex items-center justify-between gap-2"},Do={class:"text-sm font-medium truncate flex-1 min-w-0"},xo={class:"flex items-center gap-2 flex-shrink-0"},Fo={class:"text-xs text-gray-500 whitespace-nowrap flex items-center gap-1"},_o={class:"whitespace-nowrap w-5 flex items-center justify-center"},Po={class:"flex items-center justify-center"},So={class:"text-[10px] text-blue-600 min-h-[14px] flex items-center justify-between"},To={key:0,class:"flex items-center gap-1"},Bo={key:1,class:"invisible"},Eo={key:2,class:"text-gray-500 flex items-center gap-1"},Ao={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},Mo=ke({__name:"PlaylistList",props:{playlistCollection:{},activePlaylistId:{},refreshing:{type:Boolean},autoRefreshEnabled:{type:Boolean}},emits:["select","create","refresh","toggle-auto-refresh","menu-command"],setup(e){const f=r=>{if(!r||!r.schedule||r.schedule.enabled!==1||!r.schedule.cron||typeof r.schedule.cron!="string")return null;try{const d=String(r.schedule.cron).trim();if(!d)return null;const b=Yt(d,1);return b&&b.length>0?Nn(b[0]):null}catch{return null}};return(r,d)=>{const b=Nl,i=Be,l=ze,u=Na,y=La,a=Ma;return v(),T("div",ho,[o("div",bo,[d[4]||(d[4]=o("h3",{class:"text-base font-semibold"},"播放列表",-1)),o("div",wo,[n(b,{"model-value":e.autoRefreshEnabled,"onUpdate:modelValue":d[0]||(d[0]=m=>r.$emit("toggle-auto-refresh",m)),"active-text":"","inactive-text":"","active-color":"#409eff",size:"small",title:"自动刷新",class:"mr-1"},null,8,["model-value"]),n(l,{type:"primary",size:"small",plain:"",onClick:d[1]||(d[1]=m=>r.$emit("refresh")),loading:e.refreshing,title:"刷新播放列表",class:"!w-8 !h-6 !p-0"},{default:c(()=>[e.refreshing?Q("",!0):(v(),te(i,{key:0},{default:c(()=>[n(s(qe))]),_:1}))]),_:1},8,["loading"]),n(l,{type:"success",size:"small",onClick:d[2]||(d[2]=m=>r.$emit("create")),title:"新建播放列表",class:"!w-8 !h-6 !p-0"},{default:c(()=>[n(i,null,{default:c(()=>[n(s(ht))]),_:1})]),_:1})])]),e.playlistCollection&&e.playlistCollection.length>0?(v(),T("div",$o,[(v(!0),T(De,null,Ae(e.playlistCollection,m=>(v(),T("div",{key:m.id,class:oe(["border rounded px-3 py-2 cursor-pointer hover:bg-gray-50 group min-h-[60px] flex flex-col justify-between",{"border-blue-500 bg-blue-50":m.id===e.activePlaylistId}]),onClick:B=>r.$emit("select",m.id)},[o("div",ko,[o("div",Do,G(m.name),1),o("div",xo,[o("span",Fo,[n(i,null,{default:c(()=>[n(s(wn),{class:"!w-3 !h-3"})]),_:1}),o("span",_o,G((m.pre_lists&&m.pre_lists[s(Xe)()]&&m.pre_lists[s(Xe)()].length||0)+(m.playlist&&m.playlist.length||0)),1)]),o("div",Po,[n(a,{trigger:"click",onCommand:B=>r.$emit("menu-command",B,m.id),onClick:d[3]||(d[3]=ge(()=>{},["stop"]))},{dropdown:c(()=>[n(y,null,{default:c(()=>[n(u,{command:"copy"},{default:c(()=>[...d[6]||(d[6]=[o("span",null,"复制",-1)])]),_:1}),e.playlistCollection.length>1?(v(),te(u,{key:0,command:"delete",divided:""},{default:c(()=>[...d[7]||(d[7]=[o("span",{class:"text-[#f56c6c]"},"删除",-1)])]),_:1})):Q("",!0)]),_:1})]),default:c(()=>[n(l,{type:"default",size:"small",plain:"",circle:"",class:"!w-5 !h-5 !min-w-5 !p-0 text-xs",title:"更多"},{default:c(()=>[...d[5]||(d[5]=[o("span",{class:"text-base leading-none mb-1"},"»",-1)])]),_:1})]),_:1},8,["onCommand"])])])]),o("div",So,[f(m)?(v(),T("span",To,[n(i,{class:"!w-3 !h-4"},{default:c(()=>[n(s($n))]),_:1}),q(" "+G(f(m)),1)])):(v(),T("span",Bo,"占位")),m.trigger_button?(v(),T("span",Eo,[n(i,{class:"!w-3 !h-4"},{default:c(()=>[n(s(vl))]),_:1}),q(" "+G(m.trigger_button),1)])):Q("",!0)])],10,Co))),128))])):(v(),T("div",Ao,' 暂无播放列表，请点击"新建"创建 '))])}}}),No={class:"border rounded p-2 mb-2"},Lo={class:"flex items-center justify-between mb-2"},Oo={class:"flex items-center gap-1"},Io={class:"flex items-center gap-1"},Ro={class:"text-[10px]"},zo={class:"flex items-center justify-between text-xs text-gray-500 mb-2 pr-2.5"},Uo={class:"flex items-center"},Vo={key:0},Ko={class:"flex items-center gap-1"},Go=["draggable","onClick","onDragstart","onDrop"],jo={class:"text-xs text-gray-500 w-8"},Wo=["title"],Ho={key:1,class:"w-full border-t border-gray-200"},Yo={key:2,class:"text-sm text-gray-400 text-center py-1"},Jo=ke({__name:"PreFilesList",props:{playlistStatus:{},selectedWeekdayIndex:{},preFilesDragMode:{type:Boolean},preFilesBatchDeleteMode:{type:Boolean},selectedPreFileIndices:{},preFilesExpanded:{type:Boolean},playlistLoading:{type:Boolean},showMoreActions:{type:Boolean},audioPlayer:{}},emits:["select-weekday","open-file-browser","toggle-drag-mode","toggle-batch-delete-mode","batch-delete","clear","toggle-expand","toggle-selection","drag-start","drag-end","drag-over","drop","play-file","seek-file","move-up","move-down","replace","open-playlist-selector","delete"],setup(e){const f=e,r=()=>f.selectedWeekdayIndex!==null?f.selectedWeekdayIndex:Xe(),d=()=>{const l=f.playlistStatus;if(!l||!l.pre_lists)return[];const u=r();return!Array.isArray(l.pre_lists)||l.pre_lists.length!==7?[]:l.pre_lists[u]||[]},b=l=>{const u=f.playlistStatus;if(!u||!u.pre_lists||!Array.isArray(u.pre_lists)||u.pre_lists.length!==7)return 0;const y=u.pre_lists[l];return Array.isArray(y)?y.length:0},i=()=>{const l=d();return wt(l)};return(l,u)=>{const y=ze,a=Kt,m=Be,B=Dt;return v(),T("div",No,[o("div",Lo,[u[12]||(u[12]=o("div",{class:"text-xs font-semibold text-gray-600 w-39"},"前置文件（播放时优先播放）",-1)),o("div",Oo,[o("div",Io,[(v(),T(De,null,Ae(["周一","周二","周三","周四","周五","周六","周日"],(M,$)=>n(y,{key:$,type:e.selectedWeekdayIndex===$||e.selectedWeekdayIndex===null&&s(Xe)()===$?"primary":"default",size:"small",plain:"",onClick:t=>l.$emit("select-weekday",$),title:M,class:"!w-16 !h-6 !p-0 text-xs"},{default:c(()=>[q(G(M),1),o("span",Ro,"["+G(b($))+"]",1)]),_:2},1032,["type","onClick","title"])),64))])])]),o("div",zo,[o("div",Uo,[i()>0?(v(),T("span",Vo," 总时长："+G(s(jt)(i())),1)):Q("",!0),d()&&d().length>0?(v(),T("span",{key:1,class:oe(i()>0?"ml-2":"")}," 共 "+G(d().length)+" 首， 当前: "+G(e.playlistStatus?.pre_index!==void 0&&e.playlistStatus.pre_index!==null&&e.playlistStatus.pre_index>=0?e.playlistStatus.pre_index+1:"-")+" / "+G(d().length),3)):Q("",!0),e.playlistStatus?.isPlaying&&e.playlistStatus.in_pre_files===!0?(v(),te(a,{key:2,type:"success",size:"small",class:"ml-2"},{default:c(()=>[...u[13]||(u[13]=[q(" 播放中 ",-1)])]),_:1})):Q("",!0)]),o("div",Ko,[n(y,{type:"primary",size:"small",plain:"",onClick:u[0]||(u[0]=M=>l.$emit("open-file-browser")),disabled:!e.playlistStatus||e.preFilesDragMode||e.preFilesBatchDeleteMode},{default:c(()=>[...u[14]||(u[14]=[q(" + ",-1)])]),_:1},8,["disabled"]),n(y,{type:e.preFilesDragMode?"success":"default",size:"small",plain:"",class:"!w-8 !h-6",onClick:u[1]||(u[1]=M=>l.$emit("toggle-drag-mode")),disabled:!e.playlistStatus||!d()||d().length===0||e.preFilesBatchDeleteMode,title:e.preFilesDragMode?"点击退出拖拽排序模式":"点击进入拖拽排序模式"},{default:c(()=>[e.preFilesDragMode?(v(),te(m,{key:0},{default:c(()=>[n(s(bt))]),_:1})):(v(),te(m,{key:1},{default:c(()=>[n(s(Gt))]),_:1}))]),_:1},8,["type","disabled","title"]),n(y,{type:e.preFilesBatchDeleteMode?"success":"default",size:"small",plain:"",class:"!w-8 !h-6",onClick:u[2]||(u[2]=M=>l.$emit("toggle-batch-delete-mode")),disabled:!e.playlistStatus||!d()||d().length===0||e.preFilesDragMode,title:e.preFilesBatchDeleteMode?"点击退出批量删除模式":"点击进入批量删除模式"},{default:c(()=>[e.preFilesBatchDeleteMode?(v(),te(m,{key:0},{default:c(()=>[n(s(bt))]),_:1})):(v(),te(m,{key:1},{default:c(()=>[n(s(je))]),_:1}))]),_:1},8,["type","disabled","title"]),be(n(y,{type:"danger",size:"small",plain:"",class:"!w-8 !h-6",onClick:u[3]||(u[3]=M=>l.$emit("batch-delete")),disabled:e.playlistLoading||e.selectedPreFileIndices.length===0,title:`删除选中的 ${e.selectedPreFileIndices.length} 项`},{default:c(()=>[n(m,null,{default:c(()=>[n(s(je))]),_:1})]),_:1},8,["disabled","title"]),[[Pe,e.preFilesBatchDeleteMode]]),be(n(y,{type:"default",size:"small",plain:"",class:"!w-8 !h-6",onClick:u[4]||(u[4]=M=>l.$emit("clear")),disabled:!e.playlistStatus||!d()||d().length===0||e.playlistLoading||e.preFilesDragMode,title:"清空列表"},{default:c(()=>[n(m,null,{default:c(()=>[n(s(je))]),_:1})]),_:1},8,["disabled"]),[[Pe,e.showMoreActions&&!e.preFilesBatchDeleteMode]])])]),d()&&d().length>0?(v(),T("div",{key:0,class:oe(["overflow-y-scroll scrollbar-overlay",{"max-h-[192px]":!e.preFilesExpanded}])},[(v(!0),T(De,null,Ae(d(),(M,$)=>(v(),T("div",{key:"pre-"+$,class:oe(["flex items-center gap-2 p-1 hover:bg-gray-100 rounded",{"bg-blue-50":Number(e.playlistStatus?.pre_index)===$,"bg-blue-100":e.preFilesBatchDeleteMode&&e.selectedPreFileIndices.includes(Number($)),"cursor-move":e.preFilesDragMode,"cursor-pointer":e.preFilesBatchDeleteMode&&!e.preFilesDragMode,"cursor-default":!e.preFilesDragMode&&!e.preFilesBatchDeleteMode,"select-none":!0}]),draggable:e.preFilesDragMode,onClick:t=>e.preFilesBatchDeleteMode&&!e.preFilesDragMode?l.$emit("toggle-selection",Number($)):null,onDragstart:t=>l.$emit("drag-start",t,Number($)),onDragend:u[8]||(u[8]=t=>l.$emit("drag-end",t)),onDragover:u[9]||(u[9]=ge(t=>l.$emit("drag-over",t),["prevent"])),onDragleave:u[10]||(u[10]=t=>{const A=t.currentTarget;A&&A.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")}),onDrop:ge(t=>l.$emit("drop",t,Number($)),["prevent"])},[o("span",jo,G(Number($)+1),1),o("span",{class:oe(["flex-1 text-sm truncate",{"text-blue-600":Number(e.playlistStatus?.pre_index)===$}]),title:M.uri||""},G(M.uri?M.uri.split("/").pop():""),11,Wo),o("div",{class:"flex items-center gap-1 flex-shrink-0",onMousedown:u[6]||(u[6]=ge(()=>{},["stop"])),onClick:u[7]||(u[7]=ge(()=>{},["stop"]))},[be(n($l,{file:M,player:e.audioPlayer,disabled:e.playlistLoading,onPlay:t=>l.$emit("play-file",M),onSeek:(t,A)=>l.$emit("seek-file",t,A)},null,8,["file","player","disabled","onPlay","onSeek"]),[[Pe,!e.preFilesBatchDeleteMode]]),be(n(B,{class:"!h-6","model-value":e.selectedPreFileIndices.includes(Number($)),onChange:t=>l.$emit("toggle-selection",Number($)),onClick:u[5]||(u[5]=ge(()=>{},["stop"]))},null,8,["model-value","onChange"]),[[Pe,e.preFilesBatchDeleteMode]]),be(n(y,{type:"default",size:"small",plain:"",circle:"",onClick:ge(t=>l.$emit("move-up",Number($)),["stop"]),disabled:Number($)===0||e.playlistLoading,title:"上移"},{default:c(()=>[...u[15]||(u[15]=[q(" ↑ ",-1)])]),_:1},8,["onClick","disabled"]),[[Pe,e.showMoreActions&&!e.preFilesDragMode&&!e.preFilesBatchDeleteMode]]),be(n(y,{type:"default",size:"small",plain:"",circle:"",onClick:ge(t=>l.$emit("move-down",Number($)),["stop"]),disabled:Number($)===d().length-1||e.playlistLoading,title:"下移"},{default:c(()=>[...u[16]||(u[16]=[q(" ↓ ",-1)])]),_:1},8,["onClick","disabled"]),[[Pe,e.showMoreActions&&!e.preFilesDragMode&&!e.preFilesBatchDeleteMode]]),be(n(y,{type:"default",size:"small",plain:"",circle:"",onClick:ge(t=>l.$emit("replace",Number($)),["stop"]),disabled:e.playlistLoading,title:"替换"},{default:c(()=>[n(m,null,{default:c(()=>[n(s(qe))]),_:1})]),_:1},8,["onClick","disabled"]),[[Pe,e.showMoreActions&&!e.preFilesDragMode&&!e.preFilesBatchDeleteMode]]),be(n(y,{type:"info",size:"small",plain:"",circle:"",onClick:ge(t=>l.$emit("open-playlist-selector",M),["stop"]),disabled:e.playlistLoading,title:"应用到列表"},{default:c(()=>[n(m,null,{default:c(()=>[n(s(ml))]),_:1})]),_:1},8,["onClick","disabled"]),[[Pe,!e.preFilesBatchDeleteMode&&!e.preFilesDragMode]]),be(n(y,{type:"default",size:"small",plain:"",circle:"",onClick:ge(t=>l.$emit("delete",Number($)),["stop"]),disabled:e.playlistLoading||e.preFilesDragMode,title:"删除"},{default:c(()=>[n(m,null,{default:c(()=>[n(s(gl))]),_:1})]),_:1},8,["onClick","disabled"]),[[Pe,!e.preFilesBatchDeleteMode]])],32)],42,Go))),128))],2)):Q("",!0),d()&&d().length>0?(v(),T("div",Ho,[n(y,{type:"default",size:"small",plain:"",class:"!w-full !h-4 !p-0 !text-xs",onClick:u[11]||(u[11]=M=>l.$emit("toggle-expand")),title:e.preFilesExpanded?"折叠":"展开"},{default:c(()=>[e.preFilesExpanded?(v(),te(m,{key:0},{default:c(()=>[n(s(Cn))]),_:1})):(v(),te(m,{key:1},{default:c(()=>[n(s(ul))]),_:1}))]),_:1},8,["title"])])):(v(),T("div",Yo,"前置文件列表为空"))])}}}),qo={key:0,class:"border rounded p-2"},Xo={class:"flex items-center justify-between mb-2 pr-2.5"},Qo={class:"text-xs font-semibold text-gray-600"},Zo={key:0,class:"ml-2 text-gray-500"},ei={key:1,class:"ml-2 text-gray-500"},ti={class:"flex items-center gap-1"},li={key:0,class:"overflow-y-scroll scrollbar-overlay"},si=["draggable","onClick","onDragstart","onDrop"],ni={class:"text-xs text-gray-500 w-8"},ai=["title"],oi={key:1,class:"text-sm text-gray-400 text-center py-1"},ii=ke({__name:"FilesList",props:{playlistStatus:{},filesDragMode:{type:Boolean},filesBatchDeleteMode:{type:Boolean},selectedFileIndices:{},playlistLoading:{type:Boolean},showMoreActions:{type:Boolean},audioPlayer:{}},emits:["open-file-browser","toggle-drag-mode","toggle-batch-delete-mode","batch-delete","clear","toggle-selection","drag-start","drag-end","drag-over","drop","play-file","seek-file","move-up","move-down","replace","open-playlist-selector","delete"],setup(e,{emit:f}){const r=e,d=f,b={plain:!0,size:"small",class:"!w-8 !h-6"},i={type:"default",size:"small",plain:!0,circle:!0},l=le(()=>r.playlistStatus?.playlist||[]),u=le(()=>l.value.length),y=le(()=>r.playlistStatus?.current_index??-1),a=le(()=>y.value>=0?y.value+1:"-"),m=le(()=>r.playlistStatus?.isPlaying&&!r.playlistStatus.in_pre_files),B=le(()=>u.value>0),M=le(()=>B.value?wt(l.value):0),$=le(()=>r.filesBatchDeleteMode&&B.value&&!r.filesDragMode),t=le(()=>r.showMoreActions&&!r.filesDragMode&&!r.filesBatchDeleteMode),A=le(()=>r.showMoreActions&&!r.filesBatchDeleteMode),w=le(()=>!r.filesBatchDeleteMode&&!r.filesDragMode),U=le(()=>!r.playlistStatus||r.filesDragMode||r.filesBatchDeleteMode),E=le(()=>!B.value||r.filesBatchDeleteMode),I=le(()=>!B.value||r.filesDragMode),g=le(()=>r.playlistLoading||r.selectedFileIndices.length===0),P=le(()=>`删除选中的 ${r.selectedFileIndices.length} 项`),ee=le(()=>!B.value||r.playlistLoading||r.filesDragMode),de=L=>L?L.split("/").pop():"",R=L=>r.selectedFileIndices.includes(L),x=L=>L===y.value,S=L=>({"bg-blue-50":x(L),"bg-blue-100":$.value&&R(L),"cursor-move":r.filesDragMode,"cursor-pointer":$.value,"cursor-default":!r.filesDragMode&&!r.filesBatchDeleteMode}),C=le(()=>r.playlistLoading||r.filesDragMode),O=L=>{$.value&&d("toggle-selection",L)},h=(L,N)=>{d("drag-start",L,N)},Y=L=>{d("drag-end",L)},me=L=>{d("drag-over",L)},F=L=>{const N=L.currentTarget;N?.classList&&N.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")},k=(L,N)=>{d("drop",L,N)},p=(L,N)=>{d("seek-file",L,N)};return(L,N)=>{const J=Kt,ae=ze,ce=Be,Ie=Dt;return e.playlistStatus?.playlist?(v(),T("div",qo,[o("div",Xo,[o("div",Qo,[N[9]||(N[9]=q(" 正式文件（播放时记录进度） ",-1)),M.value>0?(v(),T("span",Zo," 总时长："+G(s(jt)(M.value)),1)):Q("",!0),B.value?(v(),T("span",ei," 共 "+G(u.value)+" 首， 当前: "+G(a.value)+" / "+G(u.value),1)):Q("",!0),m.value?(v(),te(J,{key:2,type:"success",size:"small",class:"ml-2"},{default:c(()=>[...N[8]||(N[8]=[q(" 播放中 ",-1)])]),_:1})):Q("",!0)]),o("div",ti,[n(ae,Oe({type:"primary"},b,{onClick:N[0]||(N[0]=Fe=>d("open-file-browser")),disabled:U.value}),{default:c(()=>[...N[10]||(N[10]=[q(" + ",-1)])]),_:1},16,["disabled"]),n(ae,Oe({type:e.filesDragMode?"success":"default"},b,{onClick:N[1]||(N[1]=Fe=>d("toggle-drag-mode")),disabled:E.value,title:e.filesDragMode?"点击退出拖拽排序模式":"点击进入拖拽排序模式"}),{default:c(()=>[e.filesDragMode?(v(),te(ce,{key:0},{default:c(()=>[n(s(bt))]),_:1})):(v(),te(ce,{key:1},{default:c(()=>[n(s(Gt))]),_:1}))]),_:1},16,["type","disabled","title"]),n(ae,Oe({type:e.filesBatchDeleteMode?"success":"default"},b,{onClick:N[2]||(N[2]=Fe=>d("toggle-batch-delete-mode")),disabled:I.value,title:e.filesBatchDeleteMode?"点击退出批量删除模式":"点击进入批量删除模式"}),{default:c(()=>[e.filesBatchDeleteMode?(v(),te(ce,{key:0},{default:c(()=>[n(s(bt))]),_:1})):(v(),te(ce,{key:1},{default:c(()=>[n(s(je))]),_:1}))]),_:1},16,["type","disabled","title"]),be(n(ae,Oe({type:"danger"},b,{onClick:N[3]||(N[3]=Fe=>d("batch-delete")),disabled:g.value,title:P.value}),{default:c(()=>[n(ce,null,{default:c(()=>[n(s(je))]),_:1})]),_:1},16,["disabled","title"]),[[Pe,e.filesBatchDeleteMode]]),be(n(ae,Oe({type:"default"},b,{onClick:N[4]||(N[4]=Fe=>d("clear")),disabled:ee.value,title:"清空正式文件列表"}),{default:c(()=>[n(ce,null,{default:c(()=>[n(s(je))]),_:1})]),_:1},16,["disabled"]),[[Pe,A.value]])])]),B.value?(v(),T("div",li,[(v(!0),T(De,null,Ae(l.value,(Fe,we)=>(v(),T("div",{key:Fe.uri||we,class:oe(["flex items-center gap-2 p-1 hover:bg-gray-100 rounded select-none",S(we)]),draggable:e.filesDragMode,onClick:j=>O(we),onDragstart:j=>h(j,we),onDragend:Y,onDragover:ge(me,["prevent"]),onDragleave:F,onDrop:ge(j=>k(j,we),["prevent"])},[o("span",ni,G(we+1),1),o("span",{class:oe(["flex-1 text-sm truncate",{"text-blue-600":x(we)}]),title:Fe.uri||""},G(de(Fe.uri)),11,ai),o("div",{class:"flex items-center gap-1 flex-shrink-0",onMousedown:N[6]||(N[6]=ge(()=>{},["stop"])),onClick:N[7]||(N[7]=ge(()=>{},["stop"]))},[be(n($l,{file:Fe,player:e.audioPlayer,disabled:e.playlistLoading,onPlay:j=>d("play-file",Fe),onSeek:p},null,8,["file","player","disabled","onPlay"]),[[Pe,!e.filesBatchDeleteMode]]),be(n(Ie,{class:"!h-6","model-value":R(we),onChange:j=>d("toggle-selection",we),onClick:N[5]||(N[5]=ge(()=>{},["stop"]))},null,8,["model-value","onChange"]),[[Pe,e.filesBatchDeleteMode]]),be(n(ae,Oe({ref_for:!0},i,{onClick:ge(j=>d("move-up",we),["stop"]),disabled:we===0||e.playlistLoading,title:"上移"}),{default:c(()=>[...N[11]||(N[11]=[q(" ↑ ",-1)])]),_:1},16,["onClick","disabled"]),[[Pe,t.value]]),be(n(ae,Oe({ref_for:!0},i,{onClick:ge(j=>d("move-down",we),["stop"]),disabled:we===u.value-1||e.playlistLoading,title:"下移"}),{default:c(()=>[...N[12]||(N[12]=[q(" ↓ ",-1)])]),_:1},16,["onClick","disabled"]),[[Pe,t.value]]),be(n(ae,Oe({ref_for:!0},i,{onClick:ge(j=>d("replace",we),["stop"]),disabled:e.playlistLoading,title:"替换"}),{default:c(()=>[n(ce,null,{default:c(()=>[n(s(qe))]),_:1})]),_:1},16,["onClick","disabled"]),[[Pe,t.value]]),be(n(ae,{type:"info",size:"small",plain:"",circle:"",onClick:ge(j=>d("open-playlist-selector",Fe),["stop"]),disabled:e.playlistLoading,title:"应用到列表"},{default:c(()=>[n(ce,null,{default:c(()=>[n(s(ml))]),_:1})]),_:1},8,["onClick","disabled"]),[[Pe,w.value]]),be(n(ae,Oe({ref_for:!0},i,{onClick:ge(j=>d("delete",we),["stop"]),disabled:C.value,title:"删除"}),{default:c(()=>[n(ce,null,{default:c(()=>[n(s(gl))]),_:1})]),_:1},16,["onClick","disabled"]),[[Pe,!e.filesBatchDeleteMode]])],32)],42,si))),128))])):(v(),T("div",oi,"正式文件列表为空"))])):Q("",!0)}}}),ri={class:"flex-1 border rounded p-3 flex flex-col"},di={class:"flex items-center justify-between mb-3"},ui={class:"flex-1"},ci={key:0,class:"flex items-center gap-2 mb-1"},fi={class:"flex items-center gap-2 flex-1"},pi={class:"text-lg font-semibold truncate"},vi={key:1},mi={key:2,class:"text-sm text-gray-500"},gi={key:0,class:"mr-2"},yi={class:"flex flex-wrap gap-2"},hi={key:1},bi={key:1},wi={key:1},$i={key:1},Ci={key:0,class:"flex-1 overflow-y-scroll scrollbar-overlay"},ki={key:0,class:"text-sm text-gray-400 text-center py-8"},Di={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},xi=ke({__name:"FileListPanel",props:{playlistStatus:{},activePlaylistId:{},editingPlaylistId:{},editingPlaylistName:{},selectedWeekdayIndex:{},preFilesDragMode:{type:Boolean},preFilesBatchDeleteMode:{type:Boolean},selectedPreFileIndices:{},preFilesExpanded:{type:Boolean},filesDragMode:{type:Boolean},filesBatchDeleteMode:{type:Boolean},selectedFileIndices:{},playlistLoading:{type:Boolean},playing:{type:Boolean},stopping:{type:Boolean},showMoreActions:{type:Boolean},audioPlayer:{}},emits:["update:editingPlaylistName","start-edit-name","save-name","cancel-edit-name","open-batch-drawer","play","play-pre","play-next","stop","clear","toggle-more-actions","select-weekday","open-file-browser-for-pre-files","toggle-pre-files-drag-mode","toggle-pre-files-batch-delete-mode","batch-delete-pre-files","clear-pre-files","toggle-pre-files-expand","toggle-pre-file-selection","pre-file-drag-start","pre-file-drag-end","pre-file-drag-over","pre-file-drop","open-file-browser","toggle-files-drag-mode","toggle-files-batch-delete-mode","batch-delete-files","clear-files","toggle-file-selection","file-drag-start","file-drag-end","file-drag-over","file-drop","play-file","seek-file","move-pre-file-up","move-pre-file-down","replace-pre-file","open-playlist-selector-for-pre-file","delete-pre-file","move-file-up","move-file-down","replace-file","open-playlist-selector-for-file","delete-file"],setup(e){const f=e,r=()=>f.selectedWeekdayIndex!==null?f.selectedWeekdayIndex:Xe(),d=()=>{const i=f.playlistStatus;if(!i||!i.pre_lists)return[];const l=r();return!Array.isArray(i.pre_lists)||i.pre_lists.length!==7?[]:i.pre_lists[l]||[]},b=()=>{const i=f.playlistStatus;if(!i)return 0;const l=d(),u=wt(l),y=i.playlist||[],a=wt(y);return u+a};return(i,l)=>{const u=Be,y=ze;return v(),T("div",ri,[o("div",di,[o("div",ui,[e.playlistStatus?(v(),T("div",ci,[o("div",fi,[o("h3",pi,G(e.playlistStatus.name),1),n(y,{type:"default",size:"small",plain:"",circle:"",onClick:l[0]||(l[0]=a=>i.$emit("start-edit-name",e.activePlaylistId)),title:"编辑名称"},{default:c(()=>[n(u,null,{default:c(()=>[n(s(yl))]),_:1})]),_:1})])])):(v(),T("div",vi,[...l[44]||(l[44]=[o("h3",{class:"text-lg font-semibold"},"播放列表文件",-1)])])),e.playlistStatus?(v(),T("div",mi,[b()>0?(v(),T("span",gi," 总时长："+G(s(jt)(b())),1)):Q("",!0),e.playlistStatus?(v(),T(De,{key:1},[(d()?.length||0)+(e.playlistStatus.playlist?.length||0)>0?(v(),T(De,{key:0},[q(" 共 "+G((d()?.length||0)+(e.playlistStatus.playlist?.length||0))+" 首， 当前: ",1),e.playlistStatus.pre_index!==void 0&&e.playlistStatus.pre_index!==null&&e.playlistStatus.pre_index>=0?(v(),T(De,{key:0},[q(G(e.playlistStatus.pre_index+1),1)],64)):e.playlistStatus.current_index!==void 0&&e.playlistStatus.current_index!==null&&e.playlistStatus.current_index>=0?(v(),T(De,{key:1},[q(G((d()?.length||0)+e.playlistStatus.current_index+1),1)],64)):(v(),T(De,{key:2},[q(" - ")],64)),q(" / "+G((d()?.length||0)+(e.playlistStatus.playlist?.length||0)),1)],64)):(v(),T(De,{key:1},[q(" 共 0 首， 当前: - / 0 ")],64))],64)):Q("",!0)])):Q("",!0)]),o("div",yi,[n(y,{type:"default",size:"small",plain:"",circle:"",onClick:l[1]||(l[1]=a=>i.$emit("open-batch-drawer")),title:"批量模式"},{default:c(()=>[n(u,null,{default:c(()=>[n(s(kn))]),_:1})]),_:1}),n(y,{type:"default",size:"small",plain:"",circle:"",onClick:l[2]||(l[2]=a=>i.$emit("play")),class:"items-center justify-center",disabled:!e.playlistStatus||!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0||!!e.playlistStatus.isPlaying,title:"播放"},{default:c(()=>[e.playing?(v(),te(u,{key:0,size:"12",class:"animate-spin"},{default:c(()=>[n(s(Qe))]),_:1})):(v(),T("span",hi,"▶"))]),_:1},8,["disabled"]),n(y,{type:"default",size:"small",plain:"",circle:"",onClick:l[3]||(l[3]=a=>i.$emit("play-pre")),disabled:!e.playlistStatus||(!d()||d().length===0)&&(!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0),title:"上一首"},{default:c(()=>[e.playing?(v(),te(u,{key:0,size:"12",class:"animate-spin"},{default:c(()=>[n(s(Qe))]),_:1})):(v(),T("span",bi,"⏮"))]),_:1},8,["disabled"]),n(y,{type:"default",size:"small",plain:"",circle:"",onClick:l[4]||(l[4]=a=>i.$emit("play-next")),disabled:!e.playlistStatus||(!d()||d().length===0)&&(!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0),title:"下一首"},{default:c(()=>[e.playing?(v(),te(u,{key:0,size:"12",class:"animate-spin"},{default:c(()=>[n(s(Qe))]),_:1})):(v(),T("span",wi,"⏭"))]),_:1},8,["disabled"]),n(y,{type:"default",size:"small",plain:"",circle:"",onClick:l[5]||(l[5]=a=>i.$emit("stop")),title:"停止"},{default:c(()=>[e.stopping?(v(),te(u,{key:0,size:"12",class:"animate-spin"},{default:c(()=>[n(s(Qe))]),_:1})):(v(),T("span",$i,"⏹"))]),_:1}),be(n(y,{type:"default",size:"small",plain:"",circle:"",onClick:l[6]||(l[6]=a=>i.$emit("clear")),disabled:!e.playlistStatus||(!d()||d().length===0)&&(!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0)||e.playlistLoading,title:"清空列表（包括前置文件和正式文件）"},{default:c(()=>[n(u,null,{default:c(()=>[n(s(je))]),_:1})]),_:1},8,["disabled"]),[[Pe,e.showMoreActions]]),n(y,{type:"default",size:"small",plain:"",circle:"",onClick:l[7]||(l[7]=a=>i.$emit("toggle-more-actions")),title:"更多"},{default:c(()=>[n(u,null,{default:c(()=>[n(s(Gt))]),_:1})]),_:1})])]),e.playlistStatus?(v(),T("div",Ci,[n(Jo,{"playlist-status":e.playlistStatus,"selected-weekday-index":e.selectedWeekdayIndex,"pre-files-drag-mode":e.preFilesDragMode,"pre-files-batch-delete-mode":e.preFilesBatchDeleteMode,"selected-pre-file-indices":e.selectedPreFileIndices,"pre-files-expanded":e.preFilesExpanded,"playlist-loading":e.playlistLoading,"show-more-actions":e.showMoreActions,"audio-player":e.audioPlayer,onSelectWeekday:l[8]||(l[8]=a=>i.$emit("select-weekday",a)),onOpenFileBrowser:l[9]||(l[9]=a=>i.$emit("open-file-browser-for-pre-files")),onToggleDragMode:l[10]||(l[10]=a=>i.$emit("toggle-pre-files-drag-mode")),onToggleBatchDeleteMode:l[11]||(l[11]=a=>i.$emit("toggle-pre-files-batch-delete-mode")),onBatchDelete:l[12]||(l[12]=a=>i.$emit("batch-delete-pre-files")),onClear:l[13]||(l[13]=a=>i.$emit("clear-pre-files")),onToggleExpand:l[14]||(l[14]=a=>i.$emit("toggle-pre-files-expand")),onToggleSelection:l[15]||(l[15]=a=>i.$emit("toggle-pre-file-selection",a)),onDragStart:l[16]||(l[16]=(a,m)=>i.$emit("pre-file-drag-start",a,m)),onDragEnd:l[17]||(l[17]=a=>i.$emit("pre-file-drag-end",a)),onDragOver:l[18]||(l[18]=a=>i.$emit("pre-file-drag-over",a)),onDrop:l[19]||(l[19]=(a,m)=>i.$emit("pre-file-drop",a,m)),onPlayFile:l[20]||(l[20]=a=>i.$emit("play-file",a)),onSeekFile:l[21]||(l[21]=(a,m)=>i.$emit("seek-file",a,m)),onMoveUp:l[22]||(l[22]=a=>i.$emit("move-pre-file-up",a)),onMoveDown:l[23]||(l[23]=a=>i.$emit("move-pre-file-down",a)),onReplace:l[24]||(l[24]=a=>i.$emit("replace-pre-file",a)),onOpenPlaylistSelector:l[25]||(l[25]=a=>i.$emit("open-playlist-selector-for-pre-file",a)),onDelete:l[26]||(l[26]=a=>i.$emit("delete-pre-file",a))},null,8,["playlist-status","selected-weekday-index","pre-files-drag-mode","pre-files-batch-delete-mode","selected-pre-file-indices","pre-files-expanded","playlist-loading","show-more-actions","audio-player"]),n(ii,{"playlist-status":e.playlistStatus,"files-drag-mode":e.filesDragMode,"files-batch-delete-mode":e.filesBatchDeleteMode,"selected-file-indices":e.selectedFileIndices,"playlist-loading":e.playlistLoading,"show-more-actions":e.showMoreActions,"audio-player":e.audioPlayer,onOpenFileBrowser:l[27]||(l[27]=a=>i.$emit("open-file-browser")),onToggleDragMode:l[28]||(l[28]=a=>i.$emit("toggle-files-drag-mode")),onToggleBatchDeleteMode:l[29]||(l[29]=a=>i.$emit("toggle-files-batch-delete-mode")),onBatchDelete:l[30]||(l[30]=a=>i.$emit("batch-delete-files")),onClear:l[31]||(l[31]=a=>i.$emit("clear-files")),onToggleSelection:l[32]||(l[32]=a=>i.$emit("toggle-file-selection",a)),onDragStart:l[33]||(l[33]=(a,m)=>i.$emit("file-drag-start",a,m)),onDragEnd:l[34]||(l[34]=a=>i.$emit("file-drag-end",a)),onDragOver:l[35]||(l[35]=a=>i.$emit("file-drag-over",a)),onDrop:l[36]||(l[36]=(a,m)=>i.$emit("file-drop",a,m)),onPlayFile:l[37]||(l[37]=a=>i.$emit("play-file",a)),onSeekFile:l[38]||(l[38]=(a,m)=>i.$emit("seek-file",a,m)),onMoveUp:l[39]||(l[39]=a=>i.$emit("move-file-up",a)),onMoveDown:l[40]||(l[40]=a=>i.$emit("move-file-down",a)),onReplace:l[41]||(l[41]=a=>i.$emit("replace-file",a)),onOpenPlaylistSelector:l[42]||(l[42]=a=>i.$emit("open-playlist-selector-for-file",a)),onDelete:l[43]||(l[43]=a=>i.$emit("delete-file",a))},null,8,["playlist-status","files-drag-mode","files-batch-delete-mode","selected-file-indices","playlist-loading","show-more-actions","audio-player"]),(!d()||d().length===0)&&(!e.playlistStatus?.playlist||e.playlistStatus.playlist.length===0)?(v(),T("div",ki,' 当前播放列表为空，点击"添加文件"开始构建播放列表 ')):Q("",!0)])):(v(),T("div",Di," 请先在左侧选择一个播放列表查看详情 "))])}}}),Fi=["agent","dlna","bluetooth","mi"],_i=1e4,al=5,Pi=5e3,Ye="默认播放列表",Si=1440,vt=7,Ti=[...Fi],Bi="dlna",Ol="active_playlist_id",mt={NONE:"",BUTTON_1:"B1",BUTTON_2:"B2",BUTTON_3:"B3"},Ei={class:"w-80 min-w-75 border rounded p-3 flex flex-col"},Ai={key:0,class:"mb-3 flex items-center gap-2 flex-wrap"},Mi={key:1,class:"flex-1 overflow-y-auto space-y-4"},Ni={class:"border rounded p-3"},Li={class:"flex items-center justify-between mb-2"},Oi={class:"space-y-2"},Ii={class:"flex items-center gap-2"},Ri={class:"flex items-start gap-4"},zi={class:"flex-1"},Ui={class:"flex-1"},Vi={key:0},Ki={class:"border rounded p-3"},Gi={class:"space-y-2"},ji={class:"text-xs text-gray-600 mb-1 flex items-center gap-2"},Wi={key:0,class:"text-xs text-gray-500"},Hi={class:"flex items-center gap-2"},Yi={class:"mt-3"},Ji={class:"text-xs font-semibold text-gray-700 mb-2"},qi={key:0},Xi={class:"space-y-2 max-h-[200px] overflow-y-auto"},Qi={class:"flex-1 min-w-0"},Zi={class:"text-sm font-medium truncate"},er={class:"text-xs text-gray-500 truncate"},tr={class:"flex-shrink-0"},lr={key:0,class:"text-xs text-gray-400 text-center py-4"},sr={key:1},nr={class:"space-y-2 max-h-[200px] overflow-y-auto"},ar={class:"flex-1 min-w-0"},or={class:"text-sm font-medium truncate"},ir=["title"],rr={class:"flex-shrink-0"},dr={key:0,class:"text-xs text-gray-400 text-center py-4"},ur={key:2},cr={class:"space-y-2 max-h-[200px] overflow-y-auto"},fr={class:"flex-1 min-w-0"},pr={class:"text-sm font-medium truncate"},vr=["title"],mr={class:"flex-shrink-0"},gr={key:0,class:"text-xs text-gray-400 text-center py-4"},yr={key:2,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},hr=ke({__name:"ConfigPanel",props:{playlistStatus:{},connectedDeviceList:{},dlnaDeviceList:{},miDeviceList:{},loading:{type:Boolean},dlnaScanning:{type:Boolean},miScanning:{type:Boolean},onToggleCronEnabled:{type:Function},onUpdateCron:{type:Function},onUpdateDuration:{type:Function},onUpdateTriggerButton:{type:Function},onOpenCronBuilder:{type:Function},onPreviewCron:{type:Function},onUpdateDeviceType:{type:Function},onUpdateDeviceAddress:{type:Function},onSelectBluetoothDevice:{type:Function},onSelectAgentDevice:{type:Function},onSelectMiDevice:{type:Function},onScanDlnaDevices:{type:Function},onScanMiDevices:{type:Function},onOpenScanDialog:{type:Function},onOpenDeviceList:{type:Function}},setup(e){const f=e,r=le(()=>f.playlistStatus?.device?.type||f.playlistStatus?.device_type||null),d=le(()=>f.playlistStatus?.device?.address||f.playlistStatus?.device_address||""),b=a=>le(()=>r.value===a),i=le(()=>{const a=r.value;return a==="agent"||a==="bluetooth"}),l=b("dlna"),u=b("mi"),y=le(()=>i.value?"已配对的设备":l.value?"DLNA 设备":u.value?"小米设备":"设备列表");return(a,m)=>{const B=Ne("Monitor"),M=Be,$=ze,t=Nl,A=Vt,w=Ln,U=bl,E=hl,I=Wt;return v(),T("div",Ei,[m[19]||(m[19]=o("h3",{class:"text-lg font-semibold mb-3"},"配置详情",-1)),e.playlistStatus?(v(),T("div",Ai,[n($,{type:"default",onClick:e.onOpenDeviceList,title:"打开设备列表"},{default:c(()=>[n(M,null,{default:c(()=>[n(B)]),_:1}),m[4]||(m[4]=o("span",{class:"ml-1"},"设备列表",-1))]),_:1},8,["onClick"])])):Q("",!0),e.playlistStatus?(v(),T("div",Mi,[o("div",Ni,[o("div",Li,[m[5]||(m[5]=o("h4",{class:"text-sm font-semibold"},"定时任务 (Cron)",-1)),n(t,{"model-value":e.playlistStatus.schedule?.enabled===1,onChange:m[0]||(m[0]=g=>e.onToggleCronEnabled(g)),"active-text":"开启","inactive-text":"关闭"},null,8,["model-value"])]),o("div",Oi,[o("div",null,[m[7]||(m[7]=o("div",{class:"text-xs text-gray-600 mb-1"},"Cron 表达式",-1)),o("div",Ii,[n(A,{"model-value":e.playlistStatus.schedule?.cron||"",onInput:m[1]||(m[1]=g=>e.onUpdateCron(g)),placeholder:"例如: 0 0 * * *",size:"small",disabled:e.playlistStatus.schedule?.enabled!==1},null,8,["model-value","disabled"]),n($,{type:"info",size:"small",onClick:e.onOpenCronBuilder,disabled:e.playlistStatus.schedule?.enabled!==1},{default:c(()=>[...m[6]||(m[6]=[q(" 助手 ",-1)])]),_:1},8,["onClick","disabled"])])]),o("div",Ri,[o("div",zi,[m[8]||(m[8]=o("div",{class:"text-xs text-gray-600 mb-1"},"持续时间（分钟）",-1)),n(w,{"model-value":e.playlistStatus.schedule?.duration||0,onChange:e.onUpdateDuration,min:0,max:s(Si),step:1,size:"small",disabled:e.playlistStatus.schedule?.enabled!==1,class:"w-full"},null,8,["model-value","onChange","max","disabled"]),m[9]||(m[9]=o("div",{class:"text-xs text-gray-500 mt-1"},"0表示不自动停止",-1))]),o("div",Ui,[m[10]||(m[10]=o("div",{class:"text-xs text-gray-600 mb-1"},"触发按钮",-1)),n(E,{"model-value":e.playlistStatus.trigger_button||"",onChange:e.onUpdateTriggerButton,placeholder:"选择触发按钮",size:"small",class:"w-full",clearable:""},{default:c(()=>[n(U,{label:"空",value:s(mt).NONE},null,8,["value"]),n(U,{label:"按钮对-1",value:s(mt).BUTTON_1},null,8,["value"]),n(U,{label:"按钮对-2",value:s(mt).BUTTON_2},null,8,["value"]),n(U,{label:"按钮对-3",value:s(mt).BUTTON_3},null,8,["value"])]),_:1},8,["model-value","onChange"])])]),e.playlistStatus.schedule?.cron&&e.playlistStatus.schedule?.enabled===1?(v(),T("div",Vi,[n($,{type:"success",size:"small",onClick:e.onPreviewCron,class:"w-full"},{default:c(()=>[...m[11]||(m[11]=[q(" 预览执行时间 ",-1)])]),_:1},8,["onClick"])])):Q("",!0)])]),o("div",Ki,[m[18]||(m[18]=o("h4",{class:"text-sm font-semibold mb-2"},"设备配置",-1)),o("div",Gi,[o("div",null,[m[12]||(m[12]=o("div",{class:"text-xs text-gray-600 mb-1"},"设备类型",-1)),n(E,{"model-value":r.value,onChange:e.onUpdateDeviceType,placeholder:"选择设备类型",size:"small",class:"w-full"},{default:c(()=>[n(U,{label:"蓝牙",value:"bluetooth"}),n(U,{label:"DLNA",value:"dlna"}),n(U,{label:"设备代理",value:"agent"}),n(U,{label:"小米设备",value:"mi"})]),_:1},8,["model-value","onChange"])]),o("div",null,[o("div",ji,[m[13]||(m[13]=o("span",null,"设备地址",-1)),e.playlistStatus.device?.name?(v(),T("span",Wi,G(e.playlistStatus.device.name),1)):Q("",!0)]),o("div",Hi,[n(A,{"model-value":d.value,onInput:m[2]||(m[2]=g=>e.onUpdateDeviceAddress(g)),placeholder:"设备地址",size:"small",class:"flex-1"},null,8,["model-value"]),n($,{size:"small",type:"danger",plain:"",onClick:m[3]||(m[3]=g=>e.onUpdateDeviceAddress("")),disabled:!d.value,title:"清空设备地址"},{default:c(()=>[...m[14]||(m[14]=[q(" 清空 ",-1)])]),_:1},8,["disabled"])])])]),o("div",Yi,[o("h5",Ji,G(y.value),1),i.value?(v(),T("div",qi,[be((v(),T("div",Xi,[(v(!0),T(De,null,Ae(e.connectedDeviceList,g=>(v(),T("div",{key:g.address,class:"flex items-center gap-2 p-2 border rounded hover:bg-gray-50"},[o("div",Qi,[o("div",Zi,G(g.name),1),o("div",er,G(g.address),1)]),o("div",tr,[n($,{size:"small",type:"primary",onClick:P=>r.value==="agent"?e.onSelectAgentDevice(g):e.onSelectBluetoothDevice(g.address),disabled:g.address===d.value},{default:c(()=>[...m[15]||(m[15]=[q(" 选择 ",-1)])]),_:1},8,["onClick","disabled"])])]))),128)),e.connectedDeviceList.length===0?(v(),T("div",lr," 暂无设备 ")):Q("",!0)])),[[I,e.loading]])])):s(l)?(v(),T("div",sr,[be((v(),T("div",nr,[(v(!0),T(De,null,Ae(e.dlnaDeviceList,g=>(v(),T("div",{key:g.location,class:"flex items-center gap-2 p-2 border rounded hover:bg-gray-50"},[o("div",ar,[o("div",or,G(g.name),1),o("div",{class:"text-xs text-gray-500 truncate",title:g.location},G(g.location),9,ir)]),o("div",rr,[n($,{size:"small",type:"primary",onClick:P=>e.onUpdateDeviceAddress(g.location||g.address||"",g.name),disabled:(g.location||g.address)===d.value},{default:c(()=>[...m[16]||(m[16]=[q(" 选择 ",-1)])]),_:1},8,["onClick","disabled"])])]))),128)),e.dlnaDeviceList.length===0&&!e.dlnaScanning?(v(),T("div",dr,' 暂无设备，点击"扫描设备"开始扫描 ')):Q("",!0)])),[[I,e.dlnaScanning]])])):s(u)?(v(),T("div",ur,[be((v(),T("div",cr,[(v(!0),T(De,null,Ae(e.miDeviceList,g=>(v(),T("div",{key:g.deviceID||g.address,class:"flex items-center gap-2 p-2 border rounded hover:bg-gray-50"},[o("div",fr,[o("div",pr,G(g.name),1),o("div",{class:"text-xs text-gray-500 truncate",title:g.deviceID||g.address},G(g.deviceID||g.address),9,vr)]),o("div",mr,[n($,{size:"small",type:"primary",onClick:P=>e.onSelectMiDevice(g),disabled:(g.deviceID||g.address)===d.value},{default:c(()=>[...m[17]||(m[17]=[q(" 选择 ",-1)])]),_:1},8,["onClick","disabled"])])]))),128)),e.miDeviceList.length===0&&!e.miScanning?(v(),T("div",gr,' 暂无设备，点击"扫描设备"开始扫描 ')):Q("",!0)])),[[I,e.miScanning]])])):Q("",!0)])])])):(v(),T("div",yr," 请先选择一个播放列表 "))])}}}),br={class:"mb-4"},wr={key:0,class:"text-center text-gray-400 mt-4 py-8"},$r=ke({__name:"ScanDeviceDialog",props:{visible:{type:Boolean},deviceList:{},loading:{type:Boolean}},emits:["update:visible","refresh","connect","close"],setup(e,{emit:f}){const r=f,d=l=>{r("update:visible",l),l||r("close")},b=()=>{r("refresh")},i=l=>{r("connect",l)};return(l,u)=>{const y=ze,a=xl,m=Dl,B=ut,M=Wt;return v(),te(B,{"model-value":e.visible,"onUpdate:modelValue":d,title:"扫描到的设备",width:"800"},{default:c(()=>[o("div",br,[n(y,{type:"primary",onClick:b,loading:e.loading},{default:c(()=>[...u[0]||(u[0]=[q("刷新扫描",-1)])]),_:1},8,["loading"])]),be((v(),te(m,{data:e.deviceList,stripe:"",class:"w-full",height:400},{default:c(()=>[n(a,{prop:"name",label:"设备名称","min-width":"150"}),n(a,{prop:"address",label:"地址","min-width":"120"}),n(a,{prop:"rssi",label:"信号强度",width:"100"},{default:c(({row:$})=>[o("span",null,G($.rssi)+" dBm",1)]),_:1}),n(a,{label:"操作",width:"100"},{default:c(({row:$})=>[n(y,{size:"small",type:"primary",onClick:t=>i($),loading:$.connecting,disabled:$.connecting},{default:c(()=>[...u[1]||(u[1]=[q(" 连接 ",-1)])]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1},8,["data"])),[[M,e.loading]]),e.deviceList.length===0&&!e.loading?(v(),T("div",wr,' 暂无扫描到的设备，点击"刷新扫描"按钮开始扫描 ')):Q("",!0)]),_:1},8,["model-value"])}}}),Cr={class:"flex flex-col gap-4 h-full overflow-y-auto"},kr={class:"flex items-center justify-between mb-2"},Dr={class:"flex items-center gap-2"},xr={class:"flex flex-col gap-1"},Fr={class:"text-sm flex items-start"},_r={class:"text-gray-800"},Pr={class:"text-sm flex items-start"},Sr={class:"text-gray-800"},Tr={key:0,class:"text-gray-400"},Br={class:"flex flex-col items-center gap-1"},Er={class:"text-xs text-gray-500"},Ar={class:"flex flex-col gap-1"},Mr={class:"text-[12px] mr-1 !w-4"},Nr={class:"flex items-center justify-between mb-2"},Lr={class:"flex items-center gap-2"},Or={class:"flex flex-col gap-1"},Ir={class:"text-sm flex items-start"},Rr={class:"text-gray-800"},zr={class:"text-sm flex items-start"},Ur={class:"text-gray-800 w-40"},Vr={class:"text-gray-800 w-40"},Kr={class:"flex flex-col gap-2"},Gr={class:"flex items-center gap-2"},jr={class:"text-gray-800 w-5"},Wr={key:1},Hr={class:"flex items-center gap-2"},Yr={class:"flex items-center justify-between mb-2"},Jr={class:"flex items-center gap-2"},qr={class:"flex flex-col gap-1"},Xr={class:"text-sm flex items-start"},Qr=["title"],Zr={key:0,class:"text-sm flex items-start"},ed={class:"text-gray-800"},td={class:"flex flex-col gap-2"},ld={class:"flex items-center gap-2"},sd={class:"text-gray-800 w-5"},nd={key:1},ad={class:"flex items-center gap-2"},od=ke({__name:"DevicesDrawer",props:{visible:{type:Boolean,default:!1}},emits:["update:visible"],setup(e,{emit:f}){const r=e,d=f,b=K(r.visible),i=K([]),l=K(!1),u=K([]),y=K(!1),a=K([]),m=K(!1);let B=null;const M=[{label:"B1",keys:["F13","F14"]},{label:"B2",keys:["F15","F16"]},{label:"B3",keys:["F17","F18"]}],$=async(k=!0,p=!1)=>{try{k&&(m.value=!0);const N=(await Te.get("/agent/list")).data;N?.code===0?(a.value=N.data||[],p&&z.success(`已获取 ${a.value.length} 个 Agent 设备`)):((p||k)&&z.error(N?.msg||"获取设备列表失败"),a.value=[])}catch(L){console.error("获取Agent设备列表失败:",L),(p||k)&&re(L,"获取设备列表失败"),a.value=[]}finally{k&&(m.value=!1)}},t=async(k,p)=>{const L=a.value.find(ae=>ae.agent_id===k);if(!L){z.error("设备不存在");return}const N=`testing_${p}`,J=L;J[N]=!0;try{const ce=(await Te.post("/agent/mock",{agent_id:k,action:"keyboard",key:p,value:"test"})).data;ce?.code===0?z.success(`测试按钮 ${p} 成功`):z.error(ce?.msg||`测试按钮 ${p} 失败`)}catch(ae){re(ae,`测试按钮 ${p} 失败`)}finally{J[N]=!1}},A=()=>{$(!0,!1),w(),B=setInterval(()=>{$(!1,!1)},_i)},w=()=>{B&&(clearInterval(B),B=null)},U=()=>$(!0,!1),E=(k,p)=>t(k,p),I=k=>k.deviceID||k.address||"",g=k=>Math.max(0,Math.min(100,k)),P=k=>({...k,volume:void 0,_volumeChanging:!1,_volumeRefreshing:!1}),ee=async()=>{try{l.value=!0;const p=(await Te.get("/mi/scan",{params:{timeout:al}})).data;if(p?.code===0){const L=(p.data||[]).map(N=>P(N));i.value=L,await Promise.allSettled(L.map(N=>de(N))),z.success(`扫描到 ${L.length} 个小米设备`)}else z.error(p?.msg||"扫描小米设备失败")}catch(k){re(k,"扫描小米设备失败")}finally{l.value=!1}},de=async k=>{const p=I(k);if(!p)return;const L=i.value.find(N=>I(N)===p);if(L){L._volumeRefreshing=!0;try{const J=(await Te.get("/mi/volume",{params:{device_id:p}})).data;if(J?.code===0)L.volume=J.data?.volume??J.data??void 0;else{const ae=L.name||p;z.error(J?.msg||`获取设备 ${ae} 音量失败`)}}catch(N){const J=L.name||p;re(N,`获取设备 ${J} 音量失败`)}finally{L._volumeRefreshing=!1}}},R=async(k,p)=>{const L=I(k);if(!L){z.error("设备ID无效");return}const N=g(p);k._volumeChanging=!0;try{const ae=(await Te.post("/mi/volume",{device_id:L,volume:N})).data;ae?.code===0?(k.volume=N,z.success("音量设置成功")):z.error(ae?.msg||"设置音量失败")}catch(J){re(J,"设置小米设备音量失败")}finally{k._volumeChanging=!1}},x=async k=>{const p=I(k);if(!p){z.warning("设备ID无效");return}try{k._stopping=!0;const N=(await Te.post("/mi/stop",{device_id:p})).data;N?.code===0?z.success("停止播放成功"):z.error(N?.msg||"停止播放失败")}catch(L){re(L,"停止小米设备播放失败")}finally{k._stopping=!1}},S=k=>k.location||k.address||"",C=k=>({...k,volume:void 0,_volumeChanging:!1,_volumeRefreshing:!1}),O=async()=>{try{y.value=!0;const p=(await Te.get("/dlna/scan",{params:{timeout:al}})).data;if(p?.code===0){const L=(p.data||[]).map(N=>C(N));u.value=L,await Promise.allSettled(L.map(N=>h(N))),z.success(`扫描到 ${L.length} 个 DLNA 设备`)}else z.error(p?.msg||"扫描 DLNA 设备失败")}catch(k){re(k,"扫描 DLNA 设备失败")}finally{y.value=!1}},h=async k=>{const p=S(k);if(!p)return;const L=u.value.find(N=>S(N)===p);if(L){L._volumeRefreshing=!0;try{const J=(await Te.get("/dlna/volume",{params:{location:p}})).data;if(J?.code===0)L.volume=J.data?.volume??J.data??void 0;else{const ae=L.name||p;z.error(J?.msg||`获取设备 ${ae} 音量失败`)}}catch(N){const J=L.name||p;re(N,`获取设备 ${J} 音量失败`)}finally{L._volumeRefreshing=!1}}},Y=async(k,p)=>{const L=S(k);if(!L){z.error("设备位置无效");return}const N=g(p);k._volumeChanging=!0;try{const ae=(await Te.post("/dlna/volume",{location:L,volume:N})).data;ae?.code===0?(k.volume=N,z.success("音量设置成功")):z.error(ae?.msg||"设置音量失败")}catch(J){re(J,"设置 DLNA 设备音量失败")}finally{k._volumeChanging=!1}},me=async k=>{const p=S(k);if(!p){z.warning("设备位置无效");return}try{k._stopping=!0;const N=(await Te.post("/dlna/stop",{location:p})).data;N?.code===0?z.success("停止播放成功"):z.error(N?.msg||"停止播放失败")}catch(L){re(L,"停止 DLNA 设备播放失败")}finally{k._stopping=!1}},F=()=>{b.value=!1};return Le(()=>r.visible,k=>{b.value=k,k?A():w()},{immediate:!0}),Le(b,k=>{k!==r.visible&&d("update:visible",k)}),nt(()=>{r.visible&&A()}),wl(()=>{w()}),(k,p)=>{const L=Be,N=ze,J=xl,ae=Kt,ce=Dl,Ie=xn,Fe=Fl,we=Wt;return v(),te(Fe,{modelValue:b.value,"onUpdate:modelValue":p[0]||(p[0]=j=>b.value=j),size:900,direction:"rtl","before-close":F,title:"设备管理","header-class":"h-12 !mb-1"},{default:c(()=>[o("div",Cr,[o("div",null,[o("div",kr,[o("div",Dr,[p[2]||(p[2]=o("h4",{class:"text-base font-semibold w-24"},"Agent设备",-1)),n(N,{type:"primary",plain:"",size:"small",onClick:U,loading:m.value},{default:c(()=>[m.value?Q("",!0):(v(),te(L,{key:0},{default:c(()=>[n(s(qe))]),_:1})),p[1]||(p[1]=o("span",{class:"ml-1"},"刷新",-1))]),_:1},8,["loading"])])]),be((v(),te(ce,{data:a.value,stripe:"",class:"w-full",height:200},{empty:c(()=>[...p[5]||(p[5]=[o("div",{class:"text-center text-gray-400 py-8"},"暂无设备，请等待设备注册",-1)])]),default:c(()=>[n(J,{prop:"name",label:"设备名称","min-width":"150"}),n(J,{label:"详情","min-width":"250"},{default:c(({row:j})=>[o("div",xr,[o("div",Fr,[p[3]||(p[3]=o("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"地址：",-1)),o("span",_r,G(j.address),1)]),o("div",Pr,[p[4]||(p[4]=o("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"ID：",-1)),o("span",Sr,G(j.agent_id),1)])])]),_:1}),n(J,{label:"支持的操作","min-width":"100"},{default:c(({row:j})=>[(v(!0),T(De,null,Ae(j.actions,_=>(v(),te(ae,{key:_,size:"small",type:"info",class:"mr-1"},{default:c(()=>[q(G(_),1)]),_:2},1024))),128)),!j.actions||j.actions.length===0?(v(),T("span",Tr,"无")):Q("",!0)]),_:1}),n(J,{label:"状态/心跳",width:"90"},{default:c(({row:j})=>[o("div",Br,[n(ae,{type:j.is_online?"success":"danger",size:"small"},{default:c(()=>[q(G(j.is_online?"在线":"离线"),1)]),_:2},1032,["type"]),o("span",Er,G(j.last_heartbeat_ago)+"秒前 ",1)])]),_:1}),n(J,{label:"测试按钮",width:"180"},{default:c(({row:j})=>[o("div",Ar,[(v(),T(De,null,Ae(M,(_,H)=>o("div",{key:H,class:"flex gap-1 items-center"},[n(L,{class:"!w-4 !h-5"},{default:c(()=>[n(s(vl))]),_:1}),o("span",Mr,G(_.label),1),(v(!0),T(De,null,Ae(_.keys,(V,se)=>(v(),te(N,{key:se,size:"small",type:"primary",plain:"",onClick:ne=>E(j.agent_id,V),loading:j[`testing_${V}`],class:"flex-1"},{default:c(()=>[q(G(V),1)]),_:2},1032,["onClick","loading"]))),128))])),64))])]),_:1})]),_:1},8,["data"])),[[we,m.value]])]),o("div",null,[o("div",Nr,[o("div",Lr,[p[7]||(p[7]=o("h4",{class:"text-base font-semibold w-24"},"小米设备",-1)),n(N,{type:"primary",plain:"",size:"small",onClick:ee,loading:l.value},{default:c(()=>[l.value?Q("",!0):(v(),te(L,{key:0},{default:c(()=>[n(s(qe))]),_:1})),p[6]||(p[6]=o("span",{class:"ml-1"},"扫描",-1))]),_:1},8,["loading"])])]),be((v(),te(ce,{data:i.value,stripe:"",class:"w-full",height:280},{empty:c(()=>[...p[12]||(p[12]=[o("div",{class:"text-center text-gray-400 py-8"},'暂无设备，点击"扫描设备"开始扫描',-1)])]),default:c(()=>[n(J,{prop:"name",label:"设备名称","min-width":"150"}),n(J,{label:"详情","min-width":"400"},{default:c(({row:j})=>[o("div",Or,[o("div",Ir,[p[8]||(p[8]=o("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"ID：",-1)),o("span",Rr,G(j.deviceID||"-"),1)]),o("div",zr,[p[9]||(p[9]=o("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"地址：",-1)),o("span",Ur,G(j.mac||"-"),1),p[10]||(p[10]=o("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"DTD：",-1)),o("span",Vr,G(j.miotDID||"-"),1)])])]),_:1}),n(J,{label:"功能","min-width":"200"},{default:c(({row:j})=>[o("div",Kr,[o("div",Gr,[p[11]||(p[11]=o("span",{class:"text-gray-600 inline-block w-11 flex-shrink-0"},"音量：",-1)),o("span",jr,G(j.volume!==void 0?j.volume:"-"),1),n(N,{size:"small",type:"info",plain:"",circle:"",onClick:_=>de(j),loading:j._volumeRefreshing,disabled:j._volumeRefreshing||j._volumeChanging,title:"刷新音量",class:"p-0.5 !w-[17px] !h-[17px]"},{default:c(()=>[j._volumeRefreshing?Q("",!0):(v(),te(L,{key:0},{default:c(()=>[n(s(qe))]),_:1}))]),_:2},1032,["onClick","loading","disabled"]),n(N,{size:"small",class:"!w-8 !h-6",type:"danger",plain:"",onClick:_=>x(j),disabled:j._stopping,title:"停止播放"},{default:c(()=>[j._stopping?(v(),te(L,{key:0,class:"animate-spin"},{default:c(()=>[n(s(Qe))]),_:1})):(v(),T("span",Wr,"⏹"))]),_:2},1032,["onClick","disabled"])]),o("div",Hr,[n(Ie,{"model-value":j.volume??0,onInput:_=>j.volume=_,onChange:_=>R(j,_),min:5,max:100,step:1,disabled:j._volumeChanging||j._volumeRefreshing||j.volume===void 0,size:"small",class:"flex-1 max-w-[200px]"},null,8,["model-value","onInput","onChange","disabled"])])])]),_:1})]),_:1},8,["data"])),[[we,l.value]])]),o("div",null,[o("div",Yr,[o("div",Jr,[p[14]||(p[14]=o("h4",{class:"text-base font-semibold w-24"},"DLNA设备",-1)),n(N,{type:"primary",plain:"",size:"small",onClick:O,loading:y.value},{default:c(()=>[y.value?Q("",!0):(v(),te(L,{key:0},{default:c(()=>[n(s(qe))]),_:1})),p[13]||(p[13]=o("span",{class:"ml-1"},"扫描",-1))]),_:1},8,["loading"])])]),be((v(),te(ce,{data:u.value,stripe:"",class:"w-full",height:280},{empty:c(()=>[...p[18]||(p[18]=[o("div",{class:"text-center text-gray-400 py-8"},'暂无设备，点击"扫描设备"开始扫描',-1)])]),default:c(()=>[n(J,{prop:"name",label:"设备名称","min-width":"150"}),n(J,{label:"详情","min-width":"400"},{default:c(({row:j})=>[o("div",qr,[o("div",Xr,[p[15]||(p[15]=o("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"位置：",-1)),o("span",{class:"text-gray-800 flex-1 truncate",title:j.location},G(j.location||"-"),9,Qr)]),j.manufacturer||j.model_name?(v(),T("div",Zr,[p[16]||(p[16]=o("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"型号：",-1)),o("span",ed,G(j.manufacturer||"")+" "+G(j.model_name||""),1)])):Q("",!0)])]),_:1}),n(J,{label:"功能","min-width":"200"},{default:c(({row:j})=>[o("div",td,[o("div",ld,[p[17]||(p[17]=o("span",{class:"text-gray-600 inline-block w-11 flex-shrink-0"},"音量：",-1)),o("span",sd,G(j.volume!==void 0?j.volume:"-"),1),n(N,{size:"small",type:"info",plain:"",circle:"",onClick:_=>h(j),loading:j._volumeRefreshing,disabled:j._volumeRefreshing||j._volumeChanging,title:"刷新音量",class:"p-0.5 !w-[17px] !h-[17px]"},{default:c(()=>[j._volumeRefreshing?Q("",!0):(v(),te(L,{key:0},{default:c(()=>[n(s(qe))]),_:1}))]),_:2},1032,["onClick","loading","disabled"]),n(N,{size:"small",class:"!w-8 !h-6",type:"danger",plain:"",onClick:_=>me(j),disabled:j._stopping,title:"停止播放"},{default:c(()=>[j._stopping?(v(),te(L,{key:0,class:"animate-spin"},{default:c(()=>[n(s(Qe))]),_:1})):(v(),T("span",nd,"⏹"))]),_:2},1032,["onClick","disabled"])]),o("div",ad,[n(Ie,{"model-value":j.volume??0,onInput:_=>j.volume=_,onChange:_=>Y(j,_),min:5,max:100,step:1,disabled:j._volumeChanging||j._volumeRefreshing||j.volume===void 0,size:"small",class:"flex-1 max-w-[200px]"},null,8,["model-value","onInput","onChange","disabled"])])])]),_:1})]),_:1},8,["data"])),[[we,y.value]])])])]),_:1},8,["modelValue"])}}}),id={class:"flex gap-4 h-[500px]"},rd={class:"w-64 flex flex-col border rounded p-3"},dd={class:"flex-1 overflow-y-auto space-y-2"},ud=["onClick"],cd={class:"text-sm flex-1 truncate"},fd={class:"text-xs text-gray-500 ml-2 whitespace-nowrap"},pd={key:0,class:"text-blue-600 font-medium"},vd={key:1},md={key:0,class:"text-xs text-gray-400 text-center py-2"},gd={class:"flex-1 flex flex-col border rounded p-3"},yd={key:0,class:"flex-1 overflow-y-auto"},hd={class:"mb-3"},bd={class:"space-y-1"},wd=["onClick"],$d={class:"text-xs text-gray-500 whitespace-nowrap"},Cd={key:0,class:"text-blue-600 font-medium"},kd={key:1},Dd={class:"border-t pt-3"},xd={class:"flex items-center gap-2 py-1"},Fd={class:"text-xs text-gray-500 whitespace-nowrap"},_d={key:0,class:"text-blue-600 font-medium"},Pd={key:1},Sd={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},Td={class:"flex items-center justify-between"},Bd={class:"text-sm text-gray-500"},Ed={key:0},Ad={class:"flex gap-2"},Md=ke({__name:"PlaylistSelectDialog",props:{visible:{type:Boolean,default:!1},playlistCollection:{default:()=>[]},selectedFiles:{default:()=>[]},onCopy:{type:Function,default:void 0},onRemove:{type:Function,default:void 0}},emits:["update:visible"],setup(e,{emit:f}){const r=e,d=f,b=K(r.visible),i=K(null),l=K([]),u=K(!1),y=le(()=>r.playlistCollection.find(R=>R.id===i.value)||null),a=le(()=>l.value.length>0||u.value),m=R=>{const x=y.value;if(!x||!x.pre_lists||!Array.isArray(x.pre_lists)||x.pre_lists.length!==7)return 0;const S=x.pre_lists[R];return Array.isArray(S)?S.length:0},B=()=>{const R=y.value;return!R||!R.playlist?0:Array.isArray(R.playlist)?R.playlist.length:0},M=R=>{if(!R)return 0;const x=R.pre_lists&&Array.isArray(R.pre_lists)&&R.pre_lists.length===7?R.pre_lists.reduce((C,O)=>C+(Array.isArray(O)?O.length:0),0):0,S=Array.isArray(R.playlist)?R.playlist.length:0;return x+S},$=()=>!r.selectedFiles||r.selectedFiles.length===0?new Set:new Set(r.selectedFiles.map(R=>typeof R=="string"?R:R.uri||String(R))),t=R=>{if(!R||!r.selectedFiles||r.selectedFiles.length===0)return 0;const x=$();let S=0;return R.pre_lists&&Array.isArray(R.pre_lists)&&R.pre_lists.length===7&&R.pre_lists.forEach(C=>{Array.isArray(C)&&C.forEach(O=>{const h=O.uri||String(O);x.has(h)&&S++})}),Array.isArray(R.playlist)&&R.playlist.forEach(C=>{const O=C.uri||String(C);x.has(O)&&S++}),S},A=R=>{const x=y.value;if(!x||!r.selectedFiles||r.selectedFiles.length===0||!x.pre_lists||!Array.isArray(x.pre_lists)||x.pre_lists.length!==7)return 0;const S=x.pre_lists[R];if(!Array.isArray(S))return 0;const C=$();let O=0;return S.forEach(h=>{const Y=h.uri||String(h);C.has(Y)&&O++}),O},w=()=>{const R=y.value;if(!R||!r.selectedFiles||r.selectedFiles.length===0||!Array.isArray(R.playlist))return 0;const x=$();let S=0;return R.playlist.forEach(C=>{const O=C.uri||String(C);x.has(O)&&S++}),S},U=R=>{i.value=R,l.value=[],u.value=!1},E=R=>{const x=l.value.indexOf(R);x>-1?l.value.splice(x,1):l.value.push(R)},I=()=>{u.value=!u.value},g=async()=>{if(!y.value||!r.selectedFiles||r.selectedFiles.length===0||!a.value){z.warning("请选择播放列表和目标列表，并至少选中一个文件");return}try{const R=r.selectedFiles.map(O=>typeof O=="string"?O:O.uri||String(O)),x=l.value.length,S=u.value;let C="";if(x>0&&S)C=`${x}个前置文件列表和正式文件列表`;else if(x>0){const O=["周一","周二","周三","周四","周五","周六","周日"];C=`前置文件列表（${l.value.map(Y=>O[Y]).join("、")}）`}else S&&(C="正式文件列表");await Ee.confirm(`确定要将选中的 ${R.length} 个文件复制到播放列表"${y.value.name}"的${C}吗？`,"确认复制",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),r.onCopy&&(await r.onCopy({playlistId:i.value,files:R,preLists:l.value,filesList:u.value}),z.success("文件已复制到播放列表"),ee())}catch(R){R!=="cancel"&&re(R,"复制文件失败")}},P=async()=>{if(!y.value||!r.selectedFiles||r.selectedFiles.length===0||!a.value){z.warning("请选择播放列表和目标列表，并至少选中一个文件");return}try{const R=r.selectedFiles.map(O=>typeof O=="string"?O:O.uri||String(O)),x=l.value.length,S=u.value;let C="";if(x>0&&S)C=`${x}个前置文件列表和正式文件列表`;else if(x>0){const O=["周一","周二","周三","周四","周五","周六","周日"];C=`前置文件列表（${l.value.map(Y=>O[Y]).join("、")}）`}else S&&(C="正式文件列表");await Ee.confirm(`确定要从播放列表"${y.value.name}"的${C}中删除选中的 ${R.length} 个文件吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),r.onRemove&&(await r.onRemove({playlistId:i.value,files:R,preLists:l.value,filesList:u.value}),z.success("文件已从播放列表删除"),ee())}catch(R){R!=="cancel"&&re(R,"删除文件失败")}},ee=()=>{b.value=!1,i.value=null,l.value=[],u.value=!1},de=()=>{r.playlistCollection&&r.playlistCollection.length>0&&!i.value&&(i.value=r.playlistCollection[0].id)};return Le(()=>r.playlistCollection,R=>{R&&R.length>0&&!i.value&&(i.value=R[0].id)},{immediate:!0}),Le(()=>r.visible,R=>{b.value=R,R&&de()}),Le(b,R=>{R!==r.visible&&d("update:visible",R)}),nt(()=>{de()}),(R,x)=>{const S=Dt,C=ze,O=ut;return v(),te(O,{modelValue:b.value,"onUpdate:modelValue":x[1]||(x[1]=h=>b.value=h),title:"应用到列表",width:"900","before-close":ee},{footer:c(()=>[o("div",Td,[o("div",Bd,[e.selectedFiles&&e.selectedFiles.length>0?(v(),T("span",Ed," 已选择 "+G(e.selectedFiles.length)+" 个文件 ",1)):Q("",!0)]),o("div",Ad,[n(C,{onClick:ee},{default:c(()=>[...x[7]||(x[7]=[q("取消",-1)])]),_:1}),n(C,{type:"primary",onClick:g,disabled:!a.value||!e.selectedFiles||e.selectedFiles.length===0},{default:c(()=>[...x[8]||(x[8]=[q(" 复制到列表 ",-1)])]),_:1},8,["disabled"]),n(C,{type:"danger",onClick:P,disabled:!a.value||!e.selectedFiles||e.selectedFiles.length===0},{default:c(()=>[...x[9]||(x[9]=[q(" 从列表删除 ",-1)])]),_:1},8,["disabled"])])])]),default:c(()=>[o("div",id,[o("div",rd,[x[2]||(x[2]=o("div",{class:"text-sm font-semibold mb-2"},"选择播放列表",-1)),o("div",dd,[(v(!0),T(De,null,Ae(e.playlistCollection,h=>(v(),T("div",{key:h.id,class:oe(["flex items-center justify-between px-2 py-2 rounded cursor-pointer hover:bg-gray-50 transition-colors",{"bg-blue-50 border border-blue-200":h.id===i.value}]),onClick:Y=>U(h.id)},[o("span",cd,G(h.name),1),o("span",fd,[e.selectedFiles&&e.selectedFiles.length>0?(v(),T("span",pd,G(t(h))+"/"+G(M(h)),1)):(v(),T("span",vd,G(M(h)),1))])],10,ud))),128)),e.playlistCollection.length===0?(v(),T("div",md," 暂无播放列表 ")):Q("",!0)])]),o("div",gd,[x[6]||(x[6]=o("div",{class:"text-sm font-semibold mb-3"},"选择目标列表（可多选）",-1)),y.value?(v(),T("div",yd,[o("div",hd,[x[4]||(x[4]=o("div",{class:"text-xs text-gray-600 mb-2 font-semibold"},"前置文件",-1)),o("div",bd,[(v(),T(De,null,Ae(["周一","周二","周三","周四","周五","周六","周日"],(h,Y)=>o("div",{key:Y,class:"flex items-center gap-2 py-1"},[n(S,{"model-value":l.value.includes(Y),onChange:me=>E(Y),size:"small"},null,8,["model-value","onChange"]),o("span",{class:oe(["text-xs flex-1 cursor-pointer hover:text-blue-500",{"text-blue-600 font-medium":l.value.includes(Y)}]),onClick:me=>E(Y)},G(h),11,wd),o("span",$d,[e.selectedFiles&&e.selectedFiles.length>0?(v(),T("span",Cd,G(A(Y))+"/"+G(m(Y)),1)):(v(),T("span",kd,G(m(Y)),1)),x[3]||(x[3]=o("span",{class:"text-gray-400"}," 个文件",-1))])])),64))])]),o("div",Dd,[o("div",xd,[n(S,{"model-value":u.value,onChange:I,size:"small"},null,8,["model-value"]),o("span",{class:oe(["text-xs font-semibold text-gray-600 cursor-pointer hover:text-blue-500 flex-1",{"text-blue-600":u.value}]),onClick:x[0]||(x[0]=h=>I())}," 正式文件 ",2),o("span",Fd,[e.selectedFiles&&e.selectedFiles.length>0?(v(),T("span",_d,G(w())+"/"+G(B()),1)):(v(),T("span",Pd,G(B()),1)),x[5]||(x[5]=o("span",{class:"text-gray-400"}," 个文件",-1))])])])])):(v(),T("div",Sd," 请先选择一个播放列表 "))])])]),_:1},8,["modelValue"])}}}),Nd={class:"flex gap-4 h-full"},Ld={class:"w-64 border rounded p-3 flex flex-col"},Od={class:"flex items-center justify-between mb-3"},Id={class:"flex-1 overflow-y-auto space-y-2"},Rd=["onClick"],zd={class:"text-sm font-medium truncate"},Ud={class:"text-xs text-gray-500 mt-1"},Vd={class:"flex items-center gap-1 flex-shrink-0"},Kd={key:0,class:"text-sm text-gray-400 text-center py-4"},Gd={class:"flex-1 border rounded p-3 flex flex-col"},jd={class:"mb-3 flex items-center justify-between"},Wd={class:"flex items-center gap-2"},Hd={class:"text-base font-semibold"},Yd={key:0,class:"flex items-center gap-2"},Jd={class:"flex-1 overflow-y-auto"},qd={key:0,class:"space-y-1"},Xd=["onClick"],Qd={class:"text-xs text-gray-500 w-8"},Zd=["title"],eu={key:1,class:"text-sm text-gray-400 text-center py-8"},tu={class:"w-96 border rounded p-3 flex flex-col"},lu={class:"mb-3"},su={class:"flex gap-2 mb-3"},nu={class:"mb-3"},au={class:"space-y-1 max-h-48 overflow-y-auto border rounded p-1"},ou=["onClick"],iu={class:"text-sm flex-1"},ru={class:"text-xs text-gray-500 ml-2 whitespace-nowrap"},du={key:0,class:"text-xs text-gray-400 text-center py-2"},uu={key:0,class:"flex-1 overflow-y-auto space-y-3"},cu={class:"border rounded p-2"},fu={class:"space-y-1"},pu=["onClick"],vu={class:"text-xs text-gray-500 whitespace-nowrap"},mu={class:"border rounded p-2"},gu={class:"flex items-center gap-2 mb-2"},yu={class:"text-xs text-gray-500 whitespace-nowrap"},hu={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},ol="t_batch_list",il="0",bu=7,wu=ke({__name:"BatchDrawer",props:{visible:{type:Boolean,default:!1},playlistCollection:{default:()=>[]},onAddFiles:{type:Function,default:void 0},onRemoveFiles:{type:Function,default:void 0}},emits:["update:visible","refresh"],setup(e,{emit:f}){const r=e,d=f,b=K([]),i=K(null),l=K(null),u=K([]),y=K(!1),a=K([]),m=K(!1),B=K(!1),M=K(!1),$=K(r.visible),t=le(()=>b.value.find(D=>D.id===i.value)||null),A=le(()=>r.playlistCollection.find(D=>D.id===l.value)||null),w=le(()=>u.value.length>0||y.value),U=D=>typeof D=="string"?D:D?.uri||String(D),E=()=>t.value?.files?a.value.map(D=>t.value.files[D]).filter(D=>D!==null):[],I=()=>new Set(E().map(U)),g=D=>!!(D?.pre_lists&&Array.isArray(D.pre_lists)&&D.pre_lists.length===bu),P=D=>!!(D?.playlist&&Array.isArray(D.playlist)),ee=(D,W)=>{if(!Array.isArray(D))return 0;let X=0;return D.forEach(ve=>{W.has(U(ve))&&X++}),X},de=D=>{const W=A.value;if(!g(W))return 0;const X=W.pre_lists[D];return Array.isArray(X)?X.length:0},R=D=>{if(!t.value||!A.value)return 0;const W=I();if(W.size===0)return 0;const X=A.value;if(!g(X))return 0;const ve=X.pre_lists[D];return ee(ve,W)},x=()=>{const D=A.value;return P(D)?D.playlist.length:0},S=()=>{if(!t.value||!A.value)return 0;const D=I();if(D.size===0)return 0;const W=A.value;return P(W)?ee(W.playlist,D):0},C=D=>{if(!D)return 0;let W=0;return g(D)&&D.pre_lists.forEach(X=>{Array.isArray(X)&&(W+=X.length)}),P(D)&&(W+=D.playlist.length),W},O=D=>{if(!t.value||!D)return 0;const W=I();if(W.size===0)return 0;let X=0;return g(D)&&D.pre_lists.forEach(ve=>{X+=ee(ve,W)}),P(D)&&(X+=ee(D.playlist,W)),X},h=async()=>{try{M.value=!0;const D=await On(ol,il);let W=[];if(D!=null)if(typeof D=="string"&&D.trim()!=="")try{const X=JSON.parse(D);W=Array.isArray(X)?X:[]}catch{W=[]}else Array.isArray(D)&&(W=D);b.value=W,me()}catch(D){b.value=[],re(D,"加载Batch列表失败")}finally{M.value=!1}},Y=async()=>{try{const D=JSON.stringify(b.value);await In(ol,il,D)}catch(D){throw re(D,"保存Batch列表失败"),D}},me=()=>{if(b.value.length===0||i.value)return;const D=b.value[0];i.value=D.id,D?.files?.length>0&&(a.value=D.files.map((W,X)=>X))},F=(D,W)=>{const X=D.indexOf(W);X>-1?D.splice(X,1):D.push(W)},k=async()=>{try{const{value:D}=await Ee.prompt("请输入Batch名称","创建Batch",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:"Batch名称",inputValidator:ve=>!!ve&&ve.trim().length>0||"名称不能为空"}),W=D.trim(),X={id:Date.now().toString(),name:W,files:[],createTime:new Date().toISOString()};b.value.push(X),await Y(),z.success("Batch创建成功"),i.value=X.id}catch(D){D!=="cancel"&&re(D,"创建Batch失败")}},p=async D=>{const W=b.value.find(X=>X.id===D);if(W)try{const{value:X}=await Ee.prompt("请输入Batch名称","编辑Batch",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:W.name,inputPlaceholder:"Batch名称",inputValidator:ve=>!!ve&&ve.trim().length>0||"名称不能为空"});W.name=X.trim(),await Y(),z.success("Batch名称已更新")}catch(X){X!=="cancel"&&re(X,"编辑Batch失败")}},L=async D=>{const W=b.value.find(X=>X.id===D);if(W)try{await Ee.confirm(`确定要删除Batch "${W.name}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const X=b.value.findIndex(ve=>ve.id===D);X>-1&&(b.value.splice(X,1),await Y(),i.value===D&&(i.value=null),z.success("Batch已删除"))}catch(X){X!=="cancel"&&re(X,"删除Batch失败")}},N=D=>{i.value=D;const W=b.value.find(X=>X.id===D);W&&W.files&&W.files.length>0?a.value=W.files.map((X,ve)=>ve):a.value=[]},J=D=>{F(a.value,D)},ae=async()=>{if(!(!t.value||a.value.length===0))try{const D=a.value.length;await Ee.confirm(`确定要删除选中的 ${D} 个文件吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),[...new Set(a.value)].sort((X,ve)=>ve-X).forEach(X=>{X>=0&&X<t.value.files.length&&t.value.files.splice(X,1)}),t.value.files.length>0?a.value=t.value.files.map((X,ve)=>ve):a.value=[],await Y(),z.success(`已删除 ${D} 个文件`)}catch(D){D!=="cancel"&&re(D,"删除失败")}},ce=()=>{if(!t.value){z.warning("请先选择一个Batch");return}m.value=!0},Ie=async D=>{if(!(!t.value||D.length===0))try{B.value=!0;const W=t.value,X=new Set(W.files.map(U)),ve=D.filter(Ge=>!X.has(Ge)).map(Ge=>({uri:Ge}));W.files.push(...ve),await Y(),W.files.length>0&&(a.value=W.files.map((Ge,at)=>at)),z.success(`成功添加 ${ve.length} 个文件`),m.value=!1}catch(W){re(W,"添加文件失败")}finally{B.value=!1}},Fe=()=>{m.value=!1},we=D=>{l.value=l.value===D?null:D,u.value=[],y.value=!1},j=D=>{F(u.value,D)},_=D=>{y.value=D!==void 0?D:!y.value},H=()=>!t.value||!l.value||a.value.length===0||!w.value?(z.warning("请选择Batch、播放列表和目标列表，并至少选中一个文件"),!1):!0,V=async()=>{if(H())try{const D=E().map(U);await Ee.confirm(`确定要将选中的 ${D.length} 个文件添加到选中的列表吗？`,"确认添加",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),r.onAddFiles&&(await r.onAddFiles({playlistId:l.value,files:D,preLists:u.value,filesList:y.value}),z.success("文件已添加到播放列表"))}catch(D){D!=="cancel"&&re(D,"添加文件失败")}},se=async()=>{if(H())try{const D=E().map(U);await Ee.confirm(`确定要从选中的列表中删除选中的 ${D.length} 个文件吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),r.onRemoveFiles&&(await r.onRemoveFiles({playlistId:l.value,files:D,preLists:u.value,filesList:y.value}),z.success("文件已从播放列表删除"))}catch(D){D!=="cancel"&&re(D,"删除文件失败")}},ne=()=>{$.value=!1},Z=()=>{u.value=[],y.value=!1,a.value=[]},ue=()=>{i.value=null,l.value=null,Z()},ye=()=>{r.playlistCollection?.length>0?l.value=r.playlistCollection[0].id:l.value=null};return Le(()=>r.playlistCollection,D=>{D?.length>0&&!l.value&&(l.value=D[0].id)},{immediate:!0}),Le(()=>r.visible,D=>{$.value=D,D?(Z(),ye(),h()):ue()},{immediate:!0}),Le($,D=>{D!==r.visible&&d("update:visible",D)}),nt(()=>{h()}),(D,W)=>{const X=Be,ve=ze,Ge=Dt,at=Fl;return v(),te(at,{modelValue:$.value,"onUpdate:modelValue":W[4]||(W[4]=he=>$.value=he),title:"批量模式",size:1200,direction:"rtl","before-close":ne},{default:c(()=>[o("div",Nd,[o("div",Ld,[o("div",Od,[W[5]||(W[5]=o("h3",{class:"text-base font-semibold"},"Batch列表",-1)),n(ve,{type:"primary",size:"small",onClick:k,plain:""},{default:c(()=>[n(X,null,{default:c(()=>[n(s(ht))]),_:1})]),_:1})]),o("div",Id,[(v(!0),T(De,null,Ae(b.value,he=>(v(),T("div",{key:he.id,class:oe(["border rounded px-3 py-2 hover:bg-gray-50 flex items-center gap-2",{"border-blue-500 bg-blue-50":he.id===i.value}])},[o("div",{class:"flex-1 cursor-pointer",onClick:Se=>N(he.id)},[o("div",zd,G(he.name),1),o("div",Ud,G(he.files?he.files.length:0)+" 个文件 ",1)],8,Rd),o("div",Vd,[n(ve,{type:"default",plain:"",size:"small",circle:"",onClick:ge(Se=>L(he.id),["stop"]),title:"删除"},{default:c(()=>[n(X,null,{default:c(()=>[n(s(je))]),_:1})]),_:1},8,["onClick"])])],2))),128)),b.value.length===0?(v(),T("div",Kd,' 暂无Batch，点击"+"创建 ')):Q("",!0)])]),o("div",Gd,[o("div",jd,[o("div",Wd,[o("h3",Hd,G(t.value?t.value.name:"请选择一个Batch"),1),t.value?(v(),te(ve,{key:0,type:"default",plain:"",size:"small",circle:"",onClick:W[0]||(W[0]=he=>p(t.value.id)),title:"编辑"},{default:c(()=>[n(X,null,{default:c(()=>[n(s(yl))]),_:1})]),_:1})):Q("",!0)]),t.value?(v(),T("div",Yd,[n(ve,{type:"primary",size:"small",onClick:ce,plain:""},{default:c(()=>[n(X,null,{default:c(()=>[n(s(ht))]),_:1})]),_:1}),n(ve,{type:"danger",size:"small",onClick:ae,disabled:a.value.length===0,plain:""},{default:c(()=>[n(X,null,{default:c(()=>[n(s(je))]),_:1}),q(" ("+G(a.value.length)+") ",1)]),_:1},8,["disabled"])])):Q("",!0)]),o("div",Jd,[t.value&&t.value.files&&t.value.files.length>0?(v(),T("div",qd,[(v(!0),T(De,null,Ae(t.value.files,(he,Se)=>(v(),T("div",{key:Se,class:oe(["flex items-center gap-2 p-2 border border-blue-500 rounded hover:bg-gray-50 cursor-pointer",{"bg-blue-50":a.value.includes(Se)}]),onClick:ot=>J(Se)},[n(Ge,{"model-value":a.value.includes(Se),onChange:ot=>J(Se),class:"!h-6",onClick:W[1]||(W[1]=ge(()=>{},["stop"])),size:"default"},null,8,["model-value","onChange"]),o("span",Qd,G(Se+1),1),o("span",{class:"flex-1 text-sm truncate",title:U(he)},G(U(he).split("/").pop()),9,Zd)],10,Xd))),128))])):(v(),T("div",eu,G(t.value?"该Batch暂无文件":"请先选择一个Batch"),1))])]),o("div",tu,[o("div",lu,[W[9]||(W[9]=o("h3",{class:"text-base font-semibold mb-2"},"Playlist操作",-1)),o("div",su,[n(ve,{type:"default",size:"small",onClick:V,disabled:!t.value||!l.value||a.value.length===0||!w.value,plain:""},{default:c(()=>[n(X,{class:"mr-1"},{default:c(()=>[n(s(ht))]),_:1}),W[6]||(W[6]=q(" 添加到播放列表 ",-1))]),_:1},8,["disabled"]),n(ve,{type:"default",size:"small",onClick:se,disabled:!t.value||!l.value||a.value.length===0||!w.value,plain:""},{default:c(()=>[n(X,{class:"mr-1"},{default:c(()=>[n(s(je))]),_:1}),W[7]||(W[7]=q(" 从播放列表删除 ",-1))]),_:1},8,["disabled"])]),o("div",nu,[W[8]||(W[8]=o("div",{class:"text-xs text-gray-500 mb-2"},"选择播放列表 进行批量操作",-1)),o("div",au,[(v(!0),T(De,null,Ae(e.playlistCollection,he=>(v(),T("div",{key:he.id,class:oe(["flex items-center justify-between px-2 py-1.5 rounded cursor-pointer hover:bg-gray-50 transition-colors",{"bg-blue-50 border border-blue-200":he.id===l.value}]),onClick:Se=>we(he.id)},[o("span",iu,G(he.name),1),o("span",ru,G(O(he))+" / "+G(C(he)),1)],10,ou))),128)),e.playlistCollection.length===0?(v(),T("div",du," 暂无播放列表 ")):Q("",!0)])])]),A.value?(v(),T("div",uu,[o("div",cu,[W[10]||(W[10]=o("div",{class:"text-xs font-semibold text-gray-600 mb-2"},"前置文件",-1)),o("div",fu,[(v(),T(De,null,Ae(["周一","周二","周三","周四","周五","周六","周日"],(he,Se)=>o("div",{key:Se,class:"flex items-center gap-2"},[n(Ge,{"model-value":u.value.includes(Se),onChange:ot=>j(Se),size:"small"},null,8,["model-value","onChange"]),o("span",{class:oe(["text-xs flex-1 cursor-pointer hover:text-blue-500",{"text-blue-600 font-medium":u.value.includes(Se)}]),onClick:ot=>j(Se)},G(he),11,pu),o("span",vu,G(R(Se))+" / "+G(de(Se)),1)])),64))])]),o("div",mu,[o("div",gu,[n(Ge,{"model-value":y.value,onChange:_,size:"small"},null,8,["model-value"]),o("span",{class:oe(["text-xs font-semibold text-gray-600 cursor-pointer hover:text-blue-500 flex-1",{"text-blue-600":y.value}]),onClick:W[2]||(W[2]=he=>_())}," 正式文件 ",2),o("span",yu,G(S())+" / "+G(x()),1)])])])):(v(),T("div",hu," 请先选择一个播放列表 "))])]),n(Cl,{visible:m.value,"onUpdate:visible":W[3]||(W[3]=he=>m.value=he),title:"选择文件添加到Batch","confirm-button-text":"添加","confirm-loading":B.value,onConfirm:Ie,onClose:Fe},null,8,["visible","confirm-loading"])]),_:1},8,["modelValue"])}}});function $u(){return{...{playlistCollection:K([]),activePlaylistId:K(""),playlistStatus:K(null),playlistLoading:K(!1),playlistRefreshing:K(!1),playing:K(!1),stopping:K(!1),showMoreActions:K(!1),editingPlaylistId:K(null),editingPlaylistName:K(""),fileBrowserDialogVisible:K(!1),fileBrowserTarget:K("files"),replaceFileInfo:K(null),selectedWeekdayIndex:K(null),preFilesDragMode:K(!1),filesDragMode:K(!1),preFilesBatchDeleteMode:K(!1),filesBatchDeleteMode:K(!1),selectedPreFileIndices:K([]),selectedFileIndices:K([]),preFilesExpanded:K(!1),playlistSelectorVisible:K(!1),playlistSelectorSelectedFiles:K([]),batchDrawerVisible:K(!1),cronBuilderVisible:K(!1),cronPreviewVisible:K(!1),cronPreviewTimes:K([]),initialCronExpr:K(""),agentListDialogVisible:K(!1),scanDialogVisible:K(!1),loading:K(!1),deviceList:K([]),connectedDeviceList:K([]),dlnaDeviceList:K([]),dlnaScanning:K(!1),miDeviceList:K([]),miScanning:K(!1),pendingDeviceType:K(null),preFilesSortOrder:K(null),filesSortOrder:K(null),preFilesOriginalOrder:K(null),filesOriginalOrder:K(null)}}}async function We(e,f,r={}){let d;return f==="GET"?d=await Te.get(`/playlist/${e}`,{params:r}):d=await Te.post(`/playlist/${e}`,r),d.data}function Cu(e,f,r,d,b,i,l,u){const y=F=>F.map(k=>({...k})),a=F=>{const k="playlist"in F&&Array.isArray(F.playlist)&&F.playlist||"files"in F&&Array.isArray(F.files)&&F.files||[];return y(pt(k,!0))},m=F=>{if(F.pre_lists&&Array.isArray(F.pre_lists)&&F.pre_lists.length===vt)return F.pre_lists.map(L=>y(pt(L||[],!0)));const k="pre_files"in F&&Array.isArray(F.pre_files)&&F.pre_files||[],p=y(pt(k,!0));return Array(vt).fill(null).map(()=>[...p])},B=F=>Ti.includes(F)?F:Bi,M=F=>({enabled:F?.enabled===1?1:0,cron:F?.cron?String(F.cron):"",duration:F?.duration||0}),$=(F,k)=>{if(typeof F=="number")return F;if(F==null)return k;const p=parseInt(String(F),10);return isNaN(p)?k:p},t=F=>F===!0||F===1,A=(F,k)=>{if(k===0)return 0;const p=$(F,0);return Math.max(0,Math.min(p,k-1))},w=()=>Array(vt).fill(null).map(()=>[]),U=F=>Array.isArray(F)&&F.length===vt&&F.every(k=>Array.isArray(k)),E=(F,k="播放列表")=>{const p=a(F),L=m(F),N=A(F?.current_index,p.length),J=F?.name&&String(F.name).trim()||k,ae=B(F?.device?.type||F?.device_type),ce=F?.device_address||F?.device?.address||null;return{id:F?.id||Za(),name:J,playlist:p,pre_lists:L,total:p.length,current_index:N,pre_index:$(F?.pre_index,-1),device_address:ce,device_type:ae,device:F?.device||{type:ae,address:ce,name:F?.device?.name||null},schedule:M(F?.schedule),trigger_button:F?.trigger_button||"",updatedAt:"updatedAt"in F&&typeof F.updatedAt=="number"?F.updatedAt:Date.now(),isPlaying:t(F?.isPlaying)}},I=F=>!Array.isArray(F)||F.length===0?[E({name:Ye})]:F.map((k,p)=>"playlist"in k&&"total"in k?k:E(k,k?.name||`播放列表${p+1}`)),g=F=>{if(F&&"playlists"in F&&Array.isArray(F.playlists)){const p=F,L=I(p.playlists),N=L.some(J=>J.id===p.activePlaylistId)?p.activePlaylistId:L[0]?.id||null;return{playlists:L,activePlaylistId:N}}if(F&&!Array.isArray(F)&&("playlist"in F||"files"in F)){const p=F,L="playlist"in p&&Array.isArray(p.playlist)&&p.playlist||"files"in p&&Array.isArray(p.files)&&p.files||[],N=E({id:p.id||p.playlist_id,name:p.name||Ye,files:L,current_index:p.current_index,device_address:p.device_address});return{playlists:[N],activePlaylistId:N.id}}const k=E({name:Ye});return{playlists:[k],activePlaylistId:k.id}},P=F=>{if(!F)return null;if(!Array.isArray(F)&&Object.keys(F).length>0){const k=Object.values(F).map(p=>E(p,p.name||Ye));return{playlists:k,activePlaylistId:k[0]?.id||null}}if(Array.isArray(F)){const k=F.map(p=>E(p,p.name||Ye));return{playlists:k,activePlaylistId:k[0]?.id||null}}if(!Array.isArray(F)&&"id"in F&&typeof F.id=="string"){const k=F;return{playlists:[E(k,k.name||Ye)],activePlaylistId:k.id}}return null},ee=F=>{const k={};return F.forEach(p=>{if(!p.id)return;const L=B(p.device?.type||p.device_type),N=pt(p.playlist||[],!0),J=m(p);k[p.id]={id:p.id,name:p.name||Ye,files:N,pre_lists:J,current_index:p.current_index||0,device:{address:p.device?.address||p.device_address||"",type:L,name:p.device?.name||null},schedule:p.schedule||{enabled:0,cron:"",duration:0},trigger_button:p.trigger_button||"",create_time:p.create_time||el(),updated_time:el()}}),k},de=async F=>{try{const k=(F||e.value||[]).map(N=>({...N,total:Array.isArray(N.playlist)?N.playlist.length:0,updatedAt:Date.now()})),p=ee(k),L=await We("updateAll","POST",p);if(L.code!==0)throw new Error(L.msg||"保存播放列表集合失败")}catch(k){re(k,"保存播放列表集合失败")}},R=async F=>{try{const p=ee([F])[F.id];if(!p)throw new Error("播放列表数据格式错误");const L=await We("update","POST",p);if(L.code!==0)throw new Error(L.msg||"更新播放列表失败");return!0}catch(k){return re(k,"更新播放列表失败"),!1}},x=F=>{const k=Array.isArray(F)?F:e.value;if(!k||k.length===0){r.value=null,f.value="";return}const p=k.find(J=>J.id===f.value)||k[0];f.value=p.id;const L=A(p.current_index,p.playlist?.length||0),N=U(p.pre_lists)?p.pre_lists.map(J=>[...J||[]]):w();r.value={...p,playlist:[...p.playlist||[]],pre_lists:N,current_index:L,pre_index:$(p.pre_index,-1),in_pre_files:!1,isPlaying:t(p.isPlaying)}},S=F=>({...F,playlist:F.playlist.map(k=>({...k})),pre_lists:U(F.pre_lists)?F.pre_lists.map(k=>k.map(p=>({...p}))):w()}),C=async F=>{if(typeof F!="function")return null;let k=e.value.length>0?e.value.map(S):[E({name:Ye})],p=k.findIndex(ae=>ae.id===f.value);p===-1&&(p=0,f.value=k[0].id);const L=k[p],N=F(S(L))||L,J=E(N,L.name);return U(J.pre_lists)||(J.pre_lists=U(L.pre_lists)?L.pre_lists.map(ae=>ae.map(ce=>({...ce}))):w()),k[p]=J,e.value=k,await R(k[p]),x(k),r.value},O=(F,k)=>{const p=localStorage.getItem(Ol);p&&F.some(L=>L.id===p)?f.value=p:f.value=k||""},h=async()=>{try{const F=await We("get","GET",{});if(F.code!==0)throw new Error(F.msg||"获取播放列表失败");const k=P(F.data),p=g(k||null);return e.value=p.playlists,O(p.playlists,p.activePlaylistId),x(p.playlists),p}catch(F){dt.error("从接口加载播放列表失败:",F);const k=g(null);return e.value=k.playlists,O(k.playlists,k.activePlaylistId),x(k.playlists),k}},Y=F=>F?!!(b.value!==null||i.value||l.value):!1;return{normalizePlaylistItem:E,normalizePlaylistCollection:g,transformApiDataToPlaylistFormat:P,transformPlaylistToApiFormat:ee,savePlaylist:de,updateSinglePlaylist:R,syncActivePlaylist:x,updateActivePlaylistData:C,loadPlaylist:h,refreshPlaylistStatus:async(F=!1,k=!1)=>{try{if(Y(k))return;if(d.value=!0,F){const p=f.value;if(!p)return;const L=await We("get","GET",{id:p});if(L.code!==0)throw new Error(L.msg||"获取播放列表状态失败");const N=P(L.data);if(!N?.playlists?.length)return;const J=N.playlists[0],ae=e.value.map(ce=>ce.id!==p?ce:{...ce,...J,playlist:J.playlist||ce.playlist,pre_lists:U(J.pre_lists)?J.pre_lists.map(Ie=>[...Ie||[]]):ce.pre_lists,current_index:J.current_index!==void 0?J.current_index:ce.current_index,isPlaying:t(J?.isPlaying)});e.value=ae,x(ae)}else await h()}catch(p){dt.error("刷新播放列表状态失败:",p)}finally{d.value=!1}}}}function ku(e,f,r,d,b,i,l,u,y){return{loadPlaylist:async()=>{try{const E=await We("get","GET",{});if(E.code!==0)throw new Error(E.msg||"获取播放列表失败");return E.data}catch(E){throw dt.error("从接口加载播放列表失败:",E),E}},handleSelectPlaylist:async E=>{!E||E===f.value||!e.value.find(g=>g.id===E)||(f.value=E,localStorage.setItem(Ol,E),i(e.value))},handleCreatePlaylist:async()=>{try{const E=`播放列表${e.value.length+1}`,{value:I}=await Ee.prompt("请输入播放列表名称","新建播放列表",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:E,inputPlaceholder:E,inputValidator:P=>!!P&&P.trim().length>0||"名称不能为空"});return{name:(I||E).trim()}}catch(E){if(E!=="cancel")throw E;return null}},handleCopyPlaylist:async E=>{if(!E)return null;const I=e.value.find(g=>g.id===E);if(!I)return null;try{const g=`${I.name}_副本`,{value:P}=await Ee.prompt("请输入播放列表名称","复制播放列表",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:g,inputPlaceholder:g,inputValidator:de=>!!de&&de.trim().length>0||"名称不能为空"}),ee=(P||g).trim();return{sourcePlaylist:I,name:ee}}catch(g){if(g!=="cancel")throw g;return null}},handleDeletePlaylistGroup:async E=>{if(!E)return!1;if(e.value.length<=1)return z.warning("至少保留一个播放列表"),!1;const I=e.value.find(g=>g.id===E);if(!I)return!1;try{return await Ee.confirm(`确认删除播放列表"${I.name}"吗？`,"删除播放列表",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),!0}catch(g){if(g!=="cancel")throw g;return!1}},handlePlayPlaylist:async()=>{const E=r.value;if(!E||!E.id){z.warning("播放列表不存在");return}if(!E.playlist||E.playlist.length===0){z.warning("播放列表为空，请先添加文件");return}try{d.value=!0,await l(g=>{const P=Array.isArray(g.playlist)?g.playlist:[];return g.current_index=Math.max(0,Math.min(g.current_index||0,P.length-1)),g.total=P.length,g});const I=await We("play","POST",{id:E.id});if(I.code!==0)throw new Error(I.msg||"播放失败");await u(!0),z.success("开始播放")}catch(I){re(I,"播放失败")}finally{d.value=!1}},handlePlayNext:async()=>{const E=r.value;if(!E||!E.id){z.warning("播放列表不存在");return}if(!E.playlist||E.playlist.length===0){z.warning("播放列表为空，无法播放下一首");return}try{d.value=!0;const I=await We("playNext","POST",{id:E.id});if(I.code!==0)throw new Error(I.msg||"播放下一首失败");await u(!0),z.success("已切换到下一首")}catch(I){re(I,"播放下一首失败")}finally{d.value=!1}},handlePlayPre:async()=>{const E=r.value;if(!E||!E.id){z.warning("播放列表不存在");return}const I=y().length>0,g=E.playlist&&E.playlist.length>0;if(!I&&!g){z.warning("播放列表为空，无法播放上一首");return}try{d.value=!0;const P=await We("playPre","POST",{id:E.id});if(P.code!==0)throw new Error(P.msg||"播放上一首失败");await u(!0),z.success("已切换到上一首")}catch(P){re(P,"播放上一首失败")}finally{d.value=!1}},handleStopPlaylist:async()=>{const E=r.value;if(!E||!E.id){z.warning("播放列表不存在");return}try{b.value=!0;const I=await We("stop","POST",{id:E.id});if(I.code!==0)throw new Error(I.msg||"停止播放失败");await u(!0),z.success("已停止播放")}catch(I){re(I,"停止播放列表失败")}finally{b.value=!1}}}}function Du(e,f,r,d,b,i){const l=()=>{const A=e.value?.schedule?.cron||"";b.value=A,f.value=!0},u=()=>{f.value=!1},y=A=>{A&&(e.value?(B(A),z.success("Cron 表达式已应用到当前播放列表")):z.warning("请先选择一个播放列表"))},a=A=>{d.value=A,r.value=!0},m=async A=>{e.value&&await i(w=>(w.schedule||(w.schedule={enabled:0,cron:"",duration:0}),w.schedule.enabled=A?1:0,w))},B=async A=>{e.value&&await i(w=>(w.schedule||(w.schedule={enabled:0,cron:"",duration:0}),w.schedule.cron=A,w))};return{handleOpenCronBuilder:l,handleCloseCronBuilder:u,handleCronBuilderApply:y,handleCronBuilderPreview:a,handleTogglePlaylistCronEnabled:m,handleUpdatePlaylistCron:B,handleUpdatePlaylistDuration:async A=>{e.value&&await i(w=>(w.schedule||(w.schedule={enabled:0,cron:"",duration:0}),w.schedule.duration=A||0,w))},handleUpdateTriggerButton:async A=>{e.value&&await i(w=>(w.trigger_button=A||"",w))},handlePreviewPlaylistCron:()=>{if(!e.value||!e.value.schedule?.cron){z.warning("请先设置 Cron 表达式");return}try{const A=e.value.schedule.cron,w=Yt(A,5);w&&w.length>0?(d.value=w,r.value=!0):z.warning("无法解析 Cron 表达式")}catch(A){re(A,"预览失败")}}}}async function Mt(e,f,r){let d;const b="bluetooth";return f==="GET"?d=await Te.get(`/${b}/${e}`,{params:r}):d=await Te.post(`/${b}/${e}`,r),d.data}function xu(e,f,r,d,b,i,l,u,y,a,m,B){const M=C=>C.deviceID||C.address||"",$=async()=>{const C=e.value,O=f.value||C?.device?.type||C?.device_type||"dlna";if(!["agent","bluetooth"].includes(O)){r.value=[];return}try{l.value=!0;let h=null;O==="agent"?h=(await Te.get("/agent/list")).data:h=await Mt("paired","GET"),h.code===0?r.value=h.data||[]:z.error(h.msg||"获取设备失败")}catch(h){console.error("获取设备失败:",h),z.error("获取设备失败")}finally{l.value=!1}},t=async C=>{try{C.connecting=!0;const O=await Mt("connect","POST",{address:C.address});O.code===0?(z.success(`成功连接到设备: ${C.name}`),await $(),i.value=i.value.filter(h=>h.address!==C.address)):z.error(O.msg||"连接失败")}catch(O){console.error("连接设备失败:",O),z.error("连接设备失败")}finally{C.connecting=!1}},A=async()=>{try{u.value=!0;const C=await Te.get("/dlna/scan",{params:{timeout:5}});C.data.code===0?(d.value=C.data.data||[],z.success(`扫描到 ${d.value.length} 个 DLNA 设备`)):z.error(C.data.msg||"扫描 DLNA 设备失败")}catch(C){re(C,"扫描 DLNA 设备失败")}finally{u.value=!1}},w=async C=>{const O=M(C);if(!O)return;const h=b.value;if(!Array.isArray(h))return;const Y=h.find(me=>M(me)===O);if(Y){Y._volumeRefreshing=!0;try{const me=await Te.get("/mi/volume",{params:{device_id:O}});me.data.code===0?Y.volume=me.data.data?.volume??me.data.data??void 0:z.error(me.data.msg||`获取设备 ${Y.name||O} 音量失败`)}catch(me){re(me,`获取设备 ${Y.name||O} 音量失败`)}finally{Y._volumeRefreshing=!1}}},U=async()=>{try{y.value=!0;const C=await Te.get("/mi/scan",{params:{timeout:5}});if(C.data.code===0){const O=(C.data.data||[]).map(h=>({...h,volume:void 0,_volumeChanging:!1,_volumeRefreshing:!1}));b.value=O,await Promise.allSettled(b.value.map(h=>w(h))),z.success(`扫描到 ${O.length} 个小米设备`)}else z.error(C.data.msg||"扫描小米设备失败")}catch(C){re(C,"扫描小米设备失败")}finally{y.value=!1}},E=async()=>{try{l.value=!0;const C=await Mt("scan","GET");if(C.code===0){const O=Array.isArray(C.data)?C.data:[];i.value=O.map(h=>({name:h.name||"",address:h.address||"",...h,connecting:!1})),z.success(`扫描完成，找到 ${i.value.length} 个设备`)}else z.error(C.msg||"扫描失败")}catch(C){console.error("扫描设备失败:",C),z.error("扫描设备失败")}finally{l.value=!1}},I=()=>{a.value=!0},g=()=>{a.value=!1},P=async C=>{if(!e.value||!C||C==="")return;if(!["agent","dlna","bluetooth","mi"].includes(C)){z.error(`无效的设备类型: ${C}`);return}const h=C;f.value=h;const Y=e.value;Y.device_type=h,Y.device?Y.device.type=h:Y.device={type:h,address:"",name:null},await $()},ee=async(C,O=null)=>{e.value&&(await B(h=>{const Y=f.value||h.device?.type||h.device_type||"dlna";return h.device||(h.device={address:"",type:Y,name:null}),h.device.type=Y,h.device.address=C,O!==null&&(h.device.name=O),h.device_address=C,h.device_type=Y,h}),f.value=null)};return{getMiDeviceId:M,refreshConnectedList:$,handleConnectDevice:t,scanDlnaDevices:A,getMiDeviceVolume:w,scanMiDevices:U,handleUpdateDeviceList:E,handleOpenScanDialog:I,handleCloseScanDialog:g,handleUpdatePlaylistDeviceType:P,handleUpdatePlaylistDeviceAddress:ee,handleSelectBluetoothDevice:async C=>{const O=r.value.find(Y=>Y.address===C),h=O?O.name:null;await ee(C,h)},handleSelectAgentDevice:async C=>{const O=typeof C=="string"?C:C.address,h=typeof C=="string"?null:C.name;await ee(O,h)},handleSelectMiDevice:async C=>{const O=C.deviceID||C.address||"",h=C.name||"";await ee(O,h)},handleOpenAgentListDialog:async()=>{m.value=!0,await $()}}}function Fu(){const e=Fn({callbacks:{onPlay:()=>{z.success("开始播放")},onError:()=>{re(new Error("音频播放失败"),"播放失败"),f()},onEnded:()=>{f()}}}),f=()=>{e.clear()};return{audioPlayer:e,clearBrowserAudioPlayer:f,handlePlayFileInBrowser:u=>{const y=u?.uri||u?.path||"";if(!y||typeof y!="string"||y.trim()===""){z.warning("文件路径无效");return}if(e.playingFilePath.value===y&&e.audio&&!e.audio.paused){f(),z.info("已停止播放");return}const a=_n(y);if(!a||typeof a!="string"||a.trim()===""){z.error("无法生成媒体文件URL");return}if(a.includes("index.html")||a.endsWith(".html")){z.error("生成的媒体URL无效，可能是HTML页面");return}e.load(a,{playingFilePath:y}),e.play().catch(m=>{re(m,"播放失败"),f()})},isFilePlaying:u=>{const y=u?.uri||u?.path||"";return e.isFilePlaying(y)},getFilePlayProgress:u=>{const y=u?.uri||u?.path||"";return e.getFilePlayProgress(y)},getFileDuration:u=>{const y=u?.uri||u?.path||"",a=u?.duration||0;return e.getFileDuration(y,a)},handleSeekFile:(u,y)=>{const a=u?.uri||u?.path||"";e.seekFile(a,y)}}}function _u(e,f,r,d,b,i,l,u,y,a,m,B,M,$,t){const A=()=>l.value!==null?l.value:Xe(),w=_=>((!_.pre_lists||!Array.isArray(_.pre_lists)||_.pre_lists.length!==7)&&(_.pre_lists=Array(7).fill(null).map(()=>[])),_.pre_lists),U=(_="请先选择一个播放列表")=>f.value?!0:(z.warning(_),!1),E=(_,H)=>{_!=="cancel"&&re(_,H)},I=async(_,H)=>{try{r.value=!0,await _()}catch(V){E(V,H)}finally{r.value=!1}},g=()=>{U()&&(d.value=!0,b.value="files",i.value=null)},P=()=>{U()&&(d.value=!0,b.value="pre_files",i.value=null)},ee=async _=>{if(_.length!==0){if(!f.value){z.warning("请先创建并选择一个播放列表");return}try{r.value=!0,await B(V=>{const se=A(),ne=b.value,Z=ne==="pre_files"?Array.isArray(V.pre_lists)&&V.pre_lists.length===7?[...V.pre_lists[se]||[]]:[]:Array.isArray(V.playlist)?[...V.playlist]:[],ue=new Set;if(Z.forEach(ye=>{ye?.uri&&ue.add(ye.uri)}),i.value&&_.length>0){const ye=i.value.index;if(i.value.type==="pre_files"){w(V);const D=[...V.pre_lists[se]||[]];ye>=0&&ye<D.length&&(D[ye]={uri:_[0]},V.pre_lists[se]=D)}else{const D=[...V.playlist];ye>=0&&ye<D.length&&(D[ye]={uri:_[0]},V.playlist=D,V.total=D.length)}return i.value=null,V}for(const ye of _)if(!ue.has(ye)){const D={uri:ye};Z.push(D),ue.add(ye)}return ne==="pre_files"?(w(V),V.pre_lists[se]=Z):(V.playlist=Z,V.total=Z.length,Z.length===0?V.current_index=0:V.current_index>=Z.length&&(V.current_index=Z.length-1)),V});const H=b.value==="pre_files"?"前置列表":"播放列表";z.success(`成功添加 ${_.length} 个文件到${H}`),d.value=!1}catch(H){re(H,"添加文件到播放列表失败")}finally{r.value=!1}}},de=()=>{d.value=!1},R=async _=>{const H=f.value;if(!(!H||_<=0||_>=H.playlist.length))try{r.value=!0,await B(V=>{const se=[...V.playlist];return[se[_-1],se[_]]=[se[_],se[_-1]],V.playlist=se,V.current_index===_?V.current_index=_-1:V.current_index===_-1&&(V.current_index=_),V.total=se.length,V}),z.success("已上移")}catch(V){re(V,"上移失败")}finally{r.value=!1}},x=async _=>{const H=f.value;if(!(!H||_<0||_>=H.playlist.length-1))try{r.value=!0,await B(V=>{const se=[...V.playlist];return[se[_],se[_+1]]=[se[_+1],se[_]],V.playlist=se,V.current_index===_?V.current_index=_+1:V.current_index===_+1&&(V.current_index=_),V.total=se.length,V}),z.success("已下移")}catch(V){re(V,"下移失败")}finally{r.value=!1}},S=async _=>{const H=f.value;if(!H||_<0||_>=H.playlist.length)return;const se=H.playlist[_]?.uri?.split("/").pop()||"文件";try{await Ee.confirm(`确定要删除 "${se}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),r.value=!0,await B(ne=>{const Z=[...ne.playlist];return Z.splice(_,1),ne.playlist=Z,Z.length===0?ne.current_index=0:_<ne.current_index?ne.current_index=Math.max(0,ne.current_index-1):_===ne.current_index&&(ne.current_index=Math.min(ne.current_index,Z.length-1)),ne.total=Z.length,ne}),z.success("已删除")}catch(ne){ne!=="cancel"&&re(ne,"删除失败")}finally{r.value=!1}},C=async _=>{const H=f.value;!H||_<0||_>=H.playlist.length||(i.value={type:"files",index:_},b.value="files",d.value=!0)},O=async _=>{const H=f.value,V=M();!H||!V||_<=0||_>=V.length||await I(async()=>{await B(se=>{const ne=A();w(se);const Z=[...se.pre_lists[ne]||[]];return[Z[_-1],Z[_]]=[Z[_],Z[_-1]],se.pre_lists[ne]=Z,se})},"上移失败")},h=async _=>{const H=f.value,V=M();!H||!V||_<0||_>=V.length-1||await I(async()=>{await B(se=>{const ne=A();w(se);const Z=[...se.pre_lists[ne]||[]];return[Z[_],Z[_+1]]=[Z[_+1],Z[_]],se.pre_lists[ne]=Z,se})},"下移失败")},Y=async _=>{const H=f.value,V=M();if(!H||!V||_<0||_>=V.length)return;const ne=V[_]?.uri?.split("/").pop()||"文件";try{await Ee.confirm(`确定要删除 "${ne}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await I(async()=>{await B(Z=>{const ue=A();w(Z);const ye=[...Z.pre_lists[ue]||[]];return ye.splice(_,1),Z.pre_lists[ue]=ye,Z}),z.success("已删除")},"删除失败")}catch(Z){E(Z,"删除失败")}},me=async _=>{const H=f.value,V=M();!H||!V||_<0||_>=V.length||(i.value={type:"pre_files",index:_},b.value="pre_files",d.value=!0)},F=()=>{u.value=!u.value,u.value||(a.value=[])},k=()=>{y.value=!y.value,y.value||(m.value=[])},p=_=>{const H=a.value,V=H.indexOf(_);V>-1?H.splice(V,1):H.push(_)},L=_=>{const H=m.value,V=H.indexOf(_);V>-1?H.splice(V,1):H.push(_)},N=async()=>{const _=f.value,H=M(),V=a.value;if(!_||!H||V.length===0)return;const se=V.length;try{await Ee.confirm(`确定要删除选中的 ${se} 个前置文件吗？`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await I(async()=>{const ne=[...new Set(V)].sort((Z,ue)=>ue-Z);await B(Z=>{const ue=A();w(Z);const ye=[...Z.pre_lists[ue]||[]];return ne.forEach(D=>{D>=0&&D<ye.length&&ye.splice(D,1)}),Z.pre_lists[ue]=ye,Z}),a.value=[],u.value=!1,z.success(`已删除 ${se} 个前置文件`)},"批量删除失败")}catch(ne){E(ne,"批量删除失败")}},J=async()=>{const _=f.value,H=m.value;if(!_||!_.playlist||H.length===0)return;const V=H.length;try{await Ee.confirm(`确定要删除选中的 ${V} 个正式文件吗？`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await I(async()=>{const se=[...new Set(H)].sort((ne,Z)=>Z-ne);await B(ne=>{const Z=[...ne.playlist];if(se.forEach(ue=>{ue>=0&&ue<Z.length&&Z.splice(ue,1)}),ne.playlist=Z,Z.length===0)ne.current_index=0;else{let ue=ne.current_index;se.forEach(ye=>{ye<ne.current_index?ue=Math.max(0,ue-1):ye===ne.current_index&&(ue=Math.min(ue,Z.length-1))}),ne.current_index=ue}return ne.total=Z.length,ne}),m.value=[],y.value=!1,z.success(`已删除 ${V} 个正式文件`)},"批量删除失败")}catch(se){E(se,"批量删除失败")}},ae=async()=>{const _=f.value,H=M();if(!(!_||!H||H.length===0))try{await Ee.confirm(`确定要清空前置文件列表吗？此操作将删除所有 ${H.length} 个前置文件。`,"确认清空",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await I(async()=>{await B(V=>{const se=A();return w(V),V.pre_lists[se]=[],V}),z.success("已清空前置文件列表")},"清空失败")}catch(V){E(V,"清空失败")}},ce=async()=>{const _=f.value;if(!(!_||!_.playlist||_.playlist.length===0))try{await Ee.confirm(`确定要清空正式文件列表吗？此操作将删除所有 ${_.playlist.length} 个正式文件。`,"确认清空",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await I(async()=>{await B(H=>(H.playlist=[],H.total=0,H.current_index=0,H)),z.success("已清空正式文件列表")},"清空失败")}catch(H){E(H,"清空失败")}},Ie=async()=>{const _=f.value;if(!_)return;const H=M(),V=H&&H.length||0,se=_.playlist&&_.playlist.length||0,ne=V+se;if(ne!==0)try{const Z=V>0&&se>0?`确定要清空播放列表 "${_.name}" 吗？此操作将删除所有 ${V} 个前置文件和 ${se} 个正式文件，共 ${ne} 个文件。`:V>0?`确定要清空播放列表 "${_.name}" 吗？此操作将删除所有 ${V} 个前置文件。`:`确定要清空播放列表 "${_.name}" 吗？此操作将删除所有 ${se} 个正式文件。`;await Ee.confirm(Z,"确认清空",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await I(async()=>{await B(ue=>(ue.playlist=[],w(ue),ue.pre_lists=ue.pre_lists.map(()=>[]),ue.total=0,ue.current_index=0,ue)),z.success("已清空播放列表（包括前置文件和正式文件）")},"清空失败")}catch(Z){E(Z,"清空失败")}},Fe=_=>typeof _=="string"?{uri:_}:{..._,uri:_.uri||""};return{handleOpenFileBrowser:g,handleOpenFileBrowserForPreFiles:P,handleFileBrowserConfirm:ee,handleCloseFileBrowser:de,handleMovePlaylistItemUp:R,handleMovePlaylistItemDown:x,handleDeletePlaylistItem:S,handleReplacePlaylistItem:C,handleMovePreFileUp:O,handleMovePreFileDown:h,handleDeletePreFile:Y,handleReplacePreFile:me,handleTogglePreFilesBatchDeleteMode:F,handleToggleFilesBatchDeleteMode:k,handleTogglePreFileSelection:p,handleToggleFileSelection:L,handleBatchDeletePreFiles:N,handleBatchDeleteFiles:J,handleClearPreFiles:ae,handleClearFiles:ce,handleClearPlaylist:Ie,handleOpenPlaylistSelectorForPreFile:async _=>{try{if(!_){z.warning("文件信息无效");return}if(t&&$){const H=Fe(_);t.value=[H],$.value=!0}else z.info("请使用文件浏览器添加文件到播放列表")}catch(H){dt.error("打开播放列表选择器失败:",H),z.error("打开对话框失败")}},handleOpenPlaylistSelectorForFile:async _=>{try{if(!_){z.warning("文件信息无效");return}const H=Fe(_);if(!H.uri){z.warning("文件URI无效");return}t&&$?(t.value=[H],$.value=!0):z.info("请使用文件浏览器添加文件到播放列表")}catch(H){dt.error("打开播放列表选择器失败:",H),z.error("打开对话框失败")}}}}function Pu(e,f,r,d,b,i,l,u,y,a,m,B,M){const $=()=>a.value!==null?a.value:Xe(),t=(x,S)=>{if(!x||!S||x.length!==S.length)return!0;for(let C=0;C<x.length;C++){const O=x[C]?.uri||x[C],h=S[C]?.uri||S[C];if(O!==h)return!0}return!1};return{handleTogglePreFilesDragMode:async()=>{if(d.value){const x=f.value,S=M();if(x&&S&&S.length>0){if(t(u.value||[],S))try{r.value=!0,await m(O=>{const h=$();return(!O.pre_lists||!Array.isArray(O.pre_lists)||O.pre_lists.length!==7)&&(O.pre_lists=Array(7).fill(null).map(()=>[])),O.pre_lists[h]=[...S],O.pre_index=x.pre_index,O}),z.success("排序已保存")}catch(O){re(O,"保存排序失败")}finally{r.value=!1}u.value=null}}else{const x=f.value,S=M();x&&S&&S.length>0&&(u.value=[...S]),i.value=null}d.value=!d.value},handleToggleFilesDragMode:async()=>{if(b.value){const x=f.value;if(x&&x.playlist&&x.playlist.length>0){if(t(y.value||[],x.playlist))try{r.value=!0,await m(C=>(C.playlist=[...x.playlist||[]],C.current_index=x.current_index,C.total=x.playlist.length,C)),z.success("排序已保存")}catch(C){re(C,"保存排序失败")}finally{r.value=!1}y.value=null}}else{const x=f.value;x&&x.playlist&&x.playlist.length>0&&(y.value=[...x.playlist||[]]),l.value=null}b.value=!b.value},handlePreFileDragStart:(x,S)=>{if(!d.value){x.preventDefault();return}try{x.dataTransfer.effectAllowed="move",x.dataTransfer.setData("text/plain",S.toString())}catch(C){console.error("拖拽开始失败:",C)}},handlePreFileDragEnd:x=>{const S=x.currentTarget;S&&S.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")},handlePreFileDragOver:x=>{if(!d.value)return;x.preventDefault(),x.dataTransfer.dropEffect="move";const S=x.currentTarget;if(S){const C=S.getBoundingClientRect(),O=x.clientY,h=C.top+C.height/2;S.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500"),O<h?S.classList.add("border-t-2","border-blue-500"):S.classList.add("border-b-2","border-blue-500")}},handlePreFileDrop:(x,S)=>{if(!d.value)return;x.preventDefault();const C=x.currentTarget;C&&C.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500");const O=parseInt(x.dataTransfer.getData("text/plain"),10);if(O===S||isNaN(O))return;const h=f.value,Y=M();if(!h||!Y||O<0||O>=Y.length||S<0||S>=Y.length)return;const me=$(),F=[...Y],[k]=F.splice(O,1);F.splice(S,0,k);let p=h.pre_index;h.pre_index!==void 0&&h.pre_index!==null&&h.pre_index>=0&&(h.pre_index===O?p=S:O<h.pre_index&&S>=h.pre_index?p=h.pre_index-1:O>h.pre_index&&S<=h.pre_index&&(p=h.pre_index+1));const L=e.value.map(N=>N.id===h.id?((!N.pre_lists||!Array.isArray(N.pre_lists)||N.pre_lists.length!==7)&&(N.pre_lists=Array(7).fill(null).map(()=>[])),{...N,pre_lists:N.pre_lists.map((J,ae)=>ae===me?F:J),pre_index:p}):N);e.value=L,B(L)},handleFileDragStart:(x,S)=>{if(!b.value){x.preventDefault();return}try{x.dataTransfer.effectAllowed="move",x.dataTransfer.setData("text/plain",S.toString())}catch(C){console.error("拖拽开始失败:",C)}},handleFileDragEnd:x=>{const S=x.currentTarget;S&&S.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")},handleFileDragOver:x=>{if(!b.value)return;x.preventDefault(),x.dataTransfer.dropEffect="move";const S=x.currentTarget;if(S){const C=S.getBoundingClientRect(),O=x.clientY,h=C.top+C.height/2;S.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500"),O<h?S.classList.add("border-t-2","border-blue-500"):S.classList.add("border-b-2","border-blue-500")}},handleFileDrop:(x,S)=>{if(!b.value)return;x.preventDefault();const C=x.currentTarget;C&&C.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500");const O=parseInt(x.dataTransfer.getData("text/plain"),10);if(O===S||isNaN(O))return;const h=f.value;if(!h||!h.playlist||O<0||O>=h.playlist.length||S<0||S>=h.playlist.length)return;const Y=[...h.playlist||[]],[me]=Y.splice(O,1);Y.splice(S,0,me);let F=h.current_index;h.current_index!==void 0&&h.current_index!==null&&h.current_index>=0&&(h.current_index===O?F=S:O<h.current_index&&S>=h.current_index?F=h.current_index-1:O>h.current_index&&S<=h.current_index&&(F=h.current_index+1));const k=e.value.map(p=>p.id===h.id?{...p,playlist:Y,current_index:F,total:Y.length}:p);e.value=k,B(k)}}}function Su(e,f,r,d,b,i){const l=K(!1),u=K(null),y=K("");return{editNameDialogVisible:l,editNameDialogName:y,handleStartEditPlaylistName:M=>{const $=e.value.find(t=>t.id===M);$&&(u.value=M,y.value=$.name,l.value=!0)},handleSavePlaylistName:async()=>{if(!u.value)return;const M=y.value?.trim();if(!M||M.length===0){z.warning("播放列表名称不能为空");return}const $=u.value,t=e.value.find(A=>A.id===$);if(!t||t.name===M){l.value=!1,u.value=null,y.value="";return}try{const A=e.value.map(w=>w.id===$?{...w,name:M}:w);e.value=A,$===f.value&&i(A),await b(A),l.value=!1,u.value=null,y.value="",z.success("播放列表名称已更新")}catch(A){re(A,"更新播放列表名称失败")}},handleCancelEditPlaylistName:()=>{l.value=!1,u.value=null,y.value=""}}}const Tu={class:"p-1"},Bu={class:"flex gap-4 h-[calc(100vh-150px)]"},ju=ke({__name:"index",setup(e){const{playlistCollection:f,activePlaylistId:r,playlistStatus:d,playlistLoading:b,playlistRefreshing:i,playing:l,stopping:u,showMoreActions:y,editingPlaylistId:a,editingPlaylistName:m,fileBrowserDialogVisible:B,fileBrowserTarget:M,replaceFileInfo:$,selectedWeekdayIndex:t,preFilesDragMode:A,filesDragMode:w,preFilesBatchDeleteMode:U,filesBatchDeleteMode:E,selectedPreFileIndices:I,selectedFileIndices:g,preFilesExpanded:P,playlistSelectorVisible:ee,playlistSelectorSelectedFiles:de,batchDrawerVisible:R,cronBuilderVisible:x,cronPreviewVisible:S,cronPreviewTimes:C,initialCronExpr:O,agentListDialogVisible:h,scanDialogVisible:Y,loading:me,deviceList:F,connectedDeviceList:k,dlnaDeviceList:p,dlnaScanning:L,miDeviceList:N,miScanning:J,pendingDeviceType:ae,preFilesSortOrder:ce,filesSortOrder:Ie,preFilesOriginalOrder:Fe,filesOriginalOrder:we}=$u(),{audioPlayer:j,handlePlayFileInBrowser:_,handleSeekFile:H}=Fu(),V=()=>t.value!==null?t.value:Xe(),se=()=>{const fe=d.value;if(!fe||!fe.pre_lists)return[];const ie=V();return!Array.isArray(fe.pre_lists)||fe.pre_lists.length!==7?[]:fe.pre_lists[ie]||[]},{savePlaylist:ne,syncActivePlaylist:Z,updateActivePlaylistData:ue,loadPlaylist:ye,refreshPlaylistStatus:D}=Cu(f,r,d,i,ae,A,w),W=async fe=>{await ue(fe)},{handleOpenFileBrowser:X,handleOpenFileBrowserForPreFiles:ve,handleFileBrowserConfirm:Ge,handleCloseFileBrowser:at,handleMovePlaylistItemUp:he,handleMovePlaylistItemDown:Se,handleDeletePlaylistItem:ot,handleReplacePlaylistItem:Il,handleMovePreFileUp:Rl,handleMovePreFileDown:zl,handleDeletePreFile:Ul,handleReplacePreFile:Vl,handleTogglePreFilesBatchDeleteMode:Kl,handleToggleFilesBatchDeleteMode:Gl,handleTogglePreFileSelection:jl,handleToggleFileSelection:Wl,handleBatchDeletePreFiles:Hl,handleBatchDeleteFiles:Yl,handleClearPreFiles:Jl,handleClearFiles:ql,handleClearPlaylist:Xl,handleOpenPlaylistSelectorForPreFile:Ql,handleOpenPlaylistSelectorForFile:Zl}=_u(f,d,b,B,M,$,t,U,E,I,g,W,se,ee,de),{handleTogglePreFilesDragMode:es,handleToggleFilesDragMode:ts,handlePreFileDragStart:ls,handlePreFileDragEnd:ss,handlePreFileDragOver:ns,handlePreFileDrop:as,handleFileDragStart:os,handleFileDragEnd:is,handleFileDragOver:rs,handleFileDrop:ds}=Pu(f,d,b,A,w,ce,Ie,Fe,we,t,W,Z,se),{editNameDialogVisible:Ft,editNameDialogName:_t,handleStartEditPlaylistName:us,handleSavePlaylistName:Pt,handleCancelEditPlaylistName:ct}=Su(f,r,a,m,ne,Z),{handleOpenCronBuilder:cs,handleCloseCronBuilder:fs,handleCronBuilderApply:ps,handleCronBuilderPreview:vs,handleTogglePlaylistCronEnabled:ms,handleUpdatePlaylistCron:gs,handleUpdatePlaylistDuration:ys,handleUpdateTriggerButton:hs,handlePreviewPlaylistCron:bs}=Du(d,x,S,C,O,ue),{refreshConnectedList:Jt,handleConnectDevice:ws,scanDlnaDevices:$s,scanMiDevices:Cs,handleUpdateDeviceList:ks,handleOpenScanDialog:Ds,handleCloseScanDialog:xs,handleUpdatePlaylistDeviceType:Fs,handleUpdatePlaylistDeviceAddress:_s,handleSelectBluetoothDevice:Ps,handleSelectAgentDevice:Ss,handleSelectMiDevice:Ts,handleOpenAgentListDialog:Bs}=xu(d,ae,k,p,N,F,me,L,J,Y,h,ue),{handleSelectPlaylist:Es,handleCreatePlaylist:As,handleCopyPlaylist:Ms,handleDeletePlaylistGroup:Ns,handlePlayPlaylist:Ls,handlePlayNext:Os,handlePlayPre:Is,handleStopPlaylist:Rs}=ku(f,r,d,l,u,Z,ue,D,se),zs=async fe=>{await Es(fe),ae.value=null,ce.value=null,Ie.value=null,A.value=!1,w.value=!1,Fe.value=null,we.value=null,U.value=!1,E.value=!1,I.value=[],g.value=[],await Jt()},Us=async(fe,ie)=>{fe==="delete"?await Ns(ie):fe==="copy"&&await Ms(ie)},Vs=async fe=>{try{if(b.value=!0,!f.value.find($e=>$e.id===fe.playlistId)){z.warning("播放列表不存在");return}await ue($e=>{if($e.id!==fe.playlistId)return $e;if(fe.preLists.length>0&&((!$e.pre_lists||!Array.isArray($e.pre_lists)||$e.pre_lists.length!==7)&&($e.pre_lists=Array(7).fill(null).map(()=>[])),fe.preLists.forEach(pe=>{if(pe>=0&&pe<7){const _e=new Set(($e.pre_lists[pe]||[]).map(Me=>typeof Me=="string"?Me:Me?.uri||""));fe.files.forEach(Me=>{_e.has(Me)||($e.pre_lists[pe]||($e.pre_lists[pe]=[]),$e.pre_lists[pe].push({uri:Me}))})}})),fe.filesList){Array.isArray($e.playlist)||($e.playlist=[]);const pe=new Set($e.playlist.map(_e=>typeof _e=="string"?_e:_e?.uri||""));fe.files.forEach(_e=>{pe.has(_e)||$e.playlist.push({uri:_e})}),$e.total=$e.playlist.length}return $e}),Z(f.value),await ne(f.value)}catch(ie){re(ie,"批量添加文件失败")}finally{b.value=!1}},Ks=async fe=>{try{if(b.value=!0,!f.value.find(pe=>pe.id===fe.playlistId)){z.warning("播放列表不存在");return}const $e=new Set(fe.files);await ue(pe=>(pe.id!==fe.playlistId||(fe.preLists.length>0&&pe.pre_lists&&Array.isArray(pe.pre_lists)&&pe.pre_lists.length===7&&fe.preLists.forEach(_e=>{_e>=0&&_e<7&&pe.pre_lists[_e]&&(pe.pre_lists[_e]=pe.pre_lists[_e].filter(Me=>{const Tt=typeof Me=="string"?Me:Me?.uri||"";return!$e.has(Tt)}))}),fe.filesList&&Array.isArray(pe.playlist)&&(pe.playlist=pe.playlist.filter(_e=>{const Me=typeof _e=="string"?_e:_e?.uri||"";return!$e.has(Me)}),pe.total=pe.playlist.length,pe.playlist.length===0?pe.current_index=0:pe.current_index>=pe.playlist.length&&(pe.current_index=pe.playlist.length-1))),pe)),Z(f.value),await ne(f.value)}catch(ie){re(ie,"批量删除文件失败")}finally{b.value=!1}},Gs=async()=>{await Bs()},js=fe=>{t.value=fe,Z(f.value)},St=K(!0),{start:qt,stop:Xt}=Pn(async()=>{await D(!0,!0)},Pi,{immediate:!1,autoCleanup:!0}),Ws=fe=>{St.value=fe,fe?qt():Xt()};return nt(async()=>{await ye(),await Jt(),St.value&&qt()}),wl(()=>{Xt()}),(fe,ie)=>{const $e=bl,pe=hl,_e=Vt,Me=ze,Tt=ut;return v(),T("div",Tu,[o("div",Bu,[n(Mo,{"playlist-collection":s(f),"active-playlist-id":s(r),refreshing:s(i),"auto-refresh-enabled":St.value,onSelect:zs,onCreate:s(As),onRefresh:s(D),onToggleAutoRefresh:Ws,onMenuCommand:Us},null,8,["playlist-collection","active-playlist-id","refreshing","auto-refresh-enabled","onCreate","onRefresh"]),n(xi,{"playlist-status":s(d),"active-playlist-id":s(r),"editing-playlist-id":s(a),"editing-playlist-name":s(m),"onUpdate:editingPlaylistName":ie[0]||(ie[0]=Ce=>ft(m)?m.value=Ce:null),"selected-weekday-index":s(t),"pre-files-drag-mode":s(A),"pre-files-batch-delete-mode":s(U),"selected-pre-file-indices":s(I),"pre-files-expanded":s(P),"files-drag-mode":s(w),"files-batch-delete-mode":s(E),"selected-file-indices":s(g),"playlist-loading":s(b),playing:s(l),stopping:s(u),"show-more-actions":s(y),"audio-player":s(j),onStartEditName:s(us),onSaveName:s(Pt),onCancelEditName:s(ct),onOpenBatchDrawer:ie[1]||(ie[1]=Ce=>R.value=!0),onPlay:s(Ls),onPlayPre:s(Is),onPlayNext:s(Os),onStop:s(Rs),onClear:s(Xl),onToggleMoreActions:ie[2]||(ie[2]=Ce=>y.value=!s(y)),onSelectWeekday:js,onOpenFileBrowserForPreFiles:s(ve),onTogglePreFilesDragMode:s(es),onTogglePreFilesBatchDeleteMode:s(Kl),onBatchDeletePreFiles:s(Hl),onClearPreFiles:s(Jl),onTogglePreFilesExpand:ie[3]||(ie[3]=Ce=>P.value=!s(P)),onTogglePreFileSelection:s(jl),onPreFileDragStart:s(ls),onPreFileDragEnd:s(ss),onPreFileDragOver:s(ns),onPreFileDrop:s(as),onOpenFileBrowser:s(X),onToggleFilesDragMode:s(ts),onToggleFilesBatchDeleteMode:s(Gl),onBatchDeleteFiles:s(Yl),onClearFiles:s(ql),onToggleFileSelection:s(Wl),onFileDragStart:s(os),onFileDragEnd:s(is),onFileDragOver:s(rs),onFileDrop:s(ds),onPlayFile:s(_),onSeekFile:s(H),onMovePreFileUp:s(Rl),onMovePreFileDown:s(zl),onReplacePreFile:s(Vl),onOpenPlaylistSelectorForPreFile:s(Ql),onDeletePreFile:s(Ul),onMoveFileUp:s(he),onMoveFileDown:s(Se),onReplaceFile:s(Il),onOpenPlaylistSelectorForFile:s(Zl),onDeleteFile:s(ot)},null,8,["playlist-status","active-playlist-id","editing-playlist-id","editing-playlist-name","selected-weekday-index","pre-files-drag-mode","pre-files-batch-delete-mode","selected-pre-file-indices","pre-files-expanded","files-drag-mode","files-batch-delete-mode","selected-file-indices","playlist-loading","playing","stopping","show-more-actions","audio-player","onStartEditName","onSaveName","onCancelEditName","onPlay","onPlayPre","onPlayNext","onStop","onClear","onOpenFileBrowserForPreFiles","onTogglePreFilesDragMode","onTogglePreFilesBatchDeleteMode","onBatchDeletePreFiles","onClearPreFiles","onTogglePreFileSelection","onPreFileDragStart","onPreFileDragEnd","onPreFileDragOver","onPreFileDrop","onOpenFileBrowser","onToggleFilesDragMode","onToggleFilesBatchDeleteMode","onBatchDeleteFiles","onClearFiles","onToggleFileSelection","onFileDragStart","onFileDragEnd","onFileDragOver","onFileDrop","onPlayFile","onSeekFile","onMovePreFileUp","onMovePreFileDown","onReplacePreFile","onOpenPlaylistSelectorForPreFile","onDeletePreFile","onMoveFileUp","onMoveFileDown","onReplaceFile","onOpenPlaylistSelectorForFile","onDeleteFile"]),n(hr,{"playlist-status":s(d),"connected-device-list":s(k),"dlna-device-list":s(p),"mi-device-list":s(N),loading:s(me),"dlna-scanning":s(L),"mi-scanning":s(J),"on-toggle-cron-enabled":s(ms),"on-update-cron":s(gs),"on-update-duration":s(ys),"on-update-trigger-button":s(hs),"on-open-cron-builder":s(cs),"on-preview-cron":s(bs),"on-update-device-type":s(Fs),"on-update-device-address":s(_s),"on-select-bluetooth-device":s(Ps),"on-select-agent-device":s(Ss),"on-select-mi-device":s(Ts),"on-scan-dlna-devices":s($s),"on-scan-mi-devices":s(Cs),"on-open-scan-dialog":s(Ds),"on-open-device-list":Gs},null,8,["playlist-status","connected-device-list","dlna-device-list","mi-device-list","loading","dlna-scanning","mi-scanning","on-toggle-cron-enabled","on-update-cron","on-update-duration","on-update-trigger-button","on-open-cron-builder","on-preview-cron","on-update-device-type","on-update-device-address","on-select-bluetooth-device","on-select-agent-device","on-select-mi-device","on-scan-dlna-devices","on-scan-mi-devices","on-open-scan-dialog"])]),n(Cl,{visible:s(B),"onUpdate:visible":ie[5]||(ie[5]=Ce=>B.value=Ce),title:"选择文件添加到播放列表","confirm-button-text":"添加","confirm-loading":s(b),onConfirm:s(Ge),onClose:s(at)},{"footer-prepend":c(()=>[n(pe,{modelValue:s(M),"onUpdate:modelValue":ie[4]||(ie[4]=Ce=>ft(M)?M.value=Ce:null),size:"small",class:"w-[150px]"},{default:c(()=>[n($e,{label:"添加到主列表",value:"files"}),n($e,{label:"添加到前置列表",value:"pre_files"})]),_:1},8,["modelValue"])]),_:1},8,["visible","confirm-loading","onConfirm","onClose"]),n(po,{visible:s(x),"initial-cron":s(O),"onUpdate:visible":ie[6]||(ie[6]=Ce=>x.value=Ce),onApply:s(ps),onPreview:s(vs),onClose:s(fs)},null,8,["visible","initial-cron","onApply","onPreview","onClose"]),n(yo,{visible:s(S),times:s(C),"onUpdate:visible":ie[7]||(ie[7]=Ce=>S.value=Ce),onClose:ie[8]||(ie[8]=Ce=>S.value=!1)},null,8,["visible","times"]),n($r,{visible:s(Y),"device-list":s(F),loading:s(me),"onUpdate:visible":ie[9]||(ie[9]=Ce=>Y.value=Ce),onRefresh:s(ks),onConnect:s(ws),onClose:s(xs)},null,8,["visible","device-list","loading","onRefresh","onConnect","onClose"]),n(od,{visible:s(h),"onUpdate:visible":ie[10]||(ie[10]=Ce=>h.value=Ce)},null,8,["visible"]),n(Md,{visible:s(ee),"playlist-collection":s(f),"selected-files":s(de),"onUpdate:visible":ie[11]||(ie[11]=Ce=>ee.value=Ce)},null,8,["visible","playlist-collection","selected-files"]),n(Tt,{modelValue:s(Ft),"onUpdate:modelValue":ie[13]||(ie[13]=Ce=>ft(Ft)?Ft.value=Ce:null),title:"编辑播放列表名称",width:"400",onClose:s(ct)},{footer:c(()=>[n(Me,{onClick:s(ct)},{default:c(()=>[...ie[15]||(ie[15]=[q("取消",-1)])]),_:1},8,["onClick"]),n(Me,{type:"primary",onClick:s(Pt)},{default:c(()=>[...ie[16]||(ie[16]=[q("确定",-1)])]),_:1},8,["onClick"])]),default:c(()=>[n(_e,{modelValue:s(_t),"onUpdate:modelValue":ie[12]||(ie[12]=Ce=>ft(_t)?_t.value=Ce:null),placeholder:"请输入播放列表名称",onKeyup:[It(s(Pt),["enter"]),It(s(ct),["esc"])],clearable:"",autofocus:""},null,8,["modelValue","onKeyup"])]),_:1},8,["modelValue","onClose"]),n(wu,{visible:s(R),"playlist-collection":s(f),"onUpdate:visible":ie[14]||(ie[14]=Ce=>R.value=Ce),onRefresh:s(D),"on-add-files":Vs,"on-remove-files":Ks},null,8,["visible","playlist-collection","onRefresh"])])}}});export{ju as default};
