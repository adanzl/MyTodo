import{s as L,a as A}from"./user.DHG8CoSH.js";import{d as D,u as N,c as _,r as I,o as P,a as f,w as T,b as t,e as $,f as o,g as c,E as M,h as W,i as j,j as m,k as w,l as z,t as b,m as p}from"./index.e2k-DlDj.js";import{v as F}from"./directive.BDGTbqBI.js";import{E as H,a as O}from"./index.g4PzMJCG.js";import{E as q}from"./index.DC5lNyCN.js";import{E as G}from"./index.B2dglSQX.js";import"./dayjs.min.DrTfEg_r.js";import"./date.g5OLmH5T.js";import"./forEach.ChlH2wlF.js";import"./omit.BvRqBRkQ.js";import"./_baseEach.Bbw20qpw.js";import"./_createBaseEach.qzTyINie.js";import"./_castFunction.CnYLP7GE.js";const J={class:""},K={key:0},Q={class:"flex mt-4"},ue=D({__name:"Home",setup(R){const n=N(),g=_(()=>n.userList),h=_(()=>n.loading),a=I({visible:!1,data:null,value:0}),i=async()=>{await n.refreshUserList()},V=async r=>{try{const e={id:r.id,score:r.score};await L(e.id,e.score),console.log("update user",e),await i()}catch(e){console.error("更新用户失败:",e),p.error("更新用户失败")}},y=r=>{a.value.visible=!0,a.value.data=r},E=async()=>{if(!a.value.data){p.warning("请选择用户");return}try{await A(a.value.data.id,"pcAdmin",a.value.value,"管理后台变更"),await i(),a.value.visible=!1,a.value.value=0}catch(r){console.error("添加积分失败:",r),p.error("添加积分失败")}},k=()=>{a.value.visible=!1,a.value.value=0};return P(async()=>{await i()}),(r,e)=>{const s=O,C=M,U=G,v=W,d=j,x=H,S=q,B=F;return c(),f("div",J,[T((c(),$(x,{data:g.value,stripe:"",class:"w-full"},{default:o(()=>[t(s,{prop:"id",label:"ID",width:"80"}),t(s,{label:"Icon",width:"100"},{default:o(l=>[t(C,{src:l.row.icon},null,8,["src"])]),_:1}),t(s,{prop:"name",label:"Name",width:"100"}),t(s,{prop:"admin",label:"Admin",width:"100",class:"items-center text-center"}),t(s,{label:"WProgress",width:"120",class:"items-center text-center"},{default:o(({row:l})=>[t(U,{"text-inside":!0,"stroke-width":26,percentage:l.wish_progress},null,8,["percentage"])]),_:1}),t(s,{prop:"wish_list",label:"WList",width:"100",class:"items-center text-center"}),t(s,{prop:"score",label:"Score",width:"100"},{default:o(({row:l})=>[t(v,{modelValue:l.score,"onUpdate:modelValue":u=>l.score=u,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(s,{label:"Operations"},{default:o(({row:l})=>[t(d,{class:"w-16",onClick:u=>V(l),type:"primary"},{default:o(()=>[...e[3]||(e[3]=[m(" Update ",-1)])]),_:1},8,["onClick"]),t(d,{class:"w-16",onClick:u=>y(l)},{default:o(()=>[...e[4]||(e[4]=[m(" Score ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[B,h.value]]),t(S,{modelValue:a.value.visible,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.visible=l),title:"Change Score",width:"600","before-close":k},{default:o(()=>[e[6]||(e[6]=w("span",null,"输入的积分会作用在当前积分上，输入负数则会减少积分",-1)),a.value.data?(c(),f("div",K,b(a.value.data.name)+" 当前积分: "+b(a.value.data.score),1)):z("",!0),w("div",Q,[t(v,{modelValue:a.value.value,"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.value=l),style:{width:"240px"},placeholder:"Please input"},null,8,["modelValue"]),t(d,{onClick:e[1]||(e[1]=l=>E()),class:"ml-2 w-16",type:"primary"},{default:o(()=>[...e[5]||(e[5]=[m(" Submit ",-1)])]),_:1})])]),_:1},8,["modelValue"])])}}});export{ue as default};
