import{Y as Ie,d as ue,v as wt,bN as Pe,o as Fe,K as kt,bO as Tt,bP as Ct,z as Ne,Q as je,A as Se,_ as lt,y as He,aM as qe,s as Re,r as F,c as B,ax as xe,Z as be,bQ as Ke,bd as nt,a as R,l as Z,g,O as Pt,I as $e,B as K,bR as de,ag as Me,bS as St,bT as $t,bU as Ge,ay as Mt,b as r,a3 as pe,a5 as Ft,a6 as Nt,ae as We,af as ie,bV as Rt,a4 as Et,as as Bt,P as Dt,J as Ye,aB as ot,aI as rt,b5 as it,L as Lt,H as zt,bL as Ot,bW as At,w as dt,aQ as Vt,M as Ut,N as It,aS as Y,k as p,i as ut,f as h,j as H,t as j,bX as jt,e as X,bB as ct,h as Kt,aP as Wt,bx as ft,m as _,bw as V,R as Yt,aV as Ht,an as oe,F as Qe,C as Xe,bY as qt,a2 as fe,bE as Gt,bC as Qt,bG as Xt}from"./index.Bk_h8V15.js";import{d as vt,a as we,u as Zt,e as Jt,M as Ze,_ as Je,g as et}from"./useInterval.DqfcxnPY.js";import{E as ea}from"./index.yZRgUnSA.js";import{v as ta}from"./directive.XQ77cII-.js";import{c as aa,r as pt,a as sa,E as la}from"./index.DkJRzER-.js";import{o as na}from"./omit.BYRWldEZ.js";import"./index.BFmhhbKo.js";import"./dayjs.min.CmIfYB6q.js";import"./index.CwcOvHZ1.js";import"./index.BSduyFTj.js";import"./_baseEach.D8pnrPCx.js";import"./_createBaseEach.BDK-o74b.js";const oa=(s,a,d)=>kt(s.subTree).filter(c=>{var b;return Tt(c)&&((b=c.type)==null?void 0:b.name)===a&&!!c.component}).map(c=>c.component.uid).map(c=>d[c]).filter(c=>!!c),ra=(s,a)=>{const d=Ie({}),e=Ie([]),u=new WeakMap,c=C=>{d.value[C.uid]=C,Pe(d),Fe(()=>{const T=C.getVnode().el,y=T.parentNode;if(!u.has(y)){u.set(y,[]);const n=y.insertBefore.bind(y);y.insertBefore=(i,o)=>(u.get(y).some(O=>i===O||o===O)&&Pe(d),n(i,o))}u.get(y).push(T)})},b=C=>{delete d.value[C.uid],Pe(d);const T=C.getVnode().el,y=T.parentNode,n=u.get(y),i=n.indexOf(T);n.splice(i,1)},P=()=>{e.value=oa(s,a,d.value)},v=C=>C.render(),S=ue({setup(C,{slots:T}){return()=>(P(),T.default?wt(v,{render:T.default}):null)}});return{children:e,addChild:c,removeChild:b,ChildrenSorter:S}},ia="horizontal",da="vertical",ua={[ia]:"deltaX",[da]:"deltaY"},ca=({atEndEdge:s,atStartEdge:a,layout:d},e)=>{let u,c=0;const b=v=>v<0&&a.value||v>0&&s.value;return{hasReachedEdge:b,onWheel:v=>{aa(u);const S=v[ua[d.value]];b(c)&&b(c+S)||(c+=S,Ct()||v.preventDefault(),u=pt(()=>{e(c),c=0}))}}},Ee=Symbol("tabsRootContextKey"),fa=Ne({tabs:{type:Se(Array),default:()=>je([])},tabRefs:{type:Se(Object),default:()=>je({})}}),tt="ElTabBar",va=ue({name:tt,__name:"tab-bar",props:fa,setup(s,{expose:a}){const d=s,e=He(Ee);e||qe(tt,"<el-tabs><el-tab-bar /></el-tabs>");const u=Re("tabs"),c=F(),b=F(),P=B(()=>{var n;return xe(e.props.defaultValue)||!!((n=b.value)!=null&&n.transform)}),v=()=>{let n=0,i=0;const o=["top","bottom"].includes(e.props.tabPosition)?"width":"height",D=o==="width"?"x":"y",O=D==="x"?"left":"top";return d.tabs.every($=>{if(xe($.paneName))return!1;const m=d.tabRefs[$.paneName];if(!m)return!1;if(!$.active)return!0;n=m[`offset${de(O)}`],i=m[`client${de(o)}`];const z=window.getComputedStyle(m);return o==="width"&&(i-=Number.parseFloat(z.paddingLeft)+Number.parseFloat(z.paddingRight),n+=Number.parseFloat(z.paddingLeft)),!1}),{[o]:`${i}px`,transform:`translate${de(D)}(${n}px)`}},S=()=>b.value=v(),C=[],T=()=>{C.forEach(n=>n.stop()),C.length=0,Object.values(d.tabRefs).forEach(n=>{C.push(Ke(n,S))})};be(()=>d.tabs,async()=>{await Me(),S(),T()},{immediate:!0});const y=Ke(c,()=>S());return nt(()=>{C.forEach(n=>n.stop()),C.length=0,y.stop()}),a({ref:c,update:S}),(n,i)=>P.value?(g(),R("div",{key:0,ref_key:"barRef",ref:c,class:$e([K(u).e("active-bar"),K(u).is(K(e).props.tabPosition)]),style:Pt(b.value)},null,6)):Z("v-if",!0)}});var pa=lt(va,[["__file","/home/runner/work/element-plus/element-plus/packages/components/tabs/src/tab-bar.vue"]]);const ba=Ne({panes:{type:Se(Array),default:()=>je([])},currentName:{type:[String,Number],default:""},editable:Boolean,type:{type:String,values:["card","border-card",""],default:""},stretch:Boolean,tabindex:{type:[String,Number],default:void 0}}),ma={tabClick:(s,a,d)=>d instanceof Event,tabRemove:(s,a)=>a instanceof Event},at="ElTabNav",_a=ue({name:at,props:ba,emits:ma,setup(s,{expose:a,emit:d}){const e=He(Ee);e||qe(at,"<el-tabs><tab-nav /></el-tabs>");const u=Re("tabs"),c=St(),b=$t(),P=F(),v=F(),S=F(),C=F({}),T=F(),y=F(!1),n=F(0),i=F(!1),o=F(!0),D=Ie(),O=B(()=>["top","bottom"].includes(e.props.tabPosition)),$=B(()=>O.value?"width":"height"),m=B(()=>({transform:`translate${$.value==="width"?"X":"Y"}(-${n.value}px)`})),{width:z,height:W}=Ge(P),{width:J,height:ee}=Ge(v,{width:0,height:0},{box:"border-box"}),x=B(()=>O.value?z.value:W.value),U=B(()=>O.value?J.value:ee.value),{onWheel:te}=ca({atStartEdge:B(()=>n.value<=0),atEndEdge:B(()=>U.value-n.value<=x.value),layout:B(()=>O.value?"horizontal":"vertical")},k=>{n.value=Rt(n.value+k,0,U.value-x.value)}),me=()=>{if(!P.value)return;const k=P.value[`offset${de($.value)}`],E=n.value;if(!E)return;const w=E>k?E-k:0;n.value=w},Be=()=>{if(!P.value||!v.value)return;const k=v.value[`offset${de($.value)}`],E=P.value[`offset${de($.value)}`],w=n.value;if(k-w<=E)return;const N=k-w>E*2?w+E:k-E;n.value=N},ae=async()=>{const k=v.value;if(!y.value||!S.value||!P.value||!k)return;await Me();const E=C.value[s.currentName];if(!E)return;const w=P.value,N=E.getBoundingClientRect(),A=w.getBoundingClientRect(),I=O.value?k.offsetWidth-A.width:k.offsetHeight-A.height,Q=n.value;let q=Q;O.value?(N.left<A.left&&(q=Q-(A.left-N.left)),N.right>A.right&&(q=Q+N.right-A.right)):(N.top<A.top&&(q=Q-(A.top-N.top)),N.bottom>A.bottom&&(q=Q+(N.bottom-A.bottom))),q=Math.max(q,0),n.value=Math.min(q,I)},_e=()=>{var k;if(!v.value||!P.value)return;s.stretch&&((k=T.value)==null||k.update());const E=v.value[`offset${de($.value)}`],w=P.value[`offset${de($.value)}`],N=n.value;w<E?(y.value=y.value||{},y.value.prev=N,y.value.next=N+w<E,E-N<w&&(n.value=E-w)):(y.value=!1,N>0&&(n.value=0))},De=k=>{const E=We(k);let w=0;switch(E){case ie.left:case ie.up:w=-1;break;case ie.right:case ie.down:w=1;break;default:return}const N=Array.from(k.currentTarget.querySelectorAll("[role=tab]:not(.is-disabled)"));let I=N.indexOf(k.target)+w;I<0?I=N.length-1:I>=N.length&&(I=0),N[I].focus({preventScroll:!0}),N[I].click(),ke()},ke=()=>{o.value&&(i.value=!0)},ce=()=>i.value=!1,Le=(k,E)=>{C.value[E]=k},ze=async()=>{await Me();const k=C.value[s.currentName];k?.focus({preventScroll:!0})};return be(c,k=>{k==="hidden"?o.value=!1:k==="visible"&&setTimeout(()=>o.value=!0,50)}),be(b,k=>{k?setTimeout(()=>o.value=!0,50):o.value=!1}),Ke(S,()=>{pt(_e)}),Fe(()=>setTimeout(()=>ae(),0)),Mt(()=>_e()),a({scrollToActiveTab:ae,removeFocus:ce,focusActiveTab:ze,tabListRef:v,tabBarRef:T,scheduleRender:()=>Pe(D)}),()=>{const k=y.value?[r("span",{class:[u.e("nav-prev"),u.is("disabled",!y.value.prev)],onClick:me},[r(pe,null,{default:()=>[r(Ft,null,null)]})]),r("span",{class:[u.e("nav-next"),u.is("disabled",!y.value.next)],onClick:Be},[r(pe,null,{default:()=>[r(Nt,null,null)]})])]:null,E=s.panes.map((w,N)=>{var A,I,Q,q,ve;const Te=w.uid,ge=w.props.disabled,re=(I=(A=w.props.name)!=null?A:w.index)!=null?I:`${N}`,he=!ge&&(w.isClosable||w.props.closable!==!1&&s.editable);w.index=`${N}`;const Oe=he?r(pe,{class:"is-icon-close",onClick:se=>d("tabRemove",w,se)},{default:()=>[r(Et,null,null)]}):null,Ae=((q=(Q=w.slots).label)==null?void 0:q.call(Q))||w.props.label,Ve=!ge&&w.active?(ve=s.tabindex)!=null?ve:e.props.tabindex:-1;return r("div",{ref:se=>Le(se,re),class:[u.e("item"),u.is(e.props.tabPosition),u.is("active",w.active),u.is("disabled",ge),u.is("closable",he),u.is("focus",i.value)],id:`tab-${re}`,key:`tab-${Te}`,"aria-controls":`pane-${re}`,role:"tab","aria-selected":w.active,tabindex:Ve,onFocus:()=>ke(),onBlur:()=>ce(),onClick:se=>{ce(),d("tabClick",w,re,se)},onKeydown:se=>{const Ce=We(se);he&&(Ce===ie.delete||Ce===ie.backspace)&&d("tabRemove",w,se)}},[Ae,Oe])});return D.value,r("div",{ref:S,class:[u.e("nav-wrap"),u.is("scrollable",!!y.value),u.is(e.props.tabPosition)]},[k,r("div",{class:u.e("nav-scroll"),ref:P},[s.panes.length>0?r("div",{class:[u.e("nav"),u.is(e.props.tabPosition),u.is("stretch",s.stretch&&["top","bottom"].includes(e.props.tabPosition))],ref:v,style:m.value,role:"tablist",onKeydown:De,onWheel:te},[s.type?null:r(pa,{ref:T,tabs:[...s.panes],tabRefs:C.value},null),E]):null])])}}}),ga=Ne({type:{type:String,values:["card","border-card",""],default:""},closable:Boolean,addable:Boolean,modelValue:{type:[String,Number]},defaultValue:{type:[String,Number]},editable:Boolean,tabPosition:{type:String,values:["top","right","bottom","left"],default:"top"},beforeLeave:{type:Se(Function),default:()=>!0},stretch:Boolean,tabindex:{type:[String,Number],default:0}}),Ue=s=>Bt(s)||Dt(s),ha={[rt]:s=>Ue(s),tabClick:(s,a)=>a instanceof Event,tabChange:s=>Ue(s),edit:(s,a)=>["remove","add"].includes(a),tabRemove:s=>Ue(s),tabAdd:()=>!0},ya=ue({name:"ElTabs",props:ga,emits:ha,setup(s,{emit:a,slots:d,expose:e}){var u;const c=Re("tabs"),b=B(()=>["left","right"].includes(s.tabPosition)),{children:P,addChild:v,removeChild:S,ChildrenSorter:C}=ra(it(),"ElTabPane"),T=F(),y=F((u=xe(s.modelValue)?s.defaultValue:s.modelValue)!=null?u:"0"),n=async(m,z=!1)=>{var W,J,ee,x;if(!(y.value===m||xe(m)))try{let U;if(s.beforeLeave){const te=s.beforeLeave(m,y.value);U=te instanceof Promise?await te:te}else U=!0;if(U!==!1){const te=(W=P.value.find(me=>me.paneName===y.value))==null?void 0:W.isFocusInsidePane();y.value=m,z&&(a(rt,m),a("tabChange",m)),(ee=(J=T.value)==null?void 0:J.removeFocus)==null||ee.call(J),te&&((x=T.value)==null||x.focusActiveTab())}}catch{}},i=(m,z,W)=>{m.props.disabled||(a("tabClick",m,W),n(z,!0))},o=(m,z)=>{m.props.disabled||xe(m.props.name)||(z.stopPropagation(),a("edit",m.props.name,"remove"),a("tabRemove",m.props.name))},D=()=>{a("edit",void 0,"add"),a("tabAdd")},O=m=>{const z=We(m);[ie.enter,ie.numpadEnter].includes(z)&&D()},$=m=>{const z=m.el.firstChild,W=["bottom","right"].includes(s.tabPosition)?m.children[0].el:m.children[1].el;z!==W&&z.before(W)};return be(()=>s.modelValue,m=>n(m)),be(y,async()=>{var m;await Me(),(m=T.value)==null||m.scrollToActiveTab()}),Lt(Ee,{props:s,currentName:y,registerPane:v,unregisterPane:S,nav$:T}),e({currentName:y,get tabNavRef(){return na(T.value,["scheduleRender"])}}),()=>{const m=d["add-icon"],z=s.editable||s.addable?r("div",{class:[c.e("new-tab"),b.value&&c.e("new-tab-vertical")],tabindex:s.tabindex,onClick:D,onKeydown:O},[m?Ye(d,"add-icon"):r(pe,{class:c.is("icon-plus")},{default:()=>[r(ot,null,null)]})]):null,W=()=>r(_a,{ref:T,currentName:y.value,editable:s.editable,type:s.type,panes:P.value,stretch:s.stretch,onTabClick:i,onTabRemove:o},null),J=r("div",{class:[c.e("header"),b.value&&c.e("header-vertical"),c.is(s.tabPosition)]},[r(C,null,{default:W,$stable:!0}),z]),ee=r("div",{class:c.e("content")},[Ye(d,"default")]);return r("div",{class:[c.b(),c.m(s.tabPosition),{[c.m("card")]:s.type==="card",[c.m("border-card")]:s.type==="border-card"}],onVnodeMounted:$,onVnodeUpdated:$},[ee,J])}}}),xa=Ne({label:{type:String,default:""},name:{type:[String,Number]},closable:{type:Boolean,default:void 0},disabled:Boolean,lazy:Boolean}),wa=["id","aria-hidden","aria-labelledby"],st="ElTabPane",ka=ue({name:st,__name:"tab-pane",props:xa,setup(s){const a=s,d=it(),e=zt(),u=He(Ee);u||qe(st,"usage: <el-tabs><el-tab-pane /></el-tabs/>");const c=Re("tab-pane"),b=F(),P=F(),v=B(()=>{var o;return(o=a.closable)!=null?o:u.props.closable}),S=B(()=>{var o;return u.currentName.value===((o=a.name)!=null?o:P.value)}),C=F(S.value),T=B(()=>{var o;return(o=a.name)!=null?o:P.value}),y=B(()=>!a.lazy||C.value||S.value),n=()=>{var o;return(o=b.value)==null?void 0:o.contains(document.activeElement)};be(S,o=>{o&&(C.value=!0)});const i=Ot({uid:d.uid,getVnode:()=>d.vnode,slots:e,props:a,paneName:T,active:S,index:P,isClosable:v,isFocusInsidePane:n});return u.registerPane(i),nt(()=>{u.unregisterPane(i)}),At(()=>{var o;e.label&&((o=u.nav$.value)==null||o.scheduleRender())}),(o,D)=>y.value?dt((g(),R("div",{key:0,id:`pane-${T.value}`,ref_key:"paneRef",ref:b,class:$e(K(c).b()),role:"tabpanel","aria-hidden":!S.value,"aria-labelledby":`tab-${T.value}`},[Ye(o.$slots,"default")],10,wa)),[[Vt,S.value]]):Z("v-if",!0)}});var bt=lt(ka,[["__file","/home/runner/work/element-plus/element-plus/packages/components/tabs/src/tab-pane.vue"]]);const Ta=Ut(ya,{TabPane:bt}),Ca=It(bt);async function Pa(){return(await Y.get("/pdf/list")).data}async function Sa(s){const a=new FormData;return a.append("file",s),(await Y.post("/pdf/upload",a,{headers:{"Content-Type":"multipart/form-data"}})).data}async function $a(s,a){const d={filename:s};return a!=null&&(d.password=a),(await Y.post("/pdf/decrypt",d)).data}function Ma(s,a){return`${Y.defaults.baseURL||""}/pdf/download/${encodeURIComponent(s)}?type=${a}`}async function Fa(s,a="both"){return(await Y.post("/pdf/delete",{filename:s,type:a})).data}const Na={class:"p-4 flex flex-col h-full"},Ra={class:"mb-4 flex-shrink-0 border rounded p-3 bg-gray-50"},Ea={class:"flex items-center gap-3"},Ba={key:0,class:"flex-1 min-w-0"},Da=["title"],La={class:"flex items-center justify-between"},za={class:"flex-1 overflow-auto"},Oa=["onClick"],Aa={key:1,class:"text-gray-400"},Va={key:0,class:"flex flex-col gap-1"},Ua={class:"text-sm"},Ia={class:"text-xs text-gray-500"},ja={key:1,class:"text-gray-400"},Ka={key:0,class:"flex flex-col gap-1"},Wa={class:"text-sm"},Ya={class:"text-xs text-gray-500"},Ha={key:1,class:"text-gray-400"},qa={class:"flex flex-col gap-1 items-center"},Ga=["onClick"],Qa={class:"flex items-center gap-2"},Xa=ue({__name:"PdfTool",setup(s){const a=F(!1),d=F([]),e=F(null),u=F(""),c=async()=>{try{a.value=!0;const n=await Pa();if(n.code===0){const i=n.data.files||[];d.value=i.map(o=>({...o,_decrypting:o._decrypting||!1,_password:o._password!==void 0?o._password:""}))}else _.error(n.msg||"获取文件列表失败")}catch(n){V(n,"获取文件列表失败")}finally{a.value=!1}},b=n=>{n.raw&&(e.value=n.raw,u.value=n.raw.name)},P=async()=>{if(!e.value){_.warning("请选择要上传的文件");return}const n=e.value;if(!n.name.toLowerCase().endsWith(".pdf")){_.error("只支持 PDF 文件");return}try{a.value=!0;const i=await Sa(n);i.code===0?(_.success("文件上传成功"),e.value=null,u.value="",await c()):_.error(i.msg||"文件上传失败")}catch(i){V(i,"文件上传失败")}finally{a.value=!1}},v=async n=>{if(!n.uploaded){_.warning("请先上传文件");return}if(!n._decrypting&&!(n.has_unlocked&&!await we.confirm("已解密的文件已存在，是否重新解密？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{n._decrypting=!0;const i={filename:n.uploaded.name};n._password!==void 0&&n._password!==null&&(i.password=n._password);const o=await $a(i.filename,i.password);o.code===0?(_.success("文件解密成功"),n._password="",await c()):o.msg&&o.msg.includes("密码")?_.error(o.msg||"密码错误，请重试"):_.error(o.msg||"文件解密失败")}catch(i){V(i,"文件解密失败")}finally{n._decrypting=!1}},S=async(n,i)=>{const o=n[i];if(!o){_.warning("文件不存在");return}try{const D=Ma(o.name,i);window.open(D,"_blank")}catch(D){V(D,"下载文件失败")}},C=async n=>{if(!n.uploaded){_.warning("请先上传文件");return}if(await we.confirm("确定要删除该文件吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{a.value=!0;const o=await Fa(n.uploaded.name,"both");o.code===0?(_.success("文件删除成功"),await c()):_.error(o.msg||"文件删除失败")}catch(o){V(o,"删除文件失败")}finally{a.value=!1}},T=vt,y=n=>n?new Date(n*1e3).toLocaleString():"-";return Fe(()=>{c()}),(n,i)=>{const o=ut,D=ea,O=pe,$=sa,m=ct,z=Kt,W=la,J=jt,ee=ta;return g(),R("div",Na,[i[9]||(i[9]=p("h2",{class:"text-xl font-semibold mb-4"},"PDF 解密工具",-1)),p("div",Ra,[p("div",Ea,[p("div",null,[r(o,{type:"success",size:"small",onClick:P,loading:a.value,disabled:!e.value},{default:h(()=>[...i[0]||(i[0]=[H(" 上传 ",-1)])]),_:1},8,["loading","disabled"])]),r(D,{"auto-upload":!1,"on-change":b,"show-file-list":!1,accept:".pdf"},{trigger:h(()=>[r(o,{type:"primary",size:"small",class:"!m-0"},{default:h(()=>[...i[1]||(i[1]=[H("选择文件",-1)])]),_:1})]),_:1}),e.value?(g(),R("div",Ba,[p("div",{class:"text-sm text-gray-600 truncate",title:u.value||e.value.name},j(u.value||e.value.name),9,Da)])):Z("",!0)])]),r(J,{class:"flex-1 flex flex-col overflow-hidden",shadow:"hover"},{header:h(()=>[p("div",La,[i[3]||(i[3]=p("span",null,"文件列表",-1)),r(o,{type:"info",size:"small",plain:"",onClick:c,loading:a.value},{default:h(()=>[a.value?Z("",!0):(g(),X(O,{key:0},{default:h(()=>[r(K(ft))]),_:1})),i[2]||(i[2]=H(" 刷新 ",-1))]),_:1},8,["loading"])])]),default:h(()=>[p("div",za,[dt((g(),X(W,{data:d.value,stripe:"",class:"w-full"},{empty:h(()=>[...i[8]||(i[8]=[p("div",{class:"text-center text-gray-400 py-8"},"暂无文件，请上传 PDF 文件",-1)])]),default:h(()=>[r($,{prop:"uploaded.name",label:"文件名","min-width":"200"},{default:h(({row:x})=>[x.uploaded?(g(),R("span",{key:0,class:"text-blue-600 cursor-pointer hover:underline",onClick:U=>S(x,"uploaded")},j(x.uploaded.name),9,Oa)):(g(),R("span",Aa,"-"))]),_:1}),r($,{label:"上传文件","min-width":"150"},{default:h(({row:x})=>[x.uploaded?(g(),R("div",Va,[p("span",Ua,j(K(T)(x.uploaded.size)),1),p("span",Ia,j(y(x.uploaded.modified)),1)])):(g(),R("span",ja,"-"))]),_:1}),r($,{label:"已解密文件","min-width":"150"},{default:h(({row:x})=>[x.unlocked?(g(),R("div",Ka,[p("span",Wa,j(K(T)(x.unlocked.size)),1),p("span",Ya,j(y(x.unlocked.modified)),1)])):(g(),R("span",Ha,"未解密"))]),_:1}),r($,{label:"状态",width:"120",align:"center"},{default:h(({row:x})=>[p("div",qa,[x.has_unlocked?(g(),X(m,{key:0,type:"success",size:"small"},{default:h(()=>[...i[4]||(i[4]=[H("已解密",-1)])]),_:1})):(g(),X(m,{key:1,type:"info",size:"small"},{default:h(()=>[...i[5]||(i[5]=[H("未解密",-1)])]),_:1})),x.unlocked?(g(),R("span",{key:2,class:"text-xs text-blue-600 cursor-pointer hover:underline",onClick:U=>S(x,"unlocked")}," 下载 ",8,Ga)):Z("",!0)])]),_:1}),r($,{label:"操作",width:"280",fixed:"right"},{default:h(({row:x})=>[p("div",Qa,[x.uploaded?(g(),X(z,{key:0,modelValue:x._password,"onUpdate:modelValue":U=>x._password=U,type:"password",size:"small",placeholder:"密码（可选）","show-password":"",clearable:"",class:"w-30",disabled:x._decrypting,onKeyup:Wt(U=>v(x),["enter"])},null,8,["modelValue","onUpdate:modelValue","disabled","onKeyup"])):Z("",!0),x.uploaded?(g(),X(o,{key:1,type:"primary",size:"small",onClick:U=>v(x),loading:x._decrypting,disabled:x._decrypting},{default:h(()=>[...i[6]||(i[6]=[H(" 解密 ",-1)])]),_:1},8,["onClick","loading","disabled"])):Z("",!0),x.uploaded?(g(),X(o,{key:2,type:"danger",size:"small",plain:"",onClick:U=>C(x)},{default:h(()=>[...i[7]||(i[7]=[H(" 删除 ",-1)])]),_:1},8,["onClick"])):Z("",!0)])]),_:1})]),_:1},8,["data"])),[[ee,a.value]])])]),_:1})])}}}),Za={viewBox:"0 0 512 512",width:"1.2em",height:"1.2em"};function Ja(s,a){return g(),R("svg",Za,[...a[0]||(a[0]=[p("path",{fill:"none",stroke:"currentColor","stroke-linecap":"square","stroke-width":"48",d:"m136 208l120-104l120 104m-240 96l120 104l120-104"},null,-1)])])}const es=Yt({name:"ion-chevron-expand-sharp",render:Ja}),ts=2e3;async function as(){return(await Y.get("/media/task/list")).data}async function ss(){return(await Y.post("/media/task/create",{})).data}async function ls(s){return(await Y.post("/media/task/get",{task_id:s})).data}async function ns(s){return(await Y.post("/media/task/delete",{task_id:s})).data}async function os(s,a){return(await Y.post("/media/task/addFileByPath",{task_id:s,file_path:a})).data}async function rs(s,a){return(await Y.post("/media/task/deleteFile",{task_id:s,file_index:a})).data}async function is(s){return(await Y.post("/media/task/start",{task_id:s})).data}async function ds(s,a){return(await Y.post("/media/task/reorderFiles",{task_id:s,file_indices:a})).data}function us(s){return`${Y.defaults.baseURL||""}/media/task/download?task_id=${s}`}async function cs(s,a){return(await Y.post("/media/task/save",{task_id:s,target_path:a})).data}const fs={class:"flex gap-4 h-full"},vs={class:"w-64 border rounded p-3 flex flex-col"},ps={class:"flex items-center justify-between mb-3"},bs={class:"flex items-center gap-1"},ms={key:0,class:"flex-1 overflow-y-auto space-y-2 pr-1 min-h-[400px]"},_s=["onClick"],gs={class:"flex items-center justify-between gap-2"},hs={class:"text-sm font-medium truncate flex-1 min-w-0"},ys={class:"text-xs text-gray-500 whitespace-nowrap flex items-center gap-1 flex-shrink-0"},xs={class:"whitespace-nowrap w-5 flex items-center justify-center"},ws={class:"flex items-center justify-between gap-2 min-h-[20px]"},ks={class:"flex items-center gap-1 flex-shrink-0"},Ts={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},Cs={key:0,class:"flex-1 border rounded p-3 flex flex-col max-w-2xl"},Ps={class:"flex items-center justify-between mb-3 flex-shrink-0"},Ss={class:"text-base font-semibold"},$s={class:"text-sm text-gray-500"},Ms={class:"flex-1 overflow-auto flex flex-col gap-3"},Fs={class:"flex items-center justify-between gap-4 flex-shrink-0"},Ns={class:"flex items-center gap-4"},Rs={key:1,class:"text-red-500 text-xs"},Es={class:"flex items-center gap-2"},Bs={class:"border rounded p-2 flex-1 flex flex-col overflow-hidden"},Ds={class:"flex items-center justify-between mb-2 flex-shrink-0"},Ls={class:"flex items-center gap-1 pr-1"},zs={class:"flex-1 overflow-auto"},Os={key:0},As=["draggable","onDragstart","onDrop"],Vs={class:"text-xs text-gray-500 w-8"},Us=["title"],Is={key:0,class:"text-xs text-gray-500 whitespace-nowrap w-20 text-right"},js={key:1,class:"w-20"},Ks={key:1,class:"text-sm text-gray-400 text-center py-1"},Ws={key:1,class:"flex-1 border rounded p-3 flex flex-col max-w-2xl"},Ys=ue({__name:"MediaTool",setup(s){const a=F(!1),d=F([]),e=F(null),u=F(!1),c=F(!1),b=F(!1),P=F(null),v=Zt({callbacks:{onPlay:()=>{_.success("开始播放")},onError:()=>{V(new Error("音频播放失败"),"播放失败"),ae()},onEnded:()=>{ae()}}}),S={size:"small",plain:!0,class:"!w-8 !h-6 !p-0"},C={size:"small",plain:!0,class:"!h-5 !text-xs !px-2"},T={size:"small",plain:!0,class:"!h-7 !text-xs"},y=["bg-gray-100","border-t-2","border-b-2","border-blue-500"],n=t=>{t&&t.classList.remove(...y)},i=t=>{if(!t)return;t.querySelectorAll('[draggable="true"]').forEach(f=>n(f))},o=async t=>{if(e.value&&t.length!==0)try{a.value=!0;for(const l of t){const f=await os(e.value.task_id,l);if(f.code!==0){_.error(`添加文件失败: ${f.msg||"未知错误"}`);break}}_.success(`成功添加 ${t.length} 个文件`),await $(e.value.task_id)}catch(l){V(l,"添加文件失败")}finally{a.value=!1}},D=async()=>{try{a.value=!0;const t=await as();t.code===0?(d.value=t.data.tasks||[],d.value.length>0&&!e.value&&await $(d.value[0].task_id)):_.error(t.msg||"获取任务列表失败")}catch(t){V(t,"获取任务列表失败")}finally{a.value=!1}},O=async()=>{try{a.value=!0;const t=await ss();t.code===0?(_.success("任务创建成功"),await D(),$(t.data.task_id)):_.error(t.msg||"创建任务失败")}catch(t){V(t,"创建任务失败")}finally{a.value=!1}},$=async t=>{e.value&&e.value.task_id!==t&&ce();try{a.value=!0;const l=await ls(t);l.code===0?e.value=l.data:_.error(l.msg||"获取任务信息失败")}catch(l){V(l,"获取任务信息失败")}finally{a.value=!1}},m=async t=>{if(await we.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{a.value=!0;const f=await ns(t);f.code===0?(_.success("任务删除成功"),await D(),e.value&&e.value.task_id===t&&(d.value&&d.value.length>0?await $(d.value[0].task_id):e.value=null)):_.error(f.msg||"删除任务失败")}catch(f){V(f,"删除任务失败")}finally{a.value=!1}},z=()=>{if(!e.value){_.warning("请先创建或选择任务");return}u.value=!0},W=async t=>{if(!(!e.value||!await we.confirm("确定要删除该文件吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{a.value=!0;const f=await rs(e.value.task_id,t);f.code===0?(v.playingFileIndex.value===t?ce():v.playingFileIndex.value!==null&&v.playingFileIndex.value>t&&(v.playingFileIndex.value=v.playingFileIndex.value-1),_.success("文件删除成功"),await $(e.value.task_id)):_.error(f.msg||"删除文件失败")}catch(f){V(f,"删除文件失败")}finally{a.value=!1}},J=async()=>{if(!(!e.value||!await we.confirm(`确定要开始合成吗？将合并 ${q.value} 个音频文件。`,"确认合成",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{a.value=!0;const l=await is(e.value.task_id);l.code===0?(_.success("合成任务已启动"),await D(),await $(e.value.task_id),U()):_.error(l.msg||"启动任务失败")}catch(l){V(l,"启动任务失败")}finally{a.value=!1}},{start:ee,stop:x}=Jt(async()=>{if(!e.value||e.value.status!=="processing"){x();return}await D(),await $(e.value.task_id)},ts,{immediate:!1}),U=()=>{ee()},te=t=>{if(!t)return;const l=us(t);window.open(l,"_blank")},me=()=>{e.value?.result_file&&te(e.value.task_id)},Be=t=>{t?.result_file&&te(t.task_id)},ae=()=>{v.clear()},_e=(t,l)=>{if(!t)return;const f=t?.path||t?.name||"";v.seekFile(f,l)},De=(t,l)=>{e.value?.result_file&&_e({path:e.value.result_file},l)},ke=t=>{if(!e.value||!e.value.files||t<0||t>=e.value.files.length)return;const l=e.value.files[t],f=l.path||l.name||"";if(!f){_.warning("文件路径不存在");return}if(v.playingFilePath.value===f&&v.audio&&!v.audio.paused){ae(),_.info("已停止播放");return}const L=et(f);if(!L){_.error("无法生成媒体文件URL");return}v.load(L,{playingFilePath:f,playingFileIndex:t}),v.play().catch(le=>{V(le,"播放失败"),ae()})},ce=()=>{ae()},Le=()=>{if(!e.value||!e.value.result_file){_.warning("结果文件不存在");return}const t=e.value.result_file;if(v.playingFilePath.value===t&&v.audio&&!v.audio.paused){ae(),_.info("已停止播放");return}const l=et(t);if(!l){_.error("无法生成媒体文件URL");return}v.load(l,{playingFilePath:t}),v.play().catch(f=>{V(f,"播放失败"),ae()})},ze=()=>{if(!e.value||!e.value.result_file){_.warning("结果文件不存在");return}c.value=!0},k=async t=>{if(!e.value||!e.value.result_file)return;if(t.length===0){_.warning("请选择转存目录");return}const l=t[0];try{a.value=!0;const f=await cs(e.value.task_id,l);f.code===0?(_.success("转存成功"),c.value=!1):_.error(f.msg||"转存失败")}catch(f){V(f,"转存失败")}finally{a.value=!1}},E=vt,w={pending:{tag:"info",text:"等待中"},processing:{tag:"warning",text:"处理中"},success:{tag:"success",text:"成功"},failed:{tag:"danger",text:"失败"}},N=t=>w[t]?.tag||"info",A=t=>w[t]?.text||"未知",I=B(()=>e.value?.status==="processing"),Q=B(()=>(e.value?.files||[]).length>0),q=B(()=>(e.value?.files||[]).length),ve=B(()=>e.value?.result_file),Te=B(()=>!ve.value||e.value?.status!=="success"||b.value),ge=B(()=>!Q.value||I.value||b.value),re=B(()=>I.value||b.value),he=B(()=>!e.value||!Q.value||I.value),Oe=B(()=>b.value?"点击退出拖拽排序模式":"点击进入拖拽排序模式"),Ae=B(()=>({path:ve.value||""})),Ve=(t,l)=>!t||!l||t.length!==l.length?!0:t.some((f,L)=>{const le=f?.path||f?.name,ye=l[L]?.path||l[L]?.name;return le!==ye}),se=async()=>{if(b.value){if(e.value&&e.value.files&&e.value.files.length>0){if(Ve(P.value||[],e.value.files))try{a.value=!0;const l=e.value.files.map((L,le)=>le),f=await ds(e.value.task_id,l);f.code===0?(_.success("排序已保存"),await $(e.value.task_id)):_.error(f.msg||"保存排序失败")}catch(l){V(l,"保存排序失败")}finally{a.value=!1}P.value=null}}else e.value&&e.value.files&&e.value.files.length>0&&(P.value=[...e.value.files||[]]);b.value=!b.value},Ce=(t,l)=>{if(!b.value)return t.preventDefault(),!1;try{t.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",l.toString()))}catch(f){console.error("拖拽开始失败:",f)}},mt=t=>{t.currentTarget&&n(t.currentTarget)},_t=t=>{t.currentTarget&&n(t.currentTarget)},gt=t=>{if(b.value&&(t.preventDefault(),t.dataTransfer&&(t.dataTransfer.dropEffect="move"),t.currentTarget)){const l=t.currentTarget.getBoundingClientRect(),f=t.clientY,L=l.top+l.height/2;n(t.currentTarget),f<L?t.currentTarget.classList.add("border-t-2","border-blue-500"):t.currentTarget.classList.add("border-b-2","border-blue-500")}},ht=(t,l)=>{if(!b.value||(t.preventDefault(),t.currentTarget&&(n(t.currentTarget),i(t.currentTarget.parentElement)),!t.dataTransfer))return;const f=parseInt(t.dataTransfer.getData("text/plain"),10);if(f===l||isNaN(f)||!e.value||!e.value.files||f<0||f>=e.value.files.length||l<0||l>=e.value.files.length)return;const L=t.currentTarget?.getBoundingClientRect(),le=t.clientY,ye=L?L.top+L.height/2:0,M=le<ye?l:l+1,G=[...e.value.files||[]],[ne]=G.splice(f,1),xt=f<M?M-1:M;G.splice(xt,0,ne),e.value={...e.value,files:G}},yt=()=>{u.value=!1};return Fe(()=>{D()}),Ht(()=>{ce(),x()}),(t,l)=>{const f=pe,L=ut,le=ct,ye=es;return g(),R("div",fs,[p("div",vs,[p("div",ps,[l[7]||(l[7]=p("h3",{class:"text-base font-semibold"},"任务列表",-1)),p("div",bs,[r(L,oe({type:"info"},S,{onClick:D,loading:a.value}),{default:h(()=>[a.value?Z("",!0):(g(),X(f,{key:0},{default:h(()=>[r(K(ft))]),_:1}))]),_:1},16,["loading"]),r(L,oe({type:"success"},S,{onClick:O,loading:a.value}),{default:h(()=>[r(f,null,{default:h(()=>[r(K(ot))]),_:1})]),_:1},16,["loading"])])]),d.value&&d.value.length>0?(g(),R("div",ms,[(g(!0),R(Qe,null,Xe(d.value,M=>(g(),R("div",{key:M.task_id,class:$e(["border rounded px-3 py-2 cursor-pointer hover:bg-gray-50 group min-h-[60px] flex flex-col justify-between",{"border-blue-500 bg-blue-50":e.value&&M.task_id===e.value.task_id}]),onClick:G=>$(M.task_id)},[p("div",gs,[p("div",hs,j(M.name),1),p("span",ys,[r(f,null,{default:h(()=>[r(K(qt),{class:"!w-3 !h-3"})]),_:1}),p("span",xs,j(M.files?M.files.length:0),1)])]),p("div",ws,[r(le,{type:N(M.status),size:"small",class:"!h-5 !text-xs w-16 text-center"},{default:h(()=>[H(j(A(M.status)),1)]),_:2},1032,["type"]),p("div",ks,[M.status==="success"&&M.result_file?(g(),X(L,oe({key:0,type:"primary"},{ref_for:!0},C,{onClick:fe(G=>Be(M),["stop"])}),{default:h(()=>[...l[8]||(l[8]=[H(" 下载 ",-1)])]),_:1},16,["onClick"])):Z("",!0),r(L,oe({type:"danger"},{ref_for:!0},C,{onClick:fe(G=>m(M.task_id),["stop"]),disabled:M.status==="processing"}),{default:h(()=>[r(f,null,{default:h(()=>[r(K(Gt))]),_:1})]),_:1},16,["onClick","disabled"])])])],10,_s))),128))])):(g(),R("div",Ts,' 暂无任务，请点击"新建"创建 '))]),e.value?(g(),R("div",Cs,[p("div",Ps,[p("h3",Ss,"任务详情: "+j(e.value.name),1),p("span",$s," 共 "+j(q.value)+" 个文件 ",1)]),p("div",Ms,[p("div",Fs,[p("div",Ns,[r(le,{type:N(e.value.status),size:"small",class:"w-16 text-center"},{default:h(()=>[H(j(A(e.value.status)),1)]),_:1},8,["type"]),ve.value?(g(),X(Ze,{key:0,file:Ae.value,player:K(v),disabled:b.value,onPlay:Le,onSeek:De},null,8,["file","player","disabled"])):Z("",!0),r(L,oe({type:"primary"},T,{onClick:me,disabled:Te.value}),{default:h(()=>[...l[9]||(l[9]=[H(" 下载 ",-1)])]),_:1},16,["disabled"]),r(L,oe({type:"success"},T,{onClick:ze,disabled:Te.value}),{default:h(()=>[...l[10]||(l[10]=[H(" 转存 ",-1)])]),_:1},16,["disabled"]),e.value.error_message?(g(),R("span",Rs," 错误: "+j(e.value.error_message),1)):Z("",!0)]),p("div",Es,[r(L,oe({type:"success"},T,{onClick:J,disabled:ge.value,loading:I.value}),{default:h(()=>[...l[11]||(l[11]=[H(" 开始合成 ",-1)])]),_:1},16,["disabled","loading"])])]),p("div",Bs,[p("div",Ds,[l[13]||(l[13]=p("h4",{class:"text-sm font-semibold"},"文件列表",-1)),p("div",Ls,[r(L,oe({type:"primary"},C,{disabled:re.value,onClick:z}),{default:h(()=>[...l[12]||(l[12]=[H(" + ",-1)])]),_:1},16,["disabled"]),r(L,oe({type:b.value?"success":"default"},S,{onClick:se,disabled:he.value,title:Oe.value}),{default:h(()=>[b.value?(g(),X(f,{key:0},{default:h(()=>[r(K(Qt))]),_:1})):(g(),X(ye,{key:1,class:"!w-3.5 !h-3.5"}))]),_:1},16,["type","disabled","title"])])]),p("div",zs,[Q.value?(g(),R("div",Os,[(g(!0),R(Qe,null,Xe(e.value.files,(M,G)=>(g(),R("div",{key:G,class:$e(["flex items-center gap-2 p-1 hover:bg-gray-100 rounded",{"cursor-move":b.value,"cursor-default":!b.value,"select-none":!0}]),draggable:b.value,onDragstart:ne=>Ce(ne,Number(G)),onDragend:l[2]||(l[2]=ne=>mt(ne)),onDragover:l[3]||(l[3]=fe(ne=>gt(ne),["prevent"])),onDragleave:_t,onDrop:fe(ne=>ht(ne,Number(G)),["prevent"])},[p("span",Vs,j(Number(G)+1),1),p("span",{class:"flex-1 text-sm truncate",title:M.path||M.name},j(M.name),9,Us),M.size?(g(),R("span",Is,j(K(E)(M.size)),1)):(g(),R("div",js)),p("div",{class:"flex items-center gap-1 flex-shrink-0",onMousedown:l[0]||(l[0]=fe(()=>{},["stop"])),onClick:l[1]||(l[1]=fe(()=>{},["stop"]))},[r(Ze,{file:M,player:K(v),disabled:re.value,onPlay:()=>ke(Number(G)),onSeek:_e},null,8,["file","player","disabled","onPlay"]),r(L,{type:"info",size:"small",plain:"",circle:"",onClick:fe(ne=>W(Number(G)),["stop"]),disabled:re.value,class:"!h-6 !text-xs"},{default:h(()=>[r(f,null,{default:h(()=>[r(K(Xt))]),_:1})]),_:1},8,["onClick","disabled"])],32)],42,As))),128))])):(g(),R("div",Ks,"文件列表为空"))])])])])):(g(),R("div",Ws,[...l[14]||(l[14]=[p("div",{class:"flex items-center justify-between mb-3 flex-shrink-0"},[p("h3",{class:"text-base font-semibold"},"任务详情")],-1),p("div",{class:"flex-1 flex items-center justify-center text-sm text-gray-400"}," 请从左侧选择一个任务查看详情 ",-1)])])),r(Je,{visible:u.value,"onUpdate:visible":l[4]||(l[4]=M=>u.value=M),title:"选择文件添加到任务","confirm-button-text":"添加","confirm-loading":a.value,onConfirm:o,onClose:yt},null,8,["visible","confirm-loading"]),r(Je,{visible:c.value,"onUpdate:visible":l[5]||(l[5]=M=>c.value=M),title:"选择转存目录","confirm-button-text":"转存",mode:"directory","confirm-loading":a.value,onConfirm:k,onClose:l[6]||(l[6]=M=>c.value=!1)},null,8,["visible","confirm-loading"])])}}}),Hs={class:"p-1"},ol=ue({__name:"index",setup(s){const a=F("pdf_tool"),d=e=>{console.log("切换到页签:",e)};return(e,u)=>{const c=Ca,b=Ta;return g(),R("div",Hs,[r(b,{modelValue:a.value,"onUpdate:modelValue":u[0]||(u[0]=P=>a.value=P),onTabChange:d,class:"flex-1 flex flex-col overflow-hidden h-[calc(100vh-150px)]"},{default:h(()=>[r(c,{label:"PDF 工具",name:"pdf_tool"},{default:h(()=>[r(Xa)]),_:1}),r(c,{label:"音频合成",name:"audio_merge"},{default:h(()=>[r(Ys)]),_:1})]),_:1},8,["modelValue"])])}}});export{ol as default};
