import{z as et,bc as Hs,c as le,X as Ys,r as K,Z as Ne,$ as gt,bd as rl,q as Rt,_ as Ue,d as ke,H as Js,b7 as qs,s as tt,U as dl,e as te,g as v,f as c,b as n,a0 as Xs,B as s,w as be,a1 as Qs,k as o,an as Le,a2 as ge,a as E,l as Q,I as oe,J as xe,t as G,a3 as Be,a4 as Zs,O as $t,aQ as Pe,ac as en,M as Ct,y as Ve,o as nt,L as Ze,A as Re,ae as kt,be as Ke,bf as rt,bg as tn,ag as zt,aW as Oe,ap as ln,aq as sn,aN as st,bh as it,bi as nn,bj as Bt,af as He,ao as an,bk as ul,bl as on,bm as rn,bn as dn,i as ze,G as cl,aJ as un,bo as fl,b5 as pl,a9 as Je,F as De,bp as Qt,N as Ut,aL as yt,as as Et,P as At,bq as Nt,aH as Lt,aI as Ot,br as cn,bs as fn,bt as pn,bu as vn,Y as mn,aP as It,bv as Qe,aK as Zt,aM as gn,b8 as yn,K as hn,v as bn,j as q,h as Vt,m as z,bw as re,C as Ae,bx as qe,aB as ht,by as wn,bz as $n,bA as vl,bB as Kt,bC as bt,bD as Gt,bE as je,bF as ml,bG as gl,aX as Cn,aA as yl,bH as kn,aC as hl,bI as Dn,aG as bl,aV as wl,aS as Te,ba as dt,bJ as ft}from"./index.KrHQqm_N.js";import{i as xn,f as jt,c as wt,M as $l,E as Fn,a as Ee,_ as Cl,n as pt,u as _n,g as Pn,b as Sn}from"./useInterval.CvkAg3BN.js";import"./dayjs.min.DtdNQf4h.js";import{d as Tn,a as Bn,b as En,c as An,e as kl,E as ut}from"./index.BtMcJ_qu.js";import{b as Mn,E as Nn}from"./index.qNAgsoTs.js";import{g as Xe,f as Ln,a as el}from"./date.DtpPgZUe.js";import{b as Dt,E as Dl,a as xl}from"./index.By6g3UeZ.js";import{E as On}from"./index.CPMGRacM.js";import{v as Wt}from"./directive.DwaZpBqp.js";import{g as In,s as Rn}from"./rds.DSmSYMnS.js";import"./omit.BzkMKP2q.js";import"./_baseEach.auwzeQJ9.js";import"./_createBaseEach.Dv_cNX5C.js";const zn=et({...Bn,direction:{type:String,default:"rtl",values:["ltr","rtl","ttb","btt"]},resizable:Boolean,size:{type:[String,Number],default:"30%"},withHeader:{type:Boolean,default:!0},modalFade:{type:Boolean,default:!0},headerAriaLevel:{type:String,default:"2"}}),Un={...Tn,"resize-start":(e,f)=>e instanceof MouseEvent&&typeof f=="number",resize:(e,f)=>e instanceof MouseEvent&&typeof f=="number","resize-end":(e,f)=>e instanceof MouseEvent&&typeof f=="number"};function Vn(e,f,r){const{width:d,height:h}=Hs(),i=le(()=>["ltr","rtl"].includes(e.direction)),l=le(()=>["ltr","ttb"].includes(e.direction)?1:-1),u=le(()=>i.value?d.value:h.value),g=le(()=>Ys(a.value+l.value*m.value,4,u.value)),a=K(0),m=K(0),A=K(!1),B=K(!1);let C=[],t=[];const N=()=>{var D;const T=(D=f.value)==null?void 0:D.closest('[aria-modal="true"]');return T?i.value?T.offsetWidth:T.offsetHeight:100};Ne(()=>[e.size,e.resizable],()=>{B.value=!1,a.value=0,m.value=0,M()});const b=D=>{e.resizable&&(B.value||(a.value=N(),B.value=!0),C=[D.pageX,D.pageY],A.value=!0,r("resize-start",D,a.value),t.push(gt(window,"mouseup",M),gt(window,"mousemove",U)))},U=D=>{const{pageX:T,pageY:ee}=D,de=T-C[0],R=ee-C[1];m.value=i.value?de:R,r("resize",D,g.value)},M=D=>{A.value&&(C=[],a.value=g.value,m.value=0,A.value=!1,t.forEach(T=>T?.()),t=[],D&&r("resize-end",D,a.value))},P=gt(f,"mousedown",b);return rl(()=>{P(),M()}),{size:le(()=>B.value?`${g.value}px`:Rt(e.size)),isResizing:A,isHorizontal:i}}const Kn=["aria-label","aria-labelledby","aria-describedby"],Gn=["id","aria-level"],jn=["aria-label"],Wn=["id"],Hn=ke({name:"ElDrawer",inheritAttrs:!1,__name:"drawer",props:zn,emits:Un,setup(e,{expose:f,emit:r}){const d=e,h=r,i=Js();qs({scope:"el-drawer",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/drawer.html#slots"},le(()=>!!i.title));const l=K(),u=K(),g=K(),a=tt("drawer"),{t:m}=dl(),{afterEnter:A,afterLeave:B,beforeLeave:C,visible:t,rendered:N,titleId:b,bodyId:U,zIndex:M,onModalClick:P,onOpenAutoFocus:D,onCloseAutoFocus:T,onFocusoutPrevented:ee,onCloseRequested:de,handleClose:R}=En(d,l),{isHorizontal:x,size:S,isResizing:w}=Vn(d,g,h),I=le(()=>d.modalPenetrable&&!d.modal);return f({handleClose:R,afterEnter:A,afterLeave:B}),(y,Y)=>(v(),te(s(en),{to:y.appendTo,disabled:y.appendTo!=="body"?!1:!y.appendToBody},{default:c(()=>[n(Xs,{name:s(a).b("fade"),onAfterEnter:s(A),onAfterLeave:s(B),onBeforeLeave:s(C),persisted:""},{default:c(()=>{var me;return[be(n(s(An),{mask:y.modal,"overlay-class":[s(a).is("drawer"),(me=y.modalClass)!=null?me:"",`${s(a).namespace.value}-modal-drawer`,s(a).is("penetrable",I.value)],"z-index":s(M),onClick:s(P)},{default:c(()=>[n(s(Qs),{loop:"",trapped:s(t),"focus-trap-el":l.value,"focus-start-el":u.value,onFocusAfterTrapped:s(D),onFocusAfterReleased:s(T),onFocusoutPrevented:s(ee),onReleaseRequested:s(de)},{default:c(()=>[o("div",Le({ref_key:"drawerRef",ref:l,"aria-modal":"true","aria-label":y.title||void 0,"aria-labelledby":y.title?void 0:s(b),"aria-describedby":s(U)},y.$attrs,{class:[s(a).b(),y.direction,s(t)&&"open",s(a).is("dragging",s(w))],style:{[s(x)?"width":"height"]:s(S)},role:"dialog",onClick:Y[1]||(Y[1]=ge(()=>{},["stop"]))}),[o("span",{ref_key:"focusStartRef",ref:u,class:oe(s(a).e("sr-focus")),tabindex:"-1"},null,2),y.withHeader?(v(),E("header",{key:0,class:oe([s(a).e("header"),y.headerClass])},[y.$slots.title?xe(y.$slots,"title",{key:1},()=>[Q(" DEPRECATED SLOT ")]):xe(y.$slots,"header",{key:0,close:s(R),titleId:s(b),titleClass:s(a).e("title")},()=>[o("span",{id:s(b),role:"heading","aria-level":y.headerAriaLevel,class:oe(s(a).e("title"))},G(y.title),11,Gn)]),y.showClose?(v(),E("button",{key:2,"aria-label":s(m)("el.drawer.close"),class:oe(s(a).e("close-btn")),type:"button",onClick:Y[0]||(Y[0]=(...F)=>s(R)&&s(R)(...F))},[n(s(Be),{class:oe(s(a).e("close"))},{default:c(()=>[n(s(Zs))]),_:1},8,["class"])],10,jn)):Q("v-if",!0)],2)):Q("v-if",!0),s(N)?(v(),E("div",{key:1,id:s(U),class:oe([s(a).e("body"),y.bodyClass])},[xe(y.$slots,"default")],10,Wn)):Q("v-if",!0),y.$slots.footer?(v(),E("div",{key:2,class:oe([s(a).e("footer"),y.footerClass])},[xe(y.$slots,"footer")],2)):Q("v-if",!0),y.resizable?(v(),E("div",{key:3,ref_key:"draggerRef",ref:g,style:$t({zIndex:s(M)}),class:oe(s(a).e("dragger"))},null,6)):Q("v-if",!0)],16,Kn)]),_:3},8,["trapped","focus-trap-el","focus-start-el","onFocusAfterTrapped","onFocusAfterReleased","onFocusoutPrevented","onReleaseRequested"])]),_:3},8,["mask","overlay-class","z-index","onClick"]),[[Pe,s(t)]])]}),_:3},8,["name","onAfterEnter","onAfterLeave","onBeforeLeave"])]),_:3},8,["to","disabled"]))}});var Yn=Ue(Hn,[["__file","/home/runner/work/element-plus/element-plus/packages/components/drawer/src/drawer.vue"]]);const Fl=Ct(Yn),Jn=ke({inheritAttrs:!1});function qn(e,f,r,d,h,i){return xe(e.$slots,"default")}var Xn=Ue(Jn,[["render",qn],["__file","/home/runner/work/element-plus/element-plus/packages/components/collection/src/collection.vue"]]);const Qn=ke({name:"ElCollectionItem",inheritAttrs:!1});function Zn(e,f,r,d,h,i){return xe(e.$slots,"default")}var ea=Ue(Qn,[["render",Zn],["__file","/home/runner/work/element-plus/element-plus/packages/components/collection/src/collection-item.vue"]]);const _l="data-el-collection-item",ta=e=>{const f=`El${e}Collection`,r=`${f}Item`,d=Symbol(f),h=Symbol(r),i=Object.assign({},Xn,{name:f,setup(){const u=K(),g=new Map;Ze(d,{itemMap:g,getItems:()=>{const m=s(u);if(!m)return[];const A=Array.from(m.querySelectorAll(`[${_l}]`));return[...g.values()].sort((C,t)=>A.indexOf(C.ref)-A.indexOf(t.ref))},collectionRef:u})}}),l=Object.assign({},ea,{name:r,setup(u,{attrs:g}){const a=K(),m=Ve(d,void 0);Ze(h,{collectionItemRef:a}),nt(()=>{const A=s(a);A&&m.itemMap.set(A,{ref:A,...g})}),rl(()=>{const A=s(a);m.itemMap.delete(A)})}});return{COLLECTION_INJECTION_KEY:d,COLLECTION_ITEM_INJECTION_KEY:h,ElCollection:i,ElCollectionItem:l}},la=et({style:{type:Re([String,Array,Object])},currentTabId:{type:Re(String)},defaultCurrentTabId:String,loop:Boolean,dir:{type:String,values:["ltr","rtl"],default:"ltr"},orientation:{type:Re(String)},onBlur:Function,onFocus:Function,onMousedown:Function}),{ElCollection:sa,ElCollectionItem:na,COLLECTION_INJECTION_KEY:Pl,COLLECTION_ITEM_INJECTION_KEY:aa}=ta("RovingFocusGroup"),Ht=Symbol("elRovingFocusGroup"),Sl=Symbol("elRovingFocusGroupItem"),oa={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"},ia=(e,f)=>e,ra=(e,f,r)=>{const d=kt(e),h=ia(d);return oa[h]},da=(e,f)=>e.map((r,d)=>e[(d+f)%e.length]),tl=e=>{const{activeElement:f}=document;for(const r of e)if(r===f||(r.focus(),f!==document.activeElement))return},ll="currentTabIdChange",sl="rovingFocusGroup.entryFocus",ua={bubbles:!1,cancelable:!0},ca=ke({name:"ElRovingFocusGroupImpl",inheritAttrs:!1,props:la,emits:[ll,"entryFocus"],setup(e,{emit:f}){var r;const d=K((r=e.currentTabId||e.defaultCurrentTabId)!=null?r:null),h=K(!1),i=K(!1),l=K(),{getItems:u}=Ve(Pl,void 0),g=le(()=>[{outline:"none"},e.style]),a=b=>{f(ll,b)},m=()=>{h.value=!0},A=Ke(b=>{var U;(U=e.onMousedown)==null||U.call(e,b)},()=>{i.value=!0}),B=Ke(b=>{var U;(U=e.onFocus)==null||U.call(e,b)},b=>{const U=!s(i),{target:M,currentTarget:P}=b;if(M===P&&U&&!s(h)){const D=new Event(sl,ua);if(P?.dispatchEvent(D),!D.defaultPrevented){const T=u().filter(S=>S.focusable),ee=T.find(S=>S.active),de=T.find(S=>S.id===s(d)),x=[ee,de,...T].filter(Boolean).map(S=>S.ref);tl(x)}}i.value=!1}),C=Ke(b=>{var U;(U=e.onBlur)==null||U.call(e,b)},()=>{h.value=!1}),t=(...b)=>{f("entryFocus",...b)},N=b=>{const U=ra(b);if(U){b.preventDefault();let P=u().filter(D=>D.focusable).map(D=>D.ref);switch(U){case"last":{P.reverse();break}case"prev":case"next":{U==="prev"&&P.reverse();const D=P.indexOf(b.currentTarget);P=e.loop?da(P,D+1):P.slice(D+1);break}}zt(()=>{tl(P)})}};Ze(Ht,{currentTabbedId:tn(d),loop:rt(e,"loop"),tabIndex:le(()=>s(h)?-1:0),rovingFocusGroupRef:l,rovingFocusGroupRootStyle:g,orientation:rt(e,"orientation"),dir:rt(e,"dir"),onItemFocus:a,onItemShiftTab:m,onBlur:C,onFocus:B,onMousedown:A,onKeydown:N}),Ne(()=>e.currentTabId,b=>{d.value=b??null}),gt(l,sl,t)}});function fa(e,f,r,d,h,i){return xe(e.$slots,"default")}var pa=Ue(ca,[["render",fa],["__file","/home/runner/work/element-plus/element-plus/packages/components/roving-focus-group/src/roving-focus-group-impl.vue"]]);const va=ke({name:"ElRovingFocusGroup",components:{ElFocusGroupCollection:sa,ElRovingFocusGroupImpl:pa}});function ma(e,f,r,d,h,i){const l=Oe("el-roving-focus-group-impl"),u=Oe("el-focus-group-collection");return v(),te(u,null,{default:c(()=>[n(l,ln(sn(e.$attrs)),{default:c(()=>[xe(e.$slots,"default")]),_:3},16)]),_:3})}var ga=Ue(va,[["render",ma],["__file","/home/runner/work/element-plus/element-plus/packages/components/roving-focus-group/src/roving-focus-group.vue"]]);const ya=et({trigger:{...Bt.trigger,type:Re([String,Array])},triggerKeys:{type:Re(Array),default:()=>[He.enter,He.numpadEnter,He.space,He.down]},virtualTriggering:Bt.virtualTriggering,virtualRef:Bt.virtualRef,effect:{...it.effect,default:"light"},type:{type:Re(String)},placement:{type:Re(String),default:"bottom"},popperOptions:{type:Re(Object),default:()=>({})},id:String,size:{type:String,default:""},splitButton:Boolean,hideOnClick:{type:Boolean,default:!0},loop:{type:Boolean,default:!0},showArrow:{type:Boolean,default:!0},showTimeout:{type:Number,default:150},hideTimeout:{type:Number,default:150},tabindex:{type:Re([Number,String]),default:0},maxHeight:{type:Re([Number,String]),default:""},popperClass:it.popperClass,popperStyle:it.popperStyle,disabled:Boolean,role:{type:String,values:nn,default:"menu"},buttonProps:{type:Re(Object)},teleported:it.teleported,appendTo:it.appendTo,persistent:{type:Boolean,default:!0}}),Tl=et({command:{type:[Object,String,Number],default:()=>({})},disabled:Boolean,divided:Boolean,textValue:String,icon:{type:st}}),ha=et({onKeydown:{type:Re(Function)}}),xt=Symbol("elDropdown"),Bl="elDropdown",{ButtonGroup:ba}=ze,wa=ke({name:"ElDropdown",components:{ElButton:ze,ElButtonGroup:ba,ElScrollbar:dn,ElTooltip:rn,ElRovingFocusGroup:ga,ElOnlyChild:on,ElIcon:Be,ArrowDown:ul},props:ya,emits:["visible-change","click","command"],setup(e,{emit:f}){const r=pl(),d=tt("dropdown"),{t:h}=dl(),i=K(),l=K(),u=K(),g=K(),a=K(null),m=K(null),A=K(!1),B=le(()=>({maxHeight:Rt(e.maxHeight)})),C=le(()=>[d.m(D.value)]),t=le(()=>un(e.trigger)),N=fl().value,b=le(()=>e.id||N);function U(){var y;(y=u.value)==null||y.onClose(void 0,0)}function M(){var y;(y=u.value)==null||y.onClose()}function P(){var y;(y=u.value)==null||y.onOpen()}const D=cl();function T(...y){f("command",...y)}function ee(){}function de(){const y=s(g);t.value.includes("hover")&&y?.focus({preventScroll:!0}),m.value=null}function R(y){m.value=y}function x(){f("visible-change",!0)}function S(y){var Y;A.value=y?.type==="keydown",(Y=g.value)==null||Y.focus()}function w(){f("visible-change",!1)}return Ze(xt,{contentRef:g,role:le(()=>e.role),triggerId:b,isUsingKeyboard:A,onItemEnter:ee,onItemLeave:de,handleClose:M}),Ze(Bl,{instance:r,dropdownSize:D,handleClick:U,commandHandler:T,trigger:rt(e,"trigger"),hideOnClick:rt(e,"hideOnClick")}),{t:h,ns:d,scrollbar:a,wrapStyle:B,dropdownTriggerKls:C,dropdownSize:D,triggerId:b,currentTabId:m,handleCurrentTabIdChange:R,handlerMainButtonClick:y=>{f("click",y)},handleClose:M,handleOpen:P,handleBeforeShowTooltip:x,handleShowTooltip:S,handleBeforeHideTooltip:w,popperRef:u,contentRef:g,triggeringElementRef:i,referenceElementRef:l}}});function $a(e,f,r,d,h,i){var l;const u=Oe("el-roving-focus-group"),g=Oe("el-scrollbar"),a=Oe("el-only-child"),m=Oe("el-tooltip"),A=Oe("el-button"),B=Oe("arrow-down"),C=Oe("el-icon"),t=Oe("el-button-group");return v(),E("div",{class:oe([e.ns.b(),e.ns.is("disabled",e.disabled)])},[n(m,{ref:"popperRef",role:e.role,effect:e.effect,"fallback-placements":["bottom","top"],"popper-options":e.popperOptions,"gpu-acceleration":!1,placement:e.placement,"popper-class":[e.ns.e("popper"),e.popperClass],"popper-style":e.popperStyle,trigger:e.trigger,"trigger-keys":e.triggerKeys,"trigger-target-el":e.contentRef,"show-arrow":e.showArrow,"show-after":e.trigger==="hover"?e.showTimeout:0,"hide-after":e.trigger==="hover"?e.hideTimeout:0,"virtual-ref":(l=e.virtualRef)!=null?l:e.triggeringElementRef,"virtual-triggering":e.virtualTriggering||e.splitButton,disabled:e.disabled,transition:`${e.ns.namespace.value}-zoom-in-top`,teleported:e.teleported,"append-to":e.appendTo,pure:"","focus-on-target":"",persistent:e.persistent,onBeforeShow:e.handleBeforeShowTooltip,onShow:e.handleShowTooltip,onBeforeHide:e.handleBeforeHideTooltip},an({content:c(()=>[n(g,{ref:"scrollbar","wrap-style":e.wrapStyle,tag:"div","view-class":e.ns.e("list")},{default:c(()=>[n(u,{loop:e.loop,"current-tab-id":e.currentTabId,orientation:"horizontal",onCurrentTabIdChange:e.handleCurrentTabIdChange},{default:c(()=>[xe(e.$slots,"dropdown")]),_:3},8,["loop","current-tab-id","onCurrentTabIdChange"])]),_:3},8,["wrap-style","view-class"])]),_:2},[e.splitButton?void 0:{name:"default",fn:c(()=>[n(a,{id:e.triggerId,ref:"triggeringElementRef",role:"button",tabindex:e.tabindex},{default:c(()=>[xe(e.$slots,"default")]),_:3},8,["id","tabindex"])]),key:"0"}]),1032,["role","effect","popper-options","placement","popper-class","popper-style","trigger","trigger-keys","trigger-target-el","show-arrow","show-after","hide-after","virtual-ref","virtual-triggering","disabled","transition","teleported","append-to","persistent","onBeforeShow","onShow","onBeforeHide"]),e.splitButton?(v(),te(t,{key:0},{default:c(()=>[n(A,Le({ref:"referenceElementRef"},e.buttonProps,{size:e.dropdownSize,type:e.type,disabled:e.disabled,tabindex:e.tabindex,onClick:e.handlerMainButtonClick}),{default:c(()=>[xe(e.$slots,"default")]),_:3},16,["size","type","disabled","tabindex","onClick"]),n(A,Le({id:e.triggerId,ref:"triggeringElementRef"},e.buttonProps,{role:"button",size:e.dropdownSize,type:e.type,class:e.ns.e("caret-button"),disabled:e.disabled,tabindex:e.tabindex,"aria-label":e.t("el.dropdown.toggleDropdown")}),{default:c(()=>[n(C,{class:oe(e.ns.e("icon"))},{default:c(()=>[n(B)]),_:1},8,["class"])]),_:1},16,["id","size","type","class","disabled","tabindex","aria-label"])]),_:3})):Q("v-if",!0)],2)}var Ca=Ue(wa,[["render",$a],["__file","/home/runner/work/element-plus/element-plus/packages/components/dropdown/src/dropdown.vue"]]);const ka=ke({components:{ElRovingFocusCollectionItem:na},props:{focusable:{type:Boolean,default:!0},active:Boolean},emits:["mousedown","focus","keydown"],setup(e,{emit:f}){const{currentTabbedId:r,onItemFocus:d,onItemShiftTab:h,onKeydown:i}=Ve(Ht,void 0),l=fl(),u=K(),g=Ke(B=>{f("mousedown",B)},B=>{e.focusable?d(s(l)):B.preventDefault()}),a=Ke(B=>{f("focus",B)},()=>{d(s(l))}),m=Ke(B=>{f("keydown",B)},B=>{const{shiftKey:C,target:t,currentTarget:N}=B;if(kt(B)===He.tab&&C){h();return}t===N&&i(B)}),A=le(()=>r.value===s(l));return Ze(Sl,{rovingFocusGroupItemRef:u,tabIndex:le(()=>s(A)?0:-1),handleMousedown:g,handleFocus:a,handleKeydown:m}),{id:l,handleKeydown:m,handleFocus:a,handleMousedown:g}}});function Da(e,f,r,d,h,i){const l=Oe("el-roving-focus-collection-item");return v(),te(l,{id:e.id,focusable:e.focusable,active:e.active},{default:c(()=>[xe(e.$slots,"default")]),_:3},8,["id","focusable","active"])}var xa=Ue(ka,[["render",Da],["__file","/home/runner/work/element-plus/element-plus/packages/components/roving-focus-group/src/roving-focus-item.vue"]]);const Fa=ke({name:"DropdownItemImpl",components:{ElIcon:Be},props:Tl,emits:["pointermove","pointerleave","click","clickimpl"],setup(e,{emit:f}){const r=tt("dropdown"),{role:d}=Ve(xt,void 0),{collectionItemRef:h}=Ve(aa,void 0),{rovingFocusGroupItemRef:i,tabIndex:l,handleFocus:u,handleKeydown:g,handleMousedown:a}=Ve(Sl,void 0),m=kl(h,i),A=le(()=>d.value==="menu"?"menuitem":d.value==="navigation"?"link":"button"),B=Ke(C=>{const t=kt(C);if([He.enter,He.numpadEnter,He.space].includes(t))return C.preventDefault(),C.stopImmediatePropagation(),f("clickimpl",C),!0},g);return{ns:r,itemRef:m,dataset:{[_l]:""},role:A,tabIndex:l,handleFocus:u,handleKeydown:B,handleMousedown:a}}}),_a=["aria-disabled","tabindex","role"];function Pa(e,f,r,d,h,i){const l=Oe("el-icon");return v(),E(De,null,[e.divided?(v(),E("li",{key:0,role:"separator",class:oe(e.ns.bem("menu","item","divided"))},null,2)):Q("v-if",!0),o("li",Le({ref:e.itemRef},{...e.dataset,...e.$attrs},{"aria-disabled":e.disabled,class:[e.ns.be("menu","item"),e.ns.is("disabled",e.disabled)],tabindex:e.tabIndex,role:e.role,onClick:f[0]||(f[0]=u=>e.$emit("clickimpl",u)),onFocus:f[1]||(f[1]=(...u)=>e.handleFocus&&e.handleFocus(...u)),onKeydown:f[2]||(f[2]=ge((...u)=>e.handleKeydown&&e.handleKeydown(...u),["self"])),onMousedown:f[3]||(f[3]=(...u)=>e.handleMousedown&&e.handleMousedown(...u)),onPointermove:f[4]||(f[4]=u=>e.$emit("pointermove",u)),onPointerleave:f[5]||(f[5]=u=>e.$emit("pointerleave",u))}),[e.icon?(v(),te(l,{key:0},{default:c(()=>[(v(),te(Je(e.icon)))]),_:1})):Q("v-if",!0),xe(e.$slots,"default")],16,_a)],64)}var Sa=Ue(Fa,[["render",Pa],["__file","/home/runner/work/element-plus/element-plus/packages/components/dropdown/src/dropdown-item-impl.vue"]]);const El=()=>{const e=Ve(Bl,{}),f=le(()=>e?.dropdownSize);return{elDropdown:e,_elDropdownSize:f}},Ta=ke({name:"ElDropdownItem",components:{ElRovingFocusItem:xa,ElDropdownItemImpl:Sa},inheritAttrs:!1,props:Tl,emits:["pointermove","pointerleave","click"],setup(e,{emit:f,attrs:r}){const{elDropdown:d}=El(),h=pl(),{onItemEnter:i,onItemLeave:l}=Ve(xt,void 0),u=Ke(A=>(f("pointermove",A),A.defaultPrevented),Qt(A=>{if(e.disabled){l(A);return}const B=A.currentTarget;B===document.activeElement||B.contains(document.activeElement)||(i(A),A.defaultPrevented||B?.focus({preventScroll:!0}))})),g=Ke(A=>(f("pointerleave",A),A.defaultPrevented),Qt(l)),a=Ke(A=>{if(!e.disabled)return f("click",A),A.type!=="keydown"&&A.defaultPrevented},A=>{var B,C,t;if(e.disabled){A.stopImmediatePropagation();return}(B=d?.hideOnClick)!=null&&B.value&&((C=d.handleClick)==null||C.call(d)),(t=d.commandHandler)==null||t.call(d,e.command,h,A)}),m=le(()=>({...e,...r}));return{handleClick:a,handlePointerMove:u,handlePointerLeave:g,propsAndAttrs:m}}});function Ba(e,f,r,d,h,i){const l=Oe("el-dropdown-item-impl"),u=Oe("el-roving-focus-item");return v(),te(u,{focusable:!e.disabled},{default:c(()=>[n(l,Le(e.propsAndAttrs,{onPointerleave:e.handlePointerLeave,onPointermove:e.handlePointerMove,onClickimpl:e.handleClick}),{default:c(()=>[xe(e.$slots,"default")]),_:3},16,["onPointerleave","onPointermove","onClickimpl"])]),_:3},8,["focusable"])}var Al=Ue(Ta,[["render",Ba],["__file","/home/runner/work/element-plus/element-plus/packages/components/dropdown/src/dropdown-item.vue"]]);const Ea=ke({name:"ElDropdownMenu",props:ha,setup(e){const f=tt("dropdown"),{_elDropdownSize:r}=El(),d=r.value,{contentRef:h,role:i,triggerId:l,isUsingKeyboard:u,handleClose:g}=Ve(xt,void 0),{rovingFocusGroupRef:a,rovingFocusGroupRootStyle:m,onBlur:A,onFocus:B,onKeydown:C,onMousedown:t}=Ve(Ht,void 0),{collectionRef:N}=Ve(Pl,void 0),b=le(()=>[f.b("menu"),f.bm("menu",d?.value)]),U=kl(h,a,N),M=Ke(D=>{var T;(T=e.onKeydown)==null||T.call(e,D)},D=>{const{currentTarget:T,target:ee}=D,de=kt(D);if(T.contains(ee),He.tab===de)return g();C(D)});function P(D){u.value&&B(D)}return{size:d,rovingFocusGroupRootStyle:m,dropdownKls:b,role:i,triggerId:l,dropdownListWrapperRef:U,handleKeydown:M,onBlur:A,handleFocus:P,onMousedown:t}}}),Aa=["role","aria-labelledby"];function Ma(e,f,r,d,h,i){return v(),E("ul",{ref:e.dropdownListWrapperRef,class:oe(e.dropdownKls),style:$t(e.rovingFocusGroupRootStyle),tabindex:-1,role:e.role,"aria-labelledby":e.triggerId,onFocusin:f[0]||(f[0]=(...l)=>e.handleFocus&&e.handleFocus(...l)),onFocusout:f[1]||(f[1]=(...l)=>e.onBlur&&e.onBlur(...l)),onKeydown:f[2]||(f[2]=ge((...l)=>e.handleKeydown&&e.handleKeydown(...l),["self"])),onMousedown:f[3]||(f[3]=ge((...l)=>e.onMousedown&&e.onMousedown(...l),["self"]))},[xe(e.$slots,"default")],46,Aa)}var Ml=Ue(Ea,[["render",Ma],["__file","/home/runner/work/element-plus/element-plus/packages/components/dropdown/src/dropdown-menu.vue"]]);const Na=Ct(Ca,{DropdownItem:Al,DropdownMenu:Ml}),La=Ut(Al),Oa=Ut(Ml),Ia=et({modelValue:{type:[Boolean,String,Number],default:!1},disabled:{type:Boolean,default:void 0},loading:Boolean,size:{type:String,validator:xn},width:{type:[String,Number],default:""},inlinePrompt:Boolean,inactiveActionIcon:{type:st},activeActionIcon:{type:st},activeIcon:{type:st},inactiveIcon:{type:st},activeText:{type:String,default:""},inactiveText:{type:String,default:""},activeValue:{type:[Boolean,String,Number],default:!0},inactiveValue:{type:[Boolean,String,Number],default:!1},name:{type:String,default:""},validateEvent:{type:Boolean,default:!0},beforeChange:{type:Re(Function)},id:String,tabindex:{type:[String,Number]},...cn(["ariaLabel"])}),Ra={[Ot]:e=>yt(e)||Et(e)||At(e),[Lt]:e=>yt(e)||Et(e)||At(e),[Nt]:e=>yt(e)||Et(e)||At(e)},za=["id","aria-checked","aria-disabled","aria-label","name","true-value","false-value","disabled","tabindex"],Ua=["aria-hidden"],Va={key:1},Ka={key:1},Ga=["aria-hidden"],nl="ElSwitch",ja=ke({name:nl,__name:"switch",props:Ia,emits:Ra,setup(e,{expose:f,emit:r}){const d=e,h=r,{formItem:i}=fn(),l=cl(),u=tt("switch"),{inputId:g}=pn(d,{formItemContext:i}),a=vn(le(()=>{if(d.loading)return!0})),m=K(d.modelValue!==!1),A=mn(),B=le(()=>[u.b(),u.m(l.value),u.is("disabled",a.value),u.is("checked",U.value)]),C=le(()=>[u.e("label"),u.em("label","left"),u.is("active",!U.value)]),t=le(()=>[u.e("label"),u.em("label","right"),u.is("active",U.value)]),N=le(()=>({width:Rt(d.width)}));Ne(()=>d.modelValue,()=>{m.value=!0});const b=le(()=>m.value?d.modelValue:!1),U=le(()=>b.value===d.activeValue);[d.activeValue,d.inactiveValue].includes(b.value)||(h(Ot,d.inactiveValue),h(Lt,d.inactiveValue),h(Nt,d.inactiveValue)),Ne(U,T=>{var ee;A.value.checked=T,d.validateEvent&&((ee=i?.validate)==null||ee.call(i,"change").catch(de=>yn()))});const M=()=>{const T=U.value?d.inactiveValue:d.activeValue;h(Ot,T),h(Lt,T),h(Nt,T),zt(()=>{A.value.checked=U.value})},P=()=>{if(a.value)return;const{beforeChange:T}=d;if(!T){M();return}const ee=T();[Zt(ee),yt(ee)].includes(!0)||gn(nl,"beforeChange must return type `Promise<boolean>` or `boolean`"),Zt(ee)?ee.then(R=>{R&&M()}).catch(R=>{}):ee&&M()},D=()=>{var T,ee;(ee=(T=A.value)==null?void 0:T.focus)==null||ee.call(T)};return nt(()=>{A.value.checked=U.value}),f({focus:D,checked:U}),(T,ee)=>(v(),E("div",{class:oe(B.value),onClick:ge(P,["prevent"])},[o("input",{id:s(g),ref_key:"input",ref:A,class:oe(s(u).e("input")),type:"checkbox",role:"switch","aria-checked":U.value,"aria-disabled":s(a),"aria-label":T.ariaLabel,name:T.name,"true-value":T.activeValue,"false-value":T.inactiveValue,disabled:s(a),tabindex:T.tabindex,onChange:M,onKeydown:It(P,["enter"])},null,42,za),!T.inlinePrompt&&(T.inactiveIcon||T.inactiveText||T.$slots.inactive)?(v(),E("span",{key:0,class:oe(C.value)},[xe(T.$slots,"inactive",{},()=>[T.inactiveIcon?(v(),te(s(Be),{key:0},{default:c(()=>[(v(),te(Je(T.inactiveIcon)))]),_:1})):Q("v-if",!0),!T.inactiveIcon&&T.inactiveText?(v(),E("span",{key:1,"aria-hidden":U.value},G(T.inactiveText),9,Ua)):Q("v-if",!0)])],2)):Q("v-if",!0),o("span",{class:oe(s(u).e("core")),style:$t(N.value)},[T.inlinePrompt?(v(),E("div",{key:0,class:oe(s(u).e("inner"))},[U.value?(v(),E("div",{key:1,class:oe(s(u).e("inner-wrapper"))},[xe(T.$slots,"active",{},()=>[T.activeIcon?(v(),te(s(Be),{key:0},{default:c(()=>[(v(),te(Je(T.activeIcon)))]),_:1})):Q("v-if",!0),!T.activeIcon&&T.activeText?(v(),E("span",Ka,G(T.activeText),1)):Q("v-if",!0)])],2)):(v(),E("div",{key:0,class:oe(s(u).e("inner-wrapper"))},[xe(T.$slots,"inactive",{},()=>[T.inactiveIcon?(v(),te(s(Be),{key:0},{default:c(()=>[(v(),te(Je(T.inactiveIcon)))]),_:1})):Q("v-if",!0),!T.inactiveIcon&&T.inactiveText?(v(),E("span",Va,G(T.inactiveText),1)):Q("v-if",!0)])],2))],2)):Q("v-if",!0),o("div",{class:oe(s(u).e("action"))},[T.loading?(v(),te(s(Be),{key:0,class:oe(s(u).is("loading"))},{default:c(()=>[n(s(Qe))]),_:1},8,["class"])):U.value?xe(T.$slots,"active-action",{key:1},()=>[T.activeActionIcon?(v(),te(s(Be),{key:0},{default:c(()=>[(v(),te(Je(T.activeActionIcon)))]),_:1})):Q("v-if",!0)]):U.value?Q("v-if",!0):xe(T.$slots,"inactive-action",{key:2},()=>[T.inactiveActionIcon?(v(),te(s(Be),{key:0},{default:c(()=>[(v(),te(Je(T.inactiveActionIcon)))]),_:1})):Q("v-if",!0)])],2)],6),!T.inlinePrompt&&(T.activeIcon||T.activeText||T.$slots.active)?(v(),E("span",{key:1,class:oe(t.value)},[xe(T.$slots,"active",{},()=>[T.activeIcon?(v(),te(s(Be),{key:0},{default:c(()=>[(v(),te(Je(T.activeIcon)))]),_:1})):Q("v-if",!0),!T.activeIcon&&T.activeText?(v(),E("span",{key:1,"aria-hidden":!U.value},G(T.activeText),9,Ga)):Q("v-if",!0)])],2)):Q("v-if",!0)],2))}});var Wa=Ue(ja,[["__file","/home/runner/work/element-plus/element-plus/packages/components/switch/src/switch.vue"]]);const Nl=Ct(Wa),Ha="timeline",Ya=ke({name:"ElTimeline",props:{reverse:Boolean},setup(e,{slots:f}){const r=tt("timeline");return Ze(Ha,f),()=>{var d,h;const i=hn((h=(d=f.default)==null?void 0:d.call(f))!=null?h:[]).filter(l=>{var u;return((u=l?.type)==null?void 0:u.name)==="ElTimelineItem"});return bn("ul",{class:[r.b()]},e.reverse?i.reverse():i)}}}),Ja=et({timestamp:{type:String,default:""},hideTimestamp:Boolean,center:Boolean,placement:{type:String,values:["top","bottom"],default:"bottom"},type:{type:String,values:["primary","success","warning","danger","info"],default:""},color:{type:String,default:""},size:{type:String,values:["normal","large"],default:"normal"},icon:{type:st},hollow:Boolean}),qa=ke({name:"ElTimelineItem",__name:"timeline-item",props:Ja,setup(e){const f=e,r=tt("timeline-item"),d=le(()=>[r.e("node"),r.em("node",f.size||""),r.em("node",f.type||""),r.is("hollow",f.hollow)]);return(h,i)=>(v(),E("li",{class:oe([s(r).b(),{[s(r).e("center")]:h.center}])},[o("div",{class:oe(s(r).e("tail"))},null,2),h.$slots.dot?Q("v-if",!0):(v(),E("div",{key:0,class:oe(d.value),style:$t({backgroundColor:h.color})},[h.icon?(v(),te(s(Be),{key:0,class:oe(s(r).e("icon"))},{default:c(()=>[(v(),te(Je(h.icon)))]),_:1},8,["class"])):Q("v-if",!0)],6)),h.$slots.dot?(v(),E("div",{key:1,class:oe(s(r).e("dot"))},[xe(h.$slots,"dot")],2)):Q("v-if",!0),o("div",{class:oe(s(r).e("wrapper"))},[!h.hideTimestamp&&h.placement==="top"?(v(),E("div",{key:0,class:oe([s(r).e("timestamp"),s(r).is("top")])},G(h.timestamp),3)):Q("v-if",!0),o("div",{class:oe(s(r).e("content"))},[xe(h.$slots,"default")],2),!h.hideTimestamp&&h.placement==="bottom"?(v(),E("div",{key:1,class:oe([s(r).e("timestamp"),s(r).is("bottom")])},G(h.timestamp),3)):Q("v-if",!0)],2)],2))}});var Ll=Ue(qa,[["__file","/home/runner/work/element-plus/element-plus/packages/components/timeline/src/timeline-item.vue"]]);const Xa=Ct(Ya,{TimelineItem:Ll}),Qa=Ut(Ll);function lt(e,f,r){if(e==="*"||!e||typeof e!="string")return null;const d=new Set,h=String(e).split(",");for(const i of h){const l=i.trim();if(l.includes("/")){const[u,g]=l.split("/"),a=parseInt(g,10);if(u==="*")for(let m=f;m<=r;m+=a)d.add(m);else if(u.includes("-")){const[m,A]=u.split("-").map(B=>parseInt(B,10));for(let B=m;B<=A;B+=a)d.add(B)}}else if(l.includes("-")){const[u,g]=l.split("-").map(a=>parseInt(a,10));for(let a=u;a<=g;a++)d.add(a)}else{const u=parseInt(l,10);!isNaN(u)&&u>=f&&u<=r&&d.add(u)}}return d.size>0?Array.from(d).sort((i,l)=>i-l):null}function Yt(e,f=3){try{if(!e||typeof e!="string")throw new Error("Cron 表达式必须是字符串类型");const r=String(e).trim().split(/\s+/);if(r.length!==6)throw new Error("Cron 表达式必须包含6个字段：秒 分 时 日 月 周");const[d,h,i,l,u,g]=r,a=lt(d,0,59),m=lt(h,0,59),A=lt(i,0,23),B=lt(l,1,31),C=lt(u,1,12);let t=lt(g,0,7);t&&t.includes(7)&&(t=t.filter(P=>P!==7),t.includes(0)||t.push(0),t.sort((P,D)=>P-D));const N=[],b=new Date;b.setMilliseconds(0),a&&!a.includes(b.getSeconds())&&(b.setSeconds(0),b.setMinutes(b.getMinutes()+1));let U=0;const M=1e4;for(;N.length<f&&U<M;){U++;const P=b.getMonth()+1;if(C&&!C.includes(P)){let S=null;for(const w of C)if(w>P){S=w;break}S===null?(S=C[0],b.setFullYear(b.getFullYear()+1,S-1,1),b.setHours(0,0,a?a[0]:0)):(b.setMonth(S-1,1),b.setHours(0,0,a?a[0]:0));continue}const D=b.getDate(),T=b.getDay();let ee=!0;if(l!=="*"&&g!=="*"?ee=!!(B&&B.includes(D))||!!(t&&t.includes(T)):l!=="*"?ee=B?B.includes(D):!1:g!=="*"&&(ee=t?t.includes(T):!1),!ee){b.setDate(b.getDate()+1),b.setHours(0,0,a?a[0]:0);continue}const de=b.getHours();if(A&&!A.includes(de)){let S=null;for(const w of A)if(w>de){S=w;break}S===null?(b.setDate(b.getDate()+1),b.setHours(A[0],0,a?a[0]:0)):b.setHours(S,0,a?a[0]:0);continue}const R=b.getMinutes();if(m&&!m.includes(R)){let S=null;for(const w of m)if(w>R){S=w;break}if(S===null){let w=null;for(const I of A||[de])if(I>de){w=I;break}w===null?(b.setDate(b.getDate()+1),b.setHours(A?A[0]:0,m[0],a?a[0]:0)):b.setHours(w,m[0],a?a[0]:0)}else b.setMinutes(S,a?a[0]:0);continue}const x=b.getSeconds();if(a&&!a.includes(x)){let S=null;for(const w of a)if(w>x){S=w;break}S===null?(b.setMinutes(b.getMinutes()+1),b.setSeconds(a[0])):b.setSeconds(S);continue}if(b>new Date){const S=b.getFullYear()+"-"+String(b.getMonth()+1).padStart(2,"0")+"-"+String(b.getDate()).padStart(2,"0")+" "+String(b.getHours()).padStart(2,"0")+":"+String(b.getMinutes()).padStart(2,"0")+":"+String(b.getSeconds()).padStart(2,"0");N.push(S)}a&&a.length>0&&b.setSeconds(a[0]),b.setMinutes(b.getMinutes()+1)}return N.slice(0,f)}catch(r){throw console.error("计算 Cron 执行时间失败:",r),r}}function Za(e){const f=e.second==="custom"?e.secondCustom||"*":e.second||"*",r=e.minute==="custom"?e.minuteCustom||"*":e.minute||"*",d=e.hour==="custom"?e.hourCustom||"*":e.hour||"*",h=e.day==="custom"?e.dayCustom||"*":e.day||"*",i=e.month==="custom"?e.monthCustom||"*":e.month||"*",l=e.weekday==="custom"?e.weekdayCustom||"*":e.weekday||"*";return`${f} ${r} ${d} ${h} ${i} ${l}`}function eo(){return`pl_${Date.now()}_${Math.random().toString(36).slice(2,7)}`}const to={class:"space-y-4 m-4"},lo={class:"flex items-center gap-2"},so={class:"flex items-center gap-2"},no={class:"flex items-center gap-2"},ao={class:"flex items-center gap-2"},oo={class:"flex items-center gap-2"},io={class:"flex items-center gap-2"},ro={class:"border-t pt-4"},uo={class:"flex gap-2"},co={class:"border-t pt-4"},fo={class:"space-y-2"},po={class:"flex items-center gap-2 flex-wrap"},vo=ke({__name:"CronDialog",props:{visible:{type:Boolean,default:!1},initialCron:{default:""}},emits:["update:visible","apply","preview","close"],setup(e,{emit:f}){const r=e,d=f,h=K(r.visible),i=K({second:"*",secondCustom:"",minute:"*",minuteCustom:"",hour:"*",hourCustom:"",day:"*",dayCustom:"",month:"*",monthCustom:"",weekday:"*",weekdayCustom:"",generated:""}),l=C=>{C.second="*",C.secondCustom="",C.minute="*",C.minuteCustom="",C.hour="*",C.hourCustom="",C.day="*",C.dayCustom="",C.month="*",C.monthCustom="",C.weekday="*",C.weekdayCustom="",C.generated=""},u=(C,t)=>{try{if(!C||typeof C!="string"){l(t);return}const N=String(C).trim().split(/\s+/);let b,U,M,P,D,T;if(N.length===5){const[ee,de,R,x,S]=N;ee==="0"&&de&&de.startsWith("*/")?(b="0",U=de,M=R||"*",P=x||"*",D=S||"*",T="*"):(U=ee,M=de,P=R,D=x,T=S,b="0")}else if(N.length===6)[b,U,M,P,D,T]=N;else{console.warn("Cron 表达式格式错误，部分数量:",N.length),l(t);return}N.length===5||N.length===6?(b==="*"?(t.second="*",t.secondCustom=""):b==="0"?(t.second="0",t.secondCustom=""):(t.second="custom",t.secondCustom=b),U==="*"?(t.minute="*",t.minuteCustom=""):U==="0"?(t.minute="0",t.minuteCustom=""):(U.startsWith("*/"),t.minute="custom",t.minuteCustom=U),M==="*"?(t.hour="*",t.hourCustom=""):M==="0"?(t.hour="0",t.hourCustom=""):(t.hour="custom",t.hourCustom=M),P==="*"?(t.day="*",t.dayCustom=""):(t.day="custom",t.dayCustom=P),D==="*"?(t.month="*",t.monthCustom=""):(t.month="custom",t.monthCustom=D),T==="*"?(t.weekday="*",t.weekdayCustom=""):T==="1-5"?(t.weekday="1-5",t.weekdayCustom=""):T==="0,6"||T==="6,0"?(t.weekday="0,6",t.weekdayCustom=""):(t.weekday="custom",t.weekdayCustom=T)):(console.warn("Cron 表达式格式错误，部分数量:",N.length),l(t))}catch(N){console.error("解析 Cron 表达式失败:",N),l(t)}},g=()=>{i.value.generated=Za(i.value)},a=()=>{h.value=!1,d("close")},m=()=>{if(!i.value.generated){z.warning("请先生成 Cron 表达式");return}d("apply",i.value.generated),a()},A=()=>{const C=i.value.generated;if(!C){z.warning("请先生成 Cron 表达式");return}try{const t=Yt(C,5);d("preview",t)}catch(t){re(t,"预览失败")}},B=C=>{try{u(C,i.value),g(),zt(()=>{i.value.generated&&(d("apply",i.value.generated),z.success("示例已应用"))})}catch(t){re(t,"应用示例失败")}};return Ne(()=>r.visible,C=>{h.value=C,C&&(r.initialCron?u(r.initialCron,i.value):l(i.value),g())},{immediate:!0}),Ne(()=>r.initialCron,C=>{r.visible&&C&&(u(C,i.value),g())}),Ne(h,C=>{C!==r.visible&&d("update:visible",C)}),(C,t)=>{const N=Mn,b=Nn,U=Vt,M=ze,P=ut;return v(),te(P,{modelValue:h.value,"onUpdate:modelValue":t[17]||(t[17]=D=>h.value=D),title:"Cron 表达式生成器",width:"700","before-close":a},{default:c(()=>[o("div",to,[o("div",null,[t[22]||(t[22]=o("div",{class:"text-sm font-medium mb-2"},"秒 (0-59)",-1)),o("div",lo,[n(b,{modelValue:i.value.second,"onUpdate:modelValue":t[0]||(t[0]=D=>i.value.second=D),onChange:g,class:"flex items-center"},{default:c(()=>[n(N,{label:"*",class:"!w-[80px]"},{default:c(()=>[...t[18]||(t[18]=[q("每秒钟",-1)])]),_:1}),n(N,{label:"0",class:"!w-[80px]"},{default:c(()=>[...t[19]||(t[19]=[q("第0秒",-1)])]),_:1}),n(N,{label:"30",class:"!w-[80px]"},{default:c(()=>[...t[20]||(t[20]=[q("第30秒",-1)])]),_:1}),n(N,{label:"custom",class:"!w-[80px]"},{default:c(()=>[...t[21]||(t[21]=[q("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),n(U,{modelValue:i.value.secondCustom,"onUpdate:modelValue":t[1]||(t[1]=D=>i.value.secondCustom=D),placeholder:"例如: 0,30 或 */10",disabled:i.value.second!=="custom",class:"!w-[200px]",onInput:g},null,8,["modelValue","disabled"])])]),o("div",null,[t[27]||(t[27]=o("div",{class:"text-sm font-medium mb-2"},"分 (0-59)",-1)),o("div",so,[n(b,{modelValue:i.value.minute,"onUpdate:modelValue":t[2]||(t[2]=D=>i.value.minute=D),onChange:g,class:"flex items-center"},{default:c(()=>[n(N,{label:"*",class:"!w-[80px]"},{default:c(()=>[...t[23]||(t[23]=[q("每分钟",-1)])]),_:1}),n(N,{label:"0",class:"!w-[80px]"},{default:c(()=>[...t[24]||(t[24]=[q("第0分",-1)])]),_:1}),n(N,{label:"30",class:"!w-[80px]"},{default:c(()=>[...t[25]||(t[25]=[q("第30分",-1)])]),_:1}),n(N,{label:"custom",class:"!w-[80px]"},{default:c(()=>[...t[26]||(t[26]=[q("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),n(U,{modelValue:i.value.minuteCustom,"onUpdate:modelValue":t[3]||(t[3]=D=>i.value.minuteCustom=D),placeholder:"例如: 0,30 或 */15",disabled:i.value.minute!=="custom",class:"!w-[200px]",onInput:g},null,8,["modelValue","disabled"])])]),o("div",null,[t[32]||(t[32]=o("div",{class:"text-sm font-medium mb-2"},"时 (0-23)",-1)),o("div",no,[n(b,{modelValue:i.value.hour,"onUpdate:modelValue":t[4]||(t[4]=D=>i.value.hour=D),onChange:g,class:"flex items-center"},{default:c(()=>[n(N,{label:"*",class:"!w-[80px]"},{default:c(()=>[...t[28]||(t[28]=[q("每小时",-1)])]),_:1}),n(N,{label:"0",class:"!w-[80px]"},{default:c(()=>[...t[29]||(t[29]=[q("0点",-1)])]),_:1}),n(N,{label:"9",class:"!w-[80px]"},{default:c(()=>[...t[30]||(t[30]=[q("9点",-1)])]),_:1}),n(N,{label:"custom",class:"!w-[80px]"},{default:c(()=>[...t[31]||(t[31]=[q("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),n(U,{modelValue:i.value.hourCustom,"onUpdate:modelValue":t[5]||(t[5]=D=>i.value.hourCustom=D),placeholder:"例如: 9,12,18 或 */2",disabled:i.value.hour!=="custom",class:"!w-[200px]",onInput:g},null,8,["modelValue","disabled"])])]),o("div",null,[t[37]||(t[37]=o("div",{class:"text-sm font-medium mb-2"},"日 (1-31)",-1)),o("div",ao,[n(b,{modelValue:i.value.day,"onUpdate:modelValue":t[6]||(t[6]=D=>i.value.day=D),onChange:g,class:"flex items-center"},{default:c(()=>[n(N,{label:"*",class:"!w-[80px]"},{default:c(()=>[...t[33]||(t[33]=[q("每天",-1)])]),_:1}),n(N,{label:"1",class:"!w-[80px]"},{default:c(()=>[...t[34]||(t[34]=[q("每月1号",-1)])]),_:1}),n(N,{label:"15",class:"!w-[80px]"},{default:c(()=>[...t[35]||(t[35]=[q("每月15号",-1)])]),_:1}),n(N,{label:"custom",class:"!w-[80px]"},{default:c(()=>[...t[36]||(t[36]=[q("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),n(U,{modelValue:i.value.dayCustom,"onUpdate:modelValue":t[7]||(t[7]=D=>i.value.dayCustom=D),placeholder:"例如: 1,15 或 */5",disabled:i.value.day!=="custom",class:"!w-[200px]",onInput:g},null,8,["modelValue","disabled"])])]),o("div",null,[t[42]||(t[42]=o("div",{class:"text-sm font-medium mb-2"},"月 (1-12)",-1)),o("div",oo,[n(b,{modelValue:i.value.month,"onUpdate:modelValue":t[8]||(t[8]=D=>i.value.month=D),onChange:g,class:"flex items-center"},{default:c(()=>[n(N,{label:"*",class:"!w-[80px]"},{default:c(()=>[...t[38]||(t[38]=[q("每月",-1)])]),_:1}),n(N,{label:"1",class:"!w-[80px]"},{default:c(()=>[...t[39]||(t[39]=[q("1月",-1)])]),_:1}),n(N,{label:"6",class:"!w-[80px]"},{default:c(()=>[...t[40]||(t[40]=[q("6月",-1)])]),_:1}),n(N,{label:"custom",class:"!w-[80px]"},{default:c(()=>[...t[41]||(t[41]=[q("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),n(U,{modelValue:i.value.monthCustom,"onUpdate:modelValue":t[9]||(t[9]=D=>i.value.monthCustom=D),placeholder:"例如: 1,6,12 或 */3",disabled:i.value.month!=="custom",class:"!w-[200px]",onInput:g},null,8,["modelValue","disabled"])])]),o("div",null,[t[47]||(t[47]=o("div",{class:"text-sm font-medium mb-2"},"周 (0-7, 0和7表示周日)",-1)),o("div",io,[n(b,{modelValue:i.value.weekday,"onUpdate:modelValue":t[10]||(t[10]=D=>i.value.weekday=D),onChange:g,class:"flex items-center"},{default:c(()=>[n(N,{label:"*",class:"!w-[80px]"},{default:c(()=>[...t[43]||(t[43]=[q("每天",-1)])]),_:1}),n(N,{label:"1-5",class:"!w-[80px]"},{default:c(()=>[...t[44]||(t[44]=[q("工作日",-1)])]),_:1}),n(N,{label:"0,6",class:"!w-[80px]"},{default:c(()=>[...t[45]||(t[45]=[q("周末",-1)])]),_:1}),n(N,{label:"custom",class:"!w-[80px]"},{default:c(()=>[...t[46]||(t[46]=[q("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),n(U,{modelValue:i.value.weekdayCustom,"onUpdate:modelValue":t[11]||(t[11]=D=>i.value.weekdayCustom=D),placeholder:"例如: 1,3,5 或 1-5",disabled:i.value.weekday!=="custom",class:"!w-[200px]",onInput:g},null,8,["modelValue","disabled"])])]),o("div",ro,[t[50]||(t[50]=o("div",{class:"text-sm font-medium mb-2"},"生成的 Cron 表达式：",-1)),n(U,{modelValue:i.value.generated,"onUpdate:modelValue":t[12]||(t[12]=D=>i.value.generated=D),readonly:"",class:"mb-2"},null,8,["modelValue"]),o("div",uo,[n(M,{type:"primary",size:"small",onClick:m},{default:c(()=>[...t[48]||(t[48]=[q(" 应用 ",-1)])]),_:1}),n(M,{type:"info",size:"small",onClick:A},{default:c(()=>[...t[49]||(t[49]=[q(" 预览执行时间 ",-1)])]),_:1})])]),o("div",co,[t[55]||(t[55]=o("div",{class:"text-sm font-medium mb-2"},"常用示例：",-1)),o("div",fo,[o("div",po,[n(M,{size:"small",onClick:t[13]||(t[13]=D=>B("0 0 * * *"))},{default:c(()=>[...t[51]||(t[51]=[q(" 每天0点 ",-1)])]),_:1}),n(M,{size:"small",onClick:t[14]||(t[14]=D=>B("0 */30 * * *"))},{default:c(()=>[...t[52]||(t[52]=[q(" 每30分钟 ",-1)])]),_:1}),n(M,{size:"small",onClick:t[15]||(t[15]=D=>B("0 0 9 * * 1-5"))},{default:c(()=>[...t[53]||(t[53]=[q(" 工作日9点 ",-1)])]),_:1}),n(M,{size:"small",onClick:t[16]||(t[16]=D=>B("0 0 0 1 * *"))},{default:c(()=>[...t[54]||(t[54]=[q(" 每月1号0点 ",-1)])]),_:1})])])])])]),_:1},8,["modelValue"])}}}),mo={key:0},go={class:"font-medium"},yo={key:1,class:"text-center text-gray-400 py-4"},ho=ke({__name:"CronPreviewDialog",props:{visible:{type:Boolean,default:!1},times:{default:()=>[]}},emits:["update:visible","close"],setup(e,{emit:f}){const r=f,d=()=>{r("update:visible",!1),r("close")};return(h,i)=>{const l=Qa,u=Xa,g=ut;return v(),te(g,{"model-value":e.visible,title:"Cron 执行时间预览",width:"500","onUpdate:modelValue":i[0]||(i[0]=a=>h.$emit("update:visible",a)),"before-close":d},{default:c(()=>[e.times&&e.times.length>0?(v(),E("div",mo,[i[1]||(i[1]=o("div",{class:"text-sm text-gray-600 mb-3"},"下5次执行时间：",-1)),n(u,null,{default:c(()=>[(v(!0),E(De,null,Ae(e.times,(a,m)=>(v(),te(l,{key:m,timestamp:a,placement:"top"},{default:c(()=>[o("div",go,"第 "+G(m+1)+" 次执行",1)]),_:2},1032,["timestamp"]))),128))]),_:1})])):(v(),E("div",yo," 无法解析 Cron 表达式，请检查格式是否正确 "))]),_:1},8,["model-value"])}}}),bo={class:"w-64 border rounded p-3 flex flex-col"},wo={class:"flex items-center justify-between mb-3"},$o={class:"flex items-center gap-1"},Co={key:0,class:"flex-1 overflow-y-auto space-y-2 pr-1"},ko=["onClick"],Do={class:"flex items-center justify-between gap-2"},xo={class:"text-sm font-medium truncate flex-1 min-w-0"},Fo={class:"flex items-center gap-2 flex-shrink-0"},_o={class:"text-xs text-gray-500 whitespace-nowrap flex items-center gap-1"},Po={class:"whitespace-nowrap w-5 flex items-center justify-center"},So={class:"flex items-center justify-center"},To={class:"text-[10px] text-blue-600 min-h-[14px] flex items-center justify-between"},Bo={key:0,class:"flex items-center gap-1"},Eo={key:1,class:"invisible"},Ao={key:2,class:"text-gray-500 flex items-center gap-1"},Mo={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},No=ke({__name:"PlaylistList",props:{playlistCollection:{},activePlaylistId:{},refreshing:{type:Boolean},autoRefreshEnabled:{type:Boolean}},emits:["select","create","refresh","toggle-auto-refresh","menu-command"],setup(e){const f=r=>{if(!r||!r.schedule||r.schedule.enabled!==1||!r.schedule.cron||typeof r.schedule.cron!="string")return null;try{const d=String(r.schedule.cron).trim();if(!d)return null;const h=Yt(d,1);return h&&h.length>0?Ln(h[0]):null}catch{return null}};return(r,d)=>{const h=Nl,i=Be,l=ze,u=La,g=Oa,a=Na;return v(),E("div",bo,[o("div",wo,[d[4]||(d[4]=o("h3",{class:"text-base font-semibold"},"播放列表",-1)),o("div",$o,[n(h,{"model-value":e.autoRefreshEnabled,"onUpdate:modelValue":d[0]||(d[0]=m=>r.$emit("toggle-auto-refresh",m)),"active-text":"","inactive-text":"","active-color":"#409eff",size:"small",title:"自动刷新",class:"mr-1"},null,8,["model-value"]),n(l,{type:"primary",size:"small",plain:"",onClick:d[1]||(d[1]=m=>r.$emit("refresh")),loading:e.refreshing,title:"刷新播放列表",class:"!w-8 !h-6 !p-0"},{default:c(()=>[e.refreshing?Q("",!0):(v(),te(i,{key:0},{default:c(()=>[n(s(qe))]),_:1}))]),_:1},8,["loading"]),n(l,{type:"success",size:"small",onClick:d[2]||(d[2]=m=>r.$emit("create")),title:"新建播放列表",class:"!w-8 !h-6 !p-0"},{default:c(()=>[n(i,null,{default:c(()=>[n(s(ht))]),_:1})]),_:1})])]),e.playlistCollection&&e.playlistCollection.length>0?(v(),E("div",Co,[(v(!0),E(De,null,Ae(e.playlistCollection,m=>(v(),E("div",{key:m.id,class:oe(["border rounded px-3 py-2 cursor-pointer hover:bg-gray-50 group min-h-[60px] flex flex-col justify-between",{"border-blue-500 bg-blue-50":m.id===e.activePlaylistId}]),onClick:A=>r.$emit("select",m.id)},[o("div",Do,[o("div",xo,G(m.name),1),o("div",Fo,[o("span",_o,[n(i,null,{default:c(()=>[n(s(wn),{class:"!w-3 !h-3"})]),_:1}),o("span",Po,G((m.pre_lists&&m.pre_lists[s(Xe)()]&&m.pre_lists[s(Xe)()].length||0)+(m.playlist&&m.playlist.length||0)),1)]),o("div",So,[n(a,{trigger:"click",onCommand:A=>r.$emit("menu-command",A,m.id),onClick:d[3]||(d[3]=ge(()=>{},["stop"]))},{dropdown:c(()=>[n(g,null,{default:c(()=>[n(u,{command:"copy"},{default:c(()=>[...d[6]||(d[6]=[o("span",null,"复制",-1)])]),_:1}),e.playlistCollection.length>1?(v(),te(u,{key:0,command:"delete",divided:""},{default:c(()=>[...d[7]||(d[7]=[o("span",{class:"text-[#f56c6c]"},"删除",-1)])]),_:1})):Q("",!0)]),_:1})]),default:c(()=>[n(l,{type:"default",size:"small",plain:"",circle:"",class:"!w-5 !h-5 !min-w-5 !p-0 text-xs",title:"更多"},{default:c(()=>[...d[5]||(d[5]=[o("span",{class:"text-base leading-none mb-1"},"»",-1)])]),_:1})]),_:1},8,["onCommand"])])])]),o("div",To,[f(m)?(v(),E("span",Bo,[n(i,{class:"!w-3 !h-4"},{default:c(()=>[n(s($n))]),_:1}),q(" "+G(f(m)),1)])):(v(),E("span",Eo,"占位")),m.trigger_button?(v(),E("span",Ao,[n(i,{class:"!w-3 !h-4"},{default:c(()=>[n(s(vl))]),_:1}),q(" "+G(m.trigger_button),1)])):Q("",!0)])],10,ko))),128))])):(v(),E("div",Mo,' 暂无播放列表，请点击"新建"创建 '))])}}}),Lo={class:"border rounded p-2 mb-2"},Oo={class:"flex items-center justify-between mb-2"},Io={class:"flex items-center gap-1"},Ro={class:"flex items-center gap-1"},zo={class:"text-[10px]"},Uo={class:"flex items-center justify-between text-xs text-gray-500 mb-2 pr-2.5"},Vo={class:"flex items-center"},Ko={key:0},Go={class:"flex items-center gap-1"},jo=["draggable","onClick","onDragstart","onDrop"],Wo={class:"text-xs text-gray-500 w-8"},Ho=["title"],Yo={key:1,class:"w-full border-t border-gray-200"},Jo={key:2,class:"text-sm text-gray-400 text-center py-1"},qo=ke({__name:"PreFilesList",props:{playlistStatus:{},selectedWeekdayIndex:{},preFilesDragMode:{type:Boolean},preFilesBatchDeleteMode:{type:Boolean},selectedPreFileIndices:{},preFilesExpanded:{type:Boolean},playlistLoading:{type:Boolean},showMoreActions:{type:Boolean},audioPlayer:{}},emits:["select-weekday","open-file-browser","toggle-drag-mode","toggle-batch-delete-mode","batch-delete","clear","toggle-expand","toggle-selection","drag-start","drag-end","drag-over","drop","play-file","seek-file","move-up","move-down","replace","open-playlist-selector","delete"],setup(e){const f=e,r=()=>f.selectedWeekdayIndex!==null?f.selectedWeekdayIndex:Xe(),d=()=>{const l=f.playlistStatus;if(!l||!l.pre_lists)return[];const u=r();return!Array.isArray(l.pre_lists)||l.pre_lists.length!==7?[]:l.pre_lists[u]||[]},h=l=>{const u=f.playlistStatus;if(!u||!u.pre_lists||!Array.isArray(u.pre_lists)||u.pre_lists.length!==7)return 0;const g=u.pre_lists[l];return Array.isArray(g)?g.length:0},i=()=>{const l=d();return wt(l)};return(l,u)=>{const g=ze,a=Kt,m=Be,A=Dt;return v(),E("div",Lo,[o("div",Oo,[u[12]||(u[12]=o("div",{class:"text-xs font-semibold text-gray-600 w-39"},"前置文件（播放时优先播放）",-1)),o("div",Io,[o("div",Ro,[(v(),E(De,null,Ae(["周一","周二","周三","周四","周五","周六","周日"],(B,C)=>n(g,{key:C,type:e.selectedWeekdayIndex===C||e.selectedWeekdayIndex===null&&s(Xe)()===C?"primary":"default",size:"small",plain:"",onClick:t=>l.$emit("select-weekday",C),title:B,class:"!w-16 !h-6 !p-0 text-xs"},{default:c(()=>[q(G(B),1),o("span",zo,"["+G(h(C))+"]",1)]),_:2},1032,["type","onClick","title"])),64))])])]),o("div",Uo,[o("div",Vo,[i()>0?(v(),E("span",Ko," 总时长："+G(s(jt)(i())),1)):Q("",!0),d()&&d().length>0?(v(),E("span",{key:1,class:oe(i()>0?"ml-2":"")}," 共 "+G(d().length)+" 首， 当前: "+G(e.playlistStatus?.pre_index!==void 0&&e.playlistStatus.pre_index!==null&&e.playlistStatus.pre_index>=0?e.playlistStatus.pre_index+1:"-")+" / "+G(d().length),3)):Q("",!0),e.playlistStatus?.isPlaying&&e.playlistStatus.in_pre_files===!0?(v(),te(a,{key:2,type:"success",size:"small",class:"ml-2"},{default:c(()=>[...u[13]||(u[13]=[q(" 播放中 ",-1)])]),_:1})):Q("",!0)]),o("div",Go,[n(g,{type:"primary",size:"small",plain:"",onClick:u[0]||(u[0]=B=>l.$emit("open-file-browser")),disabled:!e.playlistStatus||e.preFilesDragMode||e.preFilesBatchDeleteMode},{default:c(()=>[...u[14]||(u[14]=[q(" + ",-1)])]),_:1},8,["disabled"]),n(g,{type:e.preFilesDragMode?"success":"default",size:"small",plain:"",class:"!w-8 !h-6",onClick:u[1]||(u[1]=B=>l.$emit("toggle-drag-mode")),disabled:!e.playlistStatus||!d()||d().length===0||e.preFilesBatchDeleteMode,title:e.preFilesDragMode?"点击退出拖拽排序模式":"点击进入拖拽排序模式"},{default:c(()=>[e.preFilesDragMode?(v(),te(m,{key:0},{default:c(()=>[n(s(bt))]),_:1})):(v(),te(m,{key:1},{default:c(()=>[n(s(Gt))]),_:1}))]),_:1},8,["type","disabled","title"]),n(g,{type:e.preFilesBatchDeleteMode?"success":"default",size:"small",plain:"",class:"!w-8 !h-6",onClick:u[2]||(u[2]=B=>l.$emit("toggle-batch-delete-mode")),disabled:!e.playlistStatus||!d()||d().length===0||e.preFilesDragMode,title:e.preFilesBatchDeleteMode?"点击退出批量删除模式":"点击进入批量删除模式"},{default:c(()=>[e.preFilesBatchDeleteMode?(v(),te(m,{key:0},{default:c(()=>[n(s(bt))]),_:1})):(v(),te(m,{key:1},{default:c(()=>[n(s(je))]),_:1}))]),_:1},8,["type","disabled","title"]),be(n(g,{type:"danger",size:"small",plain:"",class:"!w-8 !h-6",onClick:u[3]||(u[3]=B=>l.$emit("batch-delete")),disabled:e.playlistLoading||e.selectedPreFileIndices.length===0,title:`删除选中的 ${e.selectedPreFileIndices.length} 项`},{default:c(()=>[n(m,null,{default:c(()=>[n(s(je))]),_:1})]),_:1},8,["disabled","title"]),[[Pe,e.preFilesBatchDeleteMode]]),be(n(g,{type:"default",size:"small",plain:"",class:"!w-8 !h-6",onClick:u[4]||(u[4]=B=>l.$emit("clear")),disabled:!e.playlistStatus||!d()||d().length===0||e.playlistLoading||e.preFilesDragMode,title:"清空列表"},{default:c(()=>[n(m,null,{default:c(()=>[n(s(je))]),_:1})]),_:1},8,["disabled"]),[[Pe,e.showMoreActions&&!e.preFilesBatchDeleteMode]])])]),d()&&d().length>0?(v(),E("div",{key:0,class:oe(["overflow-y-scroll scrollbar-overlay",{"max-h-[192px]":!e.preFilesExpanded}])},[(v(!0),E(De,null,Ae(d(),(B,C)=>(v(),E("div",{key:"pre-"+C,class:oe(["flex items-center gap-2 p-1 hover:bg-gray-100 rounded",{"bg-blue-50":Number(e.playlistStatus?.pre_index)===C,"bg-blue-100":e.preFilesBatchDeleteMode&&e.selectedPreFileIndices.includes(Number(C)),"cursor-move":e.preFilesDragMode,"cursor-pointer":e.preFilesBatchDeleteMode&&!e.preFilesDragMode,"cursor-default":!e.preFilesDragMode&&!e.preFilesBatchDeleteMode,"select-none":!0}]),draggable:e.preFilesDragMode,onClick:t=>e.preFilesBatchDeleteMode&&!e.preFilesDragMode?l.$emit("toggle-selection",Number(C)):null,onDragstart:t=>l.$emit("drag-start",t,Number(C)),onDragend:u[8]||(u[8]=t=>l.$emit("drag-end",t)),onDragover:u[9]||(u[9]=ge(t=>l.$emit("drag-over",t),["prevent"])),onDragleave:u[10]||(u[10]=t=>{const N=t.currentTarget;N&&N.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")}),onDrop:ge(t=>l.$emit("drop",t,Number(C)),["prevent"])},[o("span",Wo,G(Number(C)+1),1),o("span",{class:oe(["flex-1 text-sm truncate",{"text-blue-600":Number(e.playlistStatus?.pre_index)===C}]),title:B.uri||""},G(B.uri?B.uri.split("/").pop():""),11,Ho),o("div",{class:"flex items-center gap-1 flex-shrink-0",onMousedown:u[6]||(u[6]=ge(()=>{},["stop"])),onClick:u[7]||(u[7]=ge(()=>{},["stop"]))},[be(n($l,{file:B,player:e.audioPlayer,disabled:e.playlistLoading,onPlay:t=>l.$emit("play-file",B),onSeek:(t,N)=>l.$emit("seek-file",t,N)},null,8,["file","player","disabled","onPlay","onSeek"]),[[Pe,!e.preFilesBatchDeleteMode]]),be(n(A,{class:"!h-6","model-value":e.selectedPreFileIndices.includes(Number(C)),onChange:t=>l.$emit("toggle-selection",Number(C)),onClick:u[5]||(u[5]=ge(()=>{},["stop"]))},null,8,["model-value","onChange"]),[[Pe,e.preFilesBatchDeleteMode]]),be(n(g,{type:"default",size:"small",plain:"",circle:"",onClick:ge(t=>l.$emit("move-up",Number(C)),["stop"]),disabled:Number(C)===0||e.playlistLoading,title:"上移"},{default:c(()=>[...u[15]||(u[15]=[q(" ↑ ",-1)])]),_:1},8,["onClick","disabled"]),[[Pe,e.showMoreActions&&!e.preFilesDragMode&&!e.preFilesBatchDeleteMode]]),be(n(g,{type:"default",size:"small",plain:"",circle:"",onClick:ge(t=>l.$emit("move-down",Number(C)),["stop"]),disabled:Number(C)===d().length-1||e.playlistLoading,title:"下移"},{default:c(()=>[...u[16]||(u[16]=[q(" ↓ ",-1)])]),_:1},8,["onClick","disabled"]),[[Pe,e.showMoreActions&&!e.preFilesDragMode&&!e.preFilesBatchDeleteMode]]),be(n(g,{type:"default",size:"small",plain:"",circle:"",onClick:ge(t=>l.$emit("replace",Number(C)),["stop"]),disabled:e.playlistLoading,title:"替换"},{default:c(()=>[n(m,null,{default:c(()=>[n(s(qe))]),_:1})]),_:1},8,["onClick","disabled"]),[[Pe,e.showMoreActions&&!e.preFilesDragMode&&!e.preFilesBatchDeleteMode]]),be(n(g,{type:"info",size:"small",plain:"",circle:"",onClick:ge(t=>l.$emit("open-playlist-selector",B),["stop"]),disabled:e.playlistLoading,title:"应用到列表"},{default:c(()=>[n(m,null,{default:c(()=>[n(s(ml))]),_:1})]),_:1},8,["onClick","disabled"]),[[Pe,!e.preFilesBatchDeleteMode&&!e.preFilesDragMode]]),be(n(g,{type:"default",size:"small",plain:"",circle:"",onClick:ge(t=>l.$emit("delete",Number(C)),["stop"]),disabled:e.playlistLoading||e.preFilesDragMode,title:"删除"},{default:c(()=>[n(m,null,{default:c(()=>[n(s(gl))]),_:1})]),_:1},8,["onClick","disabled"]),[[Pe,!e.preFilesBatchDeleteMode]])],32)],42,jo))),128))],2)):Q("",!0),d()&&d().length>0?(v(),E("div",Yo,[n(g,{type:"default",size:"small",plain:"",class:"!w-full !h-4 !p-0 !text-xs",onClick:u[11]||(u[11]=B=>l.$emit("toggle-expand")),title:e.preFilesExpanded?"折叠":"展开"},{default:c(()=>[e.preFilesExpanded?(v(),te(m,{key:0},{default:c(()=>[n(s(Cn))]),_:1})):(v(),te(m,{key:1},{default:c(()=>[n(s(ul))]),_:1}))]),_:1},8,["title"])])):(v(),E("div",Jo,"前置文件列表为空"))])}}}),Xo={key:0,class:"border rounded p-2"},Qo={class:"flex items-center justify-between mb-2 pr-2.5"},Zo={class:"text-xs font-semibold text-gray-600"},ei={key:0,class:"ml-2 text-gray-500"},ti={key:1,class:"ml-2 text-gray-500"},li={class:"flex items-center gap-1"},si={key:0,class:"overflow-y-scroll scrollbar-overlay"},ni=["draggable","onClick","onDragstart","onDrop"],ai={class:"text-xs text-gray-500 w-8"},oi=["title"],ii={key:1,class:"text-sm text-gray-400 text-center py-1"},ri=ke({__name:"FilesList",props:{playlistStatus:{},filesDragMode:{type:Boolean},filesBatchDeleteMode:{type:Boolean},selectedFileIndices:{},playlistLoading:{type:Boolean},showMoreActions:{type:Boolean},audioPlayer:{}},emits:["open-file-browser","toggle-drag-mode","toggle-batch-delete-mode","batch-delete","clear","toggle-selection","drag-start","drag-end","drag-over","drop","play-file","seek-file","move-up","move-down","replace","open-playlist-selector","delete"],setup(e,{emit:f}){const r=e,d=f,h={plain:!0,size:"small",class:"!w-8 !h-6"},i={type:"default",size:"small",plain:!0,circle:!0},l=le(()=>r.playlistStatus?.playlist||[]),u=le(()=>l.value.length),g=le(()=>r.playlistStatus?.current_index??-1),a=le(()=>g.value>=0?g.value+1:"-"),m=le(()=>r.playlistStatus?.isPlaying&&!r.playlistStatus.in_pre_files),A=le(()=>u.value>0),B=le(()=>A.value?wt(l.value):0),C=le(()=>r.filesBatchDeleteMode&&A.value&&!r.filesDragMode),t=le(()=>r.showMoreActions&&!r.filesDragMode&&!r.filesBatchDeleteMode),N=le(()=>r.showMoreActions&&!r.filesBatchDeleteMode),b=le(()=>!r.filesBatchDeleteMode&&!r.filesDragMode),U=le(()=>!r.playlistStatus||r.filesDragMode||r.filesBatchDeleteMode),M=le(()=>!A.value||r.filesBatchDeleteMode),P=le(()=>!A.value||r.filesDragMode),D=le(()=>r.playlistLoading||r.selectedFileIndices.length===0),T=le(()=>`删除选中的 ${r.selectedFileIndices.length} 项`),ee=le(()=>!A.value||r.playlistLoading||r.filesDragMode),de=O=>O?O.split("/").pop():"",R=O=>r.selectedFileIndices.includes(O),x=O=>O===g.value,S=O=>({"bg-blue-50":x(O),"bg-blue-100":C.value&&R(O),"cursor-move":r.filesDragMode,"cursor-pointer":C.value,"cursor-default":!r.filesDragMode&&!r.filesBatchDeleteMode}),w=le(()=>r.playlistLoading||r.filesDragMode),I=O=>{C.value&&d("toggle-selection",O)},y=(O,L)=>{d("drag-start",O,L)},Y=O=>{d("drag-end",O)},me=O=>{d("drag-over",O)},F=O=>{const L=O.currentTarget;L?.classList&&L.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")},$=(O,L)=>{d("drop",O,L)},p=(O,L)=>{d("seek-file",O,L)};return(O,L)=>{const J=Kt,ae=ze,ce=Be,Ie=Dt;return e.playlistStatus?.playlist?(v(),E("div",Xo,[o("div",Qo,[o("div",Zo,[L[9]||(L[9]=q(" 正式文件（播放时记录进度） ",-1)),B.value>0?(v(),E("span",ei," 总时长："+G(s(jt)(B.value)),1)):Q("",!0),A.value?(v(),E("span",ti," 共 "+G(u.value)+" 首， 当前: "+G(a.value)+" / "+G(u.value),1)):Q("",!0),m.value?(v(),te(J,{key:2,type:"success",size:"small",class:"ml-2"},{default:c(()=>[...L[8]||(L[8]=[q(" 播放中 ",-1)])]),_:1})):Q("",!0)]),o("div",li,[n(ae,Le({type:"primary"},h,{onClick:L[0]||(L[0]=Fe=>d("open-file-browser")),disabled:U.value}),{default:c(()=>[...L[10]||(L[10]=[q(" + ",-1)])]),_:1},16,["disabled"]),n(ae,Le({type:e.filesDragMode?"success":"default"},h,{onClick:L[1]||(L[1]=Fe=>d("toggle-drag-mode")),disabled:M.value,title:e.filesDragMode?"点击退出拖拽排序模式":"点击进入拖拽排序模式"}),{default:c(()=>[e.filesDragMode?(v(),te(ce,{key:0},{default:c(()=>[n(s(bt))]),_:1})):(v(),te(ce,{key:1},{default:c(()=>[n(s(Gt))]),_:1}))]),_:1},16,["type","disabled","title"]),n(ae,Le({type:e.filesBatchDeleteMode?"success":"default"},h,{onClick:L[2]||(L[2]=Fe=>d("toggle-batch-delete-mode")),disabled:P.value,title:e.filesBatchDeleteMode?"点击退出批量删除模式":"点击进入批量删除模式"}),{default:c(()=>[e.filesBatchDeleteMode?(v(),te(ce,{key:0},{default:c(()=>[n(s(bt))]),_:1})):(v(),te(ce,{key:1},{default:c(()=>[n(s(je))]),_:1}))]),_:1},16,["type","disabled","title"]),be(n(ae,Le({type:"danger"},h,{onClick:L[3]||(L[3]=Fe=>d("batch-delete")),disabled:D.value,title:T.value}),{default:c(()=>[n(ce,null,{default:c(()=>[n(s(je))]),_:1})]),_:1},16,["disabled","title"]),[[Pe,e.filesBatchDeleteMode]]),be(n(ae,Le({type:"default"},h,{onClick:L[4]||(L[4]=Fe=>d("clear")),disabled:ee.value,title:"清空正式文件列表"}),{default:c(()=>[n(ce,null,{default:c(()=>[n(s(je))]),_:1})]),_:1},16,["disabled"]),[[Pe,N.value]])])]),A.value?(v(),E("div",si,[(v(!0),E(De,null,Ae(l.value,(Fe,we)=>(v(),E("div",{key:Fe.uri||we,class:oe(["flex items-center gap-2 p-1 hover:bg-gray-100 rounded select-none",S(we)]),draggable:e.filesDragMode,onClick:j=>I(we),onDragstart:j=>y(j,we),onDragend:Y,onDragover:ge(me,["prevent"]),onDragleave:F,onDrop:ge(j=>$(j,we),["prevent"])},[o("span",ai,G(we+1),1),o("span",{class:oe(["flex-1 text-sm truncate",{"text-blue-600":x(we)}]),title:Fe.uri||""},G(de(Fe.uri)),11,oi),o("div",{class:"flex items-center gap-1 flex-shrink-0",onMousedown:L[6]||(L[6]=ge(()=>{},["stop"])),onClick:L[7]||(L[7]=ge(()=>{},["stop"]))},[be(n($l,{file:Fe,player:e.audioPlayer,disabled:e.playlistLoading,onPlay:j=>d("play-file",Fe),onSeek:p},null,8,["file","player","disabled","onPlay"]),[[Pe,!e.filesBatchDeleteMode]]),be(n(Ie,{class:"!h-6","model-value":R(we),onChange:j=>d("toggle-selection",we),onClick:L[5]||(L[5]=ge(()=>{},["stop"]))},null,8,["model-value","onChange"]),[[Pe,e.filesBatchDeleteMode]]),be(n(ae,Le({ref_for:!0},i,{onClick:ge(j=>d("move-up",we),["stop"]),disabled:we===0||e.playlistLoading,title:"上移"}),{default:c(()=>[...L[11]||(L[11]=[q(" ↑ ",-1)])]),_:1},16,["onClick","disabled"]),[[Pe,t.value]]),be(n(ae,Le({ref_for:!0},i,{onClick:ge(j=>d("move-down",we),["stop"]),disabled:we===u.value-1||e.playlistLoading,title:"下移"}),{default:c(()=>[...L[12]||(L[12]=[q(" ↓ ",-1)])]),_:1},16,["onClick","disabled"]),[[Pe,t.value]]),be(n(ae,Le({ref_for:!0},i,{onClick:ge(j=>d("replace",we),["stop"]),disabled:e.playlistLoading,title:"替换"}),{default:c(()=>[n(ce,null,{default:c(()=>[n(s(qe))]),_:1})]),_:1},16,["onClick","disabled"]),[[Pe,t.value]]),be(n(ae,{type:"info",size:"small",plain:"",circle:"",onClick:ge(j=>d("open-playlist-selector",Fe),["stop"]),disabled:e.playlistLoading,title:"应用到列表"},{default:c(()=>[n(ce,null,{default:c(()=>[n(s(ml))]),_:1})]),_:1},8,["onClick","disabled"]),[[Pe,b.value]]),be(n(ae,Le({ref_for:!0},i,{onClick:ge(j=>d("delete",we),["stop"]),disabled:w.value,title:"删除"}),{default:c(()=>[n(ce,null,{default:c(()=>[n(s(gl))]),_:1})]),_:1},16,["onClick","disabled"]),[[Pe,!e.filesBatchDeleteMode]])],32)],42,ni))),128))])):(v(),E("div",ii,"正式文件列表为空"))])):Q("",!0)}}}),di={class:"flex-1 border rounded p-3 flex flex-col"},ui={class:"flex items-center justify-between mb-3"},ci={class:"flex-1"},fi={key:0,class:"flex items-center gap-2 mb-1"},pi={class:"flex items-center gap-2 flex-1"},vi={class:"text-lg font-semibold truncate"},mi={key:1},gi={key:2,class:"text-sm text-gray-500"},yi={key:0,class:"mr-2"},hi={class:"flex flex-wrap gap-2"},bi={key:1},wi={key:1},$i={key:1},Ci={key:1},ki={key:0,class:"flex-1 overflow-y-scroll scrollbar-overlay"},Di={key:0,class:"text-sm text-gray-400 text-center py-8"},xi={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},Fi=ke({__name:"FileListPanel",props:{playlistStatus:{},activePlaylistId:{},editingPlaylistId:{},editingPlaylistName:{},selectedWeekdayIndex:{},preFilesDragMode:{type:Boolean},preFilesBatchDeleteMode:{type:Boolean},selectedPreFileIndices:{},preFilesExpanded:{type:Boolean},filesDragMode:{type:Boolean},filesBatchDeleteMode:{type:Boolean},selectedFileIndices:{},playlistLoading:{type:Boolean},playing:{type:Boolean},stopping:{type:Boolean},showMoreActions:{type:Boolean},audioPlayer:{}},emits:["update:editingPlaylistName","start-edit-name","save-name","cancel-edit-name","open-batch-drawer","play","play-pre","play-next","stop","clear","toggle-more-actions","select-weekday","open-file-browser-for-pre-files","toggle-pre-files-drag-mode","toggle-pre-files-batch-delete-mode","batch-delete-pre-files","clear-pre-files","toggle-pre-files-expand","toggle-pre-file-selection","pre-file-drag-start","pre-file-drag-end","pre-file-drag-over","pre-file-drop","open-file-browser","toggle-files-drag-mode","toggle-files-batch-delete-mode","batch-delete-files","clear-files","toggle-file-selection","file-drag-start","file-drag-end","file-drag-over","file-drop","play-file","seek-file","move-pre-file-up","move-pre-file-down","replace-pre-file","open-playlist-selector-for-pre-file","delete-pre-file","move-file-up","move-file-down","replace-file","open-playlist-selector-for-file","delete-file"],setup(e){const f=e,r=()=>f.selectedWeekdayIndex!==null?f.selectedWeekdayIndex:Xe(),d=()=>{const i=f.playlistStatus;if(!i||!i.pre_lists)return[];const l=r();return!Array.isArray(i.pre_lists)||i.pre_lists.length!==7?[]:i.pre_lists[l]||[]},h=()=>{const i=f.playlistStatus;if(!i)return 0;const l=d(),u=wt(l),g=i.playlist||[],a=wt(g);return u+a};return(i,l)=>{const u=Be,g=ze;return v(),E("div",di,[o("div",ui,[o("div",ci,[e.playlistStatus?(v(),E("div",fi,[o("div",pi,[o("h3",vi,G(e.playlistStatus.name),1),n(g,{type:"default",size:"small",plain:"",circle:"",onClick:l[0]||(l[0]=a=>i.$emit("start-edit-name",e.activePlaylistId)),title:"编辑名称"},{default:c(()=>[n(u,null,{default:c(()=>[n(s(yl))]),_:1})]),_:1})])])):(v(),E("div",mi,[...l[44]||(l[44]=[o("h3",{class:"text-lg font-semibold"},"播放列表文件",-1)])])),e.playlistStatus?(v(),E("div",gi,[h()>0?(v(),E("span",yi," 总时长："+G(s(jt)(h())),1)):Q("",!0),e.playlistStatus?(v(),E(De,{key:1},[(d()?.length||0)+(e.playlistStatus.playlist?.length||0)>0?(v(),E(De,{key:0},[q(" 共 "+G((d()?.length||0)+(e.playlistStatus.playlist?.length||0))+" 首， 当前: ",1),e.playlistStatus.pre_index!==void 0&&e.playlistStatus.pre_index!==null&&e.playlistStatus.pre_index>=0?(v(),E(De,{key:0},[q(G(e.playlistStatus.pre_index+1),1)],64)):e.playlistStatus.current_index!==void 0&&e.playlistStatus.current_index!==null&&e.playlistStatus.current_index>=0?(v(),E(De,{key:1},[q(G((d()?.length||0)+e.playlistStatus.current_index+1),1)],64)):(v(),E(De,{key:2},[q(" - ")],64)),q(" / "+G((d()?.length||0)+(e.playlistStatus.playlist?.length||0)),1)],64)):(v(),E(De,{key:1},[q(" 共 0 首， 当前: - / 0 ")],64))],64)):Q("",!0)])):Q("",!0)]),o("div",hi,[n(g,{type:"default",size:"small",plain:"",circle:"",onClick:l[1]||(l[1]=a=>i.$emit("open-batch-drawer")),title:"批量模式"},{default:c(()=>[n(u,null,{default:c(()=>[n(s(kn))]),_:1})]),_:1}),n(g,{type:"default",size:"small",plain:"",circle:"",onClick:l[2]||(l[2]=a=>i.$emit("play")),class:"items-center justify-center",disabled:!e.playlistStatus||!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0||!!e.playlistStatus.isPlaying,title:"播放"},{default:c(()=>[e.playing?(v(),te(u,{key:0,size:"12",class:"animate-spin"},{default:c(()=>[n(s(Qe))]),_:1})):(v(),E("span",bi,"▶"))]),_:1},8,["disabled"]),n(g,{type:"default",size:"small",plain:"",circle:"",onClick:l[3]||(l[3]=a=>i.$emit("play-pre")),disabled:!e.playlistStatus||(!d()||d().length===0)&&(!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0),title:"上一首"},{default:c(()=>[e.playing?(v(),te(u,{key:0,size:"12",class:"animate-spin"},{default:c(()=>[n(s(Qe))]),_:1})):(v(),E("span",wi,"⏮"))]),_:1},8,["disabled"]),n(g,{type:"default",size:"small",plain:"",circle:"",onClick:l[4]||(l[4]=a=>i.$emit("play-next")),disabled:!e.playlistStatus||(!d()||d().length===0)&&(!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0),title:"下一首"},{default:c(()=>[e.playing?(v(),te(u,{key:0,size:"12",class:"animate-spin"},{default:c(()=>[n(s(Qe))]),_:1})):(v(),E("span",$i,"⏭"))]),_:1},8,["disabled"]),n(g,{type:"default",size:"small",plain:"",circle:"",onClick:l[5]||(l[5]=a=>i.$emit("stop")),title:"停止"},{default:c(()=>[e.stopping?(v(),te(u,{key:0,size:"12",class:"animate-spin"},{default:c(()=>[n(s(Qe))]),_:1})):(v(),E("span",Ci,"⏹"))]),_:1}),be(n(g,{type:"default",size:"small",plain:"",circle:"",onClick:l[6]||(l[6]=a=>i.$emit("clear")),disabled:!e.playlistStatus||(!d()||d().length===0)&&(!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0)||e.playlistLoading,title:"清空列表（包括前置文件和正式文件）"},{default:c(()=>[n(u,null,{default:c(()=>[n(s(je))]),_:1})]),_:1},8,["disabled"]),[[Pe,e.showMoreActions]]),n(g,{type:"default",size:"small",plain:"",circle:"",onClick:l[7]||(l[7]=a=>i.$emit("toggle-more-actions")),title:"更多"},{default:c(()=>[n(u,null,{default:c(()=>[n(s(Gt))]),_:1})]),_:1})])]),e.playlistStatus?(v(),E("div",ki,[n(qo,{"playlist-status":e.playlistStatus,"selected-weekday-index":e.selectedWeekdayIndex,"pre-files-drag-mode":e.preFilesDragMode,"pre-files-batch-delete-mode":e.preFilesBatchDeleteMode,"selected-pre-file-indices":e.selectedPreFileIndices,"pre-files-expanded":e.preFilesExpanded,"playlist-loading":e.playlistLoading,"show-more-actions":e.showMoreActions,"audio-player":e.audioPlayer,onSelectWeekday:l[8]||(l[8]=a=>i.$emit("select-weekday",a)),onOpenFileBrowser:l[9]||(l[9]=a=>i.$emit("open-file-browser-for-pre-files")),onToggleDragMode:l[10]||(l[10]=a=>i.$emit("toggle-pre-files-drag-mode")),onToggleBatchDeleteMode:l[11]||(l[11]=a=>i.$emit("toggle-pre-files-batch-delete-mode")),onBatchDelete:l[12]||(l[12]=a=>i.$emit("batch-delete-pre-files")),onClear:l[13]||(l[13]=a=>i.$emit("clear-pre-files")),onToggleExpand:l[14]||(l[14]=a=>i.$emit("toggle-pre-files-expand")),onToggleSelection:l[15]||(l[15]=a=>i.$emit("toggle-pre-file-selection",a)),onDragStart:l[16]||(l[16]=(a,m)=>i.$emit("pre-file-drag-start",a,m)),onDragEnd:l[17]||(l[17]=a=>i.$emit("pre-file-drag-end",a)),onDragOver:l[18]||(l[18]=a=>i.$emit("pre-file-drag-over",a)),onDrop:l[19]||(l[19]=(a,m)=>i.$emit("pre-file-drop",a,m)),onPlayFile:l[20]||(l[20]=a=>i.$emit("play-file",a)),onSeekFile:l[21]||(l[21]=(a,m)=>i.$emit("seek-file",a,m)),onMoveUp:l[22]||(l[22]=a=>i.$emit("move-pre-file-up",a)),onMoveDown:l[23]||(l[23]=a=>i.$emit("move-pre-file-down",a)),onReplace:l[24]||(l[24]=a=>i.$emit("replace-pre-file",a)),onOpenPlaylistSelector:l[25]||(l[25]=a=>i.$emit("open-playlist-selector-for-pre-file",a)),onDelete:l[26]||(l[26]=a=>i.$emit("delete-pre-file",a))},null,8,["playlist-status","selected-weekday-index","pre-files-drag-mode","pre-files-batch-delete-mode","selected-pre-file-indices","pre-files-expanded","playlist-loading","show-more-actions","audio-player"]),n(ri,{"playlist-status":e.playlistStatus,"files-drag-mode":e.filesDragMode,"files-batch-delete-mode":e.filesBatchDeleteMode,"selected-file-indices":e.selectedFileIndices,"playlist-loading":e.playlistLoading,"show-more-actions":e.showMoreActions,"audio-player":e.audioPlayer,onOpenFileBrowser:l[27]||(l[27]=a=>i.$emit("open-file-browser")),onToggleDragMode:l[28]||(l[28]=a=>i.$emit("toggle-files-drag-mode")),onToggleBatchDeleteMode:l[29]||(l[29]=a=>i.$emit("toggle-files-batch-delete-mode")),onBatchDelete:l[30]||(l[30]=a=>i.$emit("batch-delete-files")),onClear:l[31]||(l[31]=a=>i.$emit("clear-files")),onToggleSelection:l[32]||(l[32]=a=>i.$emit("toggle-file-selection",a)),onDragStart:l[33]||(l[33]=(a,m)=>i.$emit("file-drag-start",a,m)),onDragEnd:l[34]||(l[34]=a=>i.$emit("file-drag-end",a)),onDragOver:l[35]||(l[35]=a=>i.$emit("file-drag-over",a)),onDrop:l[36]||(l[36]=(a,m)=>i.$emit("file-drop",a,m)),onPlayFile:l[37]||(l[37]=a=>i.$emit("play-file",a)),onSeekFile:l[38]||(l[38]=(a,m)=>i.$emit("seek-file",a,m)),onMoveUp:l[39]||(l[39]=a=>i.$emit("move-file-up",a)),onMoveDown:l[40]||(l[40]=a=>i.$emit("move-file-down",a)),onReplace:l[41]||(l[41]=a=>i.$emit("replace-file",a)),onOpenPlaylistSelector:l[42]||(l[42]=a=>i.$emit("open-playlist-selector-for-file",a)),onDelete:l[43]||(l[43]=a=>i.$emit("delete-file",a))},null,8,["playlist-status","files-drag-mode","files-batch-delete-mode","selected-file-indices","playlist-loading","show-more-actions","audio-player"]),(!d()||d().length===0)&&(!e.playlistStatus?.playlist||e.playlistStatus.playlist.length===0)?(v(),E("div",Di,' 当前播放列表为空，点击"添加文件"开始构建播放列表 ')):Q("",!0)])):(v(),E("div",xi," 请先在左侧选择一个播放列表查看详情 "))])}}}),_i=["agent","dlna","bluetooth","mi"],Pi=1e4,al=5,Si=5e3,Ye="默认播放列表",Ti=1440,vt=7,Bi=[..._i],Ei="dlna",Ol="active_playlist_id",mt={NONE:"",BUTTON_1:"B1",BUTTON_2:"B2",BUTTON_3:"B3"},Ai={class:"w-80 min-w-75 border rounded p-3 flex flex-col"},Mi={key:0,class:"mb-3 flex items-center gap-2 flex-wrap"},Ni={key:1,class:"flex-1 overflow-y-auto space-y-4"},Li={class:"border rounded p-3"},Oi={class:"flex items-center justify-between mb-2"},Ii={class:"space-y-2"},Ri={class:"flex items-center gap-2"},zi={class:"flex items-start gap-4"},Ui={class:"flex-1"},Vi={class:"flex-1"},Ki={key:0},Gi={class:"border rounded p-3"},ji={class:"space-y-2"},Wi={class:"text-xs text-gray-600 mb-1 flex items-center gap-2"},Hi={key:0,class:"text-xs text-gray-500"},Yi={class:"flex items-center gap-2"},Ji={class:"mt-3"},qi={class:"text-xs font-semibold text-gray-700 mb-2"},Xi={key:0},Qi={class:"space-y-2 max-h-[200px] overflow-y-auto"},Zi={class:"flex-1 min-w-0"},er={class:"text-sm font-medium truncate"},tr={class:"text-xs text-gray-500 truncate"},lr={class:"flex-shrink-0"},sr={key:0,class:"text-xs text-gray-400 text-center py-4"},nr={key:1},ar={class:"space-y-2 max-h-[200px] overflow-y-auto"},or={class:"flex-1 min-w-0"},ir={class:"text-sm font-medium truncate"},rr=["title"],dr={class:"flex-shrink-0"},ur={key:0,class:"text-xs text-gray-400 text-center py-4"},cr={key:2},fr={class:"space-y-2 max-h-[200px] overflow-y-auto"},pr={class:"flex-1 min-w-0"},vr={class:"text-sm font-medium truncate"},mr=["title"],gr={class:"flex-shrink-0"},yr={key:0,class:"text-xs text-gray-400 text-center py-4"},hr={key:2,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},br=ke({__name:"ConfigPanel",props:{playlistStatus:{},connectedDeviceList:{},dlnaDeviceList:{},miDeviceList:{},loading:{type:Boolean},dlnaScanning:{type:Boolean},miScanning:{type:Boolean},onToggleCronEnabled:{type:Function},onUpdateCron:{type:Function},onUpdateDuration:{type:Function},onUpdateTriggerButton:{type:Function},onOpenCronBuilder:{type:Function},onPreviewCron:{type:Function},onUpdateDeviceType:{type:Function},onUpdateDeviceAddress:{type:Function},onSelectBluetoothDevice:{type:Function},onSelectAgentDevice:{type:Function},onSelectMiDevice:{type:Function},onScanDlnaDevices:{type:Function},onScanMiDevices:{type:Function},onOpenScanDialog:{type:Function},onOpenDeviceList:{type:Function}},setup(e){const f=e,r=le(()=>f.playlistStatus?.device?.type||f.playlistStatus?.device_type||null),d=le(()=>f.playlistStatus?.device?.address||f.playlistStatus?.device_address||""),h=a=>le(()=>r.value===a),i=le(()=>{const a=r.value;return a==="agent"||a==="bluetooth"}),l=h("dlna"),u=h("mi"),g=le(()=>i.value?"已配对的设备":l.value?"DLNA 设备":u.value?"小米设备":"设备列表");return(a,m)=>{const A=Be,B=ze,C=Nl,t=Vt,N=On,b=bl,U=hl,M=Wt;return v(),E("div",Ai,[m[19]||(m[19]=o("h3",{class:"text-lg font-semibold mb-3"},"配置详情",-1)),e.playlistStatus?(v(),E("div",Mi,[n(B,{type:"default",onClick:e.onOpenDeviceList,title:"打开设备列表"},{default:c(()=>[n(A,null,{default:c(()=>[n(s(Dn))]),_:1}),m[4]||(m[4]=o("span",{class:"ml-1"},"设备列表",-1))]),_:1},8,["onClick"])])):Q("",!0),e.playlistStatus?(v(),E("div",Ni,[o("div",Li,[o("div",Oi,[m[5]||(m[5]=o("h4",{class:"text-sm font-semibold"},"定时任务 (Cron)",-1)),n(C,{"model-value":e.playlistStatus.schedule?.enabled===1,onChange:m[0]||(m[0]=P=>e.onToggleCronEnabled(P)),"active-text":"开启","inactive-text":"关闭"},null,8,["model-value"])]),o("div",Ii,[o("div",null,[m[7]||(m[7]=o("div",{class:"text-xs text-gray-600 mb-1"},"Cron 表达式",-1)),o("div",Ri,[n(t,{"model-value":e.playlistStatus.schedule?.cron||"",onInput:m[1]||(m[1]=P=>e.onUpdateCron(P)),placeholder:"例如: 0 0 * * *",size:"small",disabled:e.playlistStatus.schedule?.enabled!==1},null,8,["model-value","disabled"]),n(B,{type:"info",size:"small",onClick:e.onOpenCronBuilder,disabled:e.playlistStatus.schedule?.enabled!==1},{default:c(()=>[...m[6]||(m[6]=[q(" 助手 ",-1)])]),_:1},8,["onClick","disabled"])])]),o("div",zi,[o("div",Ui,[m[8]||(m[8]=o("div",{class:"text-xs text-gray-600 mb-1"},"持续时间（分钟）",-1)),n(N,{"model-value":e.playlistStatus.schedule?.duration||0,onChange:e.onUpdateDuration,min:0,max:s(Ti),step:1,size:"small",disabled:e.playlistStatus.schedule?.enabled!==1,class:"w-full"},null,8,["model-value","onChange","max","disabled"]),m[9]||(m[9]=o("div",{class:"text-xs text-gray-500 mt-1"},"0表示不自动停止",-1))]),o("div",Vi,[m[10]||(m[10]=o("div",{class:"text-xs text-gray-600 mb-1"},"触发按钮",-1)),n(U,{"model-value":e.playlistStatus.trigger_button||"",onChange:e.onUpdateTriggerButton,placeholder:"选择触发按钮",size:"small",class:"w-full",clearable:""},{default:c(()=>[n(b,{label:"空",value:s(mt).NONE},null,8,["value"]),n(b,{label:"按钮对-1",value:s(mt).BUTTON_1},null,8,["value"]),n(b,{label:"按钮对-2",value:s(mt).BUTTON_2},null,8,["value"]),n(b,{label:"按钮对-3",value:s(mt).BUTTON_3},null,8,["value"])]),_:1},8,["model-value","onChange"])])]),e.playlistStatus.schedule?.cron&&e.playlistStatus.schedule?.enabled===1?(v(),E("div",Ki,[n(B,{type:"success",size:"small",onClick:e.onPreviewCron,class:"w-full"},{default:c(()=>[...m[11]||(m[11]=[q(" 预览执行时间 ",-1)])]),_:1},8,["onClick"])])):Q("",!0)])]),o("div",Gi,[m[18]||(m[18]=o("h4",{class:"text-sm font-semibold mb-2"},"设备配置",-1)),o("div",ji,[o("div",null,[m[12]||(m[12]=o("div",{class:"text-xs text-gray-600 mb-1"},"设备类型",-1)),n(U,{"model-value":r.value,onChange:e.onUpdateDeviceType,placeholder:"选择设备类型",size:"small",class:"w-full"},{default:c(()=>[n(b,{label:"蓝牙",value:"bluetooth"}),n(b,{label:"DLNA",value:"dlna"}),n(b,{label:"设备代理",value:"agent"}),n(b,{label:"小米设备",value:"mi"})]),_:1},8,["model-value","onChange"])]),o("div",null,[o("div",Wi,[m[13]||(m[13]=o("span",null,"设备地址",-1)),e.playlistStatus.device?.name?(v(),E("span",Hi,G(e.playlistStatus.device.name),1)):Q("",!0)]),o("div",Yi,[n(t,{"model-value":d.value,onInput:m[2]||(m[2]=P=>e.onUpdateDeviceAddress(P)),placeholder:"设备地址",size:"small",class:"flex-1"},null,8,["model-value"]),n(B,{size:"small",type:"danger",plain:"",onClick:m[3]||(m[3]=P=>e.onUpdateDeviceAddress("")),disabled:!d.value,title:"清空设备地址"},{default:c(()=>[...m[14]||(m[14]=[q(" 清空 ",-1)])]),_:1},8,["disabled"])])])]),o("div",Ji,[o("h5",qi,G(g.value),1),i.value?(v(),E("div",Xi,[be((v(),E("div",Qi,[(v(!0),E(De,null,Ae(e.connectedDeviceList,P=>(v(),E("div",{key:P.address,class:"flex items-center gap-2 p-2 border rounded hover:bg-gray-50"},[o("div",Zi,[o("div",er,G(P.name),1),o("div",tr,G(P.address),1)]),o("div",lr,[n(B,{size:"small",type:"primary",onClick:D=>r.value==="agent"?e.onSelectAgentDevice(P):e.onSelectBluetoothDevice(P.address),disabled:P.address===d.value},{default:c(()=>[...m[15]||(m[15]=[q(" 选择 ",-1)])]),_:1},8,["onClick","disabled"])])]))),128)),e.connectedDeviceList.length===0?(v(),E("div",sr," 暂无设备 ")):Q("",!0)])),[[M,e.loading]])])):s(l)?(v(),E("div",nr,[be((v(),E("div",ar,[(v(!0),E(De,null,Ae(e.dlnaDeviceList,P=>(v(),E("div",{key:P.location,class:"flex items-center gap-2 p-2 border rounded hover:bg-gray-50"},[o("div",or,[o("div",ir,G(P.name),1),o("div",{class:"text-xs text-gray-500 truncate",title:P.location},G(P.location),9,rr)]),o("div",dr,[n(B,{size:"small",type:"primary",onClick:D=>e.onUpdateDeviceAddress(P.location||P.address||"",P.name),disabled:(P.location||P.address)===d.value},{default:c(()=>[...m[16]||(m[16]=[q(" 选择 ",-1)])]),_:1},8,["onClick","disabled"])])]))),128)),e.dlnaDeviceList.length===0&&!e.dlnaScanning?(v(),E("div",ur,' 暂无设备，点击"扫描设备"开始扫描 ')):Q("",!0)])),[[M,e.dlnaScanning]])])):s(u)?(v(),E("div",cr,[be((v(),E("div",fr,[(v(!0),E(De,null,Ae(e.miDeviceList,P=>(v(),E("div",{key:P.deviceID||P.address,class:"flex items-center gap-2 p-2 border rounded hover:bg-gray-50"},[o("div",pr,[o("div",vr,G(P.name),1),o("div",{class:"text-xs text-gray-500 truncate",title:P.deviceID||P.address},G(P.deviceID||P.address),9,mr)]),o("div",gr,[n(B,{size:"small",type:"primary",onClick:D=>e.onSelectMiDevice(P),disabled:(P.deviceID||P.address)===d.value},{default:c(()=>[...m[17]||(m[17]=[q(" 选择 ",-1)])]),_:1},8,["onClick","disabled"])])]))),128)),e.miDeviceList.length===0&&!e.miScanning?(v(),E("div",yr,' 暂无设备，点击"扫描设备"开始扫描 ')):Q("",!0)])),[[M,e.miScanning]])])):Q("",!0)])])])):(v(),E("div",hr," 请先选择一个播放列表 "))])}}}),wr={class:"mb-4"},$r={key:0,class:"text-center text-gray-400 mt-4 py-8"},Cr=ke({__name:"ScanDeviceDialog",props:{visible:{type:Boolean},deviceList:{},loading:{type:Boolean}},emits:["update:visible","refresh","connect","close"],setup(e,{emit:f}){const r=f,d=l=>{r("update:visible",l),l||r("close")},h=()=>{r("refresh")},i=l=>{r("connect",l)};return(l,u)=>{const g=ze,a=xl,m=Dl,A=ut,B=Wt;return v(),te(A,{"model-value":e.visible,"onUpdate:modelValue":d,title:"扫描到的设备",width:"800"},{default:c(()=>[o("div",wr,[n(g,{type:"primary",onClick:h,loading:e.loading},{default:c(()=>[...u[0]||(u[0]=[q("刷新扫描",-1)])]),_:1},8,["loading"])]),be((v(),te(m,{data:e.deviceList,stripe:"",class:"w-full",height:400},{default:c(()=>[n(a,{prop:"name",label:"设备名称","min-width":"150"}),n(a,{prop:"address",label:"地址","min-width":"120"}),n(a,{prop:"rssi",label:"信号强度",width:"100"},{default:c(({row:C})=>[o("span",null,G(C.rssi)+" dBm",1)]),_:1}),n(a,{label:"操作",width:"100"},{default:c(({row:C})=>[n(g,{size:"small",type:"primary",onClick:t=>i(C),loading:C.connecting,disabled:C.connecting},{default:c(()=>[...u[1]||(u[1]=[q(" 连接 ",-1)])]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1},8,["data"])),[[B,e.loading]]),e.deviceList.length===0&&!e.loading?(v(),E("div",$r,' 暂无扫描到的设备，点击"刷新扫描"按钮开始扫描 ')):Q("",!0)]),_:1},8,["model-value"])}}}),kr={class:"flex flex-col gap-4 h-full overflow-y-auto"},Dr={class:"flex items-center justify-between mb-2"},xr={class:"flex items-center gap-2"},Fr={class:"flex flex-col gap-1"},_r={class:"text-sm flex items-start"},Pr={class:"text-gray-800"},Sr={class:"text-sm flex items-start"},Tr={class:"text-gray-800"},Br={key:0,class:"text-gray-400"},Er={class:"flex flex-col items-center gap-1"},Ar={class:"text-xs text-gray-500"},Mr={class:"flex flex-col gap-1"},Nr={class:"text-[12px] mr-1 !w-4"},Lr={class:"flex items-center justify-between mb-2"},Or={class:"flex items-center gap-2"},Ir={class:"flex flex-col gap-1"},Rr={class:"text-sm flex items-start"},zr={class:"text-gray-800"},Ur={class:"text-sm flex items-start"},Vr={class:"text-gray-800 w-40"},Kr={class:"text-gray-800 w-40"},Gr={class:"flex flex-col gap-2"},jr={class:"flex items-center gap-2"},Wr={class:"text-gray-800 w-5"},Hr={key:1},Yr={class:"flex items-center gap-2"},Jr={class:"flex items-center justify-between mb-2"},qr={class:"flex items-center gap-2"},Xr={class:"flex flex-col gap-1"},Qr={class:"text-sm flex items-start"},Zr=["title"],ed={key:0,class:"text-sm flex items-start"},td={class:"text-gray-800"},ld={class:"flex flex-col gap-2"},sd={class:"flex items-center gap-2"},nd={class:"text-gray-800 w-5"},ad={key:1},od={class:"flex items-center gap-2"},id=ke({__name:"DevicesDrawer",props:{visible:{type:Boolean,default:!1}},emits:["update:visible"],setup(e,{emit:f}){const r=e,d=f,h=K(r.visible),i=K([]),l=K(!1),u=K([]),g=K(!1),a=K([]),m=K(!1);let A=null;const B=[{label:"B1",keys:["F13","F14"]},{label:"B2",keys:["F15","F16"]},{label:"B3",keys:["F17","F18"]}],C=async($=!0,p=!1)=>{try{$&&(m.value=!0);const L=(await Te.get("/agent/list")).data;L?.code===0?(a.value=L.data||[],p&&z.success(`已获取 ${a.value.length} 个 Agent 设备`)):((p||$)&&z.error(L?.msg||"获取设备列表失败"),a.value=[])}catch(O){console.error("获取Agent设备列表失败:",O),(p||$)&&re(O,"获取设备列表失败"),a.value=[]}finally{$&&(m.value=!1)}},t=async($,p)=>{const O=a.value.find(ae=>ae.agent_id===$);if(!O){z.error("设备不存在");return}const L=`testing_${p}`,J=O;J[L]=!0;try{const ce=(await Te.post("/agent/mock",{agent_id:$,action:"keyboard",key:p,value:"test"})).data;ce?.code===0?z.success(`测试按钮 ${p} 成功`):z.error(ce?.msg||`测试按钮 ${p} 失败`)}catch(ae){re(ae,`测试按钮 ${p} 失败`)}finally{J[L]=!1}},N=()=>{C(!0,!1),b(),A=setInterval(()=>{C(!1,!1)},Pi)},b=()=>{A&&(clearInterval(A),A=null)},U=()=>C(!0,!1),M=($,p)=>t($,p),P=$=>$.deviceID||$.address||"",D=$=>Math.max(0,Math.min(100,$)),T=$=>({...$,volume:void 0,_volumeChanging:!1,_volumeRefreshing:!1}),ee=async()=>{try{l.value=!0;const p=(await Te.get("/mi/scan",{params:{timeout:al}})).data;if(p?.code===0){const O=(p.data||[]).map(L=>T(L));i.value=O,await Promise.allSettled(O.map(L=>de(L))),z.success(`扫描到 ${O.length} 个小米设备`)}else z.error(p?.msg||"扫描小米设备失败")}catch($){re($,"扫描小米设备失败")}finally{l.value=!1}},de=async $=>{const p=P($);if(!p)return;const O=i.value.find(L=>P(L)===p);if(O){O._volumeRefreshing=!0;try{const J=(await Te.get("/mi/volume",{params:{device_id:p}})).data;if(J?.code===0)O.volume=J.data?.volume??J.data??void 0;else{const ae=O.name||p;z.error(J?.msg||`获取设备 ${ae} 音量失败`)}}catch(L){const J=O.name||p;re(L,`获取设备 ${J} 音量失败`)}finally{O._volumeRefreshing=!1}}},R=async($,p)=>{const O=P($);if(!O){z.error("设备ID无效");return}const L=D(p);$._volumeChanging=!0;try{const ae=(await Te.post("/mi/volume",{device_id:O,volume:L})).data;ae?.code===0?($.volume=L,z.success("音量设置成功")):z.error(ae?.msg||"设置音量失败")}catch(J){re(J,"设置小米设备音量失败")}finally{$._volumeChanging=!1}},x=async $=>{const p=P($);if(!p){z.warning("设备ID无效");return}try{$._stopping=!0;const L=(await Te.post("/mi/stop",{device_id:p})).data;L?.code===0?z.success("停止播放成功"):z.error(L?.msg||"停止播放失败")}catch(O){re(O,"停止小米设备播放失败")}finally{$._stopping=!1}},S=$=>$.location||$.address||"",w=$=>({...$,volume:void 0,_volumeChanging:!1,_volumeRefreshing:!1}),I=async()=>{try{g.value=!0;const p=(await Te.get("/dlna/scan",{params:{timeout:al}})).data;if(p?.code===0){const O=(p.data||[]).map(L=>w(L));u.value=O,await Promise.allSettled(O.map(L=>y(L))),z.success(`扫描到 ${O.length} 个 DLNA 设备`)}else z.error(p?.msg||"扫描 DLNA 设备失败")}catch($){re($,"扫描 DLNA 设备失败")}finally{g.value=!1}},y=async $=>{const p=S($);if(!p)return;const O=u.value.find(L=>S(L)===p);if(O){O._volumeRefreshing=!0;try{const J=(await Te.get("/dlna/volume",{params:{location:p}})).data;if(J?.code===0)O.volume=J.data?.volume??J.data??void 0;else{const ae=O.name||p;z.error(J?.msg||`获取设备 ${ae} 音量失败`)}}catch(L){const J=O.name||p;re(L,`获取设备 ${J} 音量失败`)}finally{O._volumeRefreshing=!1}}},Y=async($,p)=>{const O=S($);if(!O){z.error("设备位置无效");return}const L=D(p);$._volumeChanging=!0;try{const ae=(await Te.post("/dlna/volume",{location:O,volume:L})).data;ae?.code===0?($.volume=L,z.success("音量设置成功")):z.error(ae?.msg||"设置音量失败")}catch(J){re(J,"设置 DLNA 设备音量失败")}finally{$._volumeChanging=!1}},me=async $=>{const p=S($);if(!p){z.warning("设备位置无效");return}try{$._stopping=!0;const L=(await Te.post("/dlna/stop",{location:p})).data;L?.code===0?z.success("停止播放成功"):z.error(L?.msg||"停止播放失败")}catch(O){re(O,"停止 DLNA 设备播放失败")}finally{$._stopping=!1}},F=()=>{h.value=!1};return Ne(()=>r.visible,$=>{h.value=$,$?N():b()},{immediate:!0}),Ne(h,$=>{$!==r.visible&&d("update:visible",$)}),nt(()=>{r.visible&&N()}),wl(()=>{b()}),($,p)=>{const O=Be,L=ze,J=xl,ae=Kt,ce=Dl,Ie=Fn,Fe=Fl,we=Wt;return v(),te(Fe,{modelValue:h.value,"onUpdate:modelValue":p[0]||(p[0]=j=>h.value=j),size:900,direction:"rtl","before-close":F,title:"设备管理","header-class":"h-12 !mb-1"},{default:c(()=>[o("div",kr,[o("div",null,[o("div",Dr,[o("div",xr,[p[2]||(p[2]=o("h4",{class:"text-base font-semibold w-24"},"Agent设备",-1)),n(L,{type:"primary",plain:"",size:"small",onClick:U,loading:m.value},{default:c(()=>[m.value?Q("",!0):(v(),te(O,{key:0},{default:c(()=>[n(s(qe))]),_:1})),p[1]||(p[1]=o("span",{class:"ml-1"},"刷新",-1))]),_:1},8,["loading"])])]),be((v(),te(ce,{data:a.value,stripe:"",class:"w-full",height:200},{empty:c(()=>[...p[5]||(p[5]=[o("div",{class:"text-center text-gray-400 py-8"},"暂无设备，请等待设备注册",-1)])]),default:c(()=>[n(J,{prop:"name",label:"设备名称","min-width":"150"}),n(J,{label:"详情","min-width":"250"},{default:c(({row:j})=>[o("div",Fr,[o("div",_r,[p[3]||(p[3]=o("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"地址：",-1)),o("span",Pr,G(j.address),1)]),o("div",Sr,[p[4]||(p[4]=o("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"ID：",-1)),o("span",Tr,G(j.agent_id),1)])])]),_:1}),n(J,{label:"支持的操作","min-width":"100"},{default:c(({row:j})=>[(v(!0),E(De,null,Ae(j.actions,_=>(v(),te(ae,{key:_,size:"small",type:"info",class:"mr-1"},{default:c(()=>[q(G(_),1)]),_:2},1024))),128)),!j.actions||j.actions.length===0?(v(),E("span",Br,"无")):Q("",!0)]),_:1}),n(J,{label:"状态/心跳",width:"90"},{default:c(({row:j})=>[o("div",Er,[n(ae,{type:j.is_online?"success":"danger",size:"small"},{default:c(()=>[q(G(j.is_online?"在线":"离线"),1)]),_:2},1032,["type"]),o("span",Ar,G(j.last_heartbeat_ago)+"秒前 ",1)])]),_:1}),n(J,{label:"测试按钮",width:"180"},{default:c(({row:j})=>[o("div",Mr,[(v(),E(De,null,Ae(B,(_,H)=>o("div",{key:H,class:"flex gap-1 items-center"},[n(O,{class:"!w-4 !h-5"},{default:c(()=>[n(s(vl))]),_:1}),o("span",Nr,G(_.label),1),(v(!0),E(De,null,Ae(_.keys,(V,se)=>(v(),te(L,{key:se,size:"small",type:"primary",plain:"",onClick:ne=>M(j.agent_id,V),loading:j[`testing_${V}`],class:"flex-1"},{default:c(()=>[q(G(V),1)]),_:2},1032,["onClick","loading"]))),128))])),64))])]),_:1})]),_:1},8,["data"])),[[we,m.value]])]),o("div",null,[o("div",Lr,[o("div",Or,[p[7]||(p[7]=o("h4",{class:"text-base font-semibold w-24"},"小米设备",-1)),n(L,{type:"primary",plain:"",size:"small",onClick:ee,loading:l.value},{default:c(()=>[l.value?Q("",!0):(v(),te(O,{key:0},{default:c(()=>[n(s(qe))]),_:1})),p[6]||(p[6]=o("span",{class:"ml-1"},"扫描",-1))]),_:1},8,["loading"])])]),be((v(),te(ce,{data:i.value,stripe:"",class:"w-full",height:280},{empty:c(()=>[...p[12]||(p[12]=[o("div",{class:"text-center text-gray-400 py-8"},'暂无设备，点击"扫描设备"开始扫描',-1)])]),default:c(()=>[n(J,{prop:"name",label:"设备名称","min-width":"150"}),n(J,{label:"详情","min-width":"400"},{default:c(({row:j})=>[o("div",Ir,[o("div",Rr,[p[8]||(p[8]=o("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"ID：",-1)),o("span",zr,G(j.deviceID||"-"),1)]),o("div",Ur,[p[9]||(p[9]=o("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"地址：",-1)),o("span",Vr,G(j.mac||"-"),1),p[10]||(p[10]=o("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"DTD：",-1)),o("span",Kr,G(j.miotDID||"-"),1)])])]),_:1}),n(J,{label:"功能","min-width":"200"},{default:c(({row:j})=>[o("div",Gr,[o("div",jr,[p[11]||(p[11]=o("span",{class:"text-gray-600 inline-block w-11 flex-shrink-0"},"音量：",-1)),o("span",Wr,G(j.volume!==void 0?j.volume:"-"),1),n(L,{size:"small",type:"info",plain:"",circle:"",onClick:_=>de(j),loading:j._volumeRefreshing,disabled:j._volumeRefreshing||j._volumeChanging,title:"刷新音量",class:"p-0.5 !w-[17px] !h-[17px]"},{default:c(()=>[j._volumeRefreshing?Q("",!0):(v(),te(O,{key:0},{default:c(()=>[n(s(qe))]),_:1}))]),_:2},1032,["onClick","loading","disabled"]),n(L,{size:"small",class:"!w-8 !h-6",type:"danger",plain:"",onClick:_=>x(j),disabled:j._stopping,title:"停止播放"},{default:c(()=>[j._stopping?(v(),te(O,{key:0,class:"animate-spin"},{default:c(()=>[n(s(Qe))]),_:1})):(v(),E("span",Hr,"⏹"))]),_:2},1032,["onClick","disabled"])]),o("div",Yr,[n(Ie,{"model-value":j.volume??0,onInput:_=>j.volume=_,onChange:_=>R(j,_),min:5,max:100,step:1,disabled:j._volumeChanging||j._volumeRefreshing||j.volume===void 0,size:"small",class:"flex-1 max-w-[200px]"},null,8,["model-value","onInput","onChange","disabled"])])])]),_:1})]),_:1},8,["data"])),[[we,l.value]])]),o("div",null,[o("div",Jr,[o("div",qr,[p[14]||(p[14]=o("h4",{class:"text-base font-semibold w-24"},"DLNA设备",-1)),n(L,{type:"primary",plain:"",size:"small",onClick:I,loading:g.value},{default:c(()=>[g.value?Q("",!0):(v(),te(O,{key:0},{default:c(()=>[n(s(qe))]),_:1})),p[13]||(p[13]=o("span",{class:"ml-1"},"扫描",-1))]),_:1},8,["loading"])])]),be((v(),te(ce,{data:u.value,stripe:"",class:"w-full",height:280},{empty:c(()=>[...p[18]||(p[18]=[o("div",{class:"text-center text-gray-400 py-8"},'暂无设备，点击"扫描设备"开始扫描',-1)])]),default:c(()=>[n(J,{prop:"name",label:"设备名称","min-width":"150"}),n(J,{label:"详情","min-width":"400"},{default:c(({row:j})=>[o("div",Xr,[o("div",Qr,[p[15]||(p[15]=o("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"位置：",-1)),o("span",{class:"text-gray-800 flex-1 truncate",title:j.location},G(j.location||"-"),9,Zr)]),j.manufacturer||j.model_name?(v(),E("div",ed,[p[16]||(p[16]=o("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"型号：",-1)),o("span",td,G(j.manufacturer||"")+" "+G(j.model_name||""),1)])):Q("",!0)])]),_:1}),n(J,{label:"功能","min-width":"200"},{default:c(({row:j})=>[o("div",ld,[o("div",sd,[p[17]||(p[17]=o("span",{class:"text-gray-600 inline-block w-11 flex-shrink-0"},"音量：",-1)),o("span",nd,G(j.volume!==void 0?j.volume:"-"),1),n(L,{size:"small",type:"info",plain:"",circle:"",onClick:_=>y(j),loading:j._volumeRefreshing,disabled:j._volumeRefreshing||j._volumeChanging,title:"刷新音量",class:"p-0.5 !w-[17px] !h-[17px]"},{default:c(()=>[j._volumeRefreshing?Q("",!0):(v(),te(O,{key:0},{default:c(()=>[n(s(qe))]),_:1}))]),_:2},1032,["onClick","loading","disabled"]),n(L,{size:"small",class:"!w-8 !h-6",type:"danger",plain:"",onClick:_=>me(j),disabled:j._stopping,title:"停止播放"},{default:c(()=>[j._stopping?(v(),te(O,{key:0,class:"animate-spin"},{default:c(()=>[n(s(Qe))]),_:1})):(v(),E("span",ad,"⏹"))]),_:2},1032,["onClick","disabled"])]),o("div",od,[n(Ie,{"model-value":j.volume??0,onInput:_=>j.volume=_,onChange:_=>Y(j,_),min:5,max:100,step:1,disabled:j._volumeChanging||j._volumeRefreshing||j.volume===void 0,size:"small",class:"flex-1 max-w-[200px]"},null,8,["model-value","onInput","onChange","disabled"])])])]),_:1})]),_:1},8,["data"])),[[we,g.value]])])])]),_:1},8,["modelValue"])}}}),rd={class:"flex gap-4 h-[500px]"},dd={class:"w-64 flex flex-col border rounded p-3"},ud={class:"flex-1 overflow-y-auto space-y-2"},cd=["onClick"],fd={class:"text-sm flex-1 truncate"},pd={class:"text-xs text-gray-500 ml-2 whitespace-nowrap"},vd={key:0,class:"text-blue-600 font-medium"},md={key:1},gd={key:0,class:"text-xs text-gray-400 text-center py-2"},yd={class:"flex-1 flex flex-col border rounded p-3"},hd={key:0,class:"flex-1 overflow-y-auto"},bd={class:"mb-3"},wd={class:"space-y-1"},$d=["onClick"],Cd={class:"text-xs text-gray-500 whitespace-nowrap"},kd={key:0,class:"text-blue-600 font-medium"},Dd={key:1},xd={class:"border-t pt-3"},Fd={class:"flex items-center gap-2 py-1"},_d={class:"text-xs text-gray-500 whitespace-nowrap"},Pd={key:0,class:"text-blue-600 font-medium"},Sd={key:1},Td={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},Bd={class:"flex items-center justify-between"},Ed={class:"text-sm text-gray-500"},Ad={key:0},Md={class:"flex gap-2"},Nd=ke({__name:"PlaylistSelectDialog",props:{visible:{type:Boolean,default:!1},playlistCollection:{default:()=>[]},selectedFiles:{default:()=>[]},onCopy:{type:Function,default:void 0},onRemove:{type:Function,default:void 0}},emits:["update:visible"],setup(e,{emit:f}){const r=e,d=f,h=K(r.visible),i=K(null),l=K([]),u=K(!1),g=le(()=>r.playlistCollection.find(R=>R.id===i.value)||null),a=le(()=>l.value.length>0||u.value),m=R=>{const x=g.value;if(!x||!x.pre_lists||!Array.isArray(x.pre_lists)||x.pre_lists.length!==7)return 0;const S=x.pre_lists[R];return Array.isArray(S)?S.length:0},A=()=>{const R=g.value;return!R||!R.playlist?0:Array.isArray(R.playlist)?R.playlist.length:0},B=R=>{if(!R)return 0;const x=R.pre_lists&&Array.isArray(R.pre_lists)&&R.pre_lists.length===7?R.pre_lists.reduce((w,I)=>w+(Array.isArray(I)?I.length:0),0):0,S=Array.isArray(R.playlist)?R.playlist.length:0;return x+S},C=()=>!r.selectedFiles||r.selectedFiles.length===0?new Set:new Set(r.selectedFiles.map(R=>typeof R=="string"?R:R.uri||String(R))),t=R=>{if(!R||!r.selectedFiles||r.selectedFiles.length===0)return 0;const x=C();let S=0;return R.pre_lists&&Array.isArray(R.pre_lists)&&R.pre_lists.length===7&&R.pre_lists.forEach(w=>{Array.isArray(w)&&w.forEach(I=>{const y=I.uri||String(I);x.has(y)&&S++})}),Array.isArray(R.playlist)&&R.playlist.forEach(w=>{const I=w.uri||String(w);x.has(I)&&S++}),S},N=R=>{const x=g.value;if(!x||!r.selectedFiles||r.selectedFiles.length===0||!x.pre_lists||!Array.isArray(x.pre_lists)||x.pre_lists.length!==7)return 0;const S=x.pre_lists[R];if(!Array.isArray(S))return 0;const w=C();let I=0;return S.forEach(y=>{const Y=y.uri||String(y);w.has(Y)&&I++}),I},b=()=>{const R=g.value;if(!R||!r.selectedFiles||r.selectedFiles.length===0||!Array.isArray(R.playlist))return 0;const x=C();let S=0;return R.playlist.forEach(w=>{const I=w.uri||String(w);x.has(I)&&S++}),S},U=R=>{i.value=R,l.value=[],u.value=!1},M=R=>{const x=l.value.indexOf(R);x>-1?l.value.splice(x,1):l.value.push(R)},P=()=>{u.value=!u.value},D=async()=>{if(!g.value||!r.selectedFiles||r.selectedFiles.length===0||!a.value){z.warning("请选择播放列表和目标列表，并至少选中一个文件");return}try{const R=r.selectedFiles.map(I=>typeof I=="string"?I:I.uri||String(I)),x=l.value.length,S=u.value;let w="";if(x>0&&S)w=`${x}个前置文件列表和正式文件列表`;else if(x>0){const I=["周一","周二","周三","周四","周五","周六","周日"];w=`前置文件列表（${l.value.map(Y=>I[Y]).join("、")}）`}else S&&(w="正式文件列表");await Ee.confirm(`确定要将选中的 ${R.length} 个文件复制到播放列表"${g.value.name}"的${w}吗？`,"确认复制",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),r.onCopy&&(await r.onCopy({playlistId:i.value,files:R,preLists:l.value,filesList:u.value}),z.success("文件已复制到播放列表"),ee())}catch(R){R!=="cancel"&&re(R,"复制文件失败")}},T=async()=>{if(!g.value||!r.selectedFiles||r.selectedFiles.length===0||!a.value){z.warning("请选择播放列表和目标列表，并至少选中一个文件");return}try{const R=r.selectedFiles.map(I=>typeof I=="string"?I:I.uri||String(I)),x=l.value.length,S=u.value;let w="";if(x>0&&S)w=`${x}个前置文件列表和正式文件列表`;else if(x>0){const I=["周一","周二","周三","周四","周五","周六","周日"];w=`前置文件列表（${l.value.map(Y=>I[Y]).join("、")}）`}else S&&(w="正式文件列表");await Ee.confirm(`确定要从播放列表"${g.value.name}"的${w}中删除选中的 ${R.length} 个文件吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),r.onRemove&&(await r.onRemove({playlistId:i.value,files:R,preLists:l.value,filesList:u.value}),z.success("文件已从播放列表删除"),ee())}catch(R){R!=="cancel"&&re(R,"删除文件失败")}},ee=()=>{h.value=!1,i.value=null,l.value=[],u.value=!1},de=()=>{r.playlistCollection&&r.playlistCollection.length>0&&!i.value&&(i.value=r.playlistCollection[0].id)};return Ne(()=>r.playlistCollection,R=>{R&&R.length>0&&!i.value&&(i.value=R[0].id)},{immediate:!0}),Ne(()=>r.visible,R=>{h.value=R,R&&de()}),Ne(h,R=>{R!==r.visible&&d("update:visible",R)}),nt(()=>{de()}),(R,x)=>{const S=Dt,w=ze,I=ut;return v(),te(I,{modelValue:h.value,"onUpdate:modelValue":x[1]||(x[1]=y=>h.value=y),title:"应用到列表",width:"900","before-close":ee},{footer:c(()=>[o("div",Bd,[o("div",Ed,[e.selectedFiles&&e.selectedFiles.length>0?(v(),E("span",Ad," 已选择 "+G(e.selectedFiles.length)+" 个文件 ",1)):Q("",!0)]),o("div",Md,[n(w,{onClick:ee},{default:c(()=>[...x[7]||(x[7]=[q("取消",-1)])]),_:1}),n(w,{type:"primary",onClick:D,disabled:!a.value||!e.selectedFiles||e.selectedFiles.length===0},{default:c(()=>[...x[8]||(x[8]=[q(" 复制到列表 ",-1)])]),_:1},8,["disabled"]),n(w,{type:"danger",onClick:T,disabled:!a.value||!e.selectedFiles||e.selectedFiles.length===0},{default:c(()=>[...x[9]||(x[9]=[q(" 从列表删除 ",-1)])]),_:1},8,["disabled"])])])]),default:c(()=>[o("div",rd,[o("div",dd,[x[2]||(x[2]=o("div",{class:"text-sm font-semibold mb-2"},"选择播放列表",-1)),o("div",ud,[(v(!0),E(De,null,Ae(e.playlistCollection,y=>(v(),E("div",{key:y.id,class:oe(["flex items-center justify-between px-2 py-2 rounded cursor-pointer hover:bg-gray-50 transition-colors",{"bg-blue-50 border border-blue-200":y.id===i.value}]),onClick:Y=>U(y.id)},[o("span",fd,G(y.name),1),o("span",pd,[e.selectedFiles&&e.selectedFiles.length>0?(v(),E("span",vd,G(t(y))+"/"+G(B(y)),1)):(v(),E("span",md,G(B(y)),1))])],10,cd))),128)),e.playlistCollection.length===0?(v(),E("div",gd," 暂无播放列表 ")):Q("",!0)])]),o("div",yd,[x[6]||(x[6]=o("div",{class:"text-sm font-semibold mb-3"},"选择目标列表（可多选）",-1)),g.value?(v(),E("div",hd,[o("div",bd,[x[4]||(x[4]=o("div",{class:"text-xs text-gray-600 mb-2 font-semibold"},"前置文件",-1)),o("div",wd,[(v(),E(De,null,Ae(["周一","周二","周三","周四","周五","周六","周日"],(y,Y)=>o("div",{key:Y,class:"flex items-center gap-2 py-1"},[n(S,{"model-value":l.value.includes(Y),onChange:me=>M(Y),size:"small"},null,8,["model-value","onChange"]),o("span",{class:oe(["text-xs flex-1 cursor-pointer hover:text-blue-500",{"text-blue-600 font-medium":l.value.includes(Y)}]),onClick:me=>M(Y)},G(y),11,$d),o("span",Cd,[e.selectedFiles&&e.selectedFiles.length>0?(v(),E("span",kd,G(N(Y))+"/"+G(m(Y)),1)):(v(),E("span",Dd,G(m(Y)),1)),x[3]||(x[3]=o("span",{class:"text-gray-400"}," 个文件",-1))])])),64))])]),o("div",xd,[o("div",Fd,[n(S,{"model-value":u.value,onChange:P,size:"small"},null,8,["model-value"]),o("span",{class:oe(["text-xs font-semibold text-gray-600 cursor-pointer hover:text-blue-500 flex-1",{"text-blue-600":u.value}]),onClick:x[0]||(x[0]=y=>P())}," 正式文件 ",2),o("span",_d,[e.selectedFiles&&e.selectedFiles.length>0?(v(),E("span",Pd,G(b())+"/"+G(A()),1)):(v(),E("span",Sd,G(A()),1)),x[5]||(x[5]=o("span",{class:"text-gray-400"}," 个文件",-1))])])])])):(v(),E("div",Td," 请先选择一个播放列表 "))])])]),_:1},8,["modelValue"])}}}),Ld={class:"flex gap-4 h-full"},Od={class:"w-64 border rounded p-3 flex flex-col"},Id={class:"flex items-center justify-between mb-3"},Rd={class:"flex-1 overflow-y-auto space-y-2"},zd=["onClick"],Ud={class:"text-sm font-medium truncate"},Vd={class:"text-xs text-gray-500 mt-1"},Kd={class:"flex items-center gap-1 flex-shrink-0"},Gd={key:0,class:"text-sm text-gray-400 text-center py-4"},jd={class:"flex-1 border rounded p-3 flex flex-col"},Wd={class:"mb-3 flex items-center justify-between"},Hd={class:"flex items-center gap-2"},Yd={class:"text-base font-semibold"},Jd={key:0,class:"flex items-center gap-2"},qd={class:"flex-1 overflow-y-auto"},Xd={key:0,class:"space-y-1"},Qd=["onClick"],Zd={class:"text-xs text-gray-500 w-8"},eu=["title"],tu={key:1,class:"text-sm text-gray-400 text-center py-8"},lu={class:"w-96 border rounded p-3 flex flex-col"},su={class:"mb-3"},nu={class:"flex gap-2 mb-3"},au={class:"mb-3"},ou={class:"space-y-1 max-h-48 overflow-y-auto border rounded p-1"},iu=["onClick"],ru={class:"text-sm flex-1"},du={class:"text-xs text-gray-500 ml-2 whitespace-nowrap"},uu={key:0,class:"text-xs text-gray-400 text-center py-2"},cu={key:0,class:"flex-1 overflow-y-auto space-y-3"},fu={class:"border rounded p-2"},pu={class:"space-y-1"},vu=["onClick"],mu={class:"text-xs text-gray-500 whitespace-nowrap"},gu={class:"border rounded p-2"},yu={class:"flex items-center gap-2 mb-2"},hu={class:"text-xs text-gray-500 whitespace-nowrap"},bu={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},ol="t_batch_list",il="0",wu=7,$u=ke({__name:"BatchDrawer",props:{visible:{type:Boolean,default:!1},playlistCollection:{default:()=>[]},onAddFiles:{type:Function,default:void 0},onRemoveFiles:{type:Function,default:void 0}},emits:["update:visible","refresh"],setup(e,{emit:f}){const r=e,d=f,h=K([]),i=K(null),l=K(null),u=K([]),g=K(!1),a=K([]),m=K(!1),A=K(!1),B=K(!1),C=K(r.visible),t=le(()=>h.value.find(k=>k.id===i.value)||null),N=le(()=>r.playlistCollection.find(k=>k.id===l.value)||null),b=le(()=>u.value.length>0||g.value),U=k=>typeof k=="string"?k:k?.uri||String(k),M=()=>t.value?.files?a.value.map(k=>t.value.files[k]).filter(k=>k!==null):[],P=()=>new Set(M().map(U)),D=k=>!!(k?.pre_lists&&Array.isArray(k.pre_lists)&&k.pre_lists.length===wu),T=k=>!!(k?.playlist&&Array.isArray(k.playlist)),ee=(k,W)=>{if(!Array.isArray(k))return 0;let X=0;return k.forEach(ve=>{W.has(U(ve))&&X++}),X},de=k=>{const W=N.value;if(!D(W))return 0;const X=W.pre_lists[k];return Array.isArray(X)?X.length:0},R=k=>{if(!t.value||!N.value)return 0;const W=P();if(W.size===0)return 0;const X=N.value;if(!D(X))return 0;const ve=X.pre_lists[k];return ee(ve,W)},x=()=>{const k=N.value;return T(k)?k.playlist.length:0},S=()=>{if(!t.value||!N.value)return 0;const k=P();if(k.size===0)return 0;const W=N.value;return T(W)?ee(W.playlist,k):0},w=k=>{if(!k)return 0;let W=0;return D(k)&&k.pre_lists.forEach(X=>{Array.isArray(X)&&(W+=X.length)}),T(k)&&(W+=k.playlist.length),W},I=k=>{if(!t.value||!k)return 0;const W=P();if(W.size===0)return 0;let X=0;return D(k)&&k.pre_lists.forEach(ve=>{X+=ee(ve,W)}),T(k)&&(X+=ee(k.playlist,W)),X},y=async()=>{try{B.value=!0;const k=await In(ol,il);let W=[];if(k!=null)if(typeof k=="string"&&k.trim()!=="")try{const X=JSON.parse(k);W=Array.isArray(X)?X:[]}catch{W=[]}else Array.isArray(k)&&(W=k);h.value=W,me()}catch(k){h.value=[],re(k,"加载Batch列表失败")}finally{B.value=!1}},Y=async()=>{try{const k=JSON.stringify(h.value);await Rn(ol,il,k)}catch(k){throw re(k,"保存Batch列表失败"),k}},me=()=>{if(h.value.length===0||i.value)return;const k=h.value[0];i.value=k.id,k?.files?.length>0&&(a.value=k.files.map((W,X)=>X))},F=(k,W)=>{const X=k.indexOf(W);X>-1?k.splice(X,1):k.push(W)},$=async()=>{try{const{value:k}=await Ee.prompt("请输入Batch名称","创建Batch",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:"Batch名称",inputValidator:ve=>!!ve&&ve.trim().length>0||"名称不能为空"}),W=k.trim(),X={id:Date.now().toString(),name:W,files:[],createTime:new Date().toISOString()};h.value.push(X),await Y(),z.success("Batch创建成功"),i.value=X.id}catch(k){k!=="cancel"&&re(k,"创建Batch失败")}},p=async k=>{const W=h.value.find(X=>X.id===k);if(W)try{const{value:X}=await Ee.prompt("请输入Batch名称","编辑Batch",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:W.name,inputPlaceholder:"Batch名称",inputValidator:ve=>!!ve&&ve.trim().length>0||"名称不能为空"});W.name=X.trim(),await Y(),z.success("Batch名称已更新")}catch(X){X!=="cancel"&&re(X,"编辑Batch失败")}},O=async k=>{const W=h.value.find(X=>X.id===k);if(W)try{await Ee.confirm(`确定要删除Batch "${W.name}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const X=h.value.findIndex(ve=>ve.id===k);X>-1&&(h.value.splice(X,1),await Y(),i.value===k&&(i.value=null),z.success("Batch已删除"))}catch(X){X!=="cancel"&&re(X,"删除Batch失败")}},L=k=>{i.value=k;const W=h.value.find(X=>X.id===k);W&&W.files&&W.files.length>0?a.value=W.files.map((X,ve)=>ve):a.value=[]},J=k=>{F(a.value,k)},ae=async()=>{if(!(!t.value||a.value.length===0))try{const k=a.value.length;await Ee.confirm(`确定要删除选中的 ${k} 个文件吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),[...new Set(a.value)].sort((X,ve)=>ve-X).forEach(X=>{X>=0&&X<t.value.files.length&&t.value.files.splice(X,1)}),t.value.files.length>0?a.value=t.value.files.map((X,ve)=>ve):a.value=[],await Y(),z.success(`已删除 ${k} 个文件`)}catch(k){k!=="cancel"&&re(k,"删除失败")}},ce=()=>{if(!t.value){z.warning("请先选择一个Batch");return}m.value=!0},Ie=async k=>{if(!(!t.value||k.length===0))try{A.value=!0;const W=t.value,X=new Set(W.files.map(U)),ve=k.filter(Ge=>!X.has(Ge)).map(Ge=>({uri:Ge}));W.files.push(...ve),await Y(),W.files.length>0&&(a.value=W.files.map((Ge,at)=>at)),z.success(`成功添加 ${ve.length} 个文件`),m.value=!1}catch(W){re(W,"添加文件失败")}finally{A.value=!1}},Fe=()=>{m.value=!1},we=k=>{l.value=l.value===k?null:k,u.value=[],g.value=!1},j=k=>{F(u.value,k)},_=k=>{g.value=k!==void 0?k:!g.value},H=()=>!t.value||!l.value||a.value.length===0||!b.value?(z.warning("请选择Batch、播放列表和目标列表，并至少选中一个文件"),!1):!0,V=async()=>{if(H())try{const k=M().map(U);await Ee.confirm(`确定要将选中的 ${k.length} 个文件添加到选中的列表吗？`,"确认添加",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),r.onAddFiles&&(await r.onAddFiles({playlistId:l.value,files:k,preLists:u.value,filesList:g.value}),z.success("文件已添加到播放列表"))}catch(k){k!=="cancel"&&re(k,"添加文件失败")}},se=async()=>{if(H())try{const k=M().map(U);await Ee.confirm(`确定要从选中的列表中删除选中的 ${k.length} 个文件吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),r.onRemoveFiles&&(await r.onRemoveFiles({playlistId:l.value,files:k,preLists:u.value,filesList:g.value}),z.success("文件已从播放列表删除"))}catch(k){k!=="cancel"&&re(k,"删除文件失败")}},ne=()=>{C.value=!1},Z=()=>{u.value=[],g.value=!1,a.value=[]},ue=()=>{i.value=null,l.value=null,Z()},ye=()=>{r.playlistCollection?.length>0?l.value=r.playlistCollection[0].id:l.value=null};return Ne(()=>r.playlistCollection,k=>{k?.length>0&&!l.value&&(l.value=k[0].id)},{immediate:!0}),Ne(()=>r.visible,k=>{C.value=k,k?(Z(),ye(),y()):ue()},{immediate:!0}),Ne(C,k=>{k!==r.visible&&d("update:visible",k)}),nt(()=>{y()}),(k,W)=>{const X=Be,ve=ze,Ge=Dt,at=Fl;return v(),te(at,{modelValue:C.value,"onUpdate:modelValue":W[4]||(W[4]=he=>C.value=he),title:"批量模式",size:1200,direction:"rtl","before-close":ne},{default:c(()=>[o("div",Ld,[o("div",Od,[o("div",Id,[W[5]||(W[5]=o("h3",{class:"text-base font-semibold"},"Batch列表",-1)),n(ve,{type:"primary",size:"small",onClick:$,plain:""},{default:c(()=>[n(X,null,{default:c(()=>[n(s(ht))]),_:1})]),_:1})]),o("div",Rd,[(v(!0),E(De,null,Ae(h.value,he=>(v(),E("div",{key:he.id,class:oe(["border rounded px-3 py-2 hover:bg-gray-50 flex items-center gap-2",{"border-blue-500 bg-blue-50":he.id===i.value}])},[o("div",{class:"flex-1 cursor-pointer",onClick:Se=>L(he.id)},[o("div",Ud,G(he.name),1),o("div",Vd,G(he.files?he.files.length:0)+" 个文件 ",1)],8,zd),o("div",Kd,[n(ve,{type:"default",plain:"",size:"small",circle:"",onClick:ge(Se=>O(he.id),["stop"]),title:"删除"},{default:c(()=>[n(X,null,{default:c(()=>[n(s(je))]),_:1})]),_:1},8,["onClick"])])],2))),128)),h.value.length===0?(v(),E("div",Gd,' 暂无Batch，点击"+"创建 ')):Q("",!0)])]),o("div",jd,[o("div",Wd,[o("div",Hd,[o("h3",Yd,G(t.value?t.value.name:"请选择一个Batch"),1),t.value?(v(),te(ve,{key:0,type:"default",plain:"",size:"small",circle:"",onClick:W[0]||(W[0]=he=>p(t.value.id)),title:"编辑"},{default:c(()=>[n(X,null,{default:c(()=>[n(s(yl))]),_:1})]),_:1})):Q("",!0)]),t.value?(v(),E("div",Jd,[n(ve,{type:"primary",size:"small",onClick:ce,plain:""},{default:c(()=>[n(X,null,{default:c(()=>[n(s(ht))]),_:1})]),_:1}),n(ve,{type:"danger",size:"small",onClick:ae,disabled:a.value.length===0,plain:""},{default:c(()=>[n(X,null,{default:c(()=>[n(s(je))]),_:1}),q(" ("+G(a.value.length)+") ",1)]),_:1},8,["disabled"])])):Q("",!0)]),o("div",qd,[t.value&&t.value.files&&t.value.files.length>0?(v(),E("div",Xd,[(v(!0),E(De,null,Ae(t.value.files,(he,Se)=>(v(),E("div",{key:Se,class:oe(["flex items-center gap-2 p-2 border border-blue-500 rounded hover:bg-gray-50 cursor-pointer",{"bg-blue-50":a.value.includes(Se)}]),onClick:ot=>J(Se)},[n(Ge,{"model-value":a.value.includes(Se),onChange:ot=>J(Se),class:"!h-6",onClick:W[1]||(W[1]=ge(()=>{},["stop"])),size:"default"},null,8,["model-value","onChange"]),o("span",Zd,G(Se+1),1),o("span",{class:"flex-1 text-sm truncate",title:U(he)},G(U(he).split("/").pop()),9,eu)],10,Qd))),128))])):(v(),E("div",tu,G(t.value?"该Batch暂无文件":"请先选择一个Batch"),1))])]),o("div",lu,[o("div",su,[W[9]||(W[9]=o("h3",{class:"text-base font-semibold mb-2"},"Playlist操作",-1)),o("div",nu,[n(ve,{type:"default",size:"small",onClick:V,disabled:!t.value||!l.value||a.value.length===0||!b.value,plain:""},{default:c(()=>[n(X,{class:"mr-1"},{default:c(()=>[n(s(ht))]),_:1}),W[6]||(W[6]=q(" 添加到播放列表 ",-1))]),_:1},8,["disabled"]),n(ve,{type:"default",size:"small",onClick:se,disabled:!t.value||!l.value||a.value.length===0||!b.value,plain:""},{default:c(()=>[n(X,{class:"mr-1"},{default:c(()=>[n(s(je))]),_:1}),W[7]||(W[7]=q(" 从播放列表删除 ",-1))]),_:1},8,["disabled"])]),o("div",au,[W[8]||(W[8]=o("div",{class:"text-xs text-gray-500 mb-2"},"选择播放列表 进行批量操作",-1)),o("div",ou,[(v(!0),E(De,null,Ae(e.playlistCollection,he=>(v(),E("div",{key:he.id,class:oe(["flex items-center justify-between px-2 py-1.5 rounded cursor-pointer hover:bg-gray-50 transition-colors",{"bg-blue-50 border border-blue-200":he.id===l.value}]),onClick:Se=>we(he.id)},[o("span",ru,G(he.name),1),o("span",du,G(I(he))+" / "+G(w(he)),1)],10,iu))),128)),e.playlistCollection.length===0?(v(),E("div",uu," 暂无播放列表 ")):Q("",!0)])])]),N.value?(v(),E("div",cu,[o("div",fu,[W[10]||(W[10]=o("div",{class:"text-xs font-semibold text-gray-600 mb-2"},"前置文件",-1)),o("div",pu,[(v(),E(De,null,Ae(["周一","周二","周三","周四","周五","周六","周日"],(he,Se)=>o("div",{key:Se,class:"flex items-center gap-2"},[n(Ge,{"model-value":u.value.includes(Se),onChange:ot=>j(Se),size:"small"},null,8,["model-value","onChange"]),o("span",{class:oe(["text-xs flex-1 cursor-pointer hover:text-blue-500",{"text-blue-600 font-medium":u.value.includes(Se)}]),onClick:ot=>j(Se)},G(he),11,vu),o("span",mu,G(R(Se))+" / "+G(de(Se)),1)])),64))])]),o("div",gu,[o("div",yu,[n(Ge,{"model-value":g.value,onChange:_,size:"small"},null,8,["model-value"]),o("span",{class:oe(["text-xs font-semibold text-gray-600 cursor-pointer hover:text-blue-500 flex-1",{"text-blue-600":g.value}]),onClick:W[2]||(W[2]=he=>_())}," 正式文件 ",2),o("span",hu,G(S())+" / "+G(x()),1)])])])):(v(),E("div",bu," 请先选择一个播放列表 "))])]),n(Cl,{visible:m.value,"onUpdate:visible":W[3]||(W[3]=he=>m.value=he),title:"选择文件添加到Batch","confirm-button-text":"添加","confirm-loading":A.value,onConfirm:Ie,onClose:Fe},null,8,["visible","confirm-loading"])]),_:1},8,["modelValue"])}}});function Cu(){return{...{playlistCollection:K([]),activePlaylistId:K(""),playlistStatus:K(null),playlistLoading:K(!1),playlistRefreshing:K(!1),playing:K(!1),stopping:K(!1),showMoreActions:K(!1),editingPlaylistId:K(null),editingPlaylistName:K(""),fileBrowserDialogVisible:K(!1),fileBrowserTarget:K("files"),replaceFileInfo:K(null),selectedWeekdayIndex:K(null),preFilesDragMode:K(!1),filesDragMode:K(!1),preFilesBatchDeleteMode:K(!1),filesBatchDeleteMode:K(!1),selectedPreFileIndices:K([]),selectedFileIndices:K([]),preFilesExpanded:K(!1),playlistSelectorVisible:K(!1),playlistSelectorSelectedFiles:K([]),batchDrawerVisible:K(!1),cronBuilderVisible:K(!1),cronPreviewVisible:K(!1),cronPreviewTimes:K([]),initialCronExpr:K(""),agentListDialogVisible:K(!1),scanDialogVisible:K(!1),loading:K(!1),deviceList:K([]),connectedDeviceList:K([]),dlnaDeviceList:K([]),dlnaScanning:K(!1),miDeviceList:K([]),miScanning:K(!1),pendingDeviceType:K(null),preFilesSortOrder:K(null),filesSortOrder:K(null),preFilesOriginalOrder:K(null),filesOriginalOrder:K(null)}}}async function We(e,f,r={}){let d;return f==="GET"?d=await Te.get(`/playlist/${e}`,{params:r}):d=await Te.post(`/playlist/${e}`,r),d.data}function ku(e,f,r,d,h,i,l,u){const g=F=>F.map($=>({...$})),a=F=>{const $="playlist"in F&&Array.isArray(F.playlist)&&F.playlist||"files"in F&&Array.isArray(F.files)&&F.files||[];return g(pt($,!0))},m=F=>{if(F.pre_lists&&Array.isArray(F.pre_lists)&&F.pre_lists.length===vt)return F.pre_lists.map(O=>g(pt(O||[],!0)));const $="pre_files"in F&&Array.isArray(F.pre_files)&&F.pre_files||[],p=g(pt($,!0));return Array(vt).fill(null).map(()=>[...p])},A=F=>Bi.includes(F)?F:Ei,B=F=>({enabled:F?.enabled===1?1:0,cron:F?.cron?String(F.cron):"",duration:F?.duration||0}),C=(F,$)=>{if(typeof F=="number")return F;if(F==null)return $;const p=parseInt(String(F),10);return isNaN(p)?$:p},t=F=>F===!0||F===1,N=(F,$)=>{if($===0)return 0;const p=C(F,0);return Math.max(0,Math.min(p,$-1))},b=()=>Array(vt).fill(null).map(()=>[]),U=F=>Array.isArray(F)&&F.length===vt&&F.every($=>Array.isArray($)),M=(F,$="播放列表")=>{const p=a(F),O=m(F),L=N(F?.current_index,p.length),J=F?.name&&String(F.name).trim()||$,ae=A(F?.device?.type||F?.device_type),ce=F?.device_address||F?.device?.address||null;return{id:F?.id||eo(),name:J,playlist:p,pre_lists:O,total:p.length,current_index:L,pre_index:C(F?.pre_index,-1),device_address:ce,device_type:ae,device:F?.device||{type:ae,address:ce,name:F?.device?.name||null},schedule:B(F?.schedule),trigger_button:F?.trigger_button||"",updatedAt:"updatedAt"in F&&typeof F.updatedAt=="number"?F.updatedAt:Date.now(),isPlaying:t(F?.isPlaying)}},P=F=>!Array.isArray(F)||F.length===0?[M({name:Ye})]:F.map(($,p)=>"playlist"in $&&"total"in $?$:M($,$?.name||`播放列表${p+1}`)),D=F=>{if(F&&"playlists"in F&&Array.isArray(F.playlists)){const p=F,O=P(p.playlists),L=O.some(J=>J.id===p.activePlaylistId)?p.activePlaylistId:O[0]?.id||null;return{playlists:O,activePlaylistId:L}}if(F&&!Array.isArray(F)&&("playlist"in F||"files"in F)){const p=F,O="playlist"in p&&Array.isArray(p.playlist)&&p.playlist||"files"in p&&Array.isArray(p.files)&&p.files||[],L=M({id:p.id||p.playlist_id,name:p.name||Ye,files:O,current_index:p.current_index,device_address:p.device_address});return{playlists:[L],activePlaylistId:L.id}}const $=M({name:Ye});return{playlists:[$],activePlaylistId:$.id}},T=F=>{if(!F)return null;if(!Array.isArray(F)&&Object.keys(F).length>0){const $=Object.values(F).map(p=>M(p,p.name||Ye));return{playlists:$,activePlaylistId:$[0]?.id||null}}if(Array.isArray(F)){const $=F.map(p=>M(p,p.name||Ye));return{playlists:$,activePlaylistId:$[0]?.id||null}}if(!Array.isArray(F)&&"id"in F&&typeof F.id=="string"){const $=F;return{playlists:[M($,$.name||Ye)],activePlaylistId:$.id}}return null},ee=F=>{const $={};return F.forEach(p=>{if(!p.id)return;const O=A(p.device?.type||p.device_type),L=pt(p.playlist||[],!0),J=m(p);$[p.id]={id:p.id,name:p.name||Ye,files:L,pre_lists:J,current_index:p.current_index||0,device:{address:p.device?.address||p.device_address||"",type:O,name:p.device?.name||null},schedule:p.schedule||{enabled:0,cron:"",duration:0},trigger_button:p.trigger_button||"",create_time:p.create_time||el(),updated_time:el()}}),$},de=async F=>{try{const $=(F||e.value||[]).map(L=>({...L,total:Array.isArray(L.playlist)?L.playlist.length:0,updatedAt:Date.now()})),p=ee($),O=await We("updateAll","POST",p);if(O.code!==0)throw new Error(O.msg||"保存播放列表集合失败")}catch($){re($,"保存播放列表集合失败")}},R=async F=>{try{const p=ee([F])[F.id];if(!p)throw new Error("播放列表数据格式错误");const O=await We("update","POST",p);if(O.code!==0)throw new Error(O.msg||"更新播放列表失败");return!0}catch($){return re($,"更新播放列表失败"),!1}},x=F=>{const $=Array.isArray(F)?F:e.value;if(!$||$.length===0){r.value=null,f.value="";return}const p=$.find(J=>J.id===f.value)||$[0];f.value=p.id;const O=N(p.current_index,p.playlist?.length||0),L=U(p.pre_lists)?p.pre_lists.map(J=>[...J||[]]):b();r.value={...p,playlist:[...p.playlist||[]],pre_lists:L,current_index:O,pre_index:C(p.pre_index,-1),in_pre_files:!1,isPlaying:t(p.isPlaying)}},S=F=>({...F,playlist:F.playlist.map($=>({...$})),pre_lists:U(F.pre_lists)?F.pre_lists.map($=>$.map(p=>({...p}))):b()}),w=async F=>{if(typeof F!="function")return null;let $=e.value.length>0?e.value.map(S):[M({name:Ye})],p=$.findIndex(ae=>ae.id===f.value);p===-1&&(p=0,f.value=$[0].id);const O=$[p],L=F(S(O))||O,J=M(L,O.name);return U(J.pre_lists)||(J.pre_lists=U(O.pre_lists)?O.pre_lists.map(ae=>ae.map(ce=>({...ce}))):b()),$[p]=J,e.value=$,await R($[p]),x($),r.value},I=(F,$)=>{const p=localStorage.getItem(Ol);p&&F.some(O=>O.id===p)?f.value=p:f.value=$||""},y=async()=>{try{const F=await We("get","GET",{});if(F.code!==0)throw new Error(F.msg||"获取播放列表失败");const $=T(F.data),p=D($||null);return e.value=p.playlists,I(p.playlists,p.activePlaylistId),x(p.playlists),p}catch(F){dt.error("从接口加载播放列表失败:",F);const $=D(null);return e.value=$.playlists,I($.playlists,$.activePlaylistId),x($.playlists),$}},Y=F=>F?!!(h.value!==null||i.value||l.value):!1;return{normalizePlaylistItem:M,normalizePlaylistCollection:D,transformApiDataToPlaylistFormat:T,transformPlaylistToApiFormat:ee,savePlaylist:de,updateSinglePlaylist:R,syncActivePlaylist:x,updateActivePlaylistData:w,loadPlaylist:y,refreshPlaylistStatus:async(F=!1,$=!1)=>{try{if(Y($))return;if(d.value=!0,F){const p=f.value;if(!p)return;const O=await We("get","GET",{id:p});if(O.code!==0)throw new Error(O.msg||"获取播放列表状态失败");const L=T(O.data);if(!L?.playlists?.length)return;const J=L.playlists[0],ae=e.value.map(ce=>ce.id!==p?ce:{...ce,...J,playlist:J.playlist||ce.playlist,pre_lists:U(J.pre_lists)?J.pre_lists.map(Ie=>[...Ie||[]]):ce.pre_lists,current_index:J.current_index!==void 0?J.current_index:ce.current_index,isPlaying:t(J?.isPlaying)});e.value=ae,x(ae)}else await y()}catch(p){dt.error("刷新播放列表状态失败:",p)}finally{d.value=!1}}}}function Du(e,f,r,d,h,i,l,u,g){return{loadPlaylist:async()=>{try{const M=await We("get","GET",{});if(M.code!==0)throw new Error(M.msg||"获取播放列表失败");return M.data}catch(M){throw dt.error("从接口加载播放列表失败:",M),M}},handleSelectPlaylist:async M=>{!M||M===f.value||!e.value.find(D=>D.id===M)||(f.value=M,localStorage.setItem(Ol,M),i(e.value))},handleCreatePlaylist:async()=>{try{const M=`播放列表${e.value.length+1}`,{value:P}=await Ee.prompt("请输入播放列表名称","新建播放列表",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:M,inputPlaceholder:M,inputValidator:T=>!!T&&T.trim().length>0||"名称不能为空"});return{name:(P||M).trim()}}catch(M){if(M!=="cancel")throw M;return null}},handleCopyPlaylist:async M=>{if(!M)return null;const P=e.value.find(D=>D.id===M);if(!P)return null;try{const D=`${P.name}_副本`,{value:T}=await Ee.prompt("请输入播放列表名称","复制播放列表",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:D,inputPlaceholder:D,inputValidator:de=>!!de&&de.trim().length>0||"名称不能为空"}),ee=(T||D).trim();return{sourcePlaylist:P,name:ee}}catch(D){if(D!=="cancel")throw D;return null}},handleDeletePlaylistGroup:async M=>{if(!M)return!1;if(e.value.length<=1)return z.warning("至少保留一个播放列表"),!1;const P=e.value.find(D=>D.id===M);if(!P)return!1;try{return await Ee.confirm(`确认删除播放列表"${P.name}"吗？`,"删除播放列表",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),!0}catch(D){if(D!=="cancel")throw D;return!1}},handlePlayPlaylist:async()=>{const M=r.value;if(!M||!M.id){z.warning("播放列表不存在");return}if(!M.playlist||M.playlist.length===0){z.warning("播放列表为空，请先添加文件");return}try{d.value=!0,await l(D=>{const T=Array.isArray(D.playlist)?D.playlist:[];return D.current_index=Math.max(0,Math.min(D.current_index||0,T.length-1)),D.total=T.length,D});const P=await We("play","POST",{id:M.id});if(P.code!==0)throw new Error(P.msg||"播放失败");await u(!0),z.success("开始播放")}catch(P){re(P,"播放失败")}finally{d.value=!1}},handlePlayNext:async()=>{const M=r.value;if(!M||!M.id){z.warning("播放列表不存在");return}if(!M.playlist||M.playlist.length===0){z.warning("播放列表为空，无法播放下一首");return}try{d.value=!0;const P=await We("playNext","POST",{id:M.id});if(P.code!==0)throw new Error(P.msg||"播放下一首失败");await u(!0),z.success("已切换到下一首")}catch(P){re(P,"播放下一首失败")}finally{d.value=!1}},handlePlayPre:async()=>{const M=r.value;if(!M||!M.id){z.warning("播放列表不存在");return}const P=g().length>0,D=M.playlist&&M.playlist.length>0;if(!P&&!D){z.warning("播放列表为空，无法播放上一首");return}try{d.value=!0;const T=await We("playPre","POST",{id:M.id});if(T.code!==0)throw new Error(T.msg||"播放上一首失败");await u(!0),z.success("已切换到上一首")}catch(T){re(T,"播放上一首失败")}finally{d.value=!1}},handleStopPlaylist:async()=>{const M=r.value;if(!M||!M.id){z.warning("播放列表不存在");return}try{h.value=!0;const P=await We("stop","POST",{id:M.id});if(P.code!==0)throw new Error(P.msg||"停止播放失败");await u(!0),z.success("已停止播放")}catch(P){re(P,"停止播放列表失败")}finally{h.value=!1}}}}function xu(e,f,r,d,h,i){const l=()=>{const N=e.value?.schedule?.cron||"";h.value=N,f.value=!0},u=()=>{f.value=!1},g=N=>{N&&(e.value?(A(N),z.success("Cron 表达式已应用到当前播放列表")):z.warning("请先选择一个播放列表"))},a=N=>{d.value=N,r.value=!0},m=async N=>{e.value&&await i(b=>(b.schedule||(b.schedule={enabled:0,cron:"",duration:0}),b.schedule.enabled=N?1:0,b))},A=async N=>{e.value&&await i(b=>(b.schedule||(b.schedule={enabled:0,cron:"",duration:0}),b.schedule.cron=N,b))};return{handleOpenCronBuilder:l,handleCloseCronBuilder:u,handleCronBuilderApply:g,handleCronBuilderPreview:a,handleTogglePlaylistCronEnabled:m,handleUpdatePlaylistCron:A,handleUpdatePlaylistDuration:async N=>{e.value&&await i(b=>(b.schedule||(b.schedule={enabled:0,cron:"",duration:0}),b.schedule.duration=N||0,b))},handleUpdateTriggerButton:async N=>{e.value&&await i(b=>(b.trigger_button=N||"",b))},handlePreviewPlaylistCron:()=>{if(!e.value||!e.value.schedule?.cron){z.warning("请先设置 Cron 表达式");return}try{const N=e.value.schedule.cron,b=Yt(N,5);b&&b.length>0?(d.value=b,r.value=!0):z.warning("无法解析 Cron 表达式")}catch(N){re(N,"预览失败")}}}}async function Mt(e,f,r){let d;const h="bluetooth";return f==="GET"?d=await Te.get(`/${h}/${e}`,{params:r}):d=await Te.post(`/${h}/${e}`,r),d.data}function Fu(e,f,r,d,h,i,l,u,g,a,m,A){const B=w=>w.deviceID||w.address||"",C=async()=>{const w=e.value,I=f.value||w?.device?.type||w?.device_type||"dlna";if(!["agent","bluetooth"].includes(I)){r.value=[];return}try{l.value=!0;let y=null;I==="agent"?y=(await Te.get("/agent/list")).data:y=await Mt("paired","GET"),y.code===0?r.value=y.data||[]:z.error(y.msg||"获取设备失败")}catch(y){console.error("获取设备失败:",y),z.error("获取设备失败")}finally{l.value=!1}},t=async w=>{try{w.connecting=!0;const I=await Mt("connect","POST",{address:w.address});I.code===0?(z.success(`成功连接到设备: ${w.name}`),await C(),i.value=i.value.filter(y=>y.address!==w.address)):z.error(I.msg||"连接失败")}catch(I){console.error("连接设备失败:",I),z.error("连接设备失败")}finally{w.connecting=!1}},N=async()=>{try{u.value=!0;const w=await Te.get("/dlna/scan",{params:{timeout:5}});w.data.code===0?(d.value=w.data.data||[],z.success(`扫描到 ${d.value.length} 个 DLNA 设备`)):z.error(w.data.msg||"扫描 DLNA 设备失败")}catch(w){re(w,"扫描 DLNA 设备失败")}finally{u.value=!1}},b=async w=>{const I=B(w);if(!I)return;const y=h.value;if(!Array.isArray(y))return;const Y=y.find(me=>B(me)===I);if(Y){Y._volumeRefreshing=!0;try{const me=await Te.get("/mi/volume",{params:{device_id:I}});me.data.code===0?Y.volume=me.data.data?.volume??me.data.data??void 0:z.error(me.data.msg||`获取设备 ${Y.name||I} 音量失败`)}catch(me){re(me,`获取设备 ${Y.name||I} 音量失败`)}finally{Y._volumeRefreshing=!1}}},U=async()=>{try{g.value=!0;const w=await Te.get("/mi/scan",{params:{timeout:5}});if(w.data.code===0){const I=(w.data.data||[]).map(y=>({...y,volume:void 0,_volumeChanging:!1,_volumeRefreshing:!1}));h.value=I,await Promise.allSettled(h.value.map(y=>b(y))),z.success(`扫描到 ${I.length} 个小米设备`)}else z.error(w.data.msg||"扫描小米设备失败")}catch(w){re(w,"扫描小米设备失败")}finally{g.value=!1}},M=async()=>{try{l.value=!0;const w=await Mt("scan","GET");if(w.code===0){const I=Array.isArray(w.data)?w.data:[];i.value=I.map(y=>({name:y.name||"",address:y.address||"",...y,connecting:!1})),z.success(`扫描完成，找到 ${i.value.length} 个设备`)}else z.error(w.msg||"扫描失败")}catch(w){console.error("扫描设备失败:",w),z.error("扫描设备失败")}finally{l.value=!1}},P=()=>{a.value=!0},D=()=>{a.value=!1},T=async w=>{if(!e.value||!w||w==="")return;if(!["agent","dlna","bluetooth","mi"].includes(w)){z.error(`无效的设备类型: ${w}`);return}const y=w;f.value=y;const Y=e.value;Y.device_type=y,Y.device?Y.device.type=y:Y.device={type:y,address:"",name:null},await C()},ee=async(w,I=null)=>{e.value&&(await A(y=>{const Y=f.value||y.device?.type||y.device_type||"dlna";return y.device||(y.device={address:"",type:Y,name:null}),y.device.type=Y,y.device.address=w,I!==null&&(y.device.name=I),y.device_address=w,y.device_type=Y,y}),f.value=null)};return{getMiDeviceId:B,refreshConnectedList:C,handleConnectDevice:t,scanDlnaDevices:N,getMiDeviceVolume:b,scanMiDevices:U,handleUpdateDeviceList:M,handleOpenScanDialog:P,handleCloseScanDialog:D,handleUpdatePlaylistDeviceType:T,handleUpdatePlaylistDeviceAddress:ee,handleSelectBluetoothDevice:async w=>{const I=r.value.find(Y=>Y.address===w),y=I?I.name:null;await ee(w,y)},handleSelectAgentDevice:async w=>{const I=typeof w=="string"?w:w.address,y=typeof w=="string"?null:w.name;await ee(I,y)},handleSelectMiDevice:async w=>{const I=w.deviceID||w.address||"",y=w.name||"";await ee(I,y)},handleOpenAgentListDialog:async()=>{m.value=!0,await C()}}}function _u(){const e=_n({callbacks:{onPlay:()=>{z.success("开始播放")},onError:()=>{re(new Error("音频播放失败"),"播放失败"),f()},onEnded:()=>{f()}}}),f=()=>{e.clear()};return{audioPlayer:e,clearBrowserAudioPlayer:f,handlePlayFileInBrowser:u=>{const g=u?.uri||u?.path||"";if(!g||typeof g!="string"||g.trim()===""){z.warning("文件路径无效");return}if(e.playingFilePath.value===g&&e.audio&&!e.audio.paused){f(),z.info("已停止播放");return}const a=Pn(g);if(!a||typeof a!="string"||a.trim()===""){z.error("无法生成媒体文件URL");return}if(a.includes("index.html")||a.endsWith(".html")){z.error("生成的媒体URL无效，可能是HTML页面");return}e.load(a,{playingFilePath:g}),e.play().catch(m=>{re(m,"播放失败"),f()})},isFilePlaying:u=>{const g=u?.uri||u?.path||"";return e.isFilePlaying(g)},getFilePlayProgress:u=>{const g=u?.uri||u?.path||"";return e.getFilePlayProgress(g)},getFileDuration:u=>{const g=u?.uri||u?.path||"",a=u?.duration||0;return e.getFileDuration(g,a)},handleSeekFile:(u,g)=>{const a=u?.uri||u?.path||"";e.seekFile(a,g)}}}function Pu(e,f,r,d,h,i,l,u,g,a,m,A,B,C,t){const N=()=>l.value!==null?l.value:Xe(),b=_=>((!_.pre_lists||!Array.isArray(_.pre_lists)||_.pre_lists.length!==7)&&(_.pre_lists=Array(7).fill(null).map(()=>[])),_.pre_lists),U=(_="请先选择一个播放列表")=>f.value?!0:(z.warning(_),!1),M=(_,H)=>{_!=="cancel"&&re(_,H)},P=async(_,H)=>{try{r.value=!0,await _()}catch(V){M(V,H)}finally{r.value=!1}},D=()=>{U()&&(d.value=!0,h.value="files",i.value=null)},T=()=>{U()&&(d.value=!0,h.value="pre_files",i.value=null)},ee=async _=>{if(_.length!==0){if(!f.value){z.warning("请先创建并选择一个播放列表");return}try{r.value=!0,await A(V=>{const se=N(),ne=h.value,Z=ne==="pre_files"?Array.isArray(V.pre_lists)&&V.pre_lists.length===7?[...V.pre_lists[se]||[]]:[]:Array.isArray(V.playlist)?[...V.playlist]:[],ue=new Set;if(Z.forEach(ye=>{ye?.uri&&ue.add(ye.uri)}),i.value&&_.length>0){const ye=i.value.index;if(i.value.type==="pre_files"){b(V);const k=[...V.pre_lists[se]||[]];ye>=0&&ye<k.length&&(k[ye]={uri:_[0]},V.pre_lists[se]=k)}else{const k=[...V.playlist];ye>=0&&ye<k.length&&(k[ye]={uri:_[0]},V.playlist=k,V.total=k.length)}return i.value=null,V}for(const ye of _)if(!ue.has(ye)){const k={uri:ye};Z.push(k),ue.add(ye)}return ne==="pre_files"?(b(V),V.pre_lists[se]=Z):(V.playlist=Z,V.total=Z.length,Z.length===0?V.current_index=0:V.current_index>=Z.length&&(V.current_index=Z.length-1)),V});const H=h.value==="pre_files"?"前置列表":"播放列表";z.success(`成功添加 ${_.length} 个文件到${H}`),d.value=!1}catch(H){re(H,"添加文件到播放列表失败")}finally{r.value=!1}}},de=()=>{d.value=!1},R=async _=>{const H=f.value;if(!(!H||_<=0||_>=H.playlist.length))try{r.value=!0,await A(V=>{const se=[...V.playlist];return[se[_-1],se[_]]=[se[_],se[_-1]],V.playlist=se,V.current_index===_?V.current_index=_-1:V.current_index===_-1&&(V.current_index=_),V.total=se.length,V}),z.success("已上移")}catch(V){re(V,"上移失败")}finally{r.value=!1}},x=async _=>{const H=f.value;if(!(!H||_<0||_>=H.playlist.length-1))try{r.value=!0,await A(V=>{const se=[...V.playlist];return[se[_],se[_+1]]=[se[_+1],se[_]],V.playlist=se,V.current_index===_?V.current_index=_+1:V.current_index===_+1&&(V.current_index=_),V.total=se.length,V}),z.success("已下移")}catch(V){re(V,"下移失败")}finally{r.value=!1}},S=async _=>{const H=f.value;if(!H||_<0||_>=H.playlist.length)return;const se=H.playlist[_]?.uri?.split("/").pop()||"文件";try{await Ee.confirm(`确定要删除 "${se}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),r.value=!0,await A(ne=>{const Z=[...ne.playlist];return Z.splice(_,1),ne.playlist=Z,Z.length===0?ne.current_index=0:_<ne.current_index?ne.current_index=Math.max(0,ne.current_index-1):_===ne.current_index&&(ne.current_index=Math.min(ne.current_index,Z.length-1)),ne.total=Z.length,ne}),z.success("已删除")}catch(ne){ne!=="cancel"&&re(ne,"删除失败")}finally{r.value=!1}},w=async _=>{const H=f.value;!H||_<0||_>=H.playlist.length||(i.value={type:"files",index:_},h.value="files",d.value=!0)},I=async _=>{const H=f.value,V=B();!H||!V||_<=0||_>=V.length||await P(async()=>{await A(se=>{const ne=N();b(se);const Z=[...se.pre_lists[ne]||[]];return[Z[_-1],Z[_]]=[Z[_],Z[_-1]],se.pre_lists[ne]=Z,se})},"上移失败")},y=async _=>{const H=f.value,V=B();!H||!V||_<0||_>=V.length-1||await P(async()=>{await A(se=>{const ne=N();b(se);const Z=[...se.pre_lists[ne]||[]];return[Z[_],Z[_+1]]=[Z[_+1],Z[_]],se.pre_lists[ne]=Z,se})},"下移失败")},Y=async _=>{const H=f.value,V=B();if(!H||!V||_<0||_>=V.length)return;const ne=V[_]?.uri?.split("/").pop()||"文件";try{await Ee.confirm(`确定要删除 "${ne}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await P(async()=>{await A(Z=>{const ue=N();b(Z);const ye=[...Z.pre_lists[ue]||[]];return ye.splice(_,1),Z.pre_lists[ue]=ye,Z}),z.success("已删除")},"删除失败")}catch(Z){M(Z,"删除失败")}},me=async _=>{const H=f.value,V=B();!H||!V||_<0||_>=V.length||(i.value={type:"pre_files",index:_},h.value="pre_files",d.value=!0)},F=()=>{u.value=!u.value,u.value||(a.value=[])},$=()=>{g.value=!g.value,g.value||(m.value=[])},p=_=>{const H=a.value,V=H.indexOf(_);V>-1?H.splice(V,1):H.push(_)},O=_=>{const H=m.value,V=H.indexOf(_);V>-1?H.splice(V,1):H.push(_)},L=async()=>{const _=f.value,H=B(),V=a.value;if(!_||!H||V.length===0)return;const se=V.length;try{await Ee.confirm(`确定要删除选中的 ${se} 个前置文件吗？`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await P(async()=>{const ne=[...new Set(V)].sort((Z,ue)=>ue-Z);await A(Z=>{const ue=N();b(Z);const ye=[...Z.pre_lists[ue]||[]];return ne.forEach(k=>{k>=0&&k<ye.length&&ye.splice(k,1)}),Z.pre_lists[ue]=ye,Z}),a.value=[],u.value=!1,z.success(`已删除 ${se} 个前置文件`)},"批量删除失败")}catch(ne){M(ne,"批量删除失败")}},J=async()=>{const _=f.value,H=m.value;if(!_||!_.playlist||H.length===0)return;const V=H.length;try{await Ee.confirm(`确定要删除选中的 ${V} 个正式文件吗？`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await P(async()=>{const se=[...new Set(H)].sort((ne,Z)=>Z-ne);await A(ne=>{const Z=[...ne.playlist];if(se.forEach(ue=>{ue>=0&&ue<Z.length&&Z.splice(ue,1)}),ne.playlist=Z,Z.length===0)ne.current_index=0;else{let ue=ne.current_index;se.forEach(ye=>{ye<ne.current_index?ue=Math.max(0,ue-1):ye===ne.current_index&&(ue=Math.min(ue,Z.length-1))}),ne.current_index=ue}return ne.total=Z.length,ne}),m.value=[],g.value=!1,z.success(`已删除 ${V} 个正式文件`)},"批量删除失败")}catch(se){M(se,"批量删除失败")}},ae=async()=>{const _=f.value,H=B();if(!(!_||!H||H.length===0))try{await Ee.confirm(`确定要清空前置文件列表吗？此操作将删除所有 ${H.length} 个前置文件。`,"确认清空",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await P(async()=>{await A(V=>{const se=N();return b(V),V.pre_lists[se]=[],V}),z.success("已清空前置文件列表")},"清空失败")}catch(V){M(V,"清空失败")}},ce=async()=>{const _=f.value;if(!(!_||!_.playlist||_.playlist.length===0))try{await Ee.confirm(`确定要清空正式文件列表吗？此操作将删除所有 ${_.playlist.length} 个正式文件。`,"确认清空",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await P(async()=>{await A(H=>(H.playlist=[],H.total=0,H.current_index=0,H)),z.success("已清空正式文件列表")},"清空失败")}catch(H){M(H,"清空失败")}},Ie=async()=>{const _=f.value;if(!_)return;const H=B(),V=H&&H.length||0,se=_.playlist&&_.playlist.length||0,ne=V+se;if(ne!==0)try{const Z=V>0&&se>0?`确定要清空播放列表 "${_.name}" 吗？此操作将删除所有 ${V} 个前置文件和 ${se} 个正式文件，共 ${ne} 个文件。`:V>0?`确定要清空播放列表 "${_.name}" 吗？此操作将删除所有 ${V} 个前置文件。`:`确定要清空播放列表 "${_.name}" 吗？此操作将删除所有 ${se} 个正式文件。`;await Ee.confirm(Z,"确认清空",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await P(async()=>{await A(ue=>(ue.playlist=[],b(ue),ue.pre_lists=ue.pre_lists.map(()=>[]),ue.total=0,ue.current_index=0,ue)),z.success("已清空播放列表（包括前置文件和正式文件）")},"清空失败")}catch(Z){M(Z,"清空失败")}},Fe=_=>typeof _=="string"?{uri:_}:{..._,uri:_.uri||""};return{handleOpenFileBrowser:D,handleOpenFileBrowserForPreFiles:T,handleFileBrowserConfirm:ee,handleCloseFileBrowser:de,handleMovePlaylistItemUp:R,handleMovePlaylistItemDown:x,handleDeletePlaylistItem:S,handleReplacePlaylistItem:w,handleMovePreFileUp:I,handleMovePreFileDown:y,handleDeletePreFile:Y,handleReplacePreFile:me,handleTogglePreFilesBatchDeleteMode:F,handleToggleFilesBatchDeleteMode:$,handleTogglePreFileSelection:p,handleToggleFileSelection:O,handleBatchDeletePreFiles:L,handleBatchDeleteFiles:J,handleClearPreFiles:ae,handleClearFiles:ce,handleClearPlaylist:Ie,handleOpenPlaylistSelectorForPreFile:async _=>{try{if(!_){z.warning("文件信息无效");return}if(t&&C){const H=Fe(_);t.value=[H],C.value=!0}else z.info("请使用文件浏览器添加文件到播放列表")}catch(H){dt.error("打开播放列表选择器失败:",H),z.error("打开对话框失败")}},handleOpenPlaylistSelectorForFile:async _=>{try{if(!_){z.warning("文件信息无效");return}const H=Fe(_);if(!H.uri){z.warning("文件URI无效");return}t&&C?(t.value=[H],C.value=!0):z.info("请使用文件浏览器添加文件到播放列表")}catch(H){dt.error("打开播放列表选择器失败:",H),z.error("打开对话框失败")}}}}function Su(e,f,r,d,h,i,l,u,g,a,m,A,B){const C=()=>a.value!==null?a.value:Xe(),t=(x,S)=>{if(!x||!S||x.length!==S.length)return!0;for(let w=0;w<x.length;w++){const I=x[w]?.uri||x[w],y=S[w]?.uri||S[w];if(I!==y)return!0}return!1};return{handleTogglePreFilesDragMode:async()=>{if(d.value){const x=f.value,S=B();if(x&&S&&S.length>0){if(t(u.value||[],S))try{r.value=!0,await m(I=>{const y=C();return(!I.pre_lists||!Array.isArray(I.pre_lists)||I.pre_lists.length!==7)&&(I.pre_lists=Array(7).fill(null).map(()=>[])),I.pre_lists[y]=[...S],I.pre_index=x.pre_index,I}),z.success("排序已保存")}catch(I){re(I,"保存排序失败")}finally{r.value=!1}u.value=null}}else{const x=f.value,S=B();x&&S&&S.length>0&&(u.value=[...S]),i.value=null}d.value=!d.value},handleToggleFilesDragMode:async()=>{if(h.value){const x=f.value;if(x&&x.playlist&&x.playlist.length>0){if(t(g.value||[],x.playlist))try{r.value=!0,await m(w=>(w.playlist=[...x.playlist||[]],w.current_index=x.current_index,w.total=x.playlist.length,w)),z.success("排序已保存")}catch(w){re(w,"保存排序失败")}finally{r.value=!1}g.value=null}}else{const x=f.value;x&&x.playlist&&x.playlist.length>0&&(g.value=[...x.playlist||[]]),l.value=null}h.value=!h.value},handlePreFileDragStart:(x,S)=>{if(!d.value){x.preventDefault();return}try{x.dataTransfer.effectAllowed="move",x.dataTransfer.setData("text/plain",S.toString())}catch(w){console.error("拖拽开始失败:",w)}},handlePreFileDragEnd:x=>{const S=x.currentTarget;S&&S.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")},handlePreFileDragOver:x=>{if(!d.value)return;x.preventDefault(),x.dataTransfer.dropEffect="move";const S=x.currentTarget;if(S){const w=S.getBoundingClientRect(),I=x.clientY,y=w.top+w.height/2;S.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500"),I<y?S.classList.add("border-t-2","border-blue-500"):S.classList.add("border-b-2","border-blue-500")}},handlePreFileDrop:(x,S)=>{if(!d.value)return;x.preventDefault();const w=x.currentTarget;w&&w.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500");const I=parseInt(x.dataTransfer.getData("text/plain"),10);if(I===S||isNaN(I))return;const y=f.value,Y=B();if(!y||!Y||I<0||I>=Y.length||S<0||S>=Y.length)return;const me=C(),F=[...Y],[$]=F.splice(I,1);F.splice(S,0,$);let p=y.pre_index;y.pre_index!==void 0&&y.pre_index!==null&&y.pre_index>=0&&(y.pre_index===I?p=S:I<y.pre_index&&S>=y.pre_index?p=y.pre_index-1:I>y.pre_index&&S<=y.pre_index&&(p=y.pre_index+1));const O=e.value.map(L=>L.id===y.id?((!L.pre_lists||!Array.isArray(L.pre_lists)||L.pre_lists.length!==7)&&(L.pre_lists=Array(7).fill(null).map(()=>[])),{...L,pre_lists:L.pre_lists.map((J,ae)=>ae===me?F:J),pre_index:p}):L);e.value=O,A(O)},handleFileDragStart:(x,S)=>{if(!h.value){x.preventDefault();return}try{x.dataTransfer.effectAllowed="move",x.dataTransfer.setData("text/plain",S.toString())}catch(w){console.error("拖拽开始失败:",w)}},handleFileDragEnd:x=>{const S=x.currentTarget;S&&S.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")},handleFileDragOver:x=>{if(!h.value)return;x.preventDefault(),x.dataTransfer.dropEffect="move";const S=x.currentTarget;if(S){const w=S.getBoundingClientRect(),I=x.clientY,y=w.top+w.height/2;S.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500"),I<y?S.classList.add("border-t-2","border-blue-500"):S.classList.add("border-b-2","border-blue-500")}},handleFileDrop:(x,S)=>{if(!h.value)return;x.preventDefault();const w=x.currentTarget;w&&w.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500");const I=parseInt(x.dataTransfer.getData("text/plain"),10);if(I===S||isNaN(I))return;const y=f.value;if(!y||!y.playlist||I<0||I>=y.playlist.length||S<0||S>=y.playlist.length)return;const Y=[...y.playlist||[]],[me]=Y.splice(I,1);Y.splice(S,0,me);let F=y.current_index;y.current_index!==void 0&&y.current_index!==null&&y.current_index>=0&&(y.current_index===I?F=S:I<y.current_index&&S>=y.current_index?F=y.current_index-1:I>y.current_index&&S<=y.current_index&&(F=y.current_index+1));const $=e.value.map(p=>p.id===y.id?{...p,playlist:Y,current_index:F,total:Y.length}:p);e.value=$,A($)}}}function Tu(e,f,r,d,h,i){const l=K(!1),u=K(null),g=K("");return{editNameDialogVisible:l,editNameDialogName:g,handleStartEditPlaylistName:B=>{const C=e.value.find(t=>t.id===B);C&&(u.value=B,g.value=C.name,l.value=!0)},handleSavePlaylistName:async()=>{if(!u.value)return;const B=g.value?.trim();if(!B||B.length===0){z.warning("播放列表名称不能为空");return}const C=u.value,t=e.value.find(N=>N.id===C);if(!t||t.name===B){l.value=!1,u.value=null,g.value="";return}try{const N=e.value.map(b=>b.id===C?{...b,name:B}:b);e.value=N,C===f.value&&i(N),await h(N),l.value=!1,u.value=null,g.value="",z.success("播放列表名称已更新")}catch(N){re(N,"更新播放列表名称失败")}},handleCancelEditPlaylistName:()=>{l.value=!1,u.value=null,g.value=""}}}const Bu={class:"p-1"},Eu={class:"flex gap-4 h-[calc(100vh-150px)]"},Wu=ke({__name:"index",setup(e){const{playlistCollection:f,activePlaylistId:r,playlistStatus:d,playlistLoading:h,playlistRefreshing:i,playing:l,stopping:u,showMoreActions:g,editingPlaylistId:a,editingPlaylistName:m,fileBrowserDialogVisible:A,fileBrowserTarget:B,replaceFileInfo:C,selectedWeekdayIndex:t,preFilesDragMode:N,filesDragMode:b,preFilesBatchDeleteMode:U,filesBatchDeleteMode:M,selectedPreFileIndices:P,selectedFileIndices:D,preFilesExpanded:T,playlistSelectorVisible:ee,playlistSelectorSelectedFiles:de,batchDrawerVisible:R,cronBuilderVisible:x,cronPreviewVisible:S,cronPreviewTimes:w,initialCronExpr:I,agentListDialogVisible:y,scanDialogVisible:Y,loading:me,deviceList:F,connectedDeviceList:$,dlnaDeviceList:p,dlnaScanning:O,miDeviceList:L,miScanning:J,pendingDeviceType:ae,preFilesSortOrder:ce,filesSortOrder:Ie,preFilesOriginalOrder:Fe,filesOriginalOrder:we}=Cu(),{audioPlayer:j,handlePlayFileInBrowser:_,handleSeekFile:H}=_u(),V=()=>t.value!==null?t.value:Xe(),se=()=>{const fe=d.value;if(!fe||!fe.pre_lists)return[];const ie=V();return!Array.isArray(fe.pre_lists)||fe.pre_lists.length!==7?[]:fe.pre_lists[ie]||[]},{savePlaylist:ne,syncActivePlaylist:Z,updateActivePlaylistData:ue,loadPlaylist:ye,refreshPlaylistStatus:k}=ku(f,r,d,i,ae,N,b),W=async fe=>{await ue(fe)},{handleOpenFileBrowser:X,handleOpenFileBrowserForPreFiles:ve,handleFileBrowserConfirm:Ge,handleCloseFileBrowser:at,handleMovePlaylistItemUp:he,handleMovePlaylistItemDown:Se,handleDeletePlaylistItem:ot,handleReplacePlaylistItem:Il,handleMovePreFileUp:Rl,handleMovePreFileDown:zl,handleDeletePreFile:Ul,handleReplacePreFile:Vl,handleTogglePreFilesBatchDeleteMode:Kl,handleToggleFilesBatchDeleteMode:Gl,handleTogglePreFileSelection:jl,handleToggleFileSelection:Wl,handleBatchDeletePreFiles:Hl,handleBatchDeleteFiles:Yl,handleClearPreFiles:Jl,handleClearFiles:ql,handleClearPlaylist:Xl,handleOpenPlaylistSelectorForPreFile:Ql,handleOpenPlaylistSelectorForFile:Zl}=Pu(f,d,h,A,B,C,t,U,M,P,D,W,se,ee,de),{handleTogglePreFilesDragMode:es,handleToggleFilesDragMode:ts,handlePreFileDragStart:ls,handlePreFileDragEnd:ss,handlePreFileDragOver:ns,handlePreFileDrop:as,handleFileDragStart:os,handleFileDragEnd:is,handleFileDragOver:rs,handleFileDrop:ds}=Su(f,d,h,N,b,ce,Ie,Fe,we,t,W,Z,se),{editNameDialogVisible:Ft,editNameDialogName:_t,handleStartEditPlaylistName:us,handleSavePlaylistName:Pt,handleCancelEditPlaylistName:ct}=Tu(f,r,a,m,ne,Z),{handleOpenCronBuilder:cs,handleCloseCronBuilder:fs,handleCronBuilderApply:ps,handleCronBuilderPreview:vs,handleTogglePlaylistCronEnabled:ms,handleUpdatePlaylistCron:gs,handleUpdatePlaylistDuration:ys,handleUpdateTriggerButton:hs,handlePreviewPlaylistCron:bs}=xu(d,x,S,w,I,ue),{refreshConnectedList:Jt,handleConnectDevice:ws,scanDlnaDevices:$s,scanMiDevices:Cs,handleUpdateDeviceList:ks,handleOpenScanDialog:Ds,handleCloseScanDialog:xs,handleUpdatePlaylistDeviceType:Fs,handleUpdatePlaylistDeviceAddress:_s,handleSelectBluetoothDevice:Ps,handleSelectAgentDevice:Ss,handleSelectMiDevice:Ts,handleOpenAgentListDialog:Bs}=Fu(d,ae,$,p,L,F,me,O,J,Y,y,ue),{handleSelectPlaylist:Es,handleCreatePlaylist:As,handleCopyPlaylist:Ms,handleDeletePlaylistGroup:Ns,handlePlayPlaylist:Ls,handlePlayNext:Os,handlePlayPre:Is,handleStopPlaylist:Rs}=Du(f,r,d,l,u,Z,ue,k,se),zs=async fe=>{await Es(fe),ae.value=null,ce.value=null,Ie.value=null,N.value=!1,b.value=!1,Fe.value=null,we.value=null,U.value=!1,M.value=!1,P.value=[],D.value=[],await Jt()},Us=async(fe,ie)=>{fe==="delete"?await Ns(ie):fe==="copy"&&await Ms(ie)},Vs=async fe=>{try{if(h.value=!0,!f.value.find($e=>$e.id===fe.playlistId)){z.warning("播放列表不存在");return}await ue($e=>{if($e.id!==fe.playlistId)return $e;if(fe.preLists.length>0&&((!$e.pre_lists||!Array.isArray($e.pre_lists)||$e.pre_lists.length!==7)&&($e.pre_lists=Array(7).fill(null).map(()=>[])),fe.preLists.forEach(pe=>{if(pe>=0&&pe<7){const _e=new Set(($e.pre_lists[pe]||[]).map(Me=>typeof Me=="string"?Me:Me?.uri||""));fe.files.forEach(Me=>{_e.has(Me)||($e.pre_lists[pe]||($e.pre_lists[pe]=[]),$e.pre_lists[pe].push({uri:Me}))})}})),fe.filesList){Array.isArray($e.playlist)||($e.playlist=[]);const pe=new Set($e.playlist.map(_e=>typeof _e=="string"?_e:_e?.uri||""));fe.files.forEach(_e=>{pe.has(_e)||$e.playlist.push({uri:_e})}),$e.total=$e.playlist.length}return $e}),Z(f.value),await ne(f.value)}catch(ie){re(ie,"批量添加文件失败")}finally{h.value=!1}},Ks=async fe=>{try{if(h.value=!0,!f.value.find(pe=>pe.id===fe.playlistId)){z.warning("播放列表不存在");return}const $e=new Set(fe.files);await ue(pe=>(pe.id!==fe.playlistId||(fe.preLists.length>0&&pe.pre_lists&&Array.isArray(pe.pre_lists)&&pe.pre_lists.length===7&&fe.preLists.forEach(_e=>{_e>=0&&_e<7&&pe.pre_lists[_e]&&(pe.pre_lists[_e]=pe.pre_lists[_e].filter(Me=>{const Tt=typeof Me=="string"?Me:Me?.uri||"";return!$e.has(Tt)}))}),fe.filesList&&Array.isArray(pe.playlist)&&(pe.playlist=pe.playlist.filter(_e=>{const Me=typeof _e=="string"?_e:_e?.uri||"";return!$e.has(Me)}),pe.total=pe.playlist.length,pe.playlist.length===0?pe.current_index=0:pe.current_index>=pe.playlist.length&&(pe.current_index=pe.playlist.length-1))),pe)),Z(f.value),await ne(f.value)}catch(ie){re(ie,"批量删除文件失败")}finally{h.value=!1}},Gs=async()=>{await Bs()},js=fe=>{t.value=fe,Z(f.value)},St=K(!0),{start:qt,stop:Xt}=Sn(async()=>{await k(!0,!0)},Si,{immediate:!1,autoCleanup:!0}),Ws=fe=>{St.value=fe,fe?qt():Xt()};return nt(async()=>{await ye(),await Jt(),St.value&&qt()}),wl(()=>{Xt()}),(fe,ie)=>{const $e=bl,pe=hl,_e=Vt,Me=ze,Tt=ut;return v(),E("div",Bu,[o("div",Eu,[n(No,{"playlist-collection":s(f),"active-playlist-id":s(r),refreshing:s(i),"auto-refresh-enabled":St.value,onSelect:zs,onCreate:s(As),onRefresh:s(k),onToggleAutoRefresh:Ws,onMenuCommand:Us},null,8,["playlist-collection","active-playlist-id","refreshing","auto-refresh-enabled","onCreate","onRefresh"]),n(Fi,{"playlist-status":s(d),"active-playlist-id":s(r),"editing-playlist-id":s(a),"editing-playlist-name":s(m),"onUpdate:editingPlaylistName":ie[0]||(ie[0]=Ce=>ft(m)?m.value=Ce:null),"selected-weekday-index":s(t),"pre-files-drag-mode":s(N),"pre-files-batch-delete-mode":s(U),"selected-pre-file-indices":s(P),"pre-files-expanded":s(T),"files-drag-mode":s(b),"files-batch-delete-mode":s(M),"selected-file-indices":s(D),"playlist-loading":s(h),playing:s(l),stopping:s(u),"show-more-actions":s(g),"audio-player":s(j),onStartEditName:s(us),onSaveName:s(Pt),onCancelEditName:s(ct),onOpenBatchDrawer:ie[1]||(ie[1]=Ce=>R.value=!0),onPlay:s(Ls),onPlayPre:s(Is),onPlayNext:s(Os),onStop:s(Rs),onClear:s(Xl),onToggleMoreActions:ie[2]||(ie[2]=Ce=>g.value=!s(g)),onSelectWeekday:js,onOpenFileBrowserForPreFiles:s(ve),onTogglePreFilesDragMode:s(es),onTogglePreFilesBatchDeleteMode:s(Kl),onBatchDeletePreFiles:s(Hl),onClearPreFiles:s(Jl),onTogglePreFilesExpand:ie[3]||(ie[3]=Ce=>T.value=!s(T)),onTogglePreFileSelection:s(jl),onPreFileDragStart:s(ls),onPreFileDragEnd:s(ss),onPreFileDragOver:s(ns),onPreFileDrop:s(as),onOpenFileBrowser:s(X),onToggleFilesDragMode:s(ts),onToggleFilesBatchDeleteMode:s(Gl),onBatchDeleteFiles:s(Yl),onClearFiles:s(ql),onToggleFileSelection:s(Wl),onFileDragStart:s(os),onFileDragEnd:s(is),onFileDragOver:s(rs),onFileDrop:s(ds),onPlayFile:s(_),onSeekFile:s(H),onMovePreFileUp:s(Rl),onMovePreFileDown:s(zl),onReplacePreFile:s(Vl),onOpenPlaylistSelectorForPreFile:s(Ql),onDeletePreFile:s(Ul),onMoveFileUp:s(he),onMoveFileDown:s(Se),onReplaceFile:s(Il),onOpenPlaylistSelectorForFile:s(Zl),onDeleteFile:s(ot)},null,8,["playlist-status","active-playlist-id","editing-playlist-id","editing-playlist-name","selected-weekday-index","pre-files-drag-mode","pre-files-batch-delete-mode","selected-pre-file-indices","pre-files-expanded","files-drag-mode","files-batch-delete-mode","selected-file-indices","playlist-loading","playing","stopping","show-more-actions","audio-player","onStartEditName","onSaveName","onCancelEditName","onPlay","onPlayPre","onPlayNext","onStop","onClear","onOpenFileBrowserForPreFiles","onTogglePreFilesDragMode","onTogglePreFilesBatchDeleteMode","onBatchDeletePreFiles","onClearPreFiles","onTogglePreFileSelection","onPreFileDragStart","onPreFileDragEnd","onPreFileDragOver","onPreFileDrop","onOpenFileBrowser","onToggleFilesDragMode","onToggleFilesBatchDeleteMode","onBatchDeleteFiles","onClearFiles","onToggleFileSelection","onFileDragStart","onFileDragEnd","onFileDragOver","onFileDrop","onPlayFile","onSeekFile","onMovePreFileUp","onMovePreFileDown","onReplacePreFile","onOpenPlaylistSelectorForPreFile","onDeletePreFile","onMoveFileUp","onMoveFileDown","onReplaceFile","onOpenPlaylistSelectorForFile","onDeleteFile"]),n(br,{"playlist-status":s(d),"connected-device-list":s($),"dlna-device-list":s(p),"mi-device-list":s(L),loading:s(me),"dlna-scanning":s(O),"mi-scanning":s(J),"on-toggle-cron-enabled":s(ms),"on-update-cron":s(gs),"on-update-duration":s(ys),"on-update-trigger-button":s(hs),"on-open-cron-builder":s(cs),"on-preview-cron":s(bs),"on-update-device-type":s(Fs),"on-update-device-address":s(_s),"on-select-bluetooth-device":s(Ps),"on-select-agent-device":s(Ss),"on-select-mi-device":s(Ts),"on-scan-dlna-devices":s($s),"on-scan-mi-devices":s(Cs),"on-open-scan-dialog":s(Ds),"on-open-device-list":Gs},null,8,["playlist-status","connected-device-list","dlna-device-list","mi-device-list","loading","dlna-scanning","mi-scanning","on-toggle-cron-enabled","on-update-cron","on-update-duration","on-update-trigger-button","on-open-cron-builder","on-preview-cron","on-update-device-type","on-update-device-address","on-select-bluetooth-device","on-select-agent-device","on-select-mi-device","on-scan-dlna-devices","on-scan-mi-devices","on-open-scan-dialog"])]),n(Cl,{visible:s(A),"onUpdate:visible":ie[5]||(ie[5]=Ce=>A.value=Ce),title:"选择文件添加到播放列表","confirm-button-text":"添加","confirm-loading":s(h),onConfirm:s(Ge),onClose:s(at)},{"footer-prepend":c(()=>[n(pe,{modelValue:s(B),"onUpdate:modelValue":ie[4]||(ie[4]=Ce=>ft(B)?B.value=Ce:null),size:"small",class:"w-[150px]"},{default:c(()=>[n($e,{label:"添加到主列表",value:"files"}),n($e,{label:"添加到前置列表",value:"pre_files"})]),_:1},8,["modelValue"])]),_:1},8,["visible","confirm-loading","onConfirm","onClose"]),n(vo,{visible:s(x),"initial-cron":s(I),"onUpdate:visible":ie[6]||(ie[6]=Ce=>x.value=Ce),onApply:s(ps),onPreview:s(vs),onClose:s(fs)},null,8,["visible","initial-cron","onApply","onPreview","onClose"]),n(ho,{visible:s(S),times:s(w),"onUpdate:visible":ie[7]||(ie[7]=Ce=>S.value=Ce),onClose:ie[8]||(ie[8]=Ce=>S.value=!1)},null,8,["visible","times"]),n(Cr,{visible:s(Y),"device-list":s(F),loading:s(me),"onUpdate:visible":ie[9]||(ie[9]=Ce=>Y.value=Ce),onRefresh:s(ks),onConnect:s(ws),onClose:s(xs)},null,8,["visible","device-list","loading","onRefresh","onConnect","onClose"]),n(id,{visible:s(y),"onUpdate:visible":ie[10]||(ie[10]=Ce=>y.value=Ce)},null,8,["visible"]),n(Nd,{visible:s(ee),"playlist-collection":s(f),"selected-files":s(de),"onUpdate:visible":ie[11]||(ie[11]=Ce=>ee.value=Ce)},null,8,["visible","playlist-collection","selected-files"]),n(Tt,{modelValue:s(Ft),"onUpdate:modelValue":ie[13]||(ie[13]=Ce=>ft(Ft)?Ft.value=Ce:null),title:"编辑播放列表名称",width:"400",onClose:s(ct)},{footer:c(()=>[n(Me,{onClick:s(ct)},{default:c(()=>[...ie[15]||(ie[15]=[q("取消",-1)])]),_:1},8,["onClick"]),n(Me,{type:"primary",onClick:s(Pt)},{default:c(()=>[...ie[16]||(ie[16]=[q("确定",-1)])]),_:1},8,["onClick"])]),default:c(()=>[n(_e,{modelValue:s(_t),"onUpdate:modelValue":ie[12]||(ie[12]=Ce=>ft(_t)?_t.value=Ce:null),placeholder:"请输入播放列表名称",onKeyup:[It(s(Pt),["enter"]),It(s(ct),["esc"])],clearable:"",autofocus:""},null,8,["modelValue","onKeyup"])]),_:1},8,["modelValue","onClose"]),n($u,{visible:s(R),"playlist-collection":s(f),"onUpdate:visible":ie[14]||(ie[14]=Ce=>R.value=Ce),onRefresh:s(k),"on-add-files":Vs,"on-remove-files":Ks},null,8,["visible","playlist-collection","onRefresh"])])}}});export{Wu as default};
