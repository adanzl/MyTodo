const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/Home-DK52JcbX.js","assets/js/api-shared-BjY1fDmA.js","assets/js/utils-BjcahYMR.js","assets/js/types-shared-BfhRjD1-.js","assets/js/utils-shared-D8R-KWQB.js","assets/js/element-plus-BuOeJSdF.js","assets/js/vue-vendor-C-hNZ0TW.js","assets/js/vendor-CJeEfH0b.js","assets/css/element-plus-CD3B3G1X.css","assets/js/vant-Bv_herco.js","assets/css/vant-DzKo5b93.css","assets/js/Lottery-CpGhaAUN.js","assets/js/Info-Dc9NU7eX.js","assets/js/Chat-UWkaFZfg.js","assets/js/socket-BNHFZUBq.js","assets/css/Chat-BmLI6Mr9.css","assets/js/Score-BpRw7Q88.js","assets/js/Timetable-ZvyrPgOd.js","assets/js/index-BLLvMe8R.js","assets/js/useInterval--1alzFpr.js","assets/css/useInterval-CYVuUd3d.css","assets/js/constants-shared-BwcKRbUv.js","assets/js/index-Bo8CEvtl.js"])))=>i.map(i=>d[i]);
import{av as B,r as S,c as x,j as A,aw as j,ax as F,l as w,o as b,G as e,Q as t,s as U,D as $,u as p,$ as y,t as T,n as H,a6 as q,J as z,F as J,ae as K,ay as W,az as G,ar as Q,aA as Y}from"./vue-vendor-C-hNZ0TW.js";import{E as P,a as X,b as k,c as M,d as Z,e as ee,f as N,h as te,g as oe,p as ne,m as se,i as le,s as ae,j as re,k as ie,l as ue,n as ce,o as de,q as _e,r as me,t as fe,u as pe,v as ve,w as ge,x as D,y as ye}from"./element-plus-BuOeJSdF.js";import{b as he}from"./api-shared-BjY1fDmA.js";import{v as Ee,C as be}from"./utils-BjcahYMR.js";import{s as we}from"./vant-Bv_herco.js";import"./vendor-CJeEfH0b.js";import"./types-shared-BfhRjD1-.js";import"./utils-shared-D8R-KWQB.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function u(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(o){if(o.ep)return;o.ep=!0;const r=u(o);fetch(o.href,r)}})();const O=B("user",()=>{const m=S([]),i=S(!1),u=S(null),a=S({bLogin:!1,id:null,name:null,ico:null}),o=300*1e3,r="user_id",s=v=>m.value.find(g=>String(g.id)===String(v)),f=x(()=>u.value?Date.now()-u.value<o:!1),n=x(()=>a.value.bLogin),l=async(v=!1)=>{if(!(!v&&f.value&&m.value.length>0)){i.value=!0;try{const g=await he("t_user");g&&g.data?(m.value=g.data.data||[],u.value=Date.now()):m.value=[]}catch(g){console.error("获取用户列表失败:",g),P.error("获取用户列表失败"),m.value=[]}finally{i.value=!1}}},_=()=>{u.value=null},c=v=>{a.value={bLogin:!0,id:v.id,name:v.name,ico:v.icon||null},localStorage.setItem(r,String(v.id))};return{userList:m,loading:i,lastFetchTime:u,curUser:a,getUserById:s,isDataFresh:f,isLoggedIn:n,refreshUserList:l,clearCache:_,setCurUser:c,clearCurUser:()=>{a.value={bLogin:!1,id:null,name:null,ico:null},localStorage.removeItem(r)},restoreCurUser:async()=>{const v=localStorage.getItem(r);if(v){m.value.length===0&&await l();const g=s(v);g&&c(g)}},getCurUserFullInfo:()=>a.value.id&&s(a.value.id)||null}}),Le={class:"flex justify-between items-center p-5"},Ce=A({__name:"Sidebar",setup(m){const i=j(),u=F(),a=O(),o=S(!1),r=()=>{},s=()=>{a.clearCurUser(),i.push("/")};return(f,n)=>{const l=k,_=M,c=N,d=ee,L=oe,C=Z,v=de,g=X;return b(),w(g,{width:"200px",class:"w-48"},{default:e(()=>[t(v,null,{default:e(()=>[U("div",Le,[t(l,{src:p(a).curUser.ico},null,8,["src"]),p(a).curUser.bLogin?(b(),w(_,{key:0,onClick:s,size:"small"},{default:e(()=>[...n[0]||(n[0]=[y(" 注销 ",-1)])]),_:1})):$("",!0)]),t(C,{"default-active":p(u).path,collapse:o.value,"unique-opened":"",router:""},{default:e(()=>[t(d,{index:"/home",onClick:r},{title:e(()=>[...n[1]||(n[1]=[y("Home",-1)])]),default:e(()=>[t(c,null,{default:e(()=>[t(p(te))]),_:1})]),_:1}),t(L,{index:"mytodo"},{title:e(()=>[t(c,null,{default:e(()=>[t(p(re))]),_:1}),n[2]||(n[2]=U("span",null,"MyTodo",-1))]),default:e(()=>[t(d,{index:"/lottery",onClick:r},{title:e(()=>[...n[3]||(n[3]=[y("抽奖设置",-1)])]),default:e(()=>[t(c,null,{default:e(()=>[t(p(ne))]),_:1})]),_:1}),t(d,{index:"/chat"},{title:e(()=>[...n[4]||(n[4]=[y("Chat",-1)])]),default:e(()=>[t(c,null,{default:e(()=>[t(p(se))]),_:1})]),_:1}),t(d,{index:"/info"},{title:e(()=>[...n[5]||(n[5]=[y("Info",-1)])]),default:e(()=>[t(c,null,{default:e(()=>[t(p(le))]),_:1})]),_:1}),t(d,{index:"/score"},{title:e(()=>[...n[6]||(n[6]=[y("Score",-1)])]),default:e(()=>[t(c,null,{default:e(()=>[t(p(ae))]),_:1})]),_:1})]),_:1}),t(d,{index:"/timetable"},{title:e(()=>[...n[7]||(n[7]=[y("课程表",-1)])]),default:e(()=>[t(c,null,{default:e(()=>[t(p(ie))]),_:1})]),_:1}),t(d,{index:"/media"},{title:e(()=>[...n[8]||(n[8]=[y("媒体",-1)])]),default:e(()=>[t(c,null,{default:e(()=>[t(p(ue))]),_:1})]),_:1}),t(d,{index:"/tools"},{title:e(()=>[...n[9]||(n[9]=[y("工具",-1)])]),default:e(()=>[t(c,null,{default:e(()=>[t(p(ce))]),_:1})]),_:1})]),_:1},8,["default-active","collapse"])]),_:1})]),_:1})}}}),V=(m,i)=>{const u=m.__vccOpts||m;for(const[a,o]of i)u[a]=o;return u},Se=V(Ce,[["__scopeId","data-v-72d7af0b"]]),Ue={class:"flex flex-col gap-2 items-center"},xe={class:"flex items-center border-b-1 border-gray-200"},Ie={class:"pl-4 text-base text-gray-500"},Pe=A({__name:"Login",emits:["login-success"],setup(m,{emit:i}){const u=i,a=O(),o=x(()=>a.userList),r=x(()=>a.loading),s=S({id:null,password:""}),f=async()=>{await a.refreshUserList(),o.value.length===0&&P.warning("用户列表为空，请检查数据库")},n=async()=>{if(!s.value.id)return;const l=Ee(o.value,{id:s.value.id});l&&(l.pwd===null||l.pwd===be.MD5(s.value.password).toString())?(a.setCurUser(l),u("login-success",{id:l.id,name:l.name,icon:l.icon})):P.error("用户名或密码错误")};return T(async()=>{await f()}),(l,_)=>{const c=k,d=me,L=fe,C=pe,v=M,g=_e;return b(),w(g,{class:"w-[480px]",shadow:"always"},{header:e(()=>[..._[2]||(_[2]=[y("用户登录",-1)])]),default:e(()=>[U("div",Ue,[t(L,{modelValue:s.value.id,"onUpdate:modelValue":_[0]||(_[0]=h=>s.value.id=h),placeholder:"请选择用户",class:"!w-60",loading:r.value,"loading-text":"加载用户列表中...",disabled:r.value},{default:e(()=>[(b(!0),H(J,null,q(o.value,h=>(b(),w(d,{class:"!h-13",key:h.id,label:h.name,value:h.id},{default:e(()=>[U("div",xe,[t(c,{class:"!h-10 !w-10",src:h.icon},null,8,["src"]),U("div",Ie,z(h.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","loading","disabled"]),t(C,{modelValue:s.value.password,"onUpdate:modelValue":_[1]||(_[1]=h=>s.value.password=h),style:{width:"240px"},type:"password",placeholder:"Password","show-password":""},null,8,["modelValue"]),t(v,{type:"primary",size:"large",class:"w-24 h-24 mt-4",disabled:!s.value.id,onClick:n},{default:e(()=>[..._[3]||(_[3]=[y(" Login ",-1)])]),_:1},8,["disabled"])])]),_:1})}}}),Ae=V(Pe,[["__scopeId","data-v-45a8bb62"]]),Oe=A({__name:"App",setup(m){const i=O(),u=a=>{const o=i.getUserById(a.id);o?i.setCurUser(o):(console.warn("用户信息未找到，使用传入的信息"),i.setCurUser({id:a.id,name:a.name,icon:a.icon}))};return T(async()=>{await i.refreshUserList(),await i.restoreCurUser()}),(a,o)=>{const r=N,s=ge,f=K("router-view"),n=ye,l=ve;return b(),w(l,{loading:p(i).loading,class:"h-screen"},{default:e(()=>[t(Se),p(i).curUser.bLogin?(b(),w(l,{key:0},{default:e(()=>[t(s,{class:"flex justify-center items-center bg-blue-50"},{default:e(()=>[t(r,null,{default:e(()=>[t(p(D))]),_:1}),o[0]||(o[0]=y(" 哈哈哈 ",-1)),t(r,null,{default:e(()=>[t(p(D))]),_:1})]),_:1}),t(n,null,{default:e(()=>[t(f)]),_:1})]),_:1})):(b(),w(l,{key:1},{default:e(()=>[t(n,{class:"bg-blue-100 !flex justify-center items-center"},{default:e(()=>[t(Ae,{onLoginSuccess:u})]),_:1})]),_:1}))]),_:1},8,["loading"])}}}),Ve=V(Oe,[["__scopeId","data-v-9c69a1d3"]]),De="modulepreload",Re=function(m){return"/web/"+m},R={},E=function(i,u,a){let o=Promise.resolve();if(u&&u.length>0){let n=function(l){return Promise.all(l.map(_=>Promise.resolve(_).then(c=>({status:"fulfilled",value:c}),c=>({status:"rejected",reason:c}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),f=s?.nonce||s?.getAttribute("nonce");o=n(u.map(l=>{if(l=Re(l),l in R)return;R[l]=!0;const _=l.endsWith(".css"),c=_?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${c}`))return;const d=document.createElement("link");if(d.rel=_?"stylesheet":De,_||(d.as="script"),d.crossOrigin="",d.href=l,f&&d.setAttribute("nonce",f),document.head.appendChild(d),_)return new Promise((L,C)=>{d.addEventListener("load",L),d.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${l}`)))})}))}function r(s){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=s,window.dispatchEvent(f),!f.defaultPrevented)throw s}return o.then(s=>{for(const f of s||[])f.status==="rejected"&&r(f.reason);return i().catch(r)})},Te=[{path:"/",redirect:"/home"},{path:"/home",name:"Home",component:()=>E(()=>import("./Home-DK52JcbX.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))},{path:"/lottery",name:"Lottery",component:()=>E(()=>import("./Lottery-CpGhaAUN.js"),__vite__mapDeps([11,5,6,2,7,8,1,3,4]))},{path:"/info",name:"Info",component:()=>E(()=>import("./Info-Dc9NU7eX.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,8]))},{path:"/chat",name:"Chat",component:()=>E(()=>import("./Chat-UWkaFZfg.js"),__vite__mapDeps([13,6,5,2,7,8,14,1,3,4,9,10,15]))},{path:"/score",name:"Score",component:()=>E(()=>import("./Score-BpRw7Q88.js"),__vite__mapDeps([16,5,6,2,7,8,1,3,4,9,10]))},{path:"/timetable",name:"Timetable",component:()=>E(()=>import("./Timetable-ZvyrPgOd.js"),__vite__mapDeps([17,6,5,2,7,8,1,3,4]))},{path:"/media",name:"Media",component:()=>E(()=>import("./index-BLLvMe8R.js"),__vite__mapDeps([18,6,4,5,2,7,8,1,3,19,20,21,9,10]))},{path:"/tools",name:"Tools",component:()=>E(()=>import("./index-Bo8CEvtl.js"),__vite__mapDeps([22,6,5,2,7,8,4,1,3,19,20,21,9,10]))}],ke=W({history:G(),routes:Te}),I=Q(Ve),Me=Y();I.use(Me);I.use(ke);I.use(we);I.mount("#app");export{V as _,O as u};
