import{A as N,H as P,B as I,I as A,f as G,V as M,W as R,D as Y,R as H}from"./element-plus-CEI_9LYZ.js";import{f as T}from"./shared-1TZFBAIg.js";import{w as F,v as W,y as Z}from"./utils-B-B_-3AX.js";import{u as j}from"./index-gfppqctp.js";import{B as O,o as Q,G as f,I as C,Z as l,Q as u,W as q,E as v,r as y,e as b,D as n,O as J,aa as K,U as g,u as S,a3 as X}from"./vue-vendor-Bzw_s7xI.js";import"./vendor-B3rMqREe.js";import"./vant-DC8oOVF3.js";const $={class:""},ee={class:"flex items-center"},ae={key:0},te={key:1},se={class:"flex items-center gap-1 w-full"},oe={class:"flex-1 text-center"},U=10,_e=O({__name:"Score",setup(le){const w=j(),L=b(()=>w.userList),i=b(()=>{const e=[...L.value];return e.unshift({id:0,name:"全部"}),e}),o=y({data:[],pageNum:1,pageSize:10,totalCount:0,totalPage:0}),m=y(!1),c=y(0),z=b(()=>i.value.find(e=>e.id===c.value)||i.value[0]),k=async()=>{await w.refreshUserList(),i.value.length>0&&(c.value=i.value[0].id)},x=e=>Z(i.value,s=>s.id==e),h=async(e,s,p)=>{m.value=!0;try{let d;e&&e!==0&&(d={user_id:e});const a=await T("t_score_history",d,s,p);if(a&&a.data){const _=a.data.data||[];o.value.data=[],o.value.pageNum=a.data.pageNum??s,o.value.pageSize=a.data.pageSize??p,o.value.totalCount=a.data.totalCount??0,o.value.totalPage=a.data.totalPage??0,F(_,r=>{r.user=x(r.user_id),r.dt=W(r.dt).format("YYYY-MM-DD HH:mm:ss"),o.value.data.push(r)})}}catch(d){console.error("获取积分记录失败:",d)}finally{m.value=!1}},D=async()=>{const e=z.value;console.log("onUserChange",e),e&&await h(e.id,1,U)},E=(e,s)=>{h(z.value.id,e,s)};return Q(async()=>{await k(),await h(0,1,U)}),(e,s)=>{const p=H,d=P,a=Y,_=G,r=I,V=A,B=N;return n(),f("div",$,[C("div",ee,[l(d,{size:"large",modelValue:c.value,"onUpdate:modelValue":s[0]||(s[0]=t=>c.value=t),onChange:D},{default:u(()=>[(n(!0),f(J,null,K(i.value,t=>(n(),v(p,{key:t.id,value:t.id},{default:u(()=>[X(g(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),q((n(),v(r,{data:o.value.data,stripe:""},{default:u(()=>[l(a,{label:"ID",prop:"id",width:"60"}),l(a,{label:"user",width:"60"},{default:u(({row:t})=>[t.user?(n(),f("span",ae,g(t.user.name),1)):(n(),f("span",te,g(t.user_id),1))]),_:1}),l(a,{label:"Action",prop:"action",width:"100"}),l(a,{label:"Date",prop:"dt",width:"180"}),l(a,{label:"Pre",prop:"pre_value",width:"70"}),l(a,{label:"Value",width:"70"},{default:u(({row:t})=>[C("div",se,[t.value>0?(n(),v(_,{key:0,color:"#67C23A",size:16},{default:u(()=>[l(S(M))]),_:1})):(n(),v(_,{key:1,color:"#F56C6C",size:16},{default:u(()=>[l(S(R))]),_:1})),C("span",oe,g(t.value),1)])]),_:1}),l(a,{label:"Current",prop:"current",width:"80"}),l(a,{label:"MSG",prop:"msg"})]),_:1},8,["data"])),[[B,m.value]]),l(V,{layout:"sizes, prev, pager, next",total:o.value.totalCount,"page-size":o.value.pageSize,"page-sizes":[10,20,50],"current-page":o.value.pageNum,class:"mt-2",background:"",onSizeChange:s[1]||(s[1]=t=>E(o.value.pageNum,t)),onCurrentChange:s[2]||(s[2]=t=>E(t,o.value.pageSize))},null,8,["total","page-size","current-page"])])}}});export{_e as default};
