import{j as be,r as T,t as Ve,n as p,o as u,s as a,Q as n,D as S,G as o,$ as b,J as x,M as Xe,l as B,u as E,aa as De,ai as Ze,c as N,y as Re,q as z,F as Me,a6 as Pe,E as Fe,I as Z}from"./vue-vendor-C-hNZ0TW.js";import{c as Be,K as et,q as tt,z as st,C as at,a7 as Ee,u as Ae,A as lt,a0 as ze,f as Le,E as i,ak as ee,L as Ne,i as nt,a9 as Oe,a8 as ot,ab as rt,J as it,$ as ut,D as dt,B as ct,al as ft,am as vt,aj as pt,ah as _t}from"./element-plus-DTFHWHVb.js";import{m as Ie,a as h,k as je}from"./utils-shared-DLZnwTx3.js";import{n as mt,u as gt,o as yt,q as xt,r as ht,t as kt,v as bt,w as wt,x as Ct,y as Tt,z as $t,A as Dt,B as Mt,C as Pt,D as Ft,E as St,F as Vt,G as Bt,H as ke,I as Et,J as zt,K as Lt}from"./api-shared-BhtujeU1.js";import{u as jt,b as Ke,M as Ue,_ as Se}from"./useInterval-BR9ONK5u.js";import{c as Ut,C as Rt}from"./constants-shared-BwcKRbUv.js";import"./utils-BjcahYMR.js";import"./vendor-4xlYshH7.js";import"./types-shared-BezSyEn9.js";import"./index-DUKZZDGN.js";import"./vant-7Cqjo8an.js";const At={class:"p-4 flex flex-col h-full"},Nt={class:"mb-4 flex-shrink-0 border rounded p-3 bg-gray-50"},Ot={class:"flex items-center gap-3"},It={key:0,class:"flex-1 min-w-0"},Kt=["title"],Yt={class:"flex items-center justify-between"},qt={class:"flex-1 overflow-auto"},Gt=["onClick"],Jt={key:1,class:"text-gray-400"},Ht={key:0,class:"flex flex-col gap-1"},Qt={class:"text-sm"},Wt={class:"text-xs text-gray-500"},Xt={key:1,class:"text-gray-400"},Zt={key:0,class:"flex flex-col gap-1"},es={class:"text-sm"},ts={class:"text-xs text-gray-500"},ss={key:1,class:"text-gray-400"},as={class:"flex flex-col gap-1 items-center"},ls=["onClick"],ns=["title"],os={class:"flex items-center gap-2"},rs=be({__name:"PdfTool",setup(de){const r=T(!1),w=T([]),e=T(null),P=T(""),$=async()=>{try{r.value=!0;const c=await mt();if(c.code===0){const v=c.data||[];w.value=v.map(m=>({...m,_decrypting:m.status==="processing"||!1,_password:""}))}else i.error(c.msg||"获取任务列表失败")}catch(c){h(c,"获取任务列表失败")}finally{r.value=!1}},C=c=>{c.raw&&(e.value=c.raw,P.value=c.raw.name)},R=async()=>{if(!e.value){i.warning("请选择要上传的文件");return}const c=e.value;if(!c.name.toLowerCase().endsWith(".pdf")){i.error("只支持 PDF 文件");return}try{r.value=!0;const v=await gt(c);v.code===0?(i.success("文件上传成功"),e.value=null,P.value="",await $()):i.error(v.msg||"文件上传失败")}catch(v){h(v,"文件上传失败")}finally{r.value=!1}},k=async c=>{if(!c.uploaded_info){i.warning("请先上传文件");return}if(!(c._decrypting||c.status==="processing")&&!(c.status==="success"&&!await ee.confirm("已解密的文件已存在，是否重新解密？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{c._decrypting=!0;const v=c._password?.trim()||void 0,m=await yt(c.task_id,v);m.code===0?(i.success(m.data?.message||"解密任务已提交，正在后台处理"),c._password="",await K(c)):i.error(m.msg||"提交解密任务失败")}catch(v){h(v,"提交解密任务失败")}finally{c._decrypting=!1}},K=async(c,v=30)=>{let m=0;const I=async()=>{if(m>=v){i.warning("任务处理超时，请手动刷新查看状态"),await $();return}try{const M=await kt(c.task_id);if(M.code===0){const V=M.data;c.status=V.status,c.unlocked_info=V.unlocked_info,c.error_message=V.error_message,V.status==="success"?(i.success("文件解密成功"),c._decrypting=!1,await $()):V.status==="failed"?(i.error(V.error_message||"文件解密失败"),c._decrypting=!1):V.status==="processing"?(m++,setTimeout(I,1e3)):c._decrypting=!1}}catch(M){h(M,"查询任务状态失败"),c._decrypting=!1}};I()},L=async(c,v)=>{const m=v==="uploaded"?c.uploaded_info:c.unlocked_info;if(!m){i.warning("文件不存在");return}try{const I=xt(m.name,v);window.open(I,"_blank")}catch(I){h(I,"下载文件失败")}},Y=async c=>{if(!c.uploaded_info){i.warning("请先上传文件");return}if(c.status==="processing"){i.warning("任务正在处理中，无法删除");return}if(await ee.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{r.value=!0;const m=await ht(c.task_id);m.code===0?(i.success(m.data?.message||"任务删除成功"),await $()):i.error(m.msg||"任务删除失败")}catch(m){h(m,"删除任务失败")}finally{r.value=!1}},O=Ie,q=c=>c?new Date(c*1e3).toLocaleString():"-";return Ve(()=>{$()}),(c,v)=>{const m=Be,I=et,M=Le,V=at,J=Ee,j=Ae,ae=lt,le=tt,te=st;return u(),p("div",At,[v[11]||(v[11]=a("h2",{class:"text-xl font-semibold mb-4"},"PDF 解密工具",-1)),a("div",Nt,[a("div",Ot,[a("div",null,[n(m,{type:"success",size:"small",onClick:R,loading:r.value,disabled:!e.value},{default:o(()=>[...v[0]||(v[0]=[b(" 上传 ",-1)])]),_:1},8,["loading","disabled"])]),n(I,{"auto-upload":!1,"on-change":C,"show-file-list":!1,accept:".pdf"},{trigger:o(()=>[n(m,{type:"primary",size:"small",class:"!m-0"},{default:o(()=>[...v[1]||(v[1]=[b("选择文件",-1)])]),_:1})]),_:1}),e.value?(u(),p("div",It,[a("div",{class:"text-sm text-gray-600 truncate",title:P.value||e.value.name},x(P.value||e.value.name),9,Kt)])):S("",!0)])]),n(le,{class:"flex-1 flex flex-col overflow-hidden",shadow:"hover"},{header:o(()=>[a("div",Yt,[v[3]||(v[3]=a("span",null,"文件列表",-1)),n(m,{type:"info",size:"small",plain:"",onClick:$,loading:r.value},{default:o(()=>[r.value?S("",!0):(u(),B(M,{key:0},{default:o(()=>[n(E(ze))]),_:1})),v[2]||(v[2]=b(" 刷新 ",-1))]),_:1},8,["loading"])])]),default:o(()=>[a("div",qt,[Xe((u(),B(ae,{data:w.value,stripe:"",class:"w-full"},{empty:o(()=>[...v[10]||(v[10]=[a("div",{class:"text-center text-gray-400 py-8"},"暂无文件，请上传 PDF 文件",-1)])]),default:o(()=>[n(V,{prop:"filename",label:"文件名","min-width":"200"},{default:o(({row:_})=>[_.uploaded_info?(u(),p("span",{key:0,class:"text-blue-600 cursor-pointer hover:underline",onClick:G=>L(_,"uploaded")},x(_.filename),9,Gt)):(u(),p("span",Jt,"-"))]),_:1}),n(V,{label:"上传文件","min-width":"150"},{default:o(({row:_})=>[_.uploaded_info?(u(),p("div",Ht,[a("span",Qt,x(E(O)(_.uploaded_info.size)),1),a("span",Wt,x(q(_.uploaded_info.modified)),1)])):(u(),p("span",Xt,"-"))]),_:1}),n(V,{label:"已解密文件","min-width":"150"},{default:o(({row:_})=>[_.unlocked_info?(u(),p("div",Zt,[a("span",es,x(E(O)(_.unlocked_info.size)),1),a("span",ts,x(q(_.unlocked_info.modified)),1)])):(u(),p("span",ss,"未解密"))]),_:1}),n(V,{label:"状态",width:"140",align:"center"},{default:o(({row:_})=>[a("div",as,[_.status==="success"?(u(),B(J,{key:0,type:"success",size:"small"},{default:o(()=>[...v[4]||(v[4]=[b("已解密",-1)])]),_:1})):_.status==="processing"?(u(),B(J,{key:1,type:"warning",size:"small"},{default:o(()=>[...v[5]||(v[5]=[b("处理中",-1)])]),_:1})):_.status==="pending"?(u(),B(J,{key:2,type:"info",size:"small"},{default:o(()=>[...v[6]||(v[6]=[b("等待中",-1)])]),_:1})):_.status==="failed"?(u(),B(J,{key:3,type:"danger",size:"small"},{default:o(()=>[...v[7]||(v[7]=[b("失败",-1)])]),_:1})):(u(),B(J,{key:4,type:"info",size:"small"},{default:o(()=>[...v[8]||(v[8]=[b("已上传",-1)])]),_:1})),_.unlocked_info?(u(),p("span",{key:5,class:"text-xs text-blue-600 cursor-pointer hover:underline",onClick:G=>L(_,"unlocked")}," 下载 ",8,ls)):S("",!0),_.error_message?(u(),p("span",{key:6,class:"text-xs text-red-500",title:_.error_message}," 错误 ",8,ns)):S("",!0)])]),_:1}),n(V,{label:"操作",width:"280",fixed:"right"},{default:o(({row:_})=>[a("div",os,[_.uploaded_info?(u(),B(j,{key:0,modelValue:_._password,"onUpdate:modelValue":G=>_._password=G,type:"password",size:"small",placeholder:"密码（可选）","show-password":"",clearable:"",class:"w-30",disabled:_._decrypting||_.status==="processing",onKeyup:De(G=>k(_),["enter"])},null,8,["modelValue","onUpdate:modelValue","disabled","onKeyup"])):S("",!0),_.uploaded_info&&_.status!=="processing"?(u(),B(m,{key:1,type:"primary",size:"small",onClick:G=>k(_),loading:_._decrypting,disabled:_._decrypting||_.status==="processing"},{default:o(()=>[b(x(_.status==="success"?"重新解密":"解密"),1)]),_:2},1032,["onClick","loading","disabled"])):S("",!0),_.uploaded_info?(u(),B(m,{key:2,type:"danger",size:"small",plain:"",onClick:G=>Y(_),disabled:_.status==="processing"},{default:o(()=>[...v[9]||(v[9]=[b(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])):S("",!0)])]),_:1})]),_:1},8,["data"])),[[te,r.value]])])]),_:1})])}}}),is={viewBox:"0 0 512 512",width:"1.2em",height:"1.2em"};function us(de,r){return u(),p("svg",is,[...r[0]||(r[0]=[a("path",{fill:"none",stroke:"currentColor","stroke-linecap":"square","stroke-width":"48",d:"m136 208l120-104l120 104m-240 96l120 104l120-104"},null,-1)])])}const ds=Ze({name:"ion-chevron-expand-sharp",render:us}),cs={class:"flex gap-4 h-full"},fs={class:"w-64 border rounded p-3 flex flex-col"},vs={class:"flex items-center justify-between mb-3"},ps={class:"flex items-center gap-1"},_s={key:0,class:"flex-1 overflow-y-auto space-y-2 pr-1 min-h-[400px]"},ms=["onClick"],gs={class:"flex items-center justify-between gap-2"},ys={class:"text-sm font-medium truncate flex-1 min-w-0"},xs={class:"text-xs text-gray-500 whitespace-nowrap flex items-center gap-1 flex-shrink-0"},hs={class:"whitespace-nowrap w-5 flex items-center justify-center"},ks={class:"flex items-center justify-between gap-2 min-h-[20px]"},bs={class:"flex items-center gap-1 flex-shrink-0"},ws={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},Cs={key:0,class:"flex-1 border rounded p-3 flex flex-col max-w-2xl"},Ts={class:"flex items-center justify-between mb-3 flex-shrink-0"},$s={class:"text-base font-semibold"},Ds={class:"text-sm text-gray-500"},Ms={class:"flex-1 overflow-auto flex flex-col gap-3"},Ps={class:"flex items-center justify-between gap-4 flex-shrink-0"},Fs={class:"flex items-center gap-4"},Ss={key:1,class:"text-red-500 text-xs"},Vs={class:"flex items-center gap-2"},Bs={class:"border rounded p-2 flex-1 flex flex-col overflow-hidden"},Es={class:"flex items-center justify-between mb-2 flex-shrink-0"},zs={class:"flex items-center gap-1 pr-1"},Ls={class:"flex-1 overflow-auto"},js={key:0},Us=["draggable","onDragstart","onDrop"],Rs={class:"text-xs text-gray-500 w-8"},As=["title"],Ns={key:0,class:"text-xs text-gray-500 whitespace-nowrap w-20 text-right"},Os={key:1,class:"w-20"},Is={key:1,class:"text-sm text-gray-400 text-center py-1"},Ks={key:1,class:"flex-1 border rounded p-3 flex flex-col max-w-2xl"},Ys=be({__name:"MediaTool",setup(de){const r=T(!1),w=T([]),e=T(null),P=T(!1),$=T(!1),C=T(!1),R=T(null),k=jt({callbacks:{onPlay:()=>{i.success("开始播放")},onError:()=>{h(new Error("音频播放失败"),"播放失败"),W()},onEnded:()=>{W()}}}),K={size:"small",plain:!0,class:"!w-8 !h-6 !p-0"},L={size:"small",plain:!0,class:"!h-5 !text-xs !px-2"},Y={size:"small",plain:!0,class:"!h-7 !text-xs"},O=["bg-gray-100","border-t-2","border-b-2","border-blue-500"],q=t=>{t&&t.classList.remove(...O)},c=t=>{if(!t)return;t.querySelectorAll('[draggable="true"]').forEach(d=>q(d))},v=async t=>{if(e.value&&t.length!==0)try{r.value=!0;for(const s of t){const d=await bt(e.value.task_id,s);if(d.code!==0){i.error(`添加文件失败: ${d.msg||"未知错误"}`);break}}i.success(`成功添加 ${t.length} 个文件`),await M(e.value.task_id)}catch(s){h(s,"添加文件失败")}finally{r.value=!1}},m=async()=>{try{r.value=!0;const t=await wt();t.code===0?(w.value=t.data.tasks||[],w.value.length>0&&!e.value&&await M(w.value[0].task_id)):i.error(t.msg||"获取任务列表失败")}catch(t){h(t,"获取任务列表失败")}finally{r.value=!1}},I=async()=>{try{r.value=!0;const t=await Ct();t.code===0?(i.success("任务创建成功"),await m(),M(t.data.task_id)):i.error(t.msg||"创建任务失败")}catch(t){h(t,"创建任务失败")}finally{r.value=!1}},M=async t=>{e.value&&e.value.task_id!==t&&ne();try{r.value=!0;const s=await Tt(t);s.code===0?e.value=s.data:i.error(s.msg||"获取任务信息失败")}catch(s){h(s,"获取任务信息失败")}finally{r.value=!1}},V=async t=>{if(await ee.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{r.value=!0;const d=await Pt(t);d.code===0?(i.success("任务删除成功"),await m(),e.value&&e.value.task_id===t&&(w.value&&w.value.length>0?await M(w.value[0].task_id):e.value=null)):i.error(d.msg||"删除任务失败")}catch(d){h(d,"删除任务失败")}finally{r.value=!1}},J=()=>{if(!e.value){i.warning("请先创建或选择任务");return}P.value=!0},j=async t=>{if(!(!e.value||!await ee.confirm("确定要删除该文件吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{r.value=!0;const d=await Ft(e.value.task_id,t);d.code===0?(k.playingFileIndex.value===t?ne():k.playingFileIndex.value!==null&&k.playingFileIndex.value>t&&(k.playingFileIndex.value=k.playingFileIndex.value-1),i.success("文件删除成功"),await M(e.value.task_id)):i.error(d.msg||"删除文件失败")}catch(d){h(d,"删除文件失败")}finally{r.value=!1}},ae=async()=>{if(!(!e.value||!await ee.confirm(`确定要开始合成吗？将合并 ${U.value} 个音频文件。`,"确认合成",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{r.value=!0;const s=await $t(e.value.task_id);s.code===0?(i.success("合成任务已启动"),await m(),await M(e.value.task_id),_()):i.error(s.msg||"启动任务失败")}catch(s){h(s,"启动任务失败")}finally{r.value=!1}},{start:le,stop:te}=Ke(async()=>{if(!e.value||e.value.status!=="processing"){te();return}await m(),await M(e.value.task_id)},Ut,{immediate:!1}),_=()=>{le()},G=t=>{if(!t)return;const s=St(t);window.open(s,"_blank")},we=()=>{e.value?.result_file&&G(e.value.task_id)},Ce=t=>{t?.result_file&&G(t.task_id)},W=()=>{k.clear()},ce=(t,s)=>{if(!t)return;const d=t?.path||t?.name||"";k.seekFile(d,s)},Te=(t,s)=>{e.value?.result_file&&ce({path:e.value.result_file},s)},fe=t=>{if(!e.value||!e.value.files||t<0||t>=e.value.files.length)return;const s=e.value.files[t],d=s.path||s.name||"";if(!d){i.warning("文件路径不存在");return}if(k.playingFilePath.value===d&&k.audio&&!k.audio.paused){W(),i.info("已停止播放");return}const D=je(d);if(!D){i.error("无法生成媒体文件URL");return}k.load(D,{playingFilePath:d,playingFileIndex:t}),k.play().catch(H=>{h(H,"播放失败"),W()})},ne=()=>{W()},ve=()=>{if(!e.value||!e.value.result_file){i.warning("结果文件不存在");return}const t=e.value.result_file;if(k.playingFilePath.value===t&&k.audio&&!k.audio.paused){W(),i.info("已停止播放");return}const s=je(t);if(!s){i.error("无法生成媒体文件URL");return}k.load(s,{playingFilePath:t}),k.play().catch(d=>{h(d,"播放失败"),W()})},pe=()=>{if(!e.value||!e.value.result_file){i.warning("结果文件不存在");return}$.value=!0},_e=async t=>{if(!e.value||!e.value.result_file)return;if(t.length===0){i.warning("请选择转存目录");return}const s=t[0];try{r.value=!0;const d=await Dt(e.value.task_id,s);d.code===0?(i.success("转存成功"),$.value=!1):i.error(d.msg||"转存失败")}catch(d){h(d,"转存失败")}finally{r.value=!1}},oe=Ie,me={pending:{tag:"info",text:"等待中"},processing:{tag:"warning",text:"处理中"},success:{tag:"success",text:"成功"},failed:{tag:"danger",text:"失败"}},X=t=>me[t]?.tag||"info",f=t=>me[t]?.text||"未知",l=N(()=>e.value?.status==="processing"),F=N(()=>(e.value?.files||[]).length>0),U=N(()=>(e.value?.files||[]).length),se=N(()=>e.value?.result_file),ge=N(()=>!se.value||e.value?.status!=="success"||C.value),re=N(()=>!F.value||l.value||C.value),ie=N(()=>l.value||C.value),ye=N(()=>!e.value||!F.value||l.value),xe=N(()=>C.value?"点击退出拖拽排序模式":"点击进入拖拽排序模式"),he=N(()=>({path:se.value||""})),g=(t,s)=>!t||!s||t.length!==s.length?!0:t.some((d,D)=>{const H=d?.path||d?.name,ue=s[D]?.path||s[D]?.name;return H!==ue}),$e=async()=>{if(C.value){if(e.value&&e.value.files&&e.value.files.length>0){if(g(R.value||[],e.value.files))try{r.value=!0;const s=e.value.files.map((D,H)=>H),d=await Mt(e.value.task_id,s);d.code===0?(i.success("排序已保存"),await M(e.value.task_id)):i.error(d.msg||"保存排序失败")}catch(s){h(s,"保存排序失败")}finally{r.value=!1}R.value=null}}else e.value&&e.value.files&&e.value.files.length>0&&(R.value=[...e.value.files||[]]);C.value=!C.value},Ye=(t,s)=>{if(!C.value)return t.preventDefault(),!1;try{t.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",s.toString()))}catch(d){console.error("拖拽开始失败:",d)}},qe=t=>{t.currentTarget&&q(t.currentTarget)},Ge=t=>{t.currentTarget&&q(t.currentTarget)},Je=t=>{if(C.value&&(t.preventDefault(),t.dataTransfer&&(t.dataTransfer.dropEffect="move"),t.currentTarget)){const s=t.currentTarget.getBoundingClientRect(),d=t.clientY,D=s.top+s.height/2;q(t.currentTarget),d<D?t.currentTarget.classList.add("border-t-2","border-blue-500"):t.currentTarget.classList.add("border-b-2","border-blue-500")}},He=(t,s)=>{if(!C.value||(t.preventDefault(),t.currentTarget&&(q(t.currentTarget),c(t.currentTarget.parentElement)),!t.dataTransfer))return;const d=parseInt(t.dataTransfer.getData("text/plain"),10);if(d===s||isNaN(d)||!e.value||!e.value.files||d<0||d>=e.value.files.length||s<0||s>=e.value.files.length)return;const D=t.currentTarget?.getBoundingClientRect(),H=t.clientY,ue=D?D.top+D.height/2:0,y=H<ue?s:s+1,A=[...e.value.files||[]],[Q]=A.splice(d,1),We=d<y?y-1:y;A.splice(We,0,Q),e.value={...e.value,files:A}},Qe=()=>{P.value=!1};return Ve(()=>{m()}),Re(()=>{ne(),te()}),(t,s)=>{const d=Le,D=Be,H=Ee,ue=ds;return u(),p("div",cs,[a("div",fs,[a("div",vs,[s[7]||(s[7]=a("h3",{class:"text-base font-semibold"},"任务列表",-1)),a("div",ps,[n(D,z({type:"info"},K,{onClick:m,loading:r.value}),{default:o(()=>[r.value?S("",!0):(u(),B(d,{key:0},{default:o(()=>[n(E(ze))]),_:1}))]),_:1},16,["loading"]),n(D,z({type:"success"},K,{onClick:I,loading:r.value}),{default:o(()=>[n(d,null,{default:o(()=>[n(E(Ne))]),_:1})]),_:1},16,["loading"])])]),w.value&&w.value.length>0?(u(),p("div",_s,[(u(!0),p(Me,null,Pe(w.value,y=>(u(),p("div",{key:y.task_id,class:Fe(["border rounded px-3 py-2 cursor-pointer hover:bg-gray-50 group min-h-[60px] flex flex-col justify-between",{"border-blue-500 bg-blue-50":e.value&&y.task_id===e.value.task_id}]),onClick:A=>M(y.task_id)},[a("div",gs,[a("div",ys,x(y.name),1),a("span",xs,[n(d,null,{default:o(()=>[n(E(nt),{class:"!w-3 !h-3"})]),_:1}),a("span",hs,x(y.files?y.files.length:0),1)])]),a("div",ks,[n(H,{type:X(y.status),size:"small",class:"!h-5 !text-xs w-16 text-center"},{default:o(()=>[b(x(f(y.status)),1)]),_:2},1032,["type"]),a("div",bs,[y.status==="success"&&y.result_file?(u(),B(D,z({key:0,type:"primary"},{ref_for:!0},L,{onClick:Z(A=>Ce(y),["stop"])}),{default:o(()=>[...s[8]||(s[8]=[b(" 下载 ",-1)])]),_:1},16,["onClick"])):S("",!0),n(D,z({type:"danger"},{ref_for:!0},L,{onClick:Z(A=>V(y.task_id),["stop"]),disabled:y.status==="processing"}),{default:o(()=>[n(d,null,{default:o(()=>[n(E(Oe))]),_:1})]),_:1},16,["onClick","disabled"])])])],10,ms))),128))])):(u(),p("div",ws,' 暂无任务，请点击"新建"创建 '))]),e.value?(u(),p("div",Cs,[a("div",Ts,[a("h3",$s,"任务详情: "+x(e.value.name),1),a("span",Ds," 共 "+x(U.value)+" 个文件 ",1)]),a("div",Ms,[a("div",Ps,[a("div",Fs,[n(H,{type:X(e.value.status),size:"small",class:"w-16 text-center"},{default:o(()=>[b(x(f(e.value.status)),1)]),_:1},8,["type"]),se.value?(u(),B(Ue,{key:0,file:he.value,player:E(k),disabled:C.value,onPlay:ve,onSeek:Te},null,8,["file","player","disabled"])):S("",!0),n(D,z({type:"primary"},Y,{onClick:we,disabled:ge.value}),{default:o(()=>[...s[9]||(s[9]=[b(" 下载 ",-1)])]),_:1},16,["disabled"]),n(D,z({type:"success"},Y,{onClick:pe,disabled:ge.value}),{default:o(()=>[...s[10]||(s[10]=[b(" 转存 ",-1)])]),_:1},16,["disabled"]),e.value.error_message?(u(),p("span",Ss," 错误: "+x(e.value.error_message),1)):S("",!0)]),a("div",Vs,[n(D,z({type:"success"},Y,{onClick:ae,disabled:re.value,loading:l.value}),{default:o(()=>[...s[11]||(s[11]=[b(" 开始合成 ",-1)])]),_:1},16,["disabled","loading"])])]),a("div",Bs,[a("div",Es,[s[13]||(s[13]=a("h4",{class:"text-sm font-semibold"},"文件列表",-1)),a("div",zs,[n(D,z({type:"primary"},L,{disabled:ie.value,onClick:J}),{default:o(()=>[...s[12]||(s[12]=[b(" + ",-1)])]),_:1},16,["disabled"]),n(D,z({type:C.value?"success":"default"},K,{onClick:$e,disabled:ye.value,title:xe.value}),{default:o(()=>[C.value?(u(),B(d,{key:0},{default:o(()=>[n(E(ot))]),_:1})):(u(),B(ue,{key:1,class:"!w-3.5 !h-3.5"}))]),_:1},16,["type","disabled","title"])])]),a("div",Ls,[F.value?(u(),p("div",js,[(u(!0),p(Me,null,Pe(e.value.files,(y,A)=>(u(),p("div",{key:A,class:Fe(["flex items-center gap-2 p-1 hover:bg-gray-100 rounded",{"cursor-move":C.value,"cursor-default":!C.value,"select-none":!0}]),draggable:C.value,onDragstart:Q=>Ye(Q,Number(A)),onDragend:s[2]||(s[2]=Q=>qe(Q)),onDragover:s[3]||(s[3]=Z(Q=>Je(Q),["prevent"])),onDragleave:Ge,onDrop:Z(Q=>He(Q,Number(A)),["prevent"])},[a("span",Rs,x(Number(A)+1),1),a("span",{class:"flex-1 text-sm truncate",title:y.path||y.name},x(y.name),9,As),y.size?(u(),p("span",Ns,x(E(oe)(y.size)),1)):(u(),p("div",Os)),a("div",{class:"flex items-center gap-1 flex-shrink-0",onMousedown:s[0]||(s[0]=Z(()=>{},["stop"])),onClick:s[1]||(s[1]=Z(()=>{},["stop"]))},[n(Ue,{file:y,player:E(k),disabled:ie.value,onPlay:()=>fe(Number(A)),onSeek:ce},null,8,["file","player","disabled","onPlay"]),n(D,{type:"info",size:"small",plain:"",circle:"",onClick:Z(Q=>j(Number(A)),["stop"]),disabled:ie.value,class:"!h-6 !text-xs"},{default:o(()=>[n(d,null,{default:o(()=>[n(E(rt))]),_:1})]),_:1},8,["onClick","disabled"])],32)],42,Us))),128))])):(u(),p("div",Is,"文件列表为空"))])])])])):(u(),p("div",Ks,[...s[14]||(s[14]=[a("div",{class:"flex items-center justify-between mb-3 flex-shrink-0"},[a("h3",{class:"text-base font-semibold"},"任务详情")],-1),a("div",{class:"flex-1 flex items-center justify-center text-sm text-gray-400"}," 请从左侧选择一个任务查看详情 ",-1)])])),n(Se,{visible:P.value,"onUpdate:visible":s[4]||(s[4]=y=>P.value=y),title:"选择文件添加到任务","confirm-button-text":"添加","confirm-loading":r.value,onConfirm:v,onClose:Qe},null,8,["visible","confirm-loading"]),n(Se,{visible:$.value,"onUpdate:visible":s[5]||(s[5]=y=>$.value=y),title:"选择转存目录","confirm-button-text":"转存",mode:"directory","confirm-loading":r.value,onConfirm:_e,onClose:s[6]||(s[6]=y=>$.value=!1)},null,8,["visible","confirm-loading"])])}}}),qs={class:"flex gap-4 h-full"},Gs={class:"w-64 border rounded p-3 flex flex-col"},Js={class:"flex items-center justify-between mb-3"},Hs={class:"flex items-center gap-1"},Qs={key:0,class:"flex-1 overflow-y-auto space-y-2 pr-1 min-h-[400px]"},Ws=["onClick"],Xs={class:"flex items-center justify-between gap-2"},Zs=["title"],ea={class:"flex items-center justify-between gap-2 min-h-[20px]"},ta={class:"flex items-center gap-1 flex-shrink-0"},sa={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400 min-h-[400px]"},aa={key:0,class:"flex-1 border rounded p-3 flex flex-col max-w-2xl"},la={class:"flex items-center justify-between mb-3 flex-shrink-0"},na={class:"flex items-center gap-2 flex-1"},oa={class:"text-base font-semibold"},ra={class:"flex-1 overflow-auto flex flex-col gap-3"},ia={class:"flex items-center justify-between gap-4 flex-shrink-0"},ua={class:"flex items-center gap-4"},da={key:0,class:"text-red-500 text-xs"},ca={class:"flex items-center gap-3"},fa={class:"flex items-center gap-2"},va={class:"border rounded p-3 flex flex-col gap-2"},pa={class:"flex items-center justify-between"},_a={key:0,class:"text-sm text-gray-600 flex flex-col gap-1"},ma=["title"],ga={key:0,class:"text-xs text-gray-500"},ya={key:1,class:"text-sm text-gray-400"},xa={class:"border rounded p-3 flex flex-col gap-2"},ha={class:"flex items-center gap-2"},ka={key:0,class:"border rounded p-3 flex flex-col gap-2"},ba={key:0,class:"space-y-2"},wa={class:"text-sm text-gray-600"},Ca=["title"],Ta={key:1,class:"text-sm text-gray-400"},$a={key:1,class:"border rounded p-3 flex flex-col gap-2"},Da={class:"text-sm text-gray-600"},Ma={key:0,class:"mt-2"},Pa={key:1,class:"flex-1 border rounded p-3 flex flex-col max-w-2xl"},Fa=be({__name:"AudioConvertTool",setup(de){const r=T(!1),w=T([]),e=T(null),P=T(!1),$=T("mp3"),C=T(!1),R=T(!0),k=T(!1),K=T(!1),L=T(""),Y=T(!1),O=T(""),q={size:"small",plain:!0,class:"!w-8 !h-6 !p-0"},c={size:"small",plain:!0,class:"!h-5 !text-xs !px-2"},v={size:"small",plain:!0,class:"!h-7 !text-xs"},m=async()=>{try{r.value=!0;const f=await Vt();f.code===0?(w.value=f.data.tasks||[],w.value.length>0&&!e.value&&await j(w.value[0].task_id)):i.error(f.msg||"获取任务列表失败")}catch(f){h(f,"获取任务列表失败")}finally{r.value=!1}},I=()=>{L.value="",K.value=!0},M=async()=>{if(!L.value.trim()){i.warning("请输入任务名称");return}try{r.value=!0;const f=await Bt({name:L.value.trim()});f.code===0?(i.success("任务创建成功"),K.value=!1,L.value="",await m(),j(f.data.task_id)):i.error(f.msg||"创建任务失败")}catch(f){h(f,"创建任务失败")}finally{r.value=!1}},V=()=>{e.value&&(O.value=e.value.name,Y.value=!0)},J=async()=>{if(e.value){if(!O.value.trim()){i.warning("请输入任务名称");return}try{r.value=!0;const f=await ke(e.value.task_id,{name:O.value.trim()});f.code===0?(i.success("任务名称修改成功"),Y.value=!1,O.value="",await j(e.value.task_id)):i.error(f.msg||"修改任务名称失败")}catch(f){h(f,"修改任务名称失败")}finally{r.value=!1}}},j=async f=>{try{r.value=!0;const l=await Et(f);l.code===0?(e.value=l.data,$.value=l.data.output_dir||"mp3",C.value=!1,R.value=l.data.overwrite!==!1,k.value=!1):i.error(l.msg||"获取任务信息失败")}catch(l){h(l,"获取任务信息失败")}finally{r.value=!1}},ae=async f=>{if(await ee.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{r.value=!0;const F=await Lt(f);F.code===0?(i.success("任务删除成功"),await m(),e.value&&e.value.task_id===f&&(w.value&&w.value.length>0?await j(w.value[0].task_id):e.value=null)):i.error(F.msg||"删除任务失败")}catch(F){h(F,"删除任务失败")}finally{r.value=!1}},le=()=>{if(!e.value){i.warning("请先创建或选择任务");return}P.value=!0},te=async f=>{if(!e.value||f.length===0)return;const l=f[0];try{r.value=!0;const F=await ke(e.value.task_id,{directory:l});F.code===0?(i.success("目录设置成功"),await j(e.value.task_id),P.value=!1):i.error(F.msg||"设置目录失败")}catch(F){h(F,"设置目录失败")}finally{r.value=!1}},_=()=>{P.value=!1},G=()=>{if(!e.value)return;const f=e.value.output_dir||"mp3";C.value=$.value!==f},we=async()=>{if(e.value){if(!$.value.trim()){i.error("输出目录名称不能为空");return}try{r.value=!0;const f=await ke(e.value.task_id,{output_dir:$.value.trim()});f.code===0?(i.success("输出目录名称保存成功"),await j(e.value.task_id)):i.error(f.msg||"保存输出目录名称失败")}catch(f){h(f,"保存输出目录名称失败")}finally{r.value=!1}}},Ce=()=>{if(!e.value)return;const f=e.value.overwrite!==!1;k.value=R.value!==f,k.value&&W()},W=async()=>{if(e.value)try{r.value=!0;const f=await ke(e.value.task_id,{overwrite:R.value});f.code===0?(i.success("覆盖选项保存成功"),await j(e.value.task_id)):i.error(f.msg||"保存覆盖选项失败")}catch(f){h(f,"保存覆盖选项失败")}finally{r.value=!1}},ce=async()=>{if(!e.value)return;if(!e.value.directory){i.warning("请先选择转码目录");return}if(await ee.confirm(`确定要开始转码吗？将转换目录 "${e.value.directory}" 下的所有音频文件为 MP3 格式。`,"确认转码",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{r.value=!0;const l=await zt(e.value.task_id);l.code===0?(i.success("转码任务已启动"),await m(),await j(e.value.task_id),ne()):i.error(l.msg||"启动任务失败")}catch(l){h(l,"启动任务失败")}finally{r.value=!1}},{start:Te,stop:fe}=Ke(async()=>{if(!e.value||e.value.status!=="processing"){fe();return}await m(),await j(e.value.task_id)},Rt,{immediate:!1}),ne=()=>{Te()},ve={pending:{tag:"info",text:"等待中"},processing:{tag:"warning",text:"处理中"},success:{tag:"success",text:"成功"},failed:{tag:"danger",text:"失败"}},pe=f=>ve[f]?.tag||"info",_e=f=>ve[f]?.text||"未知",oe=N(()=>e.value?.status==="processing"),me=N(()=>!e.value?.directory||oe.value),X=N(()=>oe.value);return Ve(()=>{m()}),Re(()=>{fe()}),(f,l)=>{const F=Le,U=Be,se=Ee,ge=ut,re=Ae,ie=dt,ye=vt,xe=ft,he=ct;return u(),p("div",qs,[a("div",Gs,[a("div",Js,[l[11]||(l[11]=a("h3",{class:"text-base font-semibold"},"任务列表",-1)),a("div",Hs,[n(U,z({type:"info"},q,{onClick:m,loading:r.value}),{default:o(()=>[r.value?S("",!0):(u(),B(F,{key:0},{default:o(()=>[n(E(ze))]),_:1}))]),_:1},16,["loading"]),n(U,z({type:"success"},q,{onClick:I,loading:r.value}),{default:o(()=>[n(F,null,{default:o(()=>[n(E(Ne))]),_:1})]),_:1},16,["loading"])])]),w.value&&w.value.length>0?(u(),p("div",Qs,[(u(!0),p(Me,null,Pe(w.value,g=>(u(),p("div",{key:g.task_id,class:Fe(["border rounded px-3 py-2 cursor-pointer hover:bg-gray-50 group min-h-[60px] flex flex-col justify-between",{"border-blue-500 bg-blue-50":e.value&&g.task_id===e.value.task_id}]),onClick:$e=>j(g.task_id)},[a("div",Xs,[a("div",{class:"text-sm font-medium truncate flex-1 min-w-0",title:g.name},x(g.name),9,Zs)]),a("div",ea,[n(se,{type:pe(g.status),size:"small",class:"!h-5 !text-xs w-16 text-center"},{default:o(()=>[b(x(_e(g.status)),1)]),_:2},1032,["type"]),a("div",ta,[n(U,z({type:"danger"},{ref_for:!0},c,{onClick:Z($e=>ae(g.task_id),["stop"]),disabled:g.status==="processing"}),{default:o(()=>[n(F,null,{default:o(()=>[n(E(Oe))]),_:1})]),_:1},16,["onClick","disabled"])])])],10,Ws))),128))])):(u(),p("div",sa,' 暂无任务，请点击"新建"创建 '))]),e.value?(u(),p("div",aa,[a("div",la,[a("div",na,[a("h3",oa,"任务详情: "+x(e.value.name),1),n(U,{type:"default",size:"small",plain:"",circle:"",disabled:X.value,onClick:V,title:"编辑名称"},{default:o(()=>[n(F,null,{default:o(()=>[n(E(it))]),_:1})]),_:1},8,["disabled"])])]),a("div",ra,[a("div",ia,[a("div",ua,[n(se,{type:pe(e.value.status),size:"small",class:"w-16 text-center"},{default:o(()=>[b(x(_e(e.value.status)),1)]),_:1},8,["type"]),e.value.error_message?(u(),p("span",da," 错误: "+x(e.value.error_message),1)):S("",!0)]),a("div",ca,[a("div",fa,[l[12]||(l[12]=a("span",{class:"text-sm text-gray-600"},"覆盖同名文件",-1)),n(ge,{modelValue:R.value,"onUpdate:modelValue":l[0]||(l[0]=g=>R.value=g),disabled:X.value,onChange:Ce},null,8,["modelValue","disabled"])]),n(U,z({type:"success"},v,{onClick:ce,disabled:me.value,loading:oe.value}),{default:o(()=>[...l[13]||(l[13]=[b(" 开始转码 ",-1)])]),_:1},16,["disabled","loading"])])]),a("div",va,[a("div",pa,[l[15]||(l[15]=a("h4",{class:"text-sm font-semibold"},"转码目录",-1)),n(U,z({type:"primary"},c,{disabled:X.value,onClick:le}),{default:o(()=>[...l[14]||(l[14]=[b(" 选择目录 ",-1)])]),_:1},16,["disabled"])]),e.value.directory?(u(),p("div",_a,[a("div",{class:"truncate",title:e.value.directory},x(e.value.directory),9,ma),e.value.total_files!==null&&e.value.total_files!==void 0?(u(),p("div",ga," 可处理文件数: "+x(e.value.total_files),1)):S("",!0)])):(u(),p("div",ya," 请选择一个目录，该目录下的所有媒体文件将被转换为 MP3 格式 "))]),a("div",xa,[l[17]||(l[17]=a("div",{class:"flex items-center justify-between"},[a("h4",{class:"text-sm font-semibold"},"输出目录名称")],-1)),a("div",ha,[n(re,{modelValue:$.value,"onUpdate:modelValue":l[1]||(l[1]=g=>$.value=g),placeholder:"输出目录名称",size:"small",disabled:X.value,onBlur:G},null,8,["modelValue","disabled"]),n(U,z({type:"primary"},c,{disabled:X.value||!C.value,onClick:we}),{default:o(()=>[...l[16]||(l[16]=[b(" 保存 ",-1)])]),_:1},16,["disabled"])]),l[18]||(l[18]=a("div",{class:"text-xs text-gray-400"},' 转码后的文件将保存在转码目录下的此文件夹中，默认为 "mp3" ',-1))]),e.value.status==="processing"||e.value.progress?(u(),p("div",ka,[l[19]||(l[19]=a("h4",{class:"text-sm font-semibold"},"转码进度",-1)),e.value.progress?(u(),p("div",ba,[a("div",wa," 已处理: "+x(e.value.progress.processed??0)+" / "+x(e.value.progress.total??0),1),n(ie,{percentage:(e.value.progress.total??0)>0?Math.round((e.value.progress.processed??0)/(e.value.progress.total??1)*100):0,status:e.value.status==="processing"?void 0:"success"},null,8,["percentage","status"]),e.value.progress.current_file?(u(),p("div",{key:0,class:"text-xs text-gray-500 truncate",title:e.value.progress.current_file}," 正在处理: "+x(e.value.progress.current_file),9,Ca)):S("",!0)])):(u(),p("div",Ta,"等待开始转码..."))])):S("",!0),e.value.status==="success"?(u(),p("div",$a,[l[21]||(l[21]=a("h4",{class:"text-sm font-semibold"},"转码结果",-1)),a("div",Da,[l[20]||(l[20]=a("div",null,"转码完成！所有文件已保存到目录下的 mp3 文件夹中",-1)),e.value.progress?(u(),p("div",Ma," 共转换 "+x(e.value.progress.total||0)+" 个文件 ",1)):S("",!0)])])):S("",!0)])])):(u(),p("div",Pa,[...l[22]||(l[22]=[a("div",{class:"flex items-center justify-between mb-3 flex-shrink-0"},[a("h3",{class:"text-base font-semibold"},"任务详情")],-1),a("div",{class:"flex-1 flex items-center justify-center text-sm text-gray-400"}," 请从左侧选择一个任务查看详情 ",-1)])])),n(Se,{visible:P.value,"onUpdate:visible":l[2]||(l[2]=g=>P.value=g),title:"选择转码目录","confirm-button-text":"确定",mode:"directory","default-path":e.value?.directory||void 0,"confirm-loading":r.value,onConfirm:te,onClose:_},null,8,["visible","default-path","confirm-loading"]),n(he,{modelValue:K.value,"onUpdate:modelValue":l[5]||(l[5]=g=>K.value=g),title:"创建转码任务",width:"400px",onClose:l[6]||(l[6]=g=>L.value="")},{footer:o(()=>[n(U,{onClick:l[4]||(l[4]=g=>K.value=!1)},{default:o(()=>[...l[23]||(l[23]=[b("取消",-1)])]),_:1}),n(U,{type:"primary",onClick:M,loading:r.value},{default:o(()=>[...l[24]||(l[24]=[b(" 确定 ",-1)])]),_:1},8,["loading"])]),default:o(()=>[n(xe,null,{default:o(()=>[n(ye,{label:"任务名称"},{default:o(()=>[n(re,{modelValue:L.value,"onUpdate:modelValue":l[3]||(l[3]=g=>L.value=g),placeholder:"请输入任务名称",onKeyup:De(M,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(he,{modelValue:Y.value,"onUpdate:modelValue":l[9]||(l[9]=g=>Y.value=g),title:"重命名任务",width:"400px",onClose:l[10]||(l[10]=g=>O.value="")},{footer:o(()=>[n(U,{onClick:l[8]||(l[8]=g=>Y.value=!1)},{default:o(()=>[...l[25]||(l[25]=[b("取消",-1)])]),_:1}),n(U,{type:"primary",onClick:J,loading:r.value},{default:o(()=>[...l[26]||(l[26]=[b(" 确定 ",-1)])]),_:1},8,["loading"])]),default:o(()=>[n(xe,null,{default:o(()=>[n(ye,{label:"任务名称"},{default:o(()=>[n(re,{modelValue:O.value,"onUpdate:modelValue":l[7]||(l[7]=g=>O.value=g),placeholder:"请输入任务名称",onKeyup:De(J,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),Sa={class:"p-1"},Ia=be({__name:"index",setup(de){const r=T("pdf_tool"),w=e=>{console.log("切换到页签:",e)};return(e,P)=>{const $=_t,C=pt;return u(),p("div",Sa,[n(C,{modelValue:r.value,"onUpdate:modelValue":P[0]||(P[0]=R=>r.value=R),onTabChange:w,class:"flex-1 flex flex-col overflow-hidden h-[calc(100vh-150px)]"},{default:o(()=>[n($,{label:"PDF 工具",name:"pdf_tool"},{default:o(()=>[n(rs)]),_:1}),n($,{label:"音频合成",name:"audio_merge"},{default:o(()=>[n(Ys)]),_:1}),n($,{label:"音频转码",name:"audio_convert"},{default:o(()=>[n(Fa)]),_:1})]),_:1},8,["modelValue"])])}}});export{Ia as default};
