import{m as Ne,r as I,B as Le,o as ae,Q as a,q as m,O as n,a1 as l,ae as X,G as Jl,t as B,N as Ce,ao as Ae,W,M as oe,u as r,bK as Ge,aW as at,P as Te,bL as Ql,S as $e,bM as ql,bN as Bt,Z as be,$ as Pe,b9 as qe,bw as gt,bi as ze,bO as At,aU as pt,aV as Xl,aI as Zl,c as ce,v as Re,bG as Tt,bP as es,af as Ie,bQ as ts,A as rt,D as Mt,f as tt,au as Ft}from"./vue-vendor-DIrWXCnL.js";import{e as se,b as Se,l as Xe}from"./index-D8BRhcwO.js";import{f as yt,c as ot,M as Et,_ as Lt,n as lt,u as ls,g as ss,a as ns}from"./useInterval-bXW1k5qT.js";import"./utils-C11zrYka.js";import{r as Ze,J as as,x as is,m as ht,d as Ve,E as M,K as os,L as rs,M as Nt,g as He,N as ds,O as us,P as cs,Q as bt,D as dt,I as fs,l as Ut,v as xt,k as Vt,q as zt,s as Ot,R as Rt,S as vs,T as ms,U as gs,V as Be}from"./element-plus-DKhpzu-P.js";import{g as Ye,f as ps,a as kt}from"./date-SVbh1ddk.js";import{g as ys,s as hs}from"./rds-LutXD4hC.js";import"./vant-CsaYtkgD.js";import"./vendor-DiwfJ622.js";function Ke(e,C,d){if(e==="*"||!e||typeof e!="string")return null;const v=new Set,A=String(e).split(",");for(const i of A){const s=i.trim();if(s.includes("/")){const[c,h]=s.split("/"),o=parseInt(h,10);if(c==="*")for(let S=C;S<=d;S+=o)v.add(S);else if(c.includes("-")){const[S,Q]=c.split("-").map(z=>parseInt(z,10));for(let z=S;z<=Q;z+=o)v.add(z)}}else if(s.includes("-")){const[c,h]=s.split("-").map(o=>parseInt(o,10));for(let o=c;o<=h;o++)v.add(o)}else{const c=parseInt(s,10);!isNaN(c)&&c>=C&&c<=d&&v.add(c)}}return v.size>0?Array.from(v).sort((i,s)=>i-s):null}function wt(e,C=3){try{if(!e||typeof e!="string")throw new Error("Cron 表达式必须是字符串类型");const d=String(e).trim().split(/\s+/);if(d.length!==6)throw new Error("Cron 表达式必须包含6个字段：秒 分 时 日 月 周");const[v,A,i,s,c,h]=d,o=Ke(v,0,59),S=Ke(A,0,59),Q=Ke(i,0,23),z=Ke(s,1,31),f=Ke(c,1,12);let t=Ke(h,0,7);t&&t.includes(7)&&(t=t.filter(O=>O!==7),t.includes(0)||t.push(0),t.sort((O,L)=>O-L));const k=[],w=new Date;w.setMilliseconds(0),o&&!o.includes(w.getSeconds())&&(w.setSeconds(0),w.setMinutes(w.getMinutes()+1));let le=0;const T=1e4;for(;k.length<C&&le<T;){le++;const O=w.getMonth()+1;if(f&&!f.includes(O)){let $=null;for(const p of f)if(p>O){$=p;break}$===null?($=f[0],w.setFullYear(w.getFullYear()+1,$-1,1),w.setHours(0,0,o?o[0]:0)):(w.setMonth($-1,1),w.setHours(0,0,o?o[0]:0));continue}const L=w.getDate(),te=w.getDay();let j=!0;if(s!=="*"&&h!=="*"?j=!!(z&&z.includes(L))||!!(t&&t.includes(te)):s!=="*"?j=z?z.includes(L):!1:h!=="*"&&(j=t?t.includes(te):!1),!j){w.setDate(w.getDate()+1),w.setHours(0,0,o?o[0]:0);continue}const re=w.getHours();if(Q&&!Q.includes(re)){let $=null;for(const p of Q)if(p>re){$=p;break}$===null?(w.setDate(w.getDate()+1),w.setHours(Q[0],0,o?o[0]:0)):w.setHours($,0,o?o[0]:0);continue}const N=w.getMinutes();if(S&&!S.includes(N)){let $=null;for(const p of S)if(p>N){$=p;break}if($===null){let p=null;for(const _ of Q||[re])if(_>re){p=_;break}p===null?(w.setDate(w.getDate()+1),w.setHours(Q?Q[0]:0,S[0],o?o[0]:0)):w.setHours(p,S[0],o?o[0]:0)}else w.setMinutes($,o?o[0]:0);continue}const b=w.getSeconds();if(o&&!o.includes(b)){let $=null;for(const p of o)if(p>b){$=p;break}$===null?(w.setMinutes(w.getMinutes()+1),w.setSeconds(o[0])):w.setSeconds($);continue}if(w>new Date){const $=w.getFullYear()+"-"+String(w.getMonth()+1).padStart(2,"0")+"-"+String(w.getDate()).padStart(2,"0")+" "+String(w.getHours()).padStart(2,"0")+":"+String(w.getMinutes()).padStart(2,"0")+":"+String(w.getSeconds()).padStart(2,"0");k.push($)}o&&o.length>0&&w.setSeconds(o[0]),w.setMinutes(w.getMinutes()+1)}return k.slice(0,C)}catch(d){throw console.error("计算 Cron 执行时间失败:",d),d}}function bs(e){const C=e.second==="custom"?e.secondCustom||"*":e.second||"*",d=e.minute==="custom"?e.minuteCustom||"*":e.minute||"*",v=e.hour==="custom"?e.hourCustom||"*":e.hour||"*",A=e.day==="custom"?e.dayCustom||"*":e.day||"*",i=e.month==="custom"?e.monthCustom||"*":e.month||"*",s=e.weekday==="custom"?e.weekdayCustom||"*":e.weekday||"*";return`${C} ${d} ${v} ${A} ${i} ${s}`}function xs(){return`pl_${Date.now()}_${Math.random().toString(36).slice(2,7)}`}const ws={class:"space-y-4 m-4"},Ds={class:"flex items-center gap-2"},$s={class:"flex items-center gap-2"},Cs={class:"flex items-center gap-2"},Fs={class:"flex items-center gap-2"},ks={class:"flex items-center gap-2"},_s={class:"flex items-center gap-2"},Ps={class:"border-t pt-4"},Ss={class:"flex gap-2"},Bs={class:"border-t pt-4"},As={class:"space-y-2"},Ts={class:"flex items-center gap-2 flex-wrap"},Ms=Ne({__name:"CronDialog",props:{visible:{type:Boolean,default:!1},initialCron:{default:""}},emits:["update:visible","apply","preview","close"],setup(e,{emit:C}){const d=e,v=C,A=I(d.visible),i=I({second:"*",secondCustom:"",minute:"*",minuteCustom:"",hour:"*",hourCustom:"",day:"*",dayCustom:"",month:"*",monthCustom:"",weekday:"*",weekdayCustom:"",generated:""}),s=f=>{f.second="*",f.secondCustom="",f.minute="*",f.minuteCustom="",f.hour="*",f.hourCustom="",f.day="*",f.dayCustom="",f.month="*",f.monthCustom="",f.weekday="*",f.weekdayCustom="",f.generated=""},c=(f,t)=>{try{if(!f||typeof f!="string"){s(t);return}const k=String(f).trim().split(/\s+/);let w,le,T,O,L,te;if(k.length===5){const[j,re,N,b,$]=k;j==="0"&&re&&re.startsWith("*/")?(w="0",le=re,T=N||"*",O=b||"*",L=$||"*",te="*"):(le=j,T=re,O=N,L=b,te=$,w="0")}else if(k.length===6)[w,le,T,O,L,te]=k;else{console.warn("Cron 表达式格式错误，部分数量:",k.length),s(t);return}k.length===5||k.length===6?(w==="*"?(t.second="*",t.secondCustom=""):w==="0"?(t.second="0",t.secondCustom=""):(t.second="custom",t.secondCustom=w),le==="*"?(t.minute="*",t.minuteCustom=""):le==="0"?(t.minute="0",t.minuteCustom=""):(le.startsWith("*/"),t.minute="custom",t.minuteCustom=le),T==="*"?(t.hour="*",t.hourCustom=""):T==="0"?(t.hour="0",t.hourCustom=""):(t.hour="custom",t.hourCustom=T),O==="*"?(t.day="*",t.dayCustom=""):(t.day="custom",t.dayCustom=O),L==="*"?(t.month="*",t.monthCustom=""):(t.month="custom",t.monthCustom=L),te==="*"?(t.weekday="*",t.weekdayCustom=""):te==="1-5"?(t.weekday="1-5",t.weekdayCustom=""):te==="0,6"||te==="6,0"?(t.weekday="0,6",t.weekdayCustom=""):(t.weekday="custom",t.weekdayCustom=te)):(console.warn("Cron 表达式格式错误，部分数量:",k.length),s(t))}catch(k){console.error("解析 Cron 表达式失败:",k),s(t)}},h=()=>{i.value.generated=bs(i.value)},o=()=>{A.value=!1,v("close")},S=()=>{if(!i.value.generated){M.warning("请先生成 Cron 表达式");return}v("apply",i.value.generated),o()},Q=()=>{const f=i.value.generated;if(!f){M.warning("请先生成 Cron 表达式");return}try{const t=wt(f,5);v("preview",t)}catch(t){se(t,"预览失败")}},z=f=>{try{c(f,i.value),h(),Jl(()=>{i.value.generated&&(v("apply",i.value.generated),M.success("示例已应用"))})}catch(t){se(t,"应用示例失败")}};return Le(()=>d.visible,f=>{A.value=f,f&&(d.initialCron?c(d.initialCron,i.value):s(i.value),h())},{immediate:!0}),Le(()=>d.initialCron,f=>{d.visible&&f&&(c(f,i.value),h())}),Le(A,f=>{f!==d.visible&&v("update:visible",f)}),(f,t)=>{const k=as,w=is,le=ht,T=Ve,O=Ze;return m(),ae(O,{modelValue:A.value,"onUpdate:modelValue":t[17]||(t[17]=L=>A.value=L),title:"Cron 表达式生成器",width:"700","before-close":o},{default:a(()=>[n("div",ws,[n("div",null,[t[22]||(t[22]=n("div",{class:"text-sm font-medium mb-2"},"秒 (0-59)",-1)),n("div",Ds,[l(w,{modelValue:i.value.second,"onUpdate:modelValue":t[0]||(t[0]=L=>i.value.second=L),onChange:h,class:"flex items-center"},{default:a(()=>[l(k,{label:"*",class:"!w-[80px]"},{default:a(()=>[...t[18]||(t[18]=[X("每秒钟",-1)])]),_:1}),l(k,{label:"0",class:"!w-[80px]"},{default:a(()=>[...t[19]||(t[19]=[X("第0秒",-1)])]),_:1}),l(k,{label:"30",class:"!w-[80px]"},{default:a(()=>[...t[20]||(t[20]=[X("第30秒",-1)])]),_:1}),l(k,{label:"custom",class:"!w-[80px]"},{default:a(()=>[...t[21]||(t[21]=[X("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),l(le,{modelValue:i.value.secondCustom,"onUpdate:modelValue":t[1]||(t[1]=L=>i.value.secondCustom=L),placeholder:"例如: 0,30 或 */10",disabled:i.value.second!=="custom",class:"!w-[200px]",onInput:h},null,8,["modelValue","disabled"])])]),n("div",null,[t[27]||(t[27]=n("div",{class:"text-sm font-medium mb-2"},"分 (0-59)",-1)),n("div",$s,[l(w,{modelValue:i.value.minute,"onUpdate:modelValue":t[2]||(t[2]=L=>i.value.minute=L),onChange:h,class:"flex items-center"},{default:a(()=>[l(k,{label:"*",class:"!w-[80px]"},{default:a(()=>[...t[23]||(t[23]=[X("每分钟",-1)])]),_:1}),l(k,{label:"0",class:"!w-[80px]"},{default:a(()=>[...t[24]||(t[24]=[X("第0分",-1)])]),_:1}),l(k,{label:"30",class:"!w-[80px]"},{default:a(()=>[...t[25]||(t[25]=[X("第30分",-1)])]),_:1}),l(k,{label:"custom",class:"!w-[80px]"},{default:a(()=>[...t[26]||(t[26]=[X("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),l(le,{modelValue:i.value.minuteCustom,"onUpdate:modelValue":t[3]||(t[3]=L=>i.value.minuteCustom=L),placeholder:"例如: 0,30 或 */15",disabled:i.value.minute!=="custom",class:"!w-[200px]",onInput:h},null,8,["modelValue","disabled"])])]),n("div",null,[t[32]||(t[32]=n("div",{class:"text-sm font-medium mb-2"},"时 (0-23)",-1)),n("div",Cs,[l(w,{modelValue:i.value.hour,"onUpdate:modelValue":t[4]||(t[4]=L=>i.value.hour=L),onChange:h,class:"flex items-center"},{default:a(()=>[l(k,{label:"*",class:"!w-[80px]"},{default:a(()=>[...t[28]||(t[28]=[X("每小时",-1)])]),_:1}),l(k,{label:"0",class:"!w-[80px]"},{default:a(()=>[...t[29]||(t[29]=[X("0点",-1)])]),_:1}),l(k,{label:"9",class:"!w-[80px]"},{default:a(()=>[...t[30]||(t[30]=[X("9点",-1)])]),_:1}),l(k,{label:"custom",class:"!w-[80px]"},{default:a(()=>[...t[31]||(t[31]=[X("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),l(le,{modelValue:i.value.hourCustom,"onUpdate:modelValue":t[5]||(t[5]=L=>i.value.hourCustom=L),placeholder:"例如: 9,12,18 或 */2",disabled:i.value.hour!=="custom",class:"!w-[200px]",onInput:h},null,8,["modelValue","disabled"])])]),n("div",null,[t[37]||(t[37]=n("div",{class:"text-sm font-medium mb-2"},"日 (1-31)",-1)),n("div",Fs,[l(w,{modelValue:i.value.day,"onUpdate:modelValue":t[6]||(t[6]=L=>i.value.day=L),onChange:h,class:"flex items-center"},{default:a(()=>[l(k,{label:"*",class:"!w-[80px]"},{default:a(()=>[...t[33]||(t[33]=[X("每天",-1)])]),_:1}),l(k,{label:"1",class:"!w-[80px]"},{default:a(()=>[...t[34]||(t[34]=[X("每月1号",-1)])]),_:1}),l(k,{label:"15",class:"!w-[80px]"},{default:a(()=>[...t[35]||(t[35]=[X("每月15号",-1)])]),_:1}),l(k,{label:"custom",class:"!w-[80px]"},{default:a(()=>[...t[36]||(t[36]=[X("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),l(le,{modelValue:i.value.dayCustom,"onUpdate:modelValue":t[7]||(t[7]=L=>i.value.dayCustom=L),placeholder:"例如: 1,15 或 */5",disabled:i.value.day!=="custom",class:"!w-[200px]",onInput:h},null,8,["modelValue","disabled"])])]),n("div",null,[t[42]||(t[42]=n("div",{class:"text-sm font-medium mb-2"},"月 (1-12)",-1)),n("div",ks,[l(w,{modelValue:i.value.month,"onUpdate:modelValue":t[8]||(t[8]=L=>i.value.month=L),onChange:h,class:"flex items-center"},{default:a(()=>[l(k,{label:"*",class:"!w-[80px]"},{default:a(()=>[...t[38]||(t[38]=[X("每月",-1)])]),_:1}),l(k,{label:"1",class:"!w-[80px]"},{default:a(()=>[...t[39]||(t[39]=[X("1月",-1)])]),_:1}),l(k,{label:"6",class:"!w-[80px]"},{default:a(()=>[...t[40]||(t[40]=[X("6月",-1)])]),_:1}),l(k,{label:"custom",class:"!w-[80px]"},{default:a(()=>[...t[41]||(t[41]=[X("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),l(le,{modelValue:i.value.monthCustom,"onUpdate:modelValue":t[9]||(t[9]=L=>i.value.monthCustom=L),placeholder:"例如: 1,6,12 或 */3",disabled:i.value.month!=="custom",class:"!w-[200px]",onInput:h},null,8,["modelValue","disabled"])])]),n("div",null,[t[47]||(t[47]=n("div",{class:"text-sm font-medium mb-2"},"周 (0-7, 0和7表示周日)",-1)),n("div",_s,[l(w,{modelValue:i.value.weekday,"onUpdate:modelValue":t[10]||(t[10]=L=>i.value.weekday=L),onChange:h,class:"flex items-center"},{default:a(()=>[l(k,{label:"*",class:"!w-[80px]"},{default:a(()=>[...t[43]||(t[43]=[X("每天",-1)])]),_:1}),l(k,{label:"1-5",class:"!w-[80px]"},{default:a(()=>[...t[44]||(t[44]=[X("工作日",-1)])]),_:1}),l(k,{label:"0,6",class:"!w-[80px]"},{default:a(()=>[...t[45]||(t[45]=[X("周末",-1)])]),_:1}),l(k,{label:"custom",class:"!w-[80px]"},{default:a(()=>[...t[46]||(t[46]=[X("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),l(le,{modelValue:i.value.weekdayCustom,"onUpdate:modelValue":t[11]||(t[11]=L=>i.value.weekdayCustom=L),placeholder:"例如: 1,3,5 或 1-5",disabled:i.value.weekday!=="custom",class:"!w-[200px]",onInput:h},null,8,["modelValue","disabled"])])]),n("div",Ps,[t[50]||(t[50]=n("div",{class:"text-sm font-medium mb-2"},"生成的 Cron 表达式：",-1)),l(le,{modelValue:i.value.generated,"onUpdate:modelValue":t[12]||(t[12]=L=>i.value.generated=L),readonly:"",class:"mb-2"},null,8,["modelValue"]),n("div",Ss,[l(T,{type:"primary",size:"small",onClick:S},{default:a(()=>[...t[48]||(t[48]=[X(" 应用 ",-1)])]),_:1}),l(T,{type:"info",size:"small",onClick:Q},{default:a(()=>[...t[49]||(t[49]=[X(" 预览执行时间 ",-1)])]),_:1})])]),n("div",Bs,[t[55]||(t[55]=n("div",{class:"text-sm font-medium mb-2"},"常用示例：",-1)),n("div",As,[n("div",Ts,[l(T,{size:"small",onClick:t[13]||(t[13]=L=>z("0 0 * * *"))},{default:a(()=>[...t[51]||(t[51]=[X(" 每天0点 ",-1)])]),_:1}),l(T,{size:"small",onClick:t[14]||(t[14]=L=>z("0 */30 * * *"))},{default:a(()=>[...t[52]||(t[52]=[X(" 每30分钟 ",-1)])]),_:1}),l(T,{size:"small",onClick:t[15]||(t[15]=L=>z("0 0 9 * * 1-5"))},{default:a(()=>[...t[53]||(t[53]=[X(" 工作日9点 ",-1)])]),_:1}),l(T,{size:"small",onClick:t[16]||(t[16]=L=>z("0 0 0 1 * *"))},{default:a(()=>[...t[54]||(t[54]=[X(" 每月1号0点 ",-1)])]),_:1})])])])])]),_:1},8,["modelValue"])}}}),Es={key:0},Ls={class:"font-medium"},Ns={key:1,class:"text-center text-gray-400 py-4"},Us=Ne({__name:"CronPreviewDialog",props:{visible:{type:Boolean,default:!1},times:{default:()=>[]}},emits:["update:visible","close"],setup(e,{emit:C}){const d=C,v=()=>{d("update:visible",!1),d("close")};return(A,i)=>{const s=os,c=rs,h=Ze;return m(),ae(h,{"model-value":e.visible,title:"Cron 执行时间预览",width:"500","onUpdate:modelValue":i[0]||(i[0]=o=>A.$emit("update:visible",o)),"before-close":v},{default:a(()=>[e.times&&e.times.length>0?(m(),B("div",Es,[i[1]||(i[1]=n("div",{class:"text-sm text-gray-600 mb-3"},"下5次执行时间：",-1)),l(c,null,{default:a(()=>[(m(!0),B(Ce,null,Ae(e.times,(o,S)=>(m(),ae(s,{key:S,timestamp:o,placement:"top"},{default:a(()=>[n("div",Ls,"第 "+W(S+1)+" 次执行",1)]),_:2},1032,["timestamp"]))),128))]),_:1})])):(m(),B("div",Ns," 无法解析 Cron 表达式，请检查格式是否正确 "))]),_:1},8,["model-value"])}}}),Vs={class:"w-64 border rounded p-3 flex flex-col"},zs={class:"flex items-center justify-between mb-3"},Os={class:"flex items-center gap-1"},Rs={key:0,class:"flex-1 overflow-y-auto space-y-2 pr-1"},Ws=["onClick"],js={class:"flex items-center justify-between gap-2"},Gs={class:"text-sm font-medium truncate flex-1 min-w-0"},Ys={class:"flex items-center gap-2 flex-shrink-0"},Hs={class:"text-xs text-gray-500 whitespace-nowrap flex items-center gap-1"},Ks={class:"whitespace-nowrap w-5 flex items-center justify-center"},Is={class:"flex items-center justify-center"},Js={class:"text-[10px] text-blue-600 min-h-[14px] flex items-center justify-between"},Qs={key:0,class:"flex items-center gap-1"},qs={key:1,class:"invisible"},Xs={key:2,class:"text-gray-500 flex items-center gap-1"},Zs={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},en=Ne({__name:"PlaylistList",props:{playlistCollection:{},activePlaylistId:{},refreshing:{type:Boolean},autoRefreshEnabled:{type:Boolean}},emits:["select","create","refresh","toggle-auto-refresh","menu-command"],setup(e){const C=d=>{if(!d||!d.schedule||d.schedule.enabled!==1||!d.schedule.cron||typeof d.schedule.cron!="string")return null;try{const v=String(d.schedule.cron).trim();if(!v)return null;const A=wt(v,1);return A&&A.length>0?ps(A[0]):null}catch{return null}};return(d,v)=>{const A=Nt,i=He,s=Ve,c=us,h=ds,o=cs;return m(),B("div",Vs,[n("div",zs,[v[4]||(v[4]=n("h3",{class:"text-base font-semibold"},"播放列表",-1)),n("div",Os,[l(A,{"model-value":e.autoRefreshEnabled,"onUpdate:modelValue":v[0]||(v[0]=S=>d.$emit("toggle-auto-refresh",S)),"active-text":"","inactive-text":"","active-color":"#409eff",size:"small",title:"自动刷新",class:"mr-1"},null,8,["model-value"]),l(s,{type:"primary",size:"small",plain:"",onClick:v[1]||(v[1]=S=>d.$emit("refresh")),loading:e.refreshing,title:"刷新播放列表",class:"!w-8 !h-6 !p-0"},{default:a(()=>[e.refreshing?oe("",!0):(m(),ae(i,{key:0},{default:a(()=>[l(r(Ge))]),_:1}))]),_:1},8,["loading"]),l(s,{type:"success",size:"small",onClick:v[2]||(v[2]=S=>d.$emit("create")),title:"新建播放列表",class:"!w-8 !h-6 !p-0"},{default:a(()=>[l(i,null,{default:a(()=>[l(r(at))]),_:1})]),_:1})])]),e.playlistCollection&&e.playlistCollection.length>0?(m(),B("div",Rs,[(m(!0),B(Ce,null,Ae(e.playlistCollection,S=>(m(),B("div",{key:S.id,class:Te(["border rounded px-3 py-2 cursor-pointer hover:bg-gray-50 group min-h-[60px] flex flex-col justify-between",{"border-blue-500 bg-blue-50":S.id===e.activePlaylistId}]),onClick:Q=>d.$emit("select",S.id)},[n("div",js,[n("div",Gs,W(S.name),1),n("div",Ys,[n("span",Hs,[l(i,null,{default:a(()=>[l(r(Ql),{class:"!w-3 !h-3"})]),_:1}),n("span",Ks,W((S.pre_lists&&S.pre_lists[r(Ye)()]&&S.pre_lists[r(Ye)()].length||0)+(S.playlist&&S.playlist.length||0)),1)]),n("div",Is,[l(o,{trigger:"click",onCommand:Q=>d.$emit("menu-command",Q,S.id),onClick:v[3]||(v[3]=$e(()=>{},["stop"]))},{dropdown:a(()=>[l(h,null,{default:a(()=>[l(c,{command:"copy"},{default:a(()=>[...v[6]||(v[6]=[n("span",null,"复制",-1)])]),_:1}),e.playlistCollection.length>1?(m(),ae(c,{key:0,command:"delete",divided:""},{default:a(()=>[...v[7]||(v[7]=[n("span",{class:"text-[#f56c6c]"},"删除",-1)])]),_:1})):oe("",!0)]),_:1})]),default:a(()=>[l(s,{type:"default",size:"small",plain:"",circle:"",class:"!w-5 !h-5 !min-w-5 !p-0 text-xs",title:"更多"},{default:a(()=>[...v[5]||(v[5]=[n("span",{class:"text-base leading-none mb-1"},"»",-1)])]),_:1})]),_:1},8,["onCommand"])])])]),n("div",Js,[C(S)?(m(),B("span",Qs,[l(i,{class:"!w-3 !h-4"},{default:a(()=>[l(r(ql))]),_:1}),X(" "+W(C(S)),1)])):(m(),B("span",qs,"占位")),S.trigger_button?(m(),B("span",Xs,[l(i,{class:"!w-3 !h-4"},{default:a(()=>[l(r(Bt))]),_:1}),X(" "+W(S.trigger_button),1)])):oe("",!0)])],10,Ws))),128))])):(m(),B("div",Zs,' 暂无播放列表，请点击"新建"创建 '))])}}}),tn={class:"border rounded p-2 mb-2"},ln={class:"flex items-center justify-between mb-2"},sn={class:"flex items-center gap-1"},nn={class:"flex items-center gap-1"},an={class:"text-[10px]"},on={class:"flex items-center justify-between text-xs text-gray-500 mb-2 pr-2.5"},rn={class:"flex items-center"},dn={key:0},un={class:"flex items-center gap-1"},cn=["draggable","onClick","onDragstart","onDrop"],fn={class:"text-xs text-gray-500 w-8"},vn=["title"],mn={key:1,class:"w-full border-t border-gray-200"},gn={key:2,class:"text-sm text-gray-400 text-center py-1"},pn=Ne({__name:"PreFilesList",props:{playlistStatus:{},selectedWeekdayIndex:{},preFilesDragMode:{type:Boolean},preFilesBatchDeleteMode:{type:Boolean},selectedPreFileIndices:{},preFilesExpanded:{type:Boolean},playlistLoading:{type:Boolean},showMoreActions:{type:Boolean},audioPlayer:{}},emits:["select-weekday","open-file-browser","toggle-drag-mode","toggle-batch-delete-mode","batch-delete","clear","toggle-expand","toggle-selection","drag-start","drag-end","drag-over","drop","play-file","seek-file","move-up","move-down","replace","open-playlist-selector","delete"],setup(e){const C=e,d=()=>C.selectedWeekdayIndex!==null?C.selectedWeekdayIndex:Ye(),v=()=>{const s=C.playlistStatus;if(!s||!s.pre_lists)return[];const c=d();return!Array.isArray(s.pre_lists)||s.pre_lists.length!==7?[]:s.pre_lists[c]||[]},A=s=>{const c=C.playlistStatus;if(!c||!c.pre_lists||!Array.isArray(c.pre_lists)||c.pre_lists.length!==7)return 0;const h=c.pre_lists[s];return Array.isArray(h)?h.length:0},i=()=>{const s=v();return ot(s)};return(s,c)=>{const h=Ve,o=bt,S=He,Q=dt;return m(),B("div",tn,[n("div",ln,[c[12]||(c[12]=n("div",{class:"text-xs font-semibold text-gray-600 w-39"},"前置文件（播放时优先播放）",-1)),n("div",sn,[n("div",nn,[(m(),B(Ce,null,Ae(["周一","周二","周三","周四","周五","周六","周日"],(z,f)=>l(h,{key:f,type:e.selectedWeekdayIndex===f||e.selectedWeekdayIndex===null&&r(Ye)()===f?"primary":"default",size:"small",plain:"",onClick:t=>s.$emit("select-weekday",f),title:z,class:"!w-16 !h-6 !p-0 text-xs"},{default:a(()=>[X(W(z),1),n("span",an,"["+W(A(f))+"]",1)]),_:2},1032,["type","onClick","title"])),64))])])]),n("div",on,[n("div",rn,[i()>0?(m(),B("span",dn," 总时长："+W(r(yt)(i())),1)):oe("",!0),v()&&v().length>0?(m(),B("span",{key:1,class:Te(i()>0?"ml-2":"")}," 共 "+W(v().length)+" 首， 当前: "+W(e.playlistStatus?.pre_index!==void 0&&e.playlistStatus.pre_index!==null&&e.playlistStatus.pre_index>=0?e.playlistStatus.pre_index+1:"-")+" / "+W(v().length),3)):oe("",!0),e.playlistStatus?.isPlaying&&e.playlistStatus.in_pre_files===!0?(m(),ae(o,{key:2,type:"success",size:"small",class:"ml-2"},{default:a(()=>[...c[13]||(c[13]=[X(" 播放中 ",-1)])]),_:1})):oe("",!0)]),n("div",un,[l(h,{type:"primary",size:"small",plain:"",onClick:c[0]||(c[0]=z=>s.$emit("open-file-browser")),disabled:!e.playlistStatus||e.preFilesDragMode||e.preFilesBatchDeleteMode},{default:a(()=>[...c[14]||(c[14]=[X(" + ",-1)])]),_:1},8,["disabled"]),l(h,{type:e.preFilesDragMode?"success":"default",size:"small",plain:"",class:"!w-8 !h-6",onClick:c[1]||(c[1]=z=>s.$emit("toggle-drag-mode")),disabled:!e.playlistStatus||!v()||v().length===0||e.preFilesBatchDeleteMode,title:e.preFilesDragMode?"点击退出拖拽排序模式":"点击进入拖拽排序模式"},{default:a(()=>[e.preFilesDragMode?(m(),ae(S,{key:0},{default:a(()=>[l(r(qe))]),_:1})):(m(),ae(S,{key:1},{default:a(()=>[l(r(gt))]),_:1}))]),_:1},8,["type","disabled","title"]),l(h,{type:e.preFilesBatchDeleteMode?"success":"default",size:"small",plain:"",class:"!w-8 !h-6",onClick:c[2]||(c[2]=z=>s.$emit("toggle-batch-delete-mode")),disabled:!e.playlistStatus||!v()||v().length===0||e.preFilesDragMode,title:e.preFilesBatchDeleteMode?"点击退出批量删除模式":"点击进入批量删除模式"},{default:a(()=>[e.preFilesBatchDeleteMode?(m(),ae(S,{key:0},{default:a(()=>[l(r(qe))]),_:1})):(m(),ae(S,{key:1},{default:a(()=>[l(r(ze))]),_:1}))]),_:1},8,["type","disabled","title"]),be(l(h,{type:"danger",size:"small",plain:"",class:"!w-8 !h-6",onClick:c[3]||(c[3]=z=>s.$emit("batch-delete")),disabled:e.playlistLoading||e.selectedPreFileIndices.length===0,title:`删除选中的 ${e.selectedPreFileIndices.length} 项`},{default:a(()=>[l(S,null,{default:a(()=>[l(r(ze))]),_:1})]),_:1},8,["disabled","title"]),[[Pe,e.preFilesBatchDeleteMode]]),be(l(h,{type:"default",size:"small",plain:"",class:"!w-8 !h-6",onClick:c[4]||(c[4]=z=>s.$emit("clear")),disabled:!e.playlistStatus||!v()||v().length===0||e.playlistLoading||e.preFilesDragMode,title:"清空列表"},{default:a(()=>[l(S,null,{default:a(()=>[l(r(ze))]),_:1})]),_:1},8,["disabled"]),[[Pe,e.showMoreActions&&!e.preFilesBatchDeleteMode]])])]),v()&&v().length>0?(m(),B("div",{key:0,class:Te(["overflow-y-scroll scrollbar-overlay",{"max-h-[192px]":!e.preFilesExpanded}])},[(m(!0),B(Ce,null,Ae(v(),(z,f)=>(m(),B("div",{key:"pre-"+f,class:Te(["flex items-center gap-2 p-1 hover:bg-gray-100 rounded",{"bg-blue-50":Number(e.playlistStatus?.pre_index)===f,"bg-blue-100":e.preFilesBatchDeleteMode&&e.selectedPreFileIndices.includes(Number(f)),"cursor-move":e.preFilesDragMode,"cursor-pointer":e.preFilesBatchDeleteMode&&!e.preFilesDragMode,"cursor-default":!e.preFilesDragMode&&!e.preFilesBatchDeleteMode,"select-none":!0}]),draggable:e.preFilesDragMode,onClick:t=>e.preFilesBatchDeleteMode&&!e.preFilesDragMode?s.$emit("toggle-selection",Number(f)):null,onDragstart:t=>s.$emit("drag-start",t,Number(f)),onDragend:c[8]||(c[8]=t=>s.$emit("drag-end",t)),onDragover:c[9]||(c[9]=$e(t=>s.$emit("drag-over",t),["prevent"])),onDragleave:c[10]||(c[10]=t=>{const k=t.currentTarget;k&&k.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")}),onDrop:$e(t=>s.$emit("drop",t,Number(f)),["prevent"])},[n("span",fn,W(Number(f)+1),1),n("span",{class:Te(["flex-1 text-sm truncate",{"text-blue-600":Number(e.playlistStatus?.pre_index)===f}]),title:z.uri||""},W(z.uri?z.uri.split("/").pop():""),11,vn),n("div",{class:"flex items-center gap-1 flex-shrink-0",onMousedown:c[6]||(c[6]=$e(()=>{},["stop"])),onClick:c[7]||(c[7]=$e(()=>{},["stop"]))},[be(l(Et,{file:z,player:e.audioPlayer,disabled:e.playlistLoading,onPlay:t=>s.$emit("play-file",z),onSeek:(t,k)=>s.$emit("seek-file",t,k)},null,8,["file","player","disabled","onPlay","onSeek"]),[[Pe,!e.preFilesBatchDeleteMode]]),be(l(Q,{class:"!h-6","model-value":e.selectedPreFileIndices.includes(Number(f)),onChange:t=>s.$emit("toggle-selection",Number(f)),onClick:c[5]||(c[5]=$e(()=>{},["stop"]))},null,8,["model-value","onChange"]),[[Pe,e.preFilesBatchDeleteMode]]),be(l(h,{type:"default",size:"small",plain:"",circle:"",onClick:$e(t=>s.$emit("move-up",Number(f)),["stop"]),disabled:Number(f)===0||e.playlistLoading,title:"上移"},{default:a(()=>[...c[15]||(c[15]=[X(" ↑ ",-1)])]),_:1},8,["onClick","disabled"]),[[Pe,e.showMoreActions&&!e.preFilesDragMode&&!e.preFilesBatchDeleteMode]]),be(l(h,{type:"default",size:"small",plain:"",circle:"",onClick:$e(t=>s.$emit("move-down",Number(f)),["stop"]),disabled:Number(f)===v().length-1||e.playlistLoading,title:"下移"},{default:a(()=>[...c[16]||(c[16]=[X(" ↓ ",-1)])]),_:1},8,["onClick","disabled"]),[[Pe,e.showMoreActions&&!e.preFilesDragMode&&!e.preFilesBatchDeleteMode]]),be(l(h,{type:"default",size:"small",plain:"",circle:"",onClick:$e(t=>s.$emit("replace",Number(f)),["stop"]),disabled:e.playlistLoading,title:"替换"},{default:a(()=>[l(S,null,{default:a(()=>[l(r(Ge))]),_:1})]),_:1},8,["onClick","disabled"]),[[Pe,e.showMoreActions&&!e.preFilesDragMode&&!e.preFilesBatchDeleteMode]]),be(l(h,{type:"info",size:"small",plain:"",circle:"",onClick:$e(t=>s.$emit("open-playlist-selector",z),["stop"]),disabled:e.playlistLoading,title:"应用到列表"},{default:a(()=>[l(S,null,{default:a(()=>[l(r(At))]),_:1})]),_:1},8,["onClick","disabled"]),[[Pe,!e.preFilesBatchDeleteMode&&!e.preFilesDragMode]]),be(l(h,{type:"default",size:"small",plain:"",circle:"",onClick:$e(t=>s.$emit("delete",Number(f)),["stop"]),disabled:e.playlistLoading||e.preFilesDragMode,title:"删除"},{default:a(()=>[l(S,null,{default:a(()=>[l(r(pt))]),_:1})]),_:1},8,["onClick","disabled"]),[[Pe,!e.preFilesBatchDeleteMode]])],32)],42,cn))),128))],2)):oe("",!0),v()&&v().length>0?(m(),B("div",mn,[l(h,{type:"default",size:"small",plain:"",class:"!w-full !h-4 !p-0 !text-xs",onClick:c[11]||(c[11]=z=>s.$emit("toggle-expand")),title:e.preFilesExpanded?"折叠":"展开"},{default:a(()=>[e.preFilesExpanded?(m(),ae(S,{key:0},{default:a(()=>[l(r(Xl))]),_:1})):(m(),ae(S,{key:1},{default:a(()=>[l(r(Zl))]),_:1}))]),_:1},8,["title"])])):(m(),B("div",gn,"前置文件列表为空"))])}}}),yn={key:0,class:"border rounded p-2"},hn={class:"flex items-center justify-between mb-2 pr-2.5"},bn={class:"text-xs font-semibold text-gray-600"},xn={key:0,class:"ml-2 text-gray-500"},wn={key:1,class:"ml-2 text-gray-500"},Dn={class:"flex items-center gap-1"},$n={key:0,class:"overflow-y-scroll scrollbar-overlay"},Cn=["draggable","onClick","onDragstart","onDrop"],Fn={class:"text-xs text-gray-500 w-8"},kn=["title"],_n={key:1,class:"text-sm text-gray-400 text-center py-1"},Pn=Ne({__name:"FilesList",props:{playlistStatus:{},filesDragMode:{type:Boolean},filesBatchDeleteMode:{type:Boolean},selectedFileIndices:{},playlistLoading:{type:Boolean},showMoreActions:{type:Boolean},audioPlayer:{}},emits:["open-file-browser","toggle-drag-mode","toggle-batch-delete-mode","batch-delete","clear","toggle-selection","drag-start","drag-end","drag-over","drop","play-file","seek-file","move-up","move-down","replace","open-playlist-selector","delete"],setup(e,{emit:C}){const d=e,v=C,A={plain:!0,size:"small",class:"!w-8 !h-6"},i={type:"default",size:"small",plain:!0,circle:!0},s=ce(()=>d.playlistStatus?.playlist||[]),c=ce(()=>s.value.length),h=ce(()=>d.playlistStatus?.current_index??-1),o=ce(()=>h.value>=0?h.value+1:"-"),S=ce(()=>d.playlistStatus?.isPlaying&&!d.playlistStatus.in_pre_files),Q=ce(()=>c.value>0),z=ce(()=>Q.value?ot(s.value):0),f=ce(()=>d.filesBatchDeleteMode&&Q.value&&!d.filesDragMode),t=ce(()=>d.showMoreActions&&!d.filesDragMode&&!d.filesBatchDeleteMode),k=ce(()=>d.showMoreActions&&!d.filesBatchDeleteMode),w=ce(()=>!d.filesBatchDeleteMode&&!d.filesDragMode),le=ce(()=>!d.playlistStatus||d.filesDragMode||d.filesBatchDeleteMode),T=ce(()=>!Q.value||d.filesBatchDeleteMode),O=ce(()=>!Q.value||d.filesDragMode),L=ce(()=>d.playlistLoading||d.selectedFileIndices.length===0),te=ce(()=>`删除选中的 ${d.selectedFileIndices.length} 项`),j=ce(()=>!Q.value||d.playlistLoading||d.filesDragMode),re=J=>J?J.split("/").pop():"",N=J=>d.selectedFileIndices.includes(J),b=J=>J===h.value,$=J=>({"bg-blue-50":b(J),"bg-blue-100":f.value&&N(J),"cursor-move":d.filesDragMode,"cursor-pointer":f.value,"cursor-default":!d.filesDragMode&&!d.filesBatchDeleteMode}),p=ce(()=>d.playlistLoading||d.filesDragMode),_=J=>{f.value&&v("toggle-selection",J)},D=(J,Y)=>{v("drag-start",J,Y)},ee=J=>{v("drag-end",J)},ye=J=>{v("drag-over",J)},y=J=>{const Y=J.currentTarget;Y?.classList&&Y.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")},U=(J,Y)=>{v("drop",J,Y)},P=(J,Y)=>{v("seek-file",J,Y)};return(J,Y)=>{const ue=bt,fe=Ve,ge=He,Ee=dt;return e.playlistStatus?.playlist?(m(),B("div",yn,[n("div",hn,[n("div",bn,[Y[9]||(Y[9]=X(" 正式文件（播放时记录进度） ",-1)),z.value>0?(m(),B("span",xn," 总时长："+W(r(yt)(z.value)),1)):oe("",!0),Q.value?(m(),B("span",wn," 共 "+W(c.value)+" 首， 当前: "+W(o.value)+" / "+W(c.value),1)):oe("",!0),S.value?(m(),ae(ue,{key:2,type:"success",size:"small",class:"ml-2"},{default:a(()=>[...Y[8]||(Y[8]=[X(" 播放中 ",-1)])]),_:1})):oe("",!0)]),n("div",Dn,[l(fe,Re({type:"primary"},A,{onClick:Y[0]||(Y[0]=Fe=>v("open-file-browser")),disabled:le.value}),{default:a(()=>[...Y[10]||(Y[10]=[X(" + ",-1)])]),_:1},16,["disabled"]),l(fe,Re({type:e.filesDragMode?"success":"default"},A,{onClick:Y[1]||(Y[1]=Fe=>v("toggle-drag-mode")),disabled:T.value,title:e.filesDragMode?"点击退出拖拽排序模式":"点击进入拖拽排序模式"}),{default:a(()=>[e.filesDragMode?(m(),ae(ge,{key:0},{default:a(()=>[l(r(qe))]),_:1})):(m(),ae(ge,{key:1},{default:a(()=>[l(r(gt))]),_:1}))]),_:1},16,["type","disabled","title"]),l(fe,Re({type:e.filesBatchDeleteMode?"success":"default"},A,{onClick:Y[2]||(Y[2]=Fe=>v("toggle-batch-delete-mode")),disabled:O.value,title:e.filesBatchDeleteMode?"点击退出批量删除模式":"点击进入批量删除模式"}),{default:a(()=>[e.filesBatchDeleteMode?(m(),ae(ge,{key:0},{default:a(()=>[l(r(qe))]),_:1})):(m(),ae(ge,{key:1},{default:a(()=>[l(r(ze))]),_:1}))]),_:1},16,["type","disabled","title"]),be(l(fe,Re({type:"danger"},A,{onClick:Y[3]||(Y[3]=Fe=>v("batch-delete")),disabled:L.value,title:te.value}),{default:a(()=>[l(ge,null,{default:a(()=>[l(r(ze))]),_:1})]),_:1},16,["disabled","title"]),[[Pe,e.filesBatchDeleteMode]]),be(l(fe,Re({type:"default"},A,{onClick:Y[4]||(Y[4]=Fe=>v("clear")),disabled:j.value,title:"清空正式文件列表"}),{default:a(()=>[l(ge,null,{default:a(()=>[l(r(ze))]),_:1})]),_:1},16,["disabled"]),[[Pe,k.value]])])]),Q.value?(m(),B("div",$n,[(m(!0),B(Ce,null,Ae(s.value,(Fe,V)=>(m(),B("div",{key:Fe.uri||V,class:Te(["flex items-center gap-2 p-1 hover:bg-gray-100 rounded select-none",$(V)]),draggable:e.filesDragMode,onClick:E=>_(V),onDragstart:E=>D(E,V),onDragend:ee,onDragover:$e(ye,["prevent"]),onDragleave:y,onDrop:$e(E=>U(E,V),["prevent"])},[n("span",Fn,W(V+1),1),n("span",{class:Te(["flex-1 text-sm truncate",{"text-blue-600":b(V)}]),title:Fe.uri||""},W(re(Fe.uri)),11,kn),n("div",{class:"flex items-center gap-1 flex-shrink-0",onMousedown:Y[6]||(Y[6]=$e(()=>{},["stop"])),onClick:Y[7]||(Y[7]=$e(()=>{},["stop"]))},[be(l(Et,{file:Fe,player:e.audioPlayer,disabled:e.playlistLoading,onPlay:E=>v("play-file",Fe),onSeek:P},null,8,["file","player","disabled","onPlay"]),[[Pe,!e.filesBatchDeleteMode]]),be(l(Ee,{class:"!h-6","model-value":N(V),onChange:E=>v("toggle-selection",V),onClick:Y[5]||(Y[5]=$e(()=>{},["stop"]))},null,8,["model-value","onChange"]),[[Pe,e.filesBatchDeleteMode]]),be(l(fe,Re({ref_for:!0},i,{onClick:$e(E=>v("move-up",V),["stop"]),disabled:V===0||e.playlistLoading,title:"上移"}),{default:a(()=>[...Y[11]||(Y[11]=[X(" ↑ ",-1)])]),_:1},16,["onClick","disabled"]),[[Pe,t.value]]),be(l(fe,Re({ref_for:!0},i,{onClick:$e(E=>v("move-down",V),["stop"]),disabled:V===c.value-1||e.playlistLoading,title:"下移"}),{default:a(()=>[...Y[12]||(Y[12]=[X(" ↓ ",-1)])]),_:1},16,["onClick","disabled"]),[[Pe,t.value]]),be(l(fe,Re({ref_for:!0},i,{onClick:$e(E=>v("replace",V),["stop"]),disabled:e.playlistLoading,title:"替换"}),{default:a(()=>[l(ge,null,{default:a(()=>[l(r(Ge))]),_:1})]),_:1},16,["onClick","disabled"]),[[Pe,t.value]]),be(l(fe,{type:"info",size:"small",plain:"",circle:"",onClick:$e(E=>v("open-playlist-selector",Fe),["stop"]),disabled:e.playlistLoading,title:"应用到列表"},{default:a(()=>[l(ge,null,{default:a(()=>[l(r(At))]),_:1})]),_:1},8,["onClick","disabled"]),[[Pe,w.value]]),be(l(fe,Re({ref_for:!0},i,{onClick:$e(E=>v("delete",V),["stop"]),disabled:p.value,title:"删除"}),{default:a(()=>[l(ge,null,{default:a(()=>[l(r(pt))]),_:1})]),_:1},16,["onClick","disabled"]),[[Pe,!e.filesBatchDeleteMode]])],32)],42,Cn))),128))])):(m(),B("div",_n,"正式文件列表为空"))])):oe("",!0)}}}),Sn={class:"flex-1 border rounded p-3 flex flex-col"},Bn={class:"flex items-center justify-between mb-3"},An={class:"flex-1"},Tn={key:0,class:"flex items-center gap-2 mb-1"},Mn={class:"flex items-center gap-2 flex-1"},En={class:"text-lg font-semibold truncate"},Ln={key:1},Nn={key:2,class:"text-sm text-gray-500"},Un={key:0,class:"mr-2"},Vn={class:"flex flex-wrap gap-2"},zn={key:1},On={key:1},Rn={key:1},Wn={key:1},jn={key:0,class:"flex-1 overflow-y-scroll scrollbar-overlay"},Gn={key:0,class:"text-sm text-gray-400 text-center py-8"},Yn={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},Hn=Ne({__name:"FileListPanel",props:{playlistStatus:{},activePlaylistId:{},editingPlaylistId:{},editingPlaylistName:{},selectedWeekdayIndex:{},preFilesDragMode:{type:Boolean},preFilesBatchDeleteMode:{type:Boolean},selectedPreFileIndices:{},preFilesExpanded:{type:Boolean},filesDragMode:{type:Boolean},filesBatchDeleteMode:{type:Boolean},selectedFileIndices:{},playlistLoading:{type:Boolean},playing:{type:Boolean},stopping:{type:Boolean},showMoreActions:{type:Boolean},audioPlayer:{}},emits:["update:editingPlaylistName","start-edit-name","save-name","cancel-edit-name","open-batch-drawer","play","play-pre","play-next","stop","clear","toggle-more-actions","select-weekday","open-file-browser-for-pre-files","toggle-pre-files-drag-mode","toggle-pre-files-batch-delete-mode","batch-delete-pre-files","clear-pre-files","toggle-pre-files-expand","toggle-pre-file-selection","pre-file-drag-start","pre-file-drag-end","pre-file-drag-over","pre-file-drop","open-file-browser","toggle-files-drag-mode","toggle-files-batch-delete-mode","batch-delete-files","clear-files","toggle-file-selection","file-drag-start","file-drag-end","file-drag-over","file-drop","play-file","seek-file","move-pre-file-up","move-pre-file-down","replace-pre-file","open-playlist-selector-for-pre-file","delete-pre-file","move-file-up","move-file-down","replace-file","open-playlist-selector-for-file","delete-file"],setup(e){const C=e,d=()=>C.selectedWeekdayIndex!==null?C.selectedWeekdayIndex:Ye(),v=()=>{const i=C.playlistStatus;if(!i||!i.pre_lists)return[];const s=d();return!Array.isArray(i.pre_lists)||i.pre_lists.length!==7?[]:i.pre_lists[s]||[]},A=()=>{const i=C.playlistStatus;if(!i)return 0;const s=v(),c=ot(s),h=i.playlist||[],o=ot(h);return c+o};return(i,s)=>{const c=He,h=Ve;return m(),B("div",Sn,[n("div",Bn,[n("div",An,[e.playlistStatus?(m(),B("div",Tn,[n("div",Mn,[n("h3",En,W(e.playlistStatus.name),1),l(h,{type:"default",size:"small",plain:"",circle:"",onClick:s[0]||(s[0]=o=>i.$emit("start-edit-name",e.activePlaylistId)),title:"编辑名称"},{default:a(()=>[l(c,null,{default:a(()=>[l(r(Tt))]),_:1})]),_:1})])])):(m(),B("div",Ln,[...s[44]||(s[44]=[n("h3",{class:"text-lg font-semibold"},"播放列表文件",-1)])])),e.playlistStatus?(m(),B("div",Nn,[A()>0?(m(),B("span",Un," 总时长："+W(r(yt)(A())),1)):oe("",!0),e.playlistStatus?(m(),B(Ce,{key:1},[(v()?.length||0)+(e.playlistStatus.playlist?.length||0)>0?(m(),B(Ce,{key:0},[X(" 共 "+W((v()?.length||0)+(e.playlistStatus.playlist?.length||0))+" 首， 当前: ",1),e.playlistStatus.pre_index!==void 0&&e.playlistStatus.pre_index!==null&&e.playlistStatus.pre_index>=0?(m(),B(Ce,{key:0},[X(W(e.playlistStatus.pre_index+1),1)],64)):e.playlistStatus.current_index!==void 0&&e.playlistStatus.current_index!==null&&e.playlistStatus.current_index>=0?(m(),B(Ce,{key:1},[X(W((v()?.length||0)+e.playlistStatus.current_index+1),1)],64)):(m(),B(Ce,{key:2},[X(" - ")],64)),X(" / "+W((v()?.length||0)+(e.playlistStatus.playlist?.length||0)),1)],64)):(m(),B(Ce,{key:1},[X(" 共 0 首， 当前: - / 0 ")],64))],64)):oe("",!0)])):oe("",!0)]),n("div",Vn,[l(h,{type:"default",size:"small",plain:"",circle:"",onClick:s[1]||(s[1]=o=>i.$emit("open-batch-drawer")),title:"批量模式"},{default:a(()=>[l(c,null,{default:a(()=>[l(r(es))]),_:1})]),_:1}),l(h,{type:"default",size:"small",plain:"",circle:"",onClick:s[2]||(s[2]=o=>i.$emit("play")),class:"items-center justify-center",disabled:!e.playlistStatus||!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0||!!e.playlistStatus.isPlaying,title:"播放"},{default:a(()=>[e.playing?(m(),ae(c,{key:0,size:"12",class:"animate-spin"},{default:a(()=>[l(r(Ie))]),_:1})):(m(),B("span",zn,"▶"))]),_:1},8,["disabled"]),l(h,{type:"default",size:"small",plain:"",circle:"",onClick:s[3]||(s[3]=o=>i.$emit("play-pre")),disabled:!e.playlistStatus||(!v()||v().length===0)&&(!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0),title:"上一首"},{default:a(()=>[e.playing?(m(),ae(c,{key:0,size:"12",class:"animate-spin"},{default:a(()=>[l(r(Ie))]),_:1})):(m(),B("span",On,"⏮"))]),_:1},8,["disabled"]),l(h,{type:"default",size:"small",plain:"",circle:"",onClick:s[4]||(s[4]=o=>i.$emit("play-next")),disabled:!e.playlistStatus||(!v()||v().length===0)&&(!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0),title:"下一首"},{default:a(()=>[e.playing?(m(),ae(c,{key:0,size:"12",class:"animate-spin"},{default:a(()=>[l(r(Ie))]),_:1})):(m(),B("span",Rn,"⏭"))]),_:1},8,["disabled"]),l(h,{type:"default",size:"small",plain:"",circle:"",onClick:s[5]||(s[5]=o=>i.$emit("stop")),title:"停止"},{default:a(()=>[e.stopping?(m(),ae(c,{key:0,size:"12",class:"animate-spin"},{default:a(()=>[l(r(Ie))]),_:1})):(m(),B("span",Wn,"⏹"))]),_:1}),be(l(h,{type:"default",size:"small",plain:"",circle:"",onClick:s[6]||(s[6]=o=>i.$emit("clear")),disabled:!e.playlistStatus||(!v()||v().length===0)&&(!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0)||e.playlistLoading,title:"清空列表（包括前置文件和正式文件）"},{default:a(()=>[l(c,null,{default:a(()=>[l(r(ze))]),_:1})]),_:1},8,["disabled"]),[[Pe,e.showMoreActions]]),l(h,{type:"default",size:"small",plain:"",circle:"",onClick:s[7]||(s[7]=o=>i.$emit("toggle-more-actions")),title:"更多"},{default:a(()=>[l(c,null,{default:a(()=>[l(r(gt))]),_:1})]),_:1})])]),e.playlistStatus?(m(),B("div",jn,[l(pn,{"playlist-status":e.playlistStatus,"selected-weekday-index":e.selectedWeekdayIndex,"pre-files-drag-mode":e.preFilesDragMode,"pre-files-batch-delete-mode":e.preFilesBatchDeleteMode,"selected-pre-file-indices":e.selectedPreFileIndices,"pre-files-expanded":e.preFilesExpanded,"playlist-loading":e.playlistLoading,"show-more-actions":e.showMoreActions,"audio-player":e.audioPlayer,onSelectWeekday:s[8]||(s[8]=o=>i.$emit("select-weekday",o)),onOpenFileBrowser:s[9]||(s[9]=o=>i.$emit("open-file-browser-for-pre-files")),onToggleDragMode:s[10]||(s[10]=o=>i.$emit("toggle-pre-files-drag-mode")),onToggleBatchDeleteMode:s[11]||(s[11]=o=>i.$emit("toggle-pre-files-batch-delete-mode")),onBatchDelete:s[12]||(s[12]=o=>i.$emit("batch-delete-pre-files")),onClear:s[13]||(s[13]=o=>i.$emit("clear-pre-files")),onToggleExpand:s[14]||(s[14]=o=>i.$emit("toggle-pre-files-expand")),onToggleSelection:s[15]||(s[15]=o=>i.$emit("toggle-pre-file-selection",o)),onDragStart:s[16]||(s[16]=(o,S)=>i.$emit("pre-file-drag-start",o,S)),onDragEnd:s[17]||(s[17]=o=>i.$emit("pre-file-drag-end",o)),onDragOver:s[18]||(s[18]=o=>i.$emit("pre-file-drag-over",o)),onDrop:s[19]||(s[19]=(o,S)=>i.$emit("pre-file-drop",o,S)),onPlayFile:s[20]||(s[20]=o=>i.$emit("play-file",o)),onSeekFile:s[21]||(s[21]=(o,S)=>i.$emit("seek-file",o,S)),onMoveUp:s[22]||(s[22]=o=>i.$emit("move-pre-file-up",o)),onMoveDown:s[23]||(s[23]=o=>i.$emit("move-pre-file-down",o)),onReplace:s[24]||(s[24]=o=>i.$emit("replace-pre-file",o)),onOpenPlaylistSelector:s[25]||(s[25]=o=>i.$emit("open-playlist-selector-for-pre-file",o)),onDelete:s[26]||(s[26]=o=>i.$emit("delete-pre-file",o))},null,8,["playlist-status","selected-weekday-index","pre-files-drag-mode","pre-files-batch-delete-mode","selected-pre-file-indices","pre-files-expanded","playlist-loading","show-more-actions","audio-player"]),l(Pn,{"playlist-status":e.playlistStatus,"files-drag-mode":e.filesDragMode,"files-batch-delete-mode":e.filesBatchDeleteMode,"selected-file-indices":e.selectedFileIndices,"playlist-loading":e.playlistLoading,"show-more-actions":e.showMoreActions,"audio-player":e.audioPlayer,onOpenFileBrowser:s[27]||(s[27]=o=>i.$emit("open-file-browser")),onToggleDragMode:s[28]||(s[28]=o=>i.$emit("toggle-files-drag-mode")),onToggleBatchDeleteMode:s[29]||(s[29]=o=>i.$emit("toggle-files-batch-delete-mode")),onBatchDelete:s[30]||(s[30]=o=>i.$emit("batch-delete-files")),onClear:s[31]||(s[31]=o=>i.$emit("clear-files")),onToggleSelection:s[32]||(s[32]=o=>i.$emit("toggle-file-selection",o)),onDragStart:s[33]||(s[33]=(o,S)=>i.$emit("file-drag-start",o,S)),onDragEnd:s[34]||(s[34]=o=>i.$emit("file-drag-end",o)),onDragOver:s[35]||(s[35]=o=>i.$emit("file-drag-over",o)),onDrop:s[36]||(s[36]=(o,S)=>i.$emit("file-drop",o,S)),onPlayFile:s[37]||(s[37]=o=>i.$emit("play-file",o)),onSeekFile:s[38]||(s[38]=(o,S)=>i.$emit("seek-file",o,S)),onMoveUp:s[39]||(s[39]=o=>i.$emit("move-file-up",o)),onMoveDown:s[40]||(s[40]=o=>i.$emit("move-file-down",o)),onReplace:s[41]||(s[41]=o=>i.$emit("replace-file",o)),onOpenPlaylistSelector:s[42]||(s[42]=o=>i.$emit("open-playlist-selector-for-file",o)),onDelete:s[43]||(s[43]=o=>i.$emit("delete-file",o))},null,8,["playlist-status","files-drag-mode","files-batch-delete-mode","selected-file-indices","playlist-loading","show-more-actions","audio-player"]),(!v()||v().length===0)&&(!e.playlistStatus?.playlist||e.playlistStatus.playlist.length===0)?(m(),B("div",Gn,' 当前播放列表为空，点击"添加文件"开始构建播放列表 ')):oe("",!0)])):(m(),B("div",Yn," 请先在左侧选择一个播放列表查看详情 "))])}}}),Kn=["agent","dlna","bluetooth","mi"],In=1e4,_t=5,Jn=5e3,je="默认播放列表",Qn=1440,st=7,qn=[...Kn],Xn="dlna",Wt="active_playlist_id",nt={NONE:"",BUTTON_1:"B1",BUTTON_2:"B2",BUTTON_3:"B3"},Zn={class:"w-80 min-w-75 border rounded p-3 flex flex-col"},ea={key:0,class:"mb-3 flex items-center gap-2 flex-wrap"},ta={key:1,class:"flex-1 overflow-y-auto space-y-4"},la={class:"border rounded p-3"},sa={class:"flex items-center justify-between mb-2"},na={class:"space-y-2"},aa={class:"flex items-center gap-2"},ia={class:"flex items-start gap-4"},oa={class:"flex-1"},ra={class:"flex-1"},da={key:0},ua={class:"border rounded p-3"},ca={class:"space-y-2"},fa={class:"text-xs text-gray-600 mb-1 flex items-center gap-2"},va={key:0,class:"text-xs text-gray-500"},ma={class:"flex items-center gap-2"},ga={class:"mt-3"},pa={class:"flex items-center justify-between mb-2"},ya={class:"text-xs font-semibold text-gray-700"},ha={key:0},ba={class:"space-y-2 max-h-[200px] overflow-y-auto"},xa={class:"flex-1 min-w-0"},wa={class:"text-sm font-medium truncate"},Da={class:"text-xs text-gray-500 truncate"},$a={class:"flex-shrink-0"},Ca={key:0,class:"text-xs text-gray-400 text-center py-4"},Fa={key:1},ka={class:"space-y-2 max-h-[200px] overflow-y-auto"},_a={class:"flex-1 min-w-0"},Pa={class:"text-sm font-medium truncate"},Sa=["title"],Ba={class:"flex-shrink-0"},Aa={key:0,class:"text-xs text-gray-400 text-center py-4"},Ta={key:2},Ma={class:"space-y-2 max-h-[200px] overflow-y-auto"},Ea={class:"flex-1 min-w-0"},La={class:"text-sm font-medium truncate"},Na=["title"],Ua={class:"flex-shrink-0"},Va={key:0,class:"text-xs text-gray-400 text-center py-4"},za={key:2,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},Oa=Ne({__name:"ConfigPanel",props:{playlistStatus:{},connectedDeviceList:{},dlnaDeviceList:{},miDeviceList:{},loading:{type:Boolean},dlnaScanning:{type:Boolean},miScanning:{type:Boolean},onToggleCronEnabled:{type:Function},onUpdateCron:{type:Function},onUpdateDuration:{type:Function},onUpdateTriggerButton:{type:Function},onOpenCronBuilder:{type:Function},onPreviewCron:{type:Function},onUpdateDeviceType:{type:Function},onUpdateDeviceAddress:{type:Function},onSelectBluetoothDevice:{type:Function},onSelectAgentDevice:{type:Function},onSelectMiDevice:{type:Function},onScanDlnaDevices:{type:Function},onScanMiDevices:{type:Function},onOpenScanDialog:{type:Function},onOpenDeviceList:{type:Function}},setup(e){const C=e,d=ce(()=>C.playlistStatus?.device?.type||C.playlistStatus?.device_type||null),v=ce(()=>C.playlistStatus?.device?.address||C.playlistStatus?.device_address||""),A=z=>ce(()=>d.value===z),i=ce(()=>{const z=d.value;return z==="agent"||z==="bluetooth"}),s=A("dlna"),c=A("mi"),h=ce(()=>i.value?"已配对的设备":s.value?"DLNA 设备":c.value?"小米设备":"设备列表"),o=ce(()=>i.value?"扫描设备":s.value?"扫描 DLNA 设备":c.value?"扫描小米设备":"扫描设备"),S=ce(()=>C.dlnaScanning||C.miScanning),Q=()=>{i.value?C.onOpenScanDialog():s.value?C.onScanDlnaDevices():c.value&&C.onScanMiDevices()};return(z,f)=>{const t=He,k=Ve,w=Nt,le=ht,T=fs,O=Vt,L=Ut,te=xt;return m(),B("div",Zn,[f[20]||(f[20]=n("h3",{class:"text-lg font-semibold mb-3"},"配置详情",-1)),e.playlistStatus?(m(),B("div",ea,[l(k,{type:"default",onClick:e.onOpenDeviceList,title:"打开设备列表"},{default:a(()=>[l(t,null,{default:a(()=>[l(r(ts))]),_:1}),f[4]||(f[4]=n("span",{class:"ml-1"},"设备列表",-1))]),_:1},8,["onClick"])])):oe("",!0),e.playlistStatus?(m(),B("div",ta,[n("div",la,[n("div",sa,[f[5]||(f[5]=n("h4",{class:"text-sm font-semibold"},"定时任务 (Cron)",-1)),l(w,{"model-value":e.playlistStatus.schedule?.enabled===1,onChange:f[0]||(f[0]=j=>e.onToggleCronEnabled(j)),"active-text":"开启","inactive-text":"关闭"},null,8,["model-value"])]),n("div",na,[n("div",null,[f[7]||(f[7]=n("div",{class:"text-xs text-gray-600 mb-1"},"Cron 表达式",-1)),n("div",aa,[l(le,{"model-value":e.playlistStatus.schedule?.cron||"",onInput:f[1]||(f[1]=j=>e.onUpdateCron(j)),placeholder:"例如: 0 0 * * *",size:"small",disabled:e.playlistStatus.schedule?.enabled!==1},null,8,["model-value","disabled"]),l(k,{type:"info",size:"small",onClick:e.onOpenCronBuilder,disabled:e.playlistStatus.schedule?.enabled!==1},{default:a(()=>[...f[6]||(f[6]=[X(" 助手 ",-1)])]),_:1},8,["onClick","disabled"])])]),n("div",ia,[n("div",oa,[f[8]||(f[8]=n("div",{class:"text-xs text-gray-600 mb-1"},"持续时间（分钟）",-1)),l(T,{"model-value":e.playlistStatus.schedule?.duration||0,onChange:e.onUpdateDuration,min:0,max:r(Qn),step:1,size:"small",disabled:e.playlistStatus.schedule?.enabled!==1,class:"w-full"},null,8,["model-value","onChange","max","disabled"]),f[9]||(f[9]=n("div",{class:"text-xs text-gray-500 mt-1"},"0表示不自动停止",-1))]),n("div",ra,[f[10]||(f[10]=n("div",{class:"text-xs text-gray-600 mb-1"},"触发按钮",-1)),l(L,{"model-value":e.playlistStatus.trigger_button||"",onChange:e.onUpdateTriggerButton,placeholder:"选择触发按钮",size:"small",class:"w-full",clearable:""},{default:a(()=>[l(O,{label:"空",value:r(nt).NONE},null,8,["value"]),l(O,{label:"按钮对-1",value:r(nt).BUTTON_1},null,8,["value"]),l(O,{label:"按钮对-2",value:r(nt).BUTTON_2},null,8,["value"]),l(O,{label:"按钮对-3",value:r(nt).BUTTON_3},null,8,["value"])]),_:1},8,["model-value","onChange"])])]),e.playlistStatus.schedule?.cron&&e.playlistStatus.schedule?.enabled===1?(m(),B("div",da,[l(k,{type:"success",size:"small",onClick:e.onPreviewCron,class:"w-full"},{default:a(()=>[...f[11]||(f[11]=[X(" 预览执行时间 ",-1)])]),_:1},8,["onClick"])])):oe("",!0)])]),n("div",ua,[f[19]||(f[19]=n("h4",{class:"text-sm font-semibold mb-2"},"设备配置",-1)),n("div",ca,[n("div",null,[f[12]||(f[12]=n("div",{class:"text-xs text-gray-600 mb-1"},"设备类型",-1)),l(L,{"model-value":d.value,onChange:e.onUpdateDeviceType,placeholder:"选择设备类型",size:"small",class:"w-full"},{default:a(()=>[l(O,{label:"蓝牙",value:"bluetooth"}),l(O,{label:"DLNA",value:"dlna"}),l(O,{label:"设备代理",value:"agent"}),l(O,{label:"小米设备",value:"mi"})]),_:1},8,["model-value","onChange"])]),n("div",null,[n("div",fa,[f[13]||(f[13]=n("span",null,"设备地址",-1)),e.playlistStatus.device?.name?(m(),B("span",va,W(e.playlistStatus.device.name),1)):oe("",!0)]),n("div",ma,[l(le,{"model-value":v.value,onInput:f[2]||(f[2]=j=>e.onUpdateDeviceAddress(j)),placeholder:"设备地址",size:"small",class:"flex-1"},null,8,["model-value"]),l(k,{size:"small",type:"danger",plain:"",onClick:f[3]||(f[3]=j=>e.onUpdateDeviceAddress("")),disabled:!v.value,title:"清空设备地址"},{default:a(()=>[...f[14]||(f[14]=[X(" 清空 ",-1)])]),_:1},8,["disabled"])])])]),n("div",ga,[n("div",pa,[n("h5",ya,W(h.value),1),d.value?(m(),ae(k,{key:0,size:"small",type:"primary",plain:"",onClick:Q,loading:S.value,disabled:S.value,title:o.value},{default:a(()=>[S.value?oe("",!0):(m(),ae(t,{key:0},{default:a(()=>[l(r(Ge))]),_:1})),f[15]||(f[15]=n("span",{class:"ml-1"},"扫描设备",-1))]),_:1},8,["loading","disabled","title"])):oe("",!0)]),i.value?(m(),B("div",ha,[be((m(),B("div",ba,[(m(!0),B(Ce,null,Ae(e.connectedDeviceList,j=>(m(),B("div",{key:j.address,class:"flex items-center gap-2 p-2 border rounded hover:bg-gray-50"},[n("div",xa,[n("div",wa,W(j.name),1),n("div",Da,W(j.address),1)]),n("div",$a,[l(k,{size:"small",type:"primary",onClick:re=>d.value==="agent"?e.onSelectAgentDevice(j):e.onSelectBluetoothDevice(j.address),disabled:j.address===v.value},{default:a(()=>[...f[16]||(f[16]=[X(" 选择 ",-1)])]),_:1},8,["onClick","disabled"])])]))),128)),e.connectedDeviceList.length===0?(m(),B("div",Ca," 暂无设备 ")):oe("",!0)])),[[te,e.loading]])])):r(s)?(m(),B("div",Fa,[be((m(),B("div",ka,[(m(!0),B(Ce,null,Ae(e.dlnaDeviceList,j=>(m(),B("div",{key:j.location,class:"flex items-center gap-2 p-2 border rounded hover:bg-gray-50"},[n("div",_a,[n("div",Pa,W(j.name),1),n("div",{class:"text-xs text-gray-500 truncate",title:j.location},W(j.location),9,Sa)]),n("div",Ba,[l(k,{size:"small",type:"primary",onClick:re=>e.onUpdateDeviceAddress(j.location||j.address||"",j.name),disabled:(j.location||j.address)===v.value},{default:a(()=>[...f[17]||(f[17]=[X(" 选择 ",-1)])]),_:1},8,["onClick","disabled"])])]))),128)),e.dlnaDeviceList.length===0&&!e.dlnaScanning?(m(),B("div",Aa,' 暂无设备，点击"扫描设备"开始扫描 ')):oe("",!0)])),[[te,e.dlnaScanning]])])):r(c)?(m(),B("div",Ta,[be((m(),B("div",Ma,[(m(!0),B(Ce,null,Ae(e.miDeviceList,j=>(m(),B("div",{key:j.deviceID||j.address,class:"flex items-center gap-2 p-2 border rounded hover:bg-gray-50"},[n("div",Ea,[n("div",La,W(j.name),1),n("div",{class:"text-xs text-gray-500 truncate",title:j.deviceID||j.address},W(j.deviceID||j.address),9,Na)]),n("div",Ua,[l(k,{size:"small",type:"primary",onClick:re=>e.onSelectMiDevice(j),disabled:(j.deviceID||j.address)===v.value},{default:a(()=>[...f[18]||(f[18]=[X(" 选择 ",-1)])]),_:1},8,["onClick","disabled"])])]))),128)),e.miDeviceList.length===0&&!e.miScanning?(m(),B("div",Va,' 暂无设备，点击"扫描设备"开始扫描 ')):oe("",!0)])),[[te,e.miScanning]])])):oe("",!0)])])])):(m(),B("div",za," 请先选择一个播放列表 "))])}}}),Ra={class:"mb-4"},Wa={key:0,class:"text-center text-gray-400 mt-4 py-8"},ja=Ne({__name:"ScanDeviceDialog",props:{visible:{type:Boolean},deviceList:{},loading:{type:Boolean}},emits:["update:visible","refresh","connect","close"],setup(e,{emit:C}){const d=C,v=s=>{d("update:visible",s),s||d("close")},A=()=>{d("refresh")},i=s=>{d("connect",s)};return(s,c)=>{const h=Ve,o=Ot,S=zt,Q=Ze,z=xt;return m(),ae(Q,{"model-value":e.visible,"onUpdate:modelValue":v,title:"扫描到的设备",width:"800"},{default:a(()=>[n("div",Ra,[l(h,{type:"primary",onClick:A,loading:e.loading},{default:a(()=>[...c[0]||(c[0]=[X("刷新扫描",-1)])]),_:1},8,["loading"])]),be((m(),ae(S,{data:e.deviceList,stripe:"",class:"w-full",height:400},{default:a(()=>[l(o,{prop:"name",label:"设备名称","min-width":"150"}),l(o,{prop:"address",label:"地址","min-width":"120"}),l(o,{prop:"rssi",label:"信号强度",width:"100"},{default:a(({row:f})=>[n("span",null,W(f.rssi)+" dBm",1)]),_:1}),l(o,{label:"操作",width:"100"},{default:a(({row:f})=>[l(h,{size:"small",type:"primary",onClick:t=>i(f),loading:f.connecting,disabled:f.connecting},{default:a(()=>[...c[1]||(c[1]=[X(" 连接 ",-1)])]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1},8,["data"])),[[z,e.loading]]),e.deviceList.length===0&&!e.loading?(m(),B("div",Wa,' 暂无扫描到的设备，点击"刷新扫描"按钮开始扫描 ')):oe("",!0)]),_:1},8,["model-value"])}}});async function it(e,C,d){let v;const A="bluetooth";return C==="GET"?v=await Se.get(`/${A}/${e}`,{params:d}):v=await Se.post(`/${A}/${e}`,d),v.data}const Ga={class:"flex items-center gap-3 w-full pr-4"},Ya={class:"flex flex-col gap-4 h-full overflow-y-auto"},Ha={class:"flex flex-col gap-1"},Ka={class:"text-sm flex items-start"},Ia={class:"text-gray-800"},Ja={class:"text-sm flex items-start"},Qa={class:"text-gray-800"},qa={key:0,class:"text-gray-400"},Xa={class:"flex flex-col items-center gap-1"},Za={class:"text-xs text-gray-500"},ei={class:"flex flex-col gap-1"},ti={class:"text-[12px] mr-1 !w-4"},li={class:"flex flex-col gap-4 h-full overflow-y-auto"},si={key:0,class:"text-sm"},ni={key:1,class:"text-gray-400"},ai={class:"flex flex-col gap-4 h-full overflow-y-auto"},ii={class:"flex flex-col gap-1"},oi={class:"text-sm flex items-start"},ri=["title"],di={key:0,class:"text-sm flex items-start"},ui={class:"text-gray-800"},ci={class:"flex flex-col gap-2"},fi={class:"flex items-center gap-2"},vi={class:"text-gray-800 w-5"},mi={key:1},gi={class:"flex items-center gap-2"},pi={class:"flex flex-col gap-4 h-full overflow-y-auto"},yi={class:"flex flex-col gap-1"},hi={class:"text-sm flex items-start"},bi={class:"text-gray-800"},xi={class:"text-sm flex items-start"},wi={class:"text-gray-800 w-40"},Di={class:"text-gray-800 w-40"},$i={class:"flex flex-col gap-2"},Ci={class:"flex items-center gap-2"},Fi={class:"text-gray-800 w-5"},ki={key:1},_i={class:"flex items-center gap-2"},Pi=Ne({__name:"DevicesDrawer",props:{visible:{type:Boolean,default:!1}},emits:["update:visible"],setup(e,{emit:C}){const d=e,v=C,A=I(d.visible),i=I("agent"),s=I([]),c=I(!1);let h=null;const o=I([]),S=I(!1),Q=I([]),z=I(!1),f=I([]),t=I(!1),k=[{label:"B1",keys:["F13","F14"]},{label:"B2",keys:["F15","F16"]},{label:"B3",keys:["F17","F18"]}],w=async(V=!0,E=!1)=>{try{V&&(c.value=!0);const F=(await Se.get("/agent/list")).data;F?.code===0?(s.value=F.data||[],E&&M.success(`已获取 ${s.value.length} 个 Agent 设备`)):((E||V)&&M.error(F?.msg||"获取设备列表失败"),s.value=[])}catch(u){console.error("获取Agent设备列表失败:",u),(E||V)&&se(u,"获取设备列表失败"),s.value=[]}finally{V&&(c.value=!1)}},le=async(V,E)=>{const u=s.value.find(H=>H.agent_id===V);if(!u){M.error("设备不存在");return}const F=`testing_${E}`,x=u;x[F]=!0;try{const Z=(await Se.post("/agent/mock",{agent_id:V,action:"keyboard",key:E,value:"test"})).data;Z?.code===0?M.success(`测试按钮 ${E} 成功`):M.error(Z?.msg||`测试按钮 ${E} 失败`)}catch(H){se(H,`测试按钮 ${E} 失败`)}finally{x[F]=!1}},T=()=>{w(!0,!1),O(),h=setInterval(()=>{w(!1,!1)},In)},O=()=>{h&&(clearInterval(h),h=null)},L=()=>w(!0,!1),te=(V,E)=>le(V,E),j=async()=>{try{S.value=!0;const V=await it("paired","GET");if(V?.code===0){const E=Array.isArray(V.data)?V.data:[];o.value=E.map(u=>({name:u.name||"",address:u.address||"",...u,connecting:!1})),M.success(`已获取 ${o.value.length} 个已配对蓝牙设备`)}else M.error(V?.msg||"获取已配对设备列表失败")}catch(V){se(V,"获取已配对设备列表失败")}finally{S.value=!1}},re=()=>j(),N=ce(()=>i.value==="agent"?c.value:i.value==="bluetooth"?S.value:!1),b=ce(()=>{switch(i.value){case"dlna":return z.value;case"mi":return t.value;default:return!1}}),$=()=>{i.value==="agent"?L():i.value==="bluetooth"&&re()},p=()=>{switch(i.value){case"dlna":ue();break;case"mi":ye();break}},_=V=>V.deviceID||V.address||"",D=V=>Math.max(0,Math.min(100,V)),ee=V=>({...V,volume:void 0,_volumeChanging:!1,_volumeRefreshing:!1}),ye=async()=>{try{t.value=!0;const E=(await Se.get("/mi/scan",{params:{timeout:_t}})).data;if(E?.code===0){const u=(E.data||[]).map(F=>ee(F));f.value=u,await Promise.allSettled(u.map(F=>y(F))),M.success(`扫描到 ${u.length} 个小米设备`)}else M.error(E?.msg||"扫描小米设备失败")}catch(V){se(V,"扫描小米设备失败")}finally{t.value=!1}},y=async V=>{const E=_(V);if(!E)return;const u=f.value.find(F=>_(F)===E);if(u){u._volumeRefreshing=!0;try{const x=(await Se.get("/mi/volume",{params:{device_id:E}})).data;if(x?.code===0)u.volume=x.data?.volume??x.data??void 0;else{const H=u.name||E;M.error(x?.msg||`获取设备 ${H} 音量失败`)}}catch(F){const x=u.name||E;se(F,`获取设备 ${x} 音量失败`)}finally{u._volumeRefreshing=!1}}},U=async(V,E)=>{const u=_(V);if(!u){M.error("设备ID无效");return}const F=D(E);V._volumeChanging=!0;try{const H=(await Se.post("/mi/volume",{device_id:u,volume:F})).data;H?.code===0?(V.volume=F,M.success("音量设置成功")):M.error(H?.msg||"设置音量失败")}catch(x){se(x,"设置小米设备音量失败")}finally{V._volumeChanging=!1}},P=async V=>{const E=_(V);if(!E){M.warning("设备ID无效");return}try{V._stopping=!0;const F=(await Se.post("/mi/stop",{device_id:E})).data;F?.code===0?M.success("停止播放成功"):M.error(F?.msg||"停止播放失败")}catch(u){se(u,"停止小米设备播放失败")}finally{V._stopping=!1}},J=V=>V.location||V.address||"",Y=V=>({...V,volume:void 0,_volumeChanging:!1,_volumeRefreshing:!1}),ue=async()=>{try{z.value=!0;const E=(await Se.get("/dlna/scan",{params:{timeout:_t}})).data;if(E?.code===0){const u=(E.data||[]).map(F=>Y(F));Q.value=u,await Promise.allSettled(u.map(F=>fe(F))),M.success(`扫描到 ${u.length} 个 DLNA 设备`)}else M.error(E?.msg||"扫描 DLNA 设备失败")}catch(V){se(V,"扫描 DLNA 设备失败")}finally{z.value=!1}},fe=async V=>{const E=J(V);if(!E)return;const u=Q.value.find(F=>J(F)===E);if(u){u._volumeRefreshing=!0;try{const x=(await Se.get("/dlna/volume",{params:{location:E}})).data;if(x?.code===0)u.volume=x.data?.volume??x.data??void 0;else{const H=u.name||E;M.error(x?.msg||`获取设备 ${H} 音量失败`)}}catch(F){const x=u.name||E;se(F,`获取设备 ${x} 音量失败`)}finally{u._volumeRefreshing=!1}}},ge=async(V,E)=>{const u=J(V);if(!u){M.error("设备位置无效");return}const F=D(E);V._volumeChanging=!0;try{const H=(await Se.post("/dlna/volume",{location:u,volume:F})).data;H?.code===0?(V.volume=F,M.success("音量设置成功")):M.error(H?.msg||"设置音量失败")}catch(x){se(x,"设置 DLNA 设备音量失败")}finally{V._volumeChanging=!1}},Ee=async V=>{const E=J(V);if(!E){M.warning("设备位置无效");return}try{V._stopping=!0;const F=(await Se.post("/dlna/stop",{location:E})).data;F?.code===0?M.success("停止播放成功"):M.error(F?.msg||"停止播放失败")}catch(u){se(u,"停止 DLNA 设备播放失败")}finally{V._stopping=!1}},Fe=()=>{A.value=!1};return Le(()=>d.visible,V=>{A.value=V,V?T():O()},{immediate:!0}),Le(A,V=>{V!==d.visible&&v("update:visible",V)}),Le(i,(V,E)=>{V==="bluetooth"&&E!=="bluetooth"&&re()}),rt(()=>{d.visible&&(T(),i.value==="bluetooth"&&re())}),Mt(()=>{O()}),(V,E)=>{const u=He,F=Ve,x=Ot,H=bt,Z=zt,q=vs,ie=ms,pe=gs,De=Rt,Oe=xt;return m(),ae(De,{modelValue:A.value,"onUpdate:modelValue":E[1]||(E[1]=G=>A.value=G),size:1200,direction:"rtl","before-close":Fe,"header-class":"h-12 !mb-1"},{header:a(()=>[n("div",Ga,[E[4]||(E[4]=n("span",{class:"text-lg font-semibold"},"设备管理",-1)),i.value==="agent"||i.value==="bluetooth"?(m(),ae(F,{key:0,type:"primary",plain:"",size:"small",onClick:$,loading:N.value},{default:a(()=>[N.value?oe("",!0):(m(),ae(u,{key:0},{default:a(()=>[l(r(Ge))]),_:1})),E[2]||(E[2]=n("span",{class:"ml-1"},"刷新",-1))]),_:1},8,["loading"])):(m(),ae(F,{key:1,type:"primary",plain:"",size:"small",onClick:p,loading:b.value},{default:a(()=>[b.value?oe("",!0):(m(),ae(u,{key:0},{default:a(()=>[l(r(Ge))]),_:1})),E[3]||(E[3]=n("span",{class:"ml-1"},"扫描",-1))]),_:1},8,["loading"]))])]),default:a(()=>[l(pe,{modelValue:i.value,"onUpdate:modelValue":E[0]||(E[0]=G=>i.value=G),class:"h-full flex flex-col"},{default:a(()=>[l(q,{label:"Agent设备",name:"agent"},{default:a(()=>[n("div",Ya,[be((m(),ae(Z,{data:s.value,stripe:"",class:"w-full",height:600},{empty:a(()=>[...E[7]||(E[7]=[n("div",{class:"text-center text-gray-400 py-8"},"暂无设备，请等待设备注册",-1)])]),default:a(()=>[l(x,{prop:"name",label:"设备名称","min-width":"150"}),l(x,{label:"详情","min-width":"250"},{default:a(({row:G})=>[n("div",Ha,[n("div",Ka,[E[5]||(E[5]=n("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"地址：",-1)),n("span",Ia,W(G.address),1)]),n("div",Ja,[E[6]||(E[6]=n("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"ID：",-1)),n("span",Qa,W(G.agent_id),1)])])]),_:1}),l(x,{label:"支持的操作","min-width":"100"},{default:a(({row:G})=>[(m(!0),B(Ce,null,Ae(G.actions,g=>(m(),ae(H,{key:g,size:"small",type:"info",class:"mr-1"},{default:a(()=>[X(W(g),1)]),_:2},1024))),128)),!G.actions||G.actions.length===0?(m(),B("span",qa,"无")):oe("",!0)]),_:1}),l(x,{label:"状态/心跳",width:"90"},{default:a(({row:G})=>[n("div",Xa,[l(H,{type:G.is_online?"success":"danger",size:"small"},{default:a(()=>[X(W(G.is_online?"在线":"离线"),1)]),_:2},1032,["type"]),n("span",Za,W(G.last_heartbeat_ago)+"秒前 ",1)])]),_:1}),l(x,{label:"测试按钮",width:"180"},{default:a(({row:G})=>[n("div",ei,[(m(),B(Ce,null,Ae(k,(g,R)=>n("div",{key:R,class:"flex gap-1 items-center"},[l(u,{class:"!w-4 !h-5"},{default:a(()=>[l(r(Bt))]),_:1}),n("span",ti,W(g.label),1),(m(!0),B(Ce,null,Ae(g.keys,(K,de)=>(m(),ae(F,{key:de,size:"small",type:"primary",plain:"",onClick:Ue=>te(G.agent_id,K),loading:G[`testing_${K}`],class:"flex-1"},{default:a(()=>[X(W(K),1)]),_:2},1032,["onClick","loading"]))),128))])),64))])]),_:1})]),_:1},8,["data"])),[[Oe,c.value]])])]),_:1}),l(q,{label:"蓝牙设备",name:"bluetooth"},{default:a(()=>[n("div",li,[be((m(),ae(Z,{data:o.value,stripe:"",class:"w-full",height:600},{empty:a(()=>[...E[8]||(E[8]=[n("div",{class:"text-center text-gray-400 py-8"},'暂无设备，点击"扫描"开始扫描',-1)])]),default:a(()=>[l(x,{prop:"name",label:"设备名称","min-width":"200"}),l(x,{prop:"address",label:"设备地址","min-width":"180"}),l(x,{label:"信号强度",width:"120"},{default:a(({row:G})=>[G.rssi!==void 0?(m(),B("span",si,W(G.rssi)+" dBm ",1)):(m(),B("span",ni,"-"))]),_:1}),l(x,{label:"状态",width:"100"},{default:a(({row:G})=>[l(H,{type:G.connecting?"warning":G.rssi!==void 0?"success":"info",size:"small"},{default:a(()=>[X(W(G.connecting?"连接中":G.rssi!==void 0?"已发现":"未知"),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])),[[Oe,S.value]])])]),_:1}),l(q,{label:"DLNA设备",name:"dlna"},{default:a(()=>[n("div",ai,[be((m(),ae(Z,{data:Q.value,stripe:"",class:"w-full",height:600},{empty:a(()=>[...E[12]||(E[12]=[n("div",{class:"text-center text-gray-400 py-8"},'暂无设备，点击"扫描"开始扫描',-1)])]),default:a(()=>[l(x,{prop:"name",label:"设备名称","min-width":"150"}),l(x,{label:"详情","min-width":"400"},{default:a(({row:G})=>[n("div",ii,[n("div",oi,[E[9]||(E[9]=n("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"位置：",-1)),n("span",{class:"text-gray-800 flex-1 truncate",title:G.location},W(G.location||"-"),9,ri)]),G.manufacturer||G.model_name?(m(),B("div",di,[E[10]||(E[10]=n("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"型号：",-1)),n("span",ui,W(G.manufacturer||"")+" "+W(G.model_name||""),1)])):oe("",!0)])]),_:1}),l(x,{label:"功能","min-width":"200"},{default:a(({row:G})=>[n("div",ci,[n("div",fi,[E[11]||(E[11]=n("span",{class:"text-gray-600 inline-block w-11 flex-shrink-0"},"音量：",-1)),n("span",vi,W(G.volume!==void 0?G.volume:"-"),1),l(F,{size:"small",type:"info",plain:"",circle:"",onClick:g=>fe(G),loading:G._volumeRefreshing,disabled:G._volumeRefreshing||G._volumeChanging,title:"刷新音量",class:"p-0.5 !w-[17px] !h-[17px]"},{default:a(()=>[G._volumeRefreshing?oe("",!0):(m(),ae(u,{key:0},{default:a(()=>[l(r(Ge))]),_:1}))]),_:2},1032,["onClick","loading","disabled"]),l(F,{size:"small",class:"!w-8 !h-6",type:"danger",plain:"",onClick:g=>Ee(G),disabled:G._stopping,title:"停止播放"},{default:a(()=>[G._stopping?(m(),ae(u,{key:0,class:"animate-spin"},{default:a(()=>[l(r(Ie))]),_:1})):(m(),B("span",mi,"⏹"))]),_:2},1032,["onClick","disabled"])]),n("div",gi,[l(ie,{"model-value":G.volume??0,onInput:g=>G.volume=g,onChange:g=>ge(G,g),min:5,max:100,step:1,disabled:G._volumeChanging||G._volumeRefreshing||G.volume===void 0,size:"small",class:"flex-1 max-w-[200px]"},null,8,["model-value","onInput","onChange","disabled"])])])]),_:1})]),_:1},8,["data"])),[[Oe,z.value]])])]),_:1}),l(q,{label:"小米设备",name:"mi"},{default:a(()=>[n("div",pi,[be((m(),ae(Z,{data:f.value,stripe:"",class:"w-full",height:600},{empty:a(()=>[...E[17]||(E[17]=[n("div",{class:"text-center text-gray-400 py-8"},'暂无设备，点击"扫描"开始扫描',-1)])]),default:a(()=>[l(x,{prop:"name",label:"设备名称","min-width":"150"}),l(x,{label:"详情","min-width":"400"},{default:a(({row:G})=>[n("div",yi,[n("div",hi,[E[13]||(E[13]=n("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"ID：",-1)),n("span",bi,W(G.deviceID||"-"),1)]),n("div",xi,[E[14]||(E[14]=n("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"地址：",-1)),n("span",wi,W(G.mac||"-"),1),E[15]||(E[15]=n("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"DTD：",-1)),n("span",Di,W(G.miotDID||"-"),1)])])]),_:1}),l(x,{label:"功能","min-width":"200"},{default:a(({row:G})=>[n("div",$i,[n("div",Ci,[E[16]||(E[16]=n("span",{class:"text-gray-600 inline-block w-11 flex-shrink-0"},"音量：",-1)),n("span",Fi,W(G.volume!==void 0?G.volume:"-"),1),l(F,{size:"small",type:"info",plain:"",circle:"",onClick:g=>y(G),loading:G._volumeRefreshing,disabled:G._volumeRefreshing||G._volumeChanging,title:"刷新音量",class:"p-0.5 !w-[17px] !h-[17px]"},{default:a(()=>[G._volumeRefreshing?oe("",!0):(m(),ae(u,{key:0},{default:a(()=>[l(r(Ge))]),_:1}))]),_:2},1032,["onClick","loading","disabled"]),l(F,{size:"small",class:"!w-8 !h-6",type:"danger",plain:"",onClick:g=>P(G),disabled:G._stopping,title:"停止播放"},{default:a(()=>[G._stopping?(m(),ae(u,{key:0,class:"animate-spin"},{default:a(()=>[l(r(Ie))]),_:1})):(m(),B("span",ki,"⏹"))]),_:2},1032,["onClick","disabled"])]),n("div",_i,[l(ie,{"model-value":G.volume??0,onInput:g=>G.volume=g,onChange:g=>U(G,g),min:5,max:100,step:1,disabled:G._volumeChanging||G._volumeRefreshing||G.volume===void 0,size:"small",class:"flex-1 max-w-[200px]"},null,8,["model-value","onInput","onChange","disabled"])])])]),_:1})]),_:1},8,["data"])),[[Oe,t.value]])])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}}),Si={class:"flex gap-4 h-[500px]"},Bi={class:"w-64 flex flex-col border rounded p-3"},Ai={class:"flex-1 overflow-y-auto space-y-2"},Ti=["onClick"],Mi={class:"text-sm flex-1 truncate"},Ei={class:"text-xs text-gray-500 ml-2 whitespace-nowrap"},Li={key:0,class:"text-blue-600 font-medium"},Ni={key:1},Ui={key:0,class:"text-xs text-gray-400 text-center py-2"},Vi={class:"flex-1 flex flex-col border rounded p-3"},zi={key:0,class:"flex-1 overflow-y-auto"},Oi={class:"mb-3"},Ri={class:"space-y-1"},Wi=["onClick"],ji={class:"text-xs text-gray-500 whitespace-nowrap"},Gi={key:0,class:"text-blue-600 font-medium"},Yi={key:1},Hi={class:"border-t pt-3"},Ki={class:"flex items-center gap-2 py-1"},Ii={class:"text-xs text-gray-500 whitespace-nowrap"},Ji={key:0,class:"text-blue-600 font-medium"},Qi={key:1},qi={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},Xi={class:"flex items-center justify-between"},Zi={class:"text-sm text-gray-500"},eo={key:0},to={class:"flex gap-2"},lo=Ne({__name:"PlaylistSelectDialog",props:{visible:{type:Boolean,default:!1},playlistCollection:{default:()=>[]},selectedFiles:{default:()=>[]},onCopy:{type:Function,default:void 0},onRemove:{type:Function,default:void 0}},emits:["update:visible"],setup(e,{emit:C}){const d=e,v=C,A=I(d.visible),i=I(null),s=I([]),c=I(!1),h=ce(()=>d.playlistCollection.find(N=>N.id===i.value)||null),o=ce(()=>s.value.length>0||c.value),S=N=>{const b=h.value;if(!b||!b.pre_lists||!Array.isArray(b.pre_lists)||b.pre_lists.length!==7)return 0;const $=b.pre_lists[N];return Array.isArray($)?$.length:0},Q=()=>{const N=h.value;return!N||!N.playlist?0:Array.isArray(N.playlist)?N.playlist.length:0},z=N=>{if(!N)return 0;const b=N.pre_lists&&Array.isArray(N.pre_lists)&&N.pre_lists.length===7?N.pre_lists.reduce((p,_)=>p+(Array.isArray(_)?_.length:0),0):0,$=Array.isArray(N.playlist)?N.playlist.length:0;return b+$},f=()=>!d.selectedFiles||d.selectedFiles.length===0?new Set:new Set(d.selectedFiles.map(N=>typeof N=="string"?N:N.uri||String(N))),t=N=>{if(!N||!d.selectedFiles||d.selectedFiles.length===0)return 0;const b=f();let $=0;return N.pre_lists&&Array.isArray(N.pre_lists)&&N.pre_lists.length===7&&N.pre_lists.forEach(p=>{Array.isArray(p)&&p.forEach(_=>{const D=_.uri||String(_);b.has(D)&&$++})}),Array.isArray(N.playlist)&&N.playlist.forEach(p=>{const _=p.uri||String(p);b.has(_)&&$++}),$},k=N=>{const b=h.value;if(!b||!d.selectedFiles||d.selectedFiles.length===0||!b.pre_lists||!Array.isArray(b.pre_lists)||b.pre_lists.length!==7)return 0;const $=b.pre_lists[N];if(!Array.isArray($))return 0;const p=f();let _=0;return $.forEach(D=>{const ee=D.uri||String(D);p.has(ee)&&_++}),_},w=()=>{const N=h.value;if(!N||!d.selectedFiles||d.selectedFiles.length===0||!Array.isArray(N.playlist))return 0;const b=f();let $=0;return N.playlist.forEach(p=>{const _=p.uri||String(p);b.has(_)&&$++}),$},le=N=>{i.value=N,s.value=[],c.value=!1},T=N=>{const b=s.value.indexOf(N);b>-1?s.value.splice(b,1):s.value.push(N)},O=()=>{c.value=!c.value},L=async()=>{if(!h.value||!d.selectedFiles||d.selectedFiles.length===0||!o.value){M.warning("请选择播放列表和目标列表，并至少选中一个文件");return}try{const N=d.selectedFiles.map(_=>typeof _=="string"?_:_.uri||String(_)),b=s.value.length,$=c.value;let p="";if(b>0&&$)p=`${b}个前置文件列表和正式文件列表`;else if(b>0){const _=["周一","周二","周三","周四","周五","周六","周日"];p=`前置文件列表（${s.value.map(ee=>_[ee]).join("、")}）`}else $&&(p="正式文件列表");await Be.confirm(`确定要将选中的 ${N.length} 个文件复制到播放列表"${h.value.name}"的${p}吗？`,"确认复制",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),d.onCopy&&(await d.onCopy({playlistId:i.value,files:N,preLists:s.value,filesList:c.value}),M.success("文件已复制到播放列表"),j())}catch(N){N!=="cancel"&&se(N,"复制文件失败")}},te=async()=>{if(!h.value||!d.selectedFiles||d.selectedFiles.length===0||!o.value){M.warning("请选择播放列表和目标列表，并至少选中一个文件");return}try{const N=d.selectedFiles.map(_=>typeof _=="string"?_:_.uri||String(_)),b=s.value.length,$=c.value;let p="";if(b>0&&$)p=`${b}个前置文件列表和正式文件列表`;else if(b>0){const _=["周一","周二","周三","周四","周五","周六","周日"];p=`前置文件列表（${s.value.map(ee=>_[ee]).join("、")}）`}else $&&(p="正式文件列表");await Be.confirm(`确定要从播放列表"${h.value.name}"的${p}中删除选中的 ${N.length} 个文件吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),d.onRemove&&(await d.onRemove({playlistId:i.value,files:N,preLists:s.value,filesList:c.value}),M.success("文件已从播放列表删除"),j())}catch(N){N!=="cancel"&&se(N,"删除文件失败")}},j=()=>{A.value=!1,i.value=null,s.value=[],c.value=!1},re=()=>{d.playlistCollection&&d.playlistCollection.length>0&&!i.value&&(i.value=d.playlistCollection[0].id)};return Le(()=>d.playlistCollection,N=>{N&&N.length>0&&!i.value&&(i.value=N[0].id)},{immediate:!0}),Le(()=>d.visible,N=>{A.value=N,N&&re()}),Le(A,N=>{N!==d.visible&&v("update:visible",N)}),rt(()=>{re()}),(N,b)=>{const $=dt,p=Ve,_=Ze;return m(),ae(_,{modelValue:A.value,"onUpdate:modelValue":b[1]||(b[1]=D=>A.value=D),title:"应用到列表",width:"900","before-close":j},{footer:a(()=>[n("div",Xi,[n("div",Zi,[e.selectedFiles&&e.selectedFiles.length>0?(m(),B("span",eo," 已选择 "+W(e.selectedFiles.length)+" 个文件 ",1)):oe("",!0)]),n("div",to,[l(p,{onClick:j},{default:a(()=>[...b[7]||(b[7]=[X("取消",-1)])]),_:1}),l(p,{type:"primary",onClick:L,disabled:!o.value||!e.selectedFiles||e.selectedFiles.length===0},{default:a(()=>[...b[8]||(b[8]=[X(" 复制到列表 ",-1)])]),_:1},8,["disabled"]),l(p,{type:"danger",onClick:te,disabled:!o.value||!e.selectedFiles||e.selectedFiles.length===0},{default:a(()=>[...b[9]||(b[9]=[X(" 从列表删除 ",-1)])]),_:1},8,["disabled"])])])]),default:a(()=>[n("div",Si,[n("div",Bi,[b[2]||(b[2]=n("div",{class:"text-sm font-semibold mb-2"},"选择播放列表",-1)),n("div",Ai,[(m(!0),B(Ce,null,Ae(e.playlistCollection,D=>(m(),B("div",{key:D.id,class:Te(["flex items-center justify-between px-2 py-2 rounded cursor-pointer hover:bg-gray-50 transition-colors",{"bg-blue-50 border border-blue-200":D.id===i.value}]),onClick:ee=>le(D.id)},[n("span",Mi,W(D.name),1),n("span",Ei,[e.selectedFiles&&e.selectedFiles.length>0?(m(),B("span",Li,W(t(D))+"/"+W(z(D)),1)):(m(),B("span",Ni,W(z(D)),1))])],10,Ti))),128)),e.playlistCollection.length===0?(m(),B("div",Ui," 暂无播放列表 ")):oe("",!0)])]),n("div",Vi,[b[6]||(b[6]=n("div",{class:"text-sm font-semibold mb-3"},"选择目标列表（可多选）",-1)),h.value?(m(),B("div",zi,[n("div",Oi,[b[4]||(b[4]=n("div",{class:"text-xs text-gray-600 mb-2 font-semibold"},"前置文件",-1)),n("div",Ri,[(m(),B(Ce,null,Ae(["周一","周二","周三","周四","周五","周六","周日"],(D,ee)=>n("div",{key:ee,class:"flex items-center gap-2 py-1"},[l($,{"model-value":s.value.includes(ee),onChange:ye=>T(ee),size:"small"},null,8,["model-value","onChange"]),n("span",{class:Te(["text-xs flex-1 cursor-pointer hover:text-blue-500",{"text-blue-600 font-medium":s.value.includes(ee)}]),onClick:ye=>T(ee)},W(D),11,Wi),n("span",ji,[e.selectedFiles&&e.selectedFiles.length>0?(m(),B("span",Gi,W(k(ee))+"/"+W(S(ee)),1)):(m(),B("span",Yi,W(S(ee)),1)),b[3]||(b[3]=n("span",{class:"text-gray-400"}," 个文件",-1))])])),64))])]),n("div",Hi,[n("div",Ki,[l($,{"model-value":c.value,onChange:O,size:"small"},null,8,["model-value"]),n("span",{class:Te(["text-xs font-semibold text-gray-600 cursor-pointer hover:text-blue-500 flex-1",{"text-blue-600":c.value}]),onClick:b[0]||(b[0]=D=>O())}," 正式文件 ",2),n("span",Ii,[e.selectedFiles&&e.selectedFiles.length>0?(m(),B("span",Ji,W(w())+"/"+W(Q()),1)):(m(),B("span",Qi,W(Q()),1)),b[5]||(b[5]=n("span",{class:"text-gray-400"}," 个文件",-1))])])])])):(m(),B("div",qi," 请先选择一个播放列表 "))])])]),_:1},8,["modelValue"])}}}),so={class:"flex gap-4 h-full"},no={class:"w-64 border rounded p-3 flex flex-col"},ao={class:"flex items-center justify-between mb-3"},io={class:"flex-1 overflow-y-auto space-y-2"},oo=["onClick"],ro={class:"text-sm font-medium truncate"},uo={class:"text-xs text-gray-500 mt-1"},co={class:"flex items-center gap-1 flex-shrink-0"},fo={key:0,class:"text-sm text-gray-400 text-center py-4"},vo={class:"flex-1 border rounded p-3 flex flex-col"},mo={class:"mb-3 flex items-center justify-between"},go={class:"flex items-center gap-2"},po={class:"text-base font-semibold"},yo={key:0,class:"flex items-center gap-2"},ho={key:0,class:"ml-1 text-xs"},bo={class:"flex-1 overflow-y-auto"},xo={key:0,class:"space-y-1"},wo=["onClick"],Do={class:"text-xs text-gray-500 w-8"},$o=["title"],Co={key:1,class:"text-sm text-gray-400 text-center py-8"},Fo={class:"w-96 border rounded p-3 flex flex-col"},ko={class:"mb-3"},_o={class:"flex gap-2 mb-3"},Po={class:"mb-3"},So={class:"space-y-1 max-h-48 overflow-y-auto border rounded p-1"},Bo=["onClick"],Ao={class:"text-sm flex-1"},To={class:"text-xs text-gray-500 ml-2 whitespace-nowrap"},Mo={key:0,class:"text-xs text-gray-400 text-center py-2"},Eo={key:0,class:"flex-1 overflow-y-auto space-y-3"},Lo={class:"border rounded p-2"},No={class:"space-y-1"},Uo=["onClick"],Vo={class:"text-xs text-gray-500 whitespace-nowrap"},zo={class:"border rounded p-2"},Oo={class:"flex items-center gap-2 mb-2"},Ro={class:"text-xs text-gray-500 whitespace-nowrap"},Wo={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},Pt="t_batch_list",St="0",jo=7,Go=Ne({__name:"BatchDrawer",props:{visible:{type:Boolean,default:!1},playlistCollection:{default:()=>[]},onAddFiles:{type:Function,default:void 0},onRemoveFiles:{type:Function,default:void 0}},emits:["update:visible","refresh"],setup(e,{emit:C}){const d=e,v=C,A=I([]),i=I(null),s=I(null),c=I([]),h=I(!1),o=I([]),S=I(!1),Q=I(!1),z=I(!1),f=I(d.visible),t=ce(()=>A.value.find(g=>g.id===i.value)||null),k=ce(()=>d.playlistCollection.find(g=>g.id===s.value)||null),w=ce(()=>c.value.length>0||h.value),le=ce(()=>!t.value||!t.value.files||t.value.files.length===0?!1:o.value.length===t.value.files.length),T=ce(()=>{if(!t.value||!t.value.files||t.value.files.length===0)return!1;const g=o.value.length,R=t.value.files.length;return g>0&&g<R}),O=g=>typeof g=="string"?g:g?.uri||String(g),L=()=>t.value?.files?o.value.map(g=>t.value.files[g]).filter(g=>g!==null):[],te=()=>new Set(L().map(O)),j=g=>!!(g?.pre_lists&&Array.isArray(g.pre_lists)&&g.pre_lists.length===jo),re=g=>!!(g?.playlist&&Array.isArray(g.playlist)),N=(g,R)=>{if(!Array.isArray(g))return 0;let K=0;return g.forEach(de=>{R.has(O(de))&&K++}),K},b=g=>{const R=k.value;if(!j(R))return 0;const K=R.pre_lists[g];return Array.isArray(K)?K.length:0},$=g=>{if(!t.value||!k.value)return 0;const R=te();if(R.size===0)return 0;const K=k.value;if(!j(K))return 0;const de=K.pre_lists[g];return N(de,R)},p=()=>{const g=k.value;return re(g)?g.playlist.length:0},_=()=>{if(!t.value||!k.value)return 0;const g=te();if(g.size===0)return 0;const R=k.value;return re(R)?N(R.playlist,g):0},D=g=>{if(!g)return 0;let R=0;return j(g)&&g.pre_lists.forEach(K=>{Array.isArray(K)&&(R+=K.length)}),re(g)&&(R+=g.playlist.length),R},ee=g=>{if(!t.value||!g)return 0;const R=te();if(R.size===0)return 0;let K=0;return j(g)&&g.pre_lists.forEach(de=>{K+=N(de,R)}),re(g)&&(K+=N(g.playlist,R)),K},ye=async()=>{try{z.value=!0;const g=await ys(Pt,St);let R=[];if(g!=null)if(typeof g=="string"&&g.trim()!=="")try{const K=JSON.parse(g);R=Array.isArray(K)?K:[]}catch{R=[]}else Array.isArray(g)&&(R=g);A.value=R,U()}catch(g){A.value=[],se(g,"加载Batch列表失败")}finally{z.value=!1}},y=async()=>{try{const g=JSON.stringify(A.value);await hs(Pt,St,g)}catch(g){throw se(g,"保存Batch列表失败"),g}},U=()=>{if(A.value.length===0||i.value)return;const g=A.value[0];i.value=g.id,g?.files?.length>0&&(o.value=g.files.map((R,K)=>K))},P=(g,R)=>{const K=g.indexOf(R);K>-1?g.splice(K,1):g.push(R)},J=async()=>{try{const{value:g}=await Be.prompt("请输入Batch名称","创建Batch",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:"Batch名称",inputValidator:de=>!!de&&de.trim().length>0||"名称不能为空"}),R=g.trim(),K={id:Date.now().toString(),name:R,files:[],createTime:new Date().toISOString()};A.value.push(K),await y(),M.success("Batch创建成功"),i.value=K.id}catch(g){g!=="cancel"&&se(g,"创建Batch失败")}},Y=async g=>{const R=A.value.find(K=>K.id===g);if(R)try{const{value:K}=await Be.prompt("请输入Batch名称","编辑Batch",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:R.name,inputPlaceholder:"Batch名称",inputValidator:de=>!!de&&de.trim().length>0||"名称不能为空"});R.name=K.trim(),await y(),M.success("Batch名称已更新")}catch(K){K!=="cancel"&&se(K,"编辑Batch失败")}},ue=async g=>{const R=A.value.find(K=>K.id===g);if(R)try{await Be.confirm(`确定要删除Batch "${R.name}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const K=A.value.findIndex(de=>de.id===g);K>-1&&(A.value.splice(K,1),await y(),i.value===g&&(i.value=null),M.success("Batch已删除"))}catch(K){K!=="cancel"&&se(K,"删除Batch失败")}},fe=g=>{i.value=g;const R=A.value.find(K=>K.id===g);R&&R.files&&R.files.length>0?o.value=R.files.map((K,de)=>de):o.value=[]},ge=g=>{P(o.value,g)},Ee=g=>{!t.value||!t.value.files||(g?o.value=t.value.files.map((R,K)=>K):o.value=[])},Fe=async()=>{if(!(!t.value||o.value.length===0))try{const g=o.value.length;await Be.confirm(`确定要删除选中的 ${g} 个文件吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),[...new Set(o.value)].sort((K,de)=>de-K).forEach(K=>{K>=0&&K<t.value.files.length&&t.value.files.splice(K,1)}),t.value.files.length>0?o.value=t.value.files.map((K,de)=>de):o.value=[],await y(),M.success(`已删除 ${g} 个文件`)}catch(g){g!=="cancel"&&se(g,"删除失败")}},V=()=>{if(!t.value){M.warning("请先选择一个Batch");return}S.value=!0},E=async g=>{if(!(!t.value||g.length===0))try{Q.value=!0;const R=t.value,K=new Set(R.files.map(O)),de=g.filter(Ue=>!K.has(Ue)).map(Ue=>({uri:Ue}));R.files.push(...de),await y(),R.files.length>0&&(o.value=R.files.map((Ue,Je)=>Je)),M.success(`成功添加 ${de.length} 个文件`),S.value=!1}catch(R){se(R,"添加文件失败")}finally{Q.value=!1}},u=()=>{S.value=!1},F=g=>{s.value=s.value===g?null:g,c.value=[],h.value=!1},x=g=>{P(c.value,g)},H=g=>{h.value=g!==void 0?g:!h.value},Z=()=>!t.value||!s.value||o.value.length===0||!w.value?(M.warning("请选择Batch、播放列表和目标列表，并至少选中一个文件"),!1):!0,q=async()=>{if(Z())try{const g=L().map(O);await Be.confirm(`确定要将选中的 ${g.length} 个文件添加到选中的列表吗？`,"确认添加",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),d.onAddFiles&&(await d.onAddFiles({playlistId:s.value,files:g,preLists:c.value,filesList:h.value}),M.success("文件已添加到播放列表"))}catch(g){g!=="cancel"&&se(g,"添加文件失败")}},ie=async()=>{if(Z())try{const g=L().map(O);await Be.confirm(`确定要从选中的列表中删除选中的 ${g.length} 个文件吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),d.onRemoveFiles&&(await d.onRemoveFiles({playlistId:s.value,files:g,preLists:c.value,filesList:h.value}),M.success("文件已从播放列表删除"))}catch(g){g!=="cancel"&&se(g,"删除文件失败")}},pe=()=>{f.value=!1},De=()=>{c.value=[],h.value=!1,o.value=[]},Oe=()=>{i.value=null,s.value=null,De()},G=()=>{d.playlistCollection?.length>0?s.value=d.playlistCollection[0].id:s.value=null};return Le(()=>d.playlistCollection,g=>{g?.length>0&&!s.value&&(s.value=g[0].id)},{immediate:!0}),Le(()=>d.visible,g=>{f.value=g,g?(De(),G(),ye()):Oe()},{immediate:!0}),Le(f,g=>{g!==d.visible&&v("update:visible",g)}),rt(()=>{ye()}),(g,R)=>{const K=He,de=Ve,Ue=dt,Je=Rt;return m(),ae(Je,{modelValue:f.value,"onUpdate:modelValue":R[5]||(R[5]=he=>f.value=he),title:"批量模式",size:1200,direction:"rtl","header-class":"h-12 !mb-1","before-close":pe},{default:a(()=>[n("div",so,[n("div",no,[n("div",ao,[R[6]||(R[6]=n("h3",{class:"text-base font-semibold"},"Batch列表",-1)),l(de,{type:"primary",size:"small",onClick:J,plain:""},{default:a(()=>[l(K,null,{default:a(()=>[l(r(at))]),_:1})]),_:1})]),n("div",io,[(m(!0),B(Ce,null,Ae(A.value,he=>(m(),B("div",{key:he.id,class:Te(["border rounded px-3 py-2 hover:bg-gray-50 flex items-center gap-2",{"border-blue-500 bg-blue-50":he.id===i.value}])},[n("div",{class:"flex-1 cursor-pointer",onClick:_e=>fe(he.id)},[n("div",ro,W(he.name),1),n("div",uo,W(he.files?he.files.length:0)+" 个文件 ",1)],8,oo),n("div",co,[l(de,{type:"default",plain:"",size:"small",circle:"",onClick:$e(_e=>ue(he.id),["stop"]),title:"删除"},{default:a(()=>[l(K,null,{default:a(()=>[l(r(ze))]),_:1})]),_:1},8,["onClick"])])],2))),128)),A.value.length===0?(m(),B("div",fo,' 暂无Batch，点击"+"创建 ')):oe("",!0)])]),n("div",vo,[n("div",mo,[n("div",go,[n("h3",po,W(t.value?t.value.name:"请选择一个Batch"),1),t.value?(m(),ae(de,{key:0,type:"default",plain:"",size:"small",circle:"",onClick:R[0]||(R[0]=he=>Y(t.value.id)),title:"编辑"},{default:a(()=>[l(K,null,{default:a(()=>[l(r(Tt))]),_:1})]),_:1})):oe("",!0)]),t.value?(m(),B("div",yo,[l(de,{type:"default",size:"small",onClick:R[1]||(R[1]=he=>Ee(!le.value)),class:Te([{"!text-blue-600":le.value||T.value},"!w-20"]),plain:""},{default:a(()=>[le.value?(m(),ae(K,{key:0,class:"mr-1"},{default:a(()=>[l(r(qe))]),_:1})):T.value?(m(),ae(K,{key:1,class:"mr-1"},{default:a(()=>[l(r(pt))]),_:1})):oe("",!0),R[7]||(R[7]=n("span",{class:"text-xs"},"全选",-1))]),_:1},8,["class"]),l(de,{type:"primary",size:"small",onClick:V,plain:"",class:"!w-20"},{default:a(()=>[l(K,null,{default:a(()=>[l(r(at))]),_:1})]),_:1}),l(de,{type:"danger",size:"small",onClick:Fe,disabled:o.value.length===0,plain:"",class:"!w-20"},{default:a(()=>[l(K,null,{default:a(()=>[l(r(ze))]),_:1}),o.value.length>0?(m(),B("span",ho,"("+W(o.value.length)+")",1)):oe("",!0)]),_:1},8,["disabled"])])):oe("",!0)]),n("div",bo,[t.value&&t.value.files&&t.value.files.length>0?(m(),B("div",xo,[(m(!0),B(Ce,null,Ae(t.value.files,(he,_e)=>(m(),B("div",{key:_e,class:Te(["flex items-center gap-2 p-2 border border-blue-500 rounded hover:bg-gray-50 cursor-pointer",{"bg-blue-50":o.value.includes(_e)}]),onClick:Qe=>ge(_e)},[l(Ue,{"model-value":o.value.includes(_e),onChange:Qe=>ge(_e),class:"!h-6",onClick:R[2]||(R[2]=$e(()=>{},["stop"])),size:"default"},null,8,["model-value","onChange"]),n("span",Do,W(_e+1),1),n("span",{class:"flex-1 text-sm truncate",title:O(he)},W(O(he).split("/").pop()),9,$o)],10,wo))),128))])):(m(),B("div",Co,W(t.value?"该Batch暂无文件":"请先选择一个Batch"),1))])]),n("div",Fo,[n("div",ko,[R[11]||(R[11]=n("h3",{class:"text-base font-semibold mb-2"},"Playlist操作",-1)),n("div",_o,[l(de,{type:"default",size:"small",onClick:q,disabled:!t.value||!s.value||o.value.length===0||!w.value,plain:""},{default:a(()=>[l(K,{class:"mr-1"},{default:a(()=>[l(r(at))]),_:1}),R[8]||(R[8]=X(" 添加到播放列表 ",-1))]),_:1},8,["disabled"]),l(de,{type:"default",size:"small",onClick:ie,disabled:!t.value||!s.value||o.value.length===0||!w.value,plain:""},{default:a(()=>[l(K,{class:"mr-1"},{default:a(()=>[l(r(ze))]),_:1}),R[9]||(R[9]=X(" 从播放列表删除 ",-1))]),_:1},8,["disabled"])]),n("div",Po,[R[10]||(R[10]=n("div",{class:"text-xs text-gray-500 mb-2"},"选择播放列表 进行批量操作",-1)),n("div",So,[(m(!0),B(Ce,null,Ae(e.playlistCollection,he=>(m(),B("div",{key:he.id,class:Te(["flex items-center justify-between px-2 py-1.5 rounded cursor-pointer hover:bg-gray-50 transition-colors",{"bg-blue-50 border border-blue-200":he.id===s.value}]),onClick:_e=>F(he.id)},[n("span",Ao,W(he.name),1),n("span",To,W(ee(he))+" / "+W(D(he)),1)],10,Bo))),128)),e.playlistCollection.length===0?(m(),B("div",Mo," 暂无播放列表 ")):oe("",!0)])])]),k.value?(m(),B("div",Eo,[n("div",Lo,[R[12]||(R[12]=n("div",{class:"text-xs font-semibold text-gray-600 mb-2"},"前置文件",-1)),n("div",No,[(m(),B(Ce,null,Ae(["周一","周二","周三","周四","周五","周六","周日"],(he,_e)=>n("div",{key:_e,class:"flex items-center gap-2"},[l(Ue,{"model-value":c.value.includes(_e),onChange:Qe=>x(_e),size:"small"},null,8,["model-value","onChange"]),n("span",{class:Te(["text-xs flex-1 cursor-pointer hover:text-blue-500",{"text-blue-600 font-medium":c.value.includes(_e)}]),onClick:Qe=>x(_e)},W(he),11,Uo),n("span",Vo,W($(_e))+" / "+W(b(_e)),1)])),64))])]),n("div",zo,[n("div",Oo,[l(Ue,{"model-value":h.value,onChange:H,size:"small"},null,8,["model-value"]),n("span",{class:Te(["text-xs font-semibold text-gray-600 cursor-pointer hover:text-blue-500 flex-1",{"text-blue-600":h.value}]),onClick:R[3]||(R[3]=he=>H())}," 正式文件 ",2),n("span",Ro,W(_())+" / "+W(p()),1)])])])):(m(),B("div",Wo," 请先选择一个播放列表 "))])]),l(Lt,{visible:S.value,"onUpdate:visible":R[4]||(R[4]=he=>S.value=he),title:"选择文件添加到Batch","confirm-button-text":"添加","confirm-loading":Q.value,onConfirm:E,onClose:u},null,8,["visible","confirm-loading"])]),_:1},8,["modelValue"])}}});function Yo(){return{...{playlistCollection:I([]),activePlaylistId:I(""),playlistStatus:I(null),playlistLoading:I(!1),playlistRefreshing:I(!1),playing:I(!1),stopping:I(!1),showMoreActions:I(!1),editingPlaylistId:I(null),editingPlaylistName:I(""),fileBrowserDialogVisible:I(!1),fileBrowserTarget:I("files"),replaceFileInfo:I(null),selectedWeekdayIndex:I(null),preFilesDragMode:I(!1),filesDragMode:I(!1),preFilesBatchDeleteMode:I(!1),filesBatchDeleteMode:I(!1),selectedPreFileIndices:I([]),selectedFileIndices:I([]),preFilesExpanded:I(!1),playlistSelectorVisible:I(!1),playlistSelectorSelectedFiles:I([]),batchDrawerVisible:I(!1),cronBuilderVisible:I(!1),cronPreviewVisible:I(!1),cronPreviewTimes:I([]),initialCronExpr:I(""),agentListDialogVisible:I(!1),scanDialogVisible:I(!1),loading:I(!1),deviceList:I([]),connectedDeviceList:I([]),dlnaDeviceList:I([]),dlnaScanning:I(!1),miDeviceList:I([]),miScanning:I(!1),pendingDeviceType:I(null),preFilesSortOrder:I(null),filesSortOrder:I(null),preFilesOriginalOrder:I(null),filesOriginalOrder:I(null)}}}async function We(e,C,d={}){let v;return C==="GET"?v=await Se.get(`/playlist/${e}`,{params:d}):v=await Se.post(`/playlist/${e}`,d),v.data}function Ho(e,C,d,v,A,i,s,c){const h=y=>y.map(U=>({...U})),o=y=>{const U="playlist"in y&&Array.isArray(y.playlist)&&y.playlist||"files"in y&&Array.isArray(y.files)&&y.files||[];return h(lt(U,!0))},S=y=>{if(y.pre_lists&&Array.isArray(y.pre_lists)&&y.pre_lists.length===st)return y.pre_lists.map(J=>h(lt(J||[],!0)));const U="pre_files"in y&&Array.isArray(y.pre_files)&&y.pre_files||[],P=h(lt(U,!0));return Array(st).fill(null).map(()=>[...P])},Q=y=>qn.includes(y)?y:Xn,z=y=>({enabled:y?.enabled===1?1:0,cron:y?.cron?String(y.cron):"",duration:y?.duration||0}),f=(y,U)=>{if(typeof y=="number")return y;if(y==null)return U;const P=parseInt(String(y),10);return isNaN(P)?U:P},t=y=>y===!0||y===1,k=(y,U)=>{if(U===0)return 0;const P=f(y,0);return Math.max(0,Math.min(P,U-1))},w=()=>Array(st).fill(null).map(()=>[]),le=y=>Array.isArray(y)&&y.length===st&&y.every(U=>Array.isArray(U)),T=(y,U="播放列表")=>{const P=o(y),J=S(y),Y=k(y?.current_index,P.length),ue=y?.name&&String(y.name).trim()||U,fe=Q(y?.device?.type||y?.device_type),ge=y?.device_address||y?.device?.address||null;return{id:y?.id||xs(),name:ue,playlist:P,pre_lists:J,total:P.length,current_index:Y,pre_index:f(y?.pre_index,-1),device_address:ge,device_type:fe,device:y?.device||{type:fe,address:ge,name:y?.device?.name||null},schedule:z(y?.schedule),trigger_button:y?.trigger_button||"",updatedAt:"updatedAt"in y&&typeof y.updatedAt=="number"?y.updatedAt:Date.now(),isPlaying:t(y?.isPlaying)}},O=y=>!Array.isArray(y)||y.length===0?[T({name:je})]:y.map((U,P)=>"playlist"in U&&"total"in U?U:T(U,U?.name||`播放列表${P+1}`)),L=y=>{if(y&&"playlists"in y&&Array.isArray(y.playlists)){const P=y,J=O(P.playlists),Y=J.some(ue=>ue.id===P.activePlaylistId)?P.activePlaylistId:J[0]?.id||null;return{playlists:J,activePlaylistId:Y}}if(y&&!Array.isArray(y)&&("playlist"in y||"files"in y)){const P=y,J="playlist"in P&&Array.isArray(P.playlist)&&P.playlist||"files"in P&&Array.isArray(P.files)&&P.files||[],Y=T({id:P.id||P.playlist_id,name:P.name||je,files:J,current_index:P.current_index,device_address:P.device_address});return{playlists:[Y],activePlaylistId:Y.id}}const U=T({name:je});return{playlists:[U],activePlaylistId:U.id}},te=y=>{if(!y)return null;if(!Array.isArray(y)&&Object.keys(y).length>0){const U=Object.values(y).map(P=>T(P,P.name||je));return{playlists:U,activePlaylistId:U[0]?.id||null}}if(Array.isArray(y)){const U=y.map(P=>T(P,P.name||je));return{playlists:U,activePlaylistId:U[0]?.id||null}}if(!Array.isArray(y)&&"id"in y&&typeof y.id=="string"){const U=y;return{playlists:[T(U,U.name||je)],activePlaylistId:U.id}}return null},j=y=>{const U={};return y.forEach(P=>{if(!P.id)return;const J=Q(P.device?.type||P.device_type),Y=lt(P.playlist||[],!0),ue=S(P);U[P.id]={id:P.id,name:P.name||je,files:Y,pre_lists:ue,current_index:P.current_index||0,device:{address:P.device?.address||P.device_address||"",type:J,name:P.device?.name||null},schedule:P.schedule||{enabled:0,cron:"",duration:0},trigger_button:P.trigger_button||"",create_time:P.create_time||kt(),updated_time:kt()}}),U},re=async y=>{try{const U=(y||e.value||[]).map(Y=>({...Y,total:Array.isArray(Y.playlist)?Y.playlist.length:0,updatedAt:Date.now()})),P=j(U),J=await We("updateAll","POST",P);if(J.code!==0)throw new Error(J.msg||"保存播放列表集合失败")}catch(U){se(U,"保存播放列表集合失败")}},N=async y=>{try{const P=j([y])[y.id];if(!P)throw new Error("播放列表数据格式错误");const J=await We("update","POST",P);if(J.code!==0)throw new Error(J.msg||"更新播放列表失败");return!0}catch(U){return se(U,"更新播放列表失败"),!1}},b=y=>{const U=Array.isArray(y)?y:e.value;if(!U||U.length===0){d.value=null,C.value="";return}const P=U.find(ue=>ue.id===C.value)||U[0];C.value=P.id;const J=k(P.current_index,P.playlist?.length||0),Y=le(P.pre_lists)?P.pre_lists.map(ue=>[...ue||[]]):w();d.value={...P,playlist:[...P.playlist||[]],pre_lists:Y,current_index:J,pre_index:f(P.pre_index,-1),in_pre_files:!1,isPlaying:t(P.isPlaying)}},$=y=>({...y,playlist:y.playlist.map(U=>({...U})),pre_lists:le(y.pre_lists)?y.pre_lists.map(U=>U.map(P=>({...P}))):w()}),p=async y=>{if(typeof y!="function")return null;let U=e.value.length>0?e.value.map($):[T({name:je})],P=U.findIndex(fe=>fe.id===C.value);P===-1&&(P=0,C.value=U[0].id);const J=U[P],Y=y($(J))||J,ue=T(Y,J.name);return le(ue.pre_lists)||(ue.pre_lists=le(J.pre_lists)?J.pre_lists.map(fe=>fe.map(ge=>({...ge}))):w()),U[P]=ue,e.value=U,await N(U[P]),b(U),d.value},_=(y,U)=>{const P=localStorage.getItem(Wt);P&&y.some(J=>J.id===P)?C.value=P:C.value=U||""},D=async()=>{try{const y=await We("get","GET",{});if(y.code!==0)throw new Error(y.msg||"获取播放列表失败");const U=te(y.data),P=L(U||null);return e.value=P.playlists,_(P.playlists,P.activePlaylistId),b(P.playlists),P}catch(y){Xe.error("从接口加载播放列表失败:",y);const U=L(null);return e.value=U.playlists,_(U.playlists,U.activePlaylistId),b(U.playlists),U}},ee=y=>y?!!(A.value!==null||i.value||s.value):!1;return{normalizePlaylistItem:T,normalizePlaylistCollection:L,transformApiDataToPlaylistFormat:te,transformPlaylistToApiFormat:j,savePlaylist:re,updateSinglePlaylist:N,syncActivePlaylist:b,updateActivePlaylistData:p,loadPlaylist:D,refreshPlaylistStatus:async(y=!1,U=!1)=>{try{if(ee(U))return;if(v.value=!0,y){const P=C.value;if(!P)return;const J=await We("get","GET",{id:P});if(J.code!==0)throw new Error(J.msg||"获取播放列表状态失败");const Y=te(J.data);if(!Y?.playlists?.length)return;const ue=Y.playlists[0],fe=e.value.map(ge=>ge.id!==P?ge:{...ge,...ue,playlist:ue.playlist||ge.playlist,pre_lists:le(ue.pre_lists)?ue.pre_lists.map(Ee=>[...Ee||[]]):ge.pre_lists,current_index:ue.current_index!==void 0?ue.current_index:ge.current_index,isPlaying:t(ue?.isPlaying)});e.value=fe,b(fe)}else await D()}catch(P){Xe.error("刷新播放列表状态失败:",P)}finally{v.value=!1}}}}function Ko(e,C,d,v,A,i,s,c,h){return{loadPlaylist:async()=>{try{const T=await We("get","GET",{});if(T.code!==0)throw new Error(T.msg||"获取播放列表失败");return T.data}catch(T){throw Xe.error("从接口加载播放列表失败:",T),T}},handleSelectPlaylist:async T=>{!T||T===C.value||!e.value.find(L=>L.id===T)||(C.value=T,localStorage.setItem(Wt,T),i(e.value))},handleCreatePlaylist:async()=>{try{const T=`播放列表${e.value.length+1}`,{value:O}=await Be.prompt("请输入播放列表名称","新建播放列表",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:T,inputPlaceholder:T,inputValidator:te=>!!te&&te.trim().length>0||"名称不能为空"});return{name:(O||T).trim()}}catch(T){if(T!=="cancel")throw T;return null}},handleCopyPlaylist:async T=>{if(!T)return null;const O=e.value.find(L=>L.id===T);if(!O)return null;try{const L=`${O.name}_副本`,{value:te}=await Be.prompt("请输入播放列表名称","复制播放列表",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:L,inputPlaceholder:L,inputValidator:re=>!!re&&re.trim().length>0||"名称不能为空"}),j=(te||L).trim();return{sourcePlaylist:O,name:j}}catch(L){if(L!=="cancel")throw L;return null}},handleDeletePlaylistGroup:async T=>{if(!T)return!1;if(e.value.length<=1)return M.warning("至少保留一个播放列表"),!1;const O=e.value.find(L=>L.id===T);if(!O)return!1;try{return await Be.confirm(`确认删除播放列表"${O.name}"吗？`,"删除播放列表",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),!0}catch(L){if(L!=="cancel")throw L;return!1}},handlePlayPlaylist:async()=>{const T=d.value;if(!T||!T.id){M.warning("播放列表不存在");return}if(!T.playlist||T.playlist.length===0){M.warning("播放列表为空，请先添加文件");return}try{v.value=!0,await s(L=>{const te=Array.isArray(L.playlist)?L.playlist:[];return L.current_index=Math.max(0,Math.min(L.current_index||0,te.length-1)),L.total=te.length,L});const O=await We("play","POST",{id:T.id});if(O.code!==0)throw new Error(O.msg||"播放失败");await c(!0),M.success("开始播放")}catch(O){se(O,"播放失败")}finally{v.value=!1}},handlePlayNext:async()=>{const T=d.value;if(!T||!T.id){M.warning("播放列表不存在");return}if(!T.playlist||T.playlist.length===0){M.warning("播放列表为空，无法播放下一首");return}try{v.value=!0;const O=await We("playNext","POST",{id:T.id});if(O.code!==0)throw new Error(O.msg||"播放下一首失败");await c(!0),M.success("已切换到下一首")}catch(O){se(O,"播放下一首失败")}finally{v.value=!1}},handlePlayPre:async()=>{const T=d.value;if(!T||!T.id){M.warning("播放列表不存在");return}const O=h().length>0,L=T.playlist&&T.playlist.length>0;if(!O&&!L){M.warning("播放列表为空，无法播放上一首");return}try{v.value=!0;const te=await We("playPre","POST",{id:T.id});if(te.code!==0)throw new Error(te.msg||"播放上一首失败");await c(!0),M.success("已切换到上一首")}catch(te){se(te,"播放上一首失败")}finally{v.value=!1}},handleStopPlaylist:async()=>{const T=d.value;if(!T||!T.id){M.warning("播放列表不存在");return}try{A.value=!0;const O=await We("stop","POST",{id:T.id});if(O.code!==0)throw new Error(O.msg||"停止播放失败");await c(!0),M.success("已停止播放")}catch(O){se(O,"停止播放列表失败")}finally{A.value=!1}}}}function Io(e,C,d,v,A,i){const s=()=>{const k=e.value?.schedule?.cron||"";A.value=k,C.value=!0},c=()=>{C.value=!1},h=k=>{k&&(e.value?(Q(k),M.success("Cron 表达式已应用到当前播放列表")):M.warning("请先选择一个播放列表"))},o=k=>{v.value=k,d.value=!0},S=async k=>{e.value&&await i(w=>(w.schedule||(w.schedule={enabled:0,cron:"",duration:0}),w.schedule.enabled=k?1:0,w))},Q=async k=>{e.value&&await i(w=>(w.schedule||(w.schedule={enabled:0,cron:"",duration:0}),w.schedule.cron=k,w))};return{handleOpenCronBuilder:s,handleCloseCronBuilder:c,handleCronBuilderApply:h,handleCronBuilderPreview:o,handleTogglePlaylistCronEnabled:S,handleUpdatePlaylistCron:Q,handleUpdatePlaylistDuration:async k=>{e.value&&await i(w=>(w.schedule||(w.schedule={enabled:0,cron:"",duration:0}),w.schedule.duration=k||0,w))},handleUpdateTriggerButton:async k=>{e.value&&await i(w=>(w.trigger_button=k||"",w))},handlePreviewPlaylistCron:()=>{if(!e.value||!e.value.schedule?.cron){M.warning("请先设置 Cron 表达式");return}try{const k=e.value.schedule.cron,w=wt(k,5);w&&w.length>0?(v.value=w,d.value=!0):M.warning("无法解析 Cron 表达式")}catch(k){se(k,"预览失败")}}}}function Jo(e,C,d,v,A,i,s,c,h,o,S,Q){const z=p=>p.deviceID||p.address||"",f=async()=>{const p=e.value,_=C.value||p?.device?.type||p?.device_type||"dlna";if(!["agent","bluetooth"].includes(_)){d.value=[];return}try{s.value=!0;let D=null;_==="agent"?D=(await Se.get("/agent/list")).data:D=await it("paired","GET"),D.code===0?d.value=D.data||[]:M.error(D.msg||"获取设备失败")}catch(D){console.error("获取设备失败:",D),M.error("获取设备失败")}finally{s.value=!1}},t=async p=>{try{p.connecting=!0;const _=await it("connect","POST",{address:p.address});_.code===0?(M.success(`成功连接到设备: ${p.name}`),await f(),i.value=i.value.filter(D=>D.address!==p.address)):M.error(_.msg||"连接失败")}catch(_){console.error("连接设备失败:",_),M.error("连接设备失败")}finally{p.connecting=!1}},k=async()=>{try{c.value=!0;const p=await Se.get("/dlna/scan",{params:{timeout:5}});p.data.code===0?(v.value=p.data.data||[],M.success(`扫描到 ${v.value.length} 个 DLNA 设备`)):M.error(p.data.msg||"扫描 DLNA 设备失败")}catch(p){se(p,"扫描 DLNA 设备失败")}finally{c.value=!1}},w=async p=>{const _=z(p);if(!_)return;const D=A.value;if(!Array.isArray(D))return;const ee=D.find(ye=>z(ye)===_);if(ee){ee._volumeRefreshing=!0;try{const ye=await Se.get("/mi/volume",{params:{device_id:_}});ye.data.code===0?ee.volume=ye.data.data?.volume??ye.data.data??void 0:M.error(ye.data.msg||`获取设备 ${ee.name||_} 音量失败`)}catch(ye){se(ye,`获取设备 ${ee.name||_} 音量失败`)}finally{ee._volumeRefreshing=!1}}},le=async()=>{try{h.value=!0;const p=await Se.get("/mi/scan",{params:{timeout:5}});if(p.data.code===0){const _=(p.data.data||[]).map(D=>({...D,volume:void 0,_volumeChanging:!1,_volumeRefreshing:!1}));A.value=_,await Promise.allSettled(A.value.map(D=>w(D))),M.success(`扫描到 ${_.length} 个小米设备`)}else M.error(p.data.msg||"扫描小米设备失败")}catch(p){se(p,"扫描小米设备失败")}finally{h.value=!1}},T=async()=>{try{s.value=!0;const p=await it("scan","GET");if(p.code===0){const _=Array.isArray(p.data)?p.data:[];i.value=_.map(D=>({name:D.name||"",address:D.address||"",...D,connecting:!1})),M.success(`扫描完成，找到 ${i.value.length} 个设备`)}else M.error(p.msg||"扫描失败")}catch(p){console.error("扫描设备失败:",p),M.error("扫描设备失败")}finally{s.value=!1}},O=()=>{o.value=!0},L=()=>{o.value=!1},te=async p=>{if(!e.value||!p||p==="")return;if(!["agent","dlna","bluetooth","mi"].includes(p)){M.error(`无效的设备类型: ${p}`);return}const D=p;C.value=D;const ee=e.value;ee.device_type=D,ee.device?ee.device.type=D:ee.device={type:D,address:"",name:null},await f()},j=async(p,_=null)=>{e.value&&(await Q(D=>{const ee=C.value||D.device?.type||D.device_type||"dlna";return D.device||(D.device={address:"",type:ee,name:null}),D.device.type=ee,D.device.address=p,_!==null&&(D.device.name=_),D.device_address=p,D.device_type=ee,D}),C.value=null)};return{getMiDeviceId:z,refreshConnectedList:f,handleConnectDevice:t,scanDlnaDevices:k,getMiDeviceVolume:w,scanMiDevices:le,handleUpdateDeviceList:T,handleOpenScanDialog:O,handleCloseScanDialog:L,handleUpdatePlaylistDeviceType:te,handleUpdatePlaylistDeviceAddress:j,handleSelectBluetoothDevice:async p=>{const _=d.value.find(ee=>ee.address===p),D=_?_.name:null;await j(p,D)},handleSelectAgentDevice:async p=>{const _=typeof p=="string"?p:p.address,D=typeof p=="string"?null:p.name;await j(_,D)},handleSelectMiDevice:async p=>{const _=p.deviceID||p.address||"",D=p.name||"";await j(_,D)},handleOpenAgentListDialog:async()=>{S.value=!0,await f()}}}function Qo(){const e=ls({callbacks:{onPlay:()=>{M.success("开始播放")},onError:()=>{se(new Error("音频播放失败"),"播放失败"),C()},onEnded:()=>{C()}}}),C=()=>{e.clear()};return{audioPlayer:e,clearBrowserAudioPlayer:C,handlePlayFileInBrowser:c=>{const h=c?.uri||c?.path||"";if(!h||typeof h!="string"||h.trim()===""){M.warning("文件路径无效");return}if(e.playingFilePath.value===h&&e.audio&&!e.audio.paused){C(),M.info("已停止播放");return}const o=ss(h);if(!o||typeof o!="string"||o.trim()===""){M.error("无法生成媒体文件URL");return}if(o.includes("index.html")||o.endsWith(".html")){M.error("生成的媒体URL无效，可能是HTML页面");return}e.load(o,{playingFilePath:h}),e.play().catch(S=>{se(S,"播放失败"),C()})},isFilePlaying:c=>{const h=c?.uri||c?.path||"";return e.isFilePlaying(h)},getFilePlayProgress:c=>{const h=c?.uri||c?.path||"";return e.getFilePlayProgress(h)},getFileDuration:c=>{const h=c?.uri||c?.path||"",o=c?.duration||0;return e.getFileDuration(h,o)},handleSeekFile:(c,h)=>{const o=c?.uri||c?.path||"";e.seekFile(o,h)}}}function qo(e,C,d,v,A,i,s,c,h,o,S,Q,z,f,t){const k=()=>s.value!==null?s.value:Ye(),w=u=>((!u.pre_lists||!Array.isArray(u.pre_lists)||u.pre_lists.length!==7)&&(u.pre_lists=Array(7).fill(null).map(()=>[])),u.pre_lists),le=(u="请先选择一个播放列表")=>C.value?!0:(M.warning(u),!1),T=(u,F)=>{u!=="cancel"&&se(u,F)},O=async(u,F)=>{try{d.value=!0,await u()}catch(x){T(x,F)}finally{d.value=!1}},L=()=>{le()&&(v.value=!0,A.value="files",i.value=null)},te=()=>{le()&&(v.value=!0,A.value="pre_files",i.value=null)},j=async u=>{if(u.length!==0){if(!C.value){M.warning("请先创建并选择一个播放列表");return}try{d.value=!0,await Q(x=>{const H=k(),Z=A.value,q=Z==="pre_files"?Array.isArray(x.pre_lists)&&x.pre_lists.length===7?[...x.pre_lists[H]||[]]:[]:Array.isArray(x.playlist)?[...x.playlist]:[],ie=new Set;if(q.forEach(pe=>{pe?.uri&&ie.add(pe.uri)}),i.value&&u.length>0){const pe=i.value.index;if(i.value.type==="pre_files"){w(x);const De=[...x.pre_lists[H]||[]];pe>=0&&pe<De.length&&(De[pe]={uri:u[0]},x.pre_lists[H]=De)}else{const De=[...x.playlist];pe>=0&&pe<De.length&&(De[pe]={uri:u[0]},x.playlist=De,x.total=De.length)}return i.value=null,x}for(const pe of u)if(!ie.has(pe)){const De={uri:pe};q.push(De),ie.add(pe)}return Z==="pre_files"?(w(x),x.pre_lists[H]=q):(x.playlist=q,x.total=q.length,q.length===0?x.current_index=0:x.current_index>=q.length&&(x.current_index=q.length-1)),x});const F=A.value==="pre_files"?"前置列表":"播放列表";M.success(`成功添加 ${u.length} 个文件到${F}`),v.value=!1}catch(F){se(F,"添加文件到播放列表失败")}finally{d.value=!1}}},re=()=>{v.value=!1},N=async u=>{const F=C.value;if(!(!F||u<=0||u>=F.playlist.length))try{d.value=!0,await Q(x=>{const H=[...x.playlist];return[H[u-1],H[u]]=[H[u],H[u-1]],x.playlist=H,x.current_index===u?x.current_index=u-1:x.current_index===u-1&&(x.current_index=u),x.total=H.length,x}),M.success("已上移")}catch(x){se(x,"上移失败")}finally{d.value=!1}},b=async u=>{const F=C.value;if(!(!F||u<0||u>=F.playlist.length-1))try{d.value=!0,await Q(x=>{const H=[...x.playlist];return[H[u],H[u+1]]=[H[u+1],H[u]],x.playlist=H,x.current_index===u?x.current_index=u+1:x.current_index===u+1&&(x.current_index=u),x.total=H.length,x}),M.success("已下移")}catch(x){se(x,"下移失败")}finally{d.value=!1}},$=async u=>{const F=C.value;if(!F||u<0||u>=F.playlist.length)return;const H=F.playlist[u]?.uri?.split("/").pop()||"文件";try{await Be.confirm(`确定要删除 "${H}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),d.value=!0,await Q(Z=>{const q=[...Z.playlist];return q.splice(u,1),Z.playlist=q,q.length===0?Z.current_index=0:u<Z.current_index?Z.current_index=Math.max(0,Z.current_index-1):u===Z.current_index&&(Z.current_index=Math.min(Z.current_index,q.length-1)),Z.total=q.length,Z}),M.success("已删除")}catch(Z){Z!=="cancel"&&se(Z,"删除失败")}finally{d.value=!1}},p=async u=>{const F=C.value;!F||u<0||u>=F.playlist.length||(i.value={type:"files",index:u},A.value="files",v.value=!0)},_=async u=>{const F=C.value,x=z();!F||!x||u<=0||u>=x.length||await O(async()=>{await Q(H=>{const Z=k();w(H);const q=[...H.pre_lists[Z]||[]];return[q[u-1],q[u]]=[q[u],q[u-1]],H.pre_lists[Z]=q,H})},"上移失败")},D=async u=>{const F=C.value,x=z();!F||!x||u<0||u>=x.length-1||await O(async()=>{await Q(H=>{const Z=k();w(H);const q=[...H.pre_lists[Z]||[]];return[q[u],q[u+1]]=[q[u+1],q[u]],H.pre_lists[Z]=q,H})},"下移失败")},ee=async u=>{const F=C.value,x=z();if(!F||!x||u<0||u>=x.length)return;const Z=x[u]?.uri?.split("/").pop()||"文件";try{await Be.confirm(`确定要删除 "${Z}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await O(async()=>{await Q(q=>{const ie=k();w(q);const pe=[...q.pre_lists[ie]||[]];return pe.splice(u,1),q.pre_lists[ie]=pe,q}),M.success("已删除")},"删除失败")}catch(q){T(q,"删除失败")}},ye=async u=>{const F=C.value,x=z();!F||!x||u<0||u>=x.length||(i.value={type:"pre_files",index:u},A.value="pre_files",v.value=!0)},y=()=>{c.value=!c.value,c.value||(o.value=[])},U=()=>{h.value=!h.value,h.value||(S.value=[])},P=u=>{const F=o.value,x=F.indexOf(u);x>-1?F.splice(x,1):F.push(u)},J=u=>{const F=S.value,x=F.indexOf(u);x>-1?F.splice(x,1):F.push(u)},Y=async()=>{const u=C.value,F=z(),x=o.value;if(!u||!F||x.length===0)return;const H=x.length;try{await Be.confirm(`确定要删除选中的 ${H} 个前置文件吗？`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await O(async()=>{const Z=[...new Set(x)].sort((q,ie)=>ie-q);await Q(q=>{const ie=k();w(q);const pe=[...q.pre_lists[ie]||[]];return Z.forEach(De=>{De>=0&&De<pe.length&&pe.splice(De,1)}),q.pre_lists[ie]=pe,q}),o.value=[],c.value=!1,M.success(`已删除 ${H} 个前置文件`)},"批量删除失败")}catch(Z){T(Z,"批量删除失败")}},ue=async()=>{const u=C.value,F=S.value;if(!u||!u.playlist||F.length===0)return;const x=F.length;try{await Be.confirm(`确定要删除选中的 ${x} 个正式文件吗？`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await O(async()=>{const H=[...new Set(F)].sort((Z,q)=>q-Z);await Q(Z=>{const q=[...Z.playlist];if(H.forEach(ie=>{ie>=0&&ie<q.length&&q.splice(ie,1)}),Z.playlist=q,q.length===0)Z.current_index=0;else{let ie=Z.current_index;H.forEach(pe=>{pe<Z.current_index?ie=Math.max(0,ie-1):pe===Z.current_index&&(ie=Math.min(ie,q.length-1))}),Z.current_index=ie}return Z.total=q.length,Z}),S.value=[],h.value=!1,M.success(`已删除 ${x} 个正式文件`)},"批量删除失败")}catch(H){T(H,"批量删除失败")}},fe=async()=>{const u=C.value,F=z();if(!(!u||!F||F.length===0))try{await Be.confirm(`确定要清空前置文件列表吗？此操作将删除所有 ${F.length} 个前置文件。`,"确认清空",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await O(async()=>{await Q(x=>{const H=k();return w(x),x.pre_lists[H]=[],x}),M.success("已清空前置文件列表")},"清空失败")}catch(x){T(x,"清空失败")}},ge=async()=>{const u=C.value;if(!(!u||!u.playlist||u.playlist.length===0))try{await Be.confirm(`确定要清空正式文件列表吗？此操作将删除所有 ${u.playlist.length} 个正式文件。`,"确认清空",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await O(async()=>{await Q(F=>(F.playlist=[],F.total=0,F.current_index=0,F)),M.success("已清空正式文件列表")},"清空失败")}catch(F){T(F,"清空失败")}},Ee=async()=>{const u=C.value;if(!u)return;const F=z(),x=F&&F.length||0,H=u.playlist&&u.playlist.length||0,Z=x+H;if(Z!==0)try{const q=x>0&&H>0?`确定要清空播放列表 "${u.name}" 吗？此操作将删除所有 ${x} 个前置文件和 ${H} 个正式文件，共 ${Z} 个文件。`:x>0?`确定要清空播放列表 "${u.name}" 吗？此操作将删除所有 ${x} 个前置文件。`:`确定要清空播放列表 "${u.name}" 吗？此操作将删除所有 ${H} 个正式文件。`;await Be.confirm(q,"确认清空",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await O(async()=>{await Q(ie=>(ie.playlist=[],w(ie),ie.pre_lists=ie.pre_lists.map(()=>[]),ie.total=0,ie.current_index=0,ie)),M.success("已清空播放列表（包括前置文件和正式文件）")},"清空失败")}catch(q){T(q,"清空失败")}},Fe=u=>typeof u=="string"?{uri:u}:{...u,uri:u.uri||""};return{handleOpenFileBrowser:L,handleOpenFileBrowserForPreFiles:te,handleFileBrowserConfirm:j,handleCloseFileBrowser:re,handleMovePlaylistItemUp:N,handleMovePlaylistItemDown:b,handleDeletePlaylistItem:$,handleReplacePlaylistItem:p,handleMovePreFileUp:_,handleMovePreFileDown:D,handleDeletePreFile:ee,handleReplacePreFile:ye,handleTogglePreFilesBatchDeleteMode:y,handleToggleFilesBatchDeleteMode:U,handleTogglePreFileSelection:P,handleToggleFileSelection:J,handleBatchDeletePreFiles:Y,handleBatchDeleteFiles:ue,handleClearPreFiles:fe,handleClearFiles:ge,handleClearPlaylist:Ee,handleOpenPlaylistSelectorForPreFile:async u=>{try{if(!u){M.warning("文件信息无效");return}if(t&&f){const F=Fe(u);t.value=[F],f.value=!0}else M.info("请使用文件浏览器添加文件到播放列表")}catch(F){Xe.error("打开播放列表选择器失败:",F),M.error("打开对话框失败")}},handleOpenPlaylistSelectorForFile:async u=>{try{if(!u){M.warning("文件信息无效");return}const F=Fe(u);if(!F.uri){M.warning("文件URI无效");return}t&&f?(t.value=[F],f.value=!0):M.info("请使用文件浏览器添加文件到播放列表")}catch(F){Xe.error("打开播放列表选择器失败:",F),M.error("打开对话框失败")}}}}function Xo(e,C,d,v,A,i,s,c,h,o,S,Q,z){const f=()=>o.value!==null?o.value:Ye(),t=(b,$)=>{if(!b||!$||b.length!==$.length)return!0;for(let p=0;p<b.length;p++){const _=b[p]?.uri||b[p],D=$[p]?.uri||$[p];if(_!==D)return!0}return!1};return{handleTogglePreFilesDragMode:async()=>{if(v.value){const b=C.value,$=z();if(b&&$&&$.length>0){if(t(c.value||[],$))try{d.value=!0,await S(_=>{const D=f();return(!_.pre_lists||!Array.isArray(_.pre_lists)||_.pre_lists.length!==7)&&(_.pre_lists=Array(7).fill(null).map(()=>[])),_.pre_lists[D]=[...$],_.pre_index=b.pre_index,_}),M.success("排序已保存")}catch(_){se(_,"保存排序失败")}finally{d.value=!1}c.value=null}}else{const b=C.value,$=z();b&&$&&$.length>0&&(c.value=[...$]),i.value=null}v.value=!v.value},handleToggleFilesDragMode:async()=>{if(A.value){const b=C.value;if(b&&b.playlist&&b.playlist.length>0){if(t(h.value||[],b.playlist))try{d.value=!0,await S(p=>(p.playlist=[...b.playlist||[]],p.current_index=b.current_index,p.total=b.playlist.length,p)),M.success("排序已保存")}catch(p){se(p,"保存排序失败")}finally{d.value=!1}h.value=null}}else{const b=C.value;b&&b.playlist&&b.playlist.length>0&&(h.value=[...b.playlist||[]]),s.value=null}A.value=!A.value},handlePreFileDragStart:(b,$)=>{if(!v.value){b.preventDefault();return}try{b.dataTransfer.effectAllowed="move",b.dataTransfer.setData("text/plain",$.toString())}catch(p){console.error("拖拽开始失败:",p)}},handlePreFileDragEnd:b=>{const $=b.currentTarget;$&&$.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")},handlePreFileDragOver:b=>{if(!v.value)return;b.preventDefault(),b.dataTransfer.dropEffect="move";const $=b.currentTarget;if($){const p=$.getBoundingClientRect(),_=b.clientY,D=p.top+p.height/2;$.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500"),_<D?$.classList.add("border-t-2","border-blue-500"):$.classList.add("border-b-2","border-blue-500")}},handlePreFileDrop:(b,$)=>{if(!v.value)return;b.preventDefault();const p=b.currentTarget;p&&p.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500");const _=parseInt(b.dataTransfer.getData("text/plain"),10);if(_===$||isNaN(_))return;const D=C.value,ee=z();if(!D||!ee||_<0||_>=ee.length||$<0||$>=ee.length)return;const ye=f(),y=[...ee],[U]=y.splice(_,1);y.splice($,0,U);let P=D.pre_index;D.pre_index!==void 0&&D.pre_index!==null&&D.pre_index>=0&&(D.pre_index===_?P=$:_<D.pre_index&&$>=D.pre_index?P=D.pre_index-1:_>D.pre_index&&$<=D.pre_index&&(P=D.pre_index+1));const J=e.value.map(Y=>Y.id===D.id?((!Y.pre_lists||!Array.isArray(Y.pre_lists)||Y.pre_lists.length!==7)&&(Y.pre_lists=Array(7).fill(null).map(()=>[])),{...Y,pre_lists:Y.pre_lists.map((ue,fe)=>fe===ye?y:ue),pre_index:P}):Y);e.value=J,Q(J)},handleFileDragStart:(b,$)=>{if(!A.value){b.preventDefault();return}try{b.dataTransfer.effectAllowed="move",b.dataTransfer.setData("text/plain",$.toString())}catch(p){console.error("拖拽开始失败:",p)}},handleFileDragEnd:b=>{const $=b.currentTarget;$&&$.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")},handleFileDragOver:b=>{if(!A.value)return;b.preventDefault(),b.dataTransfer.dropEffect="move";const $=b.currentTarget;if($){const p=$.getBoundingClientRect(),_=b.clientY,D=p.top+p.height/2;$.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500"),_<D?$.classList.add("border-t-2","border-blue-500"):$.classList.add("border-b-2","border-blue-500")}},handleFileDrop:(b,$)=>{if(!A.value)return;b.preventDefault();const p=b.currentTarget;p&&p.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500");const _=parseInt(b.dataTransfer.getData("text/plain"),10);if(_===$||isNaN(_))return;const D=C.value;if(!D||!D.playlist||_<0||_>=D.playlist.length||$<0||$>=D.playlist.length)return;const ee=[...D.playlist||[]],[ye]=ee.splice(_,1);ee.splice($,0,ye);let y=D.current_index;D.current_index!==void 0&&D.current_index!==null&&D.current_index>=0&&(D.current_index===_?y=$:_<D.current_index&&$>=D.current_index?y=D.current_index-1:_>D.current_index&&$<=D.current_index&&(y=D.current_index+1));const U=e.value.map(P=>P.id===D.id?{...P,playlist:ee,current_index:y,total:ee.length}:P);e.value=U,Q(U)}}}function Zo(e,C,d,v,A,i){const s=I(!1),c=I(null),h=I("");return{editNameDialogVisible:s,editNameDialogName:h,handleStartEditPlaylistName:z=>{const f=e.value.find(t=>t.id===z);f&&(c.value=z,h.value=f.name,s.value=!0)},handleSavePlaylistName:async()=>{if(!c.value)return;const z=h.value?.trim();if(!z||z.length===0){M.warning("播放列表名称不能为空");return}const f=c.value,t=e.value.find(k=>k.id===f);if(!t||t.name===z){s.value=!1,c.value=null,h.value="";return}try{const k=e.value.map(w=>w.id===f?{...w,name:z}:w);e.value=k,f===C.value&&i(k),await A(k),s.value=!1,c.value=null,h.value="",M.success("播放列表名称已更新")}catch(k){se(k,"更新播放列表名称失败")}},handleCancelEditPlaylistName:()=>{s.value=!1,c.value=null,h.value=""}}}const er={class:"p-1"},tr={class:"flex gap-4 h-[calc(100vh-150px)]"},cr=Ne({__name:"index",setup(e){const{playlistCollection:C,activePlaylistId:d,playlistStatus:v,playlistLoading:A,playlistRefreshing:i,playing:s,stopping:c,showMoreActions:h,editingPlaylistId:o,editingPlaylistName:S,fileBrowserDialogVisible:Q,fileBrowserTarget:z,replaceFileInfo:f,selectedWeekdayIndex:t,preFilesDragMode:k,filesDragMode:w,preFilesBatchDeleteMode:le,filesBatchDeleteMode:T,selectedPreFileIndices:O,selectedFileIndices:L,preFilesExpanded:te,playlistSelectorVisible:j,playlistSelectorSelectedFiles:re,batchDrawerVisible:N,cronBuilderVisible:b,cronPreviewVisible:$,cronPreviewTimes:p,initialCronExpr:_,agentListDialogVisible:D,scanDialogVisible:ee,loading:ye,deviceList:y,connectedDeviceList:U,dlnaDeviceList:P,dlnaScanning:J,miDeviceList:Y,miScanning:ue,pendingDeviceType:fe,preFilesSortOrder:ge,filesSortOrder:Ee,preFilesOriginalOrder:Fe,filesOriginalOrder:V}=Yo(),{audioPlayer:E,handlePlayFileInBrowser:u,handleSeekFile:F}=Qo(),x=()=>t.value!==null?t.value:Ye(),H=()=>{const ve=v.value;if(!ve||!ve.pre_lists)return[];const ne=x();return!Array.isArray(ve.pre_lists)||ve.pre_lists.length!==7?[]:ve.pre_lists[ne]||[]},{savePlaylist:Z,syncActivePlaylist:q,updateActivePlaylistData:ie,loadPlaylist:pe,refreshPlaylistStatus:De}=Ho(C,d,v,i,fe,k,w),Oe=async ve=>{await ie(ve)},{handleOpenFileBrowser:G,handleOpenFileBrowserForPreFiles:g,handleFileBrowserConfirm:R,handleCloseFileBrowser:K,handleMovePlaylistItemUp:de,handleMovePlaylistItemDown:Ue,handleDeletePlaylistItem:Je,handleReplacePlaylistItem:he,handleMovePreFileUp:_e,handleMovePreFileDown:Qe,handleDeletePreFile:jt,handleReplacePreFile:Gt,handleTogglePreFilesBatchDeleteMode:Yt,handleToggleFilesBatchDeleteMode:Ht,handleTogglePreFileSelection:Kt,handleToggleFileSelection:It,handleBatchDeletePreFiles:Jt,handleBatchDeleteFiles:Qt,handleClearPreFiles:qt,handleClearFiles:Xt,handleClearPlaylist:Zt,handleOpenPlaylistSelectorForPreFile:el,handleOpenPlaylistSelectorForFile:tl}=qo(C,v,A,Q,z,f,t,le,T,O,L,Oe,H,j,re),{handleTogglePreFilesDragMode:ll,handleToggleFilesDragMode:sl,handlePreFileDragStart:nl,handlePreFileDragEnd:al,handlePreFileDragOver:il,handlePreFileDrop:ol,handleFileDragStart:rl,handleFileDragEnd:dl,handleFileDragOver:ul,handleFileDrop:cl}=Xo(C,v,A,k,w,ge,Ee,Fe,V,t,Oe,q,H),{editNameDialogVisible:ut,editNameDialogName:ct,handleStartEditPlaylistName:fl,handleSavePlaylistName:ft,handleCancelEditPlaylistName:et}=Zo(C,d,o,S,Z,q),{handleOpenCronBuilder:vl,handleCloseCronBuilder:ml,handleCronBuilderApply:gl,handleCronBuilderPreview:pl,handleTogglePlaylistCronEnabled:yl,handleUpdatePlaylistCron:hl,handleUpdatePlaylistDuration:bl,handleUpdateTriggerButton:xl,handlePreviewPlaylistCron:wl}=Io(v,b,$,p,_,ie),{refreshConnectedList:Dt,handleConnectDevice:Dl,scanDlnaDevices:$l,scanMiDevices:Cl,handleUpdateDeviceList:Fl,handleOpenScanDialog:kl,handleCloseScanDialog:_l,handleUpdatePlaylistDeviceType:Pl,handleUpdatePlaylistDeviceAddress:Sl,handleSelectBluetoothDevice:Bl,handleSelectAgentDevice:Al,handleSelectMiDevice:Tl,handleOpenAgentListDialog:Ml}=Jo(v,fe,U,P,Y,y,ye,J,ue,ee,D,ie),{handleSelectPlaylist:El,handleCreatePlaylist:Ll,handleCopyPlaylist:Nl,handleDeletePlaylistGroup:Ul,handlePlayPlaylist:Vl,handlePlayNext:zl,handlePlayPre:Ol,handleStopPlaylist:Rl}=Ko(C,d,v,s,c,q,ie,De,H),Wl=async ve=>{await El(ve),fe.value=null,ge.value=null,Ee.value=null,k.value=!1,w.value=!1,Fe.value=null,V.value=null,le.value=!1,T.value=!1,O.value=[],L.value=[],await Dt()},jl=async(ve,ne)=>{ve==="delete"?await Ul(ne):ve==="copy"&&await Nl(ne)},Gl=async ve=>{try{if(A.value=!0,!C.value.find(xe=>xe.id===ve.playlistId)){M.warning("播放列表不存在");return}await ie(xe=>{if(xe.id!==ve.playlistId)return xe;if(ve.preLists.length>0&&((!xe.pre_lists||!Array.isArray(xe.pre_lists)||xe.pre_lists.length!==7)&&(xe.pre_lists=Array(7).fill(null).map(()=>[])),ve.preLists.forEach(me=>{if(me>=0&&me<7){const ke=new Set((xe.pre_lists[me]||[]).map(Me=>typeof Me=="string"?Me:Me?.uri||""));ve.files.forEach(Me=>{ke.has(Me)||(xe.pre_lists[me]||(xe.pre_lists[me]=[]),xe.pre_lists[me].push({uri:Me}))})}})),ve.filesList){Array.isArray(xe.playlist)||(xe.playlist=[]);const me=new Set(xe.playlist.map(ke=>typeof ke=="string"?ke:ke?.uri||""));ve.files.forEach(ke=>{me.has(ke)||xe.playlist.push({uri:ke})}),xe.total=xe.playlist.length}return xe}),q(C.value),await Z(C.value)}catch(ne){se(ne,"批量添加文件失败")}finally{A.value=!1}},Yl=async ve=>{try{if(A.value=!0,!C.value.find(me=>me.id===ve.playlistId)){M.warning("播放列表不存在");return}const xe=new Set(ve.files);await ie(me=>(me.id!==ve.playlistId||(ve.preLists.length>0&&me.pre_lists&&Array.isArray(me.pre_lists)&&me.pre_lists.length===7&&ve.preLists.forEach(ke=>{ke>=0&&ke<7&&me.pre_lists[ke]&&(me.pre_lists[ke]=me.pre_lists[ke].filter(Me=>{const mt=typeof Me=="string"?Me:Me?.uri||"";return!xe.has(mt)}))}),ve.filesList&&Array.isArray(me.playlist)&&(me.playlist=me.playlist.filter(ke=>{const Me=typeof ke=="string"?ke:ke?.uri||"";return!xe.has(Me)}),me.total=me.playlist.length,me.playlist.length===0?me.current_index=0:me.current_index>=me.playlist.length&&(me.current_index=me.playlist.length-1))),me)),q(C.value),await Z(C.value)}catch(ne){se(ne,"批量删除文件失败")}finally{A.value=!1}},Hl=async()=>{await Ml()},Kl=ve=>{t.value=ve,q(C.value)},vt=I(!0),{start:$t,stop:Ct}=ns(async()=>{await De(!0,!0)},Jn,{immediate:!1,autoCleanup:!0}),Il=ve=>{vt.value=ve,ve?$t():Ct()};return rt(async()=>{await pe(),await Dt(),vt.value&&$t()}),Mt(()=>{Ct()}),(ve,ne)=>{const xe=Vt,me=Ut,ke=ht,Me=Ve,mt=Ze;return m(),B("div",er,[n("div",tr,[l(en,{"playlist-collection":r(C),"active-playlist-id":r(d),refreshing:r(i),"auto-refresh-enabled":vt.value,onSelect:Wl,onCreate:r(Ll),onRefresh:r(De),onToggleAutoRefresh:Il,onMenuCommand:jl},null,8,["playlist-collection","active-playlist-id","refreshing","auto-refresh-enabled","onCreate","onRefresh"]),l(Hn,{"playlist-status":r(v),"active-playlist-id":r(d),"editing-playlist-id":r(o),"editing-playlist-name":r(S),"onUpdate:editingPlaylistName":ne[0]||(ne[0]=we=>tt(S)?S.value=we:null),"selected-weekday-index":r(t),"pre-files-drag-mode":r(k),"pre-files-batch-delete-mode":r(le),"selected-pre-file-indices":r(O),"pre-files-expanded":r(te),"files-drag-mode":r(w),"files-batch-delete-mode":r(T),"selected-file-indices":r(L),"playlist-loading":r(A),playing:r(s),stopping:r(c),"show-more-actions":r(h),"audio-player":r(E),onStartEditName:r(fl),onSaveName:r(ft),onCancelEditName:r(et),onOpenBatchDrawer:ne[1]||(ne[1]=we=>N.value=!0),onPlay:r(Vl),onPlayPre:r(Ol),onPlayNext:r(zl),onStop:r(Rl),onClear:r(Zt),onToggleMoreActions:ne[2]||(ne[2]=we=>h.value=!r(h)),onSelectWeekday:Kl,onOpenFileBrowserForPreFiles:r(g),onTogglePreFilesDragMode:r(ll),onTogglePreFilesBatchDeleteMode:r(Yt),onBatchDeletePreFiles:r(Jt),onClearPreFiles:r(qt),onTogglePreFilesExpand:ne[3]||(ne[3]=we=>te.value=!r(te)),onTogglePreFileSelection:r(Kt),onPreFileDragStart:r(nl),onPreFileDragEnd:r(al),onPreFileDragOver:r(il),onPreFileDrop:r(ol),onOpenFileBrowser:r(G),onToggleFilesDragMode:r(sl),onToggleFilesBatchDeleteMode:r(Ht),onBatchDeleteFiles:r(Qt),onClearFiles:r(Xt),onToggleFileSelection:r(It),onFileDragStart:r(rl),onFileDragEnd:r(dl),onFileDragOver:r(ul),onFileDrop:r(cl),onPlayFile:r(u),onSeekFile:r(F),onMovePreFileUp:r(_e),onMovePreFileDown:r(Qe),onReplacePreFile:r(Gt),onOpenPlaylistSelectorForPreFile:r(el),onDeletePreFile:r(jt),onMoveFileUp:r(de),onMoveFileDown:r(Ue),onReplaceFile:r(he),onOpenPlaylistSelectorForFile:r(tl),onDeleteFile:r(Je)},null,8,["playlist-status","active-playlist-id","editing-playlist-id","editing-playlist-name","selected-weekday-index","pre-files-drag-mode","pre-files-batch-delete-mode","selected-pre-file-indices","pre-files-expanded","files-drag-mode","files-batch-delete-mode","selected-file-indices","playlist-loading","playing","stopping","show-more-actions","audio-player","onStartEditName","onSaveName","onCancelEditName","onPlay","onPlayPre","onPlayNext","onStop","onClear","onOpenFileBrowserForPreFiles","onTogglePreFilesDragMode","onTogglePreFilesBatchDeleteMode","onBatchDeletePreFiles","onClearPreFiles","onTogglePreFileSelection","onPreFileDragStart","onPreFileDragEnd","onPreFileDragOver","onPreFileDrop","onOpenFileBrowser","onToggleFilesDragMode","onToggleFilesBatchDeleteMode","onBatchDeleteFiles","onClearFiles","onToggleFileSelection","onFileDragStart","onFileDragEnd","onFileDragOver","onFileDrop","onPlayFile","onSeekFile","onMovePreFileUp","onMovePreFileDown","onReplacePreFile","onOpenPlaylistSelectorForPreFile","onDeletePreFile","onMoveFileUp","onMoveFileDown","onReplaceFile","onOpenPlaylistSelectorForFile","onDeleteFile"]),l(Oa,{"playlist-status":r(v),"connected-device-list":r(U),"dlna-device-list":r(P),"mi-device-list":r(Y),loading:r(ye),"dlna-scanning":r(J),"mi-scanning":r(ue),"on-toggle-cron-enabled":r(yl),"on-update-cron":r(hl),"on-update-duration":r(bl),"on-update-trigger-button":r(xl),"on-open-cron-builder":r(vl),"on-preview-cron":r(wl),"on-update-device-type":r(Pl),"on-update-device-address":r(Sl),"on-select-bluetooth-device":r(Bl),"on-select-agent-device":r(Al),"on-select-mi-device":r(Tl),"on-scan-dlna-devices":r($l),"on-scan-mi-devices":r(Cl),"on-open-scan-dialog":r(kl),"on-open-device-list":Hl},null,8,["playlist-status","connected-device-list","dlna-device-list","mi-device-list","loading","dlna-scanning","mi-scanning","on-toggle-cron-enabled","on-update-cron","on-update-duration","on-update-trigger-button","on-open-cron-builder","on-preview-cron","on-update-device-type","on-update-device-address","on-select-bluetooth-device","on-select-agent-device","on-select-mi-device","on-scan-dlna-devices","on-scan-mi-devices","on-open-scan-dialog"])]),l(Lt,{visible:r(Q),"onUpdate:visible":ne[5]||(ne[5]=we=>Q.value=we),title:"选择文件添加到播放列表","confirm-button-text":"添加","confirm-loading":r(A),onConfirm:r(R),onClose:r(K)},{"footer-prepend":a(()=>[l(me,{modelValue:r(z),"onUpdate:modelValue":ne[4]||(ne[4]=we=>tt(z)?z.value=we:null),size:"small",class:"w-[150px]"},{default:a(()=>[l(xe,{label:"添加到主列表",value:"files"}),l(xe,{label:"添加到前置列表",value:"pre_files"})]),_:1},8,["modelValue"])]),_:1},8,["visible","confirm-loading","onConfirm","onClose"]),l(Ms,{visible:r(b),"initial-cron":r(_),"onUpdate:visible":ne[6]||(ne[6]=we=>b.value=we),onApply:r(gl),onPreview:r(pl),onClose:r(ml)},null,8,["visible","initial-cron","onApply","onPreview","onClose"]),l(Us,{visible:r($),times:r(p),"onUpdate:visible":ne[7]||(ne[7]=we=>$.value=we),onClose:ne[8]||(ne[8]=we=>$.value=!1)},null,8,["visible","times"]),l(ja,{visible:r(ee),"device-list":r(y),loading:r(ye),"onUpdate:visible":ne[9]||(ne[9]=we=>ee.value=we),onRefresh:r(Fl),onConnect:r(Dl),onClose:r(_l)},null,8,["visible","device-list","loading","onRefresh","onConnect","onClose"]),l(Pi,{visible:r(D),"onUpdate:visible":ne[10]||(ne[10]=we=>D.value=we)},null,8,["visible"]),l(lo,{visible:r(j),"playlist-collection":r(C),"selected-files":r(re),"onUpdate:visible":ne[11]||(ne[11]=we=>j.value=we)},null,8,["visible","playlist-collection","selected-files"]),l(mt,{modelValue:r(ut),"onUpdate:modelValue":ne[13]||(ne[13]=we=>tt(ut)?ut.value=we:null),title:"编辑播放列表名称",width:"400",onClose:r(et)},{footer:a(()=>[l(Me,{onClick:r(et)},{default:a(()=>[...ne[15]||(ne[15]=[X("取消",-1)])]),_:1},8,["onClick"]),l(Me,{type:"primary",onClick:r(ft)},{default:a(()=>[...ne[16]||(ne[16]=[X("确定",-1)])]),_:1},8,["onClick"])]),default:a(()=>[l(ke,{modelValue:r(ct),"onUpdate:modelValue":ne[12]||(ne[12]=we=>tt(ct)?ct.value=we:null),placeholder:"请输入播放列表名称",onKeyup:[Ft(r(ft),["enter"]),Ft(r(et),["esc"])],clearable:"",autofocus:""},null,8,["modelValue","onKeyup"])]),_:1},8,["modelValue","onClose"]),l(Go,{visible:r(N),"playlist-collection":r(C),"onUpdate:visible":ne[14]||(ne[14]=we=>N.value=we),onRefresh:r(De),"on-add-files":Gl,"on-remove-files":Yl},null,8,["visible","playlist-collection","onRefresh"])])}}});export{cr as default};
