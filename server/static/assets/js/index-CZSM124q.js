import{j as He,r as x,t as Xe,L as Ut,n as p,o as i,s as t,Q as s,G as n,$ as w,D as E,E as Ie,J as k,M as Et,l as A,u as z,aa as qe,ai as Lt,c as J,y as it,q as W,F as Me,a6 as Ke,I as ge}from"./vue-vendor-C-hNZ0TW.js";import{c as Ze,L as At,F as bt,q as Bt,A as zt,D as jt,y as et,u as ut,B as Ot,a1 as tt,f as lt,E as u,ak as we,M as dt,i as Nt,a9 as ct,al as ft,a8 as kt,ab as It,K as wt,am as Tt,ae as Kt,an as Yt,a0 as Gt,X as qt,C as Ct,ao as $t,ap as St,aq as Ht,t as Wt,r as Jt,Y as Qt,aj as Xt,ai as Zt}from"./element-plus-M7zOPo2E.js";import{m as Pt,a as V,k as nt,e as el}from"./utils-shared-DVqbzSND.js";import{D as tl,E as ll,F as sl,G as al,H as nl,I as ol,J as rl,K as il,M as ul,N as dl,O as cl,P as fl,Q as vl,R as pl,S as ml,T as gl,U as _l,V as xl,W as We,X as yl,Y as hl,Z as bl,_ as kl,$ as wl,a0 as _t,a1 as xt,a2 as Tl,a3 as Cl,a4 as yt,a5 as $l,a6 as Sl}from"./api-shared-Cph26xYJ.js";import{u as Dt,b as vt,M as ot,_ as rt}from"./useInterval-fqKg2tUX.js";import{c as Mt,C as Pl}from"./constants-shared-BwcKRbUv.js";import"./utils-Dtqx8Ray.js";import"./vendor-4xlYshH7.js";import"./types-shared-DZNZ_0yA.js";import"./index-DdN-MCbv.js";import"./vant-7Cqjo8an.js";const Dl={class:"p-4 flex flex-col h-[calc(100vh-200px)]"},Ml={class:"mb-4 flex-shrink-0 border rounded p-3 bg-gray-50"},Vl={class:"flex flex-col gap-3"},Fl={class:"flex items-center gap-3"},Rl={class:"flex-1 min-w-0"},Ul={class:"flex items-center gap-2"},El=["title"],Ll={key:0,class:"text-xs text-gray-500 flex-shrink-0"},Al={class:"flex items-center gap-2"},Bl={class:"flex items-center justify-between"},zl={class:"flex-1 overflow-auto"},jl=["onClick","title"],Ol={key:1,class:"text-gray-400"},Nl={key:0,class:"flex flex-col gap-1"},Il={class:"text-sm"},Kl={class:"text-xs text-gray-500"},Yl={key:1,class:"text-gray-400"},Gl={key:0,class:"flex flex-col gap-1"},ql={class:"text-sm"},Hl={class:"text-xs text-gray-500"},Wl={key:1,class:"text-gray-400"},Jl={class:"flex flex-col gap-1 items-center"},Ql=["onClick"],Xl=["title"],Zl={class:"flex items-center gap-2"},es=He({__name:"PdfTool",setup(Ye){const d=x(!1),C=x([]),e=x(null),K=x(""),D=x(0),S=x(""),j=x(null),M=x(null);let F=null;const B=async()=>{try{d.value=!0;const v=await tl();if(v.code===0){const m=v.data||[];C.value=m.map(T=>({...T,_decrypting:T.status==="processing"||!1,_password:""}))}else u.error(v.msg||"获取任务列表失败")}catch(v){V(v,"获取任务列表失败")}finally{d.value=!1}},Q=v=>{v.raw&&(e.value=v.raw,K.value=v.raw.name,D.value=0,S.value="",j.value&&se())},ee=v=>{if(v<60)return`${v}秒`;if(v<3600){const m=Math.floor(v/60),T=v%60;return`${m}分${T}秒`}else{const m=Math.floor(v/3600),T=Math.floor(v%3600/60),q=v%60;return`${m}小时${T}分${q}秒`}},X=()=>{if(M.value!==null&&D.value>0&&D.value<100){const v=Math.floor((Date.now()-M.value)/1e3);S.value=ee(v)}},se=()=>{j.value&&d.value?(j.value.abort(),j.value=null,F&&(clearInterval(F),F=null),D.value=0,S.value="",M.value=null,d.value=!1,u.info("上传已取消")):(e.value=null,K.value="",D.value=0,S.value="",M.value=null,u.info("已清除选中文件"))},ne=async()=>{if(!e.value){u.warning("请选择要上传的文件");return}const v=e.value;if(!v.name.toLowerCase().endsWith(".pdf")){u.error("只支持 PDF 文件");return}j.value&&se();try{d.value=!0,D.value=0,S.value="",M.value=Date.now();const m=new AbortController;j.value=m,F=setInterval(()=>{X()},1e3);const T=await ll(v,q=>{D.value=q,X()},m.signal);F&&(clearInterval(F),F=null),j.value=null,T.code===0?(D.value=100,X(),u.success("文件上传成功"),setTimeout(()=>{e.value=null,K.value="",D.value=0,S.value="",M.value=null},500),await B()):(u.error(T.msg||"文件上传失败"),D.value=0,S.value="",M.value=null)}catch(m){if(m.name==="CanceledError"||m.code==="ECONNABORTED"||m.message?.includes("canceled")||m.message?.includes("aborted")){F&&(clearInterval(F),F=null),j.value||(d.value=!1);return}const T=m.message||"文件上传失败",q=D.value;m.code==="ERR_NETWORK"||m.message?.includes("Network Error")?u.error(`网络错误：上传中断。当前进度：${q}%`):m.response?.status===413?(u.error("文件太大，超过服务器限制（最大 1000MB）"),D.value=0,S.value=""):u.error(`上传失败：${T}`),F&&(clearInterval(F),F=null),j.value=null,M.value=null,d.value=!1}},Y=async v=>{if(!v.uploaded_info){u.warning("请先上传文件");return}if(!(v._decrypting||v.status==="processing")&&!(v.status==="success"&&!await we.confirm("已解密的文件已存在，是否重新解密？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{v._decrypting=!0;const m=v._password?.trim()||void 0,T=await sl(v.task_id,m);T.code===0?(u.success(T.data?.message||"解密任务已提交，正在后台处理"),v._password="",await O(v)):u.error(T.msg||"提交解密任务失败")}catch(m){V(m,"提交解密任务失败")}finally{v._decrypting=!1}},O=async(v,m=30)=>{let T=0;const q=async()=>{if(T>=m){u.warning("任务处理超时，请手动刷新查看状态"),await B();return}try{const Z=await ol(v.task_id);if(Z.code===0){const ae=Z.data;v.status=ae.status,v.unlocked_info=ae.unlocked_info,v.error_message=ae.error_message,ae.status==="success"?(u.success("文件解密成功"),v._decrypting=!1,await B()):ae.status==="failed"?(u.error(ae.error_message||"文件解密失败"),v._decrypting=!1):ae.status==="processing"?(T++,setTimeout(q,1e3)):v._decrypting=!1}}catch(Z){V(Z,"查询任务状态失败"),v._decrypting=!1}};q()},L=async(v,m)=>{const T=m==="uploaded"?v.uploaded_info:v.unlocked_info;if(!T){u.warning("文件不存在");return}try{const q=al(T.name,m);window.open(q,"_blank")}catch(q){V(q,"下载文件失败")}},Te=async v=>{if(!v.uploaded_info){u.warning("请先上传文件");return}if(v.status==="processing"){u.warning("任务正在处理中，无法删除");return}if(await we.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{d.value=!0;const T=await nl(v.task_id);T.code===0?(u.success(T.data?.message||"任务删除成功"),await B()):u.error(T.msg||"任务删除失败")}catch(T){V(T,"删除任务失败")}finally{d.value=!1}},oe=Pt,P=v=>v?new Date(v*1e3).toLocaleString():"-";return Xe(()=>{B()}),Ut(()=>{F&&(clearInterval(F),F=null),j.value&&(j.value.abort(),j.value=null)}),(v,m)=>{const T=Ze,q=At,Z=bt,ae=lt,me=jt,te=et,_e=ut,xe=Ot,ye=Bt,le=zt;return i(),p("div",Dl,[m[12]||(m[12]=t("h2",{class:"text-xl font-semibold mb-4"},"PDF 解密工具",-1)),t("div",Ml,[t("div",Vl,[t("div",Fl,[t("div",null,[s(T,{type:"success",size:"small",onClick:ne,loading:d.value,disabled:!e.value},{default:n(()=>[...m[0]||(m[0]=[w(" 上传 ",-1)])]),_:1},8,["loading","disabled"])]),s(q,{"auto-upload":!1,"on-change":Q,"show-file-list":!1,accept:".pdf"},{trigger:n(()=>[s(T,{type:"primary",size:"small",class:"!m-0"},{default:n(()=>[...m[1]||(m[1]=[w("选择文件",-1)])]),_:1})]),_:1}),t("div",Rl,[t("div",Ul,[t("div",{class:Ie(["text-sm truncate flex-1 min-w-0",e.value?"text-gray-600":"text-gray-400"]),title:K.value||e.value?.name},k(K.value||e.value?.name||"未选择文件"),11,El),S.value?(i(),p("div",Ll," 已用时间: "+k(S.value),1)):E("",!0)])])]),t("div",Al,[s(Z,{percentage:D.value,status:D.value===100?"success":void 0,class:"flex-1"},null,8,["percentage","status"]),s(T,{type:"danger",size:"small",plain:"",onClick:se,disabled:!e.value},{default:n(()=>[...m[2]||(m[2]=[w(" 取消 ",-1)])]),_:1},8,["disabled"])])])]),s(ye,{class:"flex-1 flex flex-col overflow-hidden",shadow:"hover"},{header:n(()=>[t("div",Bl,[m[4]||(m[4]=t("span",null,"文件列表",-1)),s(T,{type:"info",size:"small",plain:"",onClick:B,loading:d.value},{default:n(()=>[d.value?E("",!0):(i(),A(ae,{key:0},{default:n(()=>[s(z(tt))]),_:1})),m[3]||(m[3]=w(" 刷新 ",-1))]),_:1},8,["loading"])])]),default:n(()=>[t("div",zl,[Et((i(),A(xe,{data:C.value,stripe:"",class:"w-full"},{empty:n(()=>[...m[11]||(m[11]=[t("div",{class:"text-center text-gray-400 py-8"},"暂无文件，请上传 PDF 文件",-1)])]),default:n(()=>[s(me,{prop:"filename",label:"文件名","min-width":"200"},{default:n(({row:h})=>[h.uploaded_info?(i(),p("span",{key:0,class:"text-blue-600 cursor-pointer hover:underline",onClick:re=>L(h,"uploaded"),title:h.uploaded_info.name},k(h.uploaded_info.name||h.name||h.filename||h.task_id),9,jl)):(i(),p("span",Ol,"-"))]),_:1}),s(me,{label:"上传文件","min-width":"150"},{default:n(({row:h})=>[h.uploaded_info?(i(),p("div",Nl,[t("span",Il,k(z(oe)(h.uploaded_info.size)),1),t("span",Kl,k(P(h.uploaded_info.modified)),1)])):(i(),p("span",Yl,"-"))]),_:1}),s(me,{label:"已解密文件","min-width":"150"},{default:n(({row:h})=>[h.unlocked_info?(i(),p("div",Gl,[t("span",ql,k(z(oe)(h.unlocked_info.size)),1),t("span",Hl,k(P(h.unlocked_info.modified)),1)])):(i(),p("span",Wl,"未解密"))]),_:1}),s(me,{label:"状态",width:"140",align:"center"},{default:n(({row:h})=>[t("div",Jl,[h.status==="success"?(i(),A(te,{key:0,type:"success",size:"small"},{default:n(()=>[...m[5]||(m[5]=[w("已解密",-1)])]),_:1})):h.status==="processing"?(i(),A(te,{key:1,type:"warning",size:"small"},{default:n(()=>[...m[6]||(m[6]=[w("处理中",-1)])]),_:1})):h.status==="pending"?(i(),A(te,{key:2,type:"info",size:"small"},{default:n(()=>[...m[7]||(m[7]=[w("等待中",-1)])]),_:1})):h.status==="failed"?(i(),A(te,{key:3,type:"danger",size:"small"},{default:n(()=>[...m[8]||(m[8]=[w("失败",-1)])]),_:1})):(i(),A(te,{key:4,type:"info",size:"small"},{default:n(()=>[...m[9]||(m[9]=[w("已上传",-1)])]),_:1})),h.unlocked_info?(i(),p("span",{key:5,class:"text-xs text-blue-600 cursor-pointer hover:underline",onClick:re=>L(h,"unlocked")}," 下载 ",8,Ql)):E("",!0),h.error_message?(i(),p("span",{key:6,class:"text-xs text-red-500",title:h.error_message}," 错误 ",8,Xl)):E("",!0)])]),_:1}),s(me,{label:"操作",width:"280",fixed:"right"},{default:n(({row:h})=>[t("div",Zl,[h.uploaded_info?(i(),A(_e,{key:0,modelValue:h._password,"onUpdate:modelValue":re=>h._password=re,type:"password",size:"small",placeholder:"密码（可选）","show-password":"",clearable:"",class:"w-30",disabled:h._decrypting||h.status==="processing",onKeyup:qe(re=>Y(h),["enter"])},null,8,["modelValue","onUpdate:modelValue","disabled","onKeyup"])):E("",!0),h.uploaded_info&&h.status!=="processing"?(i(),A(T,{key:1,type:"primary",size:"small",onClick:re=>Y(h),loading:h._decrypting,disabled:h._decrypting||h.status==="processing"},{default:n(()=>[w(k(h.status==="success"?"重新解密":"解密"),1)]),_:2},1032,["onClick","loading","disabled"])):E("",!0),h.uploaded_info?(i(),A(T,{key:2,type:"danger",size:"small",plain:"",onClick:re=>Te(h),disabled:h.status==="processing"},{default:n(()=>[...m[10]||(m[10]=[w(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])):E("",!0)])]),_:1})]),_:1},8,["data"])),[[le,d.value]])])]),_:1})])}}}),ts={viewBox:"0 0 512 512",width:"1.2em",height:"1.2em"};function ls(Ye,d){return i(),p("svg",ts,[...d[0]||(d[0]=[t("path",{fill:"none",stroke:"currentColor","stroke-linecap":"square","stroke-width":"48",d:"m136 208l120-104l120 104m-240 96l120 104l120-104"},null,-1)])])}const ss=Lt({name:"ion-chevron-expand-sharp",render:ls}),as={class:"flex gap-4 h-[calc(100vh-220px)]"},ns={class:"w-64 border rounded p-3 flex flex-col"},os={class:"flex items-center justify-between mb-3"},rs={class:"flex items-center gap-1"},is={key:0,class:"flex-1 overflow-y-auto space-y-2 pr-1 min-h-[400px]"},us=["onClick"],ds={class:"flex items-center justify-between gap-2"},cs={class:"text-sm font-medium truncate flex-1 min-w-0"},fs={class:"text-xs text-gray-500 whitespace-nowrap flex items-center gap-1 flex-shrink-0"},vs={class:"whitespace-nowrap w-5 flex items-center justify-center"},ps={class:"flex items-center justify-between gap-2 min-h-[20px]"},ms={class:"flex items-center gap-1 flex-shrink-0"},gs={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},_s={key:0,class:"flex-1 border rounded p-3 flex flex-col max-w-2xl"},xs={class:"flex items-center justify-between mb-3 flex-shrink-0"},ys={class:"text-base font-semibold"},hs={class:"text-sm text-gray-500"},bs={class:"flex-1 overflow-auto flex flex-col gap-3"},ks={class:"flex items-center justify-between gap-4 flex-shrink-0"},ws={class:"flex items-center gap-4"},Ts={class:"text-red-500 text-xs truncate max-w-xs inline-block cursor-help"},Cs={class:"flex items-center gap-2"},$s={class:"border rounded p-2 flex-1 flex flex-col overflow-hidden"},Ss={class:"flex items-center justify-between mb-2 flex-shrink-0"},Ps={class:"flex items-center gap-1 pr-1"},Ds={class:"flex-1 overflow-auto"},Ms={key:0},Vs=["draggable","onDragstart","onDrop"],Fs={class:"text-xs text-gray-500 w-8"},Rs=["title"],Us={key:0,class:"text-xs text-gray-500 whitespace-nowrap w-20 text-right"},Es={key:1,class:"w-20"},Ls={key:1,class:"text-sm text-gray-400 text-center py-1"},As={key:1,class:"flex-1 border rounded p-3 flex flex-col max-w-2xl"},Bs=He({__name:"AudioMerge",setup(Ye){const d=x(!1),C=x([]),e=x(null),K=x(!1),D=x(!1),S=x(!1),j=x(null),M=Dt({callbacks:{onPlay:()=>{u.success("开始播放")},onError:()=>{V(new Error("音频播放失败"),"播放失败"),te()},onEnded:()=>{te()}}}),F={size:"small",plain:!0,class:"!w-8 !h-6 !p-0"},B={size:"small",plain:!0,class:"!h-5 !text-xs !px-2"},Q={size:"small",plain:!0,class:"!h-7 !text-xs"},ee=["bg-gray-100","border-t-2","border-b-2","border-blue-500"],X=o=>{o&&o.classList.remove(...ee)},se=o=>{if(!o)return;o.querySelectorAll('[draggable="true"]').forEach(_=>X(_))},ne=async o=>{if(e.value&&o.length!==0)try{d.value=!0;for(const c of o){const _=await rl(e.value.task_id,c);if(_.code!==0){u.error(`添加文件失败: ${_.msg||"未知错误"}`);break}}u.success(`成功添加 ${o.length} 个文件`),await L(e.value.task_id)}catch(c){V(c,"添加文件失败")}finally{d.value=!1}},Y=async()=>{try{d.value=!0;const o=await il();o.code===0?(C.value=o.data.tasks||[],C.value.length>0&&!e.value&&await L(C.value[0].task_id)):u.error(o.msg||"获取任务列表失败")}catch(o){V(o,"获取任务列表失败")}finally{d.value=!1}},O=async()=>{try{d.value=!0;const o=await ul();o.code===0?(u.success("任务创建成功"),await Y(),L(o.data.task_id)):u.error(o.msg||"创建任务失败")}catch(o){V(o,"创建任务失败")}finally{d.value=!1}},L=async o=>{e.value&&e.value.task_id!==o&&le();try{d.value=!0;const c=await dl(o);c.code===0?e.value=c.data:u.error(c.msg||"获取任务信息失败")}catch(c){V(c,"获取任务信息失败")}finally{d.value=!1}},Te=async o=>{if(await we.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{d.value=!0;const _=await pl(o);_.code===0?(u.success("任务删除成功"),await Y(),e.value&&e.value.task_id===o&&(C.value&&C.value.length>0?await L(C.value[0].task_id):e.value=null)):u.error(_.msg||"删除任务失败")}catch(_){V(_,"删除任务失败")}finally{d.value=!1}},oe=()=>{if(!e.value){u.warning("请先创建或选择任务");return}K.value=!0},P=async o=>{if(!(!e.value||!await we.confirm("确定要删除该文件吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{d.value=!0;const _=await ml(e.value.task_id,o);_.code===0?(M.playingFileIndex.value===o?le():M.playingFileIndex.value!==null&&M.playingFileIndex.value>o&&(M.playingFileIndex.value=M.playingFileIndex.value-1),u.success("文件删除成功"),await L(e.value.task_id)):u.error(_.msg||"删除文件失败")}catch(_){V(_,"删除文件失败")}finally{d.value=!1}},v=async()=>{if(!(!e.value||!await we.confirm(`确定要开始合成吗？将合并 ${Ce.value} 个音频文件。`,"确认合成",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{d.value=!0;const c=await cl(e.value.task_id);c.code===0?(u.success("合成任务已启动"),await Y(),await L(e.value.task_id),q()):u.error(c.msg||"启动任务失败")}catch(c){V(c,"启动任务失败")}finally{d.value=!1}},{start:m,stop:T}=vt(async()=>{if(!e.value||e.value.status!=="processing"){T();return}await Y(),await L(e.value.task_id)},Mt,{immediate:!1}),q=()=>{m()},Z=o=>{if(!o)return;const c=gl(o);window.open(c,"_blank")},ae=()=>{e.value?.result_file&&Z(e.value.task_id)},me=o=>{o?.result_file&&Z(o.task_id)},te=()=>{M.clear()},_e=(o,c)=>{if(!o)return;const _=o?.path||o?.name||"";M.seekFile(_,c)},xe=(o,c)=>{e.value?.result_file&&_e({path:e.value.result_file},c)},ye=o=>{if(!e.value||!e.value.files||o<0||o>=e.value.files.length)return;const c=e.value.files[o],_=c.path||c.name||"";if(!_){u.warning("文件路径不存在");return}if(M.playingFilePath.value===_&&M.audio&&!M.audio.paused){te(),u.info("已停止播放");return}const I=nt(_);if(!I){u.error("无法生成媒体文件URL");return}M.load(I,{playingFilePath:_,playingFileIndex:o}),M.play().catch(pe=>{V(pe,"播放失败"),te()})},le=()=>{te()},h=()=>{if(!e.value||!e.value.result_file){u.warning("结果文件不存在");return}const o=e.value.result_file;if(M.playingFilePath.value===o&&M.audio&&!M.audio.paused){te(),u.info("已停止播放");return}const c=nt(o);if(!c){u.error("无法生成媒体文件URL");return}M.load(c,{playingFilePath:o}),M.play().catch(_=>{V(_,"播放失败"),te()})},re=()=>{if(!e.value||!e.value.result_file){u.warning("结果文件不存在");return}D.value=!0},Ve=async o=>{if(!e.value||!e.value.result_file)return;if(o.length===0){u.warning("请选择转存目录");return}const c=o[0];try{d.value=!0;const _=await fl(e.value.task_id,c);_.code===0?(u.success("转存成功"),D.value=!1):u.error(_.msg||"转存失败")}catch(_){V(_,"转存失败")}finally{d.value=!1}},Fe=Pt,Ne={pending:{tag:"info",text:"等待中"},processing:{tag:"warning",text:"处理中"},success:{tag:"success",text:"成功"},failed:{tag:"danger",text:"失败"}},ie=o=>Ne[o]?.tag||"info",he=o=>Ne[o]?.text||"未知",$e=J(()=>e.value?.status==="processing"),ue=J(()=>(e.value?.files||[]).length>0),Ce=J(()=>(e.value?.files||[]).length),be=J(()=>e.value?.result_file),Re=J(()=>!be.value||e.value?.status!=="success"||S.value),f=J(()=>!ue.value||$e.value||S.value),r=J(()=>$e.value||S.value),R=J(()=>!e.value||!ue.value||$e.value),N=J(()=>S.value?"点击退出拖拽排序模式":"点击进入拖拽排序模式"),de=J(()=>({path:be.value||""})),Se=(o,c)=>!o||!c||o.length!==c.length?!0:o.some((_,I)=>{const pe=_?.path||_?.name,ze=c[I]?.path||c[I]?.name;return pe!==ze}),Ue=async()=>{if(S.value){if(e.value&&e.value.files&&e.value.files.length>0){if(Se(j.value||[],e.value.files))try{d.value=!0;const c=e.value.files.map((I,pe)=>pe),_=await vl(e.value.task_id,c);_.code===0?(u.success("排序已保存"),await L(e.value.task_id)):u.error(_.msg||"保存排序失败")}catch(c){V(c,"保存排序失败")}finally{d.value=!1}j.value=null}}else e.value&&e.value.files&&e.value.files.length>0&&(j.value=[...e.value.files||[]]);S.value=!S.value},Ee=(o,c)=>{if(!S.value)return o.preventDefault(),!1;try{o.dataTransfer&&(o.dataTransfer.effectAllowed="move",o.dataTransfer.setData("text/plain",c.toString()))}catch(_){console.error("拖拽开始失败:",_)}},Ge=o=>{o.currentTarget&&X(o.currentTarget)},Le=o=>{o.currentTarget&&X(o.currentTarget)},Ae=o=>{if(S.value&&(o.preventDefault(),o.dataTransfer&&(o.dataTransfer.dropEffect="move"),o.currentTarget)){const c=o.currentTarget.getBoundingClientRect(),_=o.clientY,I=c.top+c.height/2;X(o.currentTarget),_<I?o.currentTarget.classList.add("border-t-2","border-blue-500"):o.currentTarget.classList.add("border-b-2","border-blue-500")}},Be=(o,c)=>{if(!S.value||(o.preventDefault(),o.currentTarget&&(X(o.currentTarget),se(o.currentTarget.parentElement)),!o.dataTransfer))return;const _=parseInt(o.dataTransfer.getData("text/plain"),10);if(_===c||isNaN(_)||!e.value||!e.value.files||_<0||_>=e.value.files.length||c<0||c>=e.value.files.length)return;const I=o.currentTarget?.getBoundingClientRect(),pe=o.clientY,ze=I?I.top+I.height/2:0,je=pe<ze?c:c+1,U=[...e.value.files||[]],[ce]=U.splice(_,1),G=_<je?je-1:je;U.splice(G,0,ce),e.value={...e.value,files:U}},y=()=>{K.value=!1};return Xe(()=>{Y()}),it(()=>{le(),T()}),(o,c)=>{const _=lt,I=Ze,pe=et,ze=ft,je=ss;return i(),p("div",as,[t("div",ns,[t("div",os,[c[7]||(c[7]=t("h3",{class:"text-base font-semibold"},"任务列表",-1)),t("div",rs,[s(I,W({type:"info"},F,{onClick:Y,loading:d.value}),{default:n(()=>[d.value?E("",!0):(i(),A(_,{key:0},{default:n(()=>[s(z(tt))]),_:1}))]),_:1},16,["loading"]),s(I,W({type:"success"},F,{onClick:O,loading:d.value}),{default:n(()=>[s(_,null,{default:n(()=>[s(z(dt))]),_:1})]),_:1},16,["loading"])])]),C.value&&C.value.length>0?(i(),p("div",is,[(i(!0),p(Me,null,Ke(C.value,U=>(i(),p("div",{key:U.task_id,class:Ie(["border rounded px-3 py-2 cursor-pointer hover:bg-gray-50 group min-h-[60px] flex flex-col justify-between",{"border-blue-500 bg-blue-50":e.value&&U.task_id===e.value.task_id}]),onClick:ce=>L(U.task_id)},[t("div",ds,[t("div",cs,k(U.name),1),t("span",fs,[s(_,null,{default:n(()=>[s(z(Nt),{class:"!w-3 !h-3"})]),_:1}),t("span",vs,k(U.files?U.files.length:0),1)])]),t("div",ps,[s(pe,{type:ie(U.status),size:"small",class:"!h-5 !text-xs w-16 text-center"},{default:n(()=>[w(k(he(U.status)),1)]),_:2},1032,["type"]),t("div",ms,[U.status==="success"&&U.result_file?(i(),A(I,W({key:0,type:"primary"},{ref_for:!0},B,{onClick:ge(ce=>me(U),["stop"])}),{default:n(()=>[...c[8]||(c[8]=[w(" 下载 ",-1)])]),_:1},16,["onClick"])):E("",!0),s(I,W({type:"danger"},{ref_for:!0},B,{onClick:ge(ce=>Te(U.task_id),["stop"]),disabled:U.status==="processing"}),{default:n(()=>[s(_,null,{default:n(()=>[s(z(ct))]),_:1})]),_:1},16,["onClick","disabled"])])])],10,us))),128))])):(i(),p("div",gs,' 暂无任务，请点击"新建"创建 '))]),e.value?(i(),p("div",_s,[t("div",xs,[t("h3",ys,"任务详情: "+k(e.value.name),1),t("span",hs," 共 "+k(Ce.value)+" 个文件 ",1)]),t("div",bs,[t("div",ks,[t("div",ws,[s(pe,{type:ie(e.value.status),size:"small",class:"w-16 text-center"},{default:n(()=>[w(k(he(e.value.status)),1)]),_:1},8,["type"]),be.value?(i(),A(ot,{key:0,file:de.value,player:z(M),disabled:S.value,onPlay:h,onSeek:xe},null,8,["file","player","disabled"])):E("",!0),s(I,W({type:"primary"},Q,{onClick:ae,disabled:Re.value}),{default:n(()=>[...c[9]||(c[9]=[w(" 下载 ",-1)])]),_:1},16,["disabled"]),s(I,W({type:"success"},Q,{onClick:re,disabled:Re.value}),{default:n(()=>[...c[10]||(c[10]=[w(" 转存 ",-1)])]),_:1},16,["disabled"]),e.value.error_message?(i(),A(ze,{key:1,content:`错误: ${e.value.error_message}`,placement:"top"},{default:n(()=>[t("span",Ts," 错误: "+k(e.value.error_message),1)]),_:1},8,["content"])):E("",!0)]),t("div",Cs,[s(I,W({type:"success"},Q,{onClick:v,disabled:f.value,loading:$e.value}),{default:n(()=>[...c[11]||(c[11]=[w(" 开始合成 ",-1)])]),_:1},16,["disabled","loading"])])]),t("div",$s,[t("div",Ss,[c[13]||(c[13]=t("h4",{class:"text-sm font-semibold"},"文件列表",-1)),t("div",Ps,[s(I,W({type:"primary"},B,{disabled:r.value,onClick:oe}),{default:n(()=>[...c[12]||(c[12]=[w(" + ",-1)])]),_:1},16,["disabled"]),s(I,W({type:S.value?"success":"default"},F,{onClick:Ue,disabled:R.value,title:N.value}),{default:n(()=>[S.value?(i(),A(_,{key:0},{default:n(()=>[s(z(kt))]),_:1})):(i(),A(je,{key:1,class:"!w-3.5 !h-3.5"}))]),_:1},16,["type","disabled","title"])])]),t("div",Ds,[ue.value?(i(),p("div",Ms,[(i(!0),p(Me,null,Ke(e.value.files,(U,ce)=>(i(),p("div",{key:ce,class:Ie(["flex items-center gap-2 p-1 hover:bg-gray-100 rounded",{"cursor-move":S.value,"cursor-default":!S.value,"select-none":!0}]),draggable:S.value,onDragstart:G=>Ee(G,Number(ce)),onDragend:c[2]||(c[2]=G=>Ge(G)),onDragover:c[3]||(c[3]=ge(G=>Ae(G),["prevent"])),onDragleave:Le,onDrop:ge(G=>Be(G,Number(ce)),["prevent"])},[t("span",Fs,k(Number(ce)+1),1),t("span",{class:"flex-1 text-sm truncate",title:U.path||U.name},k(U.name),9,Rs),U.size?(i(),p("span",Us,k(z(Fe)(U.size)),1)):(i(),p("div",Es)),t("div",{class:"flex items-center gap-1 flex-shrink-0",onMousedown:c[0]||(c[0]=ge(()=>{},["stop"])),onClick:c[1]||(c[1]=ge(()=>{},["stop"]))},[s(ot,{file:U,player:z(M),disabled:r.value,onPlay:()=>ye(Number(ce)),onSeek:_e},null,8,["file","player","disabled","onPlay"]),s(I,{type:"info",size:"small",plain:"",circle:"",onClick:ge(G=>P(Number(ce)),["stop"]),disabled:r.value,class:"!h-6 !text-xs"},{default:n(()=>[s(_,null,{default:n(()=>[s(z(It))]),_:1})]),_:1},8,["onClick","disabled"])],32)],42,Vs))),128))])):(i(),p("div",Ls,"文件列表为空"))])])])])):(i(),p("div",As,[...c[14]||(c[14]=[t("div",{class:"flex items-center justify-between mb-3 flex-shrink-0"},[t("h3",{class:"text-base font-semibold"},"任务详情")],-1),t("div",{class:"flex-1 flex items-center justify-center text-sm text-gray-400"}," 请从左侧选择一个任务查看详情 ",-1)])])),s(rt,{visible:K.value,"onUpdate:visible":c[4]||(c[4]=U=>K.value=U),title:"选择文件添加到任务","confirm-button-text":"添加","confirm-loading":d.value,onConfirm:ne,onClose:y},null,8,["visible","confirm-loading"]),s(rt,{visible:D.value,"onUpdate:visible":c[5]||(c[5]=U=>D.value=U),title:"选择转存目录","confirm-button-text":"转存",mode:"directory","confirm-loading":d.value,onConfirm:Ve,onClose:c[6]||(c[6]=U=>D.value=!1)},null,8,["visible","confirm-loading"])])}}}),zs={class:"flex gap-4 h-[calc(100vh-220px)]"},js={class:"w-64 border rounded p-3 flex flex-col"},Os={class:"flex items-center justify-between mb-3"},Ns={class:"flex items-center gap-1"},Is={key:0,class:"flex-1 overflow-y-auto space-y-2 pr-1 min-h-[400px]"},Ks=["onClick"],Ys={class:"flex items-center justify-between gap-2"},Gs=["title"],qs={class:"flex items-center justify-between gap-2 min-h-[20px]"},Hs={class:"flex items-center gap-1 flex-shrink-0"},Ws={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400 min-h-[400px]"},Js={key:0,class:"flex-1 border rounded p-3 flex flex-col min-h-0"},Qs={class:"flex items-center justify-between mb-3 flex-shrink-0"},Xs={class:"flex items-center gap-2 flex-1"},Zs={class:"text-base font-semibold"},ea={class:"flex-1 flex flex-col gap-3 min-h-0"},ta={class:"flex items-center gap-4 flex-shrink-0"},la={class:"text-red-500 text-xs truncate block max-w-md cursor-help"},sa={class:"border rounded p-3 flex flex-col gap-2"},aa={class:"flex items-center justify-between"},na={class:"flex items-center gap-2"},oa={key:0,class:"text-xs text-gray-500"},ra={key:0,class:"text-sm text-gray-600"},ia=["title"],ua={key:1,class:"text-sm text-gray-400"},da={class:"border rounded p-3 flex flex-col gap-2 flex-1 min-h-0 overflow-hidden"},ca={key:0,class:"flex-1 overflow-y-scroll scrollbar-overlay space-y-1 min-h-0"},fa={class:"flex-1 min-w-0 flex items-center gap-3 text-sm"},va=["title"],pa={class:"flex items-center gap-2 text-xs text-gray-500 flex-shrink-0"},ma={key:0},ga={key:1},_a=["title"],xa={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400 min-h-0"},ya={key:1,class:"flex-1 border rounded p-3 flex flex-col"},ha={key:2,class:"w-80 border rounded p-3 flex flex-col"},ba={class:"flex-1 overflow-auto flex flex-col gap-3"},ka={class:"border rounded p-3 flex flex-col gap-2"},wa={class:"flex items-center gap-2"},Ta={class:"border rounded p-3 flex flex-col gap-2"},Ca={class:"flex items-center gap-2"},$a={class:"text-xs text-gray-400 flex items-center gap-1"},Sa={key:0,class:"border rounded p-3 flex flex-col gap-2"},Pa={key:0,class:"space-y-2"},Da={class:"text-sm text-gray-600"},Ma=["title"],Va={key:1,class:"text-sm text-gray-400"},Fa={key:1,class:"border rounded p-3 flex flex-col gap-2"},Ra={class:"text-sm text-gray-600"},Ua={key:0,class:"mt-2"},Ea={key:3,class:"w-80 border rounded p-3 flex flex-col"},La=He({__name:"AudioConvert",setup(Ye){const d=x(!1),C=x([]),e=x(null),K=x(!1),D=x("mp3"),S=x(!1),j=x(!0),M=x(!1),F=x(!1),B=x(""),Q=x(!1),ee=x(""),X={size:"small",plain:!0,class:"!w-8 !h-6 !p-0"},se={size:"small",plain:!0,class:"!h-5 !text-xs !px-2"},ne={size:"small",plain:!0,class:"!h-7 !text-xs"},Y=async()=>{try{d.value=!0;const f=await _l();f.code===0?(C.value=f.data.tasks||[],C.value.length>0&&!e.value&&await P(C.value[0].task_id)):u.error(f.msg||"获取任务列表失败")}catch(f){V(f,"获取任务列表失败")}finally{d.value=!1}},O=()=>{const f=new Date,r=f.getFullYear(),R=String(f.getMonth()+1).padStart(2,"0"),N=String(f.getDate()).padStart(2,"0"),de=String(f.getHours()).padStart(2,"0"),Se=String(f.getMinutes()).padStart(2,"0"),Ue=String(f.getSeconds()).padStart(2,"0");B.value=`${r}-${R}-${N} ${de}:${Se}:${Ue}`,F.value=!0},L=async()=>{if(!B.value.trim()){u.warning("请输入任务名称");return}try{d.value=!0;const f=await xl({name:B.value.trim()});f.code===0?(u.success("任务创建成功"),F.value=!1,B.value="",await Y(),P(f.data.task_id)):u.error(f.msg||"创建任务失败")}catch(f){V(f,"创建任务失败")}finally{d.value=!1}},Te=()=>{e.value&&(ee.value=e.value.name,Q.value=!0)},oe=async()=>{if(e.value){if(!ee.value.trim()){u.warning("请输入任务名称");return}try{d.value=!0;const f=await We(e.value.task_id,{name:ee.value.trim()});f.code===0?(u.success("任务名称修改成功"),Q.value=!1,ee.value="",await P(e.value.task_id)):u.error(f.msg||"修改任务名称失败")}catch(f){V(f,"修改任务名称失败")}finally{d.value=!1}}},P=async f=>{try{d.value=!0;const r=await yl(f);if(r.code===0){e.value=r.data;const R=C.value.findIndex(N=>N.task_id===f);R!==-1&&(C.value[R]={...r.data}),D.value=r.data.output_dir||"mp3",S.value=!1,j.value=r.data.overwrite!==!1,M.value=!1}else u.error(r.msg||"获取任务信息失败")}catch(r){V(r,"获取任务信息失败")}finally{d.value=!1}},v=async f=>{if(await we.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{d.value=!0;const R=await bl(f);R.code===0?(u.success("任务删除成功"),await Y(),e.value&&e.value.task_id===f&&(C.value&&C.value.length>0?await P(C.value[0].task_id):e.value=null)):u.error(R.msg||"删除任务失败")}catch(R){V(R,"删除任务失败")}finally{d.value=!1}},m=()=>{if(!e.value){u.warning("请先创建或选择任务");return}K.value=!0},T=async f=>{if(!e.value||f.length===0)return;const r=f[0];try{d.value=!0;const R=await We(e.value.task_id,{directory:r});R.code===0?(u.success("目录设置成功"),await P(e.value.task_id),K.value=!1):u.error(R.msg||"设置目录失败")}catch(R){V(R,"设置目录失败")}finally{d.value=!1}},q=()=>{K.value=!1},Z=()=>{if(!e.value)return;const f=e.value.output_dir||"mp3";S.value=D.value!==f},ae=async()=>{if(e.value){if(!D.value.trim()){u.error("输出目录名称不能为空");return}try{d.value=!0;const f=await We(e.value.task_id,{output_dir:D.value.trim()});f.code===0?(u.success("输出目录名称保存成功"),await P(e.value.task_id)):u.error(f.msg||"保存输出目录名称失败")}catch(f){V(f,"保存输出目录名称失败")}finally{d.value=!1}}},me=()=>{if(!e.value)return;const f=e.value.overwrite!==!1;M.value=j.value!==f,M.value&&te()},te=async()=>{if(e.value)try{d.value=!0;const f=await We(e.value.task_id,{overwrite:j.value});f.code===0?(u.success("覆盖选项保存成功"),await P(e.value.task_id)):u.error(f.msg||"保存覆盖选项失败")}catch(f){V(f,"保存覆盖选项失败")}finally{d.value=!1}},_e=async()=>{if(!e.value)return;if(!e.value.directory){u.warning("请先选择转码目录");return}if(await we.confirm(`确定要开始转码吗？将转换 "${e.value.name}" 。`,"确认转码",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{d.value=!0;const r=await hl(e.value.task_id);r.code===0?(u.success("转码任务已启动"),await Y(),await P(e.value.task_id),le()):u.error(r.msg||"启动任务失败")}catch(r){V(r,"启动任务失败")}finally{d.value=!1}},{start:xe,stop:ye}=vt(async()=>{if(!e.value){ye();return}if(await Y(),e.value.status!=="processing"){await P(e.value.task_id),ye();return}await P(e.value.task_id)},Pl,{immediate:!1}),le=()=>{xe()},h={pending:{tag:"info",text:"等待中"},processing:{tag:"warning",text:"处理中"},success:{tag:"success",text:"成功"},failed:{tag:"danger",text:"失败"}},re=f=>h[f]?.tag||"info",Ve=f=>h[f]?.text||"未知",Fe=J(()=>e.value?.status==="processing"),Ne=J(()=>!e.value?.directory||Fe.value),ie=J(()=>Fe.value),he=J(()=>e.value?.file_status?Object.keys(e.value.file_status).map(f=>{const r=e.value.file_status[f];return{path:f,status:r.status||"pending",error:r.error,size:r.size,duration:r.duration}}):[]),$e=f=>f.path.split("/").pop()||f.path,ue=f=>f.status,Ce=f=>f.error,be=f=>{if(!f)return"";const r=["B","KB","MB","GB"];let R=f,N=0;for(;R>=1024&&N<r.length-1;)R/=1024,N++;return`${R.toFixed(1)} ${r[N]}`},Re=f=>{if(!f)return"";const r=Math.floor(f/3600),R=Math.floor(f%3600/60),N=f%60;return r>0?`${r}:${R.toString().padStart(2,"0")}:${N.toString().padStart(2,"0")}`:`${R}:${N.toString().padStart(2,"0")}`};return Xe(()=>{Y()}),it(()=>{ye()}),(f,r)=>{const R=lt,N=Ze,de=et,Se=ft,Ue=Gt,Ee=ut,Ge=bt,Le=St,Ae=$t,Be=Ct;return i(),p("div",zs,[t("div",js,[t("div",Os,[r[11]||(r[11]=t("h3",{class:"text-base font-semibold"},"任务列表",-1)),t("div",Ns,[s(N,W({type:"info"},X,{onClick:Y,loading:d.value}),{default:n(()=>[d.value?E("",!0):(i(),A(R,{key:0},{default:n(()=>[s(z(tt))]),_:1}))]),_:1},16,["loading"]),s(N,W({type:"success"},X,{onClick:O,loading:d.value}),{default:n(()=>[d.value?E("",!0):(i(),A(R,{key:0},{default:n(()=>[s(z(dt))]),_:1}))]),_:1},16,["loading"])])]),C.value&&C.value.length>0?(i(),p("div",Is,[(i(!0),p(Me,null,Ke(C.value,y=>(i(),p("div",{key:y.task_id,class:Ie(["border rounded px-3 py-2 cursor-pointer hover:bg-gray-50 group min-h-[60px] flex flex-col justify-between",{"border-blue-500 bg-blue-50":e.value&&y.task_id===e.value.task_id}]),onClick:o=>P(y.task_id)},[t("div",Ys,[t("div",{class:"text-sm font-medium truncate flex-1 min-w-0",title:y.name},k(y.name),9,Gs)]),t("div",qs,[s(de,{type:re(y.status),size:"small",class:"!h-5 !text-xs w-16 text-center"},{default:n(()=>[w(k(Ve(y.status)),1)]),_:2},1032,["type"]),t("div",Hs,[s(N,W({type:"danger"},{ref_for:!0},se,{onClick:ge(o=>v(y.task_id),["stop"]),disabled:y.status==="processing"}),{default:n(()=>[s(R,null,{default:n(()=>[s(z(ct))]),_:1})]),_:1},16,["onClick","disabled"])])])],10,Ks))),128))])):(i(),p("div",Ws,' 暂无任务，请点击"新建"创建 '))]),e.value?(i(),p("div",Js,[t("div",Qs,[t("div",Xs,[t("h3",Zs,"文件列表: "+k(e.value.name),1),s(N,{type:"default",size:"small",plain:"",circle:"",disabled:ie.value,onClick:Te,title:"编辑名称"},{default:n(()=>[s(R,null,{default:n(()=>[s(z(wt))]),_:1})]),_:1},8,["disabled"])])]),t("div",ea,[t("div",ta,[s(de,{type:re(e.value.status),size:"small",class:"w-16 text-center flex-shrink-0"},{default:n(()=>[w(k(Ve(e.value.status)),1)]),_:1},8,["type"]),e.value.error_message?(i(),A(Se,{key:0,content:`错误: ${e.value.error_message}`,placement:"top",class:"flex-1 min-w-0 max-w-md"},{default:n(()=>[t("span",la," 错误: "+k(e.value.error_message),1)]),_:1},8,["content"])):E("",!0)]),t("div",sa,[t("div",aa,[t("div",na,[r[12]||(r[12]=t("h4",{class:"text-sm font-semibold"},"转码目录",-1)),e.value.total_files!==null&&e.value.total_files!==void 0?(i(),p("span",oa," 可处理文件数: "+k(e.value.total_files),1)):E("",!0)]),s(N,W({type:"primary"},se,{disabled:ie.value,onClick:m}),{default:n(()=>[...r[13]||(r[13]=[w(" 选择目录 ",-1)])]),_:1},16,["disabled"])]),e.value.directory?(i(),p("div",ra,[t("div",{class:"truncate",title:e.value.directory},k(e.value.directory),9,ia)])):(i(),p("div",ua," 请选择一个目录，该目录下的所有媒体文件将被转换为 MP3 格式 "))]),t("div",da,[r[14]||(r[14]=t("h4",{class:"text-sm font-semibold flex-shrink-0"},"文件列表",-1)),he.value&&he.value.length>0?(i(),p("div",ca,[(i(!0),p(Me,null,Ke(he.value,(y,o)=>(i(),p("div",{key:o,class:"flex items-center gap-2 p-2 rounded hover:bg-gray-50 border-b border-gray-100"},[s(R,{class:Ie(["flex-shrink-0",{"text-green-500":ue(y)==="success","text-red-500":ue(y)==="failed","text-yellow-500":ue(y)==="processing","text-gray-400":ue(y)==="pending"}])},{default:n(()=>[ue(y)==="success"?(i(),A(z(kt),{key:0})):ue(y)==="failed"?(i(),A(z(Tt),{key:1})):ue(y)==="processing"?(i(),A(z(Kt),{key:2})):(i(),A(z(Yt),{key:3}))]),_:2},1032,["class"]),t("div",fa,[t("div",{class:"flex-1 min-w-0 truncate",title:y.path},k($e(y)),9,va),t("div",pa,[y.size?(i(),p("span",ma,k(be(y.size)),1)):E("",!0),y.duration?(i(),p("span",ga,k(Re(y.duration)),1)):E("",!0)]),Ce(y)?(i(),p("div",{key:0,class:"text-xs text-red-500 truncate max-w-xs",title:Ce(y)},k(Ce(y)),9,_a)):E("",!0)])]))),128))])):(i(),p("div",xa," 暂无文件，请先选择转码目录 "))])])])):(i(),p("div",ya,[...r[15]||(r[15]=[t("div",{class:"flex items-center justify-between mb-3 flex-shrink-0"},[t("h3",{class:"text-base font-semibold"},"文件列表")],-1),t("div",{class:"flex-1 flex items-center justify-center text-sm text-gray-400"}," 请从左侧选择一个任务查看文件列表 ",-1)])])),e.value?(i(),p("div",ha,[r[24]||(r[24]=t("div",{class:"flex items-center justify-between mb-3"},[t("h3",{class:"text-base font-semibold"},"输出信息")],-1)),t("div",ba,[t("div",ka,[t("div",wa,[r[16]||(r[16]=t("span",{class:"text-sm text-gray-600"},"覆盖同名文件",-1)),s(Ue,{modelValue:j.value,"onUpdate:modelValue":r[0]||(r[0]=y=>j.value=y),disabled:ie.value,onChange:me},null,8,["modelValue","disabled"])]),s(N,W({type:"success"},ne,{onClick:_e,disabled:Ne.value,loading:Fe.value,class:"w-full"}),{default:n(()=>[...r[17]||(r[17]=[w(" 开始转码 ",-1)])]),_:1},16,["disabled","loading"])]),t("div",Ta,[r[20]||(r[20]=t("div",{class:"flex items-center justify-between"},[t("h4",{class:"text-sm font-semibold"},"输出目录名称")],-1)),t("div",Ca,[s(Ee,{modelValue:D.value,"onUpdate:modelValue":r[1]||(r[1]=y=>D.value=y),placeholder:"输出目录名称",size:"small",disabled:ie.value,onBlur:Z},null,8,["modelValue","disabled"]),s(N,W({type:"primary"},se,{disabled:ie.value||!S.value,onClick:ae}),{default:n(()=>[...r[18]||(r[18]=[w(" 保存 ",-1)])]),_:1},16,["disabled"])]),t("div",$a,[r[19]||(r[19]=t("span",null,"文件将保存在转码目录下的此文件夹中",-1)),e.value?.directory&&e.value?.output_dir?(i(),A(Se,{key:0,content:`${e.value.directory}/${e.value.output_dir}`,placement:"top"},{default:n(()=>[s(R,{class:"cursor-help text-gray-400 hover:text-gray-600"},{default:n(()=>[s(z(qt))]),_:1})]),_:1},8,["content"])):E("",!0)])]),e.value.status==="processing"||e.value.progress?(i(),p("div",Sa,[r[21]||(r[21]=t("h4",{class:"text-sm font-semibold"},"转码进度",-1)),e.value.progress?(i(),p("div",Pa,[t("div",Da," 已处理: "+k(e.value.progress.processed??0)+" / "+k(e.value.total_files??e.value.progress.total??0),1),s(Ge,{percentage:(e.value.total_files??e.value.progress.total??0)>0?Math.round((e.value.progress.processed??0)/(e.value.total_files??e.value.progress.total??1)*100):0,status:e.value.status==="processing"?void 0:"success"},null,8,["percentage","status"]),e.value.progress.current_file?(i(),p("div",{key:0,class:"text-xs text-gray-500 truncate",title:e.value.progress.current_file}," 正在处理: "+k(e.value.progress.current_file),9,Ma)):E("",!0)])):(i(),p("div",Va,"等待开始转码..."))])):E("",!0),e.value.status==="success"?(i(),p("div",Fa,[r[23]||(r[23]=t("h4",{class:"text-sm font-semibold"},"转码结果",-1)),t("div",Ra,[r[22]||(r[22]=t("div",null,"转码完成！所有文件已保存到输出目录",-1)),e.value.progress?(i(),p("div",Ua," 共转换 "+k(e.value.total_files??e.value.progress.total??0)+" 个文件 ",1)):E("",!0)])])):E("",!0)])])):(i(),p("div",Ea,[...r[25]||(r[25]=[t("h3",{class:"text-base font-semibold mb-3"},"输出信息",-1),t("div",{class:"flex-1 flex items-center justify-center text-sm text-gray-400"}," 请从左侧选择一个任务查看输出信息 ",-1)])])),s(rt,{visible:K.value,"onUpdate:visible":r[2]||(r[2]=y=>K.value=y),title:"选择转码目录","confirm-button-text":"确定",mode:"directory","default-path":e.value?.directory||void 0,"confirm-loading":d.value,onConfirm:T,onClose:q},null,8,["visible","default-path","confirm-loading"]),s(Be,{modelValue:F.value,"onUpdate:modelValue":r[5]||(r[5]=y=>F.value=y),title:"创建转码任务",width:"400px",onClose:r[6]||(r[6]=y=>B.value="")},{footer:n(()=>[s(N,{onClick:r[4]||(r[4]=y=>F.value=!1)},{default:n(()=>[...r[26]||(r[26]=[w("取消",-1)])]),_:1}),s(N,{type:"primary",onClick:L,loading:d.value},{default:n(()=>[...r[27]||(r[27]=[w(" 确定 ",-1)])]),_:1},8,["loading"])]),default:n(()=>[s(Ae,null,{default:n(()=>[s(Le,{label:"任务名称"},{default:n(()=>[s(Ee,{modelValue:B.value,"onUpdate:modelValue":r[3]||(r[3]=y=>B.value=y),placeholder:"请输入任务名称",onKeyup:qe(L,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(Be,{modelValue:Q.value,"onUpdate:modelValue":r[9]||(r[9]=y=>Q.value=y),title:"重命名任务",width:"400px",onClose:r[10]||(r[10]=y=>ee.value="")},{footer:n(()=>[s(N,{onClick:r[8]||(r[8]=y=>Q.value=!1)},{default:n(()=>[...r[28]||(r[28]=[w("取消",-1)])]),_:1}),s(N,{type:"primary",onClick:oe,loading:d.value},{default:n(()=>[...r[29]||(r[29]=[w(" 确定 ",-1)])]),_:1},8,["loading"])]),default:n(()=>[s(Ae,null,{default:n(()=>[s(Le,{label:"任务名称"},{default:n(()=>[s(Ee,{modelValue:ee.value,"onUpdate:modelValue":r[7]||(r[7]=y=>ee.value=y),placeholder:"请输入任务名称",onKeyup:qe(oe,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),Aa={class:"flex gap-4 h-[calc(100vh-220px)]"},Ba={class:"w-64 border rounded p-3 flex flex-col"},za={class:"flex items-center justify-between mb-3"},ja={class:"flex items-center gap-1"},Oa={key:0,class:"flex-1 overflow-y-auto space-y-2 pr-1 min-h-[400px]"},Na=["onClick"],Ia={class:"flex items-center justify-between gap-2"},Ka=["title"],Ya={key:0,class:"text-xs text-gray-500 flex-shrink-0"},Ga={class:"flex items-center justify-between gap-2 min-h-[20px]"},qa={class:"flex items-center gap-1 flex-shrink-0"},Ha={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},Wa={key:0,class:"flex-1 border rounded p-3 flex flex-col max-w-2xl"},Ja={class:"flex items-cente mb-3 flex-shrink-0"},Qa={class:"text-base font-semibold mr-2"},Xa={class:"flex-1 overflow-auto flex flex-col gap-3"},Za={class:"flex items-center gap-4 flex-shrink-0 flex-wrap"},en={key:1,class:"text-xs text-gray-600 ml-auto"},tn={class:"text-red-500 text-xs truncate max-w-xs inline-block cursor-help"},ln={class:"border rounded p-3 flex flex-col gap-2 flex-1"},sn={class:"flex items-center justify-between"},an={class:"flex items-center gap-2"},nn={key:0,class:"flex items-center gap-2 mr-2"},on=["onClick"],rn=["src","alt"],un=["onClick"],dn={class:"border rounded p-3 flex flex-col gap-2"},cn={class:"grid grid-cols-4 gap-3"},fn={class:"flex flex-col gap-1"},vn={class:"flex flex-col gap-1"},pn={class:"flex flex-col gap-1"},mn={class:"flex flex-col gap-1"},gn={class:"border rounded p-3 flex flex-col gap-2 flex-shrink-0"},_n={key:1,class:"flex-1 border rounded p-3 flex flex-col max-w-2xl"},xn={class:"flex items-center justify-center min-h-[400px]"},yn=["src","alt"],hn={class:"flex items-center justify-between w-full"},bn={class:"flex items-center gap-2"},kn={class:"text-sm text-gray-600"},ht="cosyvoice-v3-plus-leo-34ba9eaebae44039a4a9426af6389dcd",Je=.8,Qe=50,wn=He({__name:"TTS",setup(Ye){const d=x(!1),C=x([]),e=x(null),K=x(null),D=x(!1),S=x(""),j=x(""),M=x(!1),F=x(""),B=x(""),Q=x(ht),ee=x(null),X=x(Je),se=x(Qe),ne=x(!1),Y=x(null),O=x([]),L=x(new Map),Te=x(!1),oe=x(!1),P=x(-1),v=Dt({callbacks:{onPlay:()=>{u.success("开始播放")},onError:()=>{V(new Error("音频播放失败"),"播放失败"),de()},onEnded:()=>{de()}}}),m={size:"small",plain:!0,class:"!w-8 !h-6 !p-0"},T={size:"small",plain:!0,class:"!h-5 !text-xs !px-2"},q={size:"small",plain:!0,class:"!h-7 !text-xs"},Z=async()=>{try{d.value=!0;const l=await kl();l.code===0?(C.value=l.data||[],C.value.length>0&&!e.value&&await le(C.value[0].task_id)):u.error(l.msg||"获取任务列表失败")}catch(l){V(l,"获取任务列表失败")}finally{d.value=!1}},ae=()=>{const l=new Date,a=l.getFullYear(),b=String(l.getMonth()+1).padStart(2,"0"),g=String(l.getDate()).padStart(2,"0"),H=String(l.getHours()).padStart(2,"0"),fe=String(l.getMinutes()).padStart(2,"0"),ve=String(l.getSeconds()).padStart(2,"0");S.value=`${a}-${b}-${g} ${H}:${fe}:${ve}`,j.value="",D.value=!0},me=()=>{S.value=""},te=async()=>{try{d.value=!0;const l=await wl({text:"",name:S.value.trim()||void 0});l.code===0?(u.success("任务创建成功"),D.value=!1,S.value="",await Z(),le(l.data.task_id)):u.error(l.msg||"创建任务失败")}catch(l){V(l,"创建任务失败")}finally{d.value=!1}},_e=l=>{B.value=l.text||"",Q.value=l.role||ht,ee.value=l.model||null,X.value=l.speed??Je,se.value=l.vol??Qe,ne.value=!1},xe=l=>K.value===l,ye=l=>{const a=C.value.findIndex(b=>b.task_id===l.task_id);a!==-1&&(C.value[a]={...l})},le=async l=>{e.value&&e.value.task_id!==l&&e.value&&(Se(),y(),e.value.status!=="processing"&&f());const b=C.value.find(g=>g.task_id===l);b&&(e.value={...b},_e(b),b.status==="processing"&&r()),K.value=l;try{const g=await _t(l);if(!xe(l))return;if(g.code===0){if(!xe(l))return;const H=g.data;e.value=H,ye(H),_e(H),H.status==="processing"&&r()}}catch(g){xe(l)&&console.error(`[TTS] 获取任务详情失败: ${l}`,g)}finally{xe(l)&&(K.value=null)}},h=async l=>{if(e.value&&e.value.task_id===l&&e.value.status!=="processing"&&f(),!!await we.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{d.value=!0;const b=await Sl(l);b.code===0?(u.success("任务删除成功"),await Z(),e.value&&e.value.task_id===l&&(C.value&&C.value.length>0?await le(C.value[0].task_id):e.value=null)):u.error(b.msg||"删除任务失败")}catch(b){V(b,"删除任务失败")}finally{d.value=!1}},re=()=>{e.value&&(F.value=e.value.name,M.value=!0)},Ve=async()=>{if(e.value){if(!F.value.trim()){u.warning("请输入任务名称");return}try{d.value=!0;const l=await xt(e.value.task_id,{name:F.value.trim()});l.code===0?(u.success("任务名称修改成功"),M.value=!1,F.value="",await le(e.value.task_id)):u.error(l.msg||"修改任务名称失败")}catch(l){V(l,"修改任务名称失败")}finally{d.value=!1}}},Fe=()=>{if(!e.value)return;const l=e.value.text||"";ne.value=B.value!==l,ne.value&&he()},Ne=l=>{Q.value=l,ie()},ie=()=>{if(!e.value)return;const l=e.value.role||null,a=e.value.model||null,b=e.value.speed??Je,g=e.value.vol??Qe;ne.value=Q.value!==l||ee.value!==a||X.value!==b||se.value!==g,ne.value&&he()},he=async()=>{if(!(!e.value||!ne.value))try{d.value=!0;const l={},a=e.value.text||"";B.value!==a&&(l.text=B.value);const b=e.value.role||null;Q.value!==b&&(l.role=Q.value||void 0);const g=e.value.model||null;ee.value!==g&&(l.model=ee.value||void 0);const H=e.value.speed??Je;X.value!==H&&(l.speed=X.value);const fe=e.value.vol??Qe;se.value!==fe&&(l.vol=se.value);const ve=await xt(e.value.task_id,l);ve.code===0?(ne.value=!1,await le(e.value.task_id)):u.error(ve.msg||"保存参数失败")}catch(l){V(l,"保存参数失败")}finally{d.value=!1}},$e=async()=>{if(!e.value)return;if(!B.value.trim()){u.warning("请输入文本内容");return}if(ne.value&&await he(),!!await we.confirm(`确定要开始生成任务 "${e.value.name}" 吗？`,"确认生成",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{d.value=!0;const a=await Tl(e.value.task_id);a.code===0?(u.success("TTS 任务已启动"),await Z(),await le(e.value.task_id)):u.error(a.msg||"启动任务失败")}catch(a){V(a,"启动任务失败")}finally{d.value=!1}},ue=async()=>{if(!(!e.value||!await we.confirm("确定要停止生成吗？","确认停止",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{d.value=!0;const a=await Cl(e.value.task_id);a.code===0?(u.success("任务已停止"),await Z(),await le(e.value.task_id)):u.error(a.msg||"停止任务失败")}catch(a){V(a,"停止任务失败")}finally{d.value=!1}},Ce=async l=>{try{const a=await _t(l);if(a.code===0){const b=a.data;ye(b),e.value&&e.value.task_id===l&&(e.value=b,_e(b))}}catch(a){console.error(`[TTS] 更新任务详情失败: ${l}`,a)}},be=x(new Set),{start:Re,stop:f}=vt(async()=>{await Z();const l=C.value.filter(g=>g.status==="processing"),a=new Set(l.map(g=>g.task_id)),b=Array.from(be.value).filter(g=>!a.has(g));for(const g of b)await Ce(g);if(be.value=a,l.length===0){f(),be.value.clear();return}for(const g of l)await Ce(g.task_id)},Mt,{immediate:!1}),r=()=>{const l=C.value.filter(a=>a.status==="processing");be.value=new Set(l.map(a=>a.task_id)),Re()},R=async()=>{if(e.value?.output_file)try{const l=yt(e.value.task_id),a=await fetch(l);if(!a.ok){u.error("下载失败");return}const b=await a.blob(),g=URL.createObjectURL(b),H=e.value.output_file,fe=H.includes(".")?"."+H.split(".").pop():"",Pe=`${e.value.name||"tts_output"}${fe}`,ke=document.createElement("a");ke.href=g,ke.download=Pe,document.body.appendChild(ke),ke.click(),document.body.removeChild(ke),URL.revokeObjectURL(g)}catch(l){V(l,"下载失败")}},N=async l=>{if(l?.output_file)try{const a=yt(l.task_id),b=await fetch(a);if(!b.ok){u.error("下载失败");return}const g=await b.blob(),H=URL.createObjectURL(g),fe=l.output_file,ve=fe.includes(".")?"."+fe.split(".").pop():"",ke=`${l.name||"tts_output"}${ve}`,De=document.createElement("a");De.href=H,De.download=ke,document.body.appendChild(De),De.click(),document.body.removeChild(De),URL.revokeObjectURL(H)}catch(a){V(a,"下载失败")}},de=()=>{v.clear()},Se=()=>{de()},Ue=()=>{if(!e.value||!e.value.output_file){u.warning("结果文件不存在");return}const l=e.value.output_file;if(v.playingFilePath.value===l&&v.audio&&!v.audio.paused){de(),u.info("已停止播放");return}const a=nt(l);if(!a){u.error("无法生成媒体文件URL");return}v.load(a,{playingFilePath:l}),v.play().catch(b=>{V(b,"播放失败"),de()})},Ee=(l,a)=>{e.value?.output_file&&Ge({path:e.value.output_file},a)},Ge=(l,a)=>{if(!l)return;const b=l?.path||l?.name||"";v.seekFile(b,a)},Le={pending:{tag:"info",text:"等待中"},processing:{tag:"warning",text:"处理中"},success:{tag:"success",text:"成功"},failed:{tag:"danger",text:"失败"}},Ae=l=>Le[l]?.tag||"info",Be=l=>Le[l]?.text||"未知",y=()=>{L.value.forEach(l=>{URL.revokeObjectURL(l)}),L.value.clear(),O.value=[],Y.value&&(Y.value.value=""),oe.value&&(oe.value=!1,P.value=-1)},o=()=>{Y.value?.click()},c=l=>{const b=l.target.files;if(b&&b.length>0){const g=Array.from(b);g.forEach((H,fe)=>{const ve=O.value.length+fe,Pe=URL.createObjectURL(H);L.value.set(ve,Pe)}),O.value.push(...g)}},_=l=>{if(L.value.has(l))return L.value.get(l);if(l>=0&&l<O.value.length){const a=URL.createObjectURL(O.value[l]);return L.value.set(l,a),a}return""},I=l=>{if(l<0||l>=O.value.length)return;L.value.has(l)&&(URL.revokeObjectURL(L.value.get(l)),L.value.delete(l)),P.value===l?(oe.value=!1,P.value=-1):P.value>l&&P.value--;const a=new Map;O.value.forEach((b,g)=>{if(g!==l){const H=(g>l,g);L.value.has(H)&&a.set(g>l?g-1:g,L.value.get(H))}}),L.value=a,O.value.splice(l,1),Y.value&&(Y.value.value="")},pe=l=>{P.value=l,oe.value=!0},ze=()=>{P.value>0&&P.value--},je=()=>{P.value<O.value.length-1&&P.value++},U=J(()=>P.value>=0&&O.value[P.value]?O.value[P.value].name:"图片预览"),ce=async()=>{if(O.value.length===0){u.warning("请先选择图片");return}if(!e.value){u.warning("请先创建或选择一个 TTS 任务");return}if(e.value.status==="processing"){u.warning("任务正在处理中，无法执行 OCR");return}try{Te.value=!0;const l=await $l(e.value.task_id,O.value);l.code===0?(u.success("OCR 任务已启动，正在后台处理"),y(),await le(e.value.task_id),Re()):u.error(l.msg||"OCR 识别失败")}catch(l){V(l,"OCR 识别失败")}finally{Te.value=!1}},G=J(()=>e.value?.status==="processing"),Vt=J(()=>!B.value.trim()||G.value),Ft=J(()=>!e.value?.output_file||e.value.status!=="success"),st=J(()=>e.value?.output_file?{path:e.value.output_file,name:e.value.output_file.split("/").pop()||"output.mp3"}:null),pt=J(()=>st.value?{path:st.value.path,name:st.value.name,duration:e.value?.duration||null}:null);return Xe(()=>{Z()}),it(()=>{f(),de(),L.value.forEach(l=>{URL.revokeObjectURL(l)}),L.value.clear()}),(l,a)=>{const b=lt,g=Ze,H=et,fe=ft,ve=ut,Pe=Jt,ke=Wt,De=Qt,mt=St,gt=$t,at=Ct;return i(),p("div",Aa,[t("div",Ba,[t("div",za,[a[15]||(a[15]=t("h3",{class:"text-base font-semibold"},"任务列表",-1)),t("div",ja,[s(g,W({type:"info"},m,{onClick:Z,loading:d.value}),{default:n(()=>[d.value?E("",!0):(i(),A(b,{key:0},{default:n(()=>[s(z(tt))]),_:1}))]),_:1},16,["loading"]),s(g,W({type:"success"},m,{onClick:ae}),{default:n(()=>[s(b,null,{default:n(()=>[s(z(dt))]),_:1})]),_:1},16)])]),C.value&&C.value.length>0?(i(),p("div",Oa,[(i(!0),p(Me,null,Ke(C.value,$=>(i(),p("div",{key:$.task_id,class:Ie(["border rounded px-3 py-2 cursor-pointer hover:bg-gray-50 group min-h-[60px] flex flex-col justify-between",{"border-blue-500 bg-blue-50":e.value&&$.task_id===e.value.task_id}]),onClick:Oe=>le($.task_id)},[t("div",Ia,[t("div",{class:"text-sm font-medium truncate flex-1 min-w-0",title:$.name},k($.name),9,Ka),$.duration?(i(),p("span",Ya,k(z(el)($.duration)),1)):E("",!0)]),t("div",Ga,[s(H,{type:Ae($.status),size:"small",class:"!h-5 !text-xs w-16 text-center"},{default:n(()=>[w(k(Be($.status)),1)]),_:2},1032,["type"]),t("div",qa,[$.status==="success"&&$.output_file?(i(),A(g,W({key:0,type:"primary"},{ref_for:!0},T,{onClick:ge(Oe=>N($),["stop"])}),{default:n(()=>[...a[16]||(a[16]=[w(" 下载 ",-1)])]),_:1},16,["onClick"])):E("",!0),s(g,W({type:"danger"},{ref_for:!0},T,{onClick:ge(Oe=>h($.task_id),["stop"]),disabled:$.status==="processing"}),{default:n(()=>[s(b,null,{default:n(()=>[s(z(ct))]),_:1})]),_:1},16,["onClick","disabled"])])])],10,Na))),128))])):(i(),p("div",Ha,' 暂无任务，请点击"新建"创建 '))]),e.value?(i(),p("div",Wa,[t("div",Ja,[t("h3",Qa,"任务详情: "+k(e.value.name),1),s(g,{type:"default",size:"small",plain:"",circle:"",disabled:G.value,onClick:re,title:"编辑名称"},{default:n(()=>[s(b,null,{default:n(()=>[s(z(wt))]),_:1})]),_:1},8,["disabled"])]),t("div",Xa,[t("div",Za,[s(H,{type:Ae(e.value.status),size:"small",class:"w-16 text-center"},{default:n(()=>[w(k(Be(e.value.status)),1)]),_:1},8,["type"]),pt.value?(i(),A(ot,{key:0,file:pt.value,player:z(v),disabled:G.value,onPlay:Ue,onSeek:Ee},null,8,["file","player","disabled"])):E("",!0),s(g,W({type:"primary"},q,{onClick:R,disabled:Ft.value}),{default:n(()=>[...a[17]||(a[17]=[w(" 下载 ",-1)])]),_:1},16,["disabled"]),e.value.total_chars!==void 0?(i(),p("span",en,[G.value&&e.value.generated_chars!==void 0?(i(),p(Me,{key:0},[w(k(e.value.generated_chars)+" / "+k(e.value.total_chars),1)],64)):(i(),p(Me,{key:1},[w(k(e.value.total_chars),1)],64))])):E("",!0),e.value.error_message?(i(),A(fe,{key:2,content:`错误: ${e.value.error_message}`,placement:"top",class:"w-full"},{default:n(()=>[t("span",tn," 错误: "+k(e.value.error_message),1)]),_:1},8,["content"])):E("",!0)]),t("div",ln,[t("div",sn,[a[19]||(a[19]=t("h4",{class:"h-8 text-sm font-semibold"},"文本内容",-1)),t("div",an,[O.value.length>0?(i(),p("div",nn,[(i(!0),p(Me,null,Ke(O.value,($,Oe)=>(i(),p("div",{key:Oe,class:"relative group cursor-pointer",onClick:Rt=>pe(Oe)},[t("img",{src:_(Oe),alt:$.name,class:"w-8 h-8 object-cover rounded border border-gray-300 hover:border-blue-500 transition-colors"},null,8,rn),t("div",{class:"absolute -right-1 -top-1 w-4 h-4 bg-red-500 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",onClick:ge(Rt=>I(Oe),["stop"])},[s(b,{class:"text-white text-xs"},{default:n(()=>[s(z(Tt))]),_:1})],8,un)],8,on))),128))])):E("",!0),t("input",{ref_key:"imageInputRef",ref:Y,type:"file",accept:"image/*",multiple:"",onChange:c,class:"hidden"},null,544),s(g,{type:"default",size:"small",onClick:o,disabled:G.value,class:"!p-0"},{default:n(()=>[s(b,{class:"!w-7 !h-6"},{default:n(()=>[s(z(Ht),{class:"!w-5 !h-5"})]),_:1})]),_:1},8,["disabled"]),s(g,{type:"primary",size:"small",onClick:ce,disabled:G.value||O.value.length===0||!e.value,loading:Te.value},{default:n(()=>[...a[18]||(a[18]=[w(" 识别 ",-1)])]),_:1},8,["disabled","loading"])])]),s(ve,{modelValue:B.value,"onUpdate:modelValue":a[0]||(a[0]=$=>B.value=$),type:"textarea",autosize:{minRows:6,maxRows:20},placeholder:"请输入要转换为语音的文本",disabled:G.value,onBlur:Fe,class:"flex-1"},null,8,["modelValue","disabled"])]),t("div",dn,[a[24]||(a[24]=t("h4",{class:"text-sm font-semibold"},"参数设置",-1)),t("div",cn,[t("div",fn,[a[20]||(a[20]=t("label",{class:"text-xs text-gray-600"},"模型",-1)),s(ke,{modelValue:ee.value,"onUpdate:modelValue":a[1]||(a[1]=$=>ee.value=$),size:"small",placeholder:"默认模型",clearable:"",disabled:G.value,onChange:ie,class:"w-full"},{default:n(()=>[s(Pe,{label:"cosyvoice-v3-flash",value:"cosyvoice-v3-flash"}),s(Pe,{label:"cosyvoice-v3-plus",value:"cosyvoice-v3-plus"})]),_:1},8,["modelValue","disabled"])]),t("div",vn,[a[21]||(a[21]=t("label",{class:"text-xs text-gray-600"},"发音人/音色",-1)),s(ke,{modelValue:Q.value,"onUpdate:modelValue":a[2]||(a[2]=$=>Q.value=$),size:"small",placeholder:"请选择音色（可选）",clearable:"",disabled:G.value,onChange:Ne,class:"w-full"},{default:n(()=>[s(Pe,{label:"灿灿",value:"cosyvoice-v3-plus-leo-34ba9eaebae44039a4a9426af6389dcd"})]),_:1},8,["modelValue","disabled"])]),t("div",pn,[a[22]||(a[22]=t("label",{class:"text-xs text-gray-600"},"语速",-1)),s(De,{modelValue:X.value,"onUpdate:modelValue":a[3]||(a[3]=$=>X.value=$),size:"small",min:.5,max:2,step:.1,precision:1,disabled:G.value,onChange:ie,class:"w-full"},null,8,["modelValue","disabled"])]),t("div",mn,[a[23]||(a[23]=t("label",{class:"text-xs text-gray-600"},"音量",-1)),s(De,{modelValue:se.value,"onUpdate:modelValue":a[4]||(a[4]=$=>se.value=$),size:"small",min:0,max:100,step:1,disabled:G.value,onChange:ie,class:"w-full"},null,8,["modelValue","disabled"])])])]),t("div",gn,[G.value?(i(),A(g,W({key:1,type:"warning"},q,{onClick:ue,class:"w-full"}),{default:n(()=>[...a[26]||(a[26]=[w(" 停止生成 ",-1)])]),_:1},16)):(i(),A(fe,{key:0,content:B.value.trim()?"":"请先输入文本内容",disabled:!!B.value.trim(),placement:"top"},{default:n(()=>[s(g,W({type:"success"},q,{onClick:$e,disabled:Vt.value,class:"w-full"}),{default:n(()=>[...a[25]||(a[25]=[w(" 开始生成 ",-1)])]),_:1},16,["disabled"])]),_:1},8,["content","disabled"]))])])])):(i(),p("div",_n,[...a[27]||(a[27]=[t("div",{class:"flex items-center justify-between mb-3 flex-shrink-0"},[t("h3",{class:"text-base font-semibold"},"任务详情")],-1),t("div",{class:"flex-1 flex items-center justify-center text-sm text-gray-400"}," 请从左侧选择一个任务查看详情 ",-1)])])),s(at,{modelValue:D.value,"onUpdate:modelValue":a[7]||(a[7]=$=>D.value=$),title:"创建 TTS 任务",width:"500px",onClose:me},{footer:n(()=>[s(g,{onClick:a[6]||(a[6]=$=>D.value=!1)},{default:n(()=>[...a[28]||(a[28]=[w("取消",-1)])]),_:1}),s(g,{type:"primary",onClick:te},{default:n(()=>[...a[29]||(a[29]=[w(" 确定 ",-1)])]),_:1})]),default:n(()=>[s(gt,null,{default:n(()=>[s(mt,{label:"任务名称"},{default:n(()=>[s(ve,{modelValue:S.value,"onUpdate:modelValue":a[5]||(a[5]=$=>S.value=$),placeholder:"请输入任务名称",onKeyup:qe(te,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(at,{modelValue:M.value,"onUpdate:modelValue":a[10]||(a[10]=$=>M.value=$),title:"重命名任务",width:"400px",onClose:a[11]||(a[11]=$=>F.value="")},{footer:n(()=>[s(g,{onClick:a[9]||(a[9]=$=>M.value=!1)},{default:n(()=>[...a[30]||(a[30]=[w("取消",-1)])]),_:1}),s(g,{type:"primary",onClick:Ve},{default:n(()=>[...a[31]||(a[31]=[w(" 确定 ",-1)])]),_:1})]),default:n(()=>[s(gt,null,{default:n(()=>[s(mt,{label:"任务名称"},{default:n(()=>[s(ve,{modelValue:F.value,"onUpdate:modelValue":a[8]||(a[8]=$=>F.value=$),placeholder:"请输入任务名称",onKeyup:qe(Ve,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(at,{modelValue:oe.value,"onUpdate:modelValue":a[13]||(a[13]=$=>oe.value=$),title:U.value,width:"90%","align-center":"",onClose:a[14]||(a[14]=$=>P.value=-1)},{footer:n(()=>[t("div",hn,[t("div",bn,[s(g,{onClick:ze,disabled:P.value<=0,size:"small"},{default:n(()=>[...a[32]||(a[32]=[w(" 上一张 ",-1)])]),_:1},8,["disabled"]),t("span",kn,k(P.value+1)+" / "+k(O.value.length),1),s(g,{onClick:je,disabled:P.value>=O.value.length-1,size:"small"},{default:n(()=>[...a[33]||(a[33]=[w(" 下一张 ",-1)])]),_:1},8,["disabled"])]),s(g,{type:"danger",onClick:a[12]||(a[12]=$=>I(P.value)),size:"small"},{default:n(()=>[...a[34]||(a[34]=[w(" 删除 ",-1)])]),_:1})])]),default:n(()=>[t("div",xn,[P.value>=0&&O.value[P.value]?(i(),p("img",{key:0,src:_(P.value),alt:O.value[P.value].name,class:"max-w-full max-h-[70vh] object-contain"},null,8,yn)):E("",!0)])]),_:1},8,["modelValue","title"])])}}}),Tn={class:"p-1"},Ln=He({__name:"index",setup(Ye){const d=x("tts_tool"),C=e=>{console.log("切换到页签:",e)};return(e,K)=>{const D=Zt,S=Xt;return i(),p("div",Tn,[s(S,{modelValue:d.value,"onUpdate:modelValue":K[0]||(K[0]=j=>d.value=j),onTabChange:C,class:"flex-1 flex flex-col overflow-hidden h-[calc(100vh-150px)]"},{default:n(()=>[s(D,{label:"TTS",name:"tts_tool"},{default:n(()=>[s(wn)]),_:1}),s(D,{label:"PDF 工具",name:"pdf_tool"},{default:n(()=>[s(es)]),_:1}),s(D,{label:"音频合成",name:"audio_merge"},{default:n(()=>[s(Bs)]),_:1}),s(D,{label:"音频转码",name:"audio_convert"},{default:n(()=>[s(La)]),_:1})]),_:1},8,["modelValue"])])}}});export{Ln as default};
