import{B as We,o as et,q as zt,D as o,G as v,I as t,Z as a,Q as n,a3 as b,P as Ye,U as k,M as V,W as Ot,E,u as A,aj as He,r as y,ao as Nt,k as dt,H,O as $e,aa as Be,S as xe,e as G}from"./vue-vendor-Bzw_s7xI.js";import{c as tt,K as It,F as Tt,q as Kt,A as Yt,D as qt,y as st,u as ct,a1 as lt,E as i,ak as ye,f as at,B as Gt,L as ft,i as Ht,a9 as vt,a8 as $t,ab as Wt,al as pt,J as Ct,am as St,ae as Jt,an as Qt,a0 as Xt,X as Zt,C as Dt,ao as Mt,ap as Pt,aq as es,ar as ts,t as ss,r as ls,Y as as,aj as ns,ai as os}from"./element-plus-CEI_9LYZ.js";import{a1 as Vt,a2 as rs,u as D,a3 as is,a4 as us,a5 as ds,a6 as cs,a7 as fs,a8 as vs,a9 as ps,aa as ms,ab as gs,ac as _s,ad as Ft,$ as rt,ae as xs,af as ys,ag as hs,ah as bs,ai as ks,aj as ws,ak as Ts,al as Qe,am as $s,an as Cs,ao as Ss,ap as Ds,z as Ms,aq as Ps,ar as Vs,as as ht,at as bt,au as Fs,av as Rs,aw as kt,ax as Us,ay as Es,az as Ls}from"./shared-1TZFBAIg.js";import{u as Rt,b as mt,M as it,_ as ut}from"./useInterval-B8gEL0mK.js";import"./vendor-B3rMqREe.js";import"./utils-B-B_-3AX.js";import"./index-gfppqctp.js";import"./vant-DC8oOVF3.js";const Bs={class:"p-4 flex flex-col h-[calc(100vh-200px)]"},As={class:"mb-4 flex-shrink-0 border rounded p-3 bg-gray-50"},js={class:"flex flex-col gap-3"},zs={class:"flex items-center gap-3"},Os={class:"flex-1 min-w-0"},Ns={class:"flex items-center gap-2"},Is=["title"],Ks={key:0,class:"text-xs text-gray-500 flex-shrink-0"},Ys={class:"flex items-center gap-2"},qs={class:"flex items-center justify-between"},Gs={class:"flex-1 overflow-auto"},Hs=["onClick","title"],Ws={key:1,class:"text-gray-400"},Js={key:0,class:"flex flex-col gap-1"},Qs={class:"text-sm"},Xs={class:"text-xs text-gray-500"},Zs={key:1,class:"text-gray-400"},el={key:0,class:"flex flex-col gap-1"},tl={class:"text-sm"},sl={class:"text-xs text-gray-500"},ll={key:1,class:"text-gray-400"},al={class:"flex flex-col gap-1 items-center"},nl=["onClick"],ol=["title"],rl={class:"flex items-center gap-2"},il=We({__name:"PdfTool",setup(qe){const d=y(!1),C=y([]),e=y(null),K=y(""),M=y(0),S=y(""),z=y(null),P=y(null);let R=null;const U=async()=>{try{d.value=!0;const f=await rs();if(f.code===0){const m=f.data||[];C.value=m.map($=>({...$,_decrypting:$.status==="processing"||!1,_password:""}))}else i.error(f.msg||"获取任务列表失败")}catch(f){D(f,"获取任务列表失败")}finally{d.value=!1}},Q=f=>{f.raw&&(e.value=f.raw,K.value=f.raw.name,M.value=0,S.value="",z.value&&te())},Z=f=>{if(f<60)return`${f}秒`;if(f<3600){const m=Math.floor(f/60),$=f%60;return`${m}分${$}秒`}else{const m=Math.floor(f/3600),$=Math.floor(f%3600/60),W=f%60;return`${m}小时${$}分${W}秒`}},X=()=>{if(P.value!==null&&M.value>0&&M.value<100){const f=Math.floor((Date.now()-P.value)/1e3);S.value=Z(f)}},te=()=>{z.value&&d.value?(z.value.abort(),z.value=null,R&&(clearInterval(R),R=null),M.value=0,S.value="",P.value=null,d.value=!1,i.info("上传已取消")):(e.value=null,K.value="",M.value=0,S.value="",P.value=null,i.info("已清除选中文件"))},le=async()=>{if(!e.value){i.warning("请选择要上传的文件");return}const f=e.value;if(!f.name.toLowerCase().endsWith(".pdf")){i.error("只支持 PDF 文件");return}z.value&&te();try{d.value=!0,M.value=0,S.value="",P.value=Date.now();const m=new AbortController;z.value=m,R=setInterval(()=>{X()},1e3);const $=await is(f,W=>{M.value=W,X()},m.signal);R&&(clearInterval(R),R=null),z.value=null,$.code===0?(M.value=100,X(),i.success("文件上传成功"),setTimeout(()=>{e.value=null,K.value="",M.value=0,S.value="",P.value=null},500),await U()):(i.error($.msg||"文件上传失败"),M.value=0,S.value="",P.value=null)}catch(m){if(m.name==="CanceledError"||m.code==="ECONNABORTED"||m.message?.includes("canceled")||m.message?.includes("aborted")){R&&(clearInterval(R),R=null),z.value||(d.value=!1);return}const $=m.message||"文件上传失败",W=M.value;m.code==="ERR_NETWORK"||m.message?.includes("Network Error")?i.error(`网络错误：上传中断。当前进度：${W}%`):m.response?.status===413?(i.error("文件太大，超过服务器限制（最大 1000MB）"),M.value=0,S.value=""):i.error(`上传失败：${$}`),R&&(clearInterval(R),R=null),z.value=null,P.value=null,d.value=!1}},Y=async f=>{if(!f.uploaded_info){i.warning("请先上传文件");return}if(!(f._decrypting||f.status==="processing")&&!(f.status==="success"&&!await ye.confirm("已解密的文件已存在，是否重新解密？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{f._decrypting=!0;const m=f._password?.trim()||void 0,$=await us(f.task_id,m);$.code===0?(i.success($.data?.message||"解密任务已提交，正在后台处理"),f._password="",await O(f)):i.error($.msg||"提交解密任务失败")}catch(m){D(m,"提交解密任务失败")}finally{f._decrypting=!1}},O=async(f,m=30)=>{let $=0;const W=async()=>{if($>=m){i.warning("任务处理超时，请手动刷新查看状态"),await U();return}try{const se=await fs(f.task_id);if(se.code===0){const J=se.data;f.status=J.status,f.unlocked_info=J.unlocked_info,f.error_message=J.error_message,J.status==="success"?(i.success("文件解密成功"),f._decrypting=!1,await U()):J.status==="failed"?(i.error(J.error_message||"文件解密失败"),f._decrypting=!1):J.status==="processing"?($++,setTimeout(W,1e3)):f._decrypting=!1}}catch(se){D(se,"查询任务状态失败"),f._decrypting=!1}};W()},B=async(f,m)=>{const $=m==="uploaded"?f.uploaded_info:f.unlocked_info;if(!$){i.warning("文件不存在");return}try{const W=ds($.name,m);window.open(W,"_blank")}catch(W){D(W,"下载文件失败")}},Ce=async f=>{if(!f.uploaded_info){i.warning("请先上传文件");return}if(f.status==="processing"){i.warning("任务正在处理中，无法删除");return}if(await ye.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{d.value=!0;const $=await cs(f.task_id);$.code===0?(i.success($.data?.message||"任务删除成功"),await U()):i.error($.msg||"任务删除失败")}catch($){D($,"删除任务失败")}finally{d.value=!1}},pe=Vt,q=f=>f?new Date(f*1e3).toLocaleString():"-";return et(()=>{U()}),zt(()=>{R&&(clearInterval(R),R=null),z.value&&(z.value.abort(),z.value=null)}),(f,m)=>{const $=tt,W=It,se=Tt,J=at,me=qt,ee=st,Se=ct,De=Gt,de=Kt,he=Yt;return o(),v("div",Bs,[m[12]||(m[12]=t("h2",{class:"text-xl font-semibold mb-4"},"PDF 解密工具",-1)),t("div",As,[t("div",js,[t("div",zs,[t("div",null,[a($,{type:"success",size:"small",onClick:le,loading:d.value,disabled:!e.value},{default:n(()=>[...m[0]||(m[0]=[b(" 上传 ",-1)])]),_:1},8,["loading","disabled"])]),a(W,{"auto-upload":!1,"on-change":Q,"show-file-list":!1,accept:".pdf"},{trigger:n(()=>[a($,{type:"primary",size:"small",class:"!m-0"},{default:n(()=>[...m[1]||(m[1]=[b("选择文件",-1)])]),_:1})]),_:1}),t("div",Os,[t("div",Ns,[t("div",{class:Ye(["text-sm truncate flex-1 min-w-0",e.value?"text-gray-600":"text-gray-400"]),title:K.value||e.value?.name},k(K.value||e.value?.name||"未选择文件"),11,Is),S.value?(o(),v("div",Ks," 已用时间: "+k(S.value),1)):V("",!0)])])]),t("div",Ys,[a(se,{percentage:M.value,status:M.value===100?"success":void 0,class:"flex-1"},null,8,["percentage","status"]),a($,{type:"danger",size:"small",plain:"",onClick:te,disabled:!e.value},{default:n(()=>[...m[2]||(m[2]=[b(" 取消 ",-1)])]),_:1},8,["disabled"])])])]),a(de,{class:"flex-1 flex flex-col overflow-hidden",shadow:"hover"},{header:n(()=>[t("div",qs,[m[4]||(m[4]=t("span",null,"文件列表",-1)),a($,{type:"info",size:"small",plain:"",onClick:U,loading:d.value},{default:n(()=>[d.value?V("",!0):(o(),E(J,{key:0},{default:n(()=>[a(A(lt))]),_:1})),m[3]||(m[3]=b(" 刷新 ",-1))]),_:1},8,["loading"])])]),default:n(()=>[t("div",Gs,[Ot((o(),E(De,{data:C.value,stripe:"",class:"w-full"},{empty:n(()=>[...m[11]||(m[11]=[t("div",{class:"text-center text-gray-400 py-8"},"暂无文件，请上传 PDF 文件",-1)])]),default:n(()=>[a(me,{prop:"filename",label:"文件名","min-width":"200"},{default:n(({row:g})=>[g.uploaded_info?(o(),v("span",{key:0,class:"text-blue-600 cursor-pointer hover:underline",onClick:ae=>B(g,"uploaded"),title:g.uploaded_info.name},k(g.uploaded_info.name||g.name||g.filename||g.task_id),9,Hs)):(o(),v("span",Ws,"-"))]),_:1}),a(me,{label:"上传文件","min-width":"150"},{default:n(({row:g})=>[g.uploaded_info?(o(),v("div",Js,[t("span",Qs,k(A(pe)(g.uploaded_info.size)),1),t("span",Xs,k(q(g.uploaded_info.modified)),1)])):(o(),v("span",Zs,"-"))]),_:1}),a(me,{label:"已解密文件","min-width":"150"},{default:n(({row:g})=>[g.unlocked_info?(o(),v("div",el,[t("span",tl,k(A(pe)(g.unlocked_info.size)),1),t("span",sl,k(q(g.unlocked_info.modified)),1)])):(o(),v("span",ll,"未解密"))]),_:1}),a(me,{label:"状态",width:"140",align:"center"},{default:n(({row:g})=>[t("div",al,[g.status==="success"?(o(),E(ee,{key:0,type:"success",size:"small"},{default:n(()=>[...m[5]||(m[5]=[b("已解密",-1)])]),_:1})):g.status==="processing"?(o(),E(ee,{key:1,type:"warning",size:"small"},{default:n(()=>[...m[6]||(m[6]=[b("处理中",-1)])]),_:1})):g.status==="pending"?(o(),E(ee,{key:2,type:"info",size:"small"},{default:n(()=>[...m[7]||(m[7]=[b("等待中",-1)])]),_:1})):g.status==="failed"?(o(),E(ee,{key:3,type:"danger",size:"small"},{default:n(()=>[...m[8]||(m[8]=[b("失败",-1)])]),_:1})):(o(),E(ee,{key:4,type:"info",size:"small"},{default:n(()=>[...m[9]||(m[9]=[b("已上传",-1)])]),_:1})),g.unlocked_info?(o(),v("span",{key:5,class:"text-xs text-blue-600 cursor-pointer hover:underline",onClick:ae=>B(g,"unlocked")}," 下载 ",8,nl)):V("",!0),g.error_message?(o(),v("span",{key:6,class:"text-xs text-red-500",title:g.error_message}," 错误 ",8,ol)):V("",!0)])]),_:1}),a(me,{label:"操作",width:"280",fixed:"right"},{default:n(({row:g})=>[t("div",rl,[g.uploaded_info?(o(),E(Se,{key:0,modelValue:g._password,"onUpdate:modelValue":ae=>g._password=ae,type:"password",size:"small",placeholder:"密码（可选）","show-password":"",clearable:"",class:"w-30",disabled:g._decrypting||g.status==="processing",onKeyup:He(ae=>Y(g),["enter"])},null,8,["modelValue","onUpdate:modelValue","disabled","onKeyup"])):V("",!0),g.uploaded_info&&g.status!=="processing"?(o(),E($,{key:1,type:"primary",size:"small",onClick:ae=>Y(g),loading:g._decrypting,disabled:g._decrypting||g.status==="processing"},{default:n(()=>[b(k(g.status==="success"?"重新解密":"解密"),1)]),_:2},1032,["onClick","loading","disabled"])):V("",!0),g.uploaded_info?(o(),E($,{key:2,type:"danger",size:"small",plain:"",onClick:ae=>Ce(g),disabled:g.status==="processing"},{default:n(()=>[...m[10]||(m[10]=[b(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])):V("",!0)])]),_:1})]),_:1},8,["data"])),[[he,d.value]])])]),_:1})])}}}),ul={viewBox:"0 0 512 512",width:"1.2em",height:"1.2em"};function dl(qe,d){return o(),v("svg",ul,[...d[0]||(d[0]=[t("path",{fill:"none",stroke:"currentColor","stroke-linecap":"square","stroke-width":"48",d:"m136 208l120-104l120 104m-240 96l120 104l120-104"},null,-1)])])}const cl=Nt({name:"ion-chevron-expand-sharp",render:dl}),fl={class:"flex gap-4 h-[calc(100vh-220px)]"},vl={class:"w-64 border rounded p-3 flex flex-col"},pl={class:"flex items-center justify-between mb-3"},ml={class:"flex items-center gap-1"},gl={key:0,class:"flex-1 overflow-y-auto space-y-2 pr-1 min-h-[400px]"},_l=["onClick"],xl={class:"flex items-center justify-between gap-2"},yl={class:"text-sm font-medium truncate flex-1 min-w-0"},hl={class:"text-xs text-gray-500 whitespace-nowrap flex items-center gap-1 flex-shrink-0"},bl={class:"whitespace-nowrap w-5 flex items-center justify-center"},kl={class:"flex items-center justify-between gap-2 min-h-[20px]"},wl={class:"flex items-center gap-1 flex-shrink-0"},Tl={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},$l={key:0,class:"flex-1 border rounded p-3 flex flex-col max-w-2xl"},Cl={class:"flex items-center justify-between mb-3 flex-shrink-0"},Sl={class:"text-base font-semibold"},Dl={class:"text-sm text-gray-500"},Ml={class:"flex-1 overflow-auto flex flex-col gap-3"},Pl={class:"flex items-center justify-between gap-4 flex-shrink-0"},Vl={class:"flex items-center gap-4"},Fl={class:"text-red-500 text-xs truncate max-w-xs inline-block cursor-help"},Rl={class:"flex items-center gap-2"},Ul={class:"border rounded p-2 flex-1 flex flex-col overflow-hidden"},El={class:"flex items-center justify-between mb-2 flex-shrink-0"},Ll={class:"flex items-center gap-1 pr-1"},Bl={class:"flex-1 overflow-auto"},Al={key:0},jl=["draggable","onDragstart","onDrop"],zl={class:"text-xs text-gray-500 w-8"},Ol=["title"],Nl={key:0,class:"text-xs text-gray-500 whitespace-nowrap w-20 text-right"},Il={key:1,class:"w-20"},Kl={key:1,class:"text-sm text-gray-400 text-center py-1"},Yl={key:1,class:"flex-1 border rounded p-3 flex flex-col max-w-2xl"},ql=We({__name:"AudioMerge",setup(qe){const d=y(!1),C=y([]),e=y(null),K=y(!1),M=y(!1),S=y(!1),z=y(null),P=Rt({callbacks:{onPlay:()=>{i.success("开始播放")},onError:()=>{D(new Error("音频播放失败"),"播放失败"),ee()},onEnded:()=>{ee()}}}),R={size:"small",plain:!0,class:"!w-8 !h-6 !p-0"},U={size:"small",plain:!0,class:"!h-5 !text-xs !px-2"},Q={size:"small",plain:!0,class:"!h-7 !text-xs"},Z=["bg-gray-100","border-t-2","border-b-2","border-blue-500"],X=r=>{r&&r.classList.remove(...Z)},te=r=>{if(!r)return;r.querySelectorAll('[draggable="true"]').forEach(x=>X(x))},le=async r=>{if(e.value&&r.length!==0)try{d.value=!0;for(const c of r){const x=await vs(e.value.task_id,c);if(x.code!==0){i.error(`添加文件失败: ${x.msg||"未知错误"}`);break}}i.success(`成功添加 ${r.length} 个文件`),await B(e.value.task_id)}catch(c){D(c,"添加文件失败")}finally{d.value=!1}},Y=async()=>{try{d.value=!0;const r=await ps();r.code===0?(C.value=r.data.tasks||[],C.value.length>0&&!e.value&&await B(C.value[0].task_id)):i.error(r.msg||"获取任务列表失败")}catch(r){D(r,"获取任务列表失败")}finally{d.value=!1}},O=async()=>{try{d.value=!0;const r=await ms();r.code===0?(i.success("任务创建成功"),await Y(),B(r.data.task_id)):i.error(r.msg||"创建任务失败")}catch(r){D(r,"创建任务失败")}finally{d.value=!1}},B=async r=>{e.value&&e.value.task_id!==r&&he();try{d.value=!0;const c=await gs(r);c.code===0?e.value=c.data:i.error(c.msg||"获取任务信息失败")}catch(c){D(c,"获取任务信息失败")}finally{d.value=!1}},Ce=async r=>{if(await ye.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{d.value=!0;const x=await hs(r);x.code===0?(i.success("任务删除成功"),await Y(),e.value&&e.value.task_id===r&&(C.value&&C.value.length>0?await B(C.value[0].task_id):e.value=null)):i.error(x.msg||"删除任务失败")}catch(x){D(x,"删除任务失败")}finally{d.value=!1}},pe=()=>{if(!e.value){i.warning("请先创建或选择任务");return}K.value=!0},q=async r=>{if(!(!e.value||!await ye.confirm("确定要删除该文件吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{d.value=!0;const x=await bs(e.value.task_id,r);x.code===0?(P.playingFileIndex.value===r?he():P.playingFileIndex.value!==null&&P.playingFileIndex.value>r&&(P.playingFileIndex.value=P.playingFileIndex.value-1),i.success("文件删除成功"),await B(e.value.task_id)):i.error(x.msg||"删除文件失败")}catch(x){D(x,"删除文件失败")}finally{d.value=!1}},f=async()=>{if(!(!e.value||!await ye.confirm(`确定要开始合成吗？将合并 ${Pe.value} 个音频文件。`,"确认合成",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{d.value=!0;const c=await _s(e.value.task_id);c.code===0?(i.success("合成任务已启动"),await Y(),await B(e.value.task_id),W()):i.error(c.msg||"启动任务失败")}catch(c){D(c,"启动任务失败")}finally{d.value=!1}},{start:m,stop:$}=mt(async()=>{if(!e.value||e.value.status!=="processing"){$();return}await Y(),await B(e.value.task_id)},Ft,{immediate:!1}),W=()=>{m()},se=r=>{if(!r)return;const c=ks(r);window.open(c,"_blank")},J=()=>{e.value?.result_file&&se(e.value.task_id)},me=r=>{r?.result_file&&se(r.task_id)},ee=()=>{P.clear()},Se=(r,c)=>{if(!r)return;const x=r?.path||r?.name||"";P.seekFile(x,c)},De=(r,c)=>{e.value?.result_file&&Se({path:e.value.result_file},c)},de=r=>{if(!e.value||!e.value.files||r<0||r>=e.value.files.length)return;const c=e.value.files[r],x=c.path||c.name||"";if(!x){i.warning("文件路径不存在");return}if(P.playingFilePath.value===x&&P.audio&&!P.audio.paused){ee(),i.info("已停止播放");return}const I=rt(x);if(!I){i.error("无法生成媒体文件URL");return}P.load(I,{playingFilePath:x,playingFileIndex:r}),P.play().catch(oe=>{D(oe,"播放失败"),ee()})},he=()=>{ee()},g=()=>{if(!e.value||!e.value.result_file){i.warning("结果文件不存在");return}const r=e.value.result_file;if(P.playingFilePath.value===r&&P.audio&&!P.audio.paused){ee(),i.info("已停止播放");return}const c=rt(r);if(!c){i.error("无法生成媒体文件URL");return}P.load(c,{playingFilePath:r}),P.play().catch(x=>{D(x,"播放失败"),ee()})},ae=()=>{if(!e.value||!e.value.result_file){i.warning("结果文件不存在");return}M.value=!0},Oe=async r=>{if(!e.value||!e.value.result_file)return;if(r.length===0){i.warning("请选择转存目录");return}const c=r[0];try{d.value=!0;const x=await xs(e.value.task_id,c);x.code===0?(i.success("转存成功"),M.value=!1):i.error(x.msg||"转存失败")}catch(x){D(x,"转存失败")}finally{d.value=!1}},Me=Vt,Ne={pending:{tag:"info",text:"等待中"},processing:{tag:"warning",text:"处理中"},success:{tag:"success",text:"成功"},failed:{tag:"danger",text:"失败"}},be=r=>Ne[r]?.tag||"info",ge=r=>Ne[r]?.text||"未知",ke=G(()=>e.value?.status==="processing"),ne=G(()=>(e.value?.files||[]).length>0),Pe=G(()=>(e.value?.files||[]).length),Ve=G(()=>e.value?.result_file),we=G(()=>!Ve.value||e.value?.status!=="success"||S.value),p=G(()=>!ne.value||ke.value||S.value),u=G(()=>ke.value||S.value),F=G(()=>!e.value||!ne.value||ke.value),j=G(()=>S.value?"点击退出拖拽排序模式":"点击进入拖拽排序模式"),Fe=G(()=>({path:Ve.value||""})),Re=(r,c)=>!r||!c||r.length!==c.length?!0:r.some((x,I)=>{const oe=x?.path||x?.name,Ue=c[I]?.path||c[I]?.name;return oe!==Ue}),ce=async()=>{if(S.value){if(e.value&&e.value.files&&e.value.files.length>0){if(Re(z.value||[],e.value.files))try{d.value=!0;const c=e.value.files.map((I,oe)=>oe),x=await ys(e.value.task_id,c);x.code===0?(i.success("排序已保存"),await B(e.value.task_id)):i.error(x.msg||"保存排序失败")}catch(c){D(c,"保存排序失败")}finally{d.value=!1}z.value=null}}else e.value&&e.value.files&&e.value.files.length>0&&(z.value=[...e.value.files||[]]);S.value=!S.value},Ae=(r,c)=>{if(!S.value)return r.preventDefault(),!1;try{r.dataTransfer&&(r.dataTransfer.effectAllowed="move",r.dataTransfer.setData("text/plain",c.toString()))}catch(x){console.error("拖拽开始失败:",x)}},Ge=r=>{r.currentTarget&&X(r.currentTarget)},Ie=r=>{r.currentTarget&&X(r.currentTarget)},Ke=r=>{if(S.value&&(r.preventDefault(),r.dataTransfer&&(r.dataTransfer.dropEffect="move"),r.currentTarget)){const c=r.currentTarget.getBoundingClientRect(),x=r.clientY,I=c.top+c.height/2;X(r.currentTarget),x<I?r.currentTarget.classList.add("border-t-2","border-blue-500"):r.currentTarget.classList.add("border-b-2","border-blue-500")}},je=(r,c)=>{if(!S.value||(r.preventDefault(),r.currentTarget&&(X(r.currentTarget),te(r.currentTarget.parentElement)),!r.dataTransfer))return;const x=parseInt(r.dataTransfer.getData("text/plain"),10);if(x===c||isNaN(x)||!e.value||!e.value.files||x<0||x>=e.value.files.length||c<0||c>=e.value.files.length)return;const I=r.currentTarget?.getBoundingClientRect(),oe=r.clientY,Ue=I?I.top+I.height/2:0,ze=oe<Ue?c:c+1,L=[...e.value.files||[]],[re]=L.splice(x,1),fe=x<ze?ze-1:ze;L.splice(fe,0,re),e.value={...e.value,files:L}},h=()=>{K.value=!1};return et(()=>{Y()}),dt(()=>{he(),$()}),(r,c)=>{const x=at,I=tt,oe=st,Ue=pt,ze=cl;return o(),v("div",fl,[t("div",vl,[t("div",pl,[c[7]||(c[7]=t("h3",{class:"text-base font-semibold"},"任务列表",-1)),t("div",ml,[a(I,H({type:"info"},R,{onClick:Y,loading:d.value}),{default:n(()=>[d.value?V("",!0):(o(),E(x,{key:0},{default:n(()=>[a(A(lt))]),_:1}))]),_:1},16,["loading"]),a(I,H({type:"success"},R,{onClick:O,loading:d.value}),{default:n(()=>[a(x,null,{default:n(()=>[a(A(ft))]),_:1})]),_:1},16,["loading"])])]),C.value&&C.value.length>0?(o(),v("div",gl,[(o(!0),v($e,null,Be(C.value,L=>(o(),v("div",{key:L.task_id,class:Ye(["border rounded px-3 py-2 cursor-pointer hover:bg-gray-50 group min-h-[60px] flex flex-col justify-between",{"border-blue-500 bg-blue-50":e.value&&L.task_id===e.value.task_id}]),onClick:re=>B(L.task_id)},[t("div",xl,[t("div",yl,k(L.name),1),t("span",hl,[a(x,null,{default:n(()=>[a(A(Ht),{class:"!w-3 !h-3"})]),_:1}),t("span",bl,k(L.files?L.files.length:0),1)])]),t("div",kl,[a(oe,{type:be(L.status),size:"small",class:"!h-5 !text-xs w-16 text-center"},{default:n(()=>[b(k(ge(L.status)),1)]),_:2},1032,["type"]),t("div",wl,[L.status==="success"&&L.result_file?(o(),E(I,H({key:0,type:"primary"},{ref_for:!0},U,{onClick:xe(re=>me(L),["stop"])}),{default:n(()=>[...c[8]||(c[8]=[b(" 下载 ",-1)])]),_:1},16,["onClick"])):V("",!0),a(I,H({type:"danger"},{ref_for:!0},U,{onClick:xe(re=>Ce(L.task_id),["stop"]),disabled:L.status==="processing"}),{default:n(()=>[a(x,null,{default:n(()=>[a(A(vt))]),_:1})]),_:1},16,["onClick","disabled"])])])],10,_l))),128))])):(o(),v("div",Tl,' 暂无任务，请点击"新建"创建 '))]),e.value?(o(),v("div",$l,[t("div",Cl,[t("h3",Sl,"任务详情: "+k(e.value.name),1),t("span",Dl," 共 "+k(Pe.value)+" 个文件 ",1)]),t("div",Ml,[t("div",Pl,[t("div",Vl,[a(oe,{type:be(e.value.status),size:"small",class:"w-16 text-center"},{default:n(()=>[b(k(ge(e.value.status)),1)]),_:1},8,["type"]),Ve.value?(o(),E(it,{key:0,file:Fe.value,player:A(P),disabled:S.value,onPlay:g,onSeek:De},null,8,["file","player","disabled"])):V("",!0),a(I,H({type:"primary"},Q,{onClick:J,disabled:we.value}),{default:n(()=>[...c[9]||(c[9]=[b(" 下载 ",-1)])]),_:1},16,["disabled"]),a(I,H({type:"success"},Q,{onClick:ae,disabled:we.value}),{default:n(()=>[...c[10]||(c[10]=[b(" 转存 ",-1)])]),_:1},16,["disabled"]),e.value.error_message?(o(),E(Ue,{key:1,content:`错误: ${e.value.error_message}`,placement:"top"},{default:n(()=>[t("span",Fl," 错误: "+k(e.value.error_message),1)]),_:1},8,["content"])):V("",!0)]),t("div",Rl,[a(I,H({type:"success"},Q,{onClick:f,disabled:p.value,loading:ke.value}),{default:n(()=>[...c[11]||(c[11]=[b(" 开始合成 ",-1)])]),_:1},16,["disabled","loading"])])]),t("div",Ul,[t("div",El,[c[13]||(c[13]=t("h4",{class:"text-sm font-semibold"},"文件列表",-1)),t("div",Ll,[a(I,H({type:"primary"},U,{disabled:u.value,onClick:pe}),{default:n(()=>[...c[12]||(c[12]=[b(" + ",-1)])]),_:1},16,["disabled"]),a(I,H({type:S.value?"success":"default"},R,{onClick:ce,disabled:F.value,title:j.value}),{default:n(()=>[S.value?(o(),E(x,{key:0},{default:n(()=>[a(A($t))]),_:1})):(o(),E(ze,{key:1,class:"!w-3.5 !h-3.5"}))]),_:1},16,["type","disabled","title"])])]),t("div",Bl,[ne.value?(o(),v("div",Al,[(o(!0),v($e,null,Be(e.value.files,(L,re)=>(o(),v("div",{key:re,class:Ye(["flex items-center gap-2 p-1 hover:bg-gray-100 rounded",{"cursor-move":S.value,"cursor-default":!S.value,"select-none":!0}]),draggable:S.value,onDragstart:fe=>Ae(fe,Number(re)),onDragend:c[2]||(c[2]=fe=>Ge(fe)),onDragover:c[3]||(c[3]=xe(fe=>Ke(fe),["prevent"])),onDragleave:Ie,onDrop:xe(fe=>je(fe,Number(re)),["prevent"])},[t("span",zl,k(Number(re)+1),1),t("span",{class:"flex-1 text-sm truncate",title:L.path||L.name},k(L.name),9,Ol),L.size?(o(),v("span",Nl,k(A(Me)(L.size)),1)):(o(),v("div",Il)),t("div",{class:"flex items-center gap-1 flex-shrink-0",onMousedown:c[0]||(c[0]=xe(()=>{},["stop"])),onClick:c[1]||(c[1]=xe(()=>{},["stop"]))},[a(it,{file:L,player:A(P),disabled:u.value,onPlay:()=>de(Number(re)),onSeek:Se},null,8,["file","player","disabled","onPlay"]),a(I,{type:"info",size:"small",plain:"",circle:"",onClick:xe(fe=>q(Number(re)),["stop"]),disabled:u.value,class:"!h-6 !text-xs"},{default:n(()=>[a(x,null,{default:n(()=>[a(A(Wt))]),_:1})]),_:1},8,["onClick","disabled"])],32)],42,jl))),128))])):(o(),v("div",Kl,"文件列表为空"))])])])])):(o(),v("div",Yl,[...c[14]||(c[14]=[t("div",{class:"flex items-center justify-between mb-3 flex-shrink-0"},[t("h3",{class:"text-base font-semibold"},"任务详情")],-1),t("div",{class:"flex-1 flex items-center justify-center text-sm text-gray-400"}," 请从左侧选择一个任务查看详情 ",-1)])])),a(ut,{visible:K.value,"onUpdate:visible":c[4]||(c[4]=L=>K.value=L),title:"选择文件添加到任务","confirm-button-text":"添加","confirm-loading":d.value,onConfirm:le,onClose:h},null,8,["visible","confirm-loading"]),a(ut,{visible:M.value,"onUpdate:visible":c[5]||(c[5]=L=>M.value=L),title:"选择转存目录","confirm-button-text":"转存",mode:"directory","confirm-loading":d.value,onConfirm:Oe,onClose:c[6]||(c[6]=L=>M.value=!1)},null,8,["visible","confirm-loading"])])}}}),Gl={class:"flex gap-4 h-[calc(100vh-220px)]"},Hl={class:"w-64 border rounded p-3 flex flex-col"},Wl={class:"flex items-center justify-between mb-3"},Jl={class:"flex items-center gap-1"},Ql={key:0,class:"flex-1 overflow-y-auto space-y-2 pr-1 min-h-[400px]"},Xl=["onClick"],Zl={class:"flex items-center justify-between gap-2"},ea=["title"],ta={class:"flex items-center justify-between gap-2 min-h-[20px]"},sa={class:"flex items-center gap-1 flex-shrink-0"},la={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400 min-h-[400px]"},aa={key:0,class:"flex-1 border rounded p-3 flex flex-col min-h-0"},na={class:"flex items-center justify-between mb-3 flex-shrink-0"},oa={class:"flex items-center gap-2 flex-1"},ra={class:"text-base font-semibold"},ia={class:"flex-1 flex flex-col gap-3 min-h-0"},ua={class:"flex items-center gap-4 flex-shrink-0"},da={class:"text-red-500 text-xs truncate block max-w-md cursor-help"},ca={class:"border rounded p-3 flex flex-col gap-2"},fa={class:"flex items-center justify-between"},va={class:"flex items-center gap-2"},pa={key:0,class:"text-xs text-gray-500"},ma={key:0,class:"text-sm text-gray-600"},ga=["title"],_a={key:1,class:"text-sm text-gray-400"},xa={class:"border rounded p-3 flex flex-col gap-2 flex-1 min-h-0 overflow-hidden"},ya={key:0,class:"flex-1 overflow-y-scroll scrollbar-overlay space-y-1 min-h-0"},ha={class:"flex-1 min-w-0 flex items-center gap-3 text-sm"},ba=["title"],ka={class:"flex items-center gap-2 text-xs text-gray-500 flex-shrink-0"},wa={key:0},Ta={key:1},$a=["title"],Ca={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400 min-h-0"},Sa={key:1,class:"flex-1 border rounded p-3 flex flex-col"},Da={key:2,class:"w-80 border rounded p-3 flex flex-col"},Ma={class:"flex-1 overflow-auto flex flex-col gap-3"},Pa={class:"border rounded p-3 flex flex-col gap-2"},Va={class:"flex items-center gap-2"},Fa={class:"border rounded p-3 flex flex-col gap-2"},Ra={class:"flex items-center gap-2"},Ua={class:"text-xs text-gray-400 flex items-center gap-1"},Ea={key:0,class:"border rounded p-3 flex flex-col gap-2"},La={key:0,class:"space-y-2"},Ba={class:"text-sm text-gray-600"},Aa=["title"],ja={key:1,class:"text-sm text-gray-400"},za={key:1,class:"border rounded p-3 flex flex-col gap-2"},Oa={class:"text-sm text-gray-600"},Na={key:0,class:"mt-2"},Ia={key:3,class:"w-80 border rounded p-3 flex flex-col"},Ka=We({__name:"AudioConvert",setup(qe){const d=y(!1),C=y([]),e=y(null),K=y(!1),M=y("mp3"),S=y(!1),z=y(!0),P=y(!1),R=y(!1),U=y(""),Q=y(!1),Z=y(""),X={size:"small",plain:!0,class:"!w-8 !h-6 !p-0"},te={size:"small",plain:!0,class:"!h-5 !text-xs !px-2"},le={size:"small",plain:!0,class:"!h-7 !text-xs"},Y=async()=>{try{d.value=!0;const p=await ws();p.code===0?(C.value=p.data.tasks||[],C.value.length>0&&!e.value&&await q(C.value[0].task_id)):i.error(p.msg||"获取任务列表失败")}catch(p){D(p,"获取任务列表失败")}finally{d.value=!1}},O=()=>{const p=new Date,u=p.getFullYear(),F=String(p.getMonth()+1).padStart(2,"0"),j=String(p.getDate()).padStart(2,"0"),Fe=String(p.getHours()).padStart(2,"0"),Re=String(p.getMinutes()).padStart(2,"0"),ce=String(p.getSeconds()).padStart(2,"0");U.value=`${u}-${F}-${j} ${Fe}:${Re}:${ce}`,R.value=!0},B=async()=>{if(!U.value.trim()){i.warning("请输入任务名称");return}try{d.value=!0;const p=await Ts({name:U.value.trim()});p.code===0?(i.success("任务创建成功"),R.value=!1,U.value="",await Y(),q(p.data.task_id)):i.error(p.msg||"创建任务失败")}catch(p){D(p,"创建任务失败")}finally{d.value=!1}},Ce=()=>{e.value&&(Z.value=e.value.name,Q.value=!0)},pe=async()=>{if(e.value){if(!Z.value.trim()){i.warning("请输入任务名称");return}try{d.value=!0;const p=await Qe(e.value.task_id,{name:Z.value.trim()});p.code===0?(i.success("任务名称修改成功"),Q.value=!1,Z.value="",await q(e.value.task_id)):i.error(p.msg||"修改任务名称失败")}catch(p){D(p,"修改任务名称失败")}finally{d.value=!1}}},q=async p=>{try{d.value=!0;const u=await $s(p);if(u.code===0){e.value=u.data;const F=C.value.findIndex(j=>j.task_id===p);F!==-1&&(C.value[F]={...u.data}),M.value=u.data.output_dir||"mp3",S.value=!1,z.value=u.data.overwrite!==!1,P.value=!1}else i.error(u.msg||"获取任务信息失败")}catch(u){D(u,"获取任务信息失败")}finally{d.value=!1}},f=async p=>{if(await ye.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{d.value=!0;const F=await Ds(p);F.code===0?(i.success("任务删除成功"),await Y(),e.value&&e.value.task_id===p&&(C.value&&C.value.length>0?await q(C.value[0].task_id):e.value=null)):i.error(F.msg||"删除任务失败")}catch(F){D(F,"删除任务失败")}finally{d.value=!1}},m=()=>{if(!e.value){i.warning("请先创建或选择任务");return}K.value=!0},$=async p=>{if(!e.value||p.length===0)return;const u=p[0];try{d.value=!0;const F=await Qe(e.value.task_id,{directory:u});F.code===0?(i.success("目录设置成功"),await q(e.value.task_id),K.value=!1):i.error(F.msg||"设置目录失败")}catch(F){D(F,"设置目录失败")}finally{d.value=!1}},W=()=>{K.value=!1},se=()=>{if(!e.value)return;const p=e.value.output_dir||"mp3";S.value=M.value!==p},J=async()=>{if(e.value){if(!M.value.trim()){i.error("输出目录名称不能为空");return}try{d.value=!0;const p=await Qe(e.value.task_id,{output_dir:M.value.trim()});p.code===0?(i.success("输出目录名称保存成功"),await q(e.value.task_id)):i.error(p.msg||"保存输出目录名称失败")}catch(p){D(p,"保存输出目录名称失败")}finally{d.value=!1}}},me=()=>{if(!e.value)return;const p=e.value.overwrite!==!1;P.value=z.value!==p,P.value&&ee()},ee=async()=>{if(e.value)try{d.value=!0;const p=await Qe(e.value.task_id,{overwrite:z.value});p.code===0?(i.success("覆盖选项保存成功"),await q(e.value.task_id)):i.error(p.msg||"保存覆盖选项失败")}catch(p){D(p,"保存覆盖选项失败")}finally{d.value=!1}},Se=async()=>{if(!e.value)return;if(!e.value.directory){i.warning("请先选择转码目录");return}if(await ye.confirm(`确定要开始转码吗？将转换 "${e.value.name}" 。`,"确认转码",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{d.value=!0;const u=await Cs(e.value.task_id);u.code===0?(i.success("转码任务已启动"),await Y(),await q(e.value.task_id),he()):i.error(u.msg||"启动任务失败")}catch(u){D(u,"启动任务失败")}finally{d.value=!1}},{start:De,stop:de}=mt(async()=>{if(!e.value){de();return}if(await Y(),e.value.status!=="processing"){await q(e.value.task_id),de();return}await q(e.value.task_id)},Ss,{immediate:!1}),he=()=>{De()},g={pending:{tag:"info",text:"等待中"},processing:{tag:"warning",text:"处理中"},success:{tag:"success",text:"成功"},failed:{tag:"danger",text:"失败"}},ae=p=>g[p]?.tag||"info",Oe=p=>g[p]?.text||"未知",Me=G(()=>e.value?.status==="processing"),Ne=G(()=>!e.value?.directory||Me.value),be=G(()=>Me.value),ge=G(()=>e.value?.file_status?Object.keys(e.value.file_status).map(p=>{const u=e.value.file_status[p];return{path:p,status:u.status||"pending",error:u.error,size:u.size,duration:u.duration}}):[]),ke=p=>p.path.split("/").pop()||p.path,ne=p=>p.status,Pe=p=>p.error,Ve=p=>{if(!p)return"";const u=["B","KB","MB","GB"];let F=p,j=0;for(;F>=1024&&j<u.length-1;)F/=1024,j++;return`${F.toFixed(1)} ${u[j]}`},we=p=>{if(!p)return"";const u=Math.floor(p/3600),F=Math.floor(p%3600/60),j=p%60;return u>0?`${u}:${F.toString().padStart(2,"0")}:${j.toString().padStart(2,"0")}`:`${F}:${j.toString().padStart(2,"0")}`};return et(()=>{Y()}),dt(()=>{de()}),(p,u)=>{const F=at,j=tt,Fe=st,Re=pt,ce=Xt,Ae=ct,Ge=Tt,Ie=Pt,Ke=Mt,je=Dt;return o(),v("div",Gl,[t("div",Hl,[t("div",Wl,[u[11]||(u[11]=t("h3",{class:"text-base font-semibold"},"任务列表",-1)),t("div",Jl,[a(j,H({type:"info"},X,{onClick:Y,loading:d.value}),{default:n(()=>[d.value?V("",!0):(o(),E(F,{key:0},{default:n(()=>[a(A(lt))]),_:1}))]),_:1},16,["loading"]),a(j,H({type:"success"},X,{onClick:O,loading:d.value}),{default:n(()=>[d.value?V("",!0):(o(),E(F,{key:0},{default:n(()=>[a(A(ft))]),_:1}))]),_:1},16,["loading"])])]),C.value&&C.value.length>0?(o(),v("div",Ql,[(o(!0),v($e,null,Be(C.value,h=>(o(),v("div",{key:h.task_id,class:Ye(["border rounded px-3 py-2 cursor-pointer hover:bg-gray-50 group min-h-[60px] flex flex-col justify-between",{"border-blue-500 bg-blue-50":e.value&&h.task_id===e.value.task_id}]),onClick:r=>q(h.task_id)},[t("div",Zl,[t("div",{class:"text-sm font-medium truncate flex-1 min-w-0",title:h.name},k(h.name),9,ea)]),t("div",ta,[a(Fe,{type:ae(h.status),size:"small",class:"!h-5 !text-xs w-16 text-center"},{default:n(()=>[b(k(Oe(h.status)),1)]),_:2},1032,["type"]),t("div",sa,[a(j,H({type:"danger"},{ref_for:!0},te,{onClick:xe(r=>f(h.task_id),["stop"]),disabled:h.status==="processing"}),{default:n(()=>[a(F,null,{default:n(()=>[a(A(vt))]),_:1})]),_:1},16,["onClick","disabled"])])])],10,Xl))),128))])):(o(),v("div",la,' 暂无任务，请点击"新建"创建 '))]),e.value?(o(),v("div",aa,[t("div",na,[t("div",oa,[t("h3",ra,"文件列表: "+k(e.value.name),1),a(j,{type:"default",size:"small",plain:"",circle:"",disabled:be.value,onClick:Ce,title:"编辑名称"},{default:n(()=>[a(F,null,{default:n(()=>[a(A(Ct))]),_:1})]),_:1},8,["disabled"])])]),t("div",ia,[t("div",ua,[a(Fe,{type:ae(e.value.status),size:"small",class:"w-16 text-center flex-shrink-0"},{default:n(()=>[b(k(Oe(e.value.status)),1)]),_:1},8,["type"]),e.value.error_message?(o(),E(Re,{key:0,content:`错误: ${e.value.error_message}`,placement:"top",class:"flex-1 min-w-0 max-w-md"},{default:n(()=>[t("span",da," 错误: "+k(e.value.error_message),1)]),_:1},8,["content"])):V("",!0)]),t("div",ca,[t("div",fa,[t("div",va,[u[12]||(u[12]=t("h4",{class:"text-sm font-semibold"},"转码目录",-1)),e.value.total_files!==null&&e.value.total_files!==void 0?(o(),v("span",pa," 可处理文件数: "+k(e.value.total_files),1)):V("",!0)]),a(j,H({type:"primary"},te,{disabled:be.value,onClick:m}),{default:n(()=>[...u[13]||(u[13]=[b(" 选择目录 ",-1)])]),_:1},16,["disabled"])]),e.value.directory?(o(),v("div",ma,[t("div",{class:"truncate",title:e.value.directory},k(e.value.directory),9,ga)])):(o(),v("div",_a," 请选择一个目录，该目录下的所有媒体文件将被转换为 MP3 格式 "))]),t("div",xa,[u[14]||(u[14]=t("h4",{class:"text-sm font-semibold flex-shrink-0"},"文件列表",-1)),ge.value&&ge.value.length>0?(o(),v("div",ya,[(o(!0),v($e,null,Be(ge.value,(h,r)=>(o(),v("div",{key:r,class:"flex items-center gap-2 p-2 rounded hover:bg-gray-50 border-b border-gray-100"},[a(F,{class:Ye(["flex-shrink-0",{"text-green-500":ne(h)==="success","text-red-500":ne(h)==="failed","text-yellow-500":ne(h)==="processing","text-gray-400":ne(h)==="pending"}])},{default:n(()=>[ne(h)==="success"?(o(),E(A($t),{key:0})):ne(h)==="failed"?(o(),E(A(St),{key:1})):ne(h)==="processing"?(o(),E(A(Jt),{key:2})):(o(),E(A(Qt),{key:3}))]),_:2},1032,["class"]),t("div",ha,[t("div",{class:"flex-1 min-w-0 truncate",title:h.path},k(ke(h)),9,ba),t("div",ka,[h.size?(o(),v("span",wa,k(Ve(h.size)),1)):V("",!0),h.duration?(o(),v("span",Ta,k(we(h.duration)),1)):V("",!0)]),Pe(h)?(o(),v("div",{key:0,class:"text-xs text-red-500 truncate max-w-xs",title:Pe(h)},k(Pe(h)),9,$a)):V("",!0)])]))),128))])):(o(),v("div",Ca," 暂无文件，请先选择转码目录 "))])])])):(o(),v("div",Sa,[...u[15]||(u[15]=[t("div",{class:"flex items-center justify-between mb-3 flex-shrink-0"},[t("h3",{class:"text-base font-semibold"},"文件列表")],-1),t("div",{class:"flex-1 flex items-center justify-center text-sm text-gray-400"}," 请从左侧选择一个任务查看文件列表 ",-1)])])),e.value?(o(),v("div",Da,[u[24]||(u[24]=t("div",{class:"flex items-center justify-between mb-3"},[t("h3",{class:"text-base font-semibold"},"输出信息")],-1)),t("div",Ma,[t("div",Pa,[t("div",Va,[u[16]||(u[16]=t("span",{class:"text-sm text-gray-600"},"覆盖同名文件",-1)),a(ce,{modelValue:z.value,"onUpdate:modelValue":u[0]||(u[0]=h=>z.value=h),disabled:be.value,onChange:me},null,8,["modelValue","disabled"])]),a(j,H({type:"success"},le,{onClick:Se,disabled:Ne.value,loading:Me.value,class:"w-full"}),{default:n(()=>[...u[17]||(u[17]=[b(" 开始转码 ",-1)])]),_:1},16,["disabled","loading"])]),t("div",Fa,[u[20]||(u[20]=t("div",{class:"flex items-center justify-between"},[t("h4",{class:"text-sm font-semibold"},"输出目录名称")],-1)),t("div",Ra,[a(Ae,{modelValue:M.value,"onUpdate:modelValue":u[1]||(u[1]=h=>M.value=h),placeholder:"输出目录名称",size:"small",disabled:be.value,onBlur:se},null,8,["modelValue","disabled"]),a(j,H({type:"primary"},te,{disabled:be.value||!S.value,onClick:J}),{default:n(()=>[...u[18]||(u[18]=[b(" 保存 ",-1)])]),_:1},16,["disabled"])]),t("div",Ua,[u[19]||(u[19]=t("span",null,"文件将保存在转码目录下的此文件夹中",-1)),e.value?.directory&&e.value?.output_dir?(o(),E(Re,{key:0,content:`${e.value.directory}/${e.value.output_dir}`,placement:"top"},{default:n(()=>[a(F,{class:"cursor-help text-gray-400 hover:text-gray-600"},{default:n(()=>[a(A(Zt))]),_:1})]),_:1},8,["content"])):V("",!0)])]),e.value.status==="processing"||e.value.progress?(o(),v("div",Ea,[u[21]||(u[21]=t("h4",{class:"text-sm font-semibold"},"转码进度",-1)),e.value.progress?(o(),v("div",La,[t("div",Ba," 已处理: "+k(e.value.progress.processed??0)+" / "+k(e.value.total_files??e.value.progress.total??0),1),a(Ge,{percentage:(e.value.total_files??e.value.progress.total??0)>0?Math.round((e.value.progress.processed??0)/(e.value.total_files??e.value.progress.total??1)*100):0,status:e.value.status==="processing"?void 0:"success"},null,8,["percentage","status"]),e.value.progress.current_file?(o(),v("div",{key:0,class:"text-xs text-gray-500 truncate",title:e.value.progress.current_file}," 正在处理: "+k(e.value.progress.current_file),9,Aa)):V("",!0)])):(o(),v("div",ja,"等待开始转码..."))])):V("",!0),e.value.status==="success"?(o(),v("div",za,[u[23]||(u[23]=t("h4",{class:"text-sm font-semibold"},"转码结果",-1)),t("div",Oa,[u[22]||(u[22]=t("div",null,"转码完成！所有文件已保存到输出目录",-1)),e.value.progress?(o(),v("div",Na," 共转换 "+k(e.value.total_files??e.value.progress.total??0)+" 个文件 ",1)):V("",!0)])])):V("",!0)])])):(o(),v("div",Ia,[...u[25]||(u[25]=[t("h3",{class:"text-base font-semibold mb-3"},"输出信息",-1),t("div",{class:"flex-1 flex items-center justify-center text-sm text-gray-400"}," 请从左侧选择一个任务查看输出信息 ",-1)])])),a(ut,{visible:K.value,"onUpdate:visible":u[2]||(u[2]=h=>K.value=h),title:"选择转码目录","confirm-button-text":"确定",mode:"directory","default-path":e.value?.directory||void 0,"confirm-loading":d.value,onConfirm:$,onClose:W},null,8,["visible","default-path","confirm-loading"]),a(je,{modelValue:R.value,"onUpdate:modelValue":u[5]||(u[5]=h=>R.value=h),title:"创建转码任务",width:"400px",onClose:u[6]||(u[6]=h=>U.value="")},{footer:n(()=>[a(j,{onClick:u[4]||(u[4]=h=>R.value=!1)},{default:n(()=>[...u[26]||(u[26]=[b("取消",-1)])]),_:1}),a(j,{type:"primary",onClick:B,loading:d.value},{default:n(()=>[...u[27]||(u[27]=[b(" 确定 ",-1)])]),_:1},8,["loading"])]),default:n(()=>[a(Ke,null,{default:n(()=>[a(Ie,{label:"任务名称"},{default:n(()=>[a(Ae,{modelValue:U.value,"onUpdate:modelValue":u[3]||(u[3]=h=>U.value=h),placeholder:"请输入任务名称",onKeyup:He(B,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(je,{modelValue:Q.value,"onUpdate:modelValue":u[9]||(u[9]=h=>Q.value=h),title:"重命名任务",width:"400px",onClose:u[10]||(u[10]=h=>Z.value="")},{footer:n(()=>[a(j,{onClick:u[8]||(u[8]=h=>Q.value=!1)},{default:n(()=>[...u[28]||(u[28]=[b("取消",-1)])]),_:1}),a(j,{type:"primary",onClick:pe,loading:d.value},{default:n(()=>[...u[29]||(u[29]=[b(" 确定 ",-1)])]),_:1},8,["loading"])]),default:n(()=>[a(Ke,null,{default:n(()=>[a(Ie,{label:"任务名称"},{default:n(()=>[a(Ae,{modelValue:Z.value,"onUpdate:modelValue":u[7]||(u[7]=h=>Z.value=h),placeholder:"请输入任务名称",onKeyup:He(pe,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),Ya={class:"flex gap-4 h-[calc(100vh-220px)]"},qa={class:"w-64 border rounded p-3 flex flex-col"},Ga={class:"flex items-center justify-between mb-3"},Ha={class:"flex items-center gap-1"},Wa={key:0,class:"flex-1 overflow-y-auto space-y-2 pr-1 min-h-[400px]"},Ja=["onClick"],Qa={class:"flex items-center justify-between gap-2"},Xa=["title"],Za={key:0,class:"text-xs text-gray-500 flex-shrink-0"},en={class:"flex items-center justify-between gap-2 min-h-[20px]"},tn={class:"flex items-center justify-end gap-0 flex-shrink-0 w-23"},sn={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},ln={key:0,class:"flex-1 border rounded p-3 flex flex-col min-h-0"},an={class:"flex items-center mb-3 flex-shrink-0"},nn={class:"flex items-center gap-2 flex-1"},on={class:"text-base font-semibold"},rn={class:"flex-1 flex flex-col gap-3 min-h-0"},un={class:"flex items-center gap-4 flex-shrink-0 flex-wrap"},dn={key:1,class:"text-xs text-gray-600 ml-auto"},cn={class:"text-red-500 text-xs truncate max-w-xs inline-block cursor-help"},fn={class:"border rounded p-3 flex flex-col gap-2 flex-1 min-h-0"},vn={class:"flex items-center justify-between"},pn={class:"flex items-center gap-2"},mn={key:0,class:"flex items-center gap-2 mr-2"},gn=["onClick"],_n=["src","alt"],xn=["onClick"],yn={class:"border rounded p-3 flex flex-col gap-2 flex-shrink-10 h-[240px]"},hn={class:"flex items-center justify-between"},bn={key:0,class:"text-xs text-gray-400"},kn={key:1,class:"text-xs text-gray-400"},wn={key:2,class:"text-xs text-gray-400"},Tn={key:3,class:"text-xs space-y-3 max-h-45 overflow-auto pr-1"},$n={key:0,class:"flex gap-3"},Cn={class:"flex-1 flex flex-wrap gap-1 items-start"},Sn={key:1,class:"flex gap-3"},Dn={class:"flex-1 space-y-1"},Mn={key:2,class:"flex gap-3"},Pn={class:"flex-1"},Vn={class:"leading-snug text-gray-700"},Fn={key:3,class:"flex gap-3"},Rn={class:"flex-1"},Un={class:"leading-snug text-gray-700"},En={key:1,class:"flex-1 border rounded p-3 flex flex-col"},Ln={key:2,class:"w-80 border rounded p-3 flex flex-col"},Bn={class:"flex-1 overflow-auto flex flex-col gap-3"},An={class:"border rounded p-3 flex flex-col gap-2"},jn={class:"grid grid-cols-2 gap-3"},zn={class:"flex flex-col gap-1"},On={class:"flex flex-col gap-1"},Nn={class:"flex flex-col gap-1"},In={class:"flex flex-col gap-1"},Kn={class:"border rounded p-3 flex flex-col gap-2 flex-shrink-0"},Yn={key:3,class:"w-80 border rounded p-3 flex flex-col"},qn={class:"flex items-center justify-center min-h-[400px]"},Gn=["src","alt"],Hn={class:"flex items-center justify-between w-full"},Wn={class:"flex items-center gap-2"},Jn={class:"text-sm text-gray-600"},wt="cosyvoice-v3-plus-leo-34ba9eaebae44039a4a9426af6389dcd",Xe=.8,Ze=50,Qn=We({__name:"TTS",setup(qe){const d=y(!1),C=y([]),e=y(null),K=y(null),M=y(!1),S=y(""),z=y(""),P=y(!1),R=y(""),U=y(""),Q=y(wt),Z=y(null),X=y(Xe),te=y(Ze),le=y(!1),Y=y(null),O=y([]),B=y(new Map),Ce=y(!1),pe=y(!1),q=y(!1),f=y(-1),m=Rt({callbacks:{onPlay:()=>{i.success("开始播放")},onError:()=>{D(new Error("音频播放失败"),"播放失败"),ce()},onEnded:()=>{ce()}}}),$={size:"small",plain:!0,class:"!w-8 !h-6 !p-0"},W={size:"small",plain:!0,class:"!h-5 !text-xs !px-2"},se={size:"small",plain:!0,class:"!h-7 !text-xs"},J=async()=>{try{d.value=!0;const l=await Ps();l.code===0?(C.value=l.data||[],C.value.length>0&&!e.value&&await g(C.value[0].task_id)):i.error(l.msg||"获取任务列表失败")}catch(l){D(l,"获取任务列表失败")}finally{d.value=!1}},me=()=>{const l=new Date,s=l.getFullYear(),w=String(l.getMonth()+1).padStart(2,"0"),_=String(l.getDate()).padStart(2,"0"),N=String(l.getHours()).padStart(2,"0"),ie=String(l.getMinutes()).padStart(2,"0"),ue=String(l.getSeconds()).padStart(2,"0");S.value=`${s}-${w}-${_} ${N}:${ie}:${ue}`,z.value="",M.value=!0},ee=()=>{S.value=""},Se=async()=>{try{d.value=!0;const l=await Vs({text:"",name:S.value.trim()||void 0});l.code===0?(i.success("任务创建成功"),M.value=!1,S.value="",await J(),g(l.data.task_id)):i.error(l.msg||"创建任务失败")}catch(l){D(l,"创建任务失败")}finally{d.value=!1}},De=l=>{U.value=l.text||"",Q.value=l.role||wt,Z.value=l.model||null,X.value=l.speed??Xe,te.value=l.vol??Ze,le.value=!1},de=l=>K.value===l,he=l=>{const s=C.value.findIndex(w=>w.task_id===l.task_id);s!==-1&&(C.value[s]={...l})},g=async l=>{e.value&&e.value.task_id!==l&&e.value&&(Ae(),c(),we(e.value)||F());const w=C.value.find(_=>_.task_id===l);w&&(e.value={...w},De(w),we(w)&&j()),K.value=l;try{const _=await ht(l);if(!de(l))return;if(_.code===0){if(!de(l))return;const N=_.data;e.value=N,he(N),De(N),(N.status==="processing"||N.ocr_running||N.analysis_running)&&j()}}catch(_){de(l)&&console.error(`[TTS] 获取任务详情失败: ${l}`,_)}finally{de(l)&&(K.value=null)}},ae=async l=>{if(e.value&&e.value.task_id===l&&(we(e.value)||F()),!!await ye.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{d.value=!0;const w=await Ls(l);w.code===0?(i.success("任务删除成功"),await J(),e.value&&e.value.task_id===l&&(C.value&&C.value.length>0?await g(C.value[0].task_id):e.value=null)):i.error(w.msg||"删除任务失败")}catch(w){D(w,"删除任务失败")}finally{d.value=!1}},Oe=()=>{e.value&&(R.value=e.value.name,P.value=!0)},Me=async()=>{if(e.value){if(!R.value.trim()){i.warning("请输入任务名称");return}try{d.value=!0;const l=await bt(e.value.task_id,{name:R.value.trim()});l.code===0?(i.success("任务名称修改成功"),P.value=!1,R.value="",await g(e.value.task_id)):i.error(l.msg||"修改任务名称失败")}catch(l){D(l,"修改任务名称失败")}finally{d.value=!1}}},Ne=()=>{if(!e.value)return;const l=e.value.text||"";le.value=U.value!==l,le.value&&ke()},be=l=>{Q.value=l,ge()},ge=()=>{if(!e.value)return;const l=e.value.role||null,s=e.value.model||null,w=e.value.speed??Xe,_=e.value.vol??Ze;le.value=Q.value!==l||Z.value!==s||X.value!==w||te.value!==_,le.value&&ke()},ke=async()=>{if(!(!e.value||!le.value))try{d.value=!0;const l={},s=e.value.text||"";U.value!==s&&(l.text=U.value);const w=e.value.role||null;Q.value!==w&&(l.role=Q.value||void 0);const _=e.value.model||null;Z.value!==_&&(l.model=Z.value||void 0);const N=e.value.speed??Xe;X.value!==N&&(l.speed=X.value);const ie=e.value.vol??Ze;te.value!==ie&&(l.vol=te.value);const ue=await bt(e.value.task_id,l);ue.code===0?(le.value=!1,await g(e.value.task_id)):i.error(ue.msg||"保存参数失败")}catch(l){D(l,"保存参数失败")}finally{d.value=!1}},ne=async()=>{if(!e.value)return;if(!U.value.trim()){i.warning("请输入文本内容");return}if(le.value&&await ke(),!!await ye.confirm(`确定要开始生成任务 "${e.value.name}" 吗？`,"确认生成",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{d.value=!0;const s=await Fs(e.value.task_id);s.code===0?(i.success("TTS 任务已启动"),await J(),await g(e.value.task_id)):i.error(s.msg||"启动任务失败")}catch(s){D(s,"启动任务失败")}finally{d.value=!1}},Pe=async()=>{if(!(!e.value||!await ye.confirm("确定要停止生成吗？","确认停止",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{d.value=!0;const s=await Rs(e.value.task_id);s.code===0?(i.success("任务已停止"),await J(),await g(e.value.task_id)):i.error(s.msg||"停止任务失败")}catch(s){D(s,"停止任务失败")}finally{d.value=!1}},Ve=async l=>{try{const s=await ht(l);if(s.code===0){const w=s.data;he(w),e.value&&e.value.task_id===l&&(e.value=w,De(w))}}catch(s){console.error(`[TTS] 更新任务详情失败: ${l}`,s)}};function we(l){return l.status==="processing"||!!l.ocr_running||!!l.analysis_running}const p=y(new Set),{start:u,stop:F}=mt(async()=>{await J();const l=C.value.filter(we),s=new Set(l.map(_=>_.task_id)),w=Array.from(p.value).filter(_=>!s.has(_));for(const _ of w)await Ve(_);if(p.value=s,l.length===0){F(),p.value.clear();return}for(const _ of l)await Ve(_.task_id)},Ft,{immediate:!1}),j=()=>{const l=C.value.filter(we);p.value=new Set(l.map(s=>s.task_id)),u()},Fe=async()=>{if(e.value?.output_file)try{const l=kt(e.value.task_id),s=await fetch(l);if(!s.ok){i.error("下载失败");return}const w=await s.blob(),_=URL.createObjectURL(w),N=e.value.output_file,ie=N.includes(".")?"."+N.split(".").pop():"",Ee=`${e.value.name||"tts_output"}${ie}`,Te=document.createElement("a");Te.href=_,Te.download=Ee,document.body.appendChild(Te),Te.click(),document.body.removeChild(Te),URL.revokeObjectURL(_)}catch(l){D(l,"下载失败")}},Re=async l=>{if(l?.output_file)try{const s=kt(l.task_id),w=await fetch(s);if(!w.ok){i.error("下载失败");return}const _=await w.blob(),N=URL.createObjectURL(_),ie=l.output_file,ue=ie.includes(".")?"."+ie.split(".").pop():"",Te=`${l.name||"tts_output"}${ue}`,Le=document.createElement("a");Le.href=N,Le.download=Te,document.body.appendChild(Le),Le.click(),document.body.removeChild(Le),URL.revokeObjectURL(N)}catch(s){D(s,"下载失败")}},ce=()=>{m.clear()},Ae=()=>{ce()},Ge=()=>{if(!e.value||!e.value.output_file){i.warning("结果文件不存在");return}const l=e.value.output_file;if(m.playingFilePath.value===l&&m.audio&&!m.audio.paused){ce(),i.info("已停止播放");return}const s=rt(l);if(!s){i.error("无法生成媒体文件URL");return}m.load(s,{playingFilePath:l}),m.play().catch(w=>{D(w,"播放失败"),ce()})},Ie=(l,s)=>{e.value?.output_file&&Ke({path:e.value.output_file},s)},Ke=(l,s)=>{if(!l)return;const w=l?.path||l?.name||"";m.seekFile(w,s)},je={pending:{tag:"info",text:"等待中"},processing:{tag:"warning",text:"处理中"},success:{tag:"success",text:"成功"},failed:{tag:"danger",text:"失败"}},h=l=>je[l]?.tag||"info",r=l=>je[l]?.text||"未知",c=()=>{B.value.forEach(l=>{URL.revokeObjectURL(l)}),B.value.clear(),O.value=[],Y.value&&(Y.value.value=""),q.value&&(q.value=!1,f.value=-1)},x=()=>{Y.value?.click()},I=l=>{const w=l.target.files;if(w&&w.length>0){const _=Array.from(w);_.forEach((N,ie)=>{const ue=O.value.length+ie,Ee=URL.createObjectURL(N);B.value.set(ue,Ee)}),O.value.push(..._)}},oe=l=>{if(B.value.has(l))return B.value.get(l);if(l>=0&&l<O.value.length){const s=URL.createObjectURL(O.value[l]);return B.value.set(l,s),s}return""},Ue=l=>{if(l<0||l>=O.value.length)return;B.value.has(l)&&(URL.revokeObjectURL(B.value.get(l)),B.value.delete(l)),f.value===l?(q.value=!1,f.value=-1):f.value>l&&f.value--;const s=new Map;O.value.forEach((w,_)=>{if(_!==l){const N=(_>l,_);B.value.has(N)&&s.set(_>l?_-1:_,B.value.get(N))}}),B.value=s,O.value.splice(l,1),Y.value&&(Y.value.value="")},ze=l=>{f.value=l,q.value=!0},L=()=>{f.value>0&&f.value--},re=()=>{f.value<O.value.length-1&&f.value++},fe=G(()=>f.value>=0&&O.value[f.value]?O.value[f.value].name:"图片预览"),Ut=async()=>{if(O.value.length===0){i.warning("请先选择图片");return}if(!e.value){i.warning("请先创建或选择一个 TTS 任务");return}if(ve.value){i.warning("任务正在处理中或正在执行分析，无法执行 OCR");return}try{Ce.value=!0;const l=await Us(e.value.task_id,O.value);l.code===0?(i.success("OCR 任务已启动，正在后台处理"),c(),await g(e.value.task_id),u()):i.error(l.msg||"OCR 识别失败")}catch(l){D(l,"OCR 识别失败")}finally{Ce.value=!1}},Et=async()=>{if(!e.value){i.warning("请先创建或选择一个 TTS 任务");return}if(!U.value.trim()){i.warning("请输入要分析的文本内容");return}if(ve.value){i.warning("当前任务正在处理中或正在执行 OCR，请稍后再试");return}if(await ye.confirm(`确定要分析当前任务 "${e.value.name}" 的文本吗？`,"确认分析",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{pe.value=!0;const s=await Es(e.value.task_id);s.code===0?(i.success("分析任务已启动，正在后台处理"),await g(e.value.task_id),j()):i.error(s.msg||"分析任务启动失败")}catch(s){D(s,"分析任务启动失败")}finally{pe.value=!1}},Je=G(()=>e.value?.status==="processing"),gt=G(()=>!!(e.value?.ocr_running||e.value?.analysis_running)),ve=G(()=>Je.value||gt.value);function Lt(l){return l.status==="processing"||!!l.ocr_running||!!l.analysis_running}const Bt=G(()=>!U.value.trim()||Je.value||gt.value),At=G(()=>!e.value?.output_file),nt=G(()=>e.value?.output_file?{path:e.value.output_file,name:e.value.output_file.split("/").pop()||"output.mp3"}:null),_t=G(()=>nt.value?{path:nt.value.path,name:nt.value.name,duration:e.value?.duration||null}:null);return et(()=>{J()}),dt(()=>{F(),ce(),B.value.forEach(l=>{URL.revokeObjectURL(l)}),B.value.clear()}),(l,s)=>{const w=at,_=tt,N=st,ie=pt,ue=ct,Ee=ls,Te=ss,Le=as,xt=Pt,yt=Mt,ot=Dt;return o(),v("div",Ya,[t("div",qa,[t("div",Ga,[s[15]||(s[15]=t("h3",{class:"text-base font-semibold"},"任务列表",-1)),t("div",Ha,[a(_,H({type:"info"},$,{onClick:J,loading:d.value}),{default:n(()=>[d.value?V("",!0):(o(),E(w,{key:0},{default:n(()=>[a(A(lt))]),_:1}))]),_:1},16,["loading"]),a(_,H({type:"success"},$,{onClick:me}),{default:n(()=>[a(w,null,{default:n(()=>[a(A(ft))]),_:1})]),_:1},16)])]),C.value&&C.value.length>0?(o(),v("div",Wa,[(o(!0),v($e,null,Be(C.value,T=>(o(),v("div",{key:T.task_id,class:Ye(["border rounded px-3 py-2 cursor-pointer hover:bg-gray-50 group min-h-[60px] flex flex-col justify-between",{"border-blue-500 bg-blue-50":e.value&&T.task_id===e.value.task_id}]),onClick:_e=>g(T.task_id)},[t("div",Qa,[t("div",{class:"text-sm font-medium truncate flex-1 min-w-0",title:T.name},k(T.name),9,Xa),T.duration?(o(),v("span",Za,k(A(Ms)(T.duration)),1)):V("",!0)]),t("div",en,[a(N,{type:h(T.status),size:"small",class:"!h-5 !text-xs w-14 text-center"},{default:n(()=>[b(k(r(T.status)),1)]),_:2},1032,["type"]),T.analysis?(o(),E(N,{key:0,type:"primary",size:"small",effect:"dark",round:"",class:"!h-4 !w-4 !text-[10px] mr-1"},{default:n(()=>[...s[16]||(s[16]=[b(" 析 ",-1)])]),_:1})):V("",!0),t("div",tn,[T.output_file?(o(),E(_,H({key:0,type:"primary",class:"!w-6"},{ref_for:!0},W,{onClick:xe(_e=>Re(T),["stop"])}),{default:n(()=>[a(w,null,{default:n(()=>[a(A(es))]),_:1})]),_:1},16,["onClick"])):V("",!0),a(_,H({type:"danger"},{ref_for:!0},W,{class:"!w-6",onClick:xe(_e=>ae(T.task_id),["stop"]),disabled:Lt(T)}),{default:n(()=>[a(w,null,{default:n(()=>[a(A(vt))]),_:1})]),_:1},16,["onClick","disabled"])])])],10,Ja))),128))])):(o(),v("div",sn,' 暂无任务，请点击"新建"创建 '))]),e.value?(o(),v("div",ln,[t("div",an,[t("div",nn,[t("h3",on,"任务详情: "+k(e.value.name),1),a(_,{type:"default",size:"small",plain:"",circle:"",disabled:ve.value,onClick:Oe,title:"编辑名称"},{default:n(()=>[a(w,null,{default:n(()=>[a(A(Ct))]),_:1})]),_:1},8,["disabled"])])]),t("div",rn,[t("div",un,[a(N,{type:h(e.value.status),size:"small",class:"w-16 text-center"},{default:n(()=>[b(k(r(e.value.status)),1)]),_:1},8,["type"]),_t.value?(o(),E(it,{key:0,file:_t.value,player:A(m),disabled:ve.value,onPlay:Ge,onSeek:Ie},null,8,["file","player","disabled"])):V("",!0),a(_,H({type:"primary"},se,{onClick:Fe,disabled:At.value}),{default:n(()=>[...s[17]||(s[17]=[b(" 下载 ",-1)])]),_:1},16,["disabled"]),e.value.total_chars!==void 0?(o(),v("span",dn,[Je.value&&e.value.generated_chars!==void 0?(o(),v($e,{key:0},[b(k(e.value.generated_chars)+" / "+k(e.value.total_chars),1)],64)):(o(),v($e,{key:1},[b(k(e.value.total_chars),1)],64))])):V("",!0),e.value.error_message?(o(),E(ie,{key:2,content:`错误: ${e.value.error_message}`,placement:"top",class:"w-full"},{default:n(()=>[t("span",cn," 错误: "+k(e.value.error_message),1)]),_:1},8,["content"])):V("",!0)]),t("div",fn,[t("div",vn,[s[19]||(s[19]=t("h4",{class:"h-8 text-sm font-semibold"},"文本内容",-1)),t("div",pn,[O.value.length>0?(o(),v("div",mn,[(o(!0),v($e,null,Be(O.value,(T,_e)=>(o(),v("div",{key:_e,class:"relative group cursor-pointer",onClick:jt=>ze(_e)},[t("img",{src:oe(_e),alt:T.name,class:"w-8 h-8 object-cover rounded border border-gray-300 hover:border-blue-500 transition-colors"},null,8,_n),t("div",{class:"absolute -right-1 -top-1 w-4 h-4 bg-red-500 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",onClick:xe(jt=>Ue(_e),["stop"])},[a(w,{class:"text-white text-xs"},{default:n(()=>[a(A(St))]),_:1})],8,xn)],8,gn))),128))])):V("",!0),t("input",{ref_key:"imageInputRef",ref:Y,type:"file",accept:"image/*",multiple:"",onChange:I,class:"hidden"},null,544),a(_,{type:"default",size:"small",onClick:x,disabled:ve.value,class:"!p-0"},{default:n(()=>[a(w,{class:"!w-7 !h-6"},{default:n(()=>[a(A(ts),{class:"!w-5 !h-5"})]),_:1})]),_:1},8,["disabled"]),a(_,{type:"primary",size:"small",onClick:Ut,disabled:ve.value||O.value.length===0||!e.value,loading:Ce.value},{default:n(()=>[...s[18]||(s[18]=[b(" 识别 ",-1)])]),_:1},8,["disabled","loading"])])]),a(ue,{modelValue:U.value,"onUpdate:modelValue":s[0]||(s[0]=T=>U.value=T),type:"textarea",autosize:{minRows:6,maxRows:17},placeholder:"请输入要转换为语音的文本",disabled:ve.value,onBlur:Ne,class:"flex-1"},null,8,["modelValue","disabled"])]),t("div",yn,[t("div",hn,[s[21]||(s[21]=t("h4",{class:"text-sm font-semibold"},"分析数据",-1)),a(_,{type:"primary",size:"small",loading:pe.value,disabled:ve.value||!U.value.trim(),onClick:Et},{default:n(()=>[...s[20]||(s[20]=[b(" 分析 ",-1)])]),_:1},8,["loading","disabled"])]),e.value?U.value.trim()?e.value.analysis?(o(),v("div",Tn,[e.value.analysis.words?.length?(o(),v("div",$n,[s[22]||(s[22]=t("div",{class:"w-10 h-6 rounded-md bg-blue-50 border border-blue-300 flex items-center justify-center flex-shrink-0"},[t("span",{class:"text-[11px] leading-tight text-blue-700 text-center"}," 美词 ")],-1)),t("div",Cn,[(o(!0),v($e,null,Be(e.value.analysis.words,(T,_e)=>(o(),E(N,{key:_e,size:"small",effect:"light",class:"!text-xs"},{default:n(()=>[b(k(T),1)]),_:2},1024))),128))])])):V("",!0),e.value.analysis.sentence?.length?(o(),v("div",Sn,[s[23]||(s[23]=t("div",{class:"w-10 h-10 rounded-md bg-emerald-50 border border-emerald-300 flex items-center justify-center flex-shrink-0"},[t("span",{class:"text-[11px] leading-tight text-emerald-700 text-center"},[b(" 精彩"),t("br"),b("句段 ")])],-1)),t("div",Dn,[(o(!0),v($e,null,Be(e.value.analysis.sentence,(T,_e)=>(o(),v("p",{key:_e,class:"leading-snug text-gray-700"},k(T),1))),128))])])):V("",!0),e.value.analysis.abstract?(o(),v("div",Mn,[s[24]||(s[24]=t("div",{class:"w-10 h-10 rounded-md bg-amber-50 border border-amber-300 flex items-center justify-center flex-shrink-0"},[t("span",{class:"text-[11px] leading-tight text-amber-700 text-center"},[b(" 好句"),t("br"),b("花园 ")])],-1)),t("div",Pn,[t("p",Vn,k(e.value.analysis.abstract),1)])])):V("",!0),e.value.analysis.doodle?(o(),v("div",Fn,[s[25]||(s[25]=t("div",{class:"w-10 h-6 rounded-md bg-pink-50 border border-pink-300 flex items-center justify-center flex-shrink-0"},[t("span",{class:"text-[11px] leading-tight text-pink-700 text-center"}," 涂鸦 ")],-1)),t("div",Rn,[t("p",Un,k(e.value.analysis.doodle),1)])])):V("",!0)])):(o(),v("div",wn," 暂无分析结果，请点击右上角「分析」按钮，稍等几秒后刷新任务即可查看。 ")):(o(),v("div",kn," 当前任务还没有可分析的文本，请先在上方输入内容。 ")):(o(),v("div",bn," 请先在左侧创建或选择一个 TTS 任务。 "))])])])):(o(),v("div",En,[...s[26]||(s[26]=[t("div",{class:"flex items-center justify-between mb-3 flex-shrink-0"},[t("h3",{class:"text-base font-semibold"},"任务详情")],-1),t("div",{class:"flex-1 flex items-center justify-center text-sm text-gray-400"}," 请从左侧选择一个任务查看详情 ",-1)])])),e.value?(o(),v("div",Ln,[s[34]||(s[34]=t("div",{class:"flex items-center justify-between mb-3"},[t("h3",{class:"text-base font-semibold"},"参数与生成")],-1)),t("div",Bn,[t("div",An,[s[31]||(s[31]=t("h4",{class:"text-sm font-semibold"},"参数设置",-1)),t("div",jn,[t("div",zn,[s[27]||(s[27]=t("label",{class:"text-xs text-gray-600"},"模型",-1)),a(Te,{modelValue:Z.value,"onUpdate:modelValue":s[1]||(s[1]=T=>Z.value=T),size:"small",placeholder:"默认模型",clearable:"",disabled:ve.value,onChange:ge,class:"w-full"},{default:n(()=>[a(Ee,{label:"cosyvoice-v3-flash",value:"cosyvoice-v3-flash"}),a(Ee,{label:"cosyvoice-v3-plus",value:"cosyvoice-v3-plus"})]),_:1},8,["modelValue","disabled"])]),t("div",On,[s[28]||(s[28]=t("label",{class:"text-xs text-gray-600"},"发音人/音色",-1)),a(Te,{modelValue:Q.value,"onUpdate:modelValue":s[2]||(s[2]=T=>Q.value=T),size:"small",placeholder:"请选择音色（可选）",clearable:"",disabled:ve.value,onChange:be,class:"w-full"},{default:n(()=>[a(Ee,{label:"灿灿",value:"cosyvoice-v3-plus-leo-34ba9eaebae44039a4a9426af6389dcd"})]),_:1},8,["modelValue","disabled"])]),t("div",Nn,[s[29]||(s[29]=t("label",{class:"text-xs text-gray-600"},"语速",-1)),a(Le,{modelValue:X.value,"onUpdate:modelValue":s[3]||(s[3]=T=>X.value=T),size:"small",min:.5,max:2,step:.1,precision:1,disabled:ve.value,onChange:ge,class:"w-full"},null,8,["modelValue","disabled"])]),t("div",In,[s[30]||(s[30]=t("label",{class:"text-xs text-gray-600"},"音量",-1)),a(Le,{modelValue:te.value,"onUpdate:modelValue":s[4]||(s[4]=T=>te.value=T),size:"small",min:0,max:100,step:1,disabled:ve.value,onChange:ge,class:"w-full"},null,8,["modelValue","disabled"])])])]),t("div",Kn,[Je.value?(o(),E(_,H({key:1,type:"warning"},se,{onClick:Pe,class:"w-full"}),{default:n(()=>[...s[33]||(s[33]=[b(" 停止生成 ",-1)])]),_:1},16)):(o(),E(ie,{key:0,content:U.value.trim()?"":"请先输入文本内容",disabled:!!U.value.trim(),placement:"top"},{default:n(()=>[a(_,H({type:"success"},se,{onClick:ne,disabled:Bt.value,class:"w-full"}),{default:n(()=>[...s[32]||(s[32]=[b(" 开始生成 ",-1)])]),_:1},16,["disabled"])]),_:1},8,["content","disabled"]))])])])):(o(),v("div",Yn,[...s[35]||(s[35]=[t("h3",{class:"text-base font-semibold mb-3"},"参数与生成",-1),t("div",{class:"flex-1 flex items-center justify-center text-sm text-gray-400"}," 请从左侧选择一个任务查看参数 ",-1)])])),a(ot,{modelValue:M.value,"onUpdate:modelValue":s[7]||(s[7]=T=>M.value=T),title:"创建 TTS 任务",width:"500px",onClose:ee},{footer:n(()=>[a(_,{onClick:s[6]||(s[6]=T=>M.value=!1)},{default:n(()=>[...s[36]||(s[36]=[b("取消",-1)])]),_:1}),a(_,{type:"primary",onClick:Se},{default:n(()=>[...s[37]||(s[37]=[b(" 确定 ",-1)])]),_:1})]),default:n(()=>[a(yt,null,{default:n(()=>[a(xt,{label:"任务名称"},{default:n(()=>[a(ue,{modelValue:S.value,"onUpdate:modelValue":s[5]||(s[5]=T=>S.value=T),placeholder:"请输入任务名称",onKeyup:He(Se,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(ot,{modelValue:P.value,"onUpdate:modelValue":s[10]||(s[10]=T=>P.value=T),title:"重命名任务",width:"400px",onClose:s[11]||(s[11]=T=>R.value="")},{footer:n(()=>[a(_,{onClick:s[9]||(s[9]=T=>P.value=!1)},{default:n(()=>[...s[38]||(s[38]=[b("取消",-1)])]),_:1}),a(_,{type:"primary",onClick:Me},{default:n(()=>[...s[39]||(s[39]=[b(" 确定 ",-1)])]),_:1})]),default:n(()=>[a(yt,null,{default:n(()=>[a(xt,{label:"任务名称"},{default:n(()=>[a(ue,{modelValue:R.value,"onUpdate:modelValue":s[8]||(s[8]=T=>R.value=T),placeholder:"请输入任务名称",onKeyup:He(Me,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(ot,{modelValue:q.value,"onUpdate:modelValue":s[13]||(s[13]=T=>q.value=T),title:fe.value,width:"90%","align-center":"",onClose:s[14]||(s[14]=T=>f.value=-1)},{footer:n(()=>[t("div",Hn,[t("div",Wn,[a(_,{onClick:L,disabled:f.value<=0,size:"small"},{default:n(()=>[...s[40]||(s[40]=[b(" 上一张 ",-1)])]),_:1},8,["disabled"]),t("span",Jn,k(f.value+1)+" / "+k(O.value.length),1),a(_,{onClick:re,disabled:f.value>=O.value.length-1,size:"small"},{default:n(()=>[...s[41]||(s[41]=[b(" 下一张 ",-1)])]),_:1},8,["disabled"])]),a(_,{type:"danger",onClick:s[12]||(s[12]=T=>Ue(f.value)),size:"small"},{default:n(()=>[...s[42]||(s[42]=[b(" 删除 ",-1)])]),_:1})])]),default:n(()=>[t("div",qn,[f.value>=0&&O.value[f.value]?(o(),v("img",{key:0,src:oe(f.value),alt:O.value[f.value].name,class:"max-w-full max-h-[70vh] object-contain"},null,8,Gn)):V("",!0)])]),_:1},8,["modelValue","title"])])}}}),Xn={class:"p-1"},ro=We({__name:"index",setup(qe){const d=y("tts_tool"),C=e=>{console.log("切换到页签:",e)};return(e,K)=>{const M=os,S=ns;return o(),v("div",Xn,[a(S,{modelValue:d.value,"onUpdate:modelValue":K[0]||(K[0]=z=>d.value=z),onTabChange:C,class:"flex-1 flex flex-col overflow-hidden h-[calc(100vh-150px)]"},{default:n(()=>[a(M,{label:"TTS",name:"tts_tool"},{default:n(()=>[a(Qn)]),_:1}),a(M,{label:"PDF 工具",name:"pdf_tool"},{default:n(()=>[a(il)]),_:1}),a(M,{label:"音频合成",name:"audio_merge"},{default:n(()=>[a(ql)]),_:1}),a(M,{label:"音频转码",name:"audio_convert"},{default:n(()=>[a(Ka)]),_:1})]),_:1},8,["modelValue"])])}}});export{ro as default};
