import{a as k}from"./utils-BjcahYMR.js";import{U as T}from"./types-shared-voPqiCjX.js";import{l as c,a as d}from"./utils-shared-C-qnLuqU.js";const m={url:"https://leo-zhao.natapp4.cc/"},u="192.168.50.171",l=8848,g=`http://${u}:${l}`;let r=null,f=!1;async function h(){if(r!==null)return r;if(f){const e=Date.now();for(;r===null&&Date.now()-e<3e3;)await new Promise(a=>setTimeout(a,100));return r===!0}f=!0;try{const t=`http://${u}:${l}/api/health`,e=new AbortController,a=setTimeout(()=>e.abort(),2e3);try{return await fetch(t,{method:"GET",signal:e.signal,mode:"no-cors"}),clearTimeout(a),r=!0,c.info(`Local IP ${u}:${l} is available`),!0}catch{return clearTimeout(a),r=!1,c.info(`Local IP ${u}:${l} is not available`),!1}}catch{return r=!1,!1}finally{f=!1}}let o=g;h().then(t=>{if(!t&&o===g){o=m.url;const e=o.endsWith("/api")?o:o.endsWith("/")?`${o}api`:`${o}/api`;s.defaults.baseURL=e}});const A=o.endsWith("/api")?o:o.endsWith("/")?`${o}api`:`${o}/api`;function F(){return o}const s=k.create({baseURL:A,timeout:3e4});s.interceptors.request.use(t=>(c.debug("API Request:",t.method?.toUpperCase(),t.url,t.params||t.data),t),t=>(c.error("API Request Error:",t),Promise.reject(t)));s.interceptors.response.use(t=>{if(t.data&&typeof t.data=="object"&&"code"in t.data&&t.data.code!==0){const e=new Error(t.data.msg||"请求失败");return e.response=t,Promise.reject(e)}return t},t=>{if(t.code==="ECONNABORTED"||t.message?.includes("canceled")||t.message?.includes("aborted"))return Promise.reject(t);if(t.config?._isFileUpload===!0||t.config?.data instanceof FormData||typeof t.config?.headers?.["Content-Type"]=="string"&&t.config.headers["Content-Type"].includes("multipart/form-data")||t.config?.url?.includes("/pdf/upload")||t.config?.url?.includes("/upload"))return c.warn(`File upload failed, not retrying to avoid re-upload: ${t.config?.url}`,{code:t.code,message:t.message,status:t.response?.status}),Promise.reject(t);if(r!==!1&&o===g&&t.request&&!t.response){r=!1,o=m.url;const a=o.endsWith("/api")?o:o.endsWith("/")?`${o}api`:`${o}/api`;if(s.defaults.baseURL=a,t.config)return s.request(t.config)}if(t.response){const a=t.response.status,i=t.response.data?.msg||`请求失败 (${a})`;a>=500?d(t,"服务器错误",{context:"API"}):a===404?d(t,"资源未找到",{context:"API"}):a===403?d(t,"无权限访问",{context:"API"}):a===401?d(t,"未授权，请重新登录",{context:"API"}):d(t,i,{context:"API"})}else t.request?d(t,"网络错误，请检查网络连接",{context:"API"}):d(t,"请求配置错误",{context:"API"});return Promise.reject(t)});async function x(t,e,a,n){const i={table:t};return e&&(i.conditions=JSON.stringify(e)),a&&(i.pageNum=a),n&&(i.pageSize=n),(await s.get("/getAll",{params:i})).data}async function S(t,e,a){const n={table:t,id:e};return(await s.get("/getData",{params:n})).data.data}async function B(t,e){return e.id===-1&&(e.id=null),(await s.post("/setData",{table:t,data:e})).data.data}async function O(t,e){return(await s.post("/delData",{table:t,id:e})).data.data}async function W(t){if(t===void 0)throw new Error("id is undefined");const e=await s.get("/getData",{params:{id:t,table:"t_schedule",fields:"data,user_id"}});if(e.data.code!==0)throw new Error(e.data.msg);const a=T.parseUserData(e.data.data.data);return a.userId=e.data.data.user_id,a}async function j(t,e){const a=await s.post("/setData",{table:"t_user",data:{id:t,score:e}});if(console.log("setUserInfo",a.data),a.data.code!==0)throw new Error(a.data.msg);return a.data.data}async function q(t){const e=await s.get("/getData",{params:{table:"t_user",id:t,fields:"id,score"}});if(e.data.code!==0)throw new Error(e.data.msg);return e.data.data}async function G(t,e,a,n){const i=await s.post("/addScore",{user:t,action:e,value:a,msg:n});if(console.log("addScore",i.data),i.data.code!==0)throw new Error(i.data.msg);return i.data.data}async function N(t,e,a){const n=await s.get("/getRdsList",{params:{key:t,pageSize:a,startId:e}});if(n.data.code!==0)throw new Error(n.data.msg);return n.data.data}async function z(t,e){const a=await s.get("/getRdsData",{params:{table:t,id:e}});if(a.data.code!==0)throw new Error(a.data.msg);return a.data.data}async function J(t,e,a){const n=await s.post("/setRdsData",{table:t,data:{id:e,value:a}});if(console.log("setRdsData",n.data),n.data.code!==0)throw new Error(n.data.msg);return n.data.data}async function H(t,e,a){let n;const i="bluetooth";return e==="GET"?n=await s.get(`/${i}/${t}`,{params:a}):n=await s.post(`/${i}/${t}`,a),n.data}async function K(t,e,a={}){let n;return e==="GET"?n=await s.get(`/playlist/${t}`,{params:a}):n=await s.post(`/playlist/${t}`,a),n.data}async function Q(){return(await s.get("/pdf/list")).data}async function V(t,e,a){const n=new FormData;n.append("file",t);const i={headers:{"Content-Type":"multipart/form-data"},timeout:6e5,signal:a,_isFileUpload:!0,onUploadProgress:p=>{if(e&&p.total){const y=Math.round(p.loaded*100/p.total);e(y)}}};return(await s.post("/pdf/upload",n,i)).data}async function X(t,e){const a={task_id:t};return e!=null&&e!==""&&(a.password=e),(await s.post("/pdf/decrypt",a)).data}async function Y(t){return(await s.get(`/pdf/task/${encodeURIComponent(t)}`)).data}function Z(t,e){return`${s.defaults.baseURL||""}/pdf/download/${encodeURIComponent(t)}?type=${e}`}async function tt(t){return(await s.post("/pdf/delete",{task_id:t})).data}async function U(){return(await s.get("/media/merge/list")).data}async function _(){return(await s.post("/media/merge/create",{})).data}async function L(t){return(await s.post("/media/merge/get",{task_id:t})).data}async function R(t){return(await s.post("/media/merge/delete",{task_id:t})).data}async function $(t,e){return(await s.post("/media/merge/addFileByPath",{task_id:t,file_path:e})).data}async function P(t,e){return(await s.post("/media/merge/deleteFile",{task_id:t,file_index:e})).data}async function D(t){return(await s.post("/media/merge/start",{task_id:t})).data}async function b(t,e){return(await s.post("/media/merge/reorderFiles",{task_id:t,file_indices:e})).data}function I(t){return`${s.defaults.baseURL||""}/media/merge/download?task_id=${t}`}async function M(t,e){return(await s.post("/media/merge/save",{task_id:t,target_path:e})).data}const et=U,at=_,st=L,nt=R,ot=$,it=P,rt=D,dt=b,ct=I,ut=M;async function lt(){return(await s.get("/media/convert/list")).data}async function pt(t){return(await s.post("/media/convert/create",t||{})).data}async function ft(t){return(await s.post("/media/convert/get",{task_id:t})).data}async function gt(t){return(await s.post("/media/convert/delete",{task_id:t})).data}async function mt(t,e){return(await s.post("/media/convert/update",{task_id:t,...e})).data}async function wt(t){return(await s.post("/media/convert/start",{task_id:t})).data}export{ut as A,dt as B,nt as C,it as D,ct as E,lt as F,pt as G,mt as H,ft as I,wt as J,gt as K,s as a,x as b,G as c,z as d,O as e,S as f,q as g,B as h,J as i,W as j,F as k,N as l,H as m,Q as n,X as o,K as p,Z as q,tt as r,j as s,Y as t,V as u,ot as v,et as w,at as x,st as y,rt as z};
