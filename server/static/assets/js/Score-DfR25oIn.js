import{H as D,z as B,A as M,I as A,C as G,f as I,U as Y,V as F,Q as H}from"./element-plus-DeIauL_s.js";import{b as R}from"./api-shared-Cud_9YyQ.js";import{r as T,q as j,u as Q}from"./utils-C3h80Bc3.js";import{u as q}from"./index-CMozoOv3.js";import{j as J,c as C,r as b,t as Z,n as f,s as y,M as $,Q as l,G as u,l as v,o as n,F as K,a6 as O,J as g,u as U,$ as W}from"./vue-vendor-BHHKG5q1.js";import"./vendor-ClcY5Lvr.js";import"./types-shared-D7b4dn-C.js";import"./utils-shared-CndaLcYB.js";import"./vant-Dc30gN_b.js";const X={class:""},ee={class:"flex items-center"},ae={key:0},te={key:1},se={class:"flex items-center gap-1 w-full"},oe={class:"flex-1 text-center"},E=10,ve=J({__name:"Score",setup(le){const z=q(),L=C(()=>z.userList),i=C(()=>{const e=[...L.value];return e.unshift({id:0,name:"全部"}),e}),o=b({data:[],pageNum:1,pageSize:10,totalCount:0,totalPage:0}),m=b(!1),c=b(0),w=C(()=>i.value.find(e=>e.id===c.value)||i.value[0]),k=async()=>{await z.refreshUserList(),i.value.length>0&&(c.value=i.value[0].id)},x=e=>Q(i.value,s=>s.id==e),h=async(e,s,p)=>{m.value=!0;try{let d;e&&e!==0&&(d={user_id:e});const a=await R("t_score_history",d,s,p);if(a&&a.data){const _=a.data.data||[];o.value.data=[],o.value.pageNum=a.data.pageNum??s,o.value.pageSize=a.data.pageSize??p,o.value.totalCount=a.data.totalCount??0,o.value.totalPage=a.data.totalPage??0,T(_,r=>{r.user=x(r.user_id),r.dt=j(r.dt).format("YYYY-MM-DD HH:mm:ss"),o.value.data.push(r)})}}catch(d){console.error("获取积分记录失败:",d)}finally{m.value=!1}},V=async()=>{const e=w.value;console.log("onUserChange",e),e&&await h(e.id,1,E)},S=(e,s)=>{h(w.value.id,e,s)};return Z(async()=>{await k(),await h(0,1,E)}),(e,s)=>{const p=H,d=D,a=G,_=I,r=M,N=A,P=B;return n(),f("div",X,[y("div",ee,[l(d,{size:"large",modelValue:c.value,"onUpdate:modelValue":s[0]||(s[0]=t=>c.value=t),onChange:V},{default:u(()=>[(n(!0),f(K,null,O(i.value,t=>(n(),v(p,{key:t.id,value:t.id},{default:u(()=>[W(g(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),$((n(),v(r,{data:o.value.data,stripe:""},{default:u(()=>[l(a,{label:"ID",prop:"id",width:"60"}),l(a,{label:"user",width:"60"},{default:u(({row:t})=>[t.user?(n(),f("span",ae,g(t.user.name),1)):(n(),f("span",te,g(t.user_id),1))]),_:1}),l(a,{label:"Action",prop:"action",width:"100"}),l(a,{label:"Date",prop:"dt",width:"180"}),l(a,{label:"Pre",prop:"pre_value",width:"70"}),l(a,{label:"Value",width:"70"},{default:u(({row:t})=>[y("div",se,[t.value>0?(n(),v(_,{key:0,color:"#67C23A",size:16},{default:u(()=>[l(U(Y))]),_:1})):(n(),v(_,{key:1,color:"#F56C6C",size:16},{default:u(()=>[l(U(F))]),_:1})),y("span",oe,g(t.value),1)])]),_:1}),l(a,{label:"Current",prop:"current",width:"80"}),l(a,{label:"MSG",prop:"msg"})]),_:1},8,["data"])),[[P,m.value]]),l(N,{layout:"sizes, prev, pager, next",total:o.value.totalCount,"page-size":o.value.pageSize,"page-sizes":[10,20,50],"current-page":o.value.pageNum,class:"mt-2",background:"",onSizeChange:s[1]||(s[1]=t=>S(o.value.pageNum,t)),onCurrentChange:s[2]||(s[2]=t=>S(t,o.value.pageSize))},null,8,["total","page-size","current-page"])])}}});export{ve as default};
