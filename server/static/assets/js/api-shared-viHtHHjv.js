import{a as A}from"./utils-BjcahYMR.js";import{U as h}from"./types-shared-CGcc7HUC.js";import{l as r,a as d}from"./utils-shared-7Fi3rJBK.js";const g={url:"https://leo-zhao.natapp4.cc/"},u="192.168.50.171",l=8848,k=`http://${u}:${l}`;let c=null,p=null,m=!1;async function w(){return c!==null?c:p||(p=(async()=>{try{const e=`http://${u}:${l}/`,t=new AbortController,a=500,n=setTimeout(()=>t.abort(),a);try{return await fetch(e,{method:"HEAD",signal:t.signal,mode:"no-cors"}),clearTimeout(n),c=!0,r.info(`[API Config] Local IP ${u}:${l} is available`),!0}catch(i){return clearTimeout(n),c=!1,i.name==="AbortError"?r.info(`[API Config] Local IP ${u}:${l} timeout: ${a}ms`):r.info(`[API Config] Local IP ${u}:${l} is not available:`,i.message),!1}}catch{return c=!1,!1}})(),p)}let o;o=k,w().then(e=>{if(!e){o=g.url;const t=o.endsWith("/api")?o:o.endsWith("/")?`${o}api`:`${o}/api`;s.defaults.baseURL=t}m=!0}).catch(e=>{r.error("[API Config] Error checking local IP:",e),o=g.url;const t=o.endsWith("/api")?o:o.endsWith("/")?`${o}api`:`${o}/api`;s.defaults.baseURL=t,m=!0});const L=o.endsWith("/api")?o:o.endsWith("/")?`${o}api`:`${o}/api`;function B(){return(s.defaults.baseURL||o).replace(/\/api$/,"")}const s=A.create({baseURL:L,timeout:3e4});s.interceptors.request.use(async e=>(m||(await w(),await new Promise(t=>setTimeout(t,50))),s.defaults.baseURL&&e.baseURL!==s.defaults.baseURL&&(e.baseURL=s.defaults.baseURL,r.debug(`[API Config] Updated request baseURL to: ${e.baseURL}`)),r.debug("[API Request]",e.method?.toUpperCase(),e.baseURL,e.url,e.params||e.data),e),e=>(r.error("API Request Error:",e),Promise.reject(e)));s.interceptors.response.use(e=>{if(e.data&&typeof e.data=="object"&&"code"in e.data&&e.data.code!==0){const t=new Error(e.data.msg||"请求失败");return t.response=e,Promise.reject(t)}return e},e=>{if(e.code==="ECONNABORTED"||e.message?.includes("canceled")||e.message?.includes("aborted"))return Promise.reject(e);if(e.config?._isFileUpload===!0||e.config?.data instanceof FormData||typeof e.config?.headers?.["Content-Type"]=="string"&&e.config.headers["Content-Type"].includes("multipart/form-data")||e.config?.url?.includes("/pdf/upload")||e.config?.url?.includes("/upload"))return r.warn(`File upload failed, not retrying to avoid re-upload: ${e.config?.url}`,{code:e.code,message:e.message,status:e.response?.status}),Promise.reject(e);if((s.defaults.baseURL||"").includes(u)&&e.request&&!e.response){r.warn(`[API Config] Network error with local IP, switching to remote URL. Error: ${e.message}`),c=!1,o=g.url;const i=o.endsWith("/api")?o:o.endsWith("/")?`${o}api`:`${o}/api`;if(s.defaults.baseURL=i,e.config)return e.config.baseURL=i,r.info(`[API Config] Retrying request with new baseURL: ${e.config.method?.toUpperCase()} ${i}${e.config.url}`),s.request(e.config)}if(e.response){const a=e.response.status,i=e.response.data?.msg||`请求失败 (${a})`;a>=500?d(e,"服务器错误",{context:"API"}):a===404?d(e,"资源未找到",{context:"API"}):a===403?d(e,"无权限访问",{context:"API"}):a===401?d(e,"未授权，请重新登录",{context:"API"}):d(e,i,{context:"API"})}else e.request?d(e,"网络错误，请检查网络连接",{context:"API"}):d(e,"请求配置错误",{context:"API"});return Promise.reject(e)});async function x(e,t,a,n){const i={table:e};return t&&(i.conditions=JSON.stringify(t)),a&&(i.pageNum=a),n&&(i.pageSize=n),(await s.get("/getAll",{params:i})).data}async function q(e,t,a){const n={table:e,id:t};return(await s.get("/getData",{params:n})).data.data}async function O(e,t){return t.id===-1&&(t.id=null),(await s.post("/setData",{table:e,data:t})).data.data}async function S(e,t){return(await s.post("/delData",{table:e,id:t})).data.data}async function W(e){if(e===void 0)throw new Error("id is undefined");const t=await s.get("/getData",{params:{id:e,table:"t_schedule",fields:"data,user_id"}});if(t.data.code!==0)throw new Error(t.data.msg);const a=h.parseUserData(t.data.data.data);return a.userId=t.data.data.user_id,a}async function j(e,t){const a=await s.post("/setData",{table:"t_user",data:{id:e,score:t}});if(console.log("setUserInfo",a.data),a.data.code!==0)throw new Error(a.data.msg);return a.data.data}async function N(e){const t=await s.get("/getData",{params:{table:"t_user",id:e,fields:"id,score"}});if(t.data.code!==0)throw new Error(t.data.msg);return t.data.data}async function z(e,t,a,n){const i=await s.post("/addScore",{user:e,action:t,value:a,msg:n});if(console.log("addScore",i.data),i.data.code!==0)throw new Error(i.data.msg);return i.data.data}async function G(e,t,a){const n=await s.get("/getRdsList",{params:{key:e,pageSize:a,startId:t}});if(n.data.code!==0)throw new Error(n.data.msg);return n.data.data}async function H(e,t){const a=await s.get("/getRdsData",{params:{table:e,id:t}});if(a.data.code!==0)throw new Error(a.data.msg);return a.data.data}async function J(e,t,a){const n=await s.post("/setRdsData",{table:e,data:{id:t,value:a}});if(console.log("setRdsData",n.data),n.data.code!==0)throw new Error(n.data.msg);return n.data.data}async function K(e,t,a){let n;const i="bluetooth";return t==="GET"?n=await s.get(`/${i}/${e}`,{params:a}):n=await s.post(`/${i}/${e}`,a),n.data}async function Q(e,t,a={}){let n;return t==="GET"?n=await s.get(`/playlist/${e}`,{params:a}):n=await s.post(`/playlist/${e}`,a),n.data}async function V(){return(await s.get("/pdf/list")).data}async function X(e,t,a){const n=new FormData;n.append("file",e);const i={headers:{"Content-Type":"multipart/form-data"},timeout:6e5,signal:a,_isFileUpload:!0,onUploadProgress:f=>{if(t&&f.total){const y=Math.round(f.loaded*100/f.total);t(y)}}};return(await s.post("/pdf/upload",n,i)).data}async function Y(e,t){const a={task_id:e};return t!=null&&t!==""&&(a.password=t),(await s.post("/pdf/decrypt",a)).data}async function Z(e){return(await s.get(`/pdf/task/${encodeURIComponent(e)}`)).data}function ee(e,t){return`${s.defaults.baseURL||""}/pdf/download/${encodeURIComponent(e)}?type=${t}`}async function te(e){return(await s.post("/pdf/delete",{task_id:e})).data}async function R(){return(await s.get("/media/merge/list")).data}async function T(){return(await s.post("/media/merge/create",{})).data}async function b(e){return(await s.post("/media/merge/get",{task_id:e})).data}async function $(e){return(await s.post("/media/merge/delete",{task_id:e})).data}async function P(e,t){return(await s.post("/media/merge/addFileByPath",{task_id:e,file_path:t})).data}async function I(e,t){return(await s.post("/media/merge/deleteFile",{task_id:e,file_index:t})).data}async function _(e){return(await s.post("/media/merge/start",{task_id:e})).data}async function C(e,t){return(await s.post("/media/merge/reorderFiles",{task_id:e,file_indices:t})).data}function D(e){return`${s.defaults.baseURL||""}/media/merge/download?task_id=${e}`}async function E(e,t){return(await s.post("/media/merge/save",{task_id:e,target_path:t})).data}const ae=R,se=T,ne=b,oe=$,ie=P,re=I,de=_,ce=C,ue=D,le=E;async function pe(){return(await s.get("/media/convert/list")).data}async function fe(e){return(await s.post("/media/convert/create",e||{})).data}async function ge(e){return(await s.post("/media/convert/get",{task_id:e})).data}async function me(e){return(await s.post("/media/convert/delete",{task_id:e})).data}async function we(e,t){return(await s.post("/media/convert/update",{task_id:e,...t})).data}async function Ue(e){return(await s.post("/media/convert/start",{task_id:e})).data}export{le as A,ce as B,oe as C,re as D,ue as E,pe as F,fe as G,we as H,ge as I,Ue as J,me as K,s as a,x as b,z as c,H as d,S as e,q as f,N as g,O as h,J as i,W as j,B as k,G as l,K as m,V as n,Y as o,Q as p,ee as q,te as r,j as s,Z as t,X as u,ie as v,ae as w,se as x,ne as y,de as z};
