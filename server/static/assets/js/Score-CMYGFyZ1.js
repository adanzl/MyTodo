import{m as D,c as C,r as b,A as B,t as g,O as y,Z as A,a1 as l,Q as u,o as v,q as n,N as I,ao as M,W as f,u as x,bH as Y,bI as q,ae as F}from"./vue-vendor-DxceCm8D.js";import{u as G,g as H}from"./index-DBu4nike.js";import{r as R,u as T,q as Z}from"./utils-C11zrYka.js";import{x as j,v as O,q as Q,y as W,s as J,g as K,F as X}from"./element-plus-BqLbxx0O.js";import"./vant-DyMlv9MZ.js";import"./vendor-DiwfJ622.js";const $={class:""},ee={class:"flex items-center"},ae={key:0},te={key:1},se={class:"flex items-center gap-1 w-full"},oe={class:"flex-1 text-center"},E=10,pe=D({__name:"Score",setup(le){const w=G(),L=C(()=>w.userList),i=C(()=>{const e=[...L.value];return e.unshift({id:0,name:"全部"}),e}),o=b({data:[],pageNum:1,pageSize:10,totalCount:0,totalPage:0}),m=b(!1),c=b(0),z=C(()=>i.value.find(e=>e.id===c.value)||i.value[0]),U=async()=>{await w.refreshUserList(),i.value.length>0&&(c.value=i.value[0].id)},k=e=>Z(i.value,s=>s.id==e),h=async(e,s,p)=>{m.value=!0;try{let d;e&&e!==0&&(d={user_id:e});const a=await H("t_score_history",d,s,p);if(a&&a.data){const _=a.data.data||[];o.value.data=[],o.value.pageNum=a.data.pageNum??s,o.value.pageSize=a.data.pageSize??p,o.value.totalCount=a.data.totalCount??0,o.value.totalPage=a.data.totalPage??0,R(_,r=>{r.user=k(r.user_id),r.dt=T(r.dt).format("YYYY-MM-DD HH:mm:ss"),o.value.data.push(r)})}}catch(d){console.error("获取积分记录失败:",d)}finally{m.value=!1}},N=async()=>{const e=z.value;console.log("onUserChange",e),e&&await h(e.id,1,E)},S=(e,s)=>{h(z.value.id,e,s)};return B(async()=>{await U(),await h(0,1,E)}),(e,s)=>{const p=X,d=j,a=J,_=K,r=Q,P=W,V=O;return n(),g("div",$,[y("div",ee,[l(d,{size:"large",modelValue:c.value,"onUpdate:modelValue":s[0]||(s[0]=t=>c.value=t),onChange:N},{default:u(()=>[(n(!0),g(I,null,M(i.value,t=>(n(),v(p,{key:t.id,value:t.id},{default:u(()=>[F(f(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),A((n(),v(r,{data:o.value.data,stripe:""},{default:u(()=>[l(a,{label:"ID",prop:"id",width:"60"}),l(a,{label:"user",width:"60"},{default:u(({row:t})=>[t.user?(n(),g("span",ae,f(t.user.name),1)):(n(),g("span",te,f(t.user_id),1))]),_:1}),l(a,{label:"Action",prop:"action",width:"100"}),l(a,{label:"Date",prop:"dt",width:"180"}),l(a,{label:"Pre",prop:"pre_value",width:"70"}),l(a,{label:"Value",width:"70"},{default:u(({row:t})=>[y("div",se,[t.value>0?(n(),v(_,{key:0,color:"#67C23A",size:16},{default:u(()=>[l(x(Y))]),_:1})):(n(),v(_,{key:1,color:"#F56C6C",size:16},{default:u(()=>[l(x(q))]),_:1})),y("span",oe,f(t.value),1)])]),_:1}),l(a,{label:"Current",prop:"current",width:"80"}),l(a,{label:"MSG",prop:"msg"})]),_:1},8,["data"])),[[V,m.value]]),l(P,{layout:"sizes, prev, pager, next",total:o.value.totalCount,"page-size":o.value.pageSize,"page-sizes":[10,20,50],"current-page":o.value.pageNum,class:"mt-2",background:"",onSizeChange:s[1]||(s[1]=t=>S(o.value.pageNum,t)),onCurrentChange:s[2]||(s[2]=t=>S(t,o.value.pageSize))},null,8,["total","page-size","current-page"])])}}});export{pe as default};
