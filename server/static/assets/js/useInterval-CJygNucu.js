import{j as Z,r as C,c as S,v as O,l as A,G as g,o as _,s as L,M as ae,Q as b,$ as D,n as F,D as V,J as R,I as Q,u as ee,k as Y,E as ne,y as le}from"./vue-vendor-BHHKG5q1.js";import{a as se}from"./api-shared-Cud_9YyQ.js";import{m as ie,a as oe,e as re,l as ue}from"./utils-shared-CndaLcYB.js";import"./utils-C3h80Bc3.js";import{B as de,u as ce,c as te,z as fe,A as me,P as pe,C as ve,a7 as ge,E as W,a1 as ye,f as he,ai as _e}from"./element-plus-DeIauL_s.js";import{_ as be}from"./index-CMozoOv3.js";const Pe={class:"m-4"},ke={class:"flex items-center gap-2 mb-2"},xe={class:"flex items-center gap-2 mb-2"},Ce={key:0,class:"text-sm text-blue-600 ml-2"},Ee={class:"flex items-center gap-2"},Fe={key:0},Le={key:1},Te={key:0},De={key:1},we={class:"flex items-center justify-between"},$e={class:"text-sm text-gray-500"},Be={key:0},Ie={key:1},Se={class:"flex gap-2 items-center"},Re={key:0},We=Z({__name:"FileDialog",props:{visible:{type:Boolean,default:!1},title:{default:"é€‰æ‹©æ–‡ä»¶"},defaultPath:{default:"/mnt/ext_base"},extensions:{default:"audio"},confirmButtonText:{default:"ç¡®å®š"},confirmLoading:{type:Boolean,default:!1},mode:{default:"file"}},emits:["update:visible","confirm","close"],setup(p,{emit:E}){const s=p,m=E,n=C(s.defaultPath),r=C([]),d=C(!1),u=C([]),y=C(!1);let h=s.defaultPath;const k=()=>{const l=n.value;y.value=!!(l&&l!=="/mnt/ext_base"&&l!=="/")},e=async()=>{try{d.value=!0;const l=n.value||s.defaultPath,a=await se.get("/listDirectory",{params:{path:l,extensions:s.extensions}});a.data.code===0?(r.value=a.data.data||[],k()):W.error(a.data.msg||"èŽ·å–æ–‡ä»¶åˆ—è¡¨å¤±è´¥")}catch(l){oe(l,"èŽ·å–æ–‡ä»¶åˆ—è¡¨å¤±è´¥")}finally{d.value=!1}},P=()=>{const l=n.value;if(l&&l!=="/mnt/ext_base"&&l!=="/"){const a=String(l).split("/").filter(v=>v);a.pop(),n.value=a.length>0?"/"+a.join("/"):"/mnt/ext_base",k(),e()}},c=()=>{n.value=s.defaultPath,k(),e()},x=l=>{if(l.isDirectory){const a=n.value==="/"?`/${l.name}`:`${n.value}/${l.name}`;n.value=a,k(),e()}else $(l)},$=l=>{if(l.isDirectory)return;const a=n.value==="/"?`/${l.name}`:`${n.value}/${l.name}`,v=u.value.indexOf(a);v>-1?u.value.splice(v,1):u.value.push(a)},B=l=>{if(l.isDirectory)return!1;const a=n.value==="/"?`/${l.name}`:`${n.value}/${l.name}`;return u.value.includes(a)},z=()=>{const l=n.value;r.value.forEach(a=>{if(!a.isDirectory){const v=l==="/"?`/${a.name}`:`${l}/${a.name}`;u.value.includes(v)||u.value.push(v)}})},G=()=>{const l=n.value,a=r.value.filter(v=>!v.isDirectory).map(v=>l==="/"?`/${v.name}`:`${l}/${v.name}`);u.value=u.value.filter(v=>!a.includes(v))},H=()=>{if(String(s.mode||"file").toLowerCase().trim()==="directory"){const a=n.value||s.defaultPath||"/mnt/ext_base";if(String(a).trim()===""){W.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç›®å½•");return}m("confirm",[String(a)])}else{if(u.value.length===0){W.warning("è¯·å…ˆé€‰æ‹©è¦æ·»åŠ çš„æ–‡ä»¶");return}m("confirm",[...u.value])}h=n.value,M()},M=()=>{u.value=[],m("close")},U=S(()=>String(s.mode||"file").toLowerCase().trim()==="directory"?!1:u.value.length===0);return O(()=>s.visible,l=>{l?(n.value=h,u.value=[],e()):u.value=[]}),O(n,()=>{e()}),(l,a)=>{const v=ce,T=te,q=pe,N=ve,K=ge,t=me,o=de,i=fe;return _(),A(o,{"model-value":p.visible,"onUpdate:modelValue":a[1]||(a[1]=f=>l.$emit("update:visible",f)),title:p.title,width:"800","before-close":M},{footer:g(()=>[Y(l.$slots,"footer",{},()=>[L("div",we,[L("span",$e,[p.mode==="file"?(_(),F("span",Be,"æç¤ºï¼šç‚¹å‡»æ–‡ä»¶å¯åˆ‡æ¢é€‰æ‹©çŠ¶æ€ï¼ŒåŒå‡»ç›®å½•å¯è¿›å…¥")):(_(),F("span",Ie,"æç¤ºï¼šé€‰æ‹©ç›®å½•ä½œä¸ºè½¬å­˜ç›®æ ‡ï¼ŒåŒå‡»ç›®å½•å¯è¿›å…¥"))]),L("div",Se,[Y(l.$slots,"footer-prepend"),b(T,{onClick:M},{default:g(()=>[...a[8]||(a[8]=[D("å–æ¶ˆ",-1)])]),_:1}),b(T,{type:"primary",onClick:H,loading:p.confirmLoading,disabled:U.value},{default:g(()=>[D(R(p.confirmButtonText),1),p.mode==="file"?(_(),F("span",Re," ("+R(u.value.length)+")",1)):V("",!0)]),_:1},8,["loading","disabled"])])])])]),default:g(()=>[L("div",Pe,[L("div",ke,[b(v,{"model-value":n.value,placeholder:"å½“å‰è·¯å¾„",readonly:""},null,8,["model-value"]),b(T,{type:"primary",onClick:e,loading:d.value},{default:g(()=>[...a[2]||(a[2]=[D(" åˆ·æ–° ",-1)])]),_:1},8,["loading"])]),L("div",xe,[b(T,{size:"small",onClick:P,disabled:!y.value},{default:g(()=>[...a[3]||(a[3]=[D(" ä¸Šä¸€çº§ ",-1)])]),_:1},8,["disabled"]),b(T,{size:"small",onClick:c},{default:g(()=>[...a[4]||(a[4]=[D(" é¦–é¡µ ",-1)])]),_:1}),b(T,{size:"small",onClick:z},{default:g(()=>[...a[5]||(a[5]=[D(" å…¨é€‰ ",-1)])]),_:1}),b(T,{size:"small",onClick:G},{default:g(()=>[...a[6]||(a[6]=[D(" å–æ¶ˆå…¨é€‰ ",-1)])]),_:1}),u.value.length>0?(_(),F("span",Ce," å·²é€‰æ‹© "+R(u.value.length)+" ä¸ªæ–‡ä»¶ ",1)):V("",!0)])]),ae((_(),A(t,{data:r.value,stripe:"",class:"w-full",height:400,onRowClick:x},{default:g(()=>[b(N,{width:"55"},{default:g(({row:f})=>[f.isDirectory?V("",!0):(_(),A(q,{key:0,"model-value":B(f),onChange:j=>$(f),onClick:a[0]||(a[0]=Q(()=>{},["stop"]))},null,8,["model-value","onChange"]))]),_:1}),b(N,{prop:"name",label:"åç§°","min-width":"200"},{default:g(({row:f})=>[L("div",Ee,[f.isDirectory?(_(),F("span",Fe,"ðŸ“")):(_(),F("span",Le,"ðŸ“„")),L("span",null,R(f.name),1)])]),_:1}),b(N,{prop:"size",label:"å¤§å°",width:"100"},{default:g(({row:f})=>[f.isDirectory?(_(),F("span",De,"-")):(_(),F("span",Te,R(ee(ie)(f.size)),1))]),_:1}),b(N,{label:"çŠ¶æ€",width:"100"},{default:g(({row:f})=>[!f.isDirectory&&B(f)?(_(),A(K,{key:0,type:"success",size:"small"},{default:g(()=>[...a[7]||(a[7]=[D(" å·²é€‰æ‹© ",-1)])]),_:1})):V("",!0)]),_:1})]),_:1},8,["data"])),[[i,d.value]])]),_:3},8,["model-value","title"])}}}),ze={key:0},Me={class:"text-xs text-gray-600 flex-shrink-0 min-width-[35px]"},Ne=Z({__name:"MediaComponent",props:{file:{},player:{},isPlaying:{type:Boolean,default:!1},progress:{default:0},duration:{default:0},disabled:{type:Boolean,default:!1},widthClass:{default:"w-32"}},emits:["play","seek"],setup(p,{emit:E}){const s=p,m=E,n=c=>c?.uri||c?.path||c?.name||"",r=C(!1),d=S(()=>{if(s.player){const c=n(s.file);return s.player.isFilePlaying(c)}return s.isPlaying}),u=S(()=>{if(s.player){const c=n(s.file);return s.player.getFilePlayProgress(c)}return s.progress}),y=S(()=>{if(s.player){const c=n(s.file),x=s.file?.duration||s.duration;return s.player.getFileDuration(c,x)}return s.duration}),h=S(()=>re(y.value)),k=S(()=>s.disabled||r.value),e=()=>{if(!k.value){if(d.value){m("play",s.file);return}r.value=!0,m("play",s.file)}},P=c=>{if(!s.disabled&&d.value){if(s.player){const x=n(s.file);s.player.seekFile(x,c)}m("seek",s.file,c)}};return O([d,y],([c,x])=>{c&&x>0&&(r.value=!1)},{immediate:!0}),O(()=>s.file,()=>{r.value=!1}),(c,x)=>{const $=he,B=te,z=_e;return _(),F("div",{class:ne(["flex items-center gap-1.5 bg-gray-50 rounded border-gray-500 pr-1",p.widthClass])},[b(B,{type:"default",plain:"",size:"small",circle:"",onClick:Q(e,["stop"]),disabled:k.value,loading:r.value&&!d.value,class:"!w-6 !h-6 !p-0 flex-shrink-0 mr-1"},{default:g(()=>[d.value?(_(),F("span",ze,"â¹")):r.value?V("",!0):(_(),A($,{key:1,class:"!w-3 !h-3"},{default:g(()=>[b(ee(ye))]),_:1}))]),_:1},8,["disabled","loading"]),b(z,{"model-value":u.value,min:0,max:100,step:.1,size:"small",class:"flex-1 min-width-[10px] player-slider","show-tooltip":!1,disabled:!d.value||p.disabled,onChange:P,onInput:P,onClick:x[0]||(x[0]=Q(()=>{},["stop"]))},null,8,["model-value","disabled"]),L("span",Me,R(h.value),1)],2)}}}),Je=be(Ne,[["__scopeId","data-v-9b8781cc"]]),I=()=>{},w=0,J=0;function Qe(p={}){const{playingFilePath:E=null,playingFileIndex:s=null,callbacks:m={}}=p,n={onPlay:m.onPlay||I,onPause:m.onPause||I,onTimeUpdate:m.onTimeUpdate||I,onDurationUpdate:m.onDurationUpdate||I,onError:m.onError||I,onEnded:m.onEnded||I},r=C(E),d=C(J),u=C(w),y=C(w),h=C(!1),k=C(s);let e=null,P=null;const c=()=>{e&&(e.currentTime=w)},x=t=>{t>0&&isFinite(t)&&(y.value=t,n.onDurationUpdate(t))},$=()=>{d.value=J,u.value=w,y.value=w,h.value=!1},B=()=>{if(e){try{e.paused||e.pause(),e.currentTime=0,e.removeAttribute("src")}catch{}e=null}},z=()=>{if(!e)return;e.addEventListener("play",o=>{const i=o.target;!i||e!==i||(c(),h.value=!0,n.onPlay(i))});const t=o=>{const i=o.target;!i||e!==i||(c(),x(i.duration))};e.addEventListener("loadedmetadata",t),e.addEventListener("loadeddata",t),e.addEventListener("timeupdate",o=>{const i=o.target;if(!i||e!==i)return;const f=i.duration;if(f>0&&isFinite(f)){const j=i.currentTime,X=j/f*100;u.value=j,d.value=X,y.value!==f&&(y.value=f),n.onTimeUpdate(j,f,X)}}),e.addEventListener("pause",o=>{const i=o.target;!i||e!==i||(h.value=!1,i.ended?n.onEnded(i):n.onPause(i))}),e.addEventListener("error",o=>{const i=o.target;!i||e!==i||(console.error("éŸ³é¢‘æ’­æ”¾å¤±è´¥:",o,"URL:",P),h.value=!1,n.onError(o,P||""))}),e.addEventListener("ended",o=>{const i=o.target;!i||e!==i||(h.value=!1,n.onEnded(i))})},G=(t,o={})=>{if(!t||typeof t!="string"||t.trim()===""){console.error("éŸ³é¢‘URLä¸èƒ½ä¸ºç©ºæˆ–æ— æ•ˆ:",t);return}try{const i=new URL(t,window.location.origin);if(!i.pathname||i.pathname==="/"||i.pathname.endsWith(".html")){console.error("éŸ³é¢‘URLæ ¼å¼æ— æ•ˆï¼Œå¯èƒ½æ˜¯HTMLé¡µé¢:",t);return}}catch{if(t.includes("index.html")||t.endsWith(".html")){console.error("éŸ³é¢‘URLæ ¼å¼æ— æ•ˆï¼Œå¯èƒ½æ˜¯HTMLé¡µé¢:",t);return}}e&&B(),$(),e=new Audio(t),P=t,c(),o.playingFilePath!==void 0&&(r.value=o.playingFilePath),o.playingFileIndex!==void 0&&(k.value=o.playingFileIndex),z()},H=()=>e?e.play().catch(t=>{throw console.error("æ’­æ”¾å¤±è´¥:",t),t}):(console.warn("éŸ³é¢‘æœªåŠ è½½ï¼Œæ— æ³•æ’­æ”¾"),Promise.reject(new Error("éŸ³é¢‘æœªåŠ è½½"))),M=()=>{e&&e.pause()},U=t=>{if(!e){console.warn("éŸ³é¢‘æœªåŠ è½½ï¼Œæ— æ³•è·³è½¬");return}const o=e.duration;if(o>0&&isFinite(o)&&isFinite(t)){const i=Math.max(0,Math.min(t/100*o,o));e.currentTime=i,u.value=i,d.value=t}};return{get audio(){return e},playingFilePath:r,playProgress:d,currentTime:u,duration:y,isPlaying:h,playingFileIndex:k,load:G,play:H,pause:M,seek:U,clear:()=>{if(e){try{e.paused||e.pause(),e.currentTime=w}catch{}B()}P=null,r.value=null,k.value=null,$()},updateCallbacks:t=>{Object.assign(n,t)},isFilePlaying:t=>t?r.value===t&&e!==null&&!e.paused:!1,getFilePlayProgress:t=>!t||r.value!==t||!e?J:d.value,getFileCurrentTime:t=>!t||r.value!==t?w:u.value,getFileDuration:(t,o=w)=>t&&r.value===t&&y.value||o,seekFile:(t,o)=>{!e||!t||r.value===t&&U(o)}}}function Ae(p,E,s={}){const{immediate:m=!1,autoCleanup:n=!0}=s;let r=null,d=E;const u=async()=>{try{await p()}catch(P){ue.error("[useInterval] å®šæ—¶å™¨å›žè°ƒæ‰§è¡Œå¤±è´¥:",P)}},y=()=>{d===null||d<=0||(h(),m&&u(),r=setInterval(u,d))},h=()=>{r!==null&&(clearInterval(r),r=null)},k=P=>{P!==void 0&&(d=P),y()},e=()=>r!==null;return E!==null&&E>0&&y(),n&&le(()=>{h()}),{start:y,stop:h,restart:k,isRunning:e}}function qe(p,E,s={}){let m=E;const n=Ae(p,null,{...s,autoCleanup:!0});return{start:()=>{n.restart(m)},stop:n.stop,restart:r=>{r!==void 0&&(m=r),n.restart(m)},isRunning:n.isRunning}}export{Je as M,We as _,Ae as a,qe as b,Qe as u};
