import{j as Ve,r as Y,v as Ee,l as se,G as a,o as c,s,Q as l,$ as Q,A as Zl,n as k,F as $e,a6 as Ae,J as W,D as ie,u as o,E as Te,I as Fe,M as he,O as Pe,c as ue,q as Oe,t as ot,y as At,e as et,aa as kt}from"./vue-vendor-C-hNZ0TW.js";import{a as le,g as Il,b as mt,d as Ye,f as es,e as gt,h as at,l as qe,n as tt,i as _t,j as ts,k as ls}from"./utils-shared-Ti8AKJ8R.js";import{M as Tt,_ as Mt,u as ss,a as ns}from"./useInterval-6udtbbrf.js";import"./utils-Dtqx8Ray.js";import{t as Qe,a as it,u as Et,v as as,w as is,x as os,y as Lt,z as rs,A as ds,B as us,j as cs,o as fs,C as Re}from"./api-shared-DaBUc0l3.js";import{C as Ze,Z as vs,I as ms,u as pt,c as Ue,E as P,_ as gs,$ as ps,a0 as yt,a1 as Ge,f as He,M as nt,a2 as ys,a3 as hs,a4 as bs,a5 as xs,a6 as ws,a7 as Vt,y as ht,a8 as Xe,m as bt,a9 as Ne,Q as rt,aa as Ut,ab as xt,U as Ds,ac as $s,K as Nt,ad as Cs,ae as Je,Y as Fs,t as zt,af as Ot,A as wt,ag as ks,r as Rt,B as jt,D as Wt,ah as Gt,ai as _s,aj as Ps,ak as Be}from"./element-plus-CTY_Yuy8.js";import{M as Ss,T as lt,A as Bs,D as Pt,a as We,W as st,S as Yt,b as As,V as Ts,P as Ms}from"./constants-shared-BwcKRbUv.js";import"./index-DD0rwcBX.js";import"./vant-Bv_herco.js";import"./vendor-CJeEfH0b.js";import"./types-shared-DXrozTcA.js";const Es={class:"space-y-4 m-4"},Ls={class:"flex items-center gap-2"},Vs={class:"flex items-center gap-2"},Us={class:"flex items-center gap-2"},Ns={class:"flex items-center gap-2"},zs={class:"flex items-center gap-2"},Os={class:"flex items-center gap-2"},Rs={class:"border-t pt-4"},js={class:"flex gap-2"},Ws={class:"border-t pt-4"},Gs={class:"space-y-2"},Ys={class:"flex items-center gap-2 flex-wrap"},Ks=Ve({__name:"CronDialog",props:{visible:{type:Boolean,default:!1},initialCron:{default:""}},emits:["update:visible","apply","preview","close"],setup(e,{emit:S}){const f=e,g=S,L=Y(f.visible),i=Y({second:"*",secondCustom:"",minute:"*",minuteCustom:"",hour:"*",hourCustom:"",day:"*",dayCustom:"",month:"*",monthCustom:"",weekday:"*",weekdayCustom:"",generated:""}),n=$=>{$.second="*",$.secondCustom="",$.minute="*",$.minuteCustom="",$.hour="*",$.hourCustom="",$.day="*",$.dayCustom="",$.month="*",$.monthCustom="",$.weekday="*",$.weekdayCustom="",$.generated=""},m=($,t)=>{try{if(!$||typeof $!="string"){n(t);return}const B=String($).trim().split(/\s+/);let z,E,A,j,U,ne;if(B.length===5){const[de,oe,N,b,T]=B;de==="0"&&oe&&oe.startsWith("*/")?(z="0",E=oe,A=N||"*",j=b||"*",U=T||"*",ne="*"):(E=de,A=oe,j=N,U=b,ne=T,z="0")}else if(B.length===6)[z,E,A,j,U,ne]=B;else{console.warn("Cron 表达式格式错误，部分数量:",B.length),n(t);return}B.length===5||B.length===6?(z==="*"?(t.second="*",t.secondCustom=""):z==="0"?(t.second="0",t.secondCustom=""):(t.second="custom",t.secondCustom=z),E==="*"?(t.minute="*",t.minuteCustom=""):E==="0"?(t.minute="0",t.minuteCustom=""):(E.startsWith("*/"),t.minute="custom",t.minuteCustom=E),A==="*"?(t.hour="*",t.hourCustom=""):A==="0"?(t.hour="0",t.hourCustom=""):(t.hour="custom",t.hourCustom=A),j==="*"?(t.day="*",t.dayCustom=""):(t.day="custom",t.dayCustom=j),U==="*"?(t.month="*",t.monthCustom=""):(t.month="custom",t.monthCustom=U),ne==="*"?(t.weekday="*",t.weekdayCustom=""):ne==="1-5"?(t.weekday="1-5",t.weekdayCustom=""):ne==="0,6"||ne==="6,0"?(t.weekday="0,6",t.weekdayCustom=""):(t.weekday="custom",t.weekdayCustom=ne)):(console.warn("Cron 表达式格式错误，部分数量:",B.length),n(t))}catch(B){console.error("解析 Cron 表达式失败:",B),n(t)}},h=()=>{i.value.generated=Il(i.value)},u=()=>{L.value=!1,g("close")},V=()=>{if(!i.value.generated){P.warning("请先生成 Cron 表达式");return}g("apply",i.value.generated),u()},I=()=>{const $=i.value.generated;if(!$){P.warning("请先生成 Cron 表达式");return}try{const t=mt($,5);g("preview",t)}catch(t){le(t,"预览失败")}},H=$=>{try{m($,i.value),h(),Zl(()=>{i.value.generated&&(g("apply",i.value.generated),P.success("示例已应用"))})}catch(t){le(t,"应用示例失败")}};return Ee(()=>f.visible,$=>{L.value=$,$&&(f.initialCron?m(f.initialCron,i.value):n(i.value),h())},{immediate:!0}),Ee(()=>f.initialCron,$=>{f.visible&&$&&(m($,i.value),h())}),Ee(L,$=>{$!==f.visible&&g("update:visible",$)}),($,t)=>{const B=vs,z=ms,E=pt,A=Ue,j=Ze;return c(),se(j,{modelValue:L.value,"onUpdate:modelValue":t[17]||(t[17]=U=>L.value=U),title:"Cron 表达式生成器",width:"700","before-close":u},{default:a(()=>[s("div",Es,[s("div",null,[t[22]||(t[22]=s("div",{class:"text-sm font-medium mb-2"},"秒 (0-59)",-1)),s("div",Ls,[l(z,{modelValue:i.value.second,"onUpdate:modelValue":t[0]||(t[0]=U=>i.value.second=U),onChange:h,class:"flex items-center"},{default:a(()=>[l(B,{label:"*",class:"!w-[80px]"},{default:a(()=>[...t[18]||(t[18]=[Q("每秒钟",-1)])]),_:1}),l(B,{label:"0",class:"!w-[80px]"},{default:a(()=>[...t[19]||(t[19]=[Q("第0秒",-1)])]),_:1}),l(B,{label:"30",class:"!w-[80px]"},{default:a(()=>[...t[20]||(t[20]=[Q("第30秒",-1)])]),_:1}),l(B,{label:"custom",class:"!w-[80px]"},{default:a(()=>[...t[21]||(t[21]=[Q("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),l(E,{modelValue:i.value.secondCustom,"onUpdate:modelValue":t[1]||(t[1]=U=>i.value.secondCustom=U),placeholder:"例如: 0,30 或 */10",disabled:i.value.second!=="custom",class:"!w-[200px]",onInput:h},null,8,["modelValue","disabled"])])]),s("div",null,[t[27]||(t[27]=s("div",{class:"text-sm font-medium mb-2"},"分 (0-59)",-1)),s("div",Vs,[l(z,{modelValue:i.value.minute,"onUpdate:modelValue":t[2]||(t[2]=U=>i.value.minute=U),onChange:h,class:"flex items-center"},{default:a(()=>[l(B,{label:"*",class:"!w-[80px]"},{default:a(()=>[...t[23]||(t[23]=[Q("每分钟",-1)])]),_:1}),l(B,{label:"0",class:"!w-[80px]"},{default:a(()=>[...t[24]||(t[24]=[Q("第0分",-1)])]),_:1}),l(B,{label:"30",class:"!w-[80px]"},{default:a(()=>[...t[25]||(t[25]=[Q("第30分",-1)])]),_:1}),l(B,{label:"custom",class:"!w-[80px]"},{default:a(()=>[...t[26]||(t[26]=[Q("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),l(E,{modelValue:i.value.minuteCustom,"onUpdate:modelValue":t[3]||(t[3]=U=>i.value.minuteCustom=U),placeholder:"例如: 0,30 或 */15",disabled:i.value.minute!=="custom",class:"!w-[200px]",onInput:h},null,8,["modelValue","disabled"])])]),s("div",null,[t[32]||(t[32]=s("div",{class:"text-sm font-medium mb-2"},"时 (0-23)",-1)),s("div",Us,[l(z,{modelValue:i.value.hour,"onUpdate:modelValue":t[4]||(t[4]=U=>i.value.hour=U),onChange:h,class:"flex items-center"},{default:a(()=>[l(B,{label:"*",class:"!w-[80px]"},{default:a(()=>[...t[28]||(t[28]=[Q("每小时",-1)])]),_:1}),l(B,{label:"0",class:"!w-[80px]"},{default:a(()=>[...t[29]||(t[29]=[Q("0点",-1)])]),_:1}),l(B,{label:"9",class:"!w-[80px]"},{default:a(()=>[...t[30]||(t[30]=[Q("9点",-1)])]),_:1}),l(B,{label:"custom",class:"!w-[80px]"},{default:a(()=>[...t[31]||(t[31]=[Q("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),l(E,{modelValue:i.value.hourCustom,"onUpdate:modelValue":t[5]||(t[5]=U=>i.value.hourCustom=U),placeholder:"例如: 9,12,18 或 */2",disabled:i.value.hour!=="custom",class:"!w-[200px]",onInput:h},null,8,["modelValue","disabled"])])]),s("div",null,[t[37]||(t[37]=s("div",{class:"text-sm font-medium mb-2"},"日 (1-31)",-1)),s("div",Ns,[l(z,{modelValue:i.value.day,"onUpdate:modelValue":t[6]||(t[6]=U=>i.value.day=U),onChange:h,class:"flex items-center"},{default:a(()=>[l(B,{label:"*",class:"!w-[80px]"},{default:a(()=>[...t[33]||(t[33]=[Q("每天",-1)])]),_:1}),l(B,{label:"1",class:"!w-[80px]"},{default:a(()=>[...t[34]||(t[34]=[Q("每月1号",-1)])]),_:1}),l(B,{label:"15",class:"!w-[80px]"},{default:a(()=>[...t[35]||(t[35]=[Q("每月15号",-1)])]),_:1}),l(B,{label:"custom",class:"!w-[80px]"},{default:a(()=>[...t[36]||(t[36]=[Q("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),l(E,{modelValue:i.value.dayCustom,"onUpdate:modelValue":t[7]||(t[7]=U=>i.value.dayCustom=U),placeholder:"例如: 1,15 或 */5",disabled:i.value.day!=="custom",class:"!w-[200px]",onInput:h},null,8,["modelValue","disabled"])])]),s("div",null,[t[42]||(t[42]=s("div",{class:"text-sm font-medium mb-2"},"月 (1-12)",-1)),s("div",zs,[l(z,{modelValue:i.value.month,"onUpdate:modelValue":t[8]||(t[8]=U=>i.value.month=U),onChange:h,class:"flex items-center"},{default:a(()=>[l(B,{label:"*",class:"!w-[80px]"},{default:a(()=>[...t[38]||(t[38]=[Q("每月",-1)])]),_:1}),l(B,{label:"1",class:"!w-[80px]"},{default:a(()=>[...t[39]||(t[39]=[Q("1月",-1)])]),_:1}),l(B,{label:"6",class:"!w-[80px]"},{default:a(()=>[...t[40]||(t[40]=[Q("6月",-1)])]),_:1}),l(B,{label:"custom",class:"!w-[80px]"},{default:a(()=>[...t[41]||(t[41]=[Q("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),l(E,{modelValue:i.value.monthCustom,"onUpdate:modelValue":t[9]||(t[9]=U=>i.value.monthCustom=U),placeholder:"例如: 1,6,12 或 */3",disabled:i.value.month!=="custom",class:"!w-[200px]",onInput:h},null,8,["modelValue","disabled"])])]),s("div",null,[t[47]||(t[47]=s("div",{class:"text-sm font-medium mb-2"},"周 (0-7, 0和7表示周日)",-1)),s("div",Os,[l(z,{modelValue:i.value.weekday,"onUpdate:modelValue":t[10]||(t[10]=U=>i.value.weekday=U),onChange:h,class:"flex items-center"},{default:a(()=>[l(B,{label:"*",class:"!w-[80px]"},{default:a(()=>[...t[43]||(t[43]=[Q("每天",-1)])]),_:1}),l(B,{label:"1-5",class:"!w-[80px]"},{default:a(()=>[...t[44]||(t[44]=[Q("工作日",-1)])]),_:1}),l(B,{label:"0,6",class:"!w-[80px]"},{default:a(()=>[...t[45]||(t[45]=[Q("周末",-1)])]),_:1}),l(B,{label:"custom",class:"!w-[80px]"},{default:a(()=>[...t[46]||(t[46]=[Q("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),l(E,{modelValue:i.value.weekdayCustom,"onUpdate:modelValue":t[11]||(t[11]=U=>i.value.weekdayCustom=U),placeholder:"例如: 1,3,5 或 1-5",disabled:i.value.weekday!=="custom",class:"!w-[200px]",onInput:h},null,8,["modelValue","disabled"])])]),s("div",Rs,[t[50]||(t[50]=s("div",{class:"text-sm font-medium mb-2"},"生成的 Cron 表达式：",-1)),l(E,{modelValue:i.value.generated,"onUpdate:modelValue":t[12]||(t[12]=U=>i.value.generated=U),readonly:"",class:"mb-2"},null,8,["modelValue"]),s("div",js,[l(A,{type:"primary",size:"small",onClick:V},{default:a(()=>[...t[48]||(t[48]=[Q(" 应用 ",-1)])]),_:1}),l(A,{type:"info",size:"small",onClick:I},{default:a(()=>[...t[49]||(t[49]=[Q(" 预览执行时间 ",-1)])]),_:1})])]),s("div",Ws,[t[55]||(t[55]=s("div",{class:"text-sm font-medium mb-2"},"常用示例：",-1)),s("div",Gs,[s("div",Ys,[l(A,{size:"small",onClick:t[13]||(t[13]=U=>H("0 0 * * *"))},{default:a(()=>[...t[51]||(t[51]=[Q(" 每天0点 ",-1)])]),_:1}),l(A,{size:"small",onClick:t[14]||(t[14]=U=>H("0 */30 * * *"))},{default:a(()=>[...t[52]||(t[52]=[Q(" 每30分钟 ",-1)])]),_:1}),l(A,{size:"small",onClick:t[15]||(t[15]=U=>H("0 0 9 * * 1-5"))},{default:a(()=>[...t[53]||(t[53]=[Q(" 工作日9点 ",-1)])]),_:1}),l(A,{size:"small",onClick:t[16]||(t[16]=U=>H("0 0 0 1 * *"))},{default:a(()=>[...t[54]||(t[54]=[Q(" 每月1号0点 ",-1)])]),_:1})])])])])]),_:1},8,["modelValue"])}}}),Hs={key:0},Js={class:"font-medium"},Qs={key:1,class:"text-center text-gray-400 py-4"},qs=Ve({__name:"CronPreviewDialog",props:{visible:{type:Boolean,default:!1},times:{default:()=>[]}},emits:["update:visible","close"],setup(e,{emit:S}){const f=S,g=()=>{f("update:visible",!1),f("close")};return(L,i)=>{const n=gs,m=ps,h=Ze;return c(),se(h,{"model-value":e.visible,title:"Cron 执行时间预览",width:"500","onUpdate:modelValue":i[0]||(i[0]=u=>L.$emit("update:visible",u)),"before-close":g},{default:a(()=>[e.times&&e.times.length>0?(c(),k("div",Hs,[i[1]||(i[1]=s("div",{class:"text-sm text-gray-600 mb-3"},"下5次执行时间：",-1)),l(m,null,{default:a(()=>[(c(!0),k($e,null,Ae(e.times,(u,V)=>(c(),se(n,{key:V,timestamp:u,placement:"top"},{default:a(()=>[s("div",Js,"第 "+W(V+1)+" 次执行",1)]),_:2},1032,["timestamp"]))),128))]),_:1})])):(c(),k("div",Qs," 无法解析 Cron 表达式，请检查格式是否正确 "))]),_:1},8,["model-value"])}}}),Xs={class:"w-64 border rounded p-3 flex flex-col"},Zs={class:"flex items-center justify-between mb-3"},Is={class:"flex items-center gap-1"},en={key:0,class:"flex-1 overflow-y-auto space-y-2 pr-1"},tn=["onClick"],ln={class:"flex items-center justify-between gap-2"},sn={class:"text-sm font-medium truncate flex-1 min-w-0"},nn={class:"flex items-center gap-2 flex-shrink-0"},an={class:"text-xs text-gray-500 whitespace-nowrap flex items-center gap-1"},on={class:"whitespace-nowrap w-5 flex items-center justify-center"},rn={class:"flex items-center justify-center"},dn={class:"text-[10px] text-blue-600 min-h-[14px] flex items-center justify-between"},un={key:0,class:"flex items-center gap-1"},cn={key:1,class:"invisible"},fn={key:2,class:"text-gray-500 flex items-center gap-1"},vn={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},mn=Ve({__name:"PlaylistList",props:{playlistCollection:{},activePlaylistId:{},refreshing:{type:Boolean},autoRefreshEnabled:{type:Boolean}},emits:["select","create","refresh","toggle-auto-refresh","menu-command"],setup(e){const S=f=>{if(!f||!f.schedule||f.schedule.enabled!==1||!f.schedule.cron||typeof f.schedule.cron!="string")return null;try{const g=String(f.schedule.cron).trim();if(!g)return null;const L=mt(g,1);return L&&L.length>0?es(L[0]):null}catch{return null}};return(f,g)=>{const L=yt,i=He,n=Ue,m=bs,h=hs,u=xs;return c(),k("div",Xs,[s("div",Zs,[g[4]||(g[4]=s("h3",{class:"text-base font-semibold"},"播放列表",-1)),s("div",Is,[l(L,{"model-value":e.autoRefreshEnabled,"onUpdate:modelValue":g[0]||(g[0]=V=>f.$emit("toggle-auto-refresh",V)),"active-text":"","inactive-text":"","active-color":"#409eff",size:"small",title:"自动刷新",class:"mr-1"},null,8,["model-value"]),l(n,{type:"primary",size:"small",plain:"",onClick:g[1]||(g[1]=V=>f.$emit("refresh")),loading:e.refreshing,title:"刷新播放列表",class:"!w-8 !h-6 !p-0"},{default:a(()=>[e.refreshing?ie("",!0):(c(),se(i,{key:0},{default:a(()=>[l(o(Ge))]),_:1}))]),_:1},8,["loading"]),l(n,{type:"success",size:"small",onClick:g[2]||(g[2]=V=>f.$emit("create")),title:"新建播放列表",class:"!w-8 !h-6 !p-0"},{default:a(()=>[l(i,null,{default:a(()=>[l(o(nt))]),_:1})]),_:1})])]),e.playlistCollection&&e.playlistCollection.length>0?(c(),k("div",en,[(c(!0),k($e,null,Ae(e.playlistCollection,V=>(c(),k("div",{key:V.id,class:Te(["border rounded px-3 py-2 cursor-pointer hover:bg-gray-50 group min-h-[60px] flex flex-col justify-between",{"border-blue-500 bg-blue-50":V.id===e.activePlaylistId}]),onClick:I=>f.$emit("select",V.id)},[s("div",ln,[s("div",sn,W(V.name),1),s("div",nn,[s("span",an,[l(i,null,{default:a(()=>[l(o(ys),{class:"!w-3 !h-3"})]),_:1}),s("span",on,W((V.pre_lists&&V.pre_lists[o(Ye)()]&&V.pre_lists[o(Ye)()].length||0)+(V.playlist&&V.playlist.length||0)),1)]),s("div",rn,[l(u,{trigger:"click",onCommand:I=>f.$emit("menu-command",I,V.id),onClick:g[3]||(g[3]=Fe(()=>{},["stop"]))},{dropdown:a(()=>[l(h,null,{default:a(()=>[l(m,{command:"copy"},{default:a(()=>[...g[6]||(g[6]=[s("span",null,"复制",-1)])]),_:1}),e.playlistCollection.length>1?(c(),se(m,{key:0,command:"delete",divided:""},{default:a(()=>[...g[7]||(g[7]=[s("span",{class:"text-[#f56c6c]"},"删除",-1)])]),_:1})):ie("",!0)]),_:1})]),default:a(()=>[l(n,{type:"default",size:"small",plain:"",circle:"",class:"!w-5 !h-5 !min-w-5 !p-0 text-xs",title:"更多"},{default:a(()=>[...g[5]||(g[5]=[s("span",{class:"text-base leading-none mb-1"},"»",-1)])]),_:1})]),_:1},8,["onCommand"])])])]),s("div",dn,[S(V)?(c(),k("span",un,[l(i,{class:"!w-3 !h-4"},{default:a(()=>[l(o(ws))]),_:1}),Q(" "+W(S(V)),1)])):(c(),k("span",cn,"占位")),V.trigger_button?(c(),k("span",fn,[l(i,{class:"!w-3 !h-4"},{default:a(()=>[l(o(Vt))]),_:1}),Q(" "+W(V.trigger_button),1)])):ie("",!0)])],10,tn))),128))])):(c(),k("div",vn,' 暂无播放列表，请点击"新建"创建 '))])}}}),gn={class:"border rounded p-2 mb-2"},pn={class:"flex items-center justify-between mb-2"},yn={class:"flex items-center gap-1"},hn={class:"flex items-center gap-1"},bn={class:"text-[10px]"},xn={class:"flex items-center justify-between text-xs text-gray-500 mb-2 pr-2.5"},wn={class:"flex items-center"},Dn={key:0},$n={class:"flex items-center gap-1"},Cn=["draggable","onClick","onDragstart","onDrop"],Fn={class:"text-xs text-gray-500 w-8"},kn=["title"],_n={key:1,class:"w-full border-t border-gray-200"},Pn={key:2,class:"text-sm text-gray-400 text-center py-1"},Sn=Ve({__name:"PreFilesList",props:{playlistStatus:{},selectedWeekdayIndex:{},preFilesDragMode:{type:Boolean},preFilesBatchDeleteMode:{type:Boolean},selectedPreFileIndices:{},preFilesExpanded:{type:Boolean},playlistLoading:{type:Boolean},showMoreActions:{type:Boolean},audioPlayer:{}},emits:["select-weekday","open-file-browser","toggle-drag-mode","toggle-batch-delete-mode","batch-delete","clear","toggle-expand","toggle-selection","drag-start","drag-end","drag-over","drop","play-file","seek-file","move-up","move-down","replace","open-playlist-selector","delete"],setup(e){const S=e,f=()=>S.selectedWeekdayIndex!==null?S.selectedWeekdayIndex:Ye(),g=()=>{const n=S.playlistStatus;if(!n||!n.pre_lists)return[];const m=f();return!Array.isArray(n.pre_lists)||n.pre_lists.length!==7?[]:n.pre_lists[m]||[]},L=n=>{const m=S.playlistStatus;if(!m||!m.pre_lists||!Array.isArray(m.pre_lists)||m.pre_lists.length!==7)return 0;const h=m.pre_lists[n];return Array.isArray(h)?h.length:0},i=()=>{const n=g();return at(n)};return(n,m)=>{const h=Ue,u=ht,V=He,I=rt;return c(),k("div",gn,[s("div",pn,[m[12]||(m[12]=s("div",{class:"text-xs font-semibold text-gray-600 w-39"},"前置文件（播放时优先播放）",-1)),s("div",yn,[s("div",hn,[(c(),k($e,null,Ae(["周一","周二","周三","周四","周五","周六","周日"],(H,$)=>l(h,{key:$,type:e.selectedWeekdayIndex===$||e.selectedWeekdayIndex===null&&o(Ye)()===$?"primary":"default",size:"small",plain:"",onClick:t=>n.$emit("select-weekday",$),title:H,class:"!w-16 !h-6 !p-0 text-xs"},{default:a(()=>[Q(W(H),1),s("span",bn,"["+W(L($))+"]",1)]),_:2},1032,["type","onClick","title"])),64))])])]),s("div",xn,[s("div",wn,[i()>0?(c(),k("span",Dn," 总时长："+W(o(gt)(i())),1)):ie("",!0),g()&&g().length>0?(c(),k("span",{key:1,class:Te(i()>0?"ml-2":"")}," 共 "+W(g().length)+" 首， 当前: "+W(e.playlistStatus?.pre_index!==void 0&&e.playlistStatus.pre_index!==null&&e.playlistStatus.pre_index>=0?e.playlistStatus.pre_index+1:"-")+" / "+W(g().length),3)):ie("",!0),e.playlistStatus?.isPlaying&&e.playlistStatus.in_pre_files===!0?(c(),se(u,{key:2,type:"success",size:"small",class:"ml-2"},{default:a(()=>[...m[13]||(m[13]=[Q(" 播放中 ",-1)])]),_:1})):ie("",!0)]),s("div",$n,[l(h,{type:"primary",size:"small",plain:"",onClick:m[0]||(m[0]=H=>n.$emit("open-file-browser")),disabled:!e.playlistStatus||e.preFilesDragMode||e.preFilesBatchDeleteMode},{default:a(()=>[...m[14]||(m[14]=[Q(" + ",-1)])]),_:1},8,["disabled"]),l(h,{type:e.preFilesDragMode?"success":"default",size:"small",plain:"",class:"!w-8 !h-6",onClick:m[1]||(m[1]=H=>n.$emit("toggle-drag-mode")),disabled:!e.playlistStatus||!g()||g().length===0||e.preFilesBatchDeleteMode,title:e.preFilesDragMode?"点击退出拖拽排序模式":"点击进入拖拽排序模式"},{default:a(()=>[e.preFilesDragMode?(c(),se(V,{key:0},{default:a(()=>[l(o(Xe))]),_:1})):(c(),se(V,{key:1},{default:a(()=>[l(o(bt))]),_:1}))]),_:1},8,["type","disabled","title"]),l(h,{type:e.preFilesBatchDeleteMode?"success":"default",size:"small",plain:"",class:"!w-8 !h-6",onClick:m[2]||(m[2]=H=>n.$emit("toggle-batch-delete-mode")),disabled:!e.playlistStatus||!g()||g().length===0||e.preFilesDragMode,title:e.preFilesBatchDeleteMode?"点击退出批量删除模式":"点击进入批量删除模式"},{default:a(()=>[e.preFilesBatchDeleteMode?(c(),se(V,{key:0},{default:a(()=>[l(o(Xe))]),_:1})):(c(),se(V,{key:1},{default:a(()=>[l(o(Ne))]),_:1}))]),_:1},8,["type","disabled","title"]),he(l(h,{type:"danger",size:"small",plain:"",class:"!w-8 !h-6",onClick:m[3]||(m[3]=H=>n.$emit("batch-delete")),disabled:e.playlistLoading||e.selectedPreFileIndices.length===0,title:`删除选中的 ${e.selectedPreFileIndices.length} 项`},{default:a(()=>[l(V,null,{default:a(()=>[l(o(Ne))]),_:1})]),_:1},8,["disabled","title"]),[[Pe,e.preFilesBatchDeleteMode]]),he(l(h,{type:"default",size:"small",plain:"",class:"!w-8 !h-6",onClick:m[4]||(m[4]=H=>n.$emit("clear")),disabled:!e.playlistStatus||!g()||g().length===0||e.playlistLoading||e.preFilesDragMode,title:"清空列表"},{default:a(()=>[l(V,null,{default:a(()=>[l(o(Ne))]),_:1})]),_:1},8,["disabled"]),[[Pe,e.showMoreActions&&!e.preFilesBatchDeleteMode]])])]),g()&&g().length>0?(c(),k("div",{key:0,class:Te(["overflow-y-scroll scrollbar-overlay",{"max-h-[192px]":!e.preFilesExpanded}])},[(c(!0),k($e,null,Ae(g(),(H,$)=>(c(),k("div",{key:"pre-"+$,class:Te(["flex items-center gap-2 p-1 hover:bg-gray-100 rounded",{"bg-blue-50":Number(e.playlistStatus?.pre_index)===$,"bg-blue-100":e.preFilesBatchDeleteMode&&e.selectedPreFileIndices.includes(Number($)),"cursor-move":e.preFilesDragMode,"cursor-pointer":e.preFilesBatchDeleteMode&&!e.preFilesDragMode,"cursor-default":!e.preFilesDragMode&&!e.preFilesBatchDeleteMode,"select-none":!0}]),draggable:e.preFilesDragMode,onClick:t=>e.preFilesBatchDeleteMode&&!e.preFilesDragMode?n.$emit("toggle-selection",Number($)):null,onDragstart:t=>n.$emit("drag-start",t,Number($)),onDragend:m[8]||(m[8]=t=>n.$emit("drag-end",t)),onDragover:m[9]||(m[9]=Fe(t=>n.$emit("drag-over",t),["prevent"])),onDragleave:m[10]||(m[10]=t=>{const B=t.currentTarget;B&&B.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")}),onDrop:Fe(t=>n.$emit("drop",t,Number($)),["prevent"])},[s("span",Fn,W(Number($)+1),1),s("span",{class:Te(["flex-1 text-sm truncate",{"text-blue-600":Number(e.playlistStatus?.pre_index)===$}]),title:H.uri||""},W(H.uri?H.uri.split("/").pop():""),11,kn),s("div",{class:"flex items-center gap-1 flex-shrink-0",onMousedown:m[6]||(m[6]=Fe(()=>{},["stop"])),onClick:m[7]||(m[7]=Fe(()=>{},["stop"]))},[he(l(Tt,{file:H,player:e.audioPlayer,disabled:e.playlistLoading,onPlay:t=>n.$emit("play-file",H),onSeek:(t,B)=>n.$emit("seek-file",t,B)},null,8,["file","player","disabled","onPlay","onSeek"]),[[Pe,!e.preFilesBatchDeleteMode]]),he(l(I,{class:"!h-6","model-value":e.selectedPreFileIndices.includes(Number($)),onChange:t=>n.$emit("toggle-selection",Number($)),onClick:m[5]||(m[5]=Fe(()=>{},["stop"]))},null,8,["model-value","onChange"]),[[Pe,e.preFilesBatchDeleteMode]]),he(l(h,{type:"default",size:"small",plain:"",circle:"",onClick:Fe(t=>n.$emit("move-up",Number($)),["stop"]),disabled:Number($)===0||e.playlistLoading,title:"上移"},{default:a(()=>[...m[15]||(m[15]=[Q(" ↑ ",-1)])]),_:1},8,["onClick","disabled"]),[[Pe,e.showMoreActions&&!e.preFilesDragMode&&!e.preFilesBatchDeleteMode]]),he(l(h,{type:"default",size:"small",plain:"",circle:"",onClick:Fe(t=>n.$emit("move-down",Number($)),["stop"]),disabled:Number($)===g().length-1||e.playlistLoading,title:"下移"},{default:a(()=>[...m[16]||(m[16]=[Q(" ↓ ",-1)])]),_:1},8,["onClick","disabled"]),[[Pe,e.showMoreActions&&!e.preFilesDragMode&&!e.preFilesBatchDeleteMode]]),he(l(h,{type:"default",size:"small",plain:"",circle:"",onClick:Fe(t=>n.$emit("replace",Number($)),["stop"]),disabled:e.playlistLoading,title:"替换"},{default:a(()=>[l(V,null,{default:a(()=>[l(o(Ge))]),_:1})]),_:1},8,["onClick","disabled"]),[[Pe,e.showMoreActions&&!e.preFilesDragMode&&!e.preFilesBatchDeleteMode]]),he(l(h,{type:"info",size:"small",plain:"",circle:"",onClick:Fe(t=>n.$emit("open-playlist-selector",H),["stop"]),disabled:e.playlistLoading,title:"应用到列表"},{default:a(()=>[l(V,null,{default:a(()=>[l(o(Ut))]),_:1})]),_:1},8,["onClick","disabled"]),[[Pe,!e.preFilesBatchDeleteMode&&!e.preFilesDragMode]]),he(l(h,{type:"default",size:"small",plain:"",circle:"",onClick:Fe(t=>n.$emit("delete",Number($)),["stop"]),disabled:e.playlistLoading||e.preFilesDragMode,title:"删除"},{default:a(()=>[l(V,null,{default:a(()=>[l(o(xt))]),_:1})]),_:1},8,["onClick","disabled"]),[[Pe,!e.preFilesBatchDeleteMode]])],32)],42,Cn))),128))],2)):ie("",!0),g()&&g().length>0?(c(),k("div",_n,[l(h,{type:"default",size:"small",plain:"",class:"!w-full !h-4 !p-0 !text-xs",onClick:m[11]||(m[11]=H=>n.$emit("toggle-expand")),title:e.preFilesExpanded?"折叠":"展开"},{default:a(()=>[e.preFilesExpanded?(c(),se(V,{key:0},{default:a(()=>[l(o(Ds))]),_:1})):(c(),se(V,{key:1},{default:a(()=>[l(o($s))]),_:1}))]),_:1},8,["title"])])):(c(),k("div",Pn,"前置文件列表为空"))])}}}),Bn={key:0,class:"border rounded p-2"},An={class:"flex items-center justify-between mb-2 pr-2.5"},Tn={class:"text-xs font-semibold text-gray-600"},Mn={key:0,class:"ml-2 text-gray-500"},En={key:1,class:"ml-2 text-gray-500"},Ln={class:"flex items-center gap-1"},Vn={key:0,class:"overflow-y-scroll scrollbar-overlay"},Un=["draggable","onClick","onDragstart","onDrop"],Nn={class:"text-xs text-gray-500 w-8"},zn=["title"],On={key:1,class:"text-sm text-gray-400 text-center py-1"},Rn=Ve({__name:"FilesList",props:{playlistStatus:{},filesDragMode:{type:Boolean},filesBatchDeleteMode:{type:Boolean},selectedFileIndices:{},playlistLoading:{type:Boolean},showMoreActions:{type:Boolean},audioPlayer:{}},emits:["open-file-browser","toggle-drag-mode","toggle-batch-delete-mode","batch-delete","clear","toggle-selection","drag-start","drag-end","drag-over","drop","play-file","seek-file","move-up","move-down","replace","open-playlist-selector","delete"],setup(e,{emit:S}){const f=e,g=S,L={plain:!0,size:"small",class:"!w-8 !h-6"},i={type:"default",size:"small",plain:!0,circle:!0},n=ue(()=>f.playlistStatus?.playlist||[]),m=ue(()=>n.value.length),h=ue(()=>f.playlistStatus?.current_index??-1),u=ue(()=>h.value>=0?h.value+1:"-"),V=ue(()=>f.playlistStatus?.isPlaying&&!f.playlistStatus.in_pre_files),I=ue(()=>m.value>0),H=ue(()=>I.value?at(n.value):0),$=ue(()=>f.filesBatchDeleteMode&&I.value&&!f.filesDragMode),t=ue(()=>f.showMoreActions&&!f.filesDragMode&&!f.filesBatchDeleteMode),B=ue(()=>f.showMoreActions&&!f.filesBatchDeleteMode),z=ue(()=>!f.filesBatchDeleteMode&&!f.filesDragMode),E=ue(()=>!f.playlistStatus||f.filesDragMode||f.filesBatchDeleteMode),A=ue(()=>!I.value||f.filesBatchDeleteMode),j=ue(()=>!I.value||f.filesDragMode),U=ue(()=>f.playlistLoading||f.selectedFileIndices.length===0),ne=ue(()=>`删除选中的 ${f.selectedFileIndices.length} 项`),de=ue(()=>!I.value||f.playlistLoading||f.filesDragMode),oe=X=>X?X.split("/").pop():"",N=X=>f.selectedFileIndices.includes(X),b=X=>X===h.value,T=X=>({"bg-blue-50":b(X),"bg-blue-100":$.value&&N(X),"cursor-move":f.filesDragMode,"cursor-pointer":$.value,"cursor-default":!f.filesDragMode&&!f.filesBatchDeleteMode}),w=ue(()=>f.playlistLoading||f.filesDragMode),R=X=>{$.value&&g("toggle-selection",X)},p=(X,G)=>{g("drag-start",X,G)},q=X=>{g("drag-end",X)},Z=X=>{g("drag-over",X)},d=X=>{const G=X.currentTarget;G?.classList&&G.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")},_=(X,G)=>{g("drop",X,G)},D=(X,G)=>{g("seek-file",X,G)};return(X,G)=>{const ce=ht,ge=Ue,fe=He,Le=rt;return e.playlistStatus?.playlist?(c(),k("div",Bn,[s("div",An,[s("div",Tn,[G[9]||(G[9]=Q(" 正式文件（播放时记录进度） ",-1)),H.value>0?(c(),k("span",Mn," 总时长："+W(o(gt)(H.value)),1)):ie("",!0),I.value?(c(),k("span",En," 共 "+W(m.value)+" 首， 当前: "+W(u.value)+" / "+W(m.value),1)):ie("",!0),V.value?(c(),se(ce,{key:2,type:"success",size:"small",class:"ml-2"},{default:a(()=>[...G[8]||(G[8]=[Q(" 播放中 ",-1)])]),_:1})):ie("",!0)]),s("div",Ln,[l(ge,Oe({type:"primary"},L,{onClick:G[0]||(G[0]=ke=>g("open-file-browser")),disabled:E.value}),{default:a(()=>[...G[10]||(G[10]=[Q(" + ",-1)])]),_:1},16,["disabled"]),l(ge,Oe({type:e.filesDragMode?"success":"default"},L,{onClick:G[1]||(G[1]=ke=>g("toggle-drag-mode")),disabled:A.value,title:e.filesDragMode?"点击退出拖拽排序模式":"点击进入拖拽排序模式"}),{default:a(()=>[e.filesDragMode?(c(),se(fe,{key:0},{default:a(()=>[l(o(Xe))]),_:1})):(c(),se(fe,{key:1},{default:a(()=>[l(o(bt))]),_:1}))]),_:1},16,["type","disabled","title"]),l(ge,Oe({type:e.filesBatchDeleteMode?"success":"default"},L,{onClick:G[2]||(G[2]=ke=>g("toggle-batch-delete-mode")),disabled:j.value,title:e.filesBatchDeleteMode?"点击退出批量删除模式":"点击进入批量删除模式"}),{default:a(()=>[e.filesBatchDeleteMode?(c(),se(fe,{key:0},{default:a(()=>[l(o(Xe))]),_:1})):(c(),se(fe,{key:1},{default:a(()=>[l(o(Ne))]),_:1}))]),_:1},16,["type","disabled","title"]),he(l(ge,Oe({type:"danger"},L,{onClick:G[3]||(G[3]=ke=>g("batch-delete")),disabled:U.value,title:ne.value}),{default:a(()=>[l(fe,null,{default:a(()=>[l(o(Ne))]),_:1})]),_:1},16,["disabled","title"]),[[Pe,e.filesBatchDeleteMode]]),he(l(ge,Oe({type:"default"},L,{onClick:G[4]||(G[4]=ke=>g("clear")),disabled:de.value,title:"清空正式文件列表"}),{default:a(()=>[l(fe,null,{default:a(()=>[l(o(Ne))]),_:1})]),_:1},16,["disabled"]),[[Pe,B.value]])])]),I.value?(c(),k("div",Vn,[(c(!0),k($e,null,Ae(n.value,(ke,De)=>(c(),k("div",{key:ke.uri||De,class:Te(["flex items-center gap-2 p-1 hover:bg-gray-100 rounded select-none",T(De)]),draggable:e.filesDragMode,onClick:Se=>R(De),onDragstart:Se=>p(Se,De),onDragend:q,onDragover:Fe(Z,["prevent"]),onDragleave:d,onDrop:Fe(Se=>_(Se,De),["prevent"])},[s("span",Nn,W(De+1),1),s("span",{class:Te(["flex-1 text-sm truncate",{"text-blue-600":b(De)}]),title:ke.uri||""},W(oe(ke.uri)),11,zn),s("div",{class:"flex items-center gap-1 flex-shrink-0",onMousedown:G[6]||(G[6]=Fe(()=>{},["stop"])),onClick:G[7]||(G[7]=Fe(()=>{},["stop"]))},[he(l(Tt,{file:ke,player:e.audioPlayer,disabled:e.playlistLoading,onPlay:Se=>g("play-file",ke),onSeek:D},null,8,["file","player","disabled","onPlay"]),[[Pe,!e.filesBatchDeleteMode]]),he(l(Le,{class:"!h-6","model-value":N(De),onChange:Se=>g("toggle-selection",De),onClick:G[5]||(G[5]=Fe(()=>{},["stop"]))},null,8,["model-value","onChange"]),[[Pe,e.filesBatchDeleteMode]]),he(l(ge,Oe({ref_for:!0},i,{onClick:Fe(Se=>g("move-up",De),["stop"]),disabled:De===0||e.playlistLoading,title:"上移"}),{default:a(()=>[...G[11]||(G[11]=[Q(" ↑ ",-1)])]),_:1},16,["onClick","disabled"]),[[Pe,t.value]]),he(l(ge,Oe({ref_for:!0},i,{onClick:Fe(Se=>g("move-down",De),["stop"]),disabled:De===m.value-1||e.playlistLoading,title:"下移"}),{default:a(()=>[...G[12]||(G[12]=[Q(" ↓ ",-1)])]),_:1},16,["onClick","disabled"]),[[Pe,t.value]]),he(l(ge,Oe({ref_for:!0},i,{onClick:Fe(Se=>g("replace",De),["stop"]),disabled:e.playlistLoading,title:"替换"}),{default:a(()=>[l(fe,null,{default:a(()=>[l(o(Ge))]),_:1})]),_:1},16,["onClick","disabled"]),[[Pe,t.value]]),he(l(ge,{type:"info",size:"small",plain:"",circle:"",onClick:Fe(Se=>g("open-playlist-selector",ke),["stop"]),disabled:e.playlistLoading,title:"应用到列表"},{default:a(()=>[l(fe,null,{default:a(()=>[l(o(Ut))]),_:1})]),_:1},8,["onClick","disabled"]),[[Pe,z.value]]),he(l(ge,Oe({ref_for:!0},i,{onClick:Fe(Se=>g("delete",De),["stop"]),disabled:w.value,title:"删除"}),{default:a(()=>[l(fe,null,{default:a(()=>[l(o(xt))]),_:1})]),_:1},16,["onClick","disabled"]),[[Pe,!e.filesBatchDeleteMode]])],32)],42,Un))),128))])):(c(),k("div",On,"正式文件列表为空"))])):ie("",!0)}}}),jn={class:"flex-1 border rounded p-3 flex flex-col"},Wn={class:"flex items-center justify-between mb-3"},Gn={class:"flex-1"},Yn={key:0,class:"flex items-center gap-2 mb-1"},Kn={class:"flex items-center gap-2 flex-1"},Hn={class:"text-lg font-semibold truncate"},Jn={key:1},Qn={key:2,class:"text-sm text-gray-500"},qn={key:0,class:"mr-2"},Xn={class:"flex flex-wrap gap-2"},Zn={key:1},In={key:1},ea={key:1},ta={key:1},la={key:0,class:"flex-1 overflow-y-scroll scrollbar-overlay"},sa={key:0,class:"text-sm text-gray-400 text-center py-8"},na={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},aa=Ve({__name:"FileListPanel",props:{playlistStatus:{},activePlaylistId:{},editingPlaylistId:{},editingPlaylistName:{},selectedWeekdayIndex:{},preFilesDragMode:{type:Boolean},preFilesBatchDeleteMode:{type:Boolean},selectedPreFileIndices:{},preFilesExpanded:{type:Boolean},filesDragMode:{type:Boolean},filesBatchDeleteMode:{type:Boolean},selectedFileIndices:{},playlistLoading:{type:Boolean},playing:{type:Boolean},stopping:{type:Boolean},showMoreActions:{type:Boolean},audioPlayer:{}},emits:["update:editingPlaylistName","start-edit-name","save-name","cancel-edit-name","open-batch-drawer","play","play-pre","play-next","stop","clear","toggle-more-actions","select-weekday","open-file-browser-for-pre-files","toggle-pre-files-drag-mode","toggle-pre-files-batch-delete-mode","batch-delete-pre-files","clear-pre-files","toggle-pre-files-expand","toggle-pre-file-selection","pre-file-drag-start","pre-file-drag-end","pre-file-drag-over","pre-file-drop","open-file-browser","toggle-files-drag-mode","toggle-files-batch-delete-mode","batch-delete-files","clear-files","toggle-file-selection","file-drag-start","file-drag-end","file-drag-over","file-drop","play-file","seek-file","move-pre-file-up","move-pre-file-down","replace-pre-file","open-playlist-selector-for-pre-file","delete-pre-file","move-file-up","move-file-down","replace-file","open-playlist-selector-for-file","delete-file"],setup(e){const S=e,f=()=>S.selectedWeekdayIndex!==null?S.selectedWeekdayIndex:Ye(),g=()=>{const i=S.playlistStatus;if(!i||!i.pre_lists)return[];const n=f();return!Array.isArray(i.pre_lists)||i.pre_lists.length!==7?[]:i.pre_lists[n]||[]},L=()=>{const i=S.playlistStatus;if(!i)return 0;const n=g(),m=at(n),h=i.playlist||[],u=at(h);return m+u};return(i,n)=>{const m=He,h=Ue;return c(),k("div",jn,[s("div",Wn,[s("div",Gn,[e.playlistStatus?(c(),k("div",Yn,[s("div",Kn,[s("h3",Hn,W(e.playlistStatus.name),1),l(h,{type:"default",size:"small",plain:"",circle:"",onClick:n[0]||(n[0]=u=>i.$emit("start-edit-name",e.activePlaylistId)),title:"编辑名称"},{default:a(()=>[l(m,null,{default:a(()=>[l(o(Nt))]),_:1})]),_:1})])])):(c(),k("div",Jn,[...n[44]||(n[44]=[s("h3",{class:"text-lg font-semibold"},"播放列表文件",-1)])])),e.playlistStatus?(c(),k("div",Qn,[L()>0?(c(),k("span",qn," 总时长："+W(o(gt)(L())),1)):ie("",!0),e.playlistStatus?(c(),k($e,{key:1},[(g()?.length||0)+(e.playlistStatus.playlist?.length||0)>0?(c(),k($e,{key:0},[Q(" 共 "+W((g()?.length||0)+(e.playlistStatus.playlist?.length||0))+" 首， 当前: ",1),e.playlistStatus.pre_index!==void 0&&e.playlistStatus.pre_index!==null&&e.playlistStatus.pre_index>=0?(c(),k($e,{key:0},[Q(W(e.playlistStatus.pre_index+1),1)],64)):e.playlistStatus.current_index!==void 0&&e.playlistStatus.current_index!==null&&e.playlistStatus.current_index>=0?(c(),k($e,{key:1},[Q(W((g()?.length||0)+e.playlistStatus.current_index+1),1)],64)):(c(),k($e,{key:2},[Q(" - ")],64)),Q(" / "+W((g()?.length||0)+(e.playlistStatus.playlist?.length||0)),1)],64)):(c(),k($e,{key:1},[Q(" 共 0 首， 当前: - / 0 ")],64))],64)):ie("",!0)])):ie("",!0)]),s("div",Xn,[l(h,{type:"default",size:"small",plain:"",circle:"",onClick:n[1]||(n[1]=u=>i.$emit("open-batch-drawer")),title:"批量模式"},{default:a(()=>[l(m,null,{default:a(()=>[l(o(Cs))]),_:1})]),_:1}),l(h,{type:"default",size:"small",plain:"",circle:"",onClick:n[2]||(n[2]=u=>i.$emit("play")),class:"items-center justify-center",disabled:!e.playlistStatus||!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0||!!e.playlistStatus.isPlaying,title:"播放"},{default:a(()=>[e.playing?(c(),se(m,{key:0,size:"12",class:"animate-spin"},{default:a(()=>[l(o(Je))]),_:1})):(c(),k("span",Zn,"▶"))]),_:1},8,["disabled"]),l(h,{type:"default",size:"small",plain:"",circle:"",onClick:n[3]||(n[3]=u=>i.$emit("play-pre")),disabled:!e.playlistStatus||(!g()||g().length===0)&&(!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0),title:"上一首"},{default:a(()=>[e.playing?(c(),se(m,{key:0,size:"12",class:"animate-spin"},{default:a(()=>[l(o(Je))]),_:1})):(c(),k("span",In,"⏮"))]),_:1},8,["disabled"]),l(h,{type:"default",size:"small",plain:"",circle:"",onClick:n[4]||(n[4]=u=>i.$emit("play-next")),disabled:!e.playlistStatus||(!g()||g().length===0)&&(!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0),title:"下一首"},{default:a(()=>[e.playing?(c(),se(m,{key:0,size:"12",class:"animate-spin"},{default:a(()=>[l(o(Je))]),_:1})):(c(),k("span",ea,"⏭"))]),_:1},8,["disabled"]),l(h,{type:"default",size:"small",plain:"",circle:"",onClick:n[5]||(n[5]=u=>i.$emit("stop")),title:"停止"},{default:a(()=>[e.stopping?(c(),se(m,{key:0,size:"12",class:"animate-spin"},{default:a(()=>[l(o(Je))]),_:1})):(c(),k("span",ta,"⏹"))]),_:1}),he(l(h,{type:"default",size:"small",plain:"",circle:"",onClick:n[6]||(n[6]=u=>i.$emit("clear")),disabled:!e.playlistStatus||(!g()||g().length===0)&&(!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0)||e.playlistLoading,title:"清空列表（包括前置文件和正式文件）"},{default:a(()=>[l(m,null,{default:a(()=>[l(o(Ne))]),_:1})]),_:1},8,["disabled"]),[[Pe,e.showMoreActions]]),l(h,{type:"default",size:"small",plain:"",circle:"",onClick:n[7]||(n[7]=u=>i.$emit("toggle-more-actions")),title:"更多"},{default:a(()=>[l(m,null,{default:a(()=>[l(o(bt))]),_:1})]),_:1})])]),e.playlistStatus?(c(),k("div",la,[l(Sn,{"playlist-status":e.playlistStatus,"selected-weekday-index":e.selectedWeekdayIndex,"pre-files-drag-mode":e.preFilesDragMode,"pre-files-batch-delete-mode":e.preFilesBatchDeleteMode,"selected-pre-file-indices":e.selectedPreFileIndices,"pre-files-expanded":e.preFilesExpanded,"playlist-loading":e.playlistLoading,"show-more-actions":e.showMoreActions,"audio-player":e.audioPlayer,onSelectWeekday:n[8]||(n[8]=u=>i.$emit("select-weekday",u)),onOpenFileBrowser:n[9]||(n[9]=u=>i.$emit("open-file-browser-for-pre-files")),onToggleDragMode:n[10]||(n[10]=u=>i.$emit("toggle-pre-files-drag-mode")),onToggleBatchDeleteMode:n[11]||(n[11]=u=>i.$emit("toggle-pre-files-batch-delete-mode")),onBatchDelete:n[12]||(n[12]=u=>i.$emit("batch-delete-pre-files")),onClear:n[13]||(n[13]=u=>i.$emit("clear-pre-files")),onToggleExpand:n[14]||(n[14]=u=>i.$emit("toggle-pre-files-expand")),onToggleSelection:n[15]||(n[15]=u=>i.$emit("toggle-pre-file-selection",u)),onDragStart:n[16]||(n[16]=(u,V)=>i.$emit("pre-file-drag-start",u,V)),onDragEnd:n[17]||(n[17]=u=>i.$emit("pre-file-drag-end",u)),onDragOver:n[18]||(n[18]=u=>i.$emit("pre-file-drag-over",u)),onDrop:n[19]||(n[19]=(u,V)=>i.$emit("pre-file-drop",u,V)),onPlayFile:n[20]||(n[20]=u=>i.$emit("play-file",u)),onSeekFile:n[21]||(n[21]=(u,V)=>i.$emit("seek-file",u,V)),onMoveUp:n[22]||(n[22]=u=>i.$emit("move-pre-file-up",u)),onMoveDown:n[23]||(n[23]=u=>i.$emit("move-pre-file-down",u)),onReplace:n[24]||(n[24]=u=>i.$emit("replace-pre-file",u)),onOpenPlaylistSelector:n[25]||(n[25]=u=>i.$emit("open-playlist-selector-for-pre-file",u)),onDelete:n[26]||(n[26]=u=>i.$emit("delete-pre-file",u))},null,8,["playlist-status","selected-weekday-index","pre-files-drag-mode","pre-files-batch-delete-mode","selected-pre-file-indices","pre-files-expanded","playlist-loading","show-more-actions","audio-player"]),l(Rn,{"playlist-status":e.playlistStatus,"files-drag-mode":e.filesDragMode,"files-batch-delete-mode":e.filesBatchDeleteMode,"selected-file-indices":e.selectedFileIndices,"playlist-loading":e.playlistLoading,"show-more-actions":e.showMoreActions,"audio-player":e.audioPlayer,onOpenFileBrowser:n[27]||(n[27]=u=>i.$emit("open-file-browser")),onToggleDragMode:n[28]||(n[28]=u=>i.$emit("toggle-files-drag-mode")),onToggleBatchDeleteMode:n[29]||(n[29]=u=>i.$emit("toggle-files-batch-delete-mode")),onBatchDelete:n[30]||(n[30]=u=>i.$emit("batch-delete-files")),onClear:n[31]||(n[31]=u=>i.$emit("clear-files")),onToggleSelection:n[32]||(n[32]=u=>i.$emit("toggle-file-selection",u)),onDragStart:n[33]||(n[33]=(u,V)=>i.$emit("file-drag-start",u,V)),onDragEnd:n[34]||(n[34]=u=>i.$emit("file-drag-end",u)),onDragOver:n[35]||(n[35]=u=>i.$emit("file-drag-over",u)),onDrop:n[36]||(n[36]=(u,V)=>i.$emit("file-drop",u,V)),onPlayFile:n[37]||(n[37]=u=>i.$emit("play-file",u)),onSeekFile:n[38]||(n[38]=(u,V)=>i.$emit("seek-file",u,V)),onMoveUp:n[39]||(n[39]=u=>i.$emit("move-file-up",u)),onMoveDown:n[40]||(n[40]=u=>i.$emit("move-file-down",u)),onReplace:n[41]||(n[41]=u=>i.$emit("replace-file",u)),onOpenPlaylistSelector:n[42]||(n[42]=u=>i.$emit("open-playlist-selector-for-file",u)),onDelete:n[43]||(n[43]=u=>i.$emit("delete-file",u))},null,8,["playlist-status","files-drag-mode","files-batch-delete-mode","selected-file-indices","playlist-loading","show-more-actions","audio-player"]),(!g()||g().length===0)&&(!e.playlistStatus?.playlist||e.playlistStatus.playlist.length===0)?(c(),k("div",sa,' 当前播放列表为空，点击"添加文件"开始构建播放列表 ')):ie("",!0)])):(c(),k("div",na," 请先在左侧选择一个播放列表查看详情 "))])}}}),ia={class:"w-80 min-w-75 border rounded p-3 flex flex-col"},oa={key:0,class:"mb-3 flex items-center gap-2 flex-wrap"},ra={key:1,class:"flex-1 overflow-y-auto space-y-4"},da={class:"border rounded p-3"},ua={class:"flex items-center justify-between mb-2"},ca={class:"space-y-2"},fa={class:"flex items-center gap-2"},va={class:"flex items-start gap-4"},ma={class:"flex-1"},ga={class:"flex-1"},pa={key:0},ya={class:"border rounded p-3"},ha={class:"space-y-2"},ba={class:"flex items-center gap-2"},xa={class:"flex items-center gap-2"},wa={class:"text-xs text-gray-600 mb-1 flex items-center gap-2"},Da={key:0,class:"text-xs text-gray-500"},$a={class:"flex items-center gap-2"},Ca={class:"mt-3"},Fa={class:"flex items-center justify-between mb-2"},ka={class:"text-xs font-semibold text-gray-700"},_a={key:0},Pa={class:"space-y-2 max-h-[200px] overflow-y-auto"},Sa={class:"flex-1 min-w-0"},Ba={class:"text-sm font-medium truncate"},Aa={class:"text-xs text-gray-500 truncate"},Ta={class:"flex-shrink-0"},Ma={key:0,class:"text-xs text-gray-400 text-center py-4"},Ea={key:1},La={class:"space-y-2 max-h-[200px] overflow-y-auto"},Va={class:"flex-1 min-w-0"},Ua={class:"text-sm font-medium truncate"},Na=["title"],za={class:"flex-shrink-0"},Oa={key:0,class:"text-xs text-gray-400 text-center py-4"},Ra={key:2},ja={class:"space-y-2 max-h-[200px] overflow-y-auto"},Wa={class:"flex-1 min-w-0"},Ga={class:"text-sm font-medium truncate"},Ya=["title"],Ka={class:"flex-shrink-0"},Ha={key:0,class:"text-xs text-gray-400 text-center py-4"},Ja={key:2,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},Qa=Ve({__name:"ConfigPanel",props:{playlistStatus:{},connectedDeviceList:{},dlnaDeviceList:{},miDeviceList:{},loading:{type:Boolean},dlnaScanning:{type:Boolean},miScanning:{type:Boolean},onToggleCronEnabled:{type:Function},onUpdateCron:{type:Function},onUpdateDuration:{type:Function},onUpdateTriggerButton:{type:Function},onOpenCronBuilder:{type:Function},onPreviewCron:{type:Function},onUpdateDeviceType:{type:Function},onUpdateDeviceVolume:{type:Function},onUpdateDeviceAddress:{type:Function},onSelectBluetoothDevice:{type:Function},onSelectAgentDevice:{type:Function},onSelectMiDevice:{type:Function},onScanDlnaDevices:{type:Function},onScanMiDevices:{type:Function},onOpenScanDialog:{type:Function},onOpenDeviceList:{type:Function}},setup(e){const S=e,f=ue(()=>S.playlistStatus?.device?.type||S.playlistStatus?.device_type||null),g=ue(()=>S.playlistStatus?.device?.address||S.playlistStatus?.device_address||""),L=ue(()=>{const z=S.playlistStatus?.device_volume;return z??20}),i=Y(L.value),n=z=>Math.max(5,Math.min(100,z)),m=z=>{const E=n(z);S.onUpdateDeviceVolume(E)};Ee(L,z=>{i.value=z},{immediate:!0});const h=z=>ue(()=>f.value===z),u=ue(()=>{const z=f.value;return z==="agent"||z==="bluetooth"}),V=h("dlna"),I=h("mi"),H=ue(()=>u.value?"已配对的设备":V.value?"DLNA 设备":I.value?"小米设备":"设备列表"),$=ue(()=>u.value?"扫描设备":V.value?"扫描 DLNA 设备":I.value?"扫描小米设备":"扫描设备"),t=ue(()=>S.dlnaScanning||S.miScanning),B=()=>{u.value?S.onOpenScanDialog():V.value?S.onScanDlnaDevices():I.value&&S.onScanMiDevices()};return(z,E)=>{const A=He,j=Ue,U=yt,ne=pt,de=Fs,oe=Rt,N=zt,b=Ot,T=wt;return c(),k("div",ia,[E[23]||(E[23]=s("h3",{class:"text-lg font-semibold mb-3"},"配置详情",-1)),e.playlistStatus?(c(),k("div",oa,[l(j,{type:"default",onClick:e.onOpenDeviceList,title:"打开设备列表"},{default:a(()=>[l(A,null,{default:a(()=>[l(o(ks))]),_:1}),E[6]||(E[6]=s("span",{class:"ml-1"},"设备列表",-1))]),_:1},8,["onClick"])])):ie("",!0),e.playlistStatus?(c(),k("div",ra,[s("div",da,[s("div",ua,[E[7]||(E[7]=s("h4",{class:"text-sm font-semibold"},"定时任务 (Cron)",-1)),l(U,{"model-value":e.playlistStatus.schedule?.enabled===1,onChange:E[0]||(E[0]=w=>e.onToggleCronEnabled(w)),"active-text":"开启","inactive-text":"关闭"},null,8,["model-value"])]),s("div",ca,[s("div",null,[E[9]||(E[9]=s("div",{class:"text-xs text-gray-600 mb-1"},"Cron 表达式",-1)),s("div",fa,[l(ne,{"model-value":e.playlistStatus.schedule?.cron||"",onInput:E[1]||(E[1]=w=>e.onUpdateCron(w)),placeholder:"例如: 0 0 * * *",size:"small",disabled:e.playlistStatus.schedule?.enabled!==1},null,8,["model-value","disabled"]),l(j,{type:"info",size:"small",onClick:e.onOpenCronBuilder,disabled:e.playlistStatus.schedule?.enabled!==1},{default:a(()=>[...E[8]||(E[8]=[Q(" 助手 ",-1)])]),_:1},8,["onClick","disabled"])])]),s("div",va,[s("div",ma,[E[10]||(E[10]=s("div",{class:"text-xs text-gray-600 mb-1"},"持续时间（分钟）",-1)),l(de,{"model-value":e.playlistStatus.schedule?.duration||0,onChange:e.onUpdateDuration,min:0,max:o(Ss),step:1,size:"small",disabled:e.playlistStatus.schedule?.enabled!==1,class:"w-full"},null,8,["model-value","onChange","max","disabled"]),E[11]||(E[11]=s("div",{class:"text-xs text-gray-500 mt-1"},"0表示不自动停止",-1))]),s("div",ga,[E[12]||(E[12]=s("div",{class:"text-xs text-gray-600 mb-1"},"触发按钮",-1)),l(N,{"model-value":e.playlistStatus.trigger_button||"",onChange:e.onUpdateTriggerButton,placeholder:"选择触发按钮",size:"small",class:"w-full",clearable:""},{default:a(()=>[l(oe,{label:"空",value:o(lt).NONE},null,8,["value"]),l(oe,{label:"按钮对-1",value:o(lt).BUTTON_1},null,8,["value"]),l(oe,{label:"按钮对-2",value:o(lt).BUTTON_2},null,8,["value"]),l(oe,{label:"按钮对-3",value:o(lt).BUTTON_3},null,8,["value"])]),_:1},8,["model-value","onChange"])])]),e.playlistStatus.schedule?.cron&&e.playlistStatus.schedule?.enabled===1?(c(),k("div",pa,[l(j,{type:"success",size:"small",onClick:e.onPreviewCron,class:"w-full"},{default:a(()=>[...E[13]||(E[13]=[Q(" 预览执行时间 ",-1)])]),_:1},8,["onClick"])])):ie("",!0)])]),s("div",ya,[E[22]||(E[22]=s("h4",{class:"text-sm font-semibold mb-2"},"设备配置",-1)),s("div",ha,[s("div",ba,[E[14]||(E[14]=s("div",{class:"text-xs text-gray-600 whitespace-nowrap"},"设备类型",-1)),l(N,{"model-value":f.value,onChange:e.onUpdateDeviceType,placeholder:"选择设备类型",size:"small",class:"flex-1"},{default:a(()=>[l(oe,{label:"蓝牙",value:"bluetooth"}),l(oe,{label:"DLNA",value:"dlna"}),l(oe,{label:"设备代理",value:"agent"}),l(oe,{label:"小米设备",value:"mi"})]),_:1},8,["model-value","onChange"])]),s("div",xa,[E[15]||(E[15]=s("div",{class:"text-xs text-gray-600 whitespace-nowrap"},"设备音量",-1)),l(b,{"model-value":i.value,onInput:E[2]||(E[2]=w=>i.value=w),onChange:E[3]||(E[3]=w=>m(w)),min:5,max:100,step:1,size:"small",class:"flex-1"},null,8,["model-value"])]),s("div",null,[s("div",wa,[E[16]||(E[16]=s("span",null,"设备地址",-1)),e.playlistStatus.device?.name?(c(),k("span",Da,W(e.playlistStatus.device.name),1)):ie("",!0)]),s("div",$a,[l(ne,{"model-value":g.value,onInput:E[4]||(E[4]=w=>e.onUpdateDeviceAddress(w)),placeholder:"设备地址",size:"small",class:"flex-1"},null,8,["model-value"]),l(j,{size:"small",type:"danger",plain:"",onClick:E[5]||(E[5]=w=>e.onUpdateDeviceAddress("")),disabled:!g.value,title:"清空设备地址"},{default:a(()=>[...E[17]||(E[17]=[Q(" 清空 ",-1)])]),_:1},8,["disabled"])])])]),s("div",Ca,[s("div",Fa,[s("h5",ka,W(H.value),1),f.value?(c(),se(j,{key:0,size:"small",type:"primary",plain:"",onClick:B,loading:t.value,disabled:t.value,title:$.value},{default:a(()=>[t.value?ie("",!0):(c(),se(A,{key:0},{default:a(()=>[l(o(Ge))]),_:1})),E[18]||(E[18]=s("span",{class:"ml-1"},"扫描设备",-1))]),_:1},8,["loading","disabled","title"])):ie("",!0)]),u.value?(c(),k("div",_a,[he((c(),k("div",Pa,[(c(!0),k($e,null,Ae(e.connectedDeviceList,w=>(c(),k("div",{key:w.address,class:"flex items-center gap-2 p-2 border rounded hover:bg-gray-50"},[s("div",Sa,[s("div",Ba,W(w.name),1),s("div",Aa,W(w.address),1)]),s("div",Ta,[l(j,{size:"small",type:"primary",onClick:R=>f.value==="agent"?e.onSelectAgentDevice(w):e.onSelectBluetoothDevice(w.address),disabled:w.address===g.value},{default:a(()=>[...E[19]||(E[19]=[Q(" 选择 ",-1)])]),_:1},8,["onClick","disabled"])])]))),128)),e.connectedDeviceList.length===0?(c(),k("div",Ma," 暂无设备 ")):ie("",!0)])),[[T,e.loading]])])):o(V)?(c(),k("div",Ea,[he((c(),k("div",La,[(c(!0),k($e,null,Ae(e.dlnaDeviceList,w=>(c(),k("div",{key:w.location,class:"flex items-center gap-2 p-2 border rounded hover:bg-gray-50"},[s("div",Va,[s("div",Ua,W(w.name),1),s("div",{class:"text-xs text-gray-500 truncate",title:w.location},W(w.location),9,Na)]),s("div",za,[l(j,{size:"small",type:"primary",onClick:R=>e.onUpdateDeviceAddress(w.location||w.address||"",w.name),disabled:(w.location||w.address)===g.value},{default:a(()=>[...E[20]||(E[20]=[Q(" 选择 ",-1)])]),_:1},8,["onClick","disabled"])])]))),128)),e.dlnaDeviceList.length===0&&!e.dlnaScanning?(c(),k("div",Oa,' 暂无设备，点击"扫描设备"开始扫描 ')):ie("",!0)])),[[T,e.dlnaScanning]])])):o(I)?(c(),k("div",Ra,[he((c(),k("div",ja,[(c(!0),k($e,null,Ae(e.miDeviceList,w=>(c(),k("div",{key:w.deviceID||w.address,class:"flex items-center gap-2 p-2 border rounded hover:bg-gray-50"},[s("div",Wa,[s("div",Ga,W(w.name),1),s("div",{class:"text-xs text-gray-500 truncate",title:w.deviceID||w.address},W(w.deviceID||w.address),9,Ya)]),s("div",Ka,[l(j,{size:"small",type:"primary",onClick:R=>e.onSelectMiDevice(w),disabled:(w.deviceID||w.address)===g.value},{default:a(()=>[...E[21]||(E[21]=[Q(" 选择 ",-1)])]),_:1},8,["onClick","disabled"])])]))),128)),e.miDeviceList.length===0&&!e.miScanning?(c(),k("div",Ha,' 暂无设备，点击"扫描设备"开始扫描 ')):ie("",!0)])),[[T,e.miScanning]])])):ie("",!0)])])])):(c(),k("div",Ja," 请先选择一个播放列表 "))])}}}),qa={class:"mb-4"},Xa={key:0,class:"text-center text-gray-400 mt-4 py-8"},Za=Ve({__name:"ScanDeviceDialog",props:{visible:{type:Boolean},deviceList:{},loading:{type:Boolean}},emits:["update:visible","refresh","connect","close"],setup(e,{emit:S}){const f=S,g=n=>{f("update:visible",n),n||f("close")},L=()=>{f("refresh")},i=n=>{f("connect",n)};return(n,m)=>{const h=Ue,u=Wt,V=jt,I=Ze,H=wt;return c(),se(I,{"model-value":e.visible,"onUpdate:modelValue":g,title:"扫描到的设备",width:"800"},{default:a(()=>[s("div",qa,[l(h,{type:"primary",onClick:L,loading:e.loading},{default:a(()=>[...m[0]||(m[0]=[Q("刷新扫描",-1)])]),_:1},8,["loading"])]),he((c(),se(V,{data:e.deviceList,stripe:"",class:"w-full",height:400},{default:a(()=>[l(u,{prop:"name",label:"设备名称","min-width":"150"}),l(u,{prop:"address",label:"地址","min-width":"120"}),l(u,{prop:"rssi",label:"信号强度",width:"100"},{default:a(({row:$})=>[s("span",null,W($.rssi)+" dBm",1)]),_:1}),l(u,{label:"操作",width:"100"},{default:a(({row:$})=>[l(h,{size:"small",type:"primary",onClick:t=>i($),loading:$.connecting,disabled:$.connecting},{default:a(()=>[...m[1]||(m[1]=[Q(" 连接 ",-1)])]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1},8,["data"])),[[H,e.loading]]),e.deviceList.length===0&&!e.loading?(c(),k("div",Xa,' 暂无扫描到的设备，点击"刷新扫描"按钮开始扫描 ')):ie("",!0)]),_:1},8,["model-value"])}}}),Ia={class:"flex items-center gap-3 w-full pr-4"},ei={class:"flex flex-col gap-4 h-full overflow-y-auto"},ti={class:"flex flex-col gap-1"},li={class:"text-sm flex items-start"},si={class:"text-gray-800"},ni={class:"text-sm flex items-start"},ai={class:"text-gray-800"},ii={key:0,class:"text-gray-400"},oi={class:"flex flex-col items-center gap-1"},ri={class:"text-xs text-gray-500"},di={class:"flex flex-col gap-1"},ui={class:"text-[12px] mr-1 !w-4"},ci={class:"flex flex-col gap-4 h-full overflow-y-auto"},fi={key:0,class:"text-sm"},vi={key:1,class:"text-gray-400"},mi={class:"flex flex-col gap-4 h-full overflow-y-auto"},gi={class:"flex flex-col gap-1"},pi={class:"text-sm flex items-start"},yi=["title"],hi={key:0,class:"text-sm flex items-start"},bi={class:"text-gray-800"},xi={class:"flex flex-col gap-2"},wi={class:"flex items-center gap-2"},Di={class:"text-gray-800 w-5"},$i={key:1},Ci={class:"flex items-center gap-2"},Fi={class:"flex flex-col gap-4 h-full overflow-y-auto"},ki={class:"flex flex-col gap-1"},_i={class:"text-sm flex items-start"},Pi={class:"text-gray-800"},Si={class:"text-sm flex items-start"},Bi={class:"text-gray-800 w-40"},Ai={class:"text-gray-800 w-40"},Ti={class:"flex flex-col gap-2"},Mi={class:"flex items-center gap-2"},Ei={key:1,class:"text-gray-400"},Li={key:1},Vi={class:"flex items-center gap-2"},Ui={class:"text-gray-800 w-5"},Ni=Ve({__name:"DevicesDrawer",props:{visible:{type:Boolean,default:!1}},emits:["update:visible"],setup(e,{emit:S}){const f=e,g=S,L=Y(f.visible),i=Y("agent"),n=Y([]),m=Y(!1),h=Y(!1);let u=null;const V=Y([]),I=Y(!1),H=Y([]),$=Y(!1),t=Y([]),B=Y(!1),z=[{label:"B1",keys:["F13","F14"]},{label:"B2",keys:["F15","F16"]},{label:"B3",keys:["F17","F18"]}],E=async(r=!0,v=!1)=>{try{r&&(m.value=!0);const F=(await it.get("/agent/list")).data;F?.code===0?(n.value=F.data||[],v&&P.success(`已获取 ${n.value.length} 个 Agent 设备`)):((v||r)&&P.error(F?.msg||"获取设备列表失败"),n.value=[])}catch(C){console.error("获取Agent设备列表失败:",C),(v||r)&&le(C,"获取设备列表失败"),n.value=[]}finally{r&&(m.value=!1)}},A=async(r,v)=>{const C=n.value.find(te=>te.agent_id===r);if(!C){P.error("设备不存在");return}const F=`testing_${v}`,ee=C;ee[F]=!0;try{const pe=(await it.post("/agent/mock",{agent_id:r,action:"keyboard",key:v,value:"test"})).data;pe?.code===0?P.success(`测试按钮 ${v} 成功`):P.error(pe?.msg||`测试按钮 ${v} 失败`)}catch(te){le(te,`测试按钮 ${v} 失败`)}finally{ee[F]=!1}},j=()=>{h.value&&(E(!0,!1),U(),u=setInterval(()=>{E(!1,!1)},Bs))},U=()=>{u&&(clearInterval(u),u=null)},ne=r=>{r?j():U()},de=()=>E(!0,!1),oe=(r,v)=>A(r,v),N=async()=>{try{I.value=!0;const r=await Qe("paired","GET");if(r?.code===0){const v=Array.isArray(r.data)?r.data:[];V.value=v.map(C=>({name:C.name||"",address:C.address||"",...C,connecting:!1,disconnecting:!1,connected:C.connected??!1})),P.success(`已获取 ${V.value.length} 个已配对蓝牙设备`)}else P.error(r?.msg||"获取已配对设备列表失败")}catch(r){le(r,"获取已配对设备列表失败")}finally{I.value=!1}},b=async r=>{if(!r.address){P.error("设备地址无效");return}try{r.connecting=!0;const v=await Qe("connect","POST",{address:r.address});v?.code===0?(P.success(`成功连接到设备: ${r.name}`),r.connected=!0,await N()):P.error(v?.msg||"连接设备失败")}catch(v){le(v,"连接设备失败")}finally{r.connecting=!1}},T=async r=>{if(!r.address){P.error("设备地址无效");return}try{r.disconnecting=!0;const v=await Qe("disconnect","POST",{address:r.address});v?.code===0?(P.success(`已断开设备: ${r.name}`),r.connected=!1,await N()):P.error(v?.msg||"断开设备失败")}catch(v){le(v,"断开设备失败")}finally{r.disconnecting=!1}},w=()=>N(),R=ue(()=>i.value==="agent"?m.value:i.value==="bluetooth"?I.value:!1),p=ue(()=>{switch(i.value){case"dlna":return $.value;case"mi":return B.value;default:return!1}}),q=()=>{i.value==="agent"?de():i.value==="bluetooth"&&w()},Z=()=>{switch(i.value){case"dlna":ke();break;case"mi":X();break}},d=r=>r.deviceID||r.address||"",_=r=>Math.max(0,Math.min(100,r)),D=r=>({...r,volume:void 0,status:void 0,_volumeChanging:!1,_statusRefreshing:!1}),X=async()=>{try{B.value=!0;const r=await Et(Pt);if(r?.code===0){const v=(r.data||[]).map(C=>D(C));t.value=v,await Promise.allSettled(v.map(C=>G(C))),P.success(`扫描到 ${v.length} 个小米设备`)}else P.error(r?.msg||"扫描小米设备失败")}catch(r){le(r,"扫描小米设备失败")}finally{B.value=!1}},G=async r=>{const v=d(r);if(!v)return;const C=t.value.find(F=>d(F)===v);if(C){C._statusRefreshing=!0;try{const F=await as(v);if(F?.code===0)C.status=F.data,F.data?.volume!==void 0&&(C.volume=F.data.volume);else{const ee=C.name||v;le(new Error(F?.msg||`获取设备 ${ee} 状态失败`),`获取设备 ${ee} 状态失败`)}}catch(F){const ee=C.name||v;le(F,`获取设备 ${ee} 状态失败`)}finally{C._statusRefreshing=!1}}},ce=async(r,v)=>{const C=d(r);if(!C){P.error("设备ID无效");return}const F=_(v);r._volumeChanging=!0;try{const ee=await is(C,F);ee?.code===0?(r.volume=F,P.success("音量设置成功")):P.error(ee?.msg||"设置音量失败")}catch(ee){le(ee,"设置小米设备音量失败")}finally{r._volumeChanging=!1}},ge=async r=>{const v=d(r);if(!v){P.warning("设备ID无效");return}try{r._stopping=!0;const C=await os(v);C?.code===0?P.success("停止播放成功"):P.error(C?.msg||"停止播放失败")}catch(C){le(C,"停止小米设备播放失败")}finally{r._stopping=!1}},fe=r=>r.location||r.address||"",Le=r=>({...r,volume:void 0,_volumeChanging:!1,_volumeRefreshing:!1}),ke=async()=>{try{$.value=!0;const r=await Lt(Pt);if(r?.code===0){const C=(r.data||[]).map(F=>Le(F));H.value=C,await Promise.allSettled(C.map(F=>De(F))),P.success(`扫描到 ${C.length} 个 DLNA 设备`)}else P.error(r?.msg||"扫描 DLNA 设备失败")}catch(r){le(r,"扫描 DLNA 设备失败")}finally{$.value=!1}},De=async r=>{const v=fe(r);if(!v)return;const C=H.value.find(F=>fe(F)===v);if(C){C._volumeRefreshing=!0;try{const F=await rs(v);if(F?.code===0)C.volume=F.data?.volume??F.data??void 0;else{const ee=C.name||v;P.error(F?.msg||`获取设备 ${ee} 音量失败`)}}catch(F){const ee=C.name||v;le(F,`获取设备 ${ee} 音量失败`)}finally{C._volumeRefreshing=!1}}},Se=async(r,v)=>{const C=fe(r);if(!C){P.error("设备位置无效");return}const F=_(v);r._volumeChanging=!0;try{const ee=await ds(C,F);ee?.code===0?(r.volume=F,P.success("音量设置成功")):P.error(ee?.msg||"设置音量失败")}catch(ee){le(ee,"设置 DLNA 设备音量失败")}finally{r._volumeChanging=!1}},x=async r=>{const v=fe(r);if(!v){P.warning("设备位置无效");return}try{r._stopping=!0;const C=await us(v);C?.code===0?P.success("停止播放成功"):P.error(C?.msg||"停止播放失败")}catch(C){le(C,"停止 DLNA 设备播放失败")}finally{r._stopping=!1}},K=()=>{L.value=!1};return Ee(()=>f.visible,r=>{L.value=r,r&&h.value?j():U()},{immediate:!0}),Ee(L,r=>{r!==f.visible&&g("update:visible",r)}),Ee(i,(r,v)=>{v==="agent"&&r!=="agent"&&U(),r==="agent"&&v!=="agent"&&h.value&&j(),r==="bluetooth"&&v!=="bluetooth"&&w()}),ot(()=>{f.visible&&(h.value&&i.value==="agent"&&j(),i.value==="bluetooth"&&w())}),At(()=>{U()}),(r,v)=>{const C=He,F=Ue,ee=yt,te=Wt,pe=ht,ze=jt,je=_s,y=Ot,O=Ps,J=Gt,re=wt;return c(),se(J,{modelValue:L.value,"onUpdate:modelValue":v[2]||(v[2]=M=>L.value=M),size:1200,direction:"rtl","before-close":K,"header-class":"h-12 !mb-1"},{header:a(()=>[s("div",Ia,[v[5]||(v[5]=s("span",{class:"text-lg font-semibold"},"设备管理",-1)),i.value==="agent"||i.value==="bluetooth"?(c(),k($e,{key:0},[l(F,{type:"primary",plain:"",size:"small",onClick:q,loading:R.value},{default:a(()=>[R.value?ie("",!0):(c(),se(C,{key:0},{default:a(()=>[l(o(Ge))]),_:1})),v[3]||(v[3]=s("span",{class:"ml-1"},"刷新",-1))]),_:1},8,["loading"]),i.value==="agent"?(c(),se(ee,{key:0,modelValue:h.value,"onUpdate:modelValue":v[0]||(v[0]=M=>h.value=M),size:"small","active-text":"自动刷新","inactive-text":"",onChange:ne},null,8,["modelValue"])):ie("",!0)],64)):(c(),se(F,{key:1,type:"primary",plain:"",size:"small",onClick:Z,loading:p.value},{default:a(()=>[p.value?ie("",!0):(c(),se(C,{key:0},{default:a(()=>[l(o(Ge))]),_:1})),v[4]||(v[4]=s("span",{class:"ml-1"},"扫描",-1))]),_:1},8,["loading"]))])]),default:a(()=>[l(O,{modelValue:i.value,"onUpdate:modelValue":v[1]||(v[1]=M=>i.value=M),class:"h-full flex flex-col"},{default:a(()=>[l(je,{label:"Agent设备",name:"agent"},{default:a(()=>[s("div",ei,[he((c(),se(ze,{data:n.value,stripe:"",class:"w-full",height:600},{empty:a(()=>[...v[8]||(v[8]=[s("div",{class:"text-center text-gray-400 py-8"},"暂无设备，请等待设备注册",-1)])]),default:a(()=>[l(te,{prop:"name",label:"设备名称","min-width":"150"}),l(te,{label:"详情","min-width":"250"},{default:a(({row:M})=>[s("div",ti,[s("div",li,[v[6]||(v[6]=s("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"地址：",-1)),s("span",si,W(M.address),1)]),s("div",ni,[v[7]||(v[7]=s("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"ID：",-1)),s("span",ai,W(M.agent_id),1)])])]),_:1}),l(te,{label:"支持的操作","min-width":"100"},{default:a(({row:M})=>[(c(!0),k($e,null,Ae(M.actions,be=>(c(),se(pe,{key:be,size:"small",type:"info",class:"mr-1"},{default:a(()=>[Q(W(be),1)]),_:2},1024))),128)),!M.actions||M.actions.length===0?(c(),k("span",ii,"无")):ie("",!0)]),_:1}),l(te,{label:"状态/心跳",width:"90"},{default:a(({row:M})=>[s("div",oi,[l(pe,{type:M.is_online?"success":"danger",size:"small"},{default:a(()=>[Q(W(M.is_online?"在线":"离线"),1)]),_:2},1032,["type"]),s("span",ri,W(M.last_heartbeat_ago)+"秒前 ",1)])]),_:1}),l(te,{label:"测试按钮",width:"180"},{default:a(({row:M})=>[s("div",di,[(c(),k($e,null,Ae(z,(be,ye)=>s("div",{key:ye,class:"flex gap-1 items-center"},[l(C,{class:"!w-4 !h-5"},{default:a(()=>[l(o(Vt))]),_:1}),s("span",ui,W(be.label),1),(c(!0),k($e,null,Ae(be.keys,(Ce,Ke)=>(c(),se(F,{key:Ke,size:"small",type:"primary",plain:"",onClick:Dt=>oe(M.agent_id,Ce),loading:M[`testing_${Ce}`],class:"flex-1"},{default:a(()=>[Q(W(Ce),1)]),_:2},1032,["onClick","loading"]))),128))])),64))])]),_:1})]),_:1},8,["data"])),[[re,m.value]])])]),_:1}),l(je,{label:"蓝牙设备",name:"bluetooth"},{default:a(()=>[s("div",ci,[he((c(),se(ze,{data:V.value,stripe:"",class:"w-full",height:600},{empty:a(()=>[...v[11]||(v[11]=[s("div",{class:"text-center text-gray-400 py-8"},'暂无设备，点击"扫描"开始扫描',-1)])]),default:a(()=>[l(te,{prop:"name",label:"设备名称","min-width":"200"}),l(te,{prop:"address",label:"设备地址","min-width":"180"}),l(te,{label:"信号强度",width:"120"},{default:a(({row:M})=>[M.rssi!==void 0?(c(),k("span",fi,W(M.rssi)+" dBm ",1)):(c(),k("span",vi,"-"))]),_:1}),l(te,{label:"状态",width:"100"},{default:a(({row:M})=>[l(pe,{type:M.connecting||M.disconnecting?"warning":M.connected?"success":(M.rssi!==void 0,"info"),size:"small"},{default:a(()=>[Q(W(M.connecting?"连接中":M.disconnecting?"断开中":M.connected?"已连接":M.rssi!==void 0?"已发现":"未知"),1)]),_:2},1032,["type"])]),_:1}),l(te,{label:"操作",width:"120",fixed:"right"},{default:a(({row:M})=>[M.connected?(c(),se(F,{key:1,type:"danger",size:"small",onClick:be=>T(M),loading:M.disconnecting,disabled:M.connecting||M.disconnecting},{default:a(()=>[...v[10]||(v[10]=[Q(" 断开 ",-1)])]),_:1},8,["onClick","loading","disabled"])):(c(),se(F,{key:0,type:"primary",size:"small",onClick:be=>b(M),loading:M.connecting,disabled:M.connecting||M.disconnecting},{default:a(()=>[...v[9]||(v[9]=[Q(" 连接 ",-1)])]),_:1},8,["onClick","loading","disabled"]))]),_:1})]),_:1},8,["data"])),[[re,I.value]])])]),_:1}),l(je,{label:"DLNA设备",name:"dlna"},{default:a(()=>[s("div",mi,[he((c(),se(ze,{data:H.value,stripe:"",class:"w-full",height:600},{empty:a(()=>[...v[15]||(v[15]=[s("div",{class:"text-center text-gray-400 py-8"},'暂无设备，点击"扫描"开始扫描',-1)])]),default:a(()=>[l(te,{prop:"name",label:"设备名称","min-width":"150"}),l(te,{label:"详情","min-width":"400"},{default:a(({row:M})=>[s("div",gi,[s("div",pi,[v[12]||(v[12]=s("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"位置：",-1)),s("span",{class:"text-gray-800 flex-1 truncate",title:M.location},W(M.location||"-"),9,yi)]),M.manufacturer||M.model_name?(c(),k("div",hi,[v[13]||(v[13]=s("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"型号：",-1)),s("span",bi,W(M.manufacturer||"")+" "+W(M.model_name||""),1)])):ie("",!0)])]),_:1}),l(te,{label:"功能","min-width":"200"},{default:a(({row:M})=>[s("div",xi,[s("div",wi,[v[14]||(v[14]=s("span",{class:"text-gray-600 inline-block w-11 flex-shrink-0"},"音量：",-1)),s("span",Di,W(M.volume!==void 0?M.volume:"-"),1),l(F,{size:"small",type:"info",plain:"",circle:"",onClick:be=>De(M),loading:M._volumeRefreshing,disabled:M._volumeRefreshing||M._volumeChanging,title:"刷新音量",class:"p-0.5 !w-[17px] !h-[17px]"},{default:a(()=>[M._volumeRefreshing?ie("",!0):(c(),se(C,{key:0},{default:a(()=>[l(o(Ge))]),_:1}))]),_:2},1032,["onClick","loading","disabled"]),l(F,{size:"small",class:"!w-8 !h-6",type:"danger",plain:"",onClick:be=>x(M),disabled:M._stopping,title:"停止播放"},{default:a(()=>[M._stopping?(c(),se(C,{key:0,class:"animate-spin"},{default:a(()=>[l(o(Je))]),_:1})):(c(),k("span",$i,"⏹"))]),_:2},1032,["onClick","disabled"])]),s("div",Ci,[l(y,{"model-value":M.volume??0,onInput:be=>M.volume=be,onChange:be=>Se(M,be),min:5,max:100,step:1,disabled:M._volumeChanging||M._volumeRefreshing||M.volume===void 0,size:"small",class:"flex-1 max-w-[200px]"},null,8,["model-value","onInput","onChange","disabled"])])])]),_:1})]),_:1},8,["data"])),[[re,$.value]])])]),_:1}),l(je,{label:"小米设备",name:"mi"},{default:a(()=>[s("div",Fi,[he((c(),se(ze,{data:t.value,stripe:"",class:"w-full",height:600},{empty:a(()=>[...v[21]||(v[21]=[s("div",{class:"text-center text-gray-400 py-8"},'暂无设备，点击"扫描"开始扫描',-1)])]),default:a(()=>[l(te,{prop:"name",label:"设备名称","min-width":"150"}),l(te,{label:"详情","min-width":"400"},{default:a(({row:M})=>[s("div",ki,[s("div",_i,[v[16]||(v[16]=s("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"ID：",-1)),s("span",Pi,W(M.deviceID||"-"),1)]),s("div",Si,[v[17]||(v[17]=s("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"地址：",-1)),s("span",Bi,W(M.mac||"-"),1),v[18]||(v[18]=s("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"DTD：",-1)),s("span",Ai,W(M.miotDID||"-"),1)])])]),_:1}),l(te,{label:"功能","min-width":"250"},{default:a(({row:M})=>[s("div",Ti,[s("div",Mi,[v[19]||(v[19]=s("span",{class:"text-gray-600 inline-block w-11 flex-shrink-0"},"状态：",-1)),M.status?.state?(c(),se(pe,{key:0,type:M.status.state==="PLAYING"?"success":"info",size:"small"},{default:a(()=>[Q(W(M.status.state==="PLAYING"?"播放中":"已停止"),1)]),_:2},1032,["type"])):(c(),k("span",Ei,"-")),l(F,{size:"small",type:"info",plain:"",circle:"",onClick:be=>G(M),loading:M._statusRefreshing,disabled:M._statusRefreshing||M._volumeChanging,title:"刷新状态",class:"p-0.5 !w-[17px] !h-[17px]"},{default:a(()=>[M._statusRefreshing?ie("",!0):(c(),se(C,{key:0},{default:a(()=>[l(o(Ge))]),_:1}))]),_:2},1032,["onClick","loading","disabled"]),l(F,{size:"small",class:"!w-8 !h-6",type:"danger",plain:"",onClick:be=>ge(M),disabled:M._stopping,title:"停止播放"},{default:a(()=>[M._stopping?(c(),se(C,{key:0,class:"animate-spin"},{default:a(()=>[l(o(Je))]),_:1})):(c(),k("span",Li,"⏹"))]),_:2},1032,["onClick","disabled"])]),s("div",Vi,[v[20]||(v[20]=s("span",{class:"text-gray-600 inline-block w-11 flex-shrink-0"},"音量：",-1)),s("span",Ui,W(M.volume!==void 0?M.volume:"-"),1),l(y,{"model-value":M.volume??0,onInput:be=>M.volume=be,onChange:be=>ce(M,be),min:5,max:100,step:1,disabled:M._volumeChanging||M._statusRefreshing||M.volume===void 0,size:"small",class:"flex-1 max-w-[200px]"},null,8,["model-value","onInput","onChange","disabled"])])])]),_:1})]),_:1},8,["data"])),[[re,B.value]])])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}}),zi={class:"flex gap-4 h-[500px]"},Oi={class:"w-64 flex flex-col border rounded p-3"},Ri={class:"flex-1 overflow-y-auto space-y-2"},ji=["onClick"],Wi={class:"text-sm flex-1 truncate"},Gi={class:"text-xs text-gray-500 ml-2 whitespace-nowrap"},Yi={key:0,class:"text-blue-600 font-medium"},Ki={key:1},Hi={key:0,class:"text-xs text-gray-400 text-center py-2"},Ji={class:"flex-1 flex flex-col border rounded p-3"},Qi={key:0,class:"flex-1 overflow-y-auto"},qi={class:"mb-3"},Xi={class:"space-y-1"},Zi=["onClick"],Ii={class:"text-xs text-gray-500 whitespace-nowrap"},eo={key:0,class:"text-blue-600 font-medium"},to={key:1},lo={class:"border-t pt-3"},so={class:"flex items-center gap-2 py-1"},no={class:"text-xs text-gray-500 whitespace-nowrap"},ao={key:0,class:"text-blue-600 font-medium"},io={key:1},oo={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},ro={class:"flex items-center justify-between"},uo={class:"text-sm text-gray-500"},co={key:0},fo={class:"flex gap-2"},vo=Ve({__name:"PlaylistSelectDialog",props:{visible:{type:Boolean,default:!1},playlistCollection:{default:()=>[]},selectedFiles:{default:()=>[]},onCopy:{type:Function,default:void 0},onRemove:{type:Function,default:void 0}},emits:["update:visible"],setup(e,{emit:S}){const f=e,g=S,L=Y(f.visible),i=Y(null),n=Y([]),m=Y(!1),h=ue(()=>f.playlistCollection.find(N=>N.id===i.value)||null),u=ue(()=>n.value.length>0||m.value),V=N=>{const b=h.value;if(!b||!b.pre_lists||!Array.isArray(b.pre_lists)||b.pre_lists.length!==7)return 0;const T=b.pre_lists[N];return Array.isArray(T)?T.length:0},I=()=>{const N=h.value;return!N||!N.playlist?0:Array.isArray(N.playlist)?N.playlist.length:0},H=N=>{if(!N)return 0;const b=N.pre_lists&&Array.isArray(N.pre_lists)&&N.pre_lists.length===7?N.pre_lists.reduce((w,R)=>w+(Array.isArray(R)?R.length:0),0):0,T=Array.isArray(N.playlist)?N.playlist.length:0;return b+T},$=()=>!f.selectedFiles||f.selectedFiles.length===0?new Set:new Set(f.selectedFiles.map(N=>typeof N=="string"?N:N.uri||String(N))),t=N=>{if(!N||!f.selectedFiles||f.selectedFiles.length===0)return 0;const b=$();let T=0;return N.pre_lists&&Array.isArray(N.pre_lists)&&N.pre_lists.length===7&&N.pre_lists.forEach(w=>{Array.isArray(w)&&w.forEach(R=>{const p=R.uri||String(R);b.has(p)&&T++})}),Array.isArray(N.playlist)&&N.playlist.forEach(w=>{const R=w.uri||String(w);b.has(R)&&T++}),T},B=N=>{const b=h.value;if(!b||!f.selectedFiles||f.selectedFiles.length===0||!b.pre_lists||!Array.isArray(b.pre_lists)||b.pre_lists.length!==7)return 0;const T=b.pre_lists[N];if(!Array.isArray(T))return 0;const w=$();let R=0;return T.forEach(p=>{const q=p.uri||String(p);w.has(q)&&R++}),R},z=()=>{const N=h.value;if(!N||!f.selectedFiles||f.selectedFiles.length===0||!Array.isArray(N.playlist))return 0;const b=$();let T=0;return N.playlist.forEach(w=>{const R=w.uri||String(w);b.has(R)&&T++}),T},E=N=>{i.value=N,n.value=[],m.value=!1},A=N=>{const b=n.value.indexOf(N);b>-1?n.value.splice(b,1):n.value.push(N)},j=()=>{m.value=!m.value},U=async()=>{if(!h.value||!f.selectedFiles||f.selectedFiles.length===0||!u.value){P.warning("请选择播放列表和目标列表，并至少选中一个文件");return}try{const N=f.selectedFiles.map(R=>typeof R=="string"?R:R.uri||String(R)),b=n.value.length,T=m.value;let w="";if(b>0&&T)w=`${b}个前置文件列表和正式文件列表`;else if(b>0){const R=["周一","周二","周三","周四","周五","周六","周日"];w=`前置文件列表（${n.value.map(q=>R[q]).join("、")}）`}else T&&(w="正式文件列表");await Be.confirm(`确定要将选中的 ${N.length} 个文件复制到播放列表"${h.value.name}"的${w}吗？`,"确认复制",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),f.onCopy&&(await f.onCopy({playlistId:i.value,files:N,preLists:n.value,filesList:m.value}),P.success("文件已复制到播放列表"),de())}catch(N){N!=="cancel"&&le(N,"复制文件失败")}},ne=async()=>{if(!h.value||!f.selectedFiles||f.selectedFiles.length===0||!u.value){P.warning("请选择播放列表和目标列表，并至少选中一个文件");return}try{const N=f.selectedFiles.map(R=>typeof R=="string"?R:R.uri||String(R)),b=n.value.length,T=m.value;let w="";if(b>0&&T)w=`${b}个前置文件列表和正式文件列表`;else if(b>0){const R=["周一","周二","周三","周四","周五","周六","周日"];w=`前置文件列表（${n.value.map(q=>R[q]).join("、")}）`}else T&&(w="正式文件列表");await Be.confirm(`确定要从播放列表"${h.value.name}"的${w}中删除选中的 ${N.length} 个文件吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),f.onRemove&&(await f.onRemove({playlistId:i.value,files:N,preLists:n.value,filesList:m.value}),P.success("文件已从播放列表删除"),de())}catch(N){N!=="cancel"&&le(N,"删除文件失败")}},de=()=>{L.value=!1,i.value=null,n.value=[],m.value=!1},oe=()=>{f.playlistCollection&&f.playlistCollection.length>0&&!i.value&&(i.value=f.playlistCollection[0].id)};return Ee(()=>f.playlistCollection,N=>{N&&N.length>0&&!i.value&&(i.value=N[0].id)},{immediate:!0}),Ee(()=>f.visible,N=>{L.value=N,N&&oe()}),Ee(L,N=>{N!==f.visible&&g("update:visible",N)}),ot(()=>{oe()}),(N,b)=>{const T=rt,w=Ue,R=Ze;return c(),se(R,{modelValue:L.value,"onUpdate:modelValue":b[1]||(b[1]=p=>L.value=p),title:"应用到列表",width:"900","before-close":de},{footer:a(()=>[s("div",ro,[s("div",uo,[e.selectedFiles&&e.selectedFiles.length>0?(c(),k("span",co," 已选择 "+W(e.selectedFiles.length)+" 个文件 ",1)):ie("",!0)]),s("div",fo,[l(w,{onClick:de},{default:a(()=>[...b[7]||(b[7]=[Q("取消",-1)])]),_:1}),l(w,{type:"primary",onClick:U,disabled:!u.value||!e.selectedFiles||e.selectedFiles.length===0},{default:a(()=>[...b[8]||(b[8]=[Q(" 复制到列表 ",-1)])]),_:1},8,["disabled"]),l(w,{type:"danger",onClick:ne,disabled:!u.value||!e.selectedFiles||e.selectedFiles.length===0},{default:a(()=>[...b[9]||(b[9]=[Q(" 从列表删除 ",-1)])]),_:1},8,["disabled"])])])]),default:a(()=>[s("div",zi,[s("div",Oi,[b[2]||(b[2]=s("div",{class:"text-sm font-semibold mb-2"},"选择播放列表",-1)),s("div",Ri,[(c(!0),k($e,null,Ae(e.playlistCollection,p=>(c(),k("div",{key:p.id,class:Te(["flex items-center justify-between px-2 py-2 rounded cursor-pointer hover:bg-gray-50 transition-colors",{"bg-blue-50 border border-blue-200":p.id===i.value}]),onClick:q=>E(p.id)},[s("span",Wi,W(p.name),1),s("span",Gi,[e.selectedFiles&&e.selectedFiles.length>0?(c(),k("span",Yi,W(t(p))+"/"+W(H(p)),1)):(c(),k("span",Ki,W(H(p)),1))])],10,ji))),128)),e.playlistCollection.length===0?(c(),k("div",Hi," 暂无播放列表 ")):ie("",!0)])]),s("div",Ji,[b[6]||(b[6]=s("div",{class:"text-sm font-semibold mb-3"},"选择目标列表（可多选）",-1)),h.value?(c(),k("div",Qi,[s("div",qi,[b[4]||(b[4]=s("div",{class:"text-xs text-gray-600 mb-2 font-semibold"},"前置文件",-1)),s("div",Xi,[(c(),k($e,null,Ae(["周一","周二","周三","周四","周五","周六","周日"],(p,q)=>s("div",{key:q,class:"flex items-center gap-2 py-1"},[l(T,{"model-value":n.value.includes(q),onChange:Z=>A(q),size:"small"},null,8,["model-value","onChange"]),s("span",{class:Te(["text-xs flex-1 cursor-pointer hover:text-blue-500",{"text-blue-600 font-medium":n.value.includes(q)}]),onClick:Z=>A(q)},W(p),11,Zi),s("span",Ii,[e.selectedFiles&&e.selectedFiles.length>0?(c(),k("span",eo,W(B(q))+"/"+W(V(q)),1)):(c(),k("span",to,W(V(q)),1)),b[3]||(b[3]=s("span",{class:"text-gray-400"}," 个文件",-1))])])),64))])]),s("div",lo,[s("div",so,[l(T,{"model-value":m.value,onChange:j,size:"small"},null,8,["model-value"]),s("span",{class:Te(["text-xs font-semibold text-gray-600 cursor-pointer hover:text-blue-500 flex-1",{"text-blue-600":m.value}]),onClick:b[0]||(b[0]=p=>j())}," 正式文件 ",2),s("span",no,[e.selectedFiles&&e.selectedFiles.length>0?(c(),k("span",ao,W(z())+"/"+W(I()),1)):(c(),k("span",io,W(I()),1)),b[5]||(b[5]=s("span",{class:"text-gray-400"}," 个文件",-1))])])])])):(c(),k("div",oo," 请先选择一个播放列表 "))])])]),_:1},8,["modelValue"])}}}),mo={class:"flex gap-4 h-full"},go={class:"w-64 border rounded p-3 flex flex-col"},po={class:"flex items-center justify-between mb-3"},yo={class:"flex-1 overflow-y-auto space-y-2"},ho=["onClick"],bo={class:"text-sm font-medium truncate"},xo={class:"text-xs text-gray-500 mt-1"},wo={class:"flex items-center gap-1 flex-shrink-0"},Do={key:0,class:"text-sm text-gray-400 text-center py-4"},$o={class:"flex-1 border rounded p-3 flex flex-col"},Co={class:"mb-3 flex items-center justify-between"},Fo={class:"flex items-center gap-2"},ko={class:"text-base font-semibold"},_o={key:0,class:"flex items-center gap-2"},Po={key:0,class:"ml-1 text-xs"},So={class:"flex-1 overflow-y-auto"},Bo={key:0,class:"space-y-1"},Ao=["onClick"],To={class:"text-xs text-gray-500 w-8"},Mo=["title"],Eo={key:1,class:"text-sm text-gray-400 text-center py-8"},Lo={class:"w-96 border rounded p-3 flex flex-col"},Vo={class:"mb-3"},Uo={class:"flex gap-2 mb-3"},No={class:"mb-3"},zo={class:"space-y-1 max-h-48 overflow-y-auto border rounded p-1"},Oo=["onClick"],Ro={class:"text-sm flex-1"},jo={class:"text-xs text-gray-500 ml-2 whitespace-nowrap"},Wo={key:0,class:"text-xs text-gray-400 text-center py-2"},Go={key:0,class:"flex-1 overflow-y-auto space-y-3"},Yo={class:"border rounded p-2"},Ko={class:"space-y-1"},Ho=["onClick"],Jo={class:"text-xs text-gray-500 whitespace-nowrap"},Qo={class:"border rounded p-2"},qo={class:"flex items-center gap-2 mb-2"},Xo={class:"text-xs text-gray-500 whitespace-nowrap"},Zo={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},St="t_batch_list",Bt="0",Io=7,er=Ve({__name:"BatchDrawer",props:{visible:{type:Boolean,default:!1},playlistCollection:{default:()=>[]},onAddFiles:{type:Function,default:void 0},onRemoveFiles:{type:Function,default:void 0}},emits:["update:visible","refresh"],setup(e,{emit:S}){const f=e,g=S,L=Y([]),i=Y(null),n=Y(null),m=Y([]),h=Y(!1),u=Y([]),V=Y(!1),I=Y(!1),H=Y(!1),$=Y(f.visible),t=ue(()=>L.value.find(y=>y.id===i.value)||null),B=ue(()=>f.playlistCollection.find(y=>y.id===n.value)||null),z=ue(()=>m.value.length>0||h.value),E=ue(()=>!t.value||!t.value.files||t.value.files.length===0?!1:u.value.length===t.value.files.length),A=ue(()=>{if(!t.value||!t.value.files||t.value.files.length===0)return!1;const y=u.value.length,O=t.value.files.length;return y>0&&y<O}),j=y=>typeof y=="string"?y:y?.uri||String(y),U=()=>t.value?.files?u.value.map(y=>t.value.files[y]).filter(y=>y!==null):[],ne=()=>new Set(U().map(j)),de=y=>!!(y?.pre_lists&&Array.isArray(y.pre_lists)&&y.pre_lists.length===Io),oe=y=>!!(y?.playlist&&Array.isArray(y.playlist)),N=(y,O)=>{if(!Array.isArray(y))return 0;let J=0;return y.forEach(re=>{O.has(j(re))&&J++}),J},b=y=>{const O=B.value;if(!de(O))return 0;const J=O.pre_lists[y];return Array.isArray(J)?J.length:0},T=y=>{if(!t.value||!B.value)return 0;const O=ne();if(O.size===0)return 0;const J=B.value;if(!de(J))return 0;const re=J.pre_lists[y];return N(re,O)},w=()=>{const y=B.value;return oe(y)?y.playlist.length:0},R=()=>{if(!t.value||!B.value)return 0;const y=ne();if(y.size===0)return 0;const O=B.value;return oe(O)?N(O.playlist,y):0},p=y=>{if(!y)return 0;let O=0;return de(y)&&y.pre_lists.forEach(J=>{Array.isArray(J)&&(O+=J.length)}),oe(y)&&(O+=y.playlist.length),O},q=y=>{if(!t.value||!y)return 0;const O=ne();if(O.size===0)return 0;let J=0;return de(y)&&y.pre_lists.forEach(re=>{J+=N(re,O)}),oe(y)&&(J+=N(y.playlist,O)),J},Z=async()=>{try{H.value=!0;const y=await cs(St,Bt);let O=[];if(y!=null)if(typeof y=="string"&&y.trim()!=="")try{const J=JSON.parse(y);O=Array.isArray(J)?J:[]}catch{O=[]}else Array.isArray(y)&&(O=y);L.value=O,_()}catch(y){L.value=[],le(y,"加载Batch列表失败")}finally{H.value=!1}},d=async()=>{try{const y=JSON.stringify(L.value);await fs(St,Bt,y)}catch(y){throw le(y,"保存Batch列表失败"),y}},_=()=>{if(L.value.length===0||i.value)return;const y=L.value[0];i.value=y.id,y?.files?.length>0&&(u.value=y.files.map((O,J)=>J))},D=(y,O)=>{const J=y.indexOf(O);J>-1?y.splice(J,1):y.push(O)},X=async()=>{try{const{value:y}=await Be.prompt("请输入Batch名称","创建Batch",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:"Batch名称",inputValidator:re=>!!re&&re.trim().length>0||"名称不能为空"}),O=y.trim(),J={id:Date.now().toString(),name:O,files:[],createTime:new Date().toISOString()};L.value.push(J),await d(),P.success("Batch创建成功"),i.value=J.id}catch(y){y!=="cancel"&&le(y,"创建Batch失败")}},G=async y=>{const O=L.value.find(J=>J.id===y);if(O)try{const{value:J}=await Be.prompt("请输入Batch名称","编辑Batch",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:O.name,inputPlaceholder:"Batch名称",inputValidator:re=>!!re&&re.trim().length>0||"名称不能为空"});O.name=J.trim(),await d(),P.success("Batch名称已更新")}catch(J){J!=="cancel"&&le(J,"编辑Batch失败")}},ce=async y=>{const O=L.value.find(J=>J.id===y);if(O)try{await Be.confirm(`确定要删除Batch "${O.name}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const J=L.value.findIndex(re=>re.id===y);J>-1&&(L.value.splice(J,1),await d(),i.value===y&&(i.value=null),P.success("Batch已删除"))}catch(J){J!=="cancel"&&le(J,"删除Batch失败")}},ge=y=>{i.value=y;const O=L.value.find(J=>J.id===y);O&&O.files&&O.files.length>0?u.value=O.files.map((J,re)=>re):u.value=[]},fe=y=>{D(u.value,y)},Le=y=>{!t.value||!t.value.files||(y?u.value=t.value.files.map((O,J)=>J):u.value=[])},ke=async()=>{if(!(!t.value||u.value.length===0))try{const y=u.value.length;await Be.confirm(`确定要删除选中的 ${y} 个文件吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),[...new Set(u.value)].sort((J,re)=>re-J).forEach(J=>{J>=0&&J<t.value.files.length&&t.value.files.splice(J,1)}),t.value.files.length>0?u.value=t.value.files.map((J,re)=>re):u.value=[],await d(),P.success(`已删除 ${y} 个文件`)}catch(y){y!=="cancel"&&le(y,"删除失败")}},De=()=>{if(!t.value){P.warning("请先选择一个Batch");return}V.value=!0},Se=async y=>{if(!(!t.value||y.length===0))try{I.value=!0;const O=t.value,J=new Set(O.files.map(j)),re=y.filter(M=>!J.has(M)).map(M=>({uri:M}));O.files.push(...re),await d(),O.files.length>0&&(u.value=O.files.map((M,be)=>be)),P.success(`成功添加 ${re.length} 个文件`),V.value=!1}catch(O){le(O,"添加文件失败")}finally{I.value=!1}},x=()=>{V.value=!1},K=y=>{n.value=n.value===y?null:y,m.value=[],h.value=!1},r=y=>{D(m.value,y)},v=y=>{h.value=y!==void 0?y:!h.value},C=()=>!t.value||!n.value||u.value.length===0||!z.value?(P.warning("请选择Batch、播放列表和目标列表，并至少选中一个文件"),!1):!0,F=async()=>{if(C())try{const y=U().map(j);await Be.confirm(`确定要将选中的 ${y.length} 个文件添加到选中的列表吗？`,"确认添加",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),f.onAddFiles&&(await f.onAddFiles({playlistId:n.value,files:y,preLists:m.value,filesList:h.value}),P.success("文件已添加到播放列表"))}catch(y){y!=="cancel"&&le(y,"添加文件失败")}},ee=async()=>{if(C())try{const y=U().map(j);await Be.confirm(`确定要从选中的列表中删除选中的 ${y.length} 个文件吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),f.onRemoveFiles&&(await f.onRemoveFiles({playlistId:n.value,files:y,preLists:m.value,filesList:h.value}),P.success("文件已从播放列表删除"))}catch(y){y!=="cancel"&&le(y,"删除文件失败")}},te=()=>{$.value=!1},pe=()=>{m.value=[],h.value=!1,u.value=[]},ze=()=>{i.value=null,n.value=null,pe()},je=()=>{f.playlistCollection?.length>0?n.value=f.playlistCollection[0].id:n.value=null};return Ee(()=>f.playlistCollection,y=>{y?.length>0&&!n.value&&(n.value=y[0].id)},{immediate:!0}),Ee(()=>f.visible,y=>{$.value=y,y?(pe(),je(),Z()):ze()},{immediate:!0}),Ee($,y=>{y!==f.visible&&g("update:visible",y)}),ot(()=>{Z()}),(y,O)=>{const J=He,re=Ue,M=rt,be=Gt;return c(),se(be,{modelValue:$.value,"onUpdate:modelValue":O[5]||(O[5]=ye=>$.value=ye),title:"批量模式",size:1200,direction:"rtl","header-class":"h-12 !mb-1","before-close":te},{default:a(()=>[s("div",mo,[s("div",go,[s("div",po,[O[6]||(O[6]=s("h3",{class:"text-base font-semibold"},"Batch列表",-1)),l(re,{type:"primary",size:"small",onClick:X,plain:""},{default:a(()=>[l(J,null,{default:a(()=>[l(o(nt))]),_:1})]),_:1})]),s("div",yo,[(c(!0),k($e,null,Ae(L.value,ye=>(c(),k("div",{key:ye.id,class:Te(["border rounded px-3 py-2 hover:bg-gray-50 flex items-center gap-2",{"border-blue-500 bg-blue-50":ye.id===i.value}])},[s("div",{class:"flex-1 cursor-pointer",onClick:Ce=>ge(ye.id)},[s("div",bo,W(ye.name),1),s("div",xo,W(ye.files?ye.files.length:0)+" 个文件 ",1)],8,ho),s("div",wo,[l(re,{type:"default",plain:"",size:"small",circle:"",onClick:Fe(Ce=>ce(ye.id),["stop"]),title:"删除"},{default:a(()=>[l(J,null,{default:a(()=>[l(o(Ne))]),_:1})]),_:1},8,["onClick"])])],2))),128)),L.value.length===0?(c(),k("div",Do,' 暂无Batch，点击"+"创建 ')):ie("",!0)])]),s("div",$o,[s("div",Co,[s("div",Fo,[s("h3",ko,W(t.value?t.value.name:"请选择一个Batch"),1),t.value?(c(),se(re,{key:0,type:"default",plain:"",size:"small",circle:"",onClick:O[0]||(O[0]=ye=>G(t.value.id)),title:"编辑"},{default:a(()=>[l(J,null,{default:a(()=>[l(o(Nt))]),_:1})]),_:1})):ie("",!0)]),t.value?(c(),k("div",_o,[l(re,{type:"default",size:"small",onClick:O[1]||(O[1]=ye=>Le(!E.value)),class:Te([{"!text-blue-600":E.value||A.value},"!w-20"]),plain:""},{default:a(()=>[E.value?(c(),se(J,{key:0,class:"mr-1"},{default:a(()=>[l(o(Xe))]),_:1})):A.value?(c(),se(J,{key:1,class:"mr-1"},{default:a(()=>[l(o(xt))]),_:1})):ie("",!0),O[7]||(O[7]=s("span",{class:"text-xs"},"全选",-1))]),_:1},8,["class"]),l(re,{type:"primary",size:"small",onClick:De,plain:"",class:"!w-20"},{default:a(()=>[l(J,null,{default:a(()=>[l(o(nt))]),_:1})]),_:1}),l(re,{type:"danger",size:"small",onClick:ke,disabled:u.value.length===0,plain:"",class:"!w-20"},{default:a(()=>[l(J,null,{default:a(()=>[l(o(Ne))]),_:1}),u.value.length>0?(c(),k("span",Po,"("+W(u.value.length)+")",1)):ie("",!0)]),_:1},8,["disabled"])])):ie("",!0)]),s("div",So,[t.value&&t.value.files&&t.value.files.length>0?(c(),k("div",Bo,[(c(!0),k($e,null,Ae(t.value.files,(ye,Ce)=>(c(),k("div",{key:Ce,class:Te(["flex items-center gap-2 p-2 border border-blue-500 rounded hover:bg-gray-50 cursor-pointer",{"bg-blue-50":u.value.includes(Ce)}]),onClick:Ke=>fe(Ce)},[l(M,{"model-value":u.value.includes(Ce),onChange:Ke=>fe(Ce),class:"!h-6",onClick:O[2]||(O[2]=Fe(()=>{},["stop"])),size:"default"},null,8,["model-value","onChange"]),s("span",To,W(Ce+1),1),s("span",{class:"flex-1 text-sm truncate",title:j(ye)},W(j(ye).split("/").pop()),9,Mo)],10,Ao))),128))])):(c(),k("div",Eo,W(t.value?"该Batch暂无文件":"请先选择一个Batch"),1))])]),s("div",Lo,[s("div",Vo,[O[11]||(O[11]=s("h3",{class:"text-base font-semibold mb-2"},"Playlist操作",-1)),s("div",Uo,[l(re,{type:"default",size:"small",onClick:F,disabled:!t.value||!n.value||u.value.length===0||!z.value,plain:""},{default:a(()=>[l(J,{class:"mr-1"},{default:a(()=>[l(o(nt))]),_:1}),O[8]||(O[8]=Q(" 添加到播放列表 ",-1))]),_:1},8,["disabled"]),l(re,{type:"default",size:"small",onClick:ee,disabled:!t.value||!n.value||u.value.length===0||!z.value,plain:""},{default:a(()=>[l(J,{class:"mr-1"},{default:a(()=>[l(o(Ne))]),_:1}),O[9]||(O[9]=Q(" 从播放列表删除 ",-1))]),_:1},8,["disabled"])]),s("div",No,[O[10]||(O[10]=s("div",{class:"text-xs text-gray-500 mb-2"},"选择播放列表 进行批量操作",-1)),s("div",zo,[(c(!0),k($e,null,Ae(e.playlistCollection,ye=>(c(),k("div",{key:ye.id,class:Te(["flex items-center justify-between px-2 py-1.5 rounded cursor-pointer hover:bg-gray-50 transition-colors",{"bg-blue-50 border border-blue-200":ye.id===n.value}]),onClick:Ce=>K(ye.id)},[s("span",Ro,W(ye.name),1),s("span",jo,W(q(ye))+" / "+W(p(ye)),1)],10,Oo))),128)),e.playlistCollection.length===0?(c(),k("div",Wo," 暂无播放列表 ")):ie("",!0)])])]),B.value?(c(),k("div",Go,[s("div",Yo,[O[12]||(O[12]=s("div",{class:"text-xs font-semibold text-gray-600 mb-2"},"前置文件",-1)),s("div",Ko,[(c(),k($e,null,Ae(["周一","周二","周三","周四","周五","周六","周日"],(ye,Ce)=>s("div",{key:Ce,class:"flex items-center gap-2"},[l(M,{"model-value":m.value.includes(Ce),onChange:Ke=>r(Ce),size:"small"},null,8,["model-value","onChange"]),s("span",{class:Te(["text-xs flex-1 cursor-pointer hover:text-blue-500",{"text-blue-600 font-medium":m.value.includes(Ce)}]),onClick:Ke=>r(Ce)},W(ye),11,Ho),s("span",Jo,W(T(Ce))+" / "+W(b(Ce)),1)])),64))])]),s("div",Qo,[s("div",qo,[l(M,{"model-value":h.value,onChange:v,size:"small"},null,8,["model-value"]),s("span",{class:Te(["text-xs font-semibold text-gray-600 cursor-pointer hover:text-blue-500 flex-1",{"text-blue-600":h.value}]),onClick:O[3]||(O[3]=ye=>v())}," 正式文件 ",2),s("span",Xo,W(R())+" / "+W(w()),1)])])])):(c(),k("div",Zo," 请先选择一个播放列表 "))])]),l(Mt,{visible:V.value,"onUpdate:visible":O[4]||(O[4]=ye=>V.value=ye),title:"选择文件添加到Batch","confirm-button-text":"添加","confirm-loading":I.value,onConfirm:Se,onClose:x},null,8,["visible","confirm-loading"])]),_:1},8,["modelValue"])}}});function tr(){return{...{playlistCollection:Y([]),activePlaylistId:Y(""),playlistStatus:Y(null),playlistLoading:Y(!1),playlistRefreshing:Y(!1),playing:Y(!1),stopping:Y(!1),showMoreActions:Y(!1),editingPlaylistId:Y(null),editingPlaylistName:Y(""),fileBrowserDialogVisible:Y(!1),fileBrowserTarget:Y("files"),replaceFileInfo:Y(null),selectedWeekdayIndex:Y(null),preFilesDragMode:Y(!1),filesDragMode:Y(!1),preFilesBatchDeleteMode:Y(!1),filesBatchDeleteMode:Y(!1),selectedPreFileIndices:Y([]),selectedFileIndices:Y([]),preFilesExpanded:Y(!1),playlistSelectorVisible:Y(!1),playlistSelectorSelectedFiles:Y([]),batchDrawerVisible:Y(!1),cronBuilderVisible:Y(!1),cronPreviewVisible:Y(!1),cronPreviewTimes:Y([]),initialCronExpr:Y(""),agentListDialogVisible:Y(!1),scanDialogVisible:Y(!1),loading:Y(!1),deviceList:Y([]),connectedDeviceList:Y([]),dlnaDeviceList:Y([]),dlnaScanning:Y(!1),miDeviceList:Y([]),miScanning:Y(!1),pendingDeviceType:Y(null),preFilesSortOrder:Y(null),filesSortOrder:Y(null),preFilesOriginalOrder:Y(null),filesOriginalOrder:Y(null)}}}function lr(e,S,f,g,L,i,n,m){const h=d=>d.map(_=>({..._})),u=d=>{const _="playlist"in d&&Array.isArray(d.playlist)&&d.playlist||"files"in d&&Array.isArray(d.files)&&d.files||[];return h(tt(_,!0))},V=d=>{if(d.pre_lists&&Array.isArray(d.pre_lists)&&d.pre_lists.length===st)return d.pre_lists.map(X=>h(tt(X||[],!0)));const _="pre_files"in d&&Array.isArray(d.pre_files)&&d.pre_files||[],D=h(tt(_,!0));return Array(st).fill(null).map(()=>[...D])},I=d=>Ts.includes(d)?d:As,H=d=>({enabled:d?.enabled===1?1:0,cron:d?.cron?String(d.cron):"",duration:d?.duration||0}),$=(d,_)=>{if(typeof d=="number")return d;if(d==null)return _;const D=parseInt(String(d),10);return isNaN(D)?_:D},t=d=>d===!0||d===1,B=(d,_)=>{if(_===0)return 0;const D=$(d,0);return Math.max(0,Math.min(D,_-1))},z=()=>Array(st).fill(null).map(()=>[]),E=d=>Array.isArray(d)&&d.length===st&&d.every(_=>Array.isArray(_)),A=(d,_="播放列表")=>{const D=u(d),X=V(d),G=B(d?.current_index,D.length),ce=d?.name&&String(d.name).trim()||_,ge=I(d?.device?.type||d?.device_type),fe=d?.device_address||d?.device?.address||null;return{id:d?.id||ts(),name:ce,playlist:D,pre_lists:X,total:D.length,current_index:G,pre_index:$(d?.pre_index,-1),device_address:fe,device_type:ge,device_volume:d?.device_volume,device:d?.device||{type:ge,address:fe,name:d?.device?.name||null},schedule:H(d?.schedule),trigger_button:d?.trigger_button||"",updatedAt:"updatedAt"in d&&typeof d.updatedAt=="number"?d.updatedAt:Date.now(),isPlaying:t(d?.isPlaying)}},j=d=>!Array.isArray(d)||d.length===0?[A({name:We})]:d.map((_,D)=>"playlist"in _&&"total"in _?_:A(_,_?.name||`播放列表${D+1}`)),U=d=>{if(d&&"playlists"in d&&Array.isArray(d.playlists)){const D=d,X=j(D.playlists),G=X.some(ce=>ce.id===D.activePlaylistId)?D.activePlaylistId:X[0]?.id||null;return{playlists:X,activePlaylistId:G}}if(d&&!Array.isArray(d)&&("playlist"in d||"files"in d)){const D=d,X="playlist"in D&&Array.isArray(D.playlist)&&D.playlist||"files"in D&&Array.isArray(D.files)&&D.files||[],G=A({id:D.id||D.playlist_id,name:D.name||We,files:X,current_index:D.current_index,device_address:D.device_address});return{playlists:[G],activePlaylistId:G.id}}const _=A({name:We});return{playlists:[_],activePlaylistId:_.id}},ne=d=>{if(!d)return null;if(!Array.isArray(d)&&Object.keys(d).length>0){const _=Object.values(d).map(D=>A(D,D.name||We));return{playlists:_,activePlaylistId:_[0]?.id||null}}if(Array.isArray(d)){const _=d.map(D=>A(D,D.name||We));return{playlists:_,activePlaylistId:_[0]?.id||null}}if(!Array.isArray(d)&&"id"in d&&typeof d.id=="string"){const _=d;return{playlists:[A(_,_.name||We)],activePlaylistId:_.id}}return null},de=d=>{const _={};return d.forEach(D=>{if(!D.id)return;const X=I(D.device?.type||D.device_type),G=tt(D.playlist||[],!0),ce=V(D);_[D.id]={id:D.id,name:D.name||We,files:G,pre_lists:ce,current_index:D.current_index||0,device:{address:D.device?.address||D.device_address||"",type:X,name:D.device?.name||null},device_volume:D.device_volume,schedule:D.schedule||{enabled:0,cron:"",duration:0},trigger_button:D.trigger_button||"",create_time:D.create_time||_t(),updated_time:_t()}}),_},oe=async d=>{try{const _=(d||e.value||[]).map(G=>({...G,total:Array.isArray(G.playlist)?G.playlist.length:0,updatedAt:Date.now()})),D=de(_),X=await Re("updateAll","POST",D);if(X.code!==0)throw new Error(X.msg||"保存播放列表集合失败")}catch(_){le(_,"保存播放列表集合失败")}},N=async d=>{try{const D=de([d])[d.id];if(!D)throw new Error("播放列表数据格式错误");const X=await Re("update","POST",D);if(X.code!==0)throw new Error(X.msg||"更新播放列表失败");return!0}catch(_){return le(_,"更新播放列表失败"),!1}},b=d=>{const _=Array.isArray(d)?d:e.value;if(!_||_.length===0){f.value=null,S.value="";return}const D=_.find(ce=>ce.id===S.value)||_[0];S.value=D.id;const X=B(D.current_index,D.playlist?.length||0),G=E(D.pre_lists)?D.pre_lists.map(ce=>[...ce||[]]):z();f.value={...D,playlist:[...D.playlist||[]],pre_lists:G,current_index:X,pre_index:$(D.pre_index,-1),in_pre_files:!1,isPlaying:t(D.isPlaying)}},T=d=>({...d,playlist:d.playlist.map(_=>({..._})),pre_lists:E(d.pre_lists)?d.pre_lists.map(_=>_.map(D=>({...D}))):z()}),w=async d=>{if(typeof d!="function")return null;let _=e.value.length>0?e.value.map(T):[A({name:We})],D=_.findIndex(ge=>ge.id===S.value);D===-1&&(D=0,S.value=_[0].id);const X=_[D],G=d(T(X))||X,ce=A(G,X.name);return E(ce.pre_lists)||(ce.pre_lists=E(X.pre_lists)?X.pre_lists.map(ge=>ge.map(fe=>({...fe}))):z()),_[D]=ce,e.value=_,await N(_[D]),b(_),f.value},R=(d,_)=>{const D=localStorage.getItem(Yt);D&&d.some(X=>X.id===D)?S.value=D:S.value=_||""},p=async()=>{try{const d=await Re("get","GET",{});if(d.code!==0)throw new Error(d.msg||"获取播放列表失败");const _=ne(d.data),D=U(_||null);return e.value=D.playlists,R(D.playlists,D.activePlaylistId),b(D.playlists),D}catch(d){qe.error("从接口加载播放列表失败:",d);const _=U(null);return e.value=_.playlists,R(_.playlists,_.activePlaylistId),b(_.playlists),_}},q=d=>d?!!(L.value!==null||i.value||n.value):!1;return{normalizePlaylistItem:A,normalizePlaylistCollection:U,transformApiDataToPlaylistFormat:ne,transformPlaylistToApiFormat:de,savePlaylist:oe,updateSinglePlaylist:N,syncActivePlaylist:b,updateActivePlaylistData:w,loadPlaylist:p,refreshPlaylistStatus:async(d=!1,_=!1)=>{try{if(q(_))return;if(g.value=!0,d){const D=S.value;if(!D)return;const X=await Re("get","GET",{id:D});if(X.code!==0)throw new Error(X.msg||"获取播放列表状态失败");const G=ne(X.data);if(!G?.playlists?.length)return;const ce=G.playlists[0],ge=e.value.map(fe=>fe.id!==D?fe:{...fe,...ce,playlist:ce.playlist||fe.playlist,pre_lists:E(ce.pre_lists)?ce.pre_lists.map(Le=>[...Le||[]]):fe.pre_lists,current_index:ce.current_index!==void 0?ce.current_index:fe.current_index,isPlaying:t(ce?.isPlaying)});e.value=ge,b(ge)}else await p()}catch(D){qe.error("刷新播放列表状态失败:",D)}finally{g.value=!1}}}}function sr(e,S,f,g,L,i,n,m,h){return{loadPlaylist:async()=>{try{const A=await Re("get","GET",{});if(A.code!==0)throw new Error(A.msg||"获取播放列表失败");return A.data}catch(A){throw qe.error("从接口加载播放列表失败:",A),A}},handleSelectPlaylist:async A=>{!A||A===S.value||!e.value.find(U=>U.id===A)||(S.value=A,localStorage.setItem(Yt,A),i(e.value))},handleCreatePlaylist:async()=>{try{const A=`播放列表${e.value.length+1}`,{value:j}=await Be.prompt("请输入播放列表名称","新建播放列表",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:A,inputPlaceholder:A,inputValidator:ne=>!!ne&&ne.trim().length>0||"名称不能为空"});return{name:(j||A).trim()}}catch(A){if(A!=="cancel")throw A;return null}},handleCopyPlaylist:async A=>{if(!A)return null;const j=e.value.find(U=>U.id===A);if(!j)return null;try{const U=`${j.name}_副本`,{value:ne}=await Be.prompt("请输入播放列表名称","复制播放列表",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:U,inputPlaceholder:U,inputValidator:oe=>!!oe&&oe.trim().length>0||"名称不能为空"}),de=(ne||U).trim();return{sourcePlaylist:j,name:de}}catch(U){if(U!=="cancel")throw U;return null}},handleDeletePlaylistGroup:async A=>{if(!A)return!1;if(e.value.length<=1)return P.warning("至少保留一个播放列表"),!1;const j=e.value.find(U=>U.id===A);if(!j)return!1;try{return await Be.confirm(`确认删除播放列表"${j.name}"吗？`,"删除播放列表",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),!0}catch(U){if(U!=="cancel")throw U;return!1}},handlePlayPlaylist:async()=>{const A=f.value;if(!A||!A.id){P.warning("播放列表不存在");return}if(!A.playlist||A.playlist.length===0){P.warning("播放列表为空，请先添加文件");return}try{g.value=!0,await n(U=>{const ne=Array.isArray(U.playlist)?U.playlist:[];return U.current_index=Math.max(0,Math.min(U.current_index||0,ne.length-1)),U.total=ne.length,U});const j=await Re("play","POST",{id:A.id});if(j.code!==0)throw new Error(j.msg||"播放失败");await m(!0),P.success("开始播放")}catch(j){le(j,"播放失败")}finally{g.value=!1}},handlePlayNext:async()=>{const A=f.value;if(!A||!A.id){P.warning("播放列表不存在");return}if(!A.playlist||A.playlist.length===0){P.warning("播放列表为空，无法播放下一首");return}try{g.value=!0;const j=await Re("playNext","POST",{id:A.id});if(j.code!==0)throw new Error(j.msg||"播放下一首失败");await m(!0),P.success("已切换到下一首")}catch(j){le(j,"播放下一首失败")}finally{g.value=!1}},handlePlayPre:async()=>{const A=f.value;if(!A||!A.id){P.warning("播放列表不存在");return}const j=h().length>0,U=A.playlist&&A.playlist.length>0;if(!j&&!U){P.warning("播放列表为空，无法播放上一首");return}try{g.value=!0;const ne=await Re("playPre","POST",{id:A.id});if(ne.code!==0)throw new Error(ne.msg||"播放上一首失败");await m(!0),P.success("已切换到上一首")}catch(ne){le(ne,"播放上一首失败")}finally{g.value=!1}},handleStopPlaylist:async()=>{const A=f.value;if(!A||!A.id){P.warning("播放列表不存在");return}try{L.value=!0;const j=await Re("stop","POST",{id:A.id});if(j.code!==0)throw new Error(j.msg||"停止播放失败");await m(!0),P.success("已停止播放")}catch(j){le(j,"停止播放列表失败")}finally{L.value=!1}}}}function nr(e,S,f,g,L,i){const n=()=>{const B=e.value?.schedule?.cron||"";L.value=B,S.value=!0},m=()=>{S.value=!1},h=B=>{B&&(e.value?(I(B),P.success("Cron 表达式已应用到当前播放列表")):P.warning("请先选择一个播放列表"))},u=B=>{g.value=B,f.value=!0},V=async B=>{e.value&&await i(z=>(z.schedule||(z.schedule={enabled:0,cron:"",duration:0}),z.schedule.enabled=B?1:0,z))},I=async B=>{e.value&&await i(z=>(z.schedule||(z.schedule={enabled:0,cron:"",duration:0}),z.schedule.cron=B,z))};return{handleOpenCronBuilder:n,handleCloseCronBuilder:m,handleCronBuilderApply:h,handleCronBuilderPreview:u,handleTogglePlaylistCronEnabled:V,handleUpdatePlaylistCron:I,handleUpdatePlaylistDuration:async B=>{e.value&&await i(z=>(z.schedule||(z.schedule={enabled:0,cron:"",duration:0}),z.schedule.duration=B||0,z))},handleUpdateTriggerButton:async B=>{e.value&&await i(z=>(z.trigger_button=B||"",z))},handlePreviewPlaylistCron:()=>{if(!e.value||!e.value.schedule?.cron){P.warning("请先设置 Cron 表达式");return}try{const B=e.value.schedule.cron,z=mt(B,5);z&&z.length>0?(g.value=z,f.value=!0):P.warning("无法解析 Cron 表达式")}catch(B){le(B,"预览失败")}}}}function ar(e,S,f,g,L,i,n,m,h,u,V,I){const H=p=>p.deviceID||p.address||"",$=async()=>{const p=e.value,q=S.value||p?.device?.type||p?.device_type||"dlna";if(!["agent","bluetooth"].includes(q)){f.value=[];return}try{n.value=!0;let Z=null;q==="agent"?Z=(await it.get("/agent/list")).data:Z=await Qe("paired","GET"),Z.code===0?f.value=Z.data||[]:P.error(Z.msg||"获取设备失败")}catch(Z){console.error("获取设备失败:",Z),P.error("获取设备失败")}finally{n.value=!1}},t=async p=>{try{p.connecting=!0;const q=await Qe("connect","POST",{address:p.address});q.code===0?(P.success(`成功连接到设备: ${p.name}`),await $(),i.value=i.value.filter(Z=>Z.address!==p.address)):P.error(q.msg||"连接失败")}catch(q){console.error("连接设备失败:",q),P.error("连接设备失败")}finally{p.connecting=!1}},B=async()=>{try{m.value=!0;const p=await Lt(5);p.code===0?(g.value=p.data||[],P.success(`扫描到 ${g.value.length} 个 DLNA 设备`)):P.error(p.msg||"扫描 DLNA 设备失败")}catch(p){le(p,"扫描 DLNA 设备失败")}finally{m.value=!1}},z=async p=>{const q=H(p);if(!q)return;const Z=L.value;if(!Array.isArray(Z))return;const d=Z.find(_=>H(_)===q);if(d){d._volumeRefreshing=!0;try{const _=await it.get("/mi/volume",{params:{device_id:q}});_.data.code===0?d.volume=_.data.data?.volume??_.data.data??void 0:P.error(_.data.msg||`获取设备 ${d.name||q} 音量失败`)}catch(_){le(_,`获取设备 ${d.name||q} 音量失败`)}finally{d._volumeRefreshing=!1}}},E=async()=>{try{h.value=!0;const p=await Et(5);if(p.code===0){const Z=(p.data||[]).map(d=>({name:d.name||"",address:d.address||"",...d,volume:void 0,_volumeChanging:!1,_volumeRefreshing:!1}));L.value=Z,await Promise.allSettled(L.value.map(d=>z(d))),P.success(`扫描到 ${Z.length} 个小米设备`)}else P.error(p.msg||"扫描小米设备失败")}catch(p){le(p,"扫描小米设备失败")}finally{h.value=!1}},A=async()=>{try{n.value=!0;const p=await Qe("scan","GET");if(p.code===0){const q=Array.isArray(p.data)?p.data:[];i.value=q.map(Z=>({name:Z.name||"",address:Z.address||"",...Z,connecting:!1})),P.success(`扫描完成，找到 ${i.value.length} 个设备`)}else P.error(p.msg||"扫描失败")}catch(p){console.error("扫描设备失败:",p),P.error("扫描设备失败")}finally{n.value=!1}},j=()=>{u.value=!0},U=()=>{u.value=!1},ne=async p=>{if(!e.value||!p||p==="")return;if(!["agent","dlna","bluetooth","mi"].includes(p)){P.error(`无效的设备类型: ${p}`);return}const Z=p;S.value=Z;const d=e.value,_=d.device_volume;d.device_type=Z,d.device?d.device.type=Z:d.device={type:Z,address:"",name:null},_!==void 0&&(d.device_volume=_),await $()},de=async(p,q=null)=>{e.value&&(await I(Z=>{const d=S.value||Z.device?.type||Z.device_type||"dlna",_=Z.device_volume;return Z.device||(Z.device={address:"",type:d,name:null}),Z.device.type=d,Z.device.address=p,q!==null&&(Z.device.name=q),Z.device_address=p,Z.device_type=d,_!==void 0&&(Z.device_volume=_),Z}),S.value=null)},oe=p=>Math.max(5,Math.min(100,p));return{getMiDeviceId:H,refreshConnectedList:$,handleConnectDevice:t,scanDlnaDevices:B,getMiDeviceVolume:z,scanMiDevices:E,handleUpdateDeviceList:A,handleOpenScanDialog:j,handleCloseScanDialog:U,handleUpdatePlaylistDeviceType:ne,handleUpdatePlaylistDeviceAddress:de,handleUpdatePlaylistDeviceVolume:async p=>{if(!e.value)return;const q=oe(p);await I(Z=>(Z.device_volume=q,Z))},handleSelectBluetoothDevice:async p=>{const q=f.value.find(d=>d.address===p),Z=q?q.name:null;await de(p,Z)},handleSelectAgentDevice:async p=>{const q=typeof p=="string"?p:p.address,Z=typeof p=="string"?null:p.name;await de(q,Z)},handleSelectMiDevice:async p=>{const q=p.deviceID||p.address||"",Z=p.name||"";await de(q,Z)},handleOpenAgentListDialog:async()=>{V.value=!0,await $()}}}function ir(){const e=ss({callbacks:{onPlay:()=>{P.success("开始播放")},onError:()=>{le(new Error("音频播放失败"),"播放失败"),S()},onEnded:()=>{S()}}}),S=()=>{e.clear()};return{audioPlayer:e,clearBrowserAudioPlayer:S,handlePlayFileInBrowser:m=>{const h=m?.uri||m?.path||"";if(!h||typeof h!="string"||h.trim()===""){P.warning("文件路径无效");return}if(e.playingFilePath.value===h&&e.audio&&!e.audio.paused){S(),P.info("已停止播放");return}const u=ls(h);if(!u||typeof u!="string"||u.trim()===""){P.error("无法生成媒体文件URL");return}if(u.includes("index.html")||u.endsWith(".html")){P.error("生成的媒体URL无效，可能是HTML页面");return}e.load(u,{playingFilePath:h}),e.play().catch(V=>{le(V,"播放失败"),S()})},isFilePlaying:m=>{const h=m?.uri||m?.path||"";return e.isFilePlaying(h)},getFilePlayProgress:m=>{const h=m?.uri||m?.path||"";return e.getFilePlayProgress(h)},getFileDuration:m=>{const h=m?.uri||m?.path||"",u=m?.duration||0;return e.getFileDuration(h,u)},handleSeekFile:(m,h)=>{const u=m?.uri||m?.path||"";e.seekFile(u,h)}}}function or(e,S,f,g,L,i,n,m,h,u,V,I,H,$,t){const B=()=>n.value!==null?n.value:Ye(),z=x=>((!x.pre_lists||!Array.isArray(x.pre_lists)||x.pre_lists.length!==7)&&(x.pre_lists=Array(7).fill(null).map(()=>[])),x.pre_lists),E=(x="请先选择一个播放列表")=>S.value?!0:(P.warning(x),!1),A=(x,K)=>{x!=="cancel"&&le(x,K)},j=async(x,K)=>{try{f.value=!0,await x()}catch(r){A(r,K)}finally{f.value=!1}},U=()=>{E()&&(g.value=!0,L.value="files",i.value=null)},ne=()=>{E()&&(g.value=!0,L.value="pre_files",i.value=null)},de=async x=>{if(x.length!==0){if(!S.value){P.warning("请先创建并选择一个播放列表");return}try{f.value=!0,await I(r=>{const v=B(),C=L.value,F=C==="pre_files"?Array.isArray(r.pre_lists)&&r.pre_lists.length===7?[...r.pre_lists[v]||[]]:[]:Array.isArray(r.playlist)?[...r.playlist]:[],ee=new Set;if(F.forEach(te=>{te?.uri&&ee.add(te.uri)}),i.value&&x.length>0){const te=i.value.index;if(i.value.type==="pre_files"){z(r);const pe=[...r.pre_lists[v]||[]];te>=0&&te<pe.length&&(pe[te]={uri:x[0]},r.pre_lists[v]=pe)}else{const pe=[...r.playlist];te>=0&&te<pe.length&&(pe[te]={uri:x[0]},r.playlist=pe,r.total=pe.length)}return i.value=null,r}for(const te of x)if(!ee.has(te)){const pe={uri:te};F.push(pe),ee.add(te)}return C==="pre_files"?(z(r),r.pre_lists[v]=F):(r.playlist=F,r.total=F.length,F.length===0?r.current_index=0:r.current_index>=F.length&&(r.current_index=F.length-1)),r});const K=L.value==="pre_files"?"前置列表":"播放列表";P.success(`成功添加 ${x.length} 个文件到${K}`),g.value=!1}catch(K){le(K,"添加文件到播放列表失败")}finally{f.value=!1}}},oe=()=>{g.value=!1},N=async x=>{const K=S.value;if(!(!K||x<=0||x>=K.playlist.length))try{f.value=!0,await I(r=>{const v=[...r.playlist];return[v[x-1],v[x]]=[v[x],v[x-1]],r.playlist=v,r.current_index===x?r.current_index=x-1:r.current_index===x-1&&(r.current_index=x),r.total=v.length,r}),P.success("已上移")}catch(r){le(r,"上移失败")}finally{f.value=!1}},b=async x=>{const K=S.value;if(!(!K||x<0||x>=K.playlist.length-1))try{f.value=!0,await I(r=>{const v=[...r.playlist];return[v[x],v[x+1]]=[v[x+1],v[x]],r.playlist=v,r.current_index===x?r.current_index=x+1:r.current_index===x+1&&(r.current_index=x),r.total=v.length,r}),P.success("已下移")}catch(r){le(r,"下移失败")}finally{f.value=!1}},T=async x=>{const K=S.value;if(!K||x<0||x>=K.playlist.length)return;const v=K.playlist[x]?.uri?.split("/").pop()||"文件";try{await Be.confirm(`确定要删除 "${v}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),f.value=!0,await I(C=>{const F=[...C.playlist];return F.splice(x,1),C.playlist=F,F.length===0?C.current_index=0:x<C.current_index?C.current_index=Math.max(0,C.current_index-1):x===C.current_index&&(C.current_index=Math.min(C.current_index,F.length-1)),C.total=F.length,C}),P.success("已删除")}catch(C){C!=="cancel"&&le(C,"删除失败")}finally{f.value=!1}},w=async x=>{const K=S.value;!K||x<0||x>=K.playlist.length||(i.value={type:"files",index:x},L.value="files",g.value=!0)},R=async x=>{const K=S.value,r=H();!K||!r||x<=0||x>=r.length||await j(async()=>{await I(v=>{const C=B();z(v);const F=[...v.pre_lists[C]||[]];return[F[x-1],F[x]]=[F[x],F[x-1]],v.pre_lists[C]=F,v})},"上移失败")},p=async x=>{const K=S.value,r=H();!K||!r||x<0||x>=r.length-1||await j(async()=>{await I(v=>{const C=B();z(v);const F=[...v.pre_lists[C]||[]];return[F[x],F[x+1]]=[F[x+1],F[x]],v.pre_lists[C]=F,v})},"下移失败")},q=async x=>{const K=S.value,r=H();if(!K||!r||x<0||x>=r.length)return;const C=r[x]?.uri?.split("/").pop()||"文件";try{await Be.confirm(`确定要删除 "${C}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await j(async()=>{await I(F=>{const ee=B();z(F);const te=[...F.pre_lists[ee]||[]];return te.splice(x,1),F.pre_lists[ee]=te,F}),P.success("已删除")},"删除失败")}catch(F){A(F,"删除失败")}},Z=async x=>{const K=S.value,r=H();!K||!r||x<0||x>=r.length||(i.value={type:"pre_files",index:x},L.value="pre_files",g.value=!0)},d=()=>{m.value=!m.value,m.value||(u.value=[])},_=()=>{h.value=!h.value,h.value||(V.value=[])},D=x=>{const K=u.value,r=K.indexOf(x);r>-1?K.splice(r,1):K.push(x)},X=x=>{const K=V.value,r=K.indexOf(x);r>-1?K.splice(r,1):K.push(x)},G=async()=>{const x=S.value,K=H(),r=u.value;if(!x||!K||r.length===0)return;const v=r.length;try{await Be.confirm(`确定要删除选中的 ${v} 个前置文件吗？`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await j(async()=>{const C=[...new Set(r)].sort((F,ee)=>ee-F);await I(F=>{const ee=B();z(F);const te=[...F.pre_lists[ee]||[]];return C.forEach(pe=>{pe>=0&&pe<te.length&&te.splice(pe,1)}),F.pre_lists[ee]=te,F}),u.value=[],m.value=!1,P.success(`已删除 ${v} 个前置文件`)},"批量删除失败")}catch(C){A(C,"批量删除失败")}},ce=async()=>{const x=S.value,K=V.value;if(!x||!x.playlist||K.length===0)return;const r=K.length;try{await Be.confirm(`确定要删除选中的 ${r} 个正式文件吗？`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await j(async()=>{const v=[...new Set(K)].sort((C,F)=>F-C);await I(C=>{const F=[...C.playlist];if(v.forEach(ee=>{ee>=0&&ee<F.length&&F.splice(ee,1)}),C.playlist=F,F.length===0)C.current_index=0;else{let ee=C.current_index;v.forEach(te=>{te<C.current_index?ee=Math.max(0,ee-1):te===C.current_index&&(ee=Math.min(ee,F.length-1))}),C.current_index=ee}return C.total=F.length,C}),V.value=[],h.value=!1,P.success(`已删除 ${r} 个正式文件`)},"批量删除失败")}catch(v){A(v,"批量删除失败")}},ge=async()=>{const x=S.value,K=H();if(!(!x||!K||K.length===0))try{await Be.confirm(`确定要清空前置文件列表吗？此操作将删除所有 ${K.length} 个前置文件。`,"确认清空",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await j(async()=>{await I(r=>{const v=B();return z(r),r.pre_lists[v]=[],r}),P.success("已清空前置文件列表")},"清空失败")}catch(r){A(r,"清空失败")}},fe=async()=>{const x=S.value;if(!(!x||!x.playlist||x.playlist.length===0))try{await Be.confirm(`确定要清空正式文件列表吗？此操作将删除所有 ${x.playlist.length} 个正式文件。`,"确认清空",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await j(async()=>{await I(K=>(K.playlist=[],K.total=0,K.current_index=0,K)),P.success("已清空正式文件列表")},"清空失败")}catch(K){A(K,"清空失败")}},Le=async()=>{const x=S.value;if(!x)return;const K=H(),r=K&&K.length||0,v=x.playlist&&x.playlist.length||0,C=r+v;if(C!==0)try{const F=r>0&&v>0?`确定要清空播放列表 "${x.name}" 吗？此操作将删除所有 ${r} 个前置文件和 ${v} 个正式文件，共 ${C} 个文件。`:r>0?`确定要清空播放列表 "${x.name}" 吗？此操作将删除所有 ${r} 个前置文件。`:`确定要清空播放列表 "${x.name}" 吗？此操作将删除所有 ${v} 个正式文件。`;await Be.confirm(F,"确认清空",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await j(async()=>{await I(ee=>(ee.playlist=[],z(ee),ee.pre_lists=ee.pre_lists.map(()=>[]),ee.total=0,ee.current_index=0,ee)),P.success("已清空播放列表（包括前置文件和正式文件）")},"清空失败")}catch(F){A(F,"清空失败")}},ke=x=>typeof x=="string"?{uri:x}:{...x,uri:x.uri||""};return{handleOpenFileBrowser:U,handleOpenFileBrowserForPreFiles:ne,handleFileBrowserConfirm:de,handleCloseFileBrowser:oe,handleMovePlaylistItemUp:N,handleMovePlaylistItemDown:b,handleDeletePlaylistItem:T,handleReplacePlaylistItem:w,handleMovePreFileUp:R,handleMovePreFileDown:p,handleDeletePreFile:q,handleReplacePreFile:Z,handleTogglePreFilesBatchDeleteMode:d,handleToggleFilesBatchDeleteMode:_,handleTogglePreFileSelection:D,handleToggleFileSelection:X,handleBatchDeletePreFiles:G,handleBatchDeleteFiles:ce,handleClearPreFiles:ge,handleClearFiles:fe,handleClearPlaylist:Le,handleOpenPlaylistSelectorForPreFile:async x=>{try{if(!x){P.warning("文件信息无效");return}if(t&&$){const K=ke(x);t.value=[K],$.value=!0}else P.info("请使用文件浏览器添加文件到播放列表")}catch(K){qe.error("打开播放列表选择器失败:",K),P.error("打开对话框失败")}},handleOpenPlaylistSelectorForFile:async x=>{try{if(!x){P.warning("文件信息无效");return}const K=ke(x);if(!K.uri){P.warning("文件URI无效");return}t&&$?(t.value=[K],$.value=!0):P.info("请使用文件浏览器添加文件到播放列表")}catch(K){qe.error("打开播放列表选择器失败:",K),P.error("打开对话框失败")}}}}function rr(e,S,f,g,L,i,n,m,h,u,V,I,H){const $=()=>u.value!==null?u.value:Ye(),t=(b,T)=>{if(!b||!T||b.length!==T.length)return!0;for(let w=0;w<b.length;w++){const R=b[w]?.uri||b[w],p=T[w]?.uri||T[w];if(R!==p)return!0}return!1};return{handleTogglePreFilesDragMode:async()=>{if(g.value){const b=S.value,T=H();if(b&&T&&T.length>0){if(t(m.value||[],T))try{f.value=!0,await V(R=>{const p=$();return(!R.pre_lists||!Array.isArray(R.pre_lists)||R.pre_lists.length!==7)&&(R.pre_lists=Array(7).fill(null).map(()=>[])),R.pre_lists[p]=[...T],R.pre_index=b.pre_index,R}),P.success("排序已保存")}catch(R){le(R,"保存排序失败")}finally{f.value=!1}m.value=null}}else{const b=S.value,T=H();b&&T&&T.length>0&&(m.value=[...T]),i.value=null}g.value=!g.value},handleToggleFilesDragMode:async()=>{if(L.value){const b=S.value;if(b&&b.playlist&&b.playlist.length>0){if(t(h.value||[],b.playlist))try{f.value=!0,await V(w=>(w.playlist=[...b.playlist||[]],w.current_index=b.current_index,w.total=b.playlist.length,w)),P.success("排序已保存")}catch(w){le(w,"保存排序失败")}finally{f.value=!1}h.value=null}}else{const b=S.value;b&&b.playlist&&b.playlist.length>0&&(h.value=[...b.playlist||[]]),n.value=null}L.value=!L.value},handlePreFileDragStart:(b,T)=>{if(!g.value){b.preventDefault();return}try{b.dataTransfer.effectAllowed="move",b.dataTransfer.setData("text/plain",T.toString())}catch(w){console.error("拖拽开始失败:",w)}},handlePreFileDragEnd:b=>{const T=b.currentTarget;T&&T.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")},handlePreFileDragOver:b=>{if(!g.value)return;b.preventDefault(),b.dataTransfer.dropEffect="move";const T=b.currentTarget;if(T){const w=T.getBoundingClientRect(),R=b.clientY,p=w.top+w.height/2;T.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500"),R<p?T.classList.add("border-t-2","border-blue-500"):T.classList.add("border-b-2","border-blue-500")}},handlePreFileDrop:(b,T)=>{if(!g.value)return;b.preventDefault();const w=b.currentTarget;w&&w.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500");const R=parseInt(b.dataTransfer.getData("text/plain"),10);if(R===T||isNaN(R))return;const p=S.value,q=H();if(!p||!q||R<0||R>=q.length||T<0||T>=q.length)return;const Z=$(),d=[...q],[_]=d.splice(R,1);d.splice(T,0,_);let D=p.pre_index;p.pre_index!==void 0&&p.pre_index!==null&&p.pre_index>=0&&(p.pre_index===R?D=T:R<p.pre_index&&T>=p.pre_index?D=p.pre_index-1:R>p.pre_index&&T<=p.pre_index&&(D=p.pre_index+1));const X=e.value.map(G=>G.id===p.id?((!G.pre_lists||!Array.isArray(G.pre_lists)||G.pre_lists.length!==7)&&(G.pre_lists=Array(7).fill(null).map(()=>[])),{...G,pre_lists:G.pre_lists.map((ce,ge)=>ge===Z?d:ce),pre_index:D}):G);e.value=X,I(X)},handleFileDragStart:(b,T)=>{if(!L.value){b.preventDefault();return}try{b.dataTransfer.effectAllowed="move",b.dataTransfer.setData("text/plain",T.toString())}catch(w){console.error("拖拽开始失败:",w)}},handleFileDragEnd:b=>{const T=b.currentTarget;T&&T.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")},handleFileDragOver:b=>{if(!L.value)return;b.preventDefault(),b.dataTransfer.dropEffect="move";const T=b.currentTarget;if(T){const w=T.getBoundingClientRect(),R=b.clientY,p=w.top+w.height/2;T.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500"),R<p?T.classList.add("border-t-2","border-blue-500"):T.classList.add("border-b-2","border-blue-500")}},handleFileDrop:(b,T)=>{if(!L.value)return;b.preventDefault();const w=b.currentTarget;w&&w.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500");const R=parseInt(b.dataTransfer.getData("text/plain"),10);if(R===T||isNaN(R))return;const p=S.value;if(!p||!p.playlist||R<0||R>=p.playlist.length||T<0||T>=p.playlist.length)return;const q=[...p.playlist||[]],[Z]=q.splice(R,1);q.splice(T,0,Z);let d=p.current_index;p.current_index!==void 0&&p.current_index!==null&&p.current_index>=0&&(p.current_index===R?d=T:R<p.current_index&&T>=p.current_index?d=p.current_index-1:R>p.current_index&&T<=p.current_index&&(d=p.current_index+1));const _=e.value.map(D=>D.id===p.id?{...D,playlist:q,current_index:d,total:q.length}:D);e.value=_,I(_)}}}function dr(e,S,f,g,L,i){const n=Y(!1),m=Y(null),h=Y("");return{editNameDialogVisible:n,editNameDialogName:h,handleStartEditPlaylistName:H=>{const $=e.value.find(t=>t.id===H);$&&(m.value=H,h.value=$.name,n.value=!0)},handleSavePlaylistName:async()=>{if(!m.value)return;const H=h.value?.trim();if(!H||H.length===0){P.warning("播放列表名称不能为空");return}const $=m.value,t=e.value.find(B=>B.id===$);if(!t||t.name===H){n.value=!1,m.value=null,h.value="";return}try{const B=e.value.map(z=>z.id===$?{...z,name:H}:z);e.value=B,$===S.value&&i(B),await L(B),n.value=!1,m.value=null,h.value="",P.success("播放列表名称已更新")}catch(B){le(B,"更新播放列表名称失败")}},handleCancelEditPlaylistName:()=>{n.value=!1,m.value=null,h.value=""}}}const ur={class:"p-1"},cr={class:"flex gap-4 h-[calc(100vh-150px)]"},$r=Ve({__name:"index",setup(e){const{playlistCollection:S,activePlaylistId:f,playlistStatus:g,playlistLoading:L,playlistRefreshing:i,playing:n,stopping:m,showMoreActions:h,editingPlaylistId:u,editingPlaylistName:V,fileBrowserDialogVisible:I,fileBrowserTarget:H,replaceFileInfo:$,selectedWeekdayIndex:t,preFilesDragMode:B,filesDragMode:z,preFilesBatchDeleteMode:E,filesBatchDeleteMode:A,selectedPreFileIndices:j,selectedFileIndices:U,preFilesExpanded:ne,playlistSelectorVisible:de,playlistSelectorSelectedFiles:oe,batchDrawerVisible:N,cronBuilderVisible:b,cronPreviewVisible:T,cronPreviewTimes:w,initialCronExpr:R,agentListDialogVisible:p,scanDialogVisible:q,loading:Z,deviceList:d,connectedDeviceList:_,dlnaDeviceList:D,dlnaScanning:X,miDeviceList:G,miScanning:ce,pendingDeviceType:ge,preFilesSortOrder:fe,filesSortOrder:Le,preFilesOriginalOrder:ke,filesOriginalOrder:De}=tr(),{audioPlayer:Se,handlePlayFileInBrowser:x,handleSeekFile:K}=ir(),r=()=>t.value!==null?t.value:Ye(),v=()=>{const ve=g.value;if(!ve||!ve.pre_lists)return[];const ae=r();return!Array.isArray(ve.pre_lists)||ve.pre_lists.length!==7?[]:ve.pre_lists[ae]||[]},{savePlaylist:C,syncActivePlaylist:F,updateActivePlaylistData:ee,loadPlaylist:te,refreshPlaylistStatus:pe}=lr(S,f,g,i,ge,B,z),ze=async ve=>{await ee(ve)},{handleOpenFileBrowser:je,handleOpenFileBrowserForPreFiles:y,handleFileBrowserConfirm:O,handleCloseFileBrowser:J,handleMovePlaylistItemUp:re,handleMovePlaylistItemDown:M,handleDeletePlaylistItem:be,handleReplacePlaylistItem:ye,handleMovePreFileUp:Ce,handleMovePreFileDown:Ke,handleDeletePreFile:Dt,handleReplacePreFile:Kt,handleTogglePreFilesBatchDeleteMode:Ht,handleToggleFilesBatchDeleteMode:Jt,handleTogglePreFileSelection:Qt,handleToggleFileSelection:qt,handleBatchDeletePreFiles:Xt,handleBatchDeleteFiles:Zt,handleClearPreFiles:It,handleClearFiles:el,handleClearPlaylist:tl,handleOpenPlaylistSelectorForPreFile:ll,handleOpenPlaylistSelectorForFile:sl}=or(S,g,L,I,H,$,t,E,A,j,U,ze,v,de,oe),{handleTogglePreFilesDragMode:nl,handleToggleFilesDragMode:al,handlePreFileDragStart:il,handlePreFileDragEnd:ol,handlePreFileDragOver:rl,handlePreFileDrop:dl,handleFileDragStart:ul,handleFileDragEnd:cl,handleFileDragOver:fl,handleFileDrop:vl}=rr(S,g,L,B,z,fe,Le,ke,De,t,ze,F,v),{editNameDialogVisible:dt,editNameDialogName:ut,handleStartEditPlaylistName:ml,handleSavePlaylistName:ct,handleCancelEditPlaylistName:Ie}=dr(S,f,u,V,C,F),{handleOpenCronBuilder:gl,handleCloseCronBuilder:pl,handleCronBuilderApply:yl,handleCronBuilderPreview:hl,handleTogglePlaylistCronEnabled:bl,handleUpdatePlaylistCron:xl,handleUpdatePlaylistDuration:wl,handleUpdateTriggerButton:Dl,handlePreviewPlaylistCron:$l}=nr(g,b,T,w,R,ee),{refreshConnectedList:$t,handleConnectDevice:Cl,scanDlnaDevices:Fl,scanMiDevices:kl,handleUpdateDeviceList:_l,handleOpenScanDialog:Pl,handleCloseScanDialog:Sl,handleUpdatePlaylistDeviceType:Bl,handleUpdatePlaylistDeviceAddress:Al,handleUpdatePlaylistDeviceVolume:Tl,handleSelectBluetoothDevice:Ml,handleSelectAgentDevice:El,handleSelectMiDevice:Ll,handleOpenAgentListDialog:Vl}=ar(g,ge,_,D,G,d,Z,X,ce,q,p,ee),{handleSelectPlaylist:Ul,handleCreatePlaylist:Nl,handleCopyPlaylist:zl,handleDeletePlaylistGroup:Ol,handlePlayPlaylist:Rl,handlePlayNext:jl,handlePlayPre:Wl,handleStopPlaylist:Gl}=sr(S,f,g,n,m,F,ee,pe,v),Yl=async ve=>{await Ul(ve),ge.value=null,fe.value=null,Le.value=null,B.value=!1,z.value=!1,ke.value=null,De.value=null,E.value=!1,A.value=!1,j.value=[],U.value=[],await $t()},Kl=async(ve,ae)=>{ve==="delete"?await Ol(ae):ve==="copy"&&await zl(ae)},Hl=async ve=>{try{if(L.value=!0,!S.value.find(xe=>xe.id===ve.playlistId)){P.warning("播放列表不存在");return}await ee(xe=>{if(xe.id!==ve.playlistId)return xe;if(ve.preLists.length>0&&((!xe.pre_lists||!Array.isArray(xe.pre_lists)||xe.pre_lists.length!==7)&&(xe.pre_lists=Array(7).fill(null).map(()=>[])),ve.preLists.forEach(me=>{if(me>=0&&me<7){const _e=new Set((xe.pre_lists[me]||[]).map(Me=>typeof Me=="string"?Me:Me?.uri||""));ve.files.forEach(Me=>{_e.has(Me)||(xe.pre_lists[me]||(xe.pre_lists[me]=[]),xe.pre_lists[me].push({uri:Me}))})}})),ve.filesList){Array.isArray(xe.playlist)||(xe.playlist=[]);const me=new Set(xe.playlist.map(_e=>typeof _e=="string"?_e:_e?.uri||""));ve.files.forEach(_e=>{me.has(_e)||xe.playlist.push({uri:_e})}),xe.total=xe.playlist.length}return xe}),F(S.value),await C(S.value)}catch(ae){le(ae,"批量添加文件失败")}finally{L.value=!1}},Jl=async ve=>{try{if(L.value=!0,!S.value.find(me=>me.id===ve.playlistId)){P.warning("播放列表不存在");return}const xe=new Set(ve.files);await ee(me=>(me.id!==ve.playlistId||(ve.preLists.length>0&&me.pre_lists&&Array.isArray(me.pre_lists)&&me.pre_lists.length===7&&ve.preLists.forEach(_e=>{_e>=0&&_e<7&&me.pre_lists[_e]&&(me.pre_lists[_e]=me.pre_lists[_e].filter(Me=>{const vt=typeof Me=="string"?Me:Me?.uri||"";return!xe.has(vt)}))}),ve.filesList&&Array.isArray(me.playlist)&&(me.playlist=me.playlist.filter(_e=>{const Me=typeof _e=="string"?_e:_e?.uri||"";return!xe.has(Me)}),me.total=me.playlist.length,me.playlist.length===0?me.current_index=0:me.current_index>=me.playlist.length&&(me.current_index=me.playlist.length-1))),me)),F(S.value),await C(S.value)}catch(ae){le(ae,"批量删除文件失败")}finally{L.value=!1}},Ql=async()=>{await Vl()},ql=ve=>{t.value=ve,F(S.value)},ft=Y(!0),{start:Ct,stop:Ft}=ns(async()=>{await pe(!0,!0)},Ms,{immediate:!1,autoCleanup:!0}),Xl=ve=>{ft.value=ve,ve?Ct():Ft()};return ot(async()=>{await te(),await $t(),ft.value&&Ct()}),At(()=>{Ft()}),(ve,ae)=>{const xe=Rt,me=zt,_e=pt,Me=Ue,vt=Ze;return c(),k("div",ur,[s("div",cr,[l(mn,{"playlist-collection":o(S),"active-playlist-id":o(f),refreshing:o(i),"auto-refresh-enabled":ft.value,onSelect:Yl,onCreate:o(Nl),onRefresh:o(pe),onToggleAutoRefresh:Xl,onMenuCommand:Kl},null,8,["playlist-collection","active-playlist-id","refreshing","auto-refresh-enabled","onCreate","onRefresh"]),l(aa,{"playlist-status":o(g),"active-playlist-id":o(f),"editing-playlist-id":o(u),"editing-playlist-name":o(V),"onUpdate:editingPlaylistName":ae[0]||(ae[0]=we=>et(V)?V.value=we:null),"selected-weekday-index":o(t),"pre-files-drag-mode":o(B),"pre-files-batch-delete-mode":o(E),"selected-pre-file-indices":o(j),"pre-files-expanded":o(ne),"files-drag-mode":o(z),"files-batch-delete-mode":o(A),"selected-file-indices":o(U),"playlist-loading":o(L),playing:o(n),stopping:o(m),"show-more-actions":o(h),"audio-player":o(Se),onStartEditName:o(ml),onSaveName:o(ct),onCancelEditName:o(Ie),onOpenBatchDrawer:ae[1]||(ae[1]=we=>N.value=!0),onPlay:o(Rl),onPlayPre:o(Wl),onPlayNext:o(jl),onStop:o(Gl),onClear:o(tl),onToggleMoreActions:ae[2]||(ae[2]=we=>h.value=!o(h)),onSelectWeekday:ql,onOpenFileBrowserForPreFiles:o(y),onTogglePreFilesDragMode:o(nl),onTogglePreFilesBatchDeleteMode:o(Ht),onBatchDeletePreFiles:o(Xt),onClearPreFiles:o(It),onTogglePreFilesExpand:ae[3]||(ae[3]=we=>ne.value=!o(ne)),onTogglePreFileSelection:o(Qt),onPreFileDragStart:o(il),onPreFileDragEnd:o(ol),onPreFileDragOver:o(rl),onPreFileDrop:o(dl),onOpenFileBrowser:o(je),onToggleFilesDragMode:o(al),onToggleFilesBatchDeleteMode:o(Jt),onBatchDeleteFiles:o(Zt),onClearFiles:o(el),onToggleFileSelection:o(qt),onFileDragStart:o(ul),onFileDragEnd:o(cl),onFileDragOver:o(fl),onFileDrop:o(vl),onPlayFile:o(x),onSeekFile:o(K),onMovePreFileUp:o(Ce),onMovePreFileDown:o(Ke),onReplacePreFile:o(Kt),onOpenPlaylistSelectorForPreFile:o(ll),onDeletePreFile:o(Dt),onMoveFileUp:o(re),onMoveFileDown:o(M),onReplaceFile:o(ye),onOpenPlaylistSelectorForFile:o(sl),onDeleteFile:o(be)},null,8,["playlist-status","active-playlist-id","editing-playlist-id","editing-playlist-name","selected-weekday-index","pre-files-drag-mode","pre-files-batch-delete-mode","selected-pre-file-indices","pre-files-expanded","files-drag-mode","files-batch-delete-mode","selected-file-indices","playlist-loading","playing","stopping","show-more-actions","audio-player","onStartEditName","onSaveName","onCancelEditName","onPlay","onPlayPre","onPlayNext","onStop","onClear","onOpenFileBrowserForPreFiles","onTogglePreFilesDragMode","onTogglePreFilesBatchDeleteMode","onBatchDeletePreFiles","onClearPreFiles","onTogglePreFileSelection","onPreFileDragStart","onPreFileDragEnd","onPreFileDragOver","onPreFileDrop","onOpenFileBrowser","onToggleFilesDragMode","onToggleFilesBatchDeleteMode","onBatchDeleteFiles","onClearFiles","onToggleFileSelection","onFileDragStart","onFileDragEnd","onFileDragOver","onFileDrop","onPlayFile","onSeekFile","onMovePreFileUp","onMovePreFileDown","onReplacePreFile","onOpenPlaylistSelectorForPreFile","onDeletePreFile","onMoveFileUp","onMoveFileDown","onReplaceFile","onOpenPlaylistSelectorForFile","onDeleteFile"]),l(Qa,{"playlist-status":o(g),"connected-device-list":o(_),"dlna-device-list":o(D),"mi-device-list":o(G),loading:o(Z),"dlna-scanning":o(X),"mi-scanning":o(ce),"on-toggle-cron-enabled":o(bl),"on-update-cron":o(xl),"on-update-duration":o(wl),"on-update-trigger-button":o(Dl),"on-open-cron-builder":o(gl),"on-preview-cron":o($l),"on-update-device-type":o(Bl),"on-update-device-volume":o(Tl),"on-update-device-address":o(Al),"on-select-bluetooth-device":o(Ml),"on-select-agent-device":o(El),"on-select-mi-device":o(Ll),"on-scan-dlna-devices":o(Fl),"on-scan-mi-devices":o(kl),"on-open-scan-dialog":o(Pl),"on-open-device-list":Ql},null,8,["playlist-status","connected-device-list","dlna-device-list","mi-device-list","loading","dlna-scanning","mi-scanning","on-toggle-cron-enabled","on-update-cron","on-update-duration","on-update-trigger-button","on-open-cron-builder","on-preview-cron","on-update-device-type","on-update-device-volume","on-update-device-address","on-select-bluetooth-device","on-select-agent-device","on-select-mi-device","on-scan-dlna-devices","on-scan-mi-devices","on-open-scan-dialog"])]),l(Mt,{visible:o(I),"onUpdate:visible":ae[5]||(ae[5]=we=>I.value=we),title:"选择文件添加到播放列表","confirm-button-text":"添加","confirm-loading":o(L),onConfirm:o(O),onClose:o(J)},{"footer-prepend":a(()=>[l(me,{modelValue:o(H),"onUpdate:modelValue":ae[4]||(ae[4]=we=>et(H)?H.value=we:null),size:"small",class:"w-[150px]"},{default:a(()=>[l(xe,{label:"添加到主列表",value:"files"}),l(xe,{label:"添加到前置列表",value:"pre_files"})]),_:1},8,["modelValue"])]),_:1},8,["visible","confirm-loading","onConfirm","onClose"]),l(Ks,{visible:o(b),"initial-cron":o(R),"onUpdate:visible":ae[6]||(ae[6]=we=>b.value=we),onApply:o(yl),onPreview:o(hl),onClose:o(pl)},null,8,["visible","initial-cron","onApply","onPreview","onClose"]),l(qs,{visible:o(T),times:o(w),"onUpdate:visible":ae[7]||(ae[7]=we=>T.value=we),onClose:ae[8]||(ae[8]=we=>T.value=!1)},null,8,["visible","times"]),l(Za,{visible:o(q),"device-list":o(d),loading:o(Z),"onUpdate:visible":ae[9]||(ae[9]=we=>q.value=we),onRefresh:o(_l),onConnect:o(Cl),onClose:o(Sl)},null,8,["visible","device-list","loading","onRefresh","onConnect","onClose"]),l(Ni,{visible:o(p),"onUpdate:visible":ae[10]||(ae[10]=we=>p.value=we)},null,8,["visible"]),l(vo,{visible:o(de),"playlist-collection":o(S),"selected-files":o(oe),"onUpdate:visible":ae[11]||(ae[11]=we=>de.value=we)},null,8,["visible","playlist-collection","selected-files"]),l(vt,{modelValue:o(dt),"onUpdate:modelValue":ae[13]||(ae[13]=we=>et(dt)?dt.value=we:null),title:"编辑播放列表名称",width:"400",onClose:o(Ie)},{footer:a(()=>[l(Me,{onClick:o(Ie)},{default:a(()=>[...ae[15]||(ae[15]=[Q("取消",-1)])]),_:1},8,["onClick"]),l(Me,{type:"primary",onClick:o(ct)},{default:a(()=>[...ae[16]||(ae[16]=[Q("确定",-1)])]),_:1},8,["onClick"])]),default:a(()=>[l(_e,{modelValue:o(ut),"onUpdate:modelValue":ae[12]||(ae[12]=we=>et(ut)?ut.value=we:null),placeholder:"请输入播放列表名称",onKeyup:[kt(o(ct),["enter"]),kt(o(Ie),["esc"])],clearable:"",autofocus:""},null,8,["modelValue","onKeyup"])]),_:1},8,["modelValue","onClose"]),l(er,{visible:o(N),"playlist-collection":o(S),"onUpdate:visible":ae[14]||(ae[14]=we=>N.value=we),onRefresh:o(pe),"on-add-files":Hl,"on-remove-files":Jl},null,8,["visible","playlist-collection","onRefresh"])])}}});export{$r as default};
