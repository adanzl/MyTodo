import{j as Z,r as C,c as S,v as O,l as A,G as g,o as _,s as L,M as ae,Q as b,$ as T,n as F,D as V,J as R,I as J,u as ee,k as Y,E as ne,y as le}from"./vue-vendor-C-hNZ0TW.js";import{a as se}from"./api-shared-DHR2pBqQ.js";import{m as ie,a as oe,e as re,l as ue}from"./utils-shared-B2b8bsxo.js";import"./utils-Dtqx8Ray.js";import{C as de,u as ce,c as te,A as fe,B as me,Q as pe,D as ve,y as ge,E as Q,a2 as ye,f as he,af as _e}from"./element-plus-Cmtfo66s.js";import{_ as be}from"./index-CF0R6bEv.js";const Pe={class:"m-4"},ke={class:"flex items-center gap-2 mb-2"},xe={class:"flex items-center gap-2 mb-2"},Ce={key:0,class:"text-sm text-blue-600 ml-2"},Ee={class:"flex items-center gap-2"},Fe={key:0},Le={key:1},De={key:0},Te={key:1},we={class:"flex items-center justify-between"},$e={class:"text-sm text-gray-500"},Be={key:0},Ie={key:1},Se={class:"flex gap-2 items-center"},Re={key:0},Qe=Z({__name:"FileDialog",props:{visible:{type:Boolean,default:!1},title:{default:"é€‰æ‹©æ–‡ä»¶"},defaultPath:{default:"/mnt/ext_base"},extensions:{default:"audio"},confirmButtonText:{default:"ç¡®å®š"},confirmLoading:{type:Boolean,default:!1},mode:{default:"file"}},emits:["update:visible","confirm","close"],setup(v,{emit:E}){const n=v,p=E,l=C(n.defaultPath),r=C([]),d=C(!1),u=C([]),y=C(!1);let h=n.defaultPath;const k=()=>{const s=l.value;y.value=!!(s&&s!=="/mnt/ext_base"&&s!=="/")},e=async()=>{try{d.value=!0;const a={path:l.value||n.defaultPath};n.mode==="directory"?a.extensions="all":a.extensions=n.extensions;const f=await se.get("/listDirectory",{params:a});f.data.code===0?(r.value=f.data.data||[],k()):Q.error(f.data.msg||"èŽ·å–æ–‡ä»¶åˆ—è¡¨å¤±è´¥")}catch(s){oe(s,"èŽ·å–æ–‡ä»¶åˆ—è¡¨å¤±è´¥")}finally{d.value=!1}},P=()=>{const s=l.value;if(s&&s!=="/mnt/ext_base"&&s!=="/"){const a=String(s).split("/").filter(f=>f);a.pop(),l.value=a.length>0?"/"+a.join("/"):"/mnt/ext_base",k(),e()}},c=()=>{l.value=n.defaultPath,k(),e()},x=s=>{if(s.isDirectory){const a=l.value==="/"?`/${s.name}`:`${l.value}/${s.name}`;l.value=a,k(),e()}else n.mode!=="directory"&&$(s)},$=s=>{if(s.isDirectory)return;const a=l.value==="/"?`/${s.name}`:`${l.value}/${s.name}`,f=u.value.indexOf(a);f>-1?u.value.splice(f,1):u.value.push(a)},B=s=>{if(s.isDirectory)return!1;const a=l.value==="/"?`/${s.name}`:`${l.value}/${s.name}`;return u.value.includes(a)},M=()=>{const s=l.value;r.value.forEach(a=>{if(!a.isDirectory){const f=s==="/"?`/${a.name}`:`${s}/${a.name}`;u.value.includes(f)||u.value.push(f)}})},G=()=>{const s=l.value,a=r.value.filter(f=>!f.isDirectory).map(f=>s==="/"?`/${f.name}`:`${s}/${f.name}`);u.value=u.value.filter(f=>!a.includes(f))},H=()=>{if(String(n.mode||"file").toLowerCase().trim()==="directory"){const a=l.value||n.defaultPath||"/mnt/ext_base";if(String(a).trim()===""){Q.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç›®å½•");return}p("confirm",[String(a)])}else{if(u.value.length===0){Q.warning("è¯·å…ˆé€‰æ‹©è¦æ·»åŠ çš„æ–‡ä»¶");return}p("confirm",[...u.value])}h=l.value,z()},z=()=>{u.value=[],p("close")},U=S(()=>String(n.mode||"file").toLowerCase().trim()==="directory"?!1:u.value.length===0);return O(()=>n.visible,s=>{s?(l.value=n.defaultPath||h,h=l.value,u.value=[],e()):u.value=[]}),O(l,()=>{e()}),(s,a)=>{const f=ce,D=te,q=pe,N=ve,K=ge,t=me,o=de,i=fe;return _(),A(o,{"model-value":v.visible,"onUpdate:modelValue":a[1]||(a[1]=m=>s.$emit("update:visible",m)),title:v.title,width:"800","before-close":z},{footer:g(()=>[Y(s.$slots,"footer",{},()=>[L("div",we,[L("span",$e,[v.mode==="file"?(_(),F("span",Be,"æç¤ºï¼šç‚¹å‡»æ–‡ä»¶å¯åˆ‡æ¢é€‰æ‹©çŠ¶æ€ï¼ŒåŒå‡»ç›®å½•å¯è¿›å…¥")):(_(),F("span",Ie,"æç¤ºï¼šé€‰æ‹©ç›®å½•ä½œä¸ºè½¬å­˜ç›®æ ‡ï¼ŒåŒå‡»ç›®å½•å¯è¿›å…¥"))]),L("div",Se,[Y(s.$slots,"footer-prepend"),b(D,{onClick:z},{default:g(()=>[...a[8]||(a[8]=[T("å–æ¶ˆ",-1)])]),_:1}),b(D,{type:"primary",onClick:H,loading:v.confirmLoading,disabled:U.value},{default:g(()=>[T(R(v.confirmButtonText),1),v.mode==="file"?(_(),F("span",Re," ("+R(u.value.length)+")",1)):V("",!0)]),_:1},8,["loading","disabled"])])])])]),default:g(()=>[L("div",Pe,[L("div",ke,[b(f,{"model-value":l.value,placeholder:"å½“å‰è·¯å¾„",readonly:""},null,8,["model-value"]),b(D,{type:"primary",onClick:e,loading:d.value},{default:g(()=>[...a[2]||(a[2]=[T(" åˆ·æ–° ",-1)])]),_:1},8,["loading"])]),L("div",xe,[b(D,{size:"small",onClick:P,disabled:!y.value},{default:g(()=>[...a[3]||(a[3]=[T(" ä¸Šä¸€çº§ ",-1)])]),_:1},8,["disabled"]),b(D,{size:"small",onClick:c},{default:g(()=>[...a[4]||(a[4]=[T(" é¦–é¡µ ",-1)])]),_:1}),b(D,{size:"small",onClick:M},{default:g(()=>[...a[5]||(a[5]=[T(" å…¨é€‰ ",-1)])]),_:1}),b(D,{size:"small",onClick:G},{default:g(()=>[...a[6]||(a[6]=[T(" å–æ¶ˆå…¨é€‰ ",-1)])]),_:1}),u.value.length>0?(_(),F("span",Ce," å·²é€‰æ‹© "+R(u.value.length)+" ä¸ªæ–‡ä»¶ ",1)):V("",!0)])]),ae((_(),A(t,{data:r.value,stripe:"",class:"w-full",height:400,onRowClick:x},{default:g(()=>[b(N,{width:"55"},{default:g(({row:m})=>[v.mode!=="directory"&&!m.isDirectory?(_(),A(q,{key:0,"model-value":B(m),onChange:j=>$(m),onClick:a[0]||(a[0]=J(()=>{},["stop"]))},null,8,["model-value","onChange"])):V("",!0)]),_:1}),b(N,{prop:"name",label:"åç§°","min-width":"200"},{default:g(({row:m})=>[L("div",Ee,[m.isDirectory?(_(),F("span",Fe,"ðŸ“")):(_(),F("span",Le,"ðŸ“„")),L("span",null,R(m.name),1)])]),_:1}),b(N,{prop:"size",label:"å¤§å°",width:"100"},{default:g(({row:m})=>[m.isDirectory?(_(),F("span",Te,"-")):(_(),F("span",De,R(ee(ie)(m.size)),1))]),_:1}),b(N,{label:"çŠ¶æ€",width:"100"},{default:g(({row:m})=>[v.mode!=="directory"&&!m.isDirectory&&B(m)?(_(),A(K,{key:0,type:"success",size:"small"},{default:g(()=>[...a[7]||(a[7]=[T(" å·²é€‰æ‹© ",-1)])]),_:1})):V("",!0)]),_:1})]),_:1},8,["data"])),[[i,d.value]])]),_:3},8,["model-value","title"])}}}),Me={key:0},ze={class:"text-xs text-gray-600 flex-shrink-0 min-width-[35px]"},Ne=Z({__name:"MediaComponent",props:{file:{},player:{},isPlaying:{type:Boolean,default:!1},progress:{default:0},duration:{default:0},disabled:{type:Boolean,default:!1},widthClass:{default:"w-32"}},emits:["play","seek"],setup(v,{emit:E}){const n=v,p=E,l=c=>c?.uri||c?.path||c?.name||"",r=C(!1),d=S(()=>{if(n.player){const c=l(n.file);return n.player.isFilePlaying(c)}return n.isPlaying}),u=S(()=>{if(n.player){const c=l(n.file);return n.player.getFilePlayProgress(c)}return n.progress}),y=S(()=>{if(n.player){const c=l(n.file),x=n.file?.duration||n.duration;return n.player.getFileDuration(c,x)}return n.duration}),h=S(()=>re(y.value)),k=S(()=>n.disabled||r.value),e=()=>{if(!k.value){if(d.value){p("play",n.file);return}r.value=!0,p("play",n.file)}},P=c=>{if(!n.disabled&&d.value){if(n.player){const x=l(n.file);n.player.seekFile(x,c)}p("seek",n.file,c)}};return O([d,y],([c,x])=>{c&&x>0&&(r.value=!1)},{immediate:!0}),O(()=>n.file,()=>{r.value=!1}),(c,x)=>{const $=he,B=te,M=_e;return _(),F("div",{class:ne(["flex items-center gap-1.5 bg-gray-50 rounded border-gray-500 pr-1",v.widthClass])},[b(B,{type:"default",plain:"",size:"small",circle:"",onClick:J(e,["stop"]),disabled:k.value,loading:r.value&&!d.value,class:"!w-6 !h-6 !p-0 flex-shrink-0 mr-1"},{default:g(()=>[d.value?(_(),F("span",Me,"â¹")):r.value?V("",!0):(_(),A($,{key:1,class:"!w-3 !h-3"},{default:g(()=>[b(ee(ye))]),_:1}))]),_:1},8,["disabled","loading"]),b(M,{"model-value":u.value,min:0,max:100,step:.1,size:"small",class:"flex-1 min-width-[10px] player-slider","show-tooltip":!1,disabled:!d.value||v.disabled,onChange:P,onInput:P,onClick:x[0]||(x[0]=J(()=>{},["stop"]))},null,8,["model-value","disabled"]),L("span",ze,R(h.value),1)],2)}}}),We=be(Ne,[["__scopeId","data-v-9b8781cc"]]),I=()=>{},w=0,W=0;function Je(v={}){const{playingFilePath:E=null,playingFileIndex:n=null,callbacks:p={}}=v,l={onPlay:p.onPlay||I,onPause:p.onPause||I,onTimeUpdate:p.onTimeUpdate||I,onDurationUpdate:p.onDurationUpdate||I,onError:p.onError||I,onEnded:p.onEnded||I},r=C(E),d=C(W),u=C(w),y=C(w),h=C(!1),k=C(n);let e=null,P=null;const c=()=>{e&&(e.currentTime=w)},x=t=>{t>0&&isFinite(t)&&(y.value=t,l.onDurationUpdate(t))},$=()=>{d.value=W,u.value=w,y.value=w,h.value=!1},B=()=>{if(e){try{e.paused||e.pause(),e.currentTime=0,e.removeAttribute("src")}catch{}e=null}},M=()=>{if(!e)return;e.addEventListener("play",o=>{const i=o.target;!i||e!==i||(c(),h.value=!0,l.onPlay(i))});const t=o=>{const i=o.target;!i||e!==i||(c(),x(i.duration))};e.addEventListener("loadedmetadata",t),e.addEventListener("loadeddata",t),e.addEventListener("timeupdate",o=>{const i=o.target;if(!i||e!==i)return;const m=i.duration;if(m>0&&isFinite(m)){const j=i.currentTime,X=j/m*100;u.value=j,d.value=X,y.value!==m&&(y.value=m),l.onTimeUpdate(j,m,X)}}),e.addEventListener("pause",o=>{const i=o.target;!i||e!==i||(h.value=!1,i.ended?l.onEnded(i):l.onPause(i))}),e.addEventListener("error",o=>{const i=o.target;!i||e!==i||(console.error("éŸ³é¢‘æ’­æ”¾å¤±è´¥:",o,"URL:",P),h.value=!1,l.onError(o,P||""))}),e.addEventListener("ended",o=>{const i=o.target;!i||e!==i||(h.value=!1,l.onEnded(i))})},G=(t,o={})=>{if(!t||typeof t!="string"||t.trim()===""){console.error("éŸ³é¢‘URLä¸èƒ½ä¸ºç©ºæˆ–æ— æ•ˆ:",t);return}try{const i=new URL(t,window.location.origin);if(!i.pathname||i.pathname==="/"||i.pathname.endsWith(".html")){console.error("éŸ³é¢‘URLæ ¼å¼æ— æ•ˆï¼Œå¯èƒ½æ˜¯HTMLé¡µé¢:",t);return}}catch{if(t.includes("index.html")||t.endsWith(".html")){console.error("éŸ³é¢‘URLæ ¼å¼æ— æ•ˆï¼Œå¯èƒ½æ˜¯HTMLé¡µé¢:",t);return}}e&&B(),$(),e=new Audio(t),P=t,c(),o.playingFilePath!==void 0&&(r.value=o.playingFilePath),o.playingFileIndex!==void 0&&(k.value=o.playingFileIndex),M()},H=()=>e?e.play().catch(t=>{throw console.error("æ’­æ”¾å¤±è´¥:",t),t}):(console.warn("éŸ³é¢‘æœªåŠ è½½ï¼Œæ— æ³•æ’­æ”¾"),Promise.reject(new Error("éŸ³é¢‘æœªåŠ è½½"))),z=()=>{e&&e.pause()},U=t=>{if(!e){console.warn("éŸ³é¢‘æœªåŠ è½½ï¼Œæ— æ³•è·³è½¬");return}const o=e.duration;if(o>0&&isFinite(o)&&isFinite(t)){const i=Math.max(0,Math.min(t/100*o,o));e.currentTime=i,u.value=i,d.value=t}};return{get audio(){return e},playingFilePath:r,playProgress:d,currentTime:u,duration:y,isPlaying:h,playingFileIndex:k,load:G,play:H,pause:z,seek:U,clear:()=>{if(e){try{e.paused||e.pause(),e.currentTime=w}catch{}B()}P=null,r.value=null,k.value=null,$()},updateCallbacks:t=>{Object.assign(l,t)},isFilePlaying:t=>t?r.value===t&&e!==null&&!e.paused:!1,getFilePlayProgress:t=>!t||r.value!==t||!e?W:d.value,getFileCurrentTime:t=>!t||r.value!==t?w:u.value,getFileDuration:(t,o=w)=>t&&r.value===t&&y.value||o,seekFile:(t,o)=>{!e||!t||r.value===t&&U(o)}}}function Ae(v,E,n={}){const{immediate:p=!1,autoCleanup:l=!0}=n;let r=null,d=E;const u=async()=>{try{await v()}catch(P){ue.error("[useInterval] å®šæ—¶å™¨å›žè°ƒæ‰§è¡Œå¤±è´¥:",P)}},y=()=>{d===null||d<=0||(h(),p&&u(),r=setInterval(u,d))},h=()=>{r!==null&&(clearInterval(r),r=null)},k=P=>{P!==void 0&&(d=P),y()},e=()=>r!==null;return E!==null&&E>0&&y(),l&&le(()=>{h()}),{start:y,stop:h,restart:k,isRunning:e}}function qe(v,E,n={}){let p=E;const l=Ae(v,null,{...n,autoCleanup:!0});return{start:()=>{l.restart(p)},stop:l.stop,restart:r=>{r!==void 0&&(p=r),l.restart(p)},isRunning:l.isRunning}}export{We as M,Qe as _,Ae as a,qe as b,Je as u};
