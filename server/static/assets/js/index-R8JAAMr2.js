const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/Home-VfaaLDbh.js","assets/js/api-shared-B9VkqVmL.js","assets/js/utils-BjcahYMR.js","assets/js/types-shared-p9pvIOHB.js","assets/js/utils-shared-B0r6pT1A.js","assets/js/element-plus-38DTshaM.js","assets/js/vue-vendor-C-hNZ0TW.js","assets/js/vendor-4xlYshH7.js","assets/css/element-plus-CD3B3G1X.css","assets/js/vant-7Cqjo8an.js","assets/css/vant-DzKo5b93.css","assets/js/Lottery-yqQ8VNHR.js","assets/js/Info-Bvb-1bnk.js","assets/js/Chat-CKfsA6X0.js","assets/js/socket-DEWE7BO1.js","assets/css/Chat-CFJ2rmy2.css","assets/js/Score-Czgozjp9.js","assets/js/Timetable-BseITT9Z.js","assets/js/index-BZ82Nk_P.js","assets/js/useInterval-C30YwgCJ.js","assets/css/useInterval-BJh958RX.css","assets/js/constants-shared-BwcKRbUv.js","assets/js/index-DmVx6Z0r.js"])))=>i.map(i=>d[i]);
import{av as F,r as x,c as I,j as P,aw as H,ax as q,l as C,o as b,G as e,Q as t,s as S,D as z,u as v,$ as y,t as M,n as J,a6 as K,J as $,F as W,L as G,ae as Q,ay as Y,az as X,ar as Z,aA as ee}from"./vue-vendor-C-hNZ0TW.js";import{E as A,a as te,b as N,c as B,d as oe,e as ne,f as j,h as se,g as le,p as ae,m as re,i as ie,s as ue,j as ce,k as de,l as _e,n as fe,o as me,q as pe,r as ve,t as ge,u as ye,v as he,w as we,x as V,y as Le,z as Ee}from"./element-plus-38DTshaM.js";import{b as be,L as R,c as D,d as Se,e as xe,f as Ce,i as Ie}from"./api-shared-B9VkqVmL.js";import{v as Ue,C as Ae}from"./utils-BjcahYMR.js";import{s as Pe}from"./vant-7Cqjo8an.js";import"./vendor-4xlYshH7.js";import"./types-shared-p9pvIOHB.js";import"./utils-shared-B0r6pT1A.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function a(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=a(s);fetch(s.href,r)}})();const O=F("user",()=>{const p=x([]),u=x(!1),a=x(null),i=x({bLogin:!1,id:null,name:null,ico:null}),s=300*1e3,r="user_id",l=m=>p.value.find(g=>String(g.id)===String(m)),f=I(()=>a.value?Date.now()-a.value<s:!1),n=I(()=>i.value.bLogin),o=async(m=!1)=>{if(!(!m&&f.value&&p.value.length>0)){u.value=!0;try{const g=await be("t_user");g&&g.data?(p.value=g.data.data||[],a.value=Date.now()):p.value=[]}catch(g){console.error("获取用户列表失败:",g),A.error("获取用户列表失败"),p.value=[]}finally{u.value=!1}}},c=()=>{a.value=null},d=m=>{i.value={bLogin:!0,id:m.id,name:m.name,ico:m.icon||null},localStorage.setItem(r,String(m.id))};return{userList:p,loading:u,lastFetchTime:a,curUser:i,getUserById:l,isDataFresh:f,isLoggedIn:n,refreshUserList:o,clearCache:c,setCurUser:d,clearCurUser:()=>{i.value={bLogin:!1,id:null,name:null,ico:null},localStorage.removeItem(r)},restoreCurUser:async()=>{const m=localStorage.getItem(r);if(m){p.value.length===0&&await o();const g=l(m);g&&d(g)}},getCurUserFullInfo:()=>i.value.id&&l(i.value.id)||null}}),Oe={class:"flex justify-between items-center p-5"},Te=P({__name:"Sidebar",setup(p){const u=H(),a=q(),i=O(),s=x(!1),r=()=>{},l=()=>{i.clearCurUser(),u.push("/")};return(f,n)=>{const o=N,c=B,d=j,_=ne,L=le,h=oe,m=me,g=te;return b(),C(g,{width:"200px",class:"w-48"},{default:e(()=>[t(m,null,{default:e(()=>[S("div",Oe,[t(o,{src:v(i).curUser.ico},null,8,["src"]),v(i).curUser.bLogin?(b(),C(c,{key:0,onClick:l,size:"small"},{default:e(()=>[...n[0]||(n[0]=[y(" 注销 ",-1)])]),_:1})):z("",!0)]),t(h,{"default-active":v(a).path,collapse:s.value,"unique-opened":"",router:""},{default:e(()=>[t(_,{index:"/home",onClick:r},{title:e(()=>[...n[1]||(n[1]=[y("Home",-1)])]),default:e(()=>[t(d,null,{default:e(()=>[t(v(se))]),_:1})]),_:1}),t(L,{index:"mytodo"},{title:e(()=>[t(d,null,{default:e(()=>[t(v(ce))]),_:1}),n[2]||(n[2]=S("span",null,"MyTodo",-1))]),default:e(()=>[t(_,{index:"/lottery",onClick:r},{title:e(()=>[...n[3]||(n[3]=[y("抽奖设置",-1)])]),default:e(()=>[t(d,null,{default:e(()=>[t(v(ae))]),_:1})]),_:1}),t(_,{index:"/chat"},{title:e(()=>[...n[4]||(n[4]=[y("Chat",-1)])]),default:e(()=>[t(d,null,{default:e(()=>[t(v(re))]),_:1})]),_:1}),t(_,{index:"/info"},{title:e(()=>[...n[5]||(n[5]=[y("Info",-1)])]),default:e(()=>[t(d,null,{default:e(()=>[t(v(ie))]),_:1})]),_:1}),t(_,{index:"/score"},{title:e(()=>[...n[6]||(n[6]=[y("Score",-1)])]),default:e(()=>[t(d,null,{default:e(()=>[t(v(ue))]),_:1})]),_:1})]),_:1}),t(_,{index:"/timetable"},{title:e(()=>[...n[7]||(n[7]=[y("课程表",-1)])]),default:e(()=>[t(d,null,{default:e(()=>[t(v(de))]),_:1})]),_:1}),t(_,{index:"/media"},{title:e(()=>[...n[8]||(n[8]=[y("媒体",-1)])]),default:e(()=>[t(d,null,{default:e(()=>[t(v(_e))]),_:1})]),_:1}),t(_,{index:"/tools"},{title:e(()=>[...n[9]||(n[9]=[y("工具",-1)])]),default:e(()=>[t(d,null,{default:e(()=>[t(v(fe))]),_:1})]),_:1})]),_:1},8,["default-active","collapse"])]),_:1})]),_:1})}}}),T=(p,u)=>{const a=p.__vccOpts||p;for(const[i,s]of u)a[i]=s;return a},Ve=T(Te,[["__scopeId","data-v-828d8ef1"]]),Re={class:"flex flex-col gap-2 items-center"},De={class:"flex items-center border-b-1 border-gray-200"},ke={class:"pl-4 text-base text-gray-500"},Me=P({__name:"Login",emits:["login-success"],setup(p,{emit:u}){const a=u,i=O(),s=I(()=>i.userList),r=I(()=>i.loading),l=x({id:null,password:""}),f=async()=>{await i.refreshUserList(),s.value.length===0&&A.warning("用户列表为空，请检查数据库")},n=async()=>{if(!l.value.id)return;const o=Ue(s.value,{id:l.value.id});o&&(o.pwd===null||o.pwd===Ae.MD5(l.value.password).toString())?(i.setCurUser(o),a("login-success",{id:o.id,name:o.name,icon:o.icon})):A.error("用户名或密码错误")};return M(async()=>{await f()}),(o,c)=>{const d=N,_=ve,L=ge,h=ye,m=B,g=pe;return b(),C(g,{class:"w-[480px]",shadow:"always"},{header:e(()=>[...c[2]||(c[2]=[y("用户登录",-1)])]),default:e(()=>[S("div",Re,[t(L,{modelValue:l.value.id,"onUpdate:modelValue":c[0]||(c[0]=w=>l.value.id=w),placeholder:"请选择用户",class:"!w-60",loading:r.value,"loading-text":"加载用户列表中...",disabled:r.value},{default:e(()=>[(b(!0),J(W,null,K(s.value,w=>(b(),C(_,{class:"!h-13",key:w.id,label:w.name,value:w.id},{default:e(()=>[S("div",De,[t(d,{class:"!h-10 !w-10",src:w.icon},null,8,["src"]),S("div",ke,$(w.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","loading","disabled"]),t(h,{modelValue:l.value.password,"onUpdate:modelValue":c[1]||(c[1]=w=>l.value.password=w),style:{width:"240px"},type:"password",placeholder:"Password","show-password":""},null,8,["modelValue"]),t(m,{type:"primary",size:"large",class:"w-24 h-24 mt-4",disabled:!l.value.id,onClick:n},{default:e(()=>[...c[3]||(c[3]=[y(" Login ",-1)])]),_:1},8,["disabled"])])]),_:1})}}}),$e=T(Me,[["__scopeId","data-v-d12c731f"]]),Ne={class:"flex items-center gap-2"},Be={class:"flex items-center gap-2 text-sm"},je=P({__name:"App",setup(p){const u=O(),a=x(null),i=async()=>{const n=await Se(),o=Ie();n&&o!==!0?(xe(),a.value=!0,console.log(`[Server Switch] 切换到本地服务器: ${R}:${D}`)):!n&&o!==!1?(Ce(),a.value=!1,console.log("[Server Switch] 切换到远程服务器")):a.value=o},s=I(()=>a.value===!0?`本地 (${R}:${D})`:a.value===!1?"远程":"检测中..."),r=I(()=>a.value===!0?"success":a.value===!1?"warning":"info"),l=n=>{const o=u.getUserById(n.id);o?u.setCurUser(o):(console.warn("用户信息未找到，使用传入的信息"),u.setCurUser({id:n.id,name:n.name,icon:n.icon}))};let f=null;return M(async()=>{await u.refreshUserList(),await u.restoreCurUser(),await i(),f=setInterval(async()=>{await i()},5e3),console.log("[Server Monitor] 服务器监控已启动，每 5 秒检测一次")}),G(()=>{f&&(clearInterval(f),console.log("[Server Monitor] 服务器监控已停止"))}),(n,o)=>{const c=j,d=Le,_=we,L=Q("router-view"),h=Ee,m=he;return b(),C(m,{loading:v(u).loading,class:"h-screen"},{default:e(()=>[t(Ve),v(u).curUser.bLogin?(b(),C(m,{key:0},{default:e(()=>[t(_,{class:"flex justify-between items-center bg-blue-50 px-6"},{default:e(()=>[S("div",Ne,[t(c,null,{default:e(()=>[t(v(V))]),_:1}),o[0]||(o[0]=y(" 哈哈哈 ",-1)),t(c,null,{default:e(()=>[t(v(V))]),_:1})]),S("div",Be,[o[1]||(o[1]=S("span",{class:"text-gray-500"},"服务器:",-1)),t(d,{type:r.value,size:"small"},{default:e(()=>[y($(s.value),1)]),_:1},8,["type"])])]),_:1}),t(h,null,{default:e(()=>[t(L)]),_:1})]),_:1})):(b(),C(m,{key:1},{default:e(()=>[t(h,{class:"bg-blue-100 !flex justify-center items-center"},{default:e(()=>[t($e,{onLoginSuccess:l})]),_:1})]),_:1}))]),_:1},8,["loading"])}}}),Fe=T(je,[["__scopeId","data-v-9e67c868"]]),He="modulepreload",qe=function(p){return"/web/"+p},k={},E=function(u,a,i){let s=Promise.resolve();if(a&&a.length>0){let n=function(o){return Promise.all(o.map(c=>Promise.resolve(c).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),f=l?.nonce||l?.getAttribute("nonce");s=n(a.map(o=>{if(o=qe(o),o in k)return;k[o]=!0;const c=o.endsWith(".css"),d=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${d}`))return;const _=document.createElement("link");if(_.rel=c?"stylesheet":He,c||(_.as="script"),_.crossOrigin="",_.href=o,f&&_.setAttribute("nonce",f),document.head.appendChild(_),c)return new Promise((L,h)=>{_.addEventListener("load",L),_.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${o}`)))})}))}function r(l){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=l,window.dispatchEvent(f),!f.defaultPrevented)throw l}return s.then(l=>{for(const f of l||[])f.status==="rejected"&&r(f.reason);return u().catch(r)})},ze=[{path:"/",redirect:"/home"},{path:"/home",name:"Home",component:()=>E(()=>import("./Home-VfaaLDbh.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))},{path:"/lottery",name:"Lottery",component:()=>E(()=>import("./Lottery-yqQ8VNHR.js"),__vite__mapDeps([11,5,6,2,7,8,1,3,4]))},{path:"/info",name:"Info",component:()=>E(()=>import("./Info-Bvb-1bnk.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,8]))},{path:"/chat",name:"Chat",component:()=>E(()=>import("./Chat-CKfsA6X0.js"),__vite__mapDeps([13,6,5,2,7,8,14,1,3,4,9,10,15]))},{path:"/score",name:"Score",component:()=>E(()=>import("./Score-Czgozjp9.js"),__vite__mapDeps([16,5,6,2,7,8,1,3,4,9,10]))},{path:"/timetable",name:"Timetable",component:()=>E(()=>import("./Timetable-BseITT9Z.js"),__vite__mapDeps([17,6,5,2,7,8,1,3,4]))},{path:"/media",name:"Media",component:()=>E(()=>import("./index-BZ82Nk_P.js"),__vite__mapDeps([18,6,4,5,2,7,8,1,3,19,20,21,9,10]))},{path:"/tools",name:"Tools",component:()=>E(()=>import("./index-DmVx6Z0r.js"),__vite__mapDeps([22,6,5,2,7,8,4,1,3,19,20,21,9,10]))}],Je=Y({history:X(),routes:ze}),U=Z(Fe),Ke=ee();U.use(Ke);U.use(Je);U.use(Pe);U.mount("#app");export{T as _,O as u};
