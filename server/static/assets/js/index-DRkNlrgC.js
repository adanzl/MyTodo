import{j as Ke,r as k,t as Ge,L as kt,n as v,o as i,s as l,Q as a,G as s,$ as T,D as U,E as je,J as w,M as wt,l as E,u as B,aa as Ne,ai as Tt,c as W,y as tt,q as K,F as Se,a6 as Oe,I as ce}from"./vue-vendor-C-hNZ0TW.js";import{c as qe,L as Ct,F as ct,q as $t,A as St,D as Mt,y as He,u as lt,B as Pt,a1 as We,f as Je,E as d,ak as pe,M as at,i as Dt,a9 as st,al as nt,a8 as ft,ab as Vt,K as vt,am as pt,ae as Ft,an as Ut,a0 as Rt,X as Et,C as mt,ao as gt,ap as _t,aq as At,t as Bt,r as Lt,Y as zt,aj as jt,ai as Ot}from"./element-plus-CTY_Yuy8.js";import{m as xt,a as D,k as Xe,e as It}from"./utils-shared-DEBjYUji.js";import{D as Nt,E as Kt,F as Yt,G as Gt,H as qt,I as Ht,J as Wt,K as Jt,M as Qt,N as Xt,O as Zt,P as el,Q as tl,R as ll,S as al,T as sl,U as nl,V as ol,W as Ye,X as rl,Y as il,Z as ul,_ as dl,$ as cl,a0 as fl,a1 as ut,a2 as vl,a3 as pl,a4 as dt,a5 as ml,a6 as gl}from"./api-shared-D6W0LpbF.js";import{u as yt,b as ot,M as Ze,_ as et}from"./useInterval-BJZLNQwy.js";import{c as ht,C as _l}from"./constants-shared-BwcKRbUv.js";import"./utils-Dtqx8Ray.js";import"./vendor-CJeEfH0b.js";import"./types-shared-CLeJFHnW.js";import"./index-TEPOW0e6.js";import"./vant-Bv_herco.js";const xl={class:"p-4 flex flex-col h-[calc(100vh-200px)]"},yl={class:"mb-4 flex-shrink-0 border rounded p-3 bg-gray-50"},hl={class:"flex flex-col gap-3"},bl={class:"flex items-center gap-3"},kl={class:"flex-1 min-w-0"},wl={class:"flex items-center gap-2"},Tl=["title"],Cl={key:0,class:"text-xs text-gray-500 flex-shrink-0"},$l={class:"flex items-center gap-2"},Sl={class:"flex items-center justify-between"},Ml={class:"flex-1 overflow-auto"},Pl=["onClick","title"],Dl={key:1,class:"text-gray-400"},Vl={key:0,class:"flex flex-col gap-1"},Fl={class:"text-sm"},Ul={class:"text-xs text-gray-500"},Rl={key:1,class:"text-gray-400"},El={key:0,class:"flex flex-col gap-1"},Al={class:"text-sm"},Bl={class:"text-xs text-gray-500"},Ll={key:1,class:"text-gray-400"},zl={class:"flex flex-col gap-1 items-center"},jl=["onClick"],Ol=["title"],Il={class:"flex items-center gap-2"},Nl=Ke({__name:"PdfTool",setup(Ie){const c=k(!1),S=k([]),e=k(null),I=k(""),M=k(0),V=k(""),R=k(null),C=k(null);let $=null;const j=async()=>{try{c.value=!0;const m=await Nt();if(m.code===0){const p=m.data||[];S.value=p.map(b=>({...b,_decrypting:b.status==="processing"||!1,_password:""}))}else d.error(m.msg||"获取任务列表失败")}catch(m){D(m,"获取任务列表失败")}finally{c.value=!1}},Q=m=>{m.raw&&(e.value=m.raw,I.value=m.raw.name,M.value=0,V.value="",R.value&&te())},X=m=>{if(m<60)return`${m}秒`;if(m<3600){const p=Math.floor(m/60),b=m%60;return`${p}分${b}秒`}else{const p=Math.floor(m/3600),b=Math.floor(m%3600/60),q=m%60;return`${p}小时${b}分${q}秒`}},Y=()=>{if(C.value!==null&&M.value>0&&M.value<100){const m=Math.floor((Date.now()-C.value)/1e3);V.value=X(m)}},te=()=>{R.value&&c.value?(R.value.abort(),R.value=null,$&&(clearInterval($),$=null),M.value=0,V.value="",C.value=null,c.value=!1,d.info("上传已取消")):(e.value=null,I.value="",M.value=0,V.value="",C.value=null,d.info("已清除选中文件"))},O=async()=>{if(!e.value){d.warning("请选择要上传的文件");return}const m=e.value;if(!m.name.toLowerCase().endsWith(".pdf")){d.error("只支持 PDF 文件");return}R.value&&te();try{c.value=!0,M.value=0,V.value="",C.value=Date.now();const p=new AbortController;R.value=p,$=setInterval(()=>{Y()},1e3);const b=await Kt(m,q=>{M.value=q,Y()},p.signal);$&&(clearInterval($),$=null),R.value=null,b.code===0?(M.value=100,Y(),d.success("文件上传成功"),setTimeout(()=>{e.value=null,I.value="",M.value=0,V.value="",C.value=null},500),await j()):(d.error(b.msg||"文件上传失败"),M.value=0,V.value="",C.value=null)}catch(p){if(p.name==="CanceledError"||p.code==="ECONNABORTED"||p.message?.includes("canceled")||p.message?.includes("aborted")){$&&(clearInterval($),$=null),R.value||(c.value=!1);return}const b=p.message||"文件上传失败",q=M.value;p.code==="ERR_NETWORK"||p.message?.includes("Network Error")?d.error(`网络错误：上传中断。当前进度：${q}%`):p.response?.status===413?(d.error("文件太大，超过服务器限制（最大 1000MB）"),M.value=0,V.value=""):d.error(`上传失败：${b}`),$&&(clearInterval($),$=null),R.value=null,C.value=null,c.value=!1}},A=async m=>{if(!m.uploaded_info){d.warning("请先上传文件");return}if(!(m._decrypting||m.status==="processing")&&!(m.status==="success"&&!await pe.confirm("已解密的文件已存在，是否重新解密？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{m._decrypting=!0;const p=m._password?.trim()||void 0,b=await Yt(m.task_id,p);b.code===0?(d.success(b.data?.message||"解密任务已提交，正在后台处理"),m._password="",await me(m)):d.error(b.msg||"提交解密任务失败")}catch(p){D(p,"提交解密任务失败")}finally{m._decrypting=!1}},me=async(m,p=30)=>{let b=0;const q=async()=>{if(b>=p){d.warning("任务处理超时，请手动刷新查看状态"),await j();return}try{const ie=await Ht(m.task_id);if(ie.code===0){const ae=ie.data;m.status=ae.status,m.unlocked_info=ae.unlocked_info,m.error_message=ae.error_message,ae.status==="success"?(d.success("文件解密成功"),m._decrypting=!1,await j()):ae.status==="failed"?(d.error(ae.error_message||"文件解密失败"),m._decrypting=!1):ae.status==="processing"?(b++,setTimeout(q,1e3)):m._decrypting=!1}}catch(ie){D(ie,"查询任务状态失败"),m._decrypting=!1}};q()},G=async(m,p)=>{const b=p==="uploaded"?m.uploaded_info:m.unlocked_info;if(!b){d.warning("文件不存在");return}try{const q=Gt(b.name,p);window.open(q,"_blank")}catch(q){D(q,"下载文件失败")}},L=async m=>{if(!m.uploaded_info){d.warning("请先上传文件");return}if(m.status==="processing"){d.warning("任务正在处理中，无法删除");return}if(await pe.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{c.value=!0;const b=await qt(m.task_id);b.code===0?(d.success(b.data?.message||"任务删除成功"),await j()):d.error(b.msg||"任务删除失败")}catch(b){D(b,"删除任务失败")}finally{c.value=!1}},le=xt,J=m=>m?new Date(m*1e3).toLocaleString():"-";return Ge(()=>{j()}),kt(()=>{$&&(clearInterval($),$=null),R.value&&(R.value.abort(),R.value=null)}),(m,p)=>{const b=qe,q=Ct,ie=ct,ae=Je,H=Mt,Z=He,ye=lt,he=Pt,fe=$t,ge=St;return i(),v("div",xl,[p[12]||(p[12]=l("h2",{class:"text-xl font-semibold mb-4"},"PDF 解密工具",-1)),l("div",yl,[l("div",hl,[l("div",bl,[l("div",null,[a(b,{type:"success",size:"small",onClick:O,loading:c.value,disabled:!e.value},{default:s(()=>[...p[0]||(p[0]=[T(" 上传 ",-1)])]),_:1},8,["loading","disabled"])]),a(q,{"auto-upload":!1,"on-change":Q,"show-file-list":!1,accept:".pdf"},{trigger:s(()=>[a(b,{type:"primary",size:"small",class:"!m-0"},{default:s(()=>[...p[1]||(p[1]=[T("选择文件",-1)])]),_:1})]),_:1}),l("div",kl,[l("div",wl,[l("div",{class:je(["text-sm truncate flex-1 min-w-0",e.value?"text-gray-600":"text-gray-400"]),title:I.value||e.value?.name},w(I.value||e.value?.name||"未选择文件"),11,Tl),V.value?(i(),v("div",Cl," 已用时间: "+w(V.value),1)):U("",!0)])])]),l("div",$l,[a(ie,{percentage:M.value,status:M.value===100?"success":void 0,class:"flex-1"},null,8,["percentage","status"]),a(b,{type:"danger",size:"small",plain:"",onClick:te,disabled:!e.value},{default:s(()=>[...p[2]||(p[2]=[T(" 取消 ",-1)])]),_:1},8,["disabled"])])])]),a(fe,{class:"flex-1 flex flex-col overflow-hidden",shadow:"hover"},{header:s(()=>[l("div",Sl,[p[4]||(p[4]=l("span",null,"文件列表",-1)),a(b,{type:"info",size:"small",plain:"",onClick:j,loading:c.value},{default:s(()=>[c.value?U("",!0):(i(),E(ae,{key:0},{default:s(()=>[a(B(We))]),_:1})),p[3]||(p[3]=T(" 刷新 ",-1))]),_:1},8,["loading"])])]),default:s(()=>[l("div",Ml,[wt((i(),E(he,{data:S.value,stripe:"",class:"w-full"},{empty:s(()=>[...p[11]||(p[11]=[l("div",{class:"text-center text-gray-400 py-8"},"暂无文件，请上传 PDF 文件",-1)])]),default:s(()=>[a(H,{prop:"filename",label:"文件名","min-width":"200"},{default:s(({row:_})=>[_.uploaded_info?(i(),v("span",{key:0,class:"text-blue-600 cursor-pointer hover:underline",onClick:se=>G(_,"uploaded"),title:_.uploaded_info.name},w(_.uploaded_info.name||_.name||_.filename||_.task_id),9,Pl)):(i(),v("span",Dl,"-"))]),_:1}),a(H,{label:"上传文件","min-width":"150"},{default:s(({row:_})=>[_.uploaded_info?(i(),v("div",Vl,[l("span",Fl,w(B(le)(_.uploaded_info.size)),1),l("span",Ul,w(J(_.uploaded_info.modified)),1)])):(i(),v("span",Rl,"-"))]),_:1}),a(H,{label:"已解密文件","min-width":"150"},{default:s(({row:_})=>[_.unlocked_info?(i(),v("div",El,[l("span",Al,w(B(le)(_.unlocked_info.size)),1),l("span",Bl,w(J(_.unlocked_info.modified)),1)])):(i(),v("span",Ll,"未解密"))]),_:1}),a(H,{label:"状态",width:"140",align:"center"},{default:s(({row:_})=>[l("div",zl,[_.status==="success"?(i(),E(Z,{key:0,type:"success",size:"small"},{default:s(()=>[...p[5]||(p[5]=[T("已解密",-1)])]),_:1})):_.status==="processing"?(i(),E(Z,{key:1,type:"warning",size:"small"},{default:s(()=>[...p[6]||(p[6]=[T("处理中",-1)])]),_:1})):_.status==="pending"?(i(),E(Z,{key:2,type:"info",size:"small"},{default:s(()=>[...p[7]||(p[7]=[T("等待中",-1)])]),_:1})):_.status==="failed"?(i(),E(Z,{key:3,type:"danger",size:"small"},{default:s(()=>[...p[8]||(p[8]=[T("失败",-1)])]),_:1})):(i(),E(Z,{key:4,type:"info",size:"small"},{default:s(()=>[...p[9]||(p[9]=[T("已上传",-1)])]),_:1})),_.unlocked_info?(i(),v("span",{key:5,class:"text-xs text-blue-600 cursor-pointer hover:underline",onClick:se=>G(_,"unlocked")}," 下载 ",8,jl)):U("",!0),_.error_message?(i(),v("span",{key:6,class:"text-xs text-red-500",title:_.error_message}," 错误 ",8,Ol)):U("",!0)])]),_:1}),a(H,{label:"操作",width:"280",fixed:"right"},{default:s(({row:_})=>[l("div",Il,[_.uploaded_info?(i(),E(ye,{key:0,modelValue:_._password,"onUpdate:modelValue":se=>_._password=se,type:"password",size:"small",placeholder:"密码（可选）","show-password":"",clearable:"",class:"w-30",disabled:_._decrypting||_.status==="processing",onKeyup:Ne(se=>A(_),["enter"])},null,8,["modelValue","onUpdate:modelValue","disabled","onKeyup"])):U("",!0),_.uploaded_info&&_.status!=="processing"?(i(),E(b,{key:1,type:"primary",size:"small",onClick:se=>A(_),loading:_._decrypting,disabled:_._decrypting||_.status==="processing"},{default:s(()=>[T(w(_.status==="success"?"重新解密":"解密"),1)]),_:2},1032,["onClick","loading","disabled"])):U("",!0),_.uploaded_info?(i(),E(b,{key:2,type:"danger",size:"small",plain:"",onClick:se=>L(_),disabled:_.status==="processing"},{default:s(()=>[...p[10]||(p[10]=[T(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])):U("",!0)])]),_:1})]),_:1},8,["data"])),[[ge,c.value]])])]),_:1})])}}}),Kl={viewBox:"0 0 512 512",width:"1.2em",height:"1.2em"};function Yl(Ie,c){return i(),v("svg",Kl,[...c[0]||(c[0]=[l("path",{fill:"none",stroke:"currentColor","stroke-linecap":"square","stroke-width":"48",d:"m136 208l120-104l120 104m-240 96l120 104l120-104"},null,-1)])])}const Gl=Tt({name:"ion-chevron-expand-sharp",render:Yl}),ql={class:"flex gap-4 h-[calc(100vh-220px)]"},Hl={class:"w-64 border rounded p-3 flex flex-col"},Wl={class:"flex items-center justify-between mb-3"},Jl={class:"flex items-center gap-1"},Ql={key:0,class:"flex-1 overflow-y-auto space-y-2 pr-1 min-h-[400px]"},Xl=["onClick"],Zl={class:"flex items-center justify-between gap-2"},ea={class:"text-sm font-medium truncate flex-1 min-w-0"},ta={class:"text-xs text-gray-500 whitespace-nowrap flex items-center gap-1 flex-shrink-0"},la={class:"whitespace-nowrap w-5 flex items-center justify-center"},aa={class:"flex items-center justify-between gap-2 min-h-[20px]"},sa={class:"flex items-center gap-1 flex-shrink-0"},na={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},oa={key:0,class:"flex-1 border rounded p-3 flex flex-col max-w-2xl"},ra={class:"flex items-center justify-between mb-3 flex-shrink-0"},ia={class:"text-base font-semibold"},ua={class:"text-sm text-gray-500"},da={class:"flex-1 overflow-auto flex flex-col gap-3"},ca={class:"flex items-center justify-between gap-4 flex-shrink-0"},fa={class:"flex items-center gap-4"},va={class:"text-red-500 text-xs truncate max-w-xs inline-block cursor-help"},pa={class:"flex items-center gap-2"},ma={class:"border rounded p-2 flex-1 flex flex-col overflow-hidden"},ga={class:"flex items-center justify-between mb-2 flex-shrink-0"},_a={class:"flex items-center gap-1 pr-1"},xa={class:"flex-1 overflow-auto"},ya={key:0},ha=["draggable","onDragstart","onDrop"],ba={class:"text-xs text-gray-500 w-8"},ka=["title"],wa={key:0,class:"text-xs text-gray-500 whitespace-nowrap w-20 text-right"},Ta={key:1,class:"w-20"},Ca={key:1,class:"text-sm text-gray-400 text-center py-1"},$a={key:1,class:"flex-1 border rounded p-3 flex flex-col max-w-2xl"},Sa=Ke({__name:"AudioMerge",setup(Ie){const c=k(!1),S=k([]),e=k(null),I=k(!1),M=k(!1),V=k(!1),R=k(null),C=yt({callbacks:{onPlay:()=>{d.success("开始播放")},onError:()=>{D(new Error("音频播放失败"),"播放失败"),Z()},onEnded:()=>{Z()}}}),$={size:"small",plain:!0,class:"!w-8 !h-6 !p-0"},j={size:"small",plain:!0,class:"!h-5 !text-xs !px-2"},Q={size:"small",plain:!0,class:"!h-7 !text-xs"},X=["bg-gray-100","border-t-2","border-b-2","border-blue-500"],Y=o=>{o&&o.classList.remove(...X)},te=o=>{if(!o)return;o.querySelectorAll('[draggable="true"]').forEach(g=>Y(g))},O=async o=>{if(e.value&&o.length!==0)try{c.value=!0;for(const u of o){const g=await Wt(e.value.task_id,u);if(g.code!==0){d.error(`添加文件失败: ${g.msg||"未知错误"}`);break}}d.success(`成功添加 ${o.length} 个文件`),await G(e.value.task_id)}catch(u){D(u,"添加文件失败")}finally{c.value=!1}},A=async()=>{try{c.value=!0;const o=await Jt();o.code===0?(S.value=o.data.tasks||[],S.value.length>0&&!e.value&&await G(S.value[0].task_id)):d.error(o.msg||"获取任务列表失败")}catch(o){D(o,"获取任务列表失败")}finally{c.value=!1}},me=async()=>{try{c.value=!0;const o=await Qt();o.code===0?(d.success("任务创建成功"),await A(),G(o.data.task_id)):d.error(o.msg||"创建任务失败")}catch(o){D(o,"创建任务失败")}finally{c.value=!1}},G=async o=>{e.value&&e.value.task_id!==o&&ge();try{c.value=!0;const u=await Xt(o);u.code===0?e.value=u.data:d.error(u.msg||"获取任务信息失败")}catch(u){D(u,"获取任务信息失败")}finally{c.value=!1}},L=async o=>{if(await pe.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{c.value=!0;const g=await ll(o);g.code===0?(d.success("任务删除成功"),await A(),e.value&&e.value.task_id===o&&(S.value&&S.value.length>0?await G(S.value[0].task_id):e.value=null)):d.error(g.msg||"删除任务失败")}catch(g){D(g,"删除任务失败")}finally{c.value=!1}},le=()=>{if(!e.value){d.warning("请先创建或选择任务");return}I.value=!0},J=async o=>{if(!(!e.value||!await pe.confirm("确定要删除该文件吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{c.value=!0;const g=await al(e.value.task_id,o);g.code===0?(C.playingFileIndex.value===o?ge():C.playingFileIndex.value!==null&&C.playingFileIndex.value>o&&(C.playingFileIndex.value=C.playingFileIndex.value-1),d.success("文件删除成功"),await G(e.value.task_id)):d.error(g.msg||"删除文件失败")}catch(g){D(g,"删除文件失败")}finally{c.value=!1}},m=async()=>{if(!(!e.value||!await pe.confirm(`确定要开始合成吗？将合并 ${de.value} 个音频文件。`,"确认合成",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{c.value=!0;const u=await Zt(e.value.task_id);u.code===0?(d.success("合成任务已启动"),await A(),await G(e.value.task_id),q()):d.error(u.msg||"启动任务失败")}catch(u){D(u,"启动任务失败")}finally{c.value=!1}},{start:p,stop:b}=ot(async()=>{if(!e.value||e.value.status!=="processing"){b();return}await A(),await G(e.value.task_id)},ht,{immediate:!1}),q=()=>{p()},ie=o=>{if(!o)return;const u=sl(o);window.open(u,"_blank")},ae=()=>{e.value?.result_file&&ie(e.value.task_id)},H=o=>{o?.result_file&&ie(o.task_id)},Z=()=>{C.clear()},ye=(o,u)=>{if(!o)return;const g=o?.path||o?.name||"";C.seekFile(g,u)},he=(o,u)=>{e.value?.result_file&&ye({path:e.value.result_file},u)},fe=o=>{if(!e.value||!e.value.files||o<0||o>=e.value.files.length)return;const u=e.value.files[o],g=u.path||u.name||"";if(!g){d.warning("文件路径不存在");return}if(C.playingFilePath.value===g&&C.audio&&!C.audio.paused){Z(),d.info("已停止播放");return}const N=Xe(g);if(!N){d.error("无法生成媒体文件URL");return}C.load(N,{playingFilePath:g,playingFileIndex:o}),C.play().catch(oe=>{D(oe,"播放失败"),Z()})},ge=()=>{Z()},_=()=>{if(!e.value||!e.value.result_file){d.warning("结果文件不存在");return}const o=e.value.result_file;if(C.playingFilePath.value===o&&C.audio&&!C.audio.paused){Z(),d.info("已停止播放");return}const u=Xe(o);if(!u){d.error("无法生成媒体文件URL");return}C.load(u,{playingFilePath:o}),C.play().catch(g=>{D(g,"播放失败"),Z()})},se=()=>{if(!e.value||!e.value.result_file){d.warning("结果文件不存在");return}M.value=!0},Fe=async o=>{if(!e.value||!e.value.result_file)return;if(o.length===0){d.warning("请选择转存目录");return}const u=o[0];try{c.value=!0;const g=await el(e.value.task_id,u);g.code===0?(d.success("转存成功"),M.value=!1):d.error(g.msg||"转存失败")}catch(g){D(g,"转存失败")}finally{c.value=!1}},Me=xt,Ue={pending:{tag:"info",text:"等待中"},processing:{tag:"warning",text:"处理中"},success:{tag:"success",text:"成功"},failed:{tag:"danger",text:"失败"}},ne=o=>Ue[o]?.tag||"info",be=o=>Ue[o]?.text||"未知",ke=W(()=>e.value?.status==="processing"),ue=W(()=>(e.value?.files||[]).length>0),de=W(()=>(e.value?.files||[]).length),Pe=W(()=>e.value?.result_file),Re=W(()=>!Pe.value||e.value?.status!=="success"||V.value),f=W(()=>!ue.value||ke.value||V.value),r=W(()=>ke.value||V.value),F=W(()=>!e.value||!ue.value||ke.value),z=W(()=>V.value?"点击退出拖拽排序模式":"点击进入拖拽排序模式"),_e=W(()=>({path:Pe.value||""})),we=(o,u)=>!o||!u||o.length!==u.length?!0:o.some((g,N)=>{const oe=g?.path||g?.name,Ce=u[N]?.path||u[N]?.name;return oe!==Ce}),De=async()=>{if(V.value){if(e.value&&e.value.files&&e.value.files.length>0){if(we(R.value||[],e.value.files))try{c.value=!0;const u=e.value.files.map((N,oe)=>oe),g=await tl(e.value.task_id,u);g.code===0?(d.success("排序已保存"),await G(e.value.task_id)):d.error(g.msg||"保存排序失败")}catch(u){D(u,"保存排序失败")}finally{c.value=!1}R.value=null}}else e.value&&e.value.files&&e.value.files.length>0&&(R.value=[...e.value.files||[]]);V.value=!V.value},Te=(o,u)=>{if(!V.value)return o.preventDefault(),!1;try{o.dataTransfer&&(o.dataTransfer.effectAllowed="move",o.dataTransfer.setData("text/plain",u.toString()))}catch(g){console.error("拖拽开始失败:",g)}},Ee=o=>{o.currentTarget&&Y(o.currentTarget)},Ae=o=>{o.currentTarget&&Y(o.currentTarget)},Be=o=>{if(V.value&&(o.preventDefault(),o.dataTransfer&&(o.dataTransfer.dropEffect="move"),o.currentTarget)){const u=o.currentTarget.getBoundingClientRect(),g=o.clientY,N=u.top+u.height/2;Y(o.currentTarget),g<N?o.currentTarget.classList.add("border-t-2","border-blue-500"):o.currentTarget.classList.add("border-b-2","border-blue-500")}},Le=(o,u)=>{if(!V.value||(o.preventDefault(),o.currentTarget&&(Y(o.currentTarget),te(o.currentTarget.parentElement)),!o.dataTransfer))return;const g=parseInt(o.dataTransfer.getData("text/plain"),10);if(g===u||isNaN(g)||!e.value||!e.value.files||g<0||g>=e.value.files.length||u<0||u>=e.value.files.length)return;const N=o.currentTarget?.getBoundingClientRect(),oe=o.clientY,Ce=N?N.top+N.height/2:0,n=oe<Ce?u:u+1,t=[...e.value.files||[]],[h]=t.splice(g,1),x=g<n?n-1:n;t.splice(x,0,h),e.value={...e.value,files:t}},y=()=>{I.value=!1};return Ge(()=>{A()}),tt(()=>{ge(),b()}),(o,u)=>{const g=Je,N=qe,oe=He,Ce=nt,n=Gl;return i(),v("div",ql,[l("div",Hl,[l("div",Wl,[u[7]||(u[7]=l("h3",{class:"text-base font-semibold"},"任务列表",-1)),l("div",Jl,[a(N,K({type:"info"},$,{onClick:A,loading:c.value}),{default:s(()=>[c.value?U("",!0):(i(),E(g,{key:0},{default:s(()=>[a(B(We))]),_:1}))]),_:1},16,["loading"]),a(N,K({type:"success"},$,{onClick:me,loading:c.value}),{default:s(()=>[a(g,null,{default:s(()=>[a(B(at))]),_:1})]),_:1},16,["loading"])])]),S.value&&S.value.length>0?(i(),v("div",Ql,[(i(!0),v(Se,null,Oe(S.value,t=>(i(),v("div",{key:t.task_id,class:je(["border rounded px-3 py-2 cursor-pointer hover:bg-gray-50 group min-h-[60px] flex flex-col justify-between",{"border-blue-500 bg-blue-50":e.value&&t.task_id===e.value.task_id}]),onClick:h=>G(t.task_id)},[l("div",Zl,[l("div",ea,w(t.name),1),l("span",ta,[a(g,null,{default:s(()=>[a(B(Dt),{class:"!w-3 !h-3"})]),_:1}),l("span",la,w(t.files?t.files.length:0),1)])]),l("div",aa,[a(oe,{type:ne(t.status),size:"small",class:"!h-5 !text-xs w-16 text-center"},{default:s(()=>[T(w(be(t.status)),1)]),_:2},1032,["type"]),l("div",sa,[t.status==="success"&&t.result_file?(i(),E(N,K({key:0,type:"primary"},{ref_for:!0},j,{onClick:ce(h=>H(t),["stop"])}),{default:s(()=>[...u[8]||(u[8]=[T(" 下载 ",-1)])]),_:1},16,["onClick"])):U("",!0),a(N,K({type:"danger"},{ref_for:!0},j,{onClick:ce(h=>L(t.task_id),["stop"]),disabled:t.status==="processing"}),{default:s(()=>[a(g,null,{default:s(()=>[a(B(st))]),_:1})]),_:1},16,["onClick","disabled"])])])],10,Xl))),128))])):(i(),v("div",na,' 暂无任务，请点击"新建"创建 '))]),e.value?(i(),v("div",oa,[l("div",ra,[l("h3",ia,"任务详情: "+w(e.value.name),1),l("span",ua," 共 "+w(de.value)+" 个文件 ",1)]),l("div",da,[l("div",ca,[l("div",fa,[a(oe,{type:ne(e.value.status),size:"small",class:"w-16 text-center"},{default:s(()=>[T(w(be(e.value.status)),1)]),_:1},8,["type"]),Pe.value?(i(),E(Ze,{key:0,file:_e.value,player:B(C),disabled:V.value,onPlay:_,onSeek:he},null,8,["file","player","disabled"])):U("",!0),a(N,K({type:"primary"},Q,{onClick:ae,disabled:Re.value}),{default:s(()=>[...u[9]||(u[9]=[T(" 下载 ",-1)])]),_:1},16,["disabled"]),a(N,K({type:"success"},Q,{onClick:se,disabled:Re.value}),{default:s(()=>[...u[10]||(u[10]=[T(" 转存 ",-1)])]),_:1},16,["disabled"]),e.value.error_message?(i(),E(Ce,{key:1,content:`错误: ${e.value.error_message}`,placement:"top"},{default:s(()=>[l("span",va," 错误: "+w(e.value.error_message),1)]),_:1},8,["content"])):U("",!0)]),l("div",pa,[a(N,K({type:"success"},Q,{onClick:m,disabled:f.value,loading:ke.value}),{default:s(()=>[...u[11]||(u[11]=[T(" 开始合成 ",-1)])]),_:1},16,["disabled","loading"])])]),l("div",ma,[l("div",ga,[u[13]||(u[13]=l("h4",{class:"text-sm font-semibold"},"文件列表",-1)),l("div",_a,[a(N,K({type:"primary"},j,{disabled:r.value,onClick:le}),{default:s(()=>[...u[12]||(u[12]=[T(" + ",-1)])]),_:1},16,["disabled"]),a(N,K({type:V.value?"success":"default"},$,{onClick:De,disabled:F.value,title:z.value}),{default:s(()=>[V.value?(i(),E(g,{key:0},{default:s(()=>[a(B(ft))]),_:1})):(i(),E(n,{key:1,class:"!w-3.5 !h-3.5"}))]),_:1},16,["type","disabled","title"])])]),l("div",xa,[ue.value?(i(),v("div",ya,[(i(!0),v(Se,null,Oe(e.value.files,(t,h)=>(i(),v("div",{key:h,class:je(["flex items-center gap-2 p-1 hover:bg-gray-100 rounded",{"cursor-move":V.value,"cursor-default":!V.value,"select-none":!0}]),draggable:V.value,onDragstart:x=>Te(x,Number(h)),onDragend:u[2]||(u[2]=x=>Ee(x)),onDragover:u[3]||(u[3]=ce(x=>Be(x),["prevent"])),onDragleave:Ae,onDrop:ce(x=>Le(x,Number(h)),["prevent"])},[l("span",ba,w(Number(h)+1),1),l("span",{class:"flex-1 text-sm truncate",title:t.path||t.name},w(t.name),9,ka),t.size?(i(),v("span",wa,w(B(Me)(t.size)),1)):(i(),v("div",Ta)),l("div",{class:"flex items-center gap-1 flex-shrink-0",onMousedown:u[0]||(u[0]=ce(()=>{},["stop"])),onClick:u[1]||(u[1]=ce(()=>{},["stop"]))},[a(Ze,{file:t,player:B(C),disabled:r.value,onPlay:()=>fe(Number(h)),onSeek:ye},null,8,["file","player","disabled","onPlay"]),a(N,{type:"info",size:"small",plain:"",circle:"",onClick:ce(x=>J(Number(h)),["stop"]),disabled:r.value,class:"!h-6 !text-xs"},{default:s(()=>[a(g,null,{default:s(()=>[a(B(Vt))]),_:1})]),_:1},8,["onClick","disabled"])],32)],42,ha))),128))])):(i(),v("div",Ca,"文件列表为空"))])])])])):(i(),v("div",$a,[...u[14]||(u[14]=[l("div",{class:"flex items-center justify-between mb-3 flex-shrink-0"},[l("h3",{class:"text-base font-semibold"},"任务详情")],-1),l("div",{class:"flex-1 flex items-center justify-center text-sm text-gray-400"}," 请从左侧选择一个任务查看详情 ",-1)])])),a(et,{visible:I.value,"onUpdate:visible":u[4]||(u[4]=t=>I.value=t),title:"选择文件添加到任务","confirm-button-text":"添加","confirm-loading":c.value,onConfirm:O,onClose:y},null,8,["visible","confirm-loading"]),a(et,{visible:M.value,"onUpdate:visible":u[5]||(u[5]=t=>M.value=t),title:"选择转存目录","confirm-button-text":"转存",mode:"directory","confirm-loading":c.value,onConfirm:Fe,onClose:u[6]||(u[6]=t=>M.value=!1)},null,8,["visible","confirm-loading"])])}}}),Ma={class:"flex gap-4 h-[calc(100vh-220px)]"},Pa={class:"w-64 border rounded p-3 flex flex-col"},Da={class:"flex items-center justify-between mb-3"},Va={class:"flex items-center gap-1"},Fa={key:0,class:"flex-1 overflow-y-auto space-y-2 pr-1 min-h-[400px]"},Ua=["onClick"],Ra={class:"flex items-center justify-between gap-2"},Ea=["title"],Aa={class:"flex items-center justify-between gap-2 min-h-[20px]"},Ba={class:"flex items-center gap-1 flex-shrink-0"},La={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400 min-h-[400px]"},za={key:0,class:"flex-1 border rounded p-3 flex flex-col min-h-0"},ja={class:"flex items-center justify-between mb-3 flex-shrink-0"},Oa={class:"flex items-center gap-2 flex-1"},Ia={class:"text-base font-semibold"},Na={class:"flex-1 flex flex-col gap-3 min-h-0"},Ka={class:"flex items-center gap-4 flex-shrink-0"},Ya={class:"text-red-500 text-xs truncate block max-w-md cursor-help"},Ga={class:"border rounded p-3 flex flex-col gap-2"},qa={class:"flex items-center justify-between"},Ha={class:"flex items-center gap-2"},Wa={key:0,class:"text-xs text-gray-500"},Ja={key:0,class:"text-sm text-gray-600"},Qa=["title"],Xa={key:1,class:"text-sm text-gray-400"},Za={class:"border rounded p-3 flex flex-col gap-2 flex-1 min-h-0 overflow-hidden"},es={key:0,class:"flex-1 overflow-y-scroll scrollbar-overlay space-y-1 min-h-0"},ts={class:"flex-1 min-w-0 flex items-center gap-3 text-sm"},ls=["title"],as={class:"flex items-center gap-2 text-xs text-gray-500 flex-shrink-0"},ss={key:0},ns={key:1},os=["title"],rs={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400 min-h-0"},is={key:1,class:"flex-1 border rounded p-3 flex flex-col"},us={key:2,class:"w-80 border rounded p-3 flex flex-col"},ds={class:"flex-1 overflow-auto flex flex-col gap-3"},cs={class:"border rounded p-3 flex flex-col gap-2"},fs={class:"flex items-center gap-2"},vs={class:"border rounded p-3 flex flex-col gap-2"},ps={class:"flex items-center gap-2"},ms={class:"text-xs text-gray-400 flex items-center gap-1"},gs={key:0,class:"border rounded p-3 flex flex-col gap-2"},_s={key:0,class:"space-y-2"},xs={class:"text-sm text-gray-600"},ys=["title"],hs={key:1,class:"text-sm text-gray-400"},bs={key:1,class:"border rounded p-3 flex flex-col gap-2"},ks={class:"text-sm text-gray-600"},ws={key:0,class:"mt-2"},Ts={key:3,class:"w-80 border rounded p-3 flex flex-col"},Cs=Ke({__name:"AudioConvert",setup(Ie){const c=k(!1),S=k([]),e=k(null),I=k(!1),M=k("mp3"),V=k(!1),R=k(!0),C=k(!1),$=k(!1),j=k(""),Q=k(!1),X=k(""),Y={size:"small",plain:!0,class:"!w-8 !h-6 !p-0"},te={size:"small",plain:!0,class:"!h-5 !text-xs !px-2"},O={size:"small",plain:!0,class:"!h-7 !text-xs"},A=async()=>{try{c.value=!0;const f=await nl();f.code===0?(S.value=f.data.tasks||[],S.value.length>0&&!e.value&&await J(S.value[0].task_id)):d.error(f.msg||"获取任务列表失败")}catch(f){D(f,"获取任务列表失败")}finally{c.value=!1}},me=()=>{const f=new Date,r=f.getFullYear(),F=String(f.getMonth()+1).padStart(2,"0"),z=String(f.getDate()).padStart(2,"0"),_e=String(f.getHours()).padStart(2,"0"),we=String(f.getMinutes()).padStart(2,"0"),De=String(f.getSeconds()).padStart(2,"0");j.value=`${r}-${F}-${z} ${_e}:${we}:${De}`,$.value=!0},G=async()=>{if(!j.value.trim()){d.warning("请输入任务名称");return}try{c.value=!0;const f=await ol({name:j.value.trim()});f.code===0?(d.success("任务创建成功"),$.value=!1,j.value="",await A(),J(f.data.task_id)):d.error(f.msg||"创建任务失败")}catch(f){D(f,"创建任务失败")}finally{c.value=!1}},L=()=>{e.value&&(X.value=e.value.name,Q.value=!0)},le=async()=>{if(e.value){if(!X.value.trim()){d.warning("请输入任务名称");return}try{c.value=!0;const f=await Ye(e.value.task_id,{name:X.value.trim()});f.code===0?(d.success("任务名称修改成功"),Q.value=!1,X.value="",await J(e.value.task_id)):d.error(f.msg||"修改任务名称失败")}catch(f){D(f,"修改任务名称失败")}finally{c.value=!1}}},J=async f=>{try{c.value=!0;const r=await rl(f);if(r.code===0){e.value=r.data;const F=S.value.findIndex(z=>z.task_id===f);F!==-1&&(S.value[F]={...r.data}),M.value=r.data.output_dir||"mp3",V.value=!1,R.value=r.data.overwrite!==!1,C.value=!1}else d.error(r.msg||"获取任务信息失败")}catch(r){D(r,"获取任务信息失败")}finally{c.value=!1}},m=async f=>{if(await pe.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{c.value=!0;const F=await ul(f);F.code===0?(d.success("任务删除成功"),await A(),e.value&&e.value.task_id===f&&(S.value&&S.value.length>0?await J(S.value[0].task_id):e.value=null)):d.error(F.msg||"删除任务失败")}catch(F){D(F,"删除任务失败")}finally{c.value=!1}},p=()=>{if(!e.value){d.warning("请先创建或选择任务");return}I.value=!0},b=async f=>{if(!e.value||f.length===0)return;const r=f[0];try{c.value=!0;const F=await Ye(e.value.task_id,{directory:r});F.code===0?(d.success("目录设置成功"),await J(e.value.task_id),I.value=!1):d.error(F.msg||"设置目录失败")}catch(F){D(F,"设置目录失败")}finally{c.value=!1}},q=()=>{I.value=!1},ie=()=>{if(!e.value)return;const f=e.value.output_dir||"mp3";V.value=M.value!==f},ae=async()=>{if(e.value){if(!M.value.trim()){d.error("输出目录名称不能为空");return}try{c.value=!0;const f=await Ye(e.value.task_id,{output_dir:M.value.trim()});f.code===0?(d.success("输出目录名称保存成功"),await J(e.value.task_id)):d.error(f.msg||"保存输出目录名称失败")}catch(f){D(f,"保存输出目录名称失败")}finally{c.value=!1}}},H=()=>{if(!e.value)return;const f=e.value.overwrite!==!1;C.value=R.value!==f,C.value&&Z()},Z=async()=>{if(e.value)try{c.value=!0;const f=await Ye(e.value.task_id,{overwrite:R.value});f.code===0?(d.success("覆盖选项保存成功"),await J(e.value.task_id)):d.error(f.msg||"保存覆盖选项失败")}catch(f){D(f,"保存覆盖选项失败")}finally{c.value=!1}},ye=async()=>{if(!e.value)return;if(!e.value.directory){d.warning("请先选择转码目录");return}if(await pe.confirm(`确定要开始转码吗？将转换 "${e.value.name}" 。`,"确认转码",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{c.value=!0;const r=await il(e.value.task_id);r.code===0?(d.success("转码任务已启动"),await A(),await J(e.value.task_id),ge()):d.error(r.msg||"启动任务失败")}catch(r){D(r,"启动任务失败")}finally{c.value=!1}},{start:he,stop:fe}=ot(async()=>{if(!e.value){fe();return}if(await A(),e.value.status!=="processing"){await J(e.value.task_id),fe();return}await J(e.value.task_id)},_l,{immediate:!1}),ge=()=>{he()},_={pending:{tag:"info",text:"等待中"},processing:{tag:"warning",text:"处理中"},success:{tag:"success",text:"成功"},failed:{tag:"danger",text:"失败"}},se=f=>_[f]?.tag||"info",Fe=f=>_[f]?.text||"未知",Me=W(()=>e.value?.status==="processing"),Ue=W(()=>!e.value?.directory||Me.value),ne=W(()=>Me.value),be=W(()=>e.value?.file_status?Object.keys(e.value.file_status).map(f=>{const r=e.value.file_status[f];return{path:f,status:r.status||"pending",error:r.error,size:r.size,duration:r.duration}}):[]),ke=f=>f.path.split("/").pop()||f.path,ue=f=>f.status,de=f=>f.error,Pe=f=>{if(!f)return"";const r=["B","KB","MB","GB"];let F=f,z=0;for(;F>=1024&&z<r.length-1;)F/=1024,z++;return`${F.toFixed(1)} ${r[z]}`},Re=f=>{if(!f)return"";const r=Math.floor(f/3600),F=Math.floor(f%3600/60),z=f%60;return r>0?`${r}:${F.toString().padStart(2,"0")}:${z.toString().padStart(2,"0")}`:`${F}:${z.toString().padStart(2,"0")}`};return Ge(()=>{A()}),tt(()=>{fe()}),(f,r)=>{const F=Je,z=qe,_e=He,we=nt,De=Rt,Te=lt,Ee=ct,Ae=_t,Be=gt,Le=mt;return i(),v("div",Ma,[l("div",Pa,[l("div",Da,[r[11]||(r[11]=l("h3",{class:"text-base font-semibold"},"任务列表",-1)),l("div",Va,[a(z,K({type:"info"},Y,{onClick:A,loading:c.value}),{default:s(()=>[c.value?U("",!0):(i(),E(F,{key:0},{default:s(()=>[a(B(We))]),_:1}))]),_:1},16,["loading"]),a(z,K({type:"success"},Y,{onClick:me,loading:c.value}),{default:s(()=>[c.value?U("",!0):(i(),E(F,{key:0},{default:s(()=>[a(B(at))]),_:1}))]),_:1},16,["loading"])])]),S.value&&S.value.length>0?(i(),v("div",Fa,[(i(!0),v(Se,null,Oe(S.value,y=>(i(),v("div",{key:y.task_id,class:je(["border rounded px-3 py-2 cursor-pointer hover:bg-gray-50 group min-h-[60px] flex flex-col justify-between",{"border-blue-500 bg-blue-50":e.value&&y.task_id===e.value.task_id}]),onClick:o=>J(y.task_id)},[l("div",Ra,[l("div",{class:"text-sm font-medium truncate flex-1 min-w-0",title:y.name},w(y.name),9,Ea)]),l("div",Aa,[a(_e,{type:se(y.status),size:"small",class:"!h-5 !text-xs w-16 text-center"},{default:s(()=>[T(w(Fe(y.status)),1)]),_:2},1032,["type"]),l("div",Ba,[a(z,K({type:"danger"},{ref_for:!0},te,{onClick:ce(o=>m(y.task_id),["stop"]),disabled:y.status==="processing"}),{default:s(()=>[a(F,null,{default:s(()=>[a(B(st))]),_:1})]),_:1},16,["onClick","disabled"])])])],10,Ua))),128))])):(i(),v("div",La,' 暂无任务，请点击"新建"创建 '))]),e.value?(i(),v("div",za,[l("div",ja,[l("div",Oa,[l("h3",Ia,"文件列表: "+w(e.value.name),1),a(z,{type:"default",size:"small",plain:"",circle:"",disabled:ne.value,onClick:L,title:"编辑名称"},{default:s(()=>[a(F,null,{default:s(()=>[a(B(vt))]),_:1})]),_:1},8,["disabled"])])]),l("div",Na,[l("div",Ka,[a(_e,{type:se(e.value.status),size:"small",class:"w-16 text-center flex-shrink-0"},{default:s(()=>[T(w(Fe(e.value.status)),1)]),_:1},8,["type"]),e.value.error_message?(i(),E(we,{key:0,content:`错误: ${e.value.error_message}`,placement:"top",class:"flex-1 min-w-0 max-w-md"},{default:s(()=>[l("span",Ya," 错误: "+w(e.value.error_message),1)]),_:1},8,["content"])):U("",!0)]),l("div",Ga,[l("div",qa,[l("div",Ha,[r[12]||(r[12]=l("h4",{class:"text-sm font-semibold"},"转码目录",-1)),e.value.total_files!==null&&e.value.total_files!==void 0?(i(),v("span",Wa," 可处理文件数: "+w(e.value.total_files),1)):U("",!0)]),a(z,K({type:"primary"},te,{disabled:ne.value,onClick:p}),{default:s(()=>[...r[13]||(r[13]=[T(" 选择目录 ",-1)])]),_:1},16,["disabled"])]),e.value.directory?(i(),v("div",Ja,[l("div",{class:"truncate",title:e.value.directory},w(e.value.directory),9,Qa)])):(i(),v("div",Xa," 请选择一个目录，该目录下的所有媒体文件将被转换为 MP3 格式 "))]),l("div",Za,[r[14]||(r[14]=l("h4",{class:"text-sm font-semibold flex-shrink-0"},"文件列表",-1)),be.value&&be.value.length>0?(i(),v("div",es,[(i(!0),v(Se,null,Oe(be.value,(y,o)=>(i(),v("div",{key:o,class:"flex items-center gap-2 p-2 rounded hover:bg-gray-50 border-b border-gray-100"},[a(F,{class:je(["flex-shrink-0",{"text-green-500":ue(y)==="success","text-red-500":ue(y)==="failed","text-yellow-500":ue(y)==="processing","text-gray-400":ue(y)==="pending"}])},{default:s(()=>[ue(y)==="success"?(i(),E(B(ft),{key:0})):ue(y)==="failed"?(i(),E(B(pt),{key:1})):ue(y)==="processing"?(i(),E(B(Ft),{key:2})):(i(),E(B(Ut),{key:3}))]),_:2},1032,["class"]),l("div",ts,[l("div",{class:"flex-1 min-w-0 truncate",title:y.path},w(ke(y)),9,ls),l("div",as,[y.size?(i(),v("span",ss,w(Pe(y.size)),1)):U("",!0),y.duration?(i(),v("span",ns,w(Re(y.duration)),1)):U("",!0)]),de(y)?(i(),v("div",{key:0,class:"text-xs text-red-500 truncate max-w-xs",title:de(y)},w(de(y)),9,os)):U("",!0)])]))),128))])):(i(),v("div",rs," 暂无文件，请先选择转码目录 "))])])])):(i(),v("div",is,[...r[15]||(r[15]=[l("div",{class:"flex items-center justify-between mb-3 flex-shrink-0"},[l("h3",{class:"text-base font-semibold"},"文件列表")],-1),l("div",{class:"flex-1 flex items-center justify-center text-sm text-gray-400"}," 请从左侧选择一个任务查看文件列表 ",-1)])])),e.value?(i(),v("div",us,[r[24]||(r[24]=l("div",{class:"flex items-center justify-between mb-3"},[l("h3",{class:"text-base font-semibold"},"输出信息")],-1)),l("div",ds,[l("div",cs,[l("div",fs,[r[16]||(r[16]=l("span",{class:"text-sm text-gray-600"},"覆盖同名文件",-1)),a(De,{modelValue:R.value,"onUpdate:modelValue":r[0]||(r[0]=y=>R.value=y),disabled:ne.value,onChange:H},null,8,["modelValue","disabled"])]),a(z,K({type:"success"},O,{onClick:ye,disabled:Ue.value,loading:Me.value,class:"w-full"}),{default:s(()=>[...r[17]||(r[17]=[T(" 开始转码 ",-1)])]),_:1},16,["disabled","loading"])]),l("div",vs,[r[20]||(r[20]=l("div",{class:"flex items-center justify-between"},[l("h4",{class:"text-sm font-semibold"},"输出目录名称")],-1)),l("div",ps,[a(Te,{modelValue:M.value,"onUpdate:modelValue":r[1]||(r[1]=y=>M.value=y),placeholder:"输出目录名称",size:"small",disabled:ne.value,onBlur:ie},null,8,["modelValue","disabled"]),a(z,K({type:"primary"},te,{disabled:ne.value||!V.value,onClick:ae}),{default:s(()=>[...r[18]||(r[18]=[T(" 保存 ",-1)])]),_:1},16,["disabled"])]),l("div",ms,[r[19]||(r[19]=l("span",null,"文件将保存在转码目录下的此文件夹中",-1)),e.value?.directory&&e.value?.output_dir?(i(),E(we,{key:0,content:`${e.value.directory}/${e.value.output_dir}`,placement:"top"},{default:s(()=>[a(F,{class:"cursor-help text-gray-400 hover:text-gray-600"},{default:s(()=>[a(B(Et))]),_:1})]),_:1},8,["content"])):U("",!0)])]),e.value.status==="processing"||e.value.progress?(i(),v("div",gs,[r[21]||(r[21]=l("h4",{class:"text-sm font-semibold"},"转码进度",-1)),e.value.progress?(i(),v("div",_s,[l("div",xs," 已处理: "+w(e.value.progress.processed??0)+" / "+w(e.value.total_files??e.value.progress.total??0),1),a(Ee,{percentage:(e.value.total_files??e.value.progress.total??0)>0?Math.round((e.value.progress.processed??0)/(e.value.total_files??e.value.progress.total??1)*100):0,status:e.value.status==="processing"?void 0:"success"},null,8,["percentage","status"]),e.value.progress.current_file?(i(),v("div",{key:0,class:"text-xs text-gray-500 truncate",title:e.value.progress.current_file}," 正在处理: "+w(e.value.progress.current_file),9,ys)):U("",!0)])):(i(),v("div",hs,"等待开始转码..."))])):U("",!0),e.value.status==="success"?(i(),v("div",bs,[r[23]||(r[23]=l("h4",{class:"text-sm font-semibold"},"转码结果",-1)),l("div",ks,[r[22]||(r[22]=l("div",null,"转码完成！所有文件已保存到输出目录",-1)),e.value.progress?(i(),v("div",ws," 共转换 "+w(e.value.total_files??e.value.progress.total??0)+" 个文件 ",1)):U("",!0)])])):U("",!0)])])):(i(),v("div",Ts,[...r[25]||(r[25]=[l("h3",{class:"text-base font-semibold mb-3"},"输出信息",-1),l("div",{class:"flex-1 flex items-center justify-center text-sm text-gray-400"}," 请从左侧选择一个任务查看输出信息 ",-1)])])),a(et,{visible:I.value,"onUpdate:visible":r[2]||(r[2]=y=>I.value=y),title:"选择转码目录","confirm-button-text":"确定",mode:"directory","default-path":e.value?.directory||void 0,"confirm-loading":c.value,onConfirm:b,onClose:q},null,8,["visible","default-path","confirm-loading"]),a(Le,{modelValue:$.value,"onUpdate:modelValue":r[5]||(r[5]=y=>$.value=y),title:"创建转码任务",width:"400px",onClose:r[6]||(r[6]=y=>j.value="")},{footer:s(()=>[a(z,{onClick:r[4]||(r[4]=y=>$.value=!1)},{default:s(()=>[...r[26]||(r[26]=[T("取消",-1)])]),_:1}),a(z,{type:"primary",onClick:G,loading:c.value},{default:s(()=>[...r[27]||(r[27]=[T(" 确定 ",-1)])]),_:1},8,["loading"])]),default:s(()=>[a(Be,null,{default:s(()=>[a(Ae,{label:"任务名称"},{default:s(()=>[a(Te,{modelValue:j.value,"onUpdate:modelValue":r[3]||(r[3]=y=>j.value=y),placeholder:"请输入任务名称",onKeyup:Ne(G,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Le,{modelValue:Q.value,"onUpdate:modelValue":r[9]||(r[9]=y=>Q.value=y),title:"重命名任务",width:"400px",onClose:r[10]||(r[10]=y=>X.value="")},{footer:s(()=>[a(z,{onClick:r[8]||(r[8]=y=>Q.value=!1)},{default:s(()=>[...r[28]||(r[28]=[T("取消",-1)])]),_:1}),a(z,{type:"primary",onClick:le,loading:c.value},{default:s(()=>[...r[29]||(r[29]=[T(" 确定 ",-1)])]),_:1},8,["loading"])]),default:s(()=>[a(Be,null,{default:s(()=>[a(Ae,{label:"任务名称"},{default:s(()=>[a(Te,{modelValue:X.value,"onUpdate:modelValue":r[7]||(r[7]=y=>X.value=y),placeholder:"请输入任务名称",onKeyup:Ne(le,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),$s={class:"flex gap-4 h-[calc(100vh-220px)]"},Ss={class:"w-64 border rounded p-3 flex flex-col"},Ms={class:"flex items-center justify-between mb-3"},Ps={class:"flex items-center gap-1"},Ds={key:0,class:"flex-1 overflow-y-auto space-y-2 pr-1 min-h-[400px]"},Vs=["onClick"],Fs={class:"flex items-center justify-between gap-2"},Us=["title"],Rs={key:0,class:"text-xs text-gray-500 flex-shrink-0"},Es={class:"flex items-center justify-between gap-2 min-h-[20px]"},As={class:"flex items-center gap-1 flex-shrink-0"},Bs={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},Ls={key:0,class:"flex-1 border rounded p-3 flex flex-col max-w-2xl"},zs={class:"flex items-cente mb-3 flex-shrink-0"},js={class:"text-base font-semibold mr-2"},Os={class:"flex-1 overflow-auto flex flex-col gap-3"},Is={class:"flex items-center gap-4 flex-shrink-0 flex-wrap"},Ns={key:1,class:"text-xs text-gray-600 ml-auto"},Ks={class:"text-red-500 text-xs truncate max-w-xs inline-block cursor-help"},Ys={class:"border rounded p-3 flex flex-col gap-2"},Gs={class:"flex items-center justify-between"},qs={class:"flex items-center gap-2"},Hs={key:0,class:"flex items-center gap-2 mr-2"},Ws=["onClick"],Js=["src","alt"],Qs=["onClick"],Xs={class:"border rounded p-3 flex flex-col gap-2"},Zs={class:"grid grid-cols-3 gap-3"},en={class:"flex flex-col gap-1"},tn={class:"flex flex-col gap-1"},ln={class:"flex flex-col gap-1"},an={class:"border rounded p-3 flex flex-col gap-2 flex-shrink-0"},sn={key:1,class:"flex-1 border rounded p-3 flex flex-col max-w-2xl"},nn={class:"flex items-center justify-center min-h-[400px]"},on=["src","alt"],rn={class:"flex items-center justify-between w-full"},un={class:"flex items-center gap-2"},dn={class:"text-sm text-gray-600"},cn=Ke({__name:"TTS",setup(Ie){const c=k(!1),S=k([]),e=k(null),I=k(!1),M=k(""),V=k(""),R=k(!1),C=k(""),$=k(""),j=k("cosyvoice-v3-plus-leo-34ba9eaebae44039a4a9426af6389dcd"),Q=k(.8),X=k(50),Y=k(!1),te=k(null),O=k([]),A=k(new Map),me=k(!1),G=k(!1),L=k(-1),le=yt({callbacks:{onPlay:()=>{d.success("开始播放")},onError:()=>{D(new Error("音频播放失败"),"播放失败"),de()},onEnded:()=>{de()}}}),J={size:"small",plain:!0,class:"!w-8 !h-6 !p-0"},m={size:"small",plain:!0,class:"!h-5 !text-xs !px-2"},p={size:"small",plain:!0,class:"!h-7 !text-xs"},b=async()=>{try{c.value=!0;const n=await dl();n.code===0?(S.value=n.data||[],S.value.length>0&&!e.value&&await H(S.value[0].task_id)):d.error(n.msg||"获取任务列表失败")}catch(n){D(n,"获取任务列表失败")}finally{c.value=!1}},q=()=>{const n=new Date,t=n.getFullYear(),h=String(n.getMonth()+1).padStart(2,"0"),x=String(n.getDate()).padStart(2,"0"),ee=String(n.getHours()).padStart(2,"0"),re=String(n.getMinutes()).padStart(2,"0"),ve=String(n.getSeconds()).padStart(2,"0");M.value=`${t}-${h}-${x} ${ee}:${re}:${ve}`,V.value="",I.value=!0},ie=()=>{M.value=""},ae=async()=>{try{c.value=!0;const n=await cl({text:"",name:M.value.trim()||void 0});n.code===0?(d.success("任务创建成功"),I.value=!1,M.value="",await b(),H(n.data.task_id)):d.error(n.msg||"创建任务失败")}catch(n){D(n,"创建任务失败")}finally{c.value=!1}},H=async n=>{e.value&&e.value.task_id!==n&&(Pe(),ne());try{c.value=!0;const t=await fl(n);if(t.code===0){e.value=t.data;const h=S.value.findIndex(x=>x.task_id===n);h!==-1&&(S.value[h]={...t.data}),$.value=t.data.text||"",j.value=t.data.role?t.data.role:"cosyvoice-v3-plus-leo-34ba9eaebae44039a4a9426af6389dcd",Q.value=t.data.speed??.8,X.value=t.data.vol??50,Y.value=!1,t.data.status==="processing"&&be()}else d.error(t.msg||"获取任务信息失败")}catch(t){D(t,"获取任务信息失败")}finally{c.value=!1}},Z=async n=>{if(e.value&&e.value.task_id===n&&ne(),!!await pe.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{c.value=!0;const h=await gl(n);h.code===0?(d.success("任务删除成功"),await b(),e.value&&e.value.task_id===n&&(S.value&&S.value.length>0?await H(S.value[0].task_id):e.value=null)):d.error(h.msg||"删除任务失败")}catch(h){D(h,"删除任务失败")}finally{c.value=!1}},ye=()=>{e.value&&(C.value=e.value.name,R.value=!0)},he=async()=>{if(e.value){if(!C.value.trim()){d.warning("请输入任务名称");return}try{c.value=!0;const n=await ut(e.value.task_id,{name:C.value.trim()});n.code===0?(d.success("任务名称修改成功"),R.value=!1,C.value="",await H(e.value.task_id)):d.error(n.msg||"修改任务名称失败")}catch(n){D(n,"修改任务名称失败")}finally{c.value=!1}}},fe=()=>{if(!e.value)return;const n=e.value.text||"";Y.value=$.value!==n,Y.value&&se()},ge=n=>{j.value=n,_()},_=()=>{if(!e.value)return;const n=e.value.role||null,t=e.value.speed??.8,h=e.value.vol??50;Y.value=j.value!==n||Q.value!==t||X.value!==h,Y.value&&se()},se=async()=>{if(!(!e.value||!Y.value))try{c.value=!0;const n={},t=e.value.text||"";$.value!==t&&(n.text=$.value);const h=e.value.role||null;j.value!==h&&(n.role=j.value||void 0);const x=e.value.speed??.8;Q.value!==x&&(n.speed=Q.value);const ee=e.value.vol??50;X.value!==ee&&(n.vol=X.value);const re=await ut(e.value.task_id,n);re.code===0?(Y.value=!1,await H(e.value.task_id)):d.error(re.msg||"保存参数失败")}catch(n){D(n,"保存参数失败")}finally{c.value=!1}},Fe=async()=>{if(!e.value)return;if(!$.value.trim()){d.warning("请输入文本内容");return}if(Y.value&&await se(),!!await pe.confirm(`确定要开始生成任务 "${e.value.name}" 吗？`,"确认生成",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{c.value=!0;const t=await vl(e.value.task_id);t.code===0?(d.success("TTS 任务已启动"),await H(e.value.task_id),await b(),await H(e.value.task_id)):d.error(t.msg||"启动任务失败")}catch(t){D(t,"启动任务失败")}finally{c.value=!1}},Me=async()=>{if(!(!e.value||!await pe.confirm("确定要停止生成吗？","确认停止",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{c.value=!0;const t=await pl(e.value.task_id);t.code===0?(d.success("任务已停止"),await b(),await H(e.value.task_id)):d.error(t.msg||"停止任务失败")}catch(t){D(t,"停止任务失败")}finally{c.value=!1}},{start:Ue,stop:ne}=ot(async()=>{if(!e.value){ne();return}const n=e.value.task_id;await b();const t=S.value.find(h=>h.task_id===n);if(!t){ne();return}if(t.status!=="processing"){ne();return}await H(n)},ht,{immediate:!1}),be=()=>{Ue()},ke=async()=>{if(e.value?.output_file)try{const n=dt(e.value.task_id),t=await fetch(n);if(!t.ok){d.error("下载失败");return}const h=await t.blob(),x=URL.createObjectURL(h),ee=e.value.output_file,re=ee.includes(".")?"."+ee.split(".").pop():"",ze=`${e.value.name||"tts_output"}${re}`,xe=document.createElement("a");xe.href=x,xe.download=ze,document.body.appendChild(xe),xe.click(),document.body.removeChild(xe),URL.revokeObjectURL(x)}catch(n){D(n,"下载失败")}},ue=async n=>{if(n?.output_file)try{const t=dt(n.task_id),h=await fetch(t);if(!h.ok){d.error("下载失败");return}const x=await h.blob(),ee=URL.createObjectURL(x),re=n.output_file,ve=re.includes(".")?"."+re.split(".").pop():"",xe=`${n.name||"tts_output"}${ve}`,$e=document.createElement("a");$e.href=ee,$e.download=xe,document.body.appendChild($e),$e.click(),document.body.removeChild($e),URL.revokeObjectURL(ee)}catch(t){D(t,"下载失败")}},de=()=>{le.clear()},Pe=()=>{de()},Re=()=>{if(!e.value||!e.value.output_file){d.warning("结果文件不存在");return}const n=e.value.output_file;if(le.playingFilePath.value===n&&le.audio&&!le.audio.paused){de(),d.info("已停止播放");return}const t=Xe(n);if(!t){d.error("无法生成媒体文件URL");return}le.load(t,{playingFilePath:n}),le.play().catch(h=>{D(h,"播放失败"),de()})},f=(n,t)=>{e.value?.output_file&&r({path:e.value.output_file},t)},r=(n,t)=>{if(!n)return;const h=n?.path||n?.name||"";le.seekFile(h,t)},F={pending:{tag:"info",text:"等待中"},processing:{tag:"warning",text:"处理中"},success:{tag:"success",text:"成功"},failed:{tag:"danger",text:"失败"}},z=n=>F[n]?.tag||"info",_e=n=>F[n]?.text||"未知",we=()=>{te.value?.click()},De=n=>{const h=n.target.files;if(h&&h.length>0){const x=Array.from(h);x.forEach((ee,re)=>{const ve=O.value.length+re,ze=URL.createObjectURL(ee);A.value.set(ve,ze)}),O.value.push(...x)}},Te=n=>{if(A.value.has(n))return A.value.get(n);if(n>=0&&n<O.value.length){const t=URL.createObjectURL(O.value[n]);return A.value.set(n,t),t}return""},Ee=n=>{if(n<0||n>=O.value.length)return;A.value.has(n)&&(URL.revokeObjectURL(A.value.get(n)),A.value.delete(n)),L.value===n?(G.value=!1,L.value=-1):L.value>n&&L.value--;const t=new Map;O.value.forEach((h,x)=>{if(x!==n){const ee=(x>n,x);A.value.has(ee)&&t.set(x>n?x-1:x,A.value.get(ee))}}),A.value=t,O.value.splice(n,1),te.value&&(te.value.value="")},Ae=n=>{L.value=n,G.value=!0},Be=()=>{L.value>0&&L.value--},Le=()=>{L.value<O.value.length-1&&L.value++},y=W(()=>L.value>=0&&O.value[L.value]?O.value[L.value].name:"图片预览"),o=async()=>{if(O.value.length===0){d.warning("请先选择图片");return}try{me.value=!0;const n=await ml(O.value);if(n.code===0&&n.data?.text){const t=n.data.text.trim();t?($.value?$.value+=`

`+t:$.value=t,fe(),d.success("OCR 识别成功，文本已追加"),O.value=[],te.value&&(te.value.value="")):d.warning("识别结果为空")}else d.error(n.msg||"OCR 识别失败")}catch(n){D(n,"OCR 识别失败")}finally{me.value=!1}},u=W(()=>e.value?.status==="processing"),g=W(()=>!$.value.trim()||u.value),N=W(()=>!e.value?.output_file||e.value.status!=="success"),oe=W(()=>e.value?.output_file?{path:e.value.output_file,name:e.value.output_file.split("/").pop()||"output.mp3"}:null),Ce=W(()=>oe.value?{path:oe.value.path,name:oe.value.name,duration:e.value?.duration||null}:null);return Ge(()=>{b()}),tt(()=>{ne(),de(),A.value.forEach(n=>{URL.revokeObjectURL(n)}),A.value.clear()}),(n,t)=>{const h=Je,x=qe,ee=He,re=nt,ve=lt,ze=Lt,xe=Bt,$e=zt,rt=_t,it=gt,Qe=mt;return i(),v("div",$s,[l("div",Ss,[l("div",Ms,[t[14]||(t[14]=l("h3",{class:"text-base font-semibold"},"任务列表",-1)),l("div",Ps,[a(x,K({type:"info"},J,{onClick:b,loading:c.value}),{default:s(()=>[c.value?U("",!0):(i(),E(h,{key:0},{default:s(()=>[a(B(We))]),_:1}))]),_:1},16,["loading"]),a(x,K({type:"success"},J,{onClick:q}),{default:s(()=>[a(h,null,{default:s(()=>[a(B(at))]),_:1})]),_:1},16)])]),S.value&&S.value.length>0?(i(),v("div",Ds,[(i(!0),v(Se,null,Oe(S.value,P=>(i(),v("div",{key:P.task_id,class:je(["border rounded px-3 py-2 cursor-pointer hover:bg-gray-50 group min-h-[60px] flex flex-col justify-between",{"border-blue-500 bg-blue-50":e.value&&P.task_id===e.value.task_id}]),onClick:Ve=>H(P.task_id)},[l("div",Fs,[l("div",{class:"text-sm font-medium truncate flex-1 min-w-0",title:P.name},w(P.name),9,Us),P.duration?(i(),v("span",Rs,w(B(It)(P.duration)),1)):U("",!0)]),l("div",Es,[a(ee,{type:z(P.status),size:"small",class:"!h-5 !text-xs w-16 text-center"},{default:s(()=>[T(w(_e(P.status)),1)]),_:2},1032,["type"]),l("div",As,[P.status==="success"&&P.output_file?(i(),E(x,K({key:0,type:"primary"},{ref_for:!0},m,{onClick:ce(Ve=>ue(P),["stop"])}),{default:s(()=>[...t[15]||(t[15]=[T(" 下载 ",-1)])]),_:1},16,["onClick"])):U("",!0),a(x,K({type:"danger"},{ref_for:!0},m,{onClick:ce(Ve=>Z(P.task_id),["stop"]),disabled:P.status==="processing"}),{default:s(()=>[a(h,null,{default:s(()=>[a(B(st))]),_:1})]),_:1},16,["onClick","disabled"])])])],10,Vs))),128))])):(i(),v("div",Bs,' 暂无任务，请点击"新建"创建 '))]),e.value?(i(),v("div",Ls,[l("div",zs,[l("h3",js,"任务详情: "+w(e.value.name),1),a(x,{type:"default",size:"small",plain:"",circle:"",disabled:u.value,onClick:ye,title:"编辑名称"},{default:s(()=>[a(h,null,{default:s(()=>[a(B(vt))]),_:1})]),_:1},8,["disabled"])]),l("div",Os,[l("div",Is,[a(ee,{type:z(e.value.status),size:"small",class:"w-16 text-center"},{default:s(()=>[T(w(_e(e.value.status)),1)]),_:1},8,["type"]),Ce.value?(i(),E(Ze,{key:0,file:Ce.value,player:B(le),disabled:u.value,onPlay:Re,onSeek:f},null,8,["file","player","disabled"])):U("",!0),a(x,K({type:"primary"},p,{onClick:ke,disabled:N.value}),{default:s(()=>[...t[16]||(t[16]=[T(" 下载 ",-1)])]),_:1},16,["disabled"]),e.value.total_chars!==void 0?(i(),v("span",Ns,[u.value&&e.value.generated_chars!==void 0?(i(),v(Se,{key:0},[T(w(e.value.generated_chars)+" / "+w(e.value.total_chars),1)],64)):(i(),v(Se,{key:1},[T(w(e.value.total_chars),1)],64))])):U("",!0),e.value.error_message?(i(),E(re,{key:2,content:`错误: ${e.value.error_message}`,placement:"top",class:"w-full"},{default:s(()=>[l("span",Ks," 错误: "+w(e.value.error_message),1)]),_:1},8,["content"])):U("",!0)]),l("div",Ys,[l("div",Gs,[t[18]||(t[18]=l("h4",{class:"h-8 text-sm font-semibold"},"文本内容",-1)),l("div",qs,[O.value.length>0?(i(),v("div",Hs,[(i(!0),v(Se,null,Oe(O.value,(P,Ve)=>(i(),v("div",{key:Ve,class:"relative group cursor-pointer",onClick:bt=>Ae(Ve)},[l("img",{src:Te(Ve),alt:P.name,class:"w-8 h-8 object-cover rounded border border-gray-300 hover:border-blue-500 transition-colors"},null,8,Js),l("div",{class:"absolute -right-1 -top-1 w-4 h-4 bg-red-500 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",onClick:ce(bt=>Ee(Ve),["stop"])},[a(h,{class:"text-white text-xs"},{default:s(()=>[a(B(pt))]),_:1})],8,Qs)],8,Ws))),128))])):U("",!0),l("input",{ref_key:"imageInputRef",ref:te,type:"file",accept:"image/*",multiple:"",onChange:De,class:"hidden"},null,544),a(x,{type:"default",size:"small",onClick:we,disabled:u.value,class:"!p-0"},{default:s(()=>[a(h,{class:"!w-7 !h-6"},{default:s(()=>[a(B(At),{class:"!w-5 !h-5"})]),_:1})]),_:1},8,["disabled"]),a(x,{type:"primary",size:"small",onClick:o,disabled:u.value||O.value.length===0,loading:me.value},{default:s(()=>[...t[17]||(t[17]=[T(" 识别 ",-1)])]),_:1},8,["disabled","loading"])])]),a(ve,{modelValue:$.value,"onUpdate:modelValue":t[0]||(t[0]=P=>$.value=P),type:"textarea",rows:16,placeholder:"请输入要转换为语音的文本",disabled:u.value,onBlur:fe},null,8,["modelValue","disabled"])]),l("div",Xs,[t[22]||(t[22]=l("h4",{class:"text-sm font-semibold"},"参数设置",-1)),l("div",Zs,[l("div",en,[t[19]||(t[19]=l("label",{class:"text-xs text-gray-600"},"发音人/音色",-1)),a(xe,{modelValue:j.value,"onUpdate:modelValue":t[1]||(t[1]=P=>j.value=P),size:"small",placeholder:"请选择音色（可选）",clearable:"",disabled:u.value,onChange:ge,class:"w-full"},{default:s(()=>[a(ze,{label:"灿灿",value:"cosyvoice-v3-plus-leo-34ba9eaebae44039a4a9426af6389dcd"})]),_:1},8,["modelValue","disabled"])]),l("div",tn,[t[20]||(t[20]=l("label",{class:"text-xs text-gray-600"},"语速",-1)),a($e,{modelValue:Q.value,"onUpdate:modelValue":t[2]||(t[2]=P=>Q.value=P),size:"small",min:.5,max:2,step:.1,precision:1,disabled:u.value,onChange:_,class:"w-full"},null,8,["modelValue","disabled"])]),l("div",ln,[t[21]||(t[21]=l("label",{class:"text-xs text-gray-600"},"音量",-1)),a($e,{modelValue:X.value,"onUpdate:modelValue":t[3]||(t[3]=P=>X.value=P),size:"small",min:0,max:100,step:1,disabled:u.value,onChange:_,class:"w-full"},null,8,["modelValue","disabled"])])])]),l("div",an,[u.value?(i(),E(x,K({key:1,type:"warning"},p,{onClick:Me,class:"w-full"}),{default:s(()=>[...t[24]||(t[24]=[T(" 停止生成 ",-1)])]),_:1},16)):(i(),E(re,{key:0,content:$.value.trim()?"":"请先输入文本内容",disabled:!!$.value.trim(),placement:"top"},{default:s(()=>[a(x,K({type:"success"},p,{onClick:Fe,disabled:g.value,class:"w-full"}),{default:s(()=>[...t[23]||(t[23]=[T(" 开始生成 ",-1)])]),_:1},16,["disabled"])]),_:1},8,["content","disabled"]))])])])):(i(),v("div",sn,[...t[25]||(t[25]=[l("div",{class:"flex items-center justify-between mb-3 flex-shrink-0"},[l("h3",{class:"text-base font-semibold"},"任务详情")],-1),l("div",{class:"flex-1 flex items-center justify-center text-sm text-gray-400"}," 请从左侧选择一个任务查看详情 ",-1)])])),a(Qe,{modelValue:I.value,"onUpdate:modelValue":t[6]||(t[6]=P=>I.value=P),title:"创建 TTS 任务",width:"500px",onClose:ie},{footer:s(()=>[a(x,{onClick:t[5]||(t[5]=P=>I.value=!1)},{default:s(()=>[...t[26]||(t[26]=[T("取消",-1)])]),_:1}),a(x,{type:"primary",onClick:ae,loading:c.value},{default:s(()=>[...t[27]||(t[27]=[T(" 确定 ",-1)])]),_:1},8,["loading"])]),default:s(()=>[a(it,null,{default:s(()=>[a(rt,{label:"任务名称"},{default:s(()=>[a(ve,{modelValue:M.value,"onUpdate:modelValue":t[4]||(t[4]=P=>M.value=P),placeholder:"请输入任务名称",onKeyup:Ne(ae,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Qe,{modelValue:R.value,"onUpdate:modelValue":t[9]||(t[9]=P=>R.value=P),title:"重命名任务",width:"400px",onClose:t[10]||(t[10]=P=>C.value="")},{footer:s(()=>[a(x,{onClick:t[8]||(t[8]=P=>R.value=!1)},{default:s(()=>[...t[28]||(t[28]=[T("取消",-1)])]),_:1}),a(x,{type:"primary",onClick:he,loading:c.value},{default:s(()=>[...t[29]||(t[29]=[T(" 确定 ",-1)])]),_:1},8,["loading"])]),default:s(()=>[a(it,null,{default:s(()=>[a(rt,{label:"任务名称"},{default:s(()=>[a(ve,{modelValue:C.value,"onUpdate:modelValue":t[7]||(t[7]=P=>C.value=P),placeholder:"请输入任务名称",onKeyup:Ne(he,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Qe,{modelValue:G.value,"onUpdate:modelValue":t[12]||(t[12]=P=>G.value=P),title:y.value,width:"90%","align-center":"",onClose:t[13]||(t[13]=P=>L.value=-1)},{footer:s(()=>[l("div",rn,[l("div",un,[a(x,{onClick:Be,disabled:L.value<=0,size:"small"},{default:s(()=>[...t[30]||(t[30]=[T(" 上一张 ",-1)])]),_:1},8,["disabled"]),l("span",dn,w(L.value+1)+" / "+w(O.value.length),1),a(x,{onClick:Le,disabled:L.value>=O.value.length-1,size:"small"},{default:s(()=>[...t[31]||(t[31]=[T(" 下一张 ",-1)])]),_:1},8,["disabled"])]),a(x,{type:"danger",onClick:t[11]||(t[11]=P=>Ee(L.value)),size:"small"},{default:s(()=>[...t[32]||(t[32]=[T(" 删除 ",-1)])]),_:1})])]),default:s(()=>[l("div",nn,[L.value>=0&&O.value[L.value]?(i(),v("img",{key:0,src:Te(L.value),alt:O.value[L.value].name,class:"max-w-full max-h-[70vh] object-contain"},null,8,on)):U("",!0)])]),_:1},8,["modelValue","title"])])}}}),fn={class:"p-1"},Tn=Ke({__name:"index",setup(Ie){const c=k("tts_tool"),S=e=>{console.log("切换到页签:",e)};return(e,I)=>{const M=Ot,V=jt;return i(),v("div",fn,[a(V,{modelValue:c.value,"onUpdate:modelValue":I[0]||(I[0]=R=>c.value=R),onTabChange:S,class:"flex-1 flex flex-col overflow-hidden h-[calc(100vh-150px)]"},{default:s(()=>[a(M,{label:"TTS",name:"tts_tool"},{default:s(()=>[a(cn)]),_:1}),a(M,{label:"PDF 工具",name:"pdf_tool"},{default:s(()=>[a(Nl)]),_:1}),a(M,{label:"音频合成",name:"audio_merge"},{default:s(()=>[a(Sa)]),_:1}),a(M,{label:"音频转码",name:"audio_convert"},{default:s(()=>[a(Cs)]),_:1})]),_:1},8,["modelValue"])])}}});export{Tn as default};
