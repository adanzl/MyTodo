const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/Home-Bmc2J0oX.js","assets/js/user-DIbMp7Ki.js","assets/js/utils-C11zrYka.js","assets/js/date-SVbh1ddk.js","assets/js/element-plus-BqLbxx0O.js","assets/js/vue-vendor-DxceCm8D.js","assets/js/vendor-DiwfJ622.js","assets/css/element-plus-CD3B3G1X.css","assets/js/vant-DyMlv9MZ.js","assets/css/vant-DzKo5b93.css","assets/js/Lottery-jU4eU9Im.js","assets/js/rds-DLGzeFqC.js","assets/js/Info-oCVOcB7E.js","assets/js/Chat-ApA5jUqB.js","assets/js/socket-DV2CFXI2.js","assets/css/Chat-CFJ2rmy2.css","assets/js/Score-CMYGFyZ1.js","assets/js/Timetable-Cmo_a974.js","assets/js/index-DzktbU0l.js","assets/js/useInterval-_JCymJaY.js","assets/css/useInterval-BJh958RX.css","assets/js/index-bV8G5sGl.js"])))=>i.map(i=>d[i]);
import{br as H,r as P,c as S,m as V,bs as W,bt as z,o as L,q as h,Q as n,a1 as s,O as A,M as J,u as m,ae as b,bu as K,bv as Q,bw as Y,bh as G,bx as X,by as Z,bz as ee,bA as te,bB as ne,A as j,t as se,ao as oe,W as ae,N as re,aF as le,bC as N,bD as ie,bE as ue,bl as ce,bF as de}from"./vue-vendor-DxceCm8D.js";import{n as fe,q as _e,C as pe}from"./utils-C11zrYka.js";import{E as D,a as me,b as B,d as q,e as ge,f as ve,g as F,h as be,i as Ee,j as ye,k as he,l as we,m as Le,n as xe,o as Ie,p as Ce}from"./element-plus-BqLbxx0O.js";import{s as Pe}from"./vant-DyMlv9MZ.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function l(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(o){if(o.ep)return;o.ep=!0;const i=l(o);fetch(o.href,i)}})();const $={enableInDev:!0,enableDebugInDev:!1,enableErrorInProd:!0},O={debug:(...e)=>{},info:(...e)=>{},warn:(...e)=>{},error:(...e)=>{$.enableErrorInProd&&console.error("[ERROR]",...e)},configure:e=>{Object.assign($,e)}};function w(e,t,l={}){const{context:a}=l,o=a?`${t} (${a})`:t;O.error(o,e);const r=e?.response?.data?.msg||e?.message||"未知错误";D.error(`${t}: ${r}`)}const Ue={url:"https://leo-zhao.natapp4.cc/"},C=Ue.url,Ae=C.endsWith("/api")?C:C.endsWith("/")?`${C}api`:`${C}/api`;function Ye(){return C}const U=fe.create({baseURL:Ae,timeout:3e4});U.interceptors.request.use(e=>(O.debug("API Request:",e.method?.toUpperCase(),e.url,e.params||e.data),e),e=>(O.error("API Request Error:",e),Promise.reject(e)));U.interceptors.response.use(e=>{if(e.data&&typeof e.data=="object"&&"code"in e.data&&e.data.code!==0){const t=new Error(e.data.msg||"请求失败");return t.response=e,Promise.reject(t)}return e},e=>{if(e.response){const t=e.response.status,a=e.response.data?.msg||`请求失败 (${t})`;t>=500?w(e,"服务器错误",{context:"API"}):t===404?w(e,"资源未找到",{context:"API"}):t===403?w(e,"无权限访问",{context:"API"}):t===401?w(e,"未授权，请重新登录",{context:"API"}):w(e,a,{context:"API"})}else e.request?w(e,"网络错误，请检查网络连接",{context:"API"}):w(e,"请求配置错误",{context:"API"});return Promise.reject(e)});async function Se(e,t,l,a){const o={table:e};return t&&(o.conditions=JSON.stringify(t)),l&&(o.pageNum=l),a&&(o.pageSize=a),(await U.get("/getAll",{params:o})).data}async function Ge(e,t,l){const a={table:e,id:t};return(await U.get("/getData",{params:a})).data.data}async function Xe(e,t){return t.id===-1&&(t.id=null),(await U.post("/setData",{table:e,data:t})).data.data}async function Ze(e,t){return(await U.post("/delData",{table:e,id:t})).data.data}const T=H("user",()=>{const e=P([]),t=P(!1),l=P(null),a=P({bLogin:!1,id:null,name:null,ico:null}),o=300*1e3,i="user_id",r=g=>e.value.find(v=>String(v.id)===String(g)),p=S(()=>l.value?Date.now()-l.value<o:!1),u=S(()=>a.value.bLogin),c=async(g=!1)=>{if(!(!g&&p.value&&e.value.length>0)){t.value=!0;try{const v=await Se("t_user");v&&v.data?(e.value=v.data.data||[],l.value=Date.now()):e.value=[]}catch(v){console.error("获取用户列表失败:",v),D.error("获取用户列表失败"),e.value=[]}finally{t.value=!1}}},_=()=>{l.value=null},d=g=>{a.value={bLogin:!0,id:g.id,name:g.name,ico:g.icon||null},localStorage.setItem(i,String(g.id))};return{userList:e,loading:t,lastFetchTime:l,curUser:a,getUserById:r,isDataFresh:p,isLoggedIn:u,refreshUserList:c,clearCache:_,setCurUser:d,clearCurUser:()=>{a.value={bLogin:!1,id:null,name:null,ico:null},localStorage.removeItem(i)},restoreCurUser:async()=>{const g=localStorage.getItem(i);if(g){e.value.length===0&&await c();const v=r(g);v&&d(v)}},getCurUserFullInfo:()=>a.value.id&&r(a.value.id)||null}}),De={class:"flex justify-between items-center p-5"},Re=V({__name:"Sidebar",setup(e){const t=W(),l=z(),a=T(),o=P(!1),i=()=>{},r=()=>{a.clearCurUser(),t.push("/")};return(p,u)=>{const c=B,_=q,d=F,f=ve,x=be,I=ge,g=Ee,v=me;return h(),L(v,{width:"200px",class:"w-48"},{default:n(()=>[s(g,null,{default:n(()=>[A("div",De,[s(c,{src:m(a).curUser.ico},null,8,["src"]),m(a).curUser.bLogin?(h(),L(_,{key:0,onClick:r,size:"small"},{default:n(()=>[...u[0]||(u[0]=[b(" 注销 ",-1)])]),_:1})):J("",!0)]),s(I,{"default-active":m(l).path,collapse:o.value,"unique-opened":"",router:""},{default:n(()=>[s(f,{index:"/home",onClick:i},{title:n(()=>[...u[1]||(u[1]=[b("Home",-1)])]),default:n(()=>[s(d,null,{default:n(()=>[s(m(K))]),_:1})]),_:1}),s(x,{index:"mytodo"},{title:n(()=>[s(d,null,{default:n(()=>[s(m(Z))]),_:1}),u[2]||(u[2]=A("span",null,"MyTodo",-1))]),default:n(()=>[s(f,{index:"/lottery",onClick:i},{title:n(()=>[...u[3]||(u[3]=[b("抽奖设置",-1)])]),default:n(()=>[s(d,null,{default:n(()=>[s(m(Q))]),_:1})]),_:1}),s(f,{index:"/chat"},{title:n(()=>[...u[4]||(u[4]=[b("Chat",-1)])]),default:n(()=>[s(d,null,{default:n(()=>[s(m(Y))]),_:1})]),_:1}),s(f,{index:"/info"},{title:n(()=>[...u[5]||(u[5]=[b("Info",-1)])]),default:n(()=>[s(d,null,{default:n(()=>[s(m(G))]),_:1})]),_:1}),s(f,{index:"/score"},{title:n(()=>[...u[6]||(u[6]=[b("Score",-1)])]),default:n(()=>[s(d,null,{default:n(()=>[s(m(X))]),_:1})]),_:1})]),_:1}),s(f,{index:"/timetable"},{title:n(()=>[...u[7]||(u[7]=[b("课程表",-1)])]),default:n(()=>[s(d,null,{default:n(()=>[s(m(ee))]),_:1})]),_:1}),s(f,{index:"/media"},{title:n(()=>[...u[8]||(u[8]=[b("媒体",-1)])]),default:n(()=>[s(d,null,{default:n(()=>[s(m(te))]),_:1})]),_:1}),s(f,{index:"/tools"},{title:n(()=>[...u[9]||(u[9]=[b("工具",-1)])]),default:n(()=>[s(d,null,{default:n(()=>[s(m(ne))]),_:1})]),_:1})]),_:1},8,["default-active","collapse"])]),_:1})]),_:1})}}}),M=(e,t)=>{const l=e.__vccOpts||e;for(const[a,o]of t)l[a]=o;return l},Oe=M(Re,[["__scopeId","data-v-828d8ef1"]]),Ve={class:"flex flex-col gap-2 items-center"},Te={class:"flex items-center border-b-1 border-gray-200"},Me={class:"pl-4 text-base text-gray-500"},Ne=V({__name:"Login",emits:["login-success"],setup(e,{emit:t}){const l=t,a=T(),o=S(()=>a.userList),i=S(()=>a.loading),r=P({id:null,password:""}),p=async()=>{await a.refreshUserList(),o.value.length===0&&D.warning("用户列表为空，请检查数据库")},u=async()=>{if(!r.value.id)return;const c=_e(o.value,{id:r.value.id});c&&(c.pwd===null||c.pwd===pe.MD5(r.value.password).toString())?(a.setCurUser(c),l("login-success",{id:c.id,name:c.name,icon:c.icon})):D.error("用户名或密码错误")};return j(async()=>{await p()}),(c,_)=>{const d=B,f=he,x=we,I=Le,g=q,v=ye;return h(),L(v,{class:"w-[480px]",shadow:"always"},{header:n(()=>[..._[2]||(_[2]=[b("用户登录",-1)])]),default:n(()=>[A("div",Ve,[s(x,{modelValue:r.value.id,"onUpdate:modelValue":_[0]||(_[0]=E=>r.value.id=E),placeholder:"请选择用户",class:"!w-60",loading:i.value,"loading-text":"加载用户列表中...",disabled:i.value},{default:n(()=>[(h(!0),se(re,null,oe(o.value,E=>(h(),L(f,{class:"!h-13",key:E.id,label:E.name,value:E.id},{default:n(()=>[A("div",Te,[s(d,{class:"!h-10 !w-10",src:E.icon},null,8,["src"]),A("div",Me,ae(E.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","loading","disabled"]),s(I,{modelValue:r.value.password,"onUpdate:modelValue":_[1]||(_[1]=E=>r.value.password=E),style:{width:"240px"},type:"password",placeholder:"Password","show-password":""},null,8,["modelValue"]),s(g,{type:"primary",size:"large",class:"w-24 h-24 mt-4",disabled:!r.value.id,onClick:u},{default:n(()=>[..._[3]||(_[3]=[b(" Login ",-1)])]),_:1},8,["disabled"])])]),_:1})}}}),$e=M(Ne,[["__scopeId","data-v-d12c731f"]]),ke=V({__name:"App",setup(e){const t=T(),l=a=>{const o=t.getUserById(a.id);o?t.setCurUser(o):(console.warn("用户信息未找到，使用传入的信息"),t.setCurUser({id:a.id,name:a.name,icon:a.icon}))};return j(async()=>{await t.refreshUserList(),await t.restoreCurUser()}),(a,o)=>{const i=F,r=Ie,p=le("router-view"),u=Ce,c=xe;return h(),L(c,{loading:m(t).loading,class:"h-screen"},{default:n(()=>[s(Oe),m(t).curUser.bLogin?(h(),L(c,{key:0},{default:n(()=>[s(r,{class:"flex justify-center items-center bg-blue-50"},{default:n(()=>[s(i,null,{default:n(()=>[s(m(N))]),_:1}),o[0]||(o[0]=b(" 哈哈哈 ",-1)),s(i,null,{default:n(()=>[s(m(N))]),_:1})]),_:1}),s(u,null,{default:n(()=>[s(p)]),_:1})]),_:1})):(h(),L(c,{key:1},{default:n(()=>[s(u,{class:"bg-blue-100 !flex justify-center items-center"},{default:n(()=>[s($e,{onLoginSuccess:l})]),_:1})]),_:1}))]),_:1},8,["loading"])}}}),je=M(ke,[["__scopeId","data-v-e86d366f"]]),Be="modulepreload",qe=function(e){return"/web/"+e},k={},y=function(t,l,a){let o=Promise.resolve();if(l&&l.length>0){let u=function(c){return Promise.all(c.map(_=>Promise.resolve(_).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),p=r?.nonce||r?.getAttribute("nonce");o=u(l.map(c=>{if(c=qe(c),c in k)return;k[c]=!0;const _=c.endsWith(".css"),d=_?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const f=document.createElement("link");if(f.rel=_?"stylesheet":Be,_||(f.as="script"),f.crossOrigin="",f.href=c,p&&f.setAttribute("nonce",p),document.head.appendChild(f),_)return new Promise((x,I)=>{f.addEventListener("load",x),f.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(r){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=r,window.dispatchEvent(p),!p.defaultPrevented)throw r}return o.then(r=>{for(const p of r||[])p.status==="rejected"&&i(p.reason);return t().catch(i)})},Fe=[{path:"/",redirect:"/home"},{path:"/home",name:"Home",component:()=>y(()=>import("./Home-Bmc2J0oX.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))},{path:"/lottery",name:"Lottery",component:()=>y(()=>import("./Lottery-jU4eU9Im.js"),__vite__mapDeps([10,5,2,4,6,7,11,8,9]))},{path:"/info",name:"Info",component:()=>y(()=>import("./Info-oCVOcB7E.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,8,9]))},{path:"/chat",name:"Chat",component:()=>y(()=>import("./Chat-ApA5jUqB.js"),__vite__mapDeps([13,5,2,4,6,7,14,11,8,9,15]))},{path:"/score",name:"Score",component:()=>y(()=>import("./Score-CMYGFyZ1.js"),__vite__mapDeps([16,5,2,4,6,7,8,9]))},{path:"/timetable",name:"Timetable",component:()=>y(()=>import("./Timetable-Cmo_a974.js"),__vite__mapDeps([17,5,2,4,6,7,11,8,9]))},{path:"/media",name:"Media",component:()=>y(()=>import("./index-DzktbU0l.js"),__vite__mapDeps([18,5,2,4,6,7,19,20,3,11,8,9]))},{path:"/tools",name:"Tools",component:()=>y(()=>import("./index-bV8G5sGl.js"),__vite__mapDeps([21,5,2,4,6,7,19,20,8,9]))}],He=ie({history:ue(),routes:Fe}),R=ce(je),We=de();R.use(We);R.use(He);R.use(Pe);R.mount("#app");export{M as _,Ge as a,U as b,Ye as c,Ze as d,w as e,Se as g,O as l,Xe as s,T as u};
