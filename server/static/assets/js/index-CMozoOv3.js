const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/Home-CjpzZY7h.js","assets/js/api-shared-Cud_9YyQ.js","assets/js/utils-C3h80Bc3.js","assets/js/types-shared-D7b4dn-C.js","assets/js/utils-shared-CndaLcYB.js","assets/js/element-plus-DeIauL_s.js","assets/js/vue-vendor-BHHKG5q1.js","assets/js/vendor-ClcY5Lvr.js","assets/css/element-plus-CD3B3G1X.css","assets/js/vant-Dc30gN_b.js","assets/css/vant-DzKo5b93.css","assets/js/Lottery-IWak0kT-.js","assets/js/Info-C8cGuWJ4.js","assets/js/Chat-CX9BdB5h.js","assets/js/socket-8tMGIvbH.js","assets/css/Chat-CFJ2rmy2.css","assets/js/Score-DfR25oIn.js","assets/js/Timetable-Du7FEa7Z.js","assets/js/index-B6UWfNxI.js","assets/js/useInterval-CJygNucu.js","assets/css/useInterval-BJh958RX.css","assets/js/constants-shared-hfZtc6Y5.js","assets/js/index-BR9v0oey.js"])))=>i.map(i=>d[i]);
import{av as B,r as S,c as x,j as A,aw as j,ax as F,l as w,o as b,G as e,Q as t,s as U,D as $,u as p,$ as y,t as T,n as H,a6 as q,J as z,F as J,ae as K,ay as W,az as G,ar as Q,aA as Y}from"./vue-vendor-BHHKG5q1.js";import{E as P,a as X,b as k,c as M,d as Z,e as ee,f as N,h as te,g as oe,p as ne,m as se,i as le,s as re,j as ae,k as ie,l as ue,n as ce,o as de,q as _e,r as fe,t as me,u as pe,v as ve,w as ge,x as D,y as ye}from"./element-plus-DeIauL_s.js";import{b as he}from"./api-shared-Cud_9YyQ.js";import{u as Ee,C as be}from"./utils-C3h80Bc3.js";import{s as we}from"./vant-Dc30gN_b.js";import"./vendor-ClcY5Lvr.js";import"./types-shared-D7b4dn-C.js";import"./utils-shared-CndaLcYB.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function u(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=u(o);fetch(o.href,a)}})();const O=B("user",()=>{const f=S([]),i=S(!1),u=S(null),r=S({bLogin:!1,id:null,name:null,ico:null}),o=300*1e3,a="user_id",s=v=>f.value.find(g=>String(g.id)===String(v)),m=x(()=>u.value?Date.now()-u.value<o:!1),n=x(()=>r.value.bLogin),l=async(v=!1)=>{if(!(!v&&m.value&&f.value.length>0)){i.value=!0;try{const g=await he("t_user");g&&g.data?(f.value=g.data.data||[],u.value=Date.now()):f.value=[]}catch(g){console.error("获取用户列表失败:",g),P.error("获取用户列表失败"),f.value=[]}finally{i.value=!1}}},_=()=>{u.value=null},c=v=>{r.value={bLogin:!0,id:v.id,name:v.name,ico:v.icon||null},localStorage.setItem(a,String(v.id))};return{userList:f,loading:i,lastFetchTime:u,curUser:r,getUserById:s,isDataFresh:m,isLoggedIn:n,refreshUserList:l,clearCache:_,setCurUser:c,clearCurUser:()=>{r.value={bLogin:!1,id:null,name:null,ico:null},localStorage.removeItem(a)},restoreCurUser:async()=>{const v=localStorage.getItem(a);if(v){f.value.length===0&&await l();const g=s(v);g&&c(g)}},getCurUserFullInfo:()=>r.value.id&&s(r.value.id)||null}}),Le={class:"flex justify-between items-center p-5"},Ce=A({__name:"Sidebar",setup(f){const i=j(),u=F(),r=O(),o=S(!1),a=()=>{},s=()=>{r.clearCurUser(),i.push("/")};return(m,n)=>{const l=k,_=M,c=N,d=ee,L=oe,C=Z,v=de,g=X;return b(),w(g,{width:"200px",class:"w-48"},{default:e(()=>[t(v,null,{default:e(()=>[U("div",Le,[t(l,{src:p(r).curUser.ico},null,8,["src"]),p(r).curUser.bLogin?(b(),w(_,{key:0,onClick:s,size:"small"},{default:e(()=>[...n[0]||(n[0]=[y(" 注销 ",-1)])]),_:1})):$("",!0)]),t(C,{"default-active":p(u).path,collapse:o.value,"unique-opened":"",router:""},{default:e(()=>[t(d,{index:"/home",onClick:a},{title:e(()=>[...n[1]||(n[1]=[y("Home",-1)])]),default:e(()=>[t(c,null,{default:e(()=>[t(p(te))]),_:1})]),_:1}),t(L,{index:"mytodo"},{title:e(()=>[t(c,null,{default:e(()=>[t(p(ae))]),_:1}),n[2]||(n[2]=U("span",null,"MyTodo",-1))]),default:e(()=>[t(d,{index:"/lottery",onClick:a},{title:e(()=>[...n[3]||(n[3]=[y("抽奖设置",-1)])]),default:e(()=>[t(c,null,{default:e(()=>[t(p(ne))]),_:1})]),_:1}),t(d,{index:"/chat"},{title:e(()=>[...n[4]||(n[4]=[y("Chat",-1)])]),default:e(()=>[t(c,null,{default:e(()=>[t(p(se))]),_:1})]),_:1}),t(d,{index:"/info"},{title:e(()=>[...n[5]||(n[5]=[y("Info",-1)])]),default:e(()=>[t(c,null,{default:e(()=>[t(p(le))]),_:1})]),_:1}),t(d,{index:"/score"},{title:e(()=>[...n[6]||(n[6]=[y("Score",-1)])]),default:e(()=>[t(c,null,{default:e(()=>[t(p(re))]),_:1})]),_:1})]),_:1}),t(d,{index:"/timetable"},{title:e(()=>[...n[7]||(n[7]=[y("课程表",-1)])]),default:e(()=>[t(c,null,{default:e(()=>[t(p(ie))]),_:1})]),_:1}),t(d,{index:"/media"},{title:e(()=>[...n[8]||(n[8]=[y("媒体",-1)])]),default:e(()=>[t(c,null,{default:e(()=>[t(p(ue))]),_:1})]),_:1}),t(d,{index:"/tools"},{title:e(()=>[...n[9]||(n[9]=[y("工具",-1)])]),default:e(()=>[t(c,null,{default:e(()=>[t(p(ce))]),_:1})]),_:1})]),_:1},8,["default-active","collapse"])]),_:1})]),_:1})}}}),V=(f,i)=>{const u=f.__vccOpts||f;for(const[r,o]of i)u[r]=o;return u},Se=V(Ce,[["__scopeId","data-v-828d8ef1"]]),Ue={class:"flex flex-col gap-2 items-center"},xe={class:"flex items-center border-b-1 border-gray-200"},Ie={class:"pl-4 text-base text-gray-500"},Pe=A({__name:"Login",emits:["login-success"],setup(f,{emit:i}){const u=i,r=O(),o=x(()=>r.userList),a=x(()=>r.loading),s=S({id:null,password:""}),m=async()=>{await r.refreshUserList(),o.value.length===0&&P.warning("用户列表为空，请检查数据库")},n=async()=>{if(!s.value.id)return;const l=Ee(o.value,{id:s.value.id});l&&(l.pwd===null||l.pwd===be.MD5(s.value.password).toString())?(r.setCurUser(l),u("login-success",{id:l.id,name:l.name,icon:l.icon})):P.error("用户名或密码错误")};return T(async()=>{await m()}),(l,_)=>{const c=k,d=fe,L=me,C=pe,v=M,g=_e;return b(),w(g,{class:"w-[480px]",shadow:"always"},{header:e(()=>[..._[2]||(_[2]=[y("用户登录",-1)])]),default:e(()=>[U("div",Ue,[t(L,{modelValue:s.value.id,"onUpdate:modelValue":_[0]||(_[0]=h=>s.value.id=h),placeholder:"请选择用户",class:"!w-60",loading:a.value,"loading-text":"加载用户列表中...",disabled:a.value},{default:e(()=>[(b(!0),H(J,null,q(o.value,h=>(b(),w(d,{class:"!h-13",key:h.id,label:h.name,value:h.id},{default:e(()=>[U("div",xe,[t(c,{class:"!h-10 !w-10",src:h.icon},null,8,["src"]),U("div",Ie,z(h.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","loading","disabled"]),t(C,{modelValue:s.value.password,"onUpdate:modelValue":_[1]||(_[1]=h=>s.value.password=h),style:{width:"240px"},type:"password",placeholder:"Password","show-password":""},null,8,["modelValue"]),t(v,{type:"primary",size:"large",class:"w-24 h-24 mt-4",disabled:!s.value.id,onClick:n},{default:e(()=>[..._[3]||(_[3]=[y(" Login ",-1)])]),_:1},8,["disabled"])])]),_:1})}}}),Ae=V(Pe,[["__scopeId","data-v-d12c731f"]]),Oe=A({__name:"App",setup(f){const i=O(),u=r=>{const o=i.getUserById(r.id);o?i.setCurUser(o):(console.warn("用户信息未找到，使用传入的信息"),i.setCurUser({id:r.id,name:r.name,icon:r.icon}))};return T(async()=>{await i.refreshUserList(),await i.restoreCurUser()}),(r,o)=>{const a=N,s=ge,m=K("router-view"),n=ye,l=ve;return b(),w(l,{loading:p(i).loading,class:"h-screen"},{default:e(()=>[t(Se),p(i).curUser.bLogin?(b(),w(l,{key:0},{default:e(()=>[t(s,{class:"flex justify-center items-center bg-blue-50"},{default:e(()=>[t(a,null,{default:e(()=>[t(p(D))]),_:1}),o[0]||(o[0]=y(" 哈哈哈 ",-1)),t(a,null,{default:e(()=>[t(p(D))]),_:1})]),_:1}),t(n,null,{default:e(()=>[t(m)]),_:1})]),_:1})):(b(),w(l,{key:1},{default:e(()=>[t(n,{class:"bg-blue-100 !flex justify-center items-center"},{default:e(()=>[t(Ae,{onLoginSuccess:u})]),_:1})]),_:1}))]),_:1},8,["loading"])}}}),Ve=V(Oe,[["__scopeId","data-v-e86d366f"]]),De="modulepreload",Re=function(f){return"/web/"+f},R={},E=function(i,u,r){let o=Promise.resolve();if(u&&u.length>0){let n=function(l){return Promise.all(l.map(_=>Promise.resolve(_).then(c=>({status:"fulfilled",value:c}),c=>({status:"rejected",reason:c}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),m=s?.nonce||s?.getAttribute("nonce");o=n(u.map(l=>{if(l=Re(l),l in R)return;R[l]=!0;const _=l.endsWith(".css"),c=_?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${c}`))return;const d=document.createElement("link");if(d.rel=_?"stylesheet":De,_||(d.as="script"),d.crossOrigin="",d.href=l,m&&d.setAttribute("nonce",m),document.head.appendChild(d),_)return new Promise((L,C)=>{d.addEventListener("load",L),d.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${l}`)))})}))}function a(s){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=s,window.dispatchEvent(m),!m.defaultPrevented)throw s}return o.then(s=>{for(const m of s||[])m.status==="rejected"&&a(m.reason);return i().catch(a)})},Te=[{path:"/",redirect:"/home"},{path:"/home",name:"Home",component:()=>E(()=>import("./Home-CjpzZY7h.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))},{path:"/lottery",name:"Lottery",component:()=>E(()=>import("./Lottery-IWak0kT-.js"),__vite__mapDeps([11,5,6,2,7,8,1,3,4]))},{path:"/info",name:"Info",component:()=>E(()=>import("./Info-C8cGuWJ4.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,8]))},{path:"/chat",name:"Chat",component:()=>E(()=>import("./Chat-CX9BdB5h.js"),__vite__mapDeps([13,6,5,2,7,8,14,1,3,4,9,10,15]))},{path:"/score",name:"Score",component:()=>E(()=>import("./Score-DfR25oIn.js"),__vite__mapDeps([16,5,6,2,7,8,1,3,4,9,10]))},{path:"/timetable",name:"Timetable",component:()=>E(()=>import("./Timetable-Du7FEa7Z.js"),__vite__mapDeps([17,6,5,2,7,8,1,3,4]))},{path:"/media",name:"Media",component:()=>E(()=>import("./index-B6UWfNxI.js"),__vite__mapDeps([18,6,4,5,2,7,8,1,3,19,20,21,9,10]))},{path:"/tools",name:"Tools",component:()=>E(()=>import("./index-BR9v0oey.js"),__vite__mapDeps([22,6,5,2,7,8,4,1,3,19,20,21,9,10]))}],ke=W({history:G(),routes:Te}),I=Q(Ve),Me=Y();I.use(Me);I.use(ke);I.use(we);I.mount("#app");export{V as _,O as u};
