import{j as ut,r as E,t as pt,n as p,s as n,M as ct,Q as c,J as $,G as m,D as I,F as C,a6 as S,o as u,$ as T,u as Z,I as tt,K as et,E as N,l as gt}from"./vue-vendor-BHHKG5q1.js";import{H as mt,c as bt,z as ft,f as xt,B as vt,Q as ht,W as ot,t as yt,u as _t,X as Tt,E as D,r as wt}from"./element-plus-DeIauL_s.js";import{d as kt,i as $t}from"./api-shared-Cud_9YyQ.js";import{l as A}from"./utils-shared-CndaLcYB.js";import"./utils-C3h80Bc3.js";import"./vendor-ClcY5Lvr.js";import"./types-shared-D7b4dn-C.js";const Ct={class:"p-1 max-w-7xl mx-auto"},zt={class:"flex justify-between items-center mb-6"},St={class:"text-sm text-gray-600 mt-1"},Et={class:"flex items-center space-x-4"},It={class:"overflow-x-auto"},Dt={class:"w-full border-collapse bg-white shadow-lg rounded-lg overflow-hidden"},Mt={class:"bg-gray-50"},Vt=["colspan"],jt={class:"bg-blue-50"},Ht={key:0,class:"border border-gray-200 px-1 py-1 text-center"},Nt={key:1,class:"border border-gray-200 px-1 py-1 text-center"},Ot={class:"border border-gray-200 px-2 py-2 text-center text-sm font-bold text-gray-600 bg-gray-50"},Bt={key:0,class:"border border-gray-200 relative",style:{height:"80px"}},Rt=["onClick"],Ut=["onClick","title"],At={class:"text-center p-2"},Ft={key:1,class:"border border-gray-200 relative",style:{height:"80px"}},Lt=["onClick"],Jt=["onClick","title"],Gt={class:"text-center p-2"},Qt={class:"bg-gray-50"},Wt=["colspan"],Kt={key:0,class:"text-center py-6 bg-blue-50 rounded-lg mt-4 border border-blue-200"},Pt={class:"flex items-center justify-center space-x-2 text-blue-600"},Xt={class:"mt-3 space-x-2"},qt={key:1,class:"text-center py-4 bg-gray-50 rounded-lg mt-4 border border-gray-200"},Yt={class:"flex items-center justify-center space-x-2 text-gray-600"},Zt={class:"text-sm"},te={class:"mt-3 space-x-2"},ee={class:"space-y-4"},oe={class:"flex space-x-2"},re=["onClick","title"],ne={class:"flex justify-end space-x-3"},ge=ut({__name:"Timetable",setup(le){const F={1:{bg:"bg-blue-300",border:"border-blue-400",hover:"hover:bg-blue-400"},2:{bg:"bg-green-300",border:"border-green-400",hover:"hover:bg-green-400"},3:{bg:"bg-purple-300",border:"border-purple-400",hover:"hover:bg-purple-400"},4:{bg:"bg-orange-300",border:"border-orange-400",hover:"hover:bg-orange-400"},5:{bg:"bg-pink-300",border:"border-pink-400",hover:"hover:bg-pink-400"}},v=E({}),h=E(!1),M=E(!1),y=E("all"),x=E({day:"",child:"zhaozhao",startTime:"",name:"",duration:10,colorId:1}),j=E(["周一","周二","周三","周四","周五","周六","周日"]),R=E([]);for(let e=8;e<=22;e++)R.value.push(`${e.toString().padStart(2,"0")}:00`);const L=E([]);for(let e=8;e<=22;e++)for(let t=0;t<60;t+=10)L.value.push(`${e.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`);const V=e=>{const t=e.colorId||1;return F[t]||F[1]},H=e=>{const[t,s]=e.startTime.split(":").map(Number);let l=s+e.duration,a=t;return l>=60&&(a+=Math.floor(l/60),l=l%60),`${a.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`},O=(e,t,s)=>{const l=`${e}-${t}`;return(v.value[l]||[]).filter(g=>{const b=g.startTime,f=H(g),k=`${s}:00`,_=`${s.split(":")[0]}:59`,w=new Date(`2000-01-01 ${b}`),o=new Date(`2000-01-01 ${f}`),d=new Date(`2000-01-01 ${k}`),r=new Date(`2000-01-01 ${_}`);return o>d&&w<=r||w<=d&&o>d}).sort((g,b)=>g.startTime.localeCompare(b.startTime))},J=(e,t)=>{const[s]=e.startTime.split(":").map(Number),l=parseInt(t.split(":")[0]);if(s!==l)return{display:"none"};const[a,i]=e.startTime.split(":").map(Number),g=i/60*100,b=e.duration/60*100;return{top:`${g}%`,height:`${b}%`,position:"absolute",width:"100%",zIndex:"10"}},G=(e,t)=>{const[s]=e.startTime.split(":").map(Number),l=parseInt(t.split(":")[0]);return s===l},rt=(e,t,s)=>{const l=`${e}-${t}`,a=v.value[l]||[],i=parseInt(s.split(":")[0]),g=a.filter(d=>{const r=parseInt(d.startTime.split(":")[0]),z=new Date(`2000-01-01 ${d.startTime}`);z.setMinutes(z.getMinutes()+d.duration);const Y=z.getHours();return r===i||r<i&&Y>=i}).sort((d,r)=>d.startTime.localeCompare(r.startTime));if(g.length===0)return`${i.toString().padStart(2,"0")}:00`;const b=g[0],f=parseInt(b.startTime.split(":")[0]);if(f>i||f===i&&b.startTime!==`${i.toString().padStart(2,"0")}:00`)return`${i.toString().padStart(2,"0")}:00`;let k=new Date(`2000-01-01 ${i.toString().padStart(2,"0")}:00`);for(const d of g){const r=new Date(`2000-01-01 ${d.startTime}`),z=new Date(`2000-01-01 ${d.startTime}`);if(z.setMinutes(z.getMinutes()+d.duration),k<r&&(r.getTime()-k.getTime())/6e4>=10){const it=k.getHours(),dt=k.getMinutes();return`${it.toString().padStart(2,"0")}:${dt.toString().padStart(2,"0")}`}k=new Date(z)}const _=g[g.length-1],w=new Date(`2000-01-01 ${_.startTime}`);w.setMinutes(w.getMinutes()+_.duration);const o=new Date(`2000-01-01 ${i.toString().padStart(2,"0")}:59`);if(w<o){const d=w.getHours(),r=w.getMinutes();return`${d.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`}return null},Q=(e,t,s)=>{const l=rt(e,t,s);if(l===null){D.warning("该小时块已无可用时间段");return}x.value={day:e,child:t,startTime:l,name:"",duration:30,colorId:1,originalStartTime:null},M.value=!0},W=(e,t,s)=>{const l=`${e}-${t}`,a=(v.value[l]||[]).find(i=>i.startTime===s);a&&(x.value={day:e,child:t,startTime:a.startTime,name:a.name,duration:a.duration,colorId:a.colorId||1,originalStartTime:a.startTime},M.value=!0)},K=e=>e&&(e.length>5?e.substring(0,5):e),nt=()=>{const{day:e,child:t,startTime:s,name:l,duration:a}=x.value;if(!l.trim()){D.warning("请输入课程名称");return}const i=`${e}-${t}`;v.value[i]||(v.value[i]=[]);const g=v.value[i],b=new Date(`2000-01-01 ${s}`),f=new Date(`2000-01-01 ${s}`);f.setMinutes(f.getMinutes()+a);for(const _ of g){if(x.value.originalStartTime&&_.startTime===x.value.originalStartTime)continue;const w=new Date(`2000-01-01 ${_.startTime}`),o=new Date(`2000-01-01 ${_.startTime}`);if(o.setMinutes(o.getMinutes()+_.duration),b<o&&f>w){D.error("课程时间冲突，请选择其他时间");return}}x.value.originalStartTime&&(v.value[i]=v.value[i].filter(_=>_.startTime!==x.value.originalStartTime));const k={startTime:K(s),name:l.trim(),duration:parseInt(a.toString()),colorId:x.value.colorId||1};v.value[i].push(k),M.value=!1},lt=()=>{const{day:e,child:t,startTime:s}=x.value,l=`${e}-${t}`;v.value[l]=(v.value[l]||[]).filter(a=>a.startTime!==s),M.value=!1,D.success("课程删除成功")},P=()=>{M.value=!1},U=async()=>{try{h.value=!0,await q(),D.success("课程表数据已重新加载！")}catch(e){A.error("重新加载失败:",e),D.error("重新加载失败，请重试")}finally{h.value=!1}},at=()=>{switch(y.value){case"zhaozhao":return"突出显示昭昭的课程";case"cancan":return"突出显示灿灿的课程";default:return"显示全部课程"}},B=()=>{let e=0;return Object.keys(v.value).forEach(t=>{(y.value==="all"||t.includes(y.value))&&(e+=v.value[t].length)}),e},st=async()=>{try{h.value=!0;const e=JSON.stringify(v.value);await $t("t_timetable",0,e),D.success("课程表保存成功！")}catch(e){A.error("保存失败:",e),D.error("保存失败，请重试")}finally{h.value=!1}},X=()=>{const e=document.createElement("div");e.innerHTML=`
    <div style="font-family: Arial, sans-serif; padding: 20px;">
      <h1 style="text-align: center; margin-bottom: 30px;">课程表</h1>
      <table style="width: 100%; border-collapse: collapse; border: 1px solid #000;">
        <thead>
          <tr style="background-color: #f5f5f5;">
            <th style="border: 1px solid #000; padding: 10px; text-align: center; font-weight: bold;">时间</th>
            <th style="border: 1px solid #000; padding: 10px; text-align: center; font-weight: bold;">周一</th>
            <th style="border: 1px solid #000; padding: 10px; text-align: center; font-weight: bold;">周二</th>
            <th style="border: 1px solid #000; padding: 10px; text-align: center; font-weight: bold;">周三</th>
            <th style="border: 1px solid #000; padding: 10px; text-align: center; font-weight: bold;">周四</th>
            <th style="border: 1px solid #000; padding: 10px; text-align: center; font-weight: bold;">周五</th>
            <th style="border: 1px solid #000; padding: 10px; text-align: center; font-weight: bold;">周六</th>
            <th style="border: 1px solid #000; padding: 10px; text-align: center; font-weight: bold;">周日</th>
          </tr>
          <tr style="background-color: #e8f4fd;">
            <th style="border: 1px solid #000; padding: 5px; text-align: center; font-size: 12px;"></th>
            <th style="border: 1px solid #000; padding: 5px; text-align: center; font-size: 12px;">昭昭</th>
            <th style="border: 1px solid #000; padding: 5px; text-align: center; font-size: 12px;">昭昭</th>
            <th style="border: 1px solid #000; padding: 5px; text-align: center; font-size: 12px;">昭昭</th>
            <th style="border: 1px solid #000; padding: 5px; text-align: center; font-size: 12px;">昭昭</th>
            <th style="border: 1px solid #000; padding: 5px; text-align: center; font-size: 12px;">昭昭</th>
            <th style="border: 1px solid #000; padding: 5px; text-align: center; font-size: 12px;">昭昭</th>
            <th style="border: 1px solid #000; padding: 5px; text-align: center; font-size: 12px;">昭昭</th>
          </tr>
          <tr style="background-color: #ffe8f8;">
            <th style="border: 1px solid #000; padding: 5px; text-align: center; font-size: 12px;"></th>
            <th style="border: 1px solid #000; padding: 5px; text-align: center; font-size: 12px;">灿灿</th>
            <th style="border: 1px solid #000; padding: 5px; text-align: center; font-size: 12px;">灿灿</th>
            <th style="border: 1px solid #000; padding: 5px; text-align: center; font-size: 12px;">灿灿</th>
            <th style="border: 1px solid #000; padding: 5px; text-align: center; font-size: 12px;">灿灿</th>
            <th style="border: 1px solid #000; padding: 5px; text-align: center; font-size: 12px;">灿灿</th>
            <th style="border: 1px solid #000; padding: 5px; text-align: center; font-size: 12px;">灿灿</th>
            <th style="border: 1px solid #000; padding: 5px; text-align: center; font-size: 12px;">灿灿</th>
          </tr>
        </thead>
        <tbody>
          ${R.value.map(s=>{const l=[s];return j.value.forEach(a=>{const i=O(a,"zhaozhao",s),g=O(a,"cancan",s);let b="";i.length>0&&(b+=i.map(f=>`${f.name} (${f.startTime}-${H(f)})`).join("<br>")),g.length>0&&(b&&(b+="<br>"),b+=g.map(f=>`${f.name} (${f.startTime}-${H(f)})`).join("<br>")),l.push(b||"")}),`
                <tr>
                  ${l.map((a,i)=>i===0?`<td style="border: 1px solid #000; padding: 8px; text-align: center; font-weight: bold; background-color: #f9f9f9;">${a}</td>`:`<td style="border: 1px solid #000; padding: 8px; text-align: left; vertical-align: top; min-height: 40px;">${a}</td>`).join("")}
                </tr>
              `}).join("")}
        </tbody>
      </table>
    </div>
  `;const t=window.open("","_blank");t&&(t.document.write(`
    <html>
      <head>
        <title>课程表</title>
        <style>
          body { margin: 0; padding: 20px; font-family: Arial, sans-serif; }
          @media print {
            body { margin: 0; }
            table { page-break-inside: auto; }
            tr { page-break-inside: avoid; page-break-after: auto; }
          }
        </style>
      </head>
      <body>
        ${e.innerHTML}
      </body>
    </html>
  `),t.document.close(),t.onload=()=>{t.print(),t.close()})},q=async()=>{try{h.value=!0;const e=await kt("t_timetable",0);if(e){const t=JSON.parse(e);Object.keys(t).forEach(s=>{Array.isArray(t[s])&&t[s].forEach(l=>{l.startTime&&(l.startTime=K(l.startTime)),l.colorId&&(l.colorId<1||l.colorId>5)&&(l.colorId=1)})}),v.value=t}}catch(e){A.error("加载数据失败:",e),v.value={}}finally{h.value=!1}};return pt(async()=>{await q()}),(e,t)=>{const s=ht,l=mt,a=bt,i=xt,g=wt,b=yt,f=_t,k=Tt,_=vt,w=ft;return u(),p("div",Ct,[n("div",zt,[n("div",null,[t[5]||(t[5]=n("h2",{class:"text-2xl font-bold text-gray-800"},"课程表",-1)),n("p",St," 当前显示: "+$(at())+" (共 "+$(B())+" 门课程) ",1)]),n("div",Et,[c(l,{modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=o=>y.value=o),size:"default"},{default:m(()=>[c(s,{value:"all"},{default:m(()=>[...t[6]||(t[6]=[T("全部",-1)])]),_:1}),c(s,{value:"zhaozhao"},{default:m(()=>[...t[7]||(t[7]=[T("昭昭",-1)])]),_:1}),c(s,{value:"cancan"},{default:m(()=>[...t[8]||(t[8]=[T("灿灿",-1)])]),_:1})]),_:1},8,["modelValue"]),c(a,{onClick:U,type:"info",loading:h.value,disabled:h.value},{default:m(()=>[T($(h.value?"加载中...":"重新加载"),1)]),_:1},8,["loading","disabled"]),c(a,{onClick:st,type:"primary",loading:h.value,disabled:h.value},{default:m(()=>[T($(h.value?"保存中...":"保存课程表"),1)]),_:1},8,["loading","disabled"])])]),ct((u(),p("div",It,[n("table",Dt,[n("thead",null,[n("tr",Mt,[t[9]||(t[9]=n("th",{class:"border border-gray-200 px-2 py-2 text-center font-semibold text-gray-700 min-w-20"}," 时间 ",-1)),(u(!0),p(C,null,S(j.value,o=>(u(),p("th",{key:o,class:"border border-gray-200 px-2 py-2 text-center font-semibold text-gray-700 min-w-32",colspan:y.value==="all"?2:1},$(o),9,Vt))),128))]),n("tr",jt,[t[12]||(t[12]=n("th",{class:"border border-gray-200 px-4 py-2 text-center"},null,-1)),(u(!0),p(C,null,S(j.value,o=>(u(),p(C,{key:o},[y.value==="all"||y.value==="zhaozhao"?(u(),p("th",Ht,[...t[10]||(t[10]=[n("div",{class:"text-xs text-gray-600 font-medium"},"昭昭",-1)])])):I("",!0),y.value==="all"||y.value==="cancan"?(u(),p("th",Nt,[...t[11]||(t[11]=[n("div",{class:"text-xs text-gray-600 font-medium"},"灿灿",-1)])])):I("",!0)],64))),128))])]),n("tbody",null,[(u(!0),p(C,null,S(R.value,o=>(u(),p("tr",{key:o,class:"hover:bg-gray-50"},[n("td",Ot,$(o),1),(u(!0),p(C,null,S(j.value,d=>(u(),p(C,{key:d},[y.value==="all"||y.value==="zhaozhao"?(u(),p("td",Bt,[n("div",{class:"w-full h-full bg-blue-50 rounded cursor-pointer hover:bg-blue-100 transition-colors relative",onClick:r=>Q(d,"zhaozhao",o)},[(u(!0),p(C,null,S(O(d,"zhaozhao",o),r=>(u(),p("div",{key:r.startTime,class:N(["absolute top-0 h-full rounded text-xs flex items-center justify-center cursor-pointer transition-colors",[V(r).bg,V(r).border,V(r).hover,{"border-dashed":r.duration>=60}]]),style:et([J(r,o),{"pointer-events":"auto","z-index":"10"}]),onClick:tt(z=>W(d,"zhaozhao",r.startTime),["stop"]),title:`${r.name} (${r.startTime}-${H(r)})`},[n("div",At,[G(r,o)?(u(),p("div",{key:0,class:N(["font-medium whitespace-pre-line leading-tight",{"text-xs":r.duration<=30,"text-sm":r.duration>30}])},$(r.name),3)):I("",!0)])],14,Ut))),128))],8,Rt)])):I("",!0),y.value==="all"||y.value==="cancan"?(u(),p("td",Ft,[n("div",{class:"w-full h-full bg-gray-50 rounded cursor-pointer hover:bg-pink-50 transition-colors relative",onClick:r=>Q(d,"cancan",o)},[(u(!0),p(C,null,S(O(d,"cancan",o),r=>(u(),p("div",{key:r.startTime,class:N(["absolute top-0 h-full rounded text-xs flex items-center justify-center cursor-pointer transition-colors",[V(r).bg,V(r).border,V(r).hover,{"border-dashed":r.duration>=60}]]),style:et([J(r,o),{"pointer-events":"auto","z-index":"10"}]),onClick:tt(z=>W(d,"cancan",r.startTime),["stop"]),title:`${r.name} (${r.startTime}-${H(r)})`},[n("div",Gt,[G(r,o)?(u(),p("div",{key:0,class:N(["font-medium whitespace-pre-line leading-tight",{"text-xs":r.duration<=30,"text-sm":r.duration>30}])},$(r.name),3)):I("",!0)])],14,Jt))),128))],8,Lt)])):I("",!0)],64))),128))]))),128))]),n("tfoot",null,[n("tr",Qt,[t[13]||(t[13]=n("th",{class:"border border-gray-200 px-2 py-2 text-center font-semibold text-gray-700 min-w-20"}," 时间 ",-1)),(u(!0),p(C,null,S(j.value,o=>(u(),p("th",{key:o,class:"border border-gray-200 px-2 py-2 text-center font-semibold text-gray-700 min-w-32",colspan:y.value==="all"?2:1},$(o),9,Wt))),128))])])]),B()===0&&!h.value?(u(),p("div",Kt,[n("div",Pt,[c(i,null,{default:m(()=>[c(Z(ot))]),_:1}),t[14]||(t[14]=n("span",{class:"text-sm"},"暂无课程数据，点击任意时间格子来添加课程",-1))]),n("div",Xt,[c(a,{type:"info",size:"small",onClick:U},{default:m(()=>[...t[15]||(t[15]=[T("重新加载",-1)])]),_:1}),c(a,{type:"info",size:"small",onClick:X},{default:m(()=>[...t[16]||(t[16]=[T("打印课程表",-1)])]),_:1})])])):I("",!0),B()>0&&!h.value?(u(),p("div",qt,[n("div",Yt,[c(i,null,{default:m(()=>[c(Z(ot))]),_:1}),n("span",Zt,"当前共有 "+$(B())+" 门课程",1)]),n("div",te,[c(a,{type:"info",size:"small",onClick:U},{default:m(()=>[...t[17]||(t[17]=[T("重新加载",-1)])]),_:1}),c(a,{type:"info",size:"small",onClick:X},{default:m(()=>[...t[18]||(t[18]=[T("打印课程表",-1)])]),_:1})])])):I("",!0)])),[[w,h.value]]),c(_,{modelValue:M.value,"onUpdate:modelValue":t[4]||(t[4]=o=>M.value=o),title:"编辑课程",width:"500px","before-close":P,center:""},{footer:m(()=>[n("div",ne,[c(a,{onClick:lt,type:"danger",size:"default"},{default:m(()=>[...t[23]||(t[23]=[T(" 删除课程 ",-1)])]),_:1}),c(a,{onClick:P,size:"default"},{default:m(()=>[...t[24]||(t[24]=[T(" 取消 ",-1)])]),_:1}),c(a,{onClick:nt,type:"primary",size:"default"},{default:m(()=>[...t[25]||(t[25]=[T(" 保存 ",-1)])]),_:1})])]),default:m(()=>[n("div",ee,[n("div",null,[t[19]||(t[19]=n("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"开始时间:",-1)),c(b,{modelValue:x.value.startTime,"onUpdate:modelValue":t[1]||(t[1]=o=>x.value.startTime=o),placeholder:"请选择开始时间",filterable:"",class:"w-full"},{default:m(()=>[(u(!0),p(C,null,S(L.value,o=>(u(),gt(g,{key:o,label:o,value:o},{default:m(()=>[T($(o),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),n("div",null,[t[20]||(t[20]=n("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"课程名称:",-1)),c(f,{modelValue:x.value.name,"onUpdate:modelValue":t[2]||(t[2]=o=>x.value.name=o),placeholder:"请输入课程名称",type:"textarea",rows:3,clearable:""},null,8,["modelValue"])]),n("div",null,[t[21]||(t[21]=n("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"持续时间(分钟):",-1)),c(k,{modelValue:x.value.duration,"onUpdate:modelValue":t[3]||(t[3]=o=>x.value.duration=o),min:10,step:10,max:240,placeholder:"10",class:"w-full"},null,8,["modelValue"])]),n("div",null,[t[22]||(t[22]=n("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"课程颜色:",-1)),n("div",oe,[(u(),p(C,null,S({1:"蓝色",2:"绿色",3:"紫色",4:"橙色",5:"粉色"},(o,d)=>n("div",{key:d,class:N(["w-8 h-8 rounded-full border-2 cursor-pointer transition-all",[parseInt(d)===x.value.colorId?"border-gray-800 scale-110":"border-gray-300",V({colorId:parseInt(d)}).bg]]),onClick:r=>x.value.colorId=parseInt(d),title:o},null,10,re)),64))])])])]),_:1},8,["modelValue"])])}}});export{ge as default};
