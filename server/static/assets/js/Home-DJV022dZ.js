import{s as D,h as A}from"./api-shared-DHR2pBqQ.js";import{u as L}from"./index-CF0R6bEv.js";import{A as N,B as I,C as $,D as M,b as P,F as T,u as F,c as W,E as c}from"./element-plus-Cmtfo66s.js";import{j,c as _,r as z,t as G,n as f,M as H,Q as t,l as J,G as o,o as p,$ as m,s as w,D as O,J as b}from"./vue-vendor-C-hNZ0TW.js";import"./utils-Dtqx8Ray.js";import"./types-shared-CiUQVXWn.js";import"./utils-shared-B2b8bsxo.js";import"./vant-7Cqjo8an.js";import"./vendor-4xlYshH7.js";const Q={class:""},q={key:0},K={class:"flex mt-4"},re=j({__name:"Home",setup(R){const n=L(),g=_(()=>n.userList),h=_(()=>n.loading),a=z({visible:!1,data:null,value:0}),i=async()=>{await n.refreshUserList()},V=async r=>{try{const e={id:r.id,score:r.score};await D(e.id,e.score),console.log("update user",e),await i()}catch(e){console.error("更新用户失败:",e),c.error("更新用户失败")}},y=r=>{a.value.visible=!0,a.value.data=r},C=async()=>{if(!a.value.data){c.warning("请选择用户");return}try{await A(a.value.data.id,"pcAdmin",a.value.value,"管理后台变更"),await i(),a.value.visible=!1,a.value.value=0}catch(r){console.error("添加积分失败:",r),c.error("添加积分失败")}},k=()=>{a.value.visible=!1,a.value.value=0};return G(async()=>{await i()}),(r,e)=>{const s=M,U=P,x=T,v=F,d=W,E=I,S=$,B=N;return p(),f("div",Q,[H((p(),J(E,{data:g.value,stripe:"",class:"w-full"},{default:o(()=>[t(s,{prop:"id",label:"ID",width:"80"}),t(s,{label:"Icon",width:"100"},{default:o(l=>[t(U,{src:l.row.icon},null,8,["src"])]),_:1}),t(s,{prop:"name",label:"Name",width:"100"}),t(s,{prop:"admin",label:"Admin",width:"100",class:"items-center text-center"}),t(s,{label:"WProgress",width:"120",class:"items-center text-center"},{default:o(({row:l})=>[t(x,{"text-inside":!0,"stroke-width":26,percentage:l.wish_progress},null,8,["percentage"])]),_:1}),t(s,{prop:"wish_list",label:"WList",width:"100",class:"items-center text-center"}),t(s,{prop:"score",label:"Score",width:"100"},{default:o(({row:l})=>[t(v,{modelValue:l.score,"onUpdate:modelValue":u=>l.score=u,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(s,{label:"Operations"},{default:o(({row:l})=>[t(d,{class:"w-16",onClick:u=>V(l),type:"primary"},{default:o(()=>[...e[3]||(e[3]=[m(" Update ",-1)])]),_:1},8,["onClick"]),t(d,{class:"w-16",onClick:u=>y(l)},{default:o(()=>[...e[4]||(e[4]=[m(" Score ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[B,h.value]]),t(S,{modelValue:a.value.visible,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.visible=l),title:"Change Score",width:"600","before-close":k},{default:o(()=>[e[6]||(e[6]=w("span",null,"输入的积分会作用在当前积分上，输入负数则会减少积分",-1)),a.value.data?(p(),f("div",q,b(a.value.data.name)+" 当前积分: "+b(a.value.data.score),1)):O("",!0),w("div",K,[t(v,{modelValue:a.value.value,"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.value=l),style:{width:"240px"},placeholder:"Please input"},null,8,["modelValue"]),t(d,{onClick:e[1]||(e[1]=l=>C()),class:"ml-2 w-16",type:"primary"},{default:o(()=>[...e[5]||(e[5]=[m(" Submit ",-1)])]),_:1})])]),_:1},8,["modelValue"])])}}});export{re as default};
