import{j as Ue,r as Y,v as Ne,l as ne,G as a,o as f,s as n,Q as l,$ as X,A as Jl,n as P,F as De,a6 as Ae,J as R,D as ie,u as o,E as Te,I as Fe,M as he,O as Pe,c as ue,q as Re,t as ot,y as At,e as tt,aa as kt}from"./vue-vendor-C-hNZ0TW.js";import{a as se,g as Xl,b as mt,d as Ke,f as ql,e as gt,h as it,l as Qe,n as lt,i as _t,j as Ql,k as Zl}from"./utils-shared-7Fi3rJBK.js";import{M as Tt,_ as Mt,u as Il,a as es}from"./useInterval-DM_5dcLl.js";import"./utils-BjcahYMR.js";import{m as qe,a as Ee,d as ts,i as ls,p as je}from"./api-shared-viHtHHjv.js";import{B as Ie,Y as ss,H as ns,u as pt,c as ze,E as _,Z as as,_ as is,$ as yt,a0 as Ye,f as Je,L as at,a1 as os,a2 as rs,a3 as ds,a4 as us,a5 as cs,a6 as Et,a7 as ht,a8 as Ze,m as bt,a9 as Ve,P as rt,aa as Lt,ab as xt,T as fs,ac as vs,J as Nt,ad as ms,ae as Xe,X as gs,t as Ut,z as wt,af as ps,r as zt,A as Vt,C as Ot,ag as Rt,ah as ys,ai as hs,aj as bs,ak as Be}from"./element-plus-Bd8o4DEb.js";import{M as xs,T as st,A as ws,D as Pt,a as Ge,W as nt,S as jt,b as $s,V as Ds,P as Cs}from"./constants-shared-BwcKRbUv.js";import"./index-ojxu2eSA.js";import"./vant-7Cqjo8an.js";import"./vendor-4xlYshH7.js";import"./types-shared-CGcc7HUC.js";const Fs={class:"space-y-4 m-4"},ks={class:"flex items-center gap-2"},_s={class:"flex items-center gap-2"},Ps={class:"flex items-center gap-2"},Ss={class:"flex items-center gap-2"},Bs={class:"flex items-center gap-2"},As={class:"flex items-center gap-2"},Ts={class:"border-t pt-4"},Ms={class:"flex gap-2"},Es={class:"border-t pt-4"},Ls={class:"space-y-2"},Ns={class:"flex items-center gap-2 flex-wrap"},Us=Ue({__name:"CronDialog",props:{visible:{type:Boolean,default:!1},initialCron:{default:""}},emits:["update:visible","apply","preview","close"],setup(e,{emit:B}){const c=e,p=B,L=Y(c.visible),i=Y({second:"*",secondCustom:"",minute:"*",minuteCustom:"",hour:"*",hourCustom:"",day:"*",dayCustom:"",month:"*",monthCustom:"",weekday:"*",weekdayCustom:"",generated:""}),s=v=>{v.second="*",v.secondCustom="",v.minute="*",v.minuteCustom="",v.hour="*",v.hourCustom="",v.day="*",v.dayCustom="",v.month="*",v.monthCustom="",v.weekday="*",v.weekdayCustom="",v.generated=""},m=(v,t)=>{try{if(!v||typeof v!="string"){s(t);return}const D=String(v).trim().split(/\s+/);let W,te,A,O,E,le;if(D.length===5){const[J,me,z,b,M]=D;J==="0"&&me&&me.startsWith("*/")?(W="0",te=me,A=z||"*",O=b||"*",E=M||"*",le="*"):(te=J,A=me,O=z,E=b,le=M,W="0")}else if(D.length===6)[W,te,A,O,E,le]=D;else{console.warn("Cron 表达式格式错误，部分数量:",D.length),s(t);return}D.length===5||D.length===6?(W==="*"?(t.second="*",t.secondCustom=""):W==="0"?(t.second="0",t.secondCustom=""):(t.second="custom",t.secondCustom=W),te==="*"?(t.minute="*",t.minuteCustom=""):te==="0"?(t.minute="0",t.minuteCustom=""):(te.startsWith("*/"),t.minute="custom",t.minuteCustom=te),A==="*"?(t.hour="*",t.hourCustom=""):A==="0"?(t.hour="0",t.hourCustom=""):(t.hour="custom",t.hourCustom=A),O==="*"?(t.day="*",t.dayCustom=""):(t.day="custom",t.dayCustom=O),E==="*"?(t.month="*",t.monthCustom=""):(t.month="custom",t.monthCustom=E),le==="*"?(t.weekday="*",t.weekdayCustom=""):le==="1-5"?(t.weekday="1-5",t.weekdayCustom=""):le==="0,6"||le==="6,0"?(t.weekday="0,6",t.weekdayCustom=""):(t.weekday="custom",t.weekdayCustom=le)):(console.warn("Cron 表达式格式错误，部分数量:",D.length),s(t))}catch(D){console.error("解析 Cron 表达式失败:",D),s(t)}},h=()=>{i.value.generated=Xl(i.value)},d=()=>{L.value=!1,p("close")},N=()=>{if(!i.value.generated){_.warning("请先生成 Cron 表达式");return}p("apply",i.value.generated),d()},Z=()=>{const v=i.value.generated;if(!v){_.warning("请先生成 Cron 表达式");return}try{const t=mt(v,5);p("preview",t)}catch(t){se(t,"预览失败")}},j=v=>{try{m(v,i.value),h(),Jl(()=>{i.value.generated&&(p("apply",i.value.generated),_.success("示例已应用"))})}catch(t){se(t,"应用示例失败")}};return Ne(()=>c.visible,v=>{L.value=v,v&&(c.initialCron?m(c.initialCron,i.value):s(i.value),h())},{immediate:!0}),Ne(()=>c.initialCron,v=>{c.visible&&v&&(m(v,i.value),h())}),Ne(L,v=>{v!==c.visible&&p("update:visible",v)}),(v,t)=>{const D=ss,W=ns,te=pt,A=ze,O=Ie;return f(),ne(O,{modelValue:L.value,"onUpdate:modelValue":t[17]||(t[17]=E=>L.value=E),title:"Cron 表达式生成器",width:"700","before-close":d},{default:a(()=>[n("div",Fs,[n("div",null,[t[22]||(t[22]=n("div",{class:"text-sm font-medium mb-2"},"秒 (0-59)",-1)),n("div",ks,[l(W,{modelValue:i.value.second,"onUpdate:modelValue":t[0]||(t[0]=E=>i.value.second=E),onChange:h,class:"flex items-center"},{default:a(()=>[l(D,{label:"*",class:"!w-[80px]"},{default:a(()=>[...t[18]||(t[18]=[X("每秒钟",-1)])]),_:1}),l(D,{label:"0",class:"!w-[80px]"},{default:a(()=>[...t[19]||(t[19]=[X("第0秒",-1)])]),_:1}),l(D,{label:"30",class:"!w-[80px]"},{default:a(()=>[...t[20]||(t[20]=[X("第30秒",-1)])]),_:1}),l(D,{label:"custom",class:"!w-[80px]"},{default:a(()=>[...t[21]||(t[21]=[X("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),l(te,{modelValue:i.value.secondCustom,"onUpdate:modelValue":t[1]||(t[1]=E=>i.value.secondCustom=E),placeholder:"例如: 0,30 或 */10",disabled:i.value.second!=="custom",class:"!w-[200px]",onInput:h},null,8,["modelValue","disabled"])])]),n("div",null,[t[27]||(t[27]=n("div",{class:"text-sm font-medium mb-2"},"分 (0-59)",-1)),n("div",_s,[l(W,{modelValue:i.value.minute,"onUpdate:modelValue":t[2]||(t[2]=E=>i.value.minute=E),onChange:h,class:"flex items-center"},{default:a(()=>[l(D,{label:"*",class:"!w-[80px]"},{default:a(()=>[...t[23]||(t[23]=[X("每分钟",-1)])]),_:1}),l(D,{label:"0",class:"!w-[80px]"},{default:a(()=>[...t[24]||(t[24]=[X("第0分",-1)])]),_:1}),l(D,{label:"30",class:"!w-[80px]"},{default:a(()=>[...t[25]||(t[25]=[X("第30分",-1)])]),_:1}),l(D,{label:"custom",class:"!w-[80px]"},{default:a(()=>[...t[26]||(t[26]=[X("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),l(te,{modelValue:i.value.minuteCustom,"onUpdate:modelValue":t[3]||(t[3]=E=>i.value.minuteCustom=E),placeholder:"例如: 0,30 或 */15",disabled:i.value.minute!=="custom",class:"!w-[200px]",onInput:h},null,8,["modelValue","disabled"])])]),n("div",null,[t[32]||(t[32]=n("div",{class:"text-sm font-medium mb-2"},"时 (0-23)",-1)),n("div",Ps,[l(W,{modelValue:i.value.hour,"onUpdate:modelValue":t[4]||(t[4]=E=>i.value.hour=E),onChange:h,class:"flex items-center"},{default:a(()=>[l(D,{label:"*",class:"!w-[80px]"},{default:a(()=>[...t[28]||(t[28]=[X("每小时",-1)])]),_:1}),l(D,{label:"0",class:"!w-[80px]"},{default:a(()=>[...t[29]||(t[29]=[X("0点",-1)])]),_:1}),l(D,{label:"9",class:"!w-[80px]"},{default:a(()=>[...t[30]||(t[30]=[X("9点",-1)])]),_:1}),l(D,{label:"custom",class:"!w-[80px]"},{default:a(()=>[...t[31]||(t[31]=[X("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),l(te,{modelValue:i.value.hourCustom,"onUpdate:modelValue":t[5]||(t[5]=E=>i.value.hourCustom=E),placeholder:"例如: 9,12,18 或 */2",disabled:i.value.hour!=="custom",class:"!w-[200px]",onInput:h},null,8,["modelValue","disabled"])])]),n("div",null,[t[37]||(t[37]=n("div",{class:"text-sm font-medium mb-2"},"日 (1-31)",-1)),n("div",Ss,[l(W,{modelValue:i.value.day,"onUpdate:modelValue":t[6]||(t[6]=E=>i.value.day=E),onChange:h,class:"flex items-center"},{default:a(()=>[l(D,{label:"*",class:"!w-[80px]"},{default:a(()=>[...t[33]||(t[33]=[X("每天",-1)])]),_:1}),l(D,{label:"1",class:"!w-[80px]"},{default:a(()=>[...t[34]||(t[34]=[X("每月1号",-1)])]),_:1}),l(D,{label:"15",class:"!w-[80px]"},{default:a(()=>[...t[35]||(t[35]=[X("每月15号",-1)])]),_:1}),l(D,{label:"custom",class:"!w-[80px]"},{default:a(()=>[...t[36]||(t[36]=[X("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),l(te,{modelValue:i.value.dayCustom,"onUpdate:modelValue":t[7]||(t[7]=E=>i.value.dayCustom=E),placeholder:"例如: 1,15 或 */5",disabled:i.value.day!=="custom",class:"!w-[200px]",onInput:h},null,8,["modelValue","disabled"])])]),n("div",null,[t[42]||(t[42]=n("div",{class:"text-sm font-medium mb-2"},"月 (1-12)",-1)),n("div",Bs,[l(W,{modelValue:i.value.month,"onUpdate:modelValue":t[8]||(t[8]=E=>i.value.month=E),onChange:h,class:"flex items-center"},{default:a(()=>[l(D,{label:"*",class:"!w-[80px]"},{default:a(()=>[...t[38]||(t[38]=[X("每月",-1)])]),_:1}),l(D,{label:"1",class:"!w-[80px]"},{default:a(()=>[...t[39]||(t[39]=[X("1月",-1)])]),_:1}),l(D,{label:"6",class:"!w-[80px]"},{default:a(()=>[...t[40]||(t[40]=[X("6月",-1)])]),_:1}),l(D,{label:"custom",class:"!w-[80px]"},{default:a(()=>[...t[41]||(t[41]=[X("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),l(te,{modelValue:i.value.monthCustom,"onUpdate:modelValue":t[9]||(t[9]=E=>i.value.monthCustom=E),placeholder:"例如: 1,6,12 或 */3",disabled:i.value.month!=="custom",class:"!w-[200px]",onInput:h},null,8,["modelValue","disabled"])])]),n("div",null,[t[47]||(t[47]=n("div",{class:"text-sm font-medium mb-2"},"周 (0-7, 0和7表示周日)",-1)),n("div",As,[l(W,{modelValue:i.value.weekday,"onUpdate:modelValue":t[10]||(t[10]=E=>i.value.weekday=E),onChange:h,class:"flex items-center"},{default:a(()=>[l(D,{label:"*",class:"!w-[80px]"},{default:a(()=>[...t[43]||(t[43]=[X("每天",-1)])]),_:1}),l(D,{label:"1-5",class:"!w-[80px]"},{default:a(()=>[...t[44]||(t[44]=[X("工作日",-1)])]),_:1}),l(D,{label:"0,6",class:"!w-[80px]"},{default:a(()=>[...t[45]||(t[45]=[X("周末",-1)])]),_:1}),l(D,{label:"custom",class:"!w-[80px]"},{default:a(()=>[...t[46]||(t[46]=[X("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),l(te,{modelValue:i.value.weekdayCustom,"onUpdate:modelValue":t[11]||(t[11]=E=>i.value.weekdayCustom=E),placeholder:"例如: 1,3,5 或 1-5",disabled:i.value.weekday!=="custom",class:"!w-[200px]",onInput:h},null,8,["modelValue","disabled"])])]),n("div",Ts,[t[50]||(t[50]=n("div",{class:"text-sm font-medium mb-2"},"生成的 Cron 表达式：",-1)),l(te,{modelValue:i.value.generated,"onUpdate:modelValue":t[12]||(t[12]=E=>i.value.generated=E),readonly:"",class:"mb-2"},null,8,["modelValue"]),n("div",Ms,[l(A,{type:"primary",size:"small",onClick:N},{default:a(()=>[...t[48]||(t[48]=[X(" 应用 ",-1)])]),_:1}),l(A,{type:"info",size:"small",onClick:Z},{default:a(()=>[...t[49]||(t[49]=[X(" 预览执行时间 ",-1)])]),_:1})])]),n("div",Es,[t[55]||(t[55]=n("div",{class:"text-sm font-medium mb-2"},"常用示例：",-1)),n("div",Ls,[n("div",Ns,[l(A,{size:"small",onClick:t[13]||(t[13]=E=>j("0 0 * * *"))},{default:a(()=>[...t[51]||(t[51]=[X(" 每天0点 ",-1)])]),_:1}),l(A,{size:"small",onClick:t[14]||(t[14]=E=>j("0 */30 * * *"))},{default:a(()=>[...t[52]||(t[52]=[X(" 每30分钟 ",-1)])]),_:1}),l(A,{size:"small",onClick:t[15]||(t[15]=E=>j("0 0 9 * * 1-5"))},{default:a(()=>[...t[53]||(t[53]=[X(" 工作日9点 ",-1)])]),_:1}),l(A,{size:"small",onClick:t[16]||(t[16]=E=>j("0 0 0 1 * *"))},{default:a(()=>[...t[54]||(t[54]=[X(" 每月1号0点 ",-1)])]),_:1})])])])])]),_:1},8,["modelValue"])}}}),zs={key:0},Vs={class:"font-medium"},Os={key:1,class:"text-center text-gray-400 py-4"},Rs=Ue({__name:"CronPreviewDialog",props:{visible:{type:Boolean,default:!1},times:{default:()=>[]}},emits:["update:visible","close"],setup(e,{emit:B}){const c=B,p=()=>{c("update:visible",!1),c("close")};return(L,i)=>{const s=as,m=is,h=Ie;return f(),ne(h,{"model-value":e.visible,title:"Cron 执行时间预览",width:"500","onUpdate:modelValue":i[0]||(i[0]=d=>L.$emit("update:visible",d)),"before-close":p},{default:a(()=>[e.times&&e.times.length>0?(f(),P("div",zs,[i[1]||(i[1]=n("div",{class:"text-sm text-gray-600 mb-3"},"下5次执行时间：",-1)),l(m,null,{default:a(()=>[(f(!0),P(De,null,Ae(e.times,(d,N)=>(f(),ne(s,{key:N,timestamp:d,placement:"top"},{default:a(()=>[n("div",Vs,"第 "+R(N+1)+" 次执行",1)]),_:2},1032,["timestamp"]))),128))]),_:1})])):(f(),P("div",Os," 无法解析 Cron 表达式，请检查格式是否正确 "))]),_:1},8,["model-value"])}}}),js={class:"w-64 border rounded p-3 flex flex-col"},Ws={class:"flex items-center justify-between mb-3"},Gs={class:"flex items-center gap-1"},Ys={key:0,class:"flex-1 overflow-y-auto space-y-2 pr-1"},Ks=["onClick"],Hs={class:"flex items-center justify-between gap-2"},Js={class:"text-sm font-medium truncate flex-1 min-w-0"},Xs={class:"flex items-center gap-2 flex-shrink-0"},qs={class:"text-xs text-gray-500 whitespace-nowrap flex items-center gap-1"},Qs={class:"whitespace-nowrap w-5 flex items-center justify-center"},Zs={class:"flex items-center justify-center"},Is={class:"text-[10px] text-blue-600 min-h-[14px] flex items-center justify-between"},en={key:0,class:"flex items-center gap-1"},tn={key:1,class:"invisible"},ln={key:2,class:"text-gray-500 flex items-center gap-1"},sn={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},nn=Ue({__name:"PlaylistList",props:{playlistCollection:{},activePlaylistId:{},refreshing:{type:Boolean},autoRefreshEnabled:{type:Boolean}},emits:["select","create","refresh","toggle-auto-refresh","menu-command"],setup(e){const B=c=>{if(!c||!c.schedule||c.schedule.enabled!==1||!c.schedule.cron||typeof c.schedule.cron!="string")return null;try{const p=String(c.schedule.cron).trim();if(!p)return null;const L=mt(p,1);return L&&L.length>0?ql(L[0]):null}catch{return null}};return(c,p)=>{const L=yt,i=Je,s=ze,m=ds,h=rs,d=us;return f(),P("div",js,[n("div",Ws,[p[4]||(p[4]=n("h3",{class:"text-base font-semibold"},"播放列表",-1)),n("div",Gs,[l(L,{"model-value":e.autoRefreshEnabled,"onUpdate:modelValue":p[0]||(p[0]=N=>c.$emit("toggle-auto-refresh",N)),"active-text":"","inactive-text":"","active-color":"#409eff",size:"small",title:"自动刷新",class:"mr-1"},null,8,["model-value"]),l(s,{type:"primary",size:"small",plain:"",onClick:p[1]||(p[1]=N=>c.$emit("refresh")),loading:e.refreshing,title:"刷新播放列表",class:"!w-8 !h-6 !p-0"},{default:a(()=>[e.refreshing?ie("",!0):(f(),ne(i,{key:0},{default:a(()=>[l(o(Ye))]),_:1}))]),_:1},8,["loading"]),l(s,{type:"success",size:"small",onClick:p[2]||(p[2]=N=>c.$emit("create")),title:"新建播放列表",class:"!w-8 !h-6 !p-0"},{default:a(()=>[l(i,null,{default:a(()=>[l(o(at))]),_:1})]),_:1})])]),e.playlistCollection&&e.playlistCollection.length>0?(f(),P("div",Ys,[(f(!0),P(De,null,Ae(e.playlistCollection,N=>(f(),P("div",{key:N.id,class:Te(["border rounded px-3 py-2 cursor-pointer hover:bg-gray-50 group min-h-[60px] flex flex-col justify-between",{"border-blue-500 bg-blue-50":N.id===e.activePlaylistId}]),onClick:Z=>c.$emit("select",N.id)},[n("div",Hs,[n("div",Js,R(N.name),1),n("div",Xs,[n("span",qs,[l(i,null,{default:a(()=>[l(o(os),{class:"!w-3 !h-3"})]),_:1}),n("span",Qs,R((N.pre_lists&&N.pre_lists[o(Ke)()]&&N.pre_lists[o(Ke)()].length||0)+(N.playlist&&N.playlist.length||0)),1)]),n("div",Zs,[l(d,{trigger:"click",onCommand:Z=>c.$emit("menu-command",Z,N.id),onClick:p[3]||(p[3]=Fe(()=>{},["stop"]))},{dropdown:a(()=>[l(h,null,{default:a(()=>[l(m,{command:"copy"},{default:a(()=>[...p[6]||(p[6]=[n("span",null,"复制",-1)])]),_:1}),e.playlistCollection.length>1?(f(),ne(m,{key:0,command:"delete",divided:""},{default:a(()=>[...p[7]||(p[7]=[n("span",{class:"text-[#f56c6c]"},"删除",-1)])]),_:1})):ie("",!0)]),_:1})]),default:a(()=>[l(s,{type:"default",size:"small",plain:"",circle:"",class:"!w-5 !h-5 !min-w-5 !p-0 text-xs",title:"更多"},{default:a(()=>[...p[5]||(p[5]=[n("span",{class:"text-base leading-none mb-1"},"»",-1)])]),_:1})]),_:1},8,["onCommand"])])])]),n("div",Is,[B(N)?(f(),P("span",en,[l(i,{class:"!w-3 !h-4"},{default:a(()=>[l(o(cs))]),_:1}),X(" "+R(B(N)),1)])):(f(),P("span",tn,"占位")),N.trigger_button?(f(),P("span",ln,[l(i,{class:"!w-3 !h-4"},{default:a(()=>[l(o(Et))]),_:1}),X(" "+R(N.trigger_button),1)])):ie("",!0)])],10,Ks))),128))])):(f(),P("div",sn,' 暂无播放列表，请点击"新建"创建 '))])}}}),an={class:"border rounded p-2 mb-2"},on={class:"flex items-center justify-between mb-2"},rn={class:"flex items-center gap-1"},dn={class:"flex items-center gap-1"},un={class:"text-[10px]"},cn={class:"flex items-center justify-between text-xs text-gray-500 mb-2 pr-2.5"},fn={class:"flex items-center"},vn={key:0},mn={class:"flex items-center gap-1"},gn=["draggable","onClick","onDragstart","onDrop"],pn={class:"text-xs text-gray-500 w-8"},yn=["title"],hn={key:1,class:"w-full border-t border-gray-200"},bn={key:2,class:"text-sm text-gray-400 text-center py-1"},xn=Ue({__name:"PreFilesList",props:{playlistStatus:{},selectedWeekdayIndex:{},preFilesDragMode:{type:Boolean},preFilesBatchDeleteMode:{type:Boolean},selectedPreFileIndices:{},preFilesExpanded:{type:Boolean},playlistLoading:{type:Boolean},showMoreActions:{type:Boolean},audioPlayer:{}},emits:["select-weekday","open-file-browser","toggle-drag-mode","toggle-batch-delete-mode","batch-delete","clear","toggle-expand","toggle-selection","drag-start","drag-end","drag-over","drop","play-file","seek-file","move-up","move-down","replace","open-playlist-selector","delete"],setup(e){const B=e,c=()=>B.selectedWeekdayIndex!==null?B.selectedWeekdayIndex:Ke(),p=()=>{const s=B.playlistStatus;if(!s||!s.pre_lists)return[];const m=c();return!Array.isArray(s.pre_lists)||s.pre_lists.length!==7?[]:s.pre_lists[m]||[]},L=s=>{const m=B.playlistStatus;if(!m||!m.pre_lists||!Array.isArray(m.pre_lists)||m.pre_lists.length!==7)return 0;const h=m.pre_lists[s];return Array.isArray(h)?h.length:0},i=()=>{const s=p();return it(s)};return(s,m)=>{const h=ze,d=ht,N=Je,Z=rt;return f(),P("div",an,[n("div",on,[m[12]||(m[12]=n("div",{class:"text-xs font-semibold text-gray-600 w-39"},"前置文件（播放时优先播放）",-1)),n("div",rn,[n("div",dn,[(f(),P(De,null,Ae(["周一","周二","周三","周四","周五","周六","周日"],(j,v)=>l(h,{key:v,type:e.selectedWeekdayIndex===v||e.selectedWeekdayIndex===null&&o(Ke)()===v?"primary":"default",size:"small",plain:"",onClick:t=>s.$emit("select-weekday",v),title:j,class:"!w-16 !h-6 !p-0 text-xs"},{default:a(()=>[X(R(j),1),n("span",un,"["+R(L(v))+"]",1)]),_:2},1032,["type","onClick","title"])),64))])])]),n("div",cn,[n("div",fn,[i()>0?(f(),P("span",vn," 总时长："+R(o(gt)(i())),1)):ie("",!0),p()&&p().length>0?(f(),P("span",{key:1,class:Te(i()>0?"ml-2":"")}," 共 "+R(p().length)+" 首， 当前: "+R(e.playlistStatus?.pre_index!==void 0&&e.playlistStatus.pre_index!==null&&e.playlistStatus.pre_index>=0?e.playlistStatus.pre_index+1:"-")+" / "+R(p().length),3)):ie("",!0),e.playlistStatus?.isPlaying&&e.playlistStatus.in_pre_files===!0?(f(),ne(d,{key:2,type:"success",size:"small",class:"ml-2"},{default:a(()=>[...m[13]||(m[13]=[X(" 播放中 ",-1)])]),_:1})):ie("",!0)]),n("div",mn,[l(h,{type:"primary",size:"small",plain:"",onClick:m[0]||(m[0]=j=>s.$emit("open-file-browser")),disabled:!e.playlistStatus||e.preFilesDragMode||e.preFilesBatchDeleteMode},{default:a(()=>[...m[14]||(m[14]=[X(" + ",-1)])]),_:1},8,["disabled"]),l(h,{type:e.preFilesDragMode?"success":"default",size:"small",plain:"",class:"!w-8 !h-6",onClick:m[1]||(m[1]=j=>s.$emit("toggle-drag-mode")),disabled:!e.playlistStatus||!p()||p().length===0||e.preFilesBatchDeleteMode,title:e.preFilesDragMode?"点击退出拖拽排序模式":"点击进入拖拽排序模式"},{default:a(()=>[e.preFilesDragMode?(f(),ne(N,{key:0},{default:a(()=>[l(o(Ze))]),_:1})):(f(),ne(N,{key:1},{default:a(()=>[l(o(bt))]),_:1}))]),_:1},8,["type","disabled","title"]),l(h,{type:e.preFilesBatchDeleteMode?"success":"default",size:"small",plain:"",class:"!w-8 !h-6",onClick:m[2]||(m[2]=j=>s.$emit("toggle-batch-delete-mode")),disabled:!e.playlistStatus||!p()||p().length===0||e.preFilesDragMode,title:e.preFilesBatchDeleteMode?"点击退出批量删除模式":"点击进入批量删除模式"},{default:a(()=>[e.preFilesBatchDeleteMode?(f(),ne(N,{key:0},{default:a(()=>[l(o(Ze))]),_:1})):(f(),ne(N,{key:1},{default:a(()=>[l(o(Ve))]),_:1}))]),_:1},8,["type","disabled","title"]),he(l(h,{type:"danger",size:"small",plain:"",class:"!w-8 !h-6",onClick:m[3]||(m[3]=j=>s.$emit("batch-delete")),disabled:e.playlistLoading||e.selectedPreFileIndices.length===0,title:`删除选中的 ${e.selectedPreFileIndices.length} 项`},{default:a(()=>[l(N,null,{default:a(()=>[l(o(Ve))]),_:1})]),_:1},8,["disabled","title"]),[[Pe,e.preFilesBatchDeleteMode]]),he(l(h,{type:"default",size:"small",plain:"",class:"!w-8 !h-6",onClick:m[4]||(m[4]=j=>s.$emit("clear")),disabled:!e.playlistStatus||!p()||p().length===0||e.playlistLoading||e.preFilesDragMode,title:"清空列表"},{default:a(()=>[l(N,null,{default:a(()=>[l(o(Ve))]),_:1})]),_:1},8,["disabled"]),[[Pe,e.showMoreActions&&!e.preFilesBatchDeleteMode]])])]),p()&&p().length>0?(f(),P("div",{key:0,class:Te(["overflow-y-scroll scrollbar-overlay",{"max-h-[192px]":!e.preFilesExpanded}])},[(f(!0),P(De,null,Ae(p(),(j,v)=>(f(),P("div",{key:"pre-"+v,class:Te(["flex items-center gap-2 p-1 hover:bg-gray-100 rounded",{"bg-blue-50":Number(e.playlistStatus?.pre_index)===v,"bg-blue-100":e.preFilesBatchDeleteMode&&e.selectedPreFileIndices.includes(Number(v)),"cursor-move":e.preFilesDragMode,"cursor-pointer":e.preFilesBatchDeleteMode&&!e.preFilesDragMode,"cursor-default":!e.preFilesDragMode&&!e.preFilesBatchDeleteMode,"select-none":!0}]),draggable:e.preFilesDragMode,onClick:t=>e.preFilesBatchDeleteMode&&!e.preFilesDragMode?s.$emit("toggle-selection",Number(v)):null,onDragstart:t=>s.$emit("drag-start",t,Number(v)),onDragend:m[8]||(m[8]=t=>s.$emit("drag-end",t)),onDragover:m[9]||(m[9]=Fe(t=>s.$emit("drag-over",t),["prevent"])),onDragleave:m[10]||(m[10]=t=>{const D=t.currentTarget;D&&D.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")}),onDrop:Fe(t=>s.$emit("drop",t,Number(v)),["prevent"])},[n("span",pn,R(Number(v)+1),1),n("span",{class:Te(["flex-1 text-sm truncate",{"text-blue-600":Number(e.playlistStatus?.pre_index)===v}]),title:j.uri||""},R(j.uri?j.uri.split("/").pop():""),11,yn),n("div",{class:"flex items-center gap-1 flex-shrink-0",onMousedown:m[6]||(m[6]=Fe(()=>{},["stop"])),onClick:m[7]||(m[7]=Fe(()=>{},["stop"]))},[he(l(Tt,{file:j,player:e.audioPlayer,disabled:e.playlistLoading,onPlay:t=>s.$emit("play-file",j),onSeek:(t,D)=>s.$emit("seek-file",t,D)},null,8,["file","player","disabled","onPlay","onSeek"]),[[Pe,!e.preFilesBatchDeleteMode]]),he(l(Z,{class:"!h-6","model-value":e.selectedPreFileIndices.includes(Number(v)),onChange:t=>s.$emit("toggle-selection",Number(v)),onClick:m[5]||(m[5]=Fe(()=>{},["stop"]))},null,8,["model-value","onChange"]),[[Pe,e.preFilesBatchDeleteMode]]),he(l(h,{type:"default",size:"small",plain:"",circle:"",onClick:Fe(t=>s.$emit("move-up",Number(v)),["stop"]),disabled:Number(v)===0||e.playlistLoading,title:"上移"},{default:a(()=>[...m[15]||(m[15]=[X(" ↑ ",-1)])]),_:1},8,["onClick","disabled"]),[[Pe,e.showMoreActions&&!e.preFilesDragMode&&!e.preFilesBatchDeleteMode]]),he(l(h,{type:"default",size:"small",plain:"",circle:"",onClick:Fe(t=>s.$emit("move-down",Number(v)),["stop"]),disabled:Number(v)===p().length-1||e.playlistLoading,title:"下移"},{default:a(()=>[...m[16]||(m[16]=[X(" ↓ ",-1)])]),_:1},8,["onClick","disabled"]),[[Pe,e.showMoreActions&&!e.preFilesDragMode&&!e.preFilesBatchDeleteMode]]),he(l(h,{type:"default",size:"small",plain:"",circle:"",onClick:Fe(t=>s.$emit("replace",Number(v)),["stop"]),disabled:e.playlistLoading,title:"替换"},{default:a(()=>[l(N,null,{default:a(()=>[l(o(Ye))]),_:1})]),_:1},8,["onClick","disabled"]),[[Pe,e.showMoreActions&&!e.preFilesDragMode&&!e.preFilesBatchDeleteMode]]),he(l(h,{type:"info",size:"small",plain:"",circle:"",onClick:Fe(t=>s.$emit("open-playlist-selector",j),["stop"]),disabled:e.playlistLoading,title:"应用到列表"},{default:a(()=>[l(N,null,{default:a(()=>[l(o(Lt))]),_:1})]),_:1},8,["onClick","disabled"]),[[Pe,!e.preFilesBatchDeleteMode&&!e.preFilesDragMode]]),he(l(h,{type:"default",size:"small",plain:"",circle:"",onClick:Fe(t=>s.$emit("delete",Number(v)),["stop"]),disabled:e.playlistLoading||e.preFilesDragMode,title:"删除"},{default:a(()=>[l(N,null,{default:a(()=>[l(o(xt))]),_:1})]),_:1},8,["onClick","disabled"]),[[Pe,!e.preFilesBatchDeleteMode]])],32)],42,gn))),128))],2)):ie("",!0),p()&&p().length>0?(f(),P("div",hn,[l(h,{type:"default",size:"small",plain:"",class:"!w-full !h-4 !p-0 !text-xs",onClick:m[11]||(m[11]=j=>s.$emit("toggle-expand")),title:e.preFilesExpanded?"折叠":"展开"},{default:a(()=>[e.preFilesExpanded?(f(),ne(N,{key:0},{default:a(()=>[l(o(fs))]),_:1})):(f(),ne(N,{key:1},{default:a(()=>[l(o(vs))]),_:1}))]),_:1},8,["title"])])):(f(),P("div",bn,"前置文件列表为空"))])}}}),wn={key:0,class:"border rounded p-2"},$n={class:"flex items-center justify-between mb-2 pr-2.5"},Dn={class:"text-xs font-semibold text-gray-600"},Cn={key:0,class:"ml-2 text-gray-500"},Fn={key:1,class:"ml-2 text-gray-500"},kn={class:"flex items-center gap-1"},_n={key:0,class:"overflow-y-scroll scrollbar-overlay"},Pn=["draggable","onClick","onDragstart","onDrop"],Sn={class:"text-xs text-gray-500 w-8"},Bn=["title"],An={key:1,class:"text-sm text-gray-400 text-center py-1"},Tn=Ue({__name:"FilesList",props:{playlistStatus:{},filesDragMode:{type:Boolean},filesBatchDeleteMode:{type:Boolean},selectedFileIndices:{},playlistLoading:{type:Boolean},showMoreActions:{type:Boolean},audioPlayer:{}},emits:["open-file-browser","toggle-drag-mode","toggle-batch-delete-mode","batch-delete","clear","toggle-selection","drag-start","drag-end","drag-over","drop","play-file","seek-file","move-up","move-down","replace","open-playlist-selector","delete"],setup(e,{emit:B}){const c=e,p=B,L={plain:!0,size:"small",class:"!w-8 !h-6"},i={type:"default",size:"small",plain:!0,circle:!0},s=ue(()=>c.playlistStatus?.playlist||[]),m=ue(()=>s.value.length),h=ue(()=>c.playlistStatus?.current_index??-1),d=ue(()=>h.value>=0?h.value+1:"-"),N=ue(()=>c.playlistStatus?.isPlaying&&!c.playlistStatus.in_pre_files),Z=ue(()=>m.value>0),j=ue(()=>Z.value?it(s.value):0),v=ue(()=>c.filesBatchDeleteMode&&Z.value&&!c.filesDragMode),t=ue(()=>c.showMoreActions&&!c.filesDragMode&&!c.filesBatchDeleteMode),D=ue(()=>c.showMoreActions&&!c.filesBatchDeleteMode),W=ue(()=>!c.filesBatchDeleteMode&&!c.filesDragMode),te=ue(()=>!c.playlistStatus||c.filesDragMode||c.filesBatchDeleteMode),A=ue(()=>!Z.value||c.filesBatchDeleteMode),O=ue(()=>!Z.value||c.filesDragMode),E=ue(()=>c.playlistLoading||c.selectedFileIndices.length===0),le=ue(()=>`删除选中的 ${c.selectedFileIndices.length} 项`),J=ue(()=>!Z.value||c.playlistLoading||c.filesDragMode),me=q=>q?q.split("/").pop():"",z=q=>c.selectedFileIndices.includes(q),b=q=>q===h.value,M=q=>({"bg-blue-50":b(q),"bg-blue-100":v.value&&z(q),"cursor-move":c.filesDragMode,"cursor-pointer":v.value,"cursor-default":!c.filesDragMode&&!c.filesBatchDeleteMode}),x=ue(()=>c.playlistLoading||c.filesDragMode),k=q=>{v.value&&p("toggle-selection",q)},w=(q,G)=>{p("drag-start",q,G)},ee=q=>{p("drag-end",q)},ye=q=>{p("drag-over",q)},g=q=>{const G=q.currentTarget;G?.classList&&G.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")},U=(q,G)=>{p("drop",q,G)},C=(q,G)=>{p("seek-file",q,G)};return(q,G)=>{const re=ht,ve=ze,de=Je,Le=rt;return e.playlistStatus?.playlist?(f(),P("div",wn,[n("div",$n,[n("div",Dn,[G[9]||(G[9]=X(" 正式文件（播放时记录进度） ",-1)),j.value>0?(f(),P("span",Cn," 总时长："+R(o(gt)(j.value)),1)):ie("",!0),Z.value?(f(),P("span",Fn," 共 "+R(m.value)+" 首， 当前: "+R(d.value)+" / "+R(m.value),1)):ie("",!0),N.value?(f(),ne(re,{key:2,type:"success",size:"small",class:"ml-2"},{default:a(()=>[...G[8]||(G[8]=[X(" 播放中 ",-1)])]),_:1})):ie("",!0)]),n("div",kn,[l(ve,Re({type:"primary"},L,{onClick:G[0]||(G[0]=ke=>p("open-file-browser")),disabled:te.value}),{default:a(()=>[...G[10]||(G[10]=[X(" + ",-1)])]),_:1},16,["disabled"]),l(ve,Re({type:e.filesDragMode?"success":"default"},L,{onClick:G[1]||(G[1]=ke=>p("toggle-drag-mode")),disabled:A.value,title:e.filesDragMode?"点击退出拖拽排序模式":"点击进入拖拽排序模式"}),{default:a(()=>[e.filesDragMode?(f(),ne(de,{key:0},{default:a(()=>[l(o(Ze))]),_:1})):(f(),ne(de,{key:1},{default:a(()=>[l(o(bt))]),_:1}))]),_:1},16,["type","disabled","title"]),l(ve,Re({type:e.filesBatchDeleteMode?"success":"default"},L,{onClick:G[2]||(G[2]=ke=>p("toggle-batch-delete-mode")),disabled:O.value,title:e.filesBatchDeleteMode?"点击退出批量删除模式":"点击进入批量删除模式"}),{default:a(()=>[e.filesBatchDeleteMode?(f(),ne(de,{key:0},{default:a(()=>[l(o(Ze))]),_:1})):(f(),ne(de,{key:1},{default:a(()=>[l(o(Ve))]),_:1}))]),_:1},16,["type","disabled","title"]),he(l(ve,Re({type:"danger"},L,{onClick:G[3]||(G[3]=ke=>p("batch-delete")),disabled:E.value,title:le.value}),{default:a(()=>[l(de,null,{default:a(()=>[l(o(Ve))]),_:1})]),_:1},16,["disabled","title"]),[[Pe,e.filesBatchDeleteMode]]),he(l(ve,Re({type:"default"},L,{onClick:G[4]||(G[4]=ke=>p("clear")),disabled:J.value,title:"清空正式文件列表"}),{default:a(()=>[l(de,null,{default:a(()=>[l(o(Ve))]),_:1})]),_:1},16,["disabled"]),[[Pe,D.value]])])]),Z.value?(f(),P("div",_n,[(f(!0),P(De,null,Ae(s.value,(ke,$e)=>(f(),P("div",{key:ke.uri||$e,class:Te(["flex items-center gap-2 p-1 hover:bg-gray-100 rounded select-none",M($e)]),draggable:e.filesDragMode,onClick:Se=>k($e),onDragstart:Se=>w(Se,$e),onDragend:ee,onDragover:Fe(ye,["prevent"]),onDragleave:g,onDrop:Fe(Se=>U(Se,$e),["prevent"])},[n("span",Sn,R($e+1),1),n("span",{class:Te(["flex-1 text-sm truncate",{"text-blue-600":b($e)}]),title:ke.uri||""},R(me(ke.uri)),11,Bn),n("div",{class:"flex items-center gap-1 flex-shrink-0",onMousedown:G[6]||(G[6]=Fe(()=>{},["stop"])),onClick:G[7]||(G[7]=Fe(()=>{},["stop"]))},[he(l(Tt,{file:ke,player:e.audioPlayer,disabled:e.playlistLoading,onPlay:Se=>p("play-file",ke),onSeek:C},null,8,["file","player","disabled","onPlay"]),[[Pe,!e.filesBatchDeleteMode]]),he(l(Le,{class:"!h-6","model-value":z($e),onChange:Se=>p("toggle-selection",$e),onClick:G[5]||(G[5]=Fe(()=>{},["stop"]))},null,8,["model-value","onChange"]),[[Pe,e.filesBatchDeleteMode]]),he(l(ve,Re({ref_for:!0},i,{onClick:Fe(Se=>p("move-up",$e),["stop"]),disabled:$e===0||e.playlistLoading,title:"上移"}),{default:a(()=>[...G[11]||(G[11]=[X(" ↑ ",-1)])]),_:1},16,["onClick","disabled"]),[[Pe,t.value]]),he(l(ve,Re({ref_for:!0},i,{onClick:Fe(Se=>p("move-down",$e),["stop"]),disabled:$e===m.value-1||e.playlistLoading,title:"下移"}),{default:a(()=>[...G[12]||(G[12]=[X(" ↓ ",-1)])]),_:1},16,["onClick","disabled"]),[[Pe,t.value]]),he(l(ve,Re({ref_for:!0},i,{onClick:Fe(Se=>p("replace",$e),["stop"]),disabled:e.playlistLoading,title:"替换"}),{default:a(()=>[l(de,null,{default:a(()=>[l(o(Ye))]),_:1})]),_:1},16,["onClick","disabled"]),[[Pe,t.value]]),he(l(ve,{type:"info",size:"small",plain:"",circle:"",onClick:Fe(Se=>p("open-playlist-selector",ke),["stop"]),disabled:e.playlistLoading,title:"应用到列表"},{default:a(()=>[l(de,null,{default:a(()=>[l(o(Lt))]),_:1})]),_:1},8,["onClick","disabled"]),[[Pe,W.value]]),he(l(ve,Re({ref_for:!0},i,{onClick:Fe(Se=>p("delete",$e),["stop"]),disabled:x.value,title:"删除"}),{default:a(()=>[l(de,null,{default:a(()=>[l(o(xt))]),_:1})]),_:1},16,["onClick","disabled"]),[[Pe,!e.filesBatchDeleteMode]])],32)],42,Pn))),128))])):(f(),P("div",An,"正式文件列表为空"))])):ie("",!0)}}}),Mn={class:"flex-1 border rounded p-3 flex flex-col"},En={class:"flex items-center justify-between mb-3"},Ln={class:"flex-1"},Nn={key:0,class:"flex items-center gap-2 mb-1"},Un={class:"flex items-center gap-2 flex-1"},zn={class:"text-lg font-semibold truncate"},Vn={key:1},On={key:2,class:"text-sm text-gray-500"},Rn={key:0,class:"mr-2"},jn={class:"flex flex-wrap gap-2"},Wn={key:1},Gn={key:1},Yn={key:1},Kn={key:1},Hn={key:0,class:"flex-1 overflow-y-scroll scrollbar-overlay"},Jn={key:0,class:"text-sm text-gray-400 text-center py-8"},Xn={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},qn=Ue({__name:"FileListPanel",props:{playlistStatus:{},activePlaylistId:{},editingPlaylistId:{},editingPlaylistName:{},selectedWeekdayIndex:{},preFilesDragMode:{type:Boolean},preFilesBatchDeleteMode:{type:Boolean},selectedPreFileIndices:{},preFilesExpanded:{type:Boolean},filesDragMode:{type:Boolean},filesBatchDeleteMode:{type:Boolean},selectedFileIndices:{},playlistLoading:{type:Boolean},playing:{type:Boolean},stopping:{type:Boolean},showMoreActions:{type:Boolean},audioPlayer:{}},emits:["update:editingPlaylistName","start-edit-name","save-name","cancel-edit-name","open-batch-drawer","play","play-pre","play-next","stop","clear","toggle-more-actions","select-weekday","open-file-browser-for-pre-files","toggle-pre-files-drag-mode","toggle-pre-files-batch-delete-mode","batch-delete-pre-files","clear-pre-files","toggle-pre-files-expand","toggle-pre-file-selection","pre-file-drag-start","pre-file-drag-end","pre-file-drag-over","pre-file-drop","open-file-browser","toggle-files-drag-mode","toggle-files-batch-delete-mode","batch-delete-files","clear-files","toggle-file-selection","file-drag-start","file-drag-end","file-drag-over","file-drop","play-file","seek-file","move-pre-file-up","move-pre-file-down","replace-pre-file","open-playlist-selector-for-pre-file","delete-pre-file","move-file-up","move-file-down","replace-file","open-playlist-selector-for-file","delete-file"],setup(e){const B=e,c=()=>B.selectedWeekdayIndex!==null?B.selectedWeekdayIndex:Ke(),p=()=>{const i=B.playlistStatus;if(!i||!i.pre_lists)return[];const s=c();return!Array.isArray(i.pre_lists)||i.pre_lists.length!==7?[]:i.pre_lists[s]||[]},L=()=>{const i=B.playlistStatus;if(!i)return 0;const s=p(),m=it(s),h=i.playlist||[],d=it(h);return m+d};return(i,s)=>{const m=Je,h=ze;return f(),P("div",Mn,[n("div",En,[n("div",Ln,[e.playlistStatus?(f(),P("div",Nn,[n("div",Un,[n("h3",zn,R(e.playlistStatus.name),1),l(h,{type:"default",size:"small",plain:"",circle:"",onClick:s[0]||(s[0]=d=>i.$emit("start-edit-name",e.activePlaylistId)),title:"编辑名称"},{default:a(()=>[l(m,null,{default:a(()=>[l(o(Nt))]),_:1})]),_:1})])])):(f(),P("div",Vn,[...s[44]||(s[44]=[n("h3",{class:"text-lg font-semibold"},"播放列表文件",-1)])])),e.playlistStatus?(f(),P("div",On,[L()>0?(f(),P("span",Rn," 总时长："+R(o(gt)(L())),1)):ie("",!0),e.playlistStatus?(f(),P(De,{key:1},[(p()?.length||0)+(e.playlistStatus.playlist?.length||0)>0?(f(),P(De,{key:0},[X(" 共 "+R((p()?.length||0)+(e.playlistStatus.playlist?.length||0))+" 首， 当前: ",1),e.playlistStatus.pre_index!==void 0&&e.playlistStatus.pre_index!==null&&e.playlistStatus.pre_index>=0?(f(),P(De,{key:0},[X(R(e.playlistStatus.pre_index+1),1)],64)):e.playlistStatus.current_index!==void 0&&e.playlistStatus.current_index!==null&&e.playlistStatus.current_index>=0?(f(),P(De,{key:1},[X(R((p()?.length||0)+e.playlistStatus.current_index+1),1)],64)):(f(),P(De,{key:2},[X(" - ")],64)),X(" / "+R((p()?.length||0)+(e.playlistStatus.playlist?.length||0)),1)],64)):(f(),P(De,{key:1},[X(" 共 0 首， 当前: - / 0 ")],64))],64)):ie("",!0)])):ie("",!0)]),n("div",jn,[l(h,{type:"default",size:"small",plain:"",circle:"",onClick:s[1]||(s[1]=d=>i.$emit("open-batch-drawer")),title:"批量模式"},{default:a(()=>[l(m,null,{default:a(()=>[l(o(ms))]),_:1})]),_:1}),l(h,{type:"default",size:"small",plain:"",circle:"",onClick:s[2]||(s[2]=d=>i.$emit("play")),class:"items-center justify-center",disabled:!e.playlistStatus||!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0||!!e.playlistStatus.isPlaying,title:"播放"},{default:a(()=>[e.playing?(f(),ne(m,{key:0,size:"12",class:"animate-spin"},{default:a(()=>[l(o(Xe))]),_:1})):(f(),P("span",Wn,"▶"))]),_:1},8,["disabled"]),l(h,{type:"default",size:"small",plain:"",circle:"",onClick:s[3]||(s[3]=d=>i.$emit("play-pre")),disabled:!e.playlistStatus||(!p()||p().length===0)&&(!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0),title:"上一首"},{default:a(()=>[e.playing?(f(),ne(m,{key:0,size:"12",class:"animate-spin"},{default:a(()=>[l(o(Xe))]),_:1})):(f(),P("span",Gn,"⏮"))]),_:1},8,["disabled"]),l(h,{type:"default",size:"small",plain:"",circle:"",onClick:s[4]||(s[4]=d=>i.$emit("play-next")),disabled:!e.playlistStatus||(!p()||p().length===0)&&(!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0),title:"下一首"},{default:a(()=>[e.playing?(f(),ne(m,{key:0,size:"12",class:"animate-spin"},{default:a(()=>[l(o(Xe))]),_:1})):(f(),P("span",Yn,"⏭"))]),_:1},8,["disabled"]),l(h,{type:"default",size:"small",plain:"",circle:"",onClick:s[5]||(s[5]=d=>i.$emit("stop")),title:"停止"},{default:a(()=>[e.stopping?(f(),ne(m,{key:0,size:"12",class:"animate-spin"},{default:a(()=>[l(o(Xe))]),_:1})):(f(),P("span",Kn,"⏹"))]),_:1}),he(l(h,{type:"default",size:"small",plain:"",circle:"",onClick:s[6]||(s[6]=d=>i.$emit("clear")),disabled:!e.playlistStatus||(!p()||p().length===0)&&(!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0)||e.playlistLoading,title:"清空列表（包括前置文件和正式文件）"},{default:a(()=>[l(m,null,{default:a(()=>[l(o(Ve))]),_:1})]),_:1},8,["disabled"]),[[Pe,e.showMoreActions]]),l(h,{type:"default",size:"small",plain:"",circle:"",onClick:s[7]||(s[7]=d=>i.$emit("toggle-more-actions")),title:"更多"},{default:a(()=>[l(m,null,{default:a(()=>[l(o(bt))]),_:1})]),_:1})])]),e.playlistStatus?(f(),P("div",Hn,[l(xn,{"playlist-status":e.playlistStatus,"selected-weekday-index":e.selectedWeekdayIndex,"pre-files-drag-mode":e.preFilesDragMode,"pre-files-batch-delete-mode":e.preFilesBatchDeleteMode,"selected-pre-file-indices":e.selectedPreFileIndices,"pre-files-expanded":e.preFilesExpanded,"playlist-loading":e.playlistLoading,"show-more-actions":e.showMoreActions,"audio-player":e.audioPlayer,onSelectWeekday:s[8]||(s[8]=d=>i.$emit("select-weekday",d)),onOpenFileBrowser:s[9]||(s[9]=d=>i.$emit("open-file-browser-for-pre-files")),onToggleDragMode:s[10]||(s[10]=d=>i.$emit("toggle-pre-files-drag-mode")),onToggleBatchDeleteMode:s[11]||(s[11]=d=>i.$emit("toggle-pre-files-batch-delete-mode")),onBatchDelete:s[12]||(s[12]=d=>i.$emit("batch-delete-pre-files")),onClear:s[13]||(s[13]=d=>i.$emit("clear-pre-files")),onToggleExpand:s[14]||(s[14]=d=>i.$emit("toggle-pre-files-expand")),onToggleSelection:s[15]||(s[15]=d=>i.$emit("toggle-pre-file-selection",d)),onDragStart:s[16]||(s[16]=(d,N)=>i.$emit("pre-file-drag-start",d,N)),onDragEnd:s[17]||(s[17]=d=>i.$emit("pre-file-drag-end",d)),onDragOver:s[18]||(s[18]=d=>i.$emit("pre-file-drag-over",d)),onDrop:s[19]||(s[19]=(d,N)=>i.$emit("pre-file-drop",d,N)),onPlayFile:s[20]||(s[20]=d=>i.$emit("play-file",d)),onSeekFile:s[21]||(s[21]=(d,N)=>i.$emit("seek-file",d,N)),onMoveUp:s[22]||(s[22]=d=>i.$emit("move-pre-file-up",d)),onMoveDown:s[23]||(s[23]=d=>i.$emit("move-pre-file-down",d)),onReplace:s[24]||(s[24]=d=>i.$emit("replace-pre-file",d)),onOpenPlaylistSelector:s[25]||(s[25]=d=>i.$emit("open-playlist-selector-for-pre-file",d)),onDelete:s[26]||(s[26]=d=>i.$emit("delete-pre-file",d))},null,8,["playlist-status","selected-weekday-index","pre-files-drag-mode","pre-files-batch-delete-mode","selected-pre-file-indices","pre-files-expanded","playlist-loading","show-more-actions","audio-player"]),l(Tn,{"playlist-status":e.playlistStatus,"files-drag-mode":e.filesDragMode,"files-batch-delete-mode":e.filesBatchDeleteMode,"selected-file-indices":e.selectedFileIndices,"playlist-loading":e.playlistLoading,"show-more-actions":e.showMoreActions,"audio-player":e.audioPlayer,onOpenFileBrowser:s[27]||(s[27]=d=>i.$emit("open-file-browser")),onToggleDragMode:s[28]||(s[28]=d=>i.$emit("toggle-files-drag-mode")),onToggleBatchDeleteMode:s[29]||(s[29]=d=>i.$emit("toggle-files-batch-delete-mode")),onBatchDelete:s[30]||(s[30]=d=>i.$emit("batch-delete-files")),onClear:s[31]||(s[31]=d=>i.$emit("clear-files")),onToggleSelection:s[32]||(s[32]=d=>i.$emit("toggle-file-selection",d)),onDragStart:s[33]||(s[33]=(d,N)=>i.$emit("file-drag-start",d,N)),onDragEnd:s[34]||(s[34]=d=>i.$emit("file-drag-end",d)),onDragOver:s[35]||(s[35]=d=>i.$emit("file-drag-over",d)),onDrop:s[36]||(s[36]=(d,N)=>i.$emit("file-drop",d,N)),onPlayFile:s[37]||(s[37]=d=>i.$emit("play-file",d)),onSeekFile:s[38]||(s[38]=(d,N)=>i.$emit("seek-file",d,N)),onMoveUp:s[39]||(s[39]=d=>i.$emit("move-file-up",d)),onMoveDown:s[40]||(s[40]=d=>i.$emit("move-file-down",d)),onReplace:s[41]||(s[41]=d=>i.$emit("replace-file",d)),onOpenPlaylistSelector:s[42]||(s[42]=d=>i.$emit("open-playlist-selector-for-file",d)),onDelete:s[43]||(s[43]=d=>i.$emit("delete-file",d))},null,8,["playlist-status","files-drag-mode","files-batch-delete-mode","selected-file-indices","playlist-loading","show-more-actions","audio-player"]),(!p()||p().length===0)&&(!e.playlistStatus?.playlist||e.playlistStatus.playlist.length===0)?(f(),P("div",Jn,' 当前播放列表为空，点击"添加文件"开始构建播放列表 ')):ie("",!0)])):(f(),P("div",Xn," 请先在左侧选择一个播放列表查看详情 "))])}}}),Qn={class:"w-80 min-w-75 border rounded p-3 flex flex-col"},Zn={key:0,class:"mb-3 flex items-center gap-2 flex-wrap"},In={key:1,class:"flex-1 overflow-y-auto space-y-4"},ea={class:"border rounded p-3"},ta={class:"flex items-center justify-between mb-2"},la={class:"space-y-2"},sa={class:"flex items-center gap-2"},na={class:"flex items-start gap-4"},aa={class:"flex-1"},ia={class:"flex-1"},oa={key:0},ra={class:"border rounded p-3"},da={class:"space-y-2"},ua={class:"text-xs text-gray-600 mb-1 flex items-center gap-2"},ca={key:0,class:"text-xs text-gray-500"},fa={class:"flex items-center gap-2"},va={class:"mt-3"},ma={class:"flex items-center justify-between mb-2"},ga={class:"text-xs font-semibold text-gray-700"},pa={key:0},ya={class:"space-y-2 max-h-[200px] overflow-y-auto"},ha={class:"flex-1 min-w-0"},ba={class:"text-sm font-medium truncate"},xa={class:"text-xs text-gray-500 truncate"},wa={class:"flex-shrink-0"},$a={key:0,class:"text-xs text-gray-400 text-center py-4"},Da={key:1},Ca={class:"space-y-2 max-h-[200px] overflow-y-auto"},Fa={class:"flex-1 min-w-0"},ka={class:"text-sm font-medium truncate"},_a=["title"],Pa={class:"flex-shrink-0"},Sa={key:0,class:"text-xs text-gray-400 text-center py-4"},Ba={key:2},Aa={class:"space-y-2 max-h-[200px] overflow-y-auto"},Ta={class:"flex-1 min-w-0"},Ma={class:"text-sm font-medium truncate"},Ea=["title"],La={class:"flex-shrink-0"},Na={key:0,class:"text-xs text-gray-400 text-center py-4"},Ua={key:2,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},za=Ue({__name:"ConfigPanel",props:{playlistStatus:{},connectedDeviceList:{},dlnaDeviceList:{},miDeviceList:{},loading:{type:Boolean},dlnaScanning:{type:Boolean},miScanning:{type:Boolean},onToggleCronEnabled:{type:Function},onUpdateCron:{type:Function},onUpdateDuration:{type:Function},onUpdateTriggerButton:{type:Function},onOpenCronBuilder:{type:Function},onPreviewCron:{type:Function},onUpdateDeviceType:{type:Function},onUpdateDeviceAddress:{type:Function},onSelectBluetoothDevice:{type:Function},onSelectAgentDevice:{type:Function},onSelectMiDevice:{type:Function},onScanDlnaDevices:{type:Function},onScanMiDevices:{type:Function},onOpenScanDialog:{type:Function},onOpenDeviceList:{type:Function}},setup(e){const B=e,c=ue(()=>B.playlistStatus?.device?.type||B.playlistStatus?.device_type||null),p=ue(()=>B.playlistStatus?.device?.address||B.playlistStatus?.device_address||""),L=j=>ue(()=>c.value===j),i=ue(()=>{const j=c.value;return j==="agent"||j==="bluetooth"}),s=L("dlna"),m=L("mi"),h=ue(()=>i.value?"已配对的设备":s.value?"DLNA 设备":m.value?"小米设备":"设备列表"),d=ue(()=>i.value?"扫描设备":s.value?"扫描 DLNA 设备":m.value?"扫描小米设备":"扫描设备"),N=ue(()=>B.dlnaScanning||B.miScanning),Z=()=>{i.value?B.onOpenScanDialog():s.value?B.onScanDlnaDevices():m.value&&B.onScanMiDevices()};return(j,v)=>{const t=Je,D=ze,W=yt,te=pt,A=gs,O=zt,E=Ut,le=wt;return f(),P("div",Qn,[v[20]||(v[20]=n("h3",{class:"text-lg font-semibold mb-3"},"配置详情",-1)),e.playlistStatus?(f(),P("div",Zn,[l(D,{type:"default",onClick:e.onOpenDeviceList,title:"打开设备列表"},{default:a(()=>[l(t,null,{default:a(()=>[l(o(ps))]),_:1}),v[4]||(v[4]=n("span",{class:"ml-1"},"设备列表",-1))]),_:1},8,["onClick"])])):ie("",!0),e.playlistStatus?(f(),P("div",In,[n("div",ea,[n("div",ta,[v[5]||(v[5]=n("h4",{class:"text-sm font-semibold"},"定时任务 (Cron)",-1)),l(W,{"model-value":e.playlistStatus.schedule?.enabled===1,onChange:v[0]||(v[0]=J=>e.onToggleCronEnabled(J)),"active-text":"开启","inactive-text":"关闭"},null,8,["model-value"])]),n("div",la,[n("div",null,[v[7]||(v[7]=n("div",{class:"text-xs text-gray-600 mb-1"},"Cron 表达式",-1)),n("div",sa,[l(te,{"model-value":e.playlistStatus.schedule?.cron||"",onInput:v[1]||(v[1]=J=>e.onUpdateCron(J)),placeholder:"例如: 0 0 * * *",size:"small",disabled:e.playlistStatus.schedule?.enabled!==1},null,8,["model-value","disabled"]),l(D,{type:"info",size:"small",onClick:e.onOpenCronBuilder,disabled:e.playlistStatus.schedule?.enabled!==1},{default:a(()=>[...v[6]||(v[6]=[X(" 助手 ",-1)])]),_:1},8,["onClick","disabled"])])]),n("div",na,[n("div",aa,[v[8]||(v[8]=n("div",{class:"text-xs text-gray-600 mb-1"},"持续时间（分钟）",-1)),l(A,{"model-value":e.playlistStatus.schedule?.duration||0,onChange:e.onUpdateDuration,min:0,max:o(xs),step:1,size:"small",disabled:e.playlistStatus.schedule?.enabled!==1,class:"w-full"},null,8,["model-value","onChange","max","disabled"]),v[9]||(v[9]=n("div",{class:"text-xs text-gray-500 mt-1"},"0表示不自动停止",-1))]),n("div",ia,[v[10]||(v[10]=n("div",{class:"text-xs text-gray-600 mb-1"},"触发按钮",-1)),l(E,{"model-value":e.playlistStatus.trigger_button||"",onChange:e.onUpdateTriggerButton,placeholder:"选择触发按钮",size:"small",class:"w-full",clearable:""},{default:a(()=>[l(O,{label:"空",value:o(st).NONE},null,8,["value"]),l(O,{label:"按钮对-1",value:o(st).BUTTON_1},null,8,["value"]),l(O,{label:"按钮对-2",value:o(st).BUTTON_2},null,8,["value"]),l(O,{label:"按钮对-3",value:o(st).BUTTON_3},null,8,["value"])]),_:1},8,["model-value","onChange"])])]),e.playlistStatus.schedule?.cron&&e.playlistStatus.schedule?.enabled===1?(f(),P("div",oa,[l(D,{type:"success",size:"small",onClick:e.onPreviewCron,class:"w-full"},{default:a(()=>[...v[11]||(v[11]=[X(" 预览执行时间 ",-1)])]),_:1},8,["onClick"])])):ie("",!0)])]),n("div",ra,[v[19]||(v[19]=n("h4",{class:"text-sm font-semibold mb-2"},"设备配置",-1)),n("div",da,[n("div",null,[v[12]||(v[12]=n("div",{class:"text-xs text-gray-600 mb-1"},"设备类型",-1)),l(E,{"model-value":c.value,onChange:e.onUpdateDeviceType,placeholder:"选择设备类型",size:"small",class:"w-full"},{default:a(()=>[l(O,{label:"蓝牙",value:"bluetooth"}),l(O,{label:"DLNA",value:"dlna"}),l(O,{label:"设备代理",value:"agent"}),l(O,{label:"小米设备",value:"mi"})]),_:1},8,["model-value","onChange"])]),n("div",null,[n("div",ua,[v[13]||(v[13]=n("span",null,"设备地址",-1)),e.playlistStatus.device?.name?(f(),P("span",ca,R(e.playlistStatus.device.name),1)):ie("",!0)]),n("div",fa,[l(te,{"model-value":p.value,onInput:v[2]||(v[2]=J=>e.onUpdateDeviceAddress(J)),placeholder:"设备地址",size:"small",class:"flex-1"},null,8,["model-value"]),l(D,{size:"small",type:"danger",plain:"",onClick:v[3]||(v[3]=J=>e.onUpdateDeviceAddress("")),disabled:!p.value,title:"清空设备地址"},{default:a(()=>[...v[14]||(v[14]=[X(" 清空 ",-1)])]),_:1},8,["disabled"])])])]),n("div",va,[n("div",ma,[n("h5",ga,R(h.value),1),c.value?(f(),ne(D,{key:0,size:"small",type:"primary",plain:"",onClick:Z,loading:N.value,disabled:N.value,title:d.value},{default:a(()=>[N.value?ie("",!0):(f(),ne(t,{key:0},{default:a(()=>[l(o(Ye))]),_:1})),v[15]||(v[15]=n("span",{class:"ml-1"},"扫描设备",-1))]),_:1},8,["loading","disabled","title"])):ie("",!0)]),i.value?(f(),P("div",pa,[he((f(),P("div",ya,[(f(!0),P(De,null,Ae(e.connectedDeviceList,J=>(f(),P("div",{key:J.address,class:"flex items-center gap-2 p-2 border rounded hover:bg-gray-50"},[n("div",ha,[n("div",ba,R(J.name),1),n("div",xa,R(J.address),1)]),n("div",wa,[l(D,{size:"small",type:"primary",onClick:me=>c.value==="agent"?e.onSelectAgentDevice(J):e.onSelectBluetoothDevice(J.address),disabled:J.address===p.value},{default:a(()=>[...v[16]||(v[16]=[X(" 选择 ",-1)])]),_:1},8,["onClick","disabled"])])]))),128)),e.connectedDeviceList.length===0?(f(),P("div",$a," 暂无设备 ")):ie("",!0)])),[[le,e.loading]])])):o(s)?(f(),P("div",Da,[he((f(),P("div",Ca,[(f(!0),P(De,null,Ae(e.dlnaDeviceList,J=>(f(),P("div",{key:J.location,class:"flex items-center gap-2 p-2 border rounded hover:bg-gray-50"},[n("div",Fa,[n("div",ka,R(J.name),1),n("div",{class:"text-xs text-gray-500 truncate",title:J.location},R(J.location),9,_a)]),n("div",Pa,[l(D,{size:"small",type:"primary",onClick:me=>e.onUpdateDeviceAddress(J.location||J.address||"",J.name),disabled:(J.location||J.address)===p.value},{default:a(()=>[...v[17]||(v[17]=[X(" 选择 ",-1)])]),_:1},8,["onClick","disabled"])])]))),128)),e.dlnaDeviceList.length===0&&!e.dlnaScanning?(f(),P("div",Sa,' 暂无设备，点击"扫描设备"开始扫描 ')):ie("",!0)])),[[le,e.dlnaScanning]])])):o(m)?(f(),P("div",Ba,[he((f(),P("div",Aa,[(f(!0),P(De,null,Ae(e.miDeviceList,J=>(f(),P("div",{key:J.deviceID||J.address,class:"flex items-center gap-2 p-2 border rounded hover:bg-gray-50"},[n("div",Ta,[n("div",Ma,R(J.name),1),n("div",{class:"text-xs text-gray-500 truncate",title:J.deviceID||J.address},R(J.deviceID||J.address),9,Ea)]),n("div",La,[l(D,{size:"small",type:"primary",onClick:me=>e.onSelectMiDevice(J),disabled:(J.deviceID||J.address)===p.value},{default:a(()=>[...v[18]||(v[18]=[X(" 选择 ",-1)])]),_:1},8,["onClick","disabled"])])]))),128)),e.miDeviceList.length===0&&!e.miScanning?(f(),P("div",Na,' 暂无设备，点击"扫描设备"开始扫描 ')):ie("",!0)])),[[le,e.miScanning]])])):ie("",!0)])])])):(f(),P("div",Ua," 请先选择一个播放列表 "))])}}}),Va={class:"mb-4"},Oa={key:0,class:"text-center text-gray-400 mt-4 py-8"},Ra=Ue({__name:"ScanDeviceDialog",props:{visible:{type:Boolean},deviceList:{},loading:{type:Boolean}},emits:["update:visible","refresh","connect","close"],setup(e,{emit:B}){const c=B,p=s=>{c("update:visible",s),s||c("close")},L=()=>{c("refresh")},i=s=>{c("connect",s)};return(s,m)=>{const h=ze,d=Ot,N=Vt,Z=Ie,j=wt;return f(),ne(Z,{"model-value":e.visible,"onUpdate:modelValue":p,title:"扫描到的设备",width:"800"},{default:a(()=>[n("div",Va,[l(h,{type:"primary",onClick:L,loading:e.loading},{default:a(()=>[...m[0]||(m[0]=[X("刷新扫描",-1)])]),_:1},8,["loading"])]),he((f(),ne(N,{data:e.deviceList,stripe:"",class:"w-full",height:400},{default:a(()=>[l(d,{prop:"name",label:"设备名称","min-width":"150"}),l(d,{prop:"address",label:"地址","min-width":"120"}),l(d,{prop:"rssi",label:"信号强度",width:"100"},{default:a(({row:v})=>[n("span",null,R(v.rssi)+" dBm",1)]),_:1}),l(d,{label:"操作",width:"100"},{default:a(({row:v})=>[l(h,{size:"small",type:"primary",onClick:t=>i(v),loading:v.connecting,disabled:v.connecting},{default:a(()=>[...m[1]||(m[1]=[X(" 连接 ",-1)])]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1},8,["data"])),[[j,e.loading]]),e.deviceList.length===0&&!e.loading?(f(),P("div",Oa,' 暂无扫描到的设备，点击"刷新扫描"按钮开始扫描 ')):ie("",!0)]),_:1},8,["model-value"])}}}),ja={class:"flex items-center gap-3 w-full pr-4"},Wa={class:"flex flex-col gap-4 h-full overflow-y-auto"},Ga={class:"flex flex-col gap-1"},Ya={class:"text-sm flex items-start"},Ka={class:"text-gray-800"},Ha={class:"text-sm flex items-start"},Ja={class:"text-gray-800"},Xa={key:0,class:"text-gray-400"},qa={class:"flex flex-col items-center gap-1"},Qa={class:"text-xs text-gray-500"},Za={class:"flex flex-col gap-1"},Ia={class:"text-[12px] mr-1 !w-4"},ei={class:"flex flex-col gap-4 h-full overflow-y-auto"},ti={key:0,class:"text-sm"},li={key:1,class:"text-gray-400"},si={class:"flex flex-col gap-4 h-full overflow-y-auto"},ni={class:"flex flex-col gap-1"},ai={class:"text-sm flex items-start"},ii=["title"],oi={key:0,class:"text-sm flex items-start"},ri={class:"text-gray-800"},di={class:"flex flex-col gap-2"},ui={class:"flex items-center gap-2"},ci={class:"text-gray-800 w-5"},fi={key:1},vi={class:"flex items-center gap-2"},mi={class:"flex flex-col gap-4 h-full overflow-y-auto"},gi={class:"flex flex-col gap-1"},pi={class:"text-sm flex items-start"},yi={class:"text-gray-800"},hi={class:"text-sm flex items-start"},bi={class:"text-gray-800 w-40"},xi={class:"text-gray-800 w-40"},wi={class:"flex flex-col gap-2"},$i={class:"flex items-center gap-2"},Di={class:"text-gray-800 w-5"},Ci={key:1},Fi={class:"flex items-center gap-2"},ki=Ue({__name:"DevicesDrawer",props:{visible:{type:Boolean,default:!1}},emits:["update:visible"],setup(e,{emit:B}){const c=e,p=B,L=Y(c.visible),i=Y("agent"),s=Y([]),m=Y(!1),h=Y(!1);let d=null;const N=Y([]),Z=Y(!1),j=Y([]),v=Y(!1),t=Y([]),D=Y(!1),W=[{label:"B1",keys:["F13","F14"]},{label:"B2",keys:["F15","F16"]},{label:"B3",keys:["F17","F18"]}],te=async(r=!0,u=!1)=>{try{r&&(m.value=!0);const F=(await Ee.get("/agent/list")).data;F?.code===0?(s.value=F.data||[],u&&_.success(`已获取 ${s.value.length} 个 Agent 设备`)):((u||r)&&_.error(F?.msg||"获取设备列表失败"),s.value=[])}catch(S){console.error("获取Agent设备列表失败:",S),(u||r)&&se(S,"获取设备列表失败"),s.value=[]}finally{r&&(m.value=!1)}},A=async(r,u)=>{const S=s.value.find(I=>I.agent_id===r);if(!S){_.error("设备不存在");return}const F=`testing_${u}`,Q=S;Q[F]=!0;try{const pe=(await Ee.post("/agent/mock",{agent_id:r,action:"keyboard",key:u,value:"test"})).data;pe?.code===0?_.success(`测试按钮 ${u} 成功`):_.error(pe?.msg||`测试按钮 ${u} 失败`)}catch(I){se(I,`测试按钮 ${u} 失败`)}finally{Q[F]=!1}},O=()=>{h.value&&(te(!0,!1),E(),d=setInterval(()=>{te(!1,!1)},ws))},E=()=>{d&&(clearInterval(d),d=null)},le=r=>{r?O():E()},J=()=>te(!0,!1),me=(r,u)=>A(r,u),z=async()=>{try{Z.value=!0;const r=await qe("paired","GET");if(r?.code===0){const u=Array.isArray(r.data)?r.data:[];N.value=u.map(S=>({name:S.name||"",address:S.address||"",...S,connecting:!1,disconnecting:!1,connected:S.connected??!1})),_.success(`已获取 ${N.value.length} 个已配对蓝牙设备`)}else _.error(r?.msg||"获取已配对设备列表失败")}catch(r){se(r,"获取已配对设备列表失败")}finally{Z.value=!1}},b=async r=>{if(!r.address){_.error("设备地址无效");return}try{r.connecting=!0;const u=await qe("connect","POST",{address:r.address});u?.code===0?(_.success(`成功连接到设备: ${r.name}`),r.connected=!0,await z()):_.error(u?.msg||"连接设备失败")}catch(u){se(u,"连接设备失败")}finally{r.connecting=!1}},M=async r=>{if(!r.address){_.error("设备地址无效");return}try{r.disconnecting=!0;const u=await qe("disconnect","POST",{address:r.address});u?.code===0?(_.success(`已断开设备: ${r.name}`),r.connected=!1,await z()):_.error(u?.msg||"断开设备失败")}catch(u){se(u,"断开设备失败")}finally{r.disconnecting=!1}},x=()=>z(),k=ue(()=>i.value==="agent"?m.value:i.value==="bluetooth"?Z.value:!1),w=ue(()=>{switch(i.value){case"dlna":return v.value;case"mi":return D.value;default:return!1}}),ee=()=>{i.value==="agent"?J():i.value==="bluetooth"&&x()},ye=()=>{switch(i.value){case"dlna":ke();break;case"mi":q();break}},g=r=>r.deviceID||r.address||"",U=r=>Math.max(0,Math.min(100,r)),C=r=>({...r,volume:void 0,_volumeChanging:!1,_volumeRefreshing:!1}),q=async()=>{try{D.value=!0;const u=(await Ee.get("/mi/scan",{params:{timeout:Pt}})).data;if(u?.code===0){const S=(u.data||[]).map(F=>C(F));t.value=S,await Promise.allSettled(S.map(F=>G(F))),_.success(`扫描到 ${S.length} 个小米设备`)}else _.error(u?.msg||"扫描小米设备失败")}catch(r){se(r,"扫描小米设备失败")}finally{D.value=!1}},G=async r=>{const u=g(r);if(!u)return;const S=t.value.find(F=>g(F)===u);if(S){S._volumeRefreshing=!0;try{const Q=(await Ee.get("/mi/volume",{params:{device_id:u}})).data;if(Q?.code===0)S.volume=Q.data?.volume??Q.data??void 0;else{const I=S.name||u;_.error(Q?.msg||`获取设备 ${I} 音量失败`)}}catch(F){const Q=S.name||u;se(F,`获取设备 ${Q} 音量失败`)}finally{S._volumeRefreshing=!1}}},re=async(r,u)=>{const S=g(r);if(!S){_.error("设备ID无效");return}const F=U(u);r._volumeChanging=!0;try{const I=(await Ee.post("/mi/volume",{device_id:S,volume:F})).data;I?.code===0?(r.volume=F,_.success("音量设置成功")):_.error(I?.msg||"设置音量失败")}catch(Q){se(Q,"设置小米设备音量失败")}finally{r._volumeChanging=!1}},ve=async r=>{const u=g(r);if(!u){_.warning("设备ID无效");return}try{r._stopping=!0;const F=(await Ee.post("/mi/stop",{device_id:u})).data;F?.code===0?_.success("停止播放成功"):_.error(F?.msg||"停止播放失败")}catch(S){se(S,"停止小米设备播放失败")}finally{r._stopping=!1}},de=r=>r.location||r.address||"",Le=r=>({...r,volume:void 0,_volumeChanging:!1,_volumeRefreshing:!1}),ke=async()=>{try{v.value=!0;const u=(await Ee.get("/dlna/scan",{params:{timeout:Pt}})).data;if(u?.code===0){const S=(u.data||[]).map(F=>Le(F));j.value=S,await Promise.allSettled(S.map(F=>$e(F))),_.success(`扫描到 ${S.length} 个 DLNA 设备`)}else _.error(u?.msg||"扫描 DLNA 设备失败")}catch(r){se(r,"扫描 DLNA 设备失败")}finally{v.value=!1}},$e=async r=>{const u=de(r);if(!u)return;const S=j.value.find(F=>de(F)===u);if(S){S._volumeRefreshing=!0;try{const Q=(await Ee.get("/dlna/volume",{params:{location:u}})).data;if(Q?.code===0)S.volume=Q.data?.volume??Q.data??void 0;else{const I=S.name||u;_.error(Q?.msg||`获取设备 ${I} 音量失败`)}}catch(F){const Q=S.name||u;se(F,`获取设备 ${Q} 音量失败`)}finally{S._volumeRefreshing=!1}}},Se=async(r,u)=>{const S=de(r);if(!S){_.error("设备位置无效");return}const F=U(u);r._volumeChanging=!0;try{const I=(await Ee.post("/dlna/volume",{location:S,volume:F})).data;I?.code===0?(r.volume=F,_.success("音量设置成功")):_.error(I?.msg||"设置音量失败")}catch(Q){se(Q,"设置 DLNA 设备音量失败")}finally{r._volumeChanging=!1}},$=async r=>{const u=de(r);if(!u){_.warning("设备位置无效");return}try{r._stopping=!0;const F=(await Ee.post("/dlna/stop",{location:u})).data;F?.code===0?_.success("停止播放成功"):_.error(F?.msg||"停止播放失败")}catch(S){se(S,"停止 DLNA 设备播放失败")}finally{r._stopping=!1}},K=()=>{L.value=!1};return Ne(()=>c.visible,r=>{L.value=r,r&&h.value?O():E()},{immediate:!0}),Ne(L,r=>{r!==c.visible&&p("update:visible",r)}),Ne(i,(r,u)=>{u==="agent"&&r!=="agent"&&E(),r==="agent"&&u!=="agent"&&h.value&&O(),r==="bluetooth"&&u!=="bluetooth"&&x()}),ot(()=>{c.visible&&(h.value&&i.value==="agent"&&O(),i.value==="bluetooth"&&x())}),At(()=>{E()}),(r,u)=>{const S=Je,F=ze,Q=yt,I=Ot,pe=ht,Oe=Vt,We=ys,y=hs,V=bs,H=Rt,oe=wt;return f(),ne(H,{modelValue:L.value,"onUpdate:modelValue":u[2]||(u[2]=T=>L.value=T),size:1200,direction:"rtl","before-close":K,"header-class":"h-12 !mb-1"},{header:a(()=>[n("div",ja,[u[5]||(u[5]=n("span",{class:"text-lg font-semibold"},"设备管理",-1)),i.value==="agent"||i.value==="bluetooth"?(f(),P(De,{key:0},[l(F,{type:"primary",plain:"",size:"small",onClick:ee,loading:k.value},{default:a(()=>[k.value?ie("",!0):(f(),ne(S,{key:0},{default:a(()=>[l(o(Ye))]),_:1})),u[3]||(u[3]=n("span",{class:"ml-1"},"刷新",-1))]),_:1},8,["loading"]),i.value==="agent"?(f(),ne(Q,{key:0,modelValue:h.value,"onUpdate:modelValue":u[0]||(u[0]=T=>h.value=T),size:"small","active-text":"自动刷新","inactive-text":"",onChange:le},null,8,["modelValue"])):ie("",!0)],64)):(f(),ne(F,{key:1,type:"primary",plain:"",size:"small",onClick:ye,loading:w.value},{default:a(()=>[w.value?ie("",!0):(f(),ne(S,{key:0},{default:a(()=>[l(o(Ye))]),_:1})),u[4]||(u[4]=n("span",{class:"ml-1"},"扫描",-1))]),_:1},8,["loading"]))])]),default:a(()=>[l(V,{modelValue:i.value,"onUpdate:modelValue":u[1]||(u[1]=T=>i.value=T),class:"h-full flex flex-col"},{default:a(()=>[l(We,{label:"Agent设备",name:"agent"},{default:a(()=>[n("div",Wa,[he((f(),ne(Oe,{data:s.value,stripe:"",class:"w-full",height:600},{empty:a(()=>[...u[8]||(u[8]=[n("div",{class:"text-center text-gray-400 py-8"},"暂无设备，请等待设备注册",-1)])]),default:a(()=>[l(I,{prop:"name",label:"设备名称","min-width":"150"}),l(I,{label:"详情","min-width":"250"},{default:a(({row:T})=>[n("div",Ga,[n("div",Ya,[u[6]||(u[6]=n("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"地址：",-1)),n("span",Ka,R(T.address),1)]),n("div",Ha,[u[7]||(u[7]=n("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"ID：",-1)),n("span",Ja,R(T.agent_id),1)])])]),_:1}),l(I,{label:"支持的操作","min-width":"100"},{default:a(({row:T})=>[(f(!0),P(De,null,Ae(T.actions,be=>(f(),ne(pe,{key:be,size:"small",type:"info",class:"mr-1"},{default:a(()=>[X(R(be),1)]),_:2},1024))),128)),!T.actions||T.actions.length===0?(f(),P("span",Xa,"无")):ie("",!0)]),_:1}),l(I,{label:"状态/心跳",width:"90"},{default:a(({row:T})=>[n("div",qa,[l(pe,{type:T.is_online?"success":"danger",size:"small"},{default:a(()=>[X(R(T.is_online?"在线":"离线"),1)]),_:2},1032,["type"]),n("span",Qa,R(T.last_heartbeat_ago)+"秒前 ",1)])]),_:1}),l(I,{label:"测试按钮",width:"180"},{default:a(({row:T})=>[n("div",Za,[(f(),P(De,null,Ae(W,(be,ge)=>n("div",{key:ge,class:"flex gap-1 items-center"},[l(S,{class:"!w-4 !h-5"},{default:a(()=>[l(o(Et))]),_:1}),n("span",Ia,R(be.label),1),(f(!0),P(De,null,Ae(be.keys,(Ce,He)=>(f(),ne(F,{key:He,size:"small",type:"primary",plain:"",onClick:$t=>me(T.agent_id,Ce),loading:T[`testing_${Ce}`],class:"flex-1"},{default:a(()=>[X(R(Ce),1)]),_:2},1032,["onClick","loading"]))),128))])),64))])]),_:1})]),_:1},8,["data"])),[[oe,m.value]])])]),_:1}),l(We,{label:"蓝牙设备",name:"bluetooth"},{default:a(()=>[n("div",ei,[he((f(),ne(Oe,{data:N.value,stripe:"",class:"w-full",height:600},{empty:a(()=>[...u[11]||(u[11]=[n("div",{class:"text-center text-gray-400 py-8"},'暂无设备，点击"扫描"开始扫描',-1)])]),default:a(()=>[l(I,{prop:"name",label:"设备名称","min-width":"200"}),l(I,{prop:"address",label:"设备地址","min-width":"180"}),l(I,{label:"信号强度",width:"120"},{default:a(({row:T})=>[T.rssi!==void 0?(f(),P("span",ti,R(T.rssi)+" dBm ",1)):(f(),P("span",li,"-"))]),_:1}),l(I,{label:"状态",width:"100"},{default:a(({row:T})=>[l(pe,{type:T.connecting||T.disconnecting?"warning":T.connected?"success":(T.rssi!==void 0,"info"),size:"small"},{default:a(()=>[X(R(T.connecting?"连接中":T.disconnecting?"断开中":T.connected?"已连接":T.rssi!==void 0?"已发现":"未知"),1)]),_:2},1032,["type"])]),_:1}),l(I,{label:"操作",width:"120",fixed:"right"},{default:a(({row:T})=>[T.connected?(f(),ne(F,{key:1,type:"danger",size:"small",onClick:be=>M(T),loading:T.disconnecting,disabled:T.connecting||T.disconnecting},{default:a(()=>[...u[10]||(u[10]=[X(" 断开 ",-1)])]),_:1},8,["onClick","loading","disabled"])):(f(),ne(F,{key:0,type:"primary",size:"small",onClick:be=>b(T),loading:T.connecting,disabled:T.connecting||T.disconnecting},{default:a(()=>[...u[9]||(u[9]=[X(" 连接 ",-1)])]),_:1},8,["onClick","loading","disabled"]))]),_:1})]),_:1},8,["data"])),[[oe,Z.value]])])]),_:1}),l(We,{label:"DLNA设备",name:"dlna"},{default:a(()=>[n("div",si,[he((f(),ne(Oe,{data:j.value,stripe:"",class:"w-full",height:600},{empty:a(()=>[...u[15]||(u[15]=[n("div",{class:"text-center text-gray-400 py-8"},'暂无设备，点击"扫描"开始扫描',-1)])]),default:a(()=>[l(I,{prop:"name",label:"设备名称","min-width":"150"}),l(I,{label:"详情","min-width":"400"},{default:a(({row:T})=>[n("div",ni,[n("div",ai,[u[12]||(u[12]=n("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"位置：",-1)),n("span",{class:"text-gray-800 flex-1 truncate",title:T.location},R(T.location||"-"),9,ii)]),T.manufacturer||T.model_name?(f(),P("div",oi,[u[13]||(u[13]=n("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"型号：",-1)),n("span",ri,R(T.manufacturer||"")+" "+R(T.model_name||""),1)])):ie("",!0)])]),_:1}),l(I,{label:"功能","min-width":"200"},{default:a(({row:T})=>[n("div",di,[n("div",ui,[u[14]||(u[14]=n("span",{class:"text-gray-600 inline-block w-11 flex-shrink-0"},"音量：",-1)),n("span",ci,R(T.volume!==void 0?T.volume:"-"),1),l(F,{size:"small",type:"info",plain:"",circle:"",onClick:be=>$e(T),loading:T._volumeRefreshing,disabled:T._volumeRefreshing||T._volumeChanging,title:"刷新音量",class:"p-0.5 !w-[17px] !h-[17px]"},{default:a(()=>[T._volumeRefreshing?ie("",!0):(f(),ne(S,{key:0},{default:a(()=>[l(o(Ye))]),_:1}))]),_:2},1032,["onClick","loading","disabled"]),l(F,{size:"small",class:"!w-8 !h-6",type:"danger",plain:"",onClick:be=>$(T),disabled:T._stopping,title:"停止播放"},{default:a(()=>[T._stopping?(f(),ne(S,{key:0,class:"animate-spin"},{default:a(()=>[l(o(Xe))]),_:1})):(f(),P("span",fi,"⏹"))]),_:2},1032,["onClick","disabled"])]),n("div",vi,[l(y,{"model-value":T.volume??0,onInput:be=>T.volume=be,onChange:be=>Se(T,be),min:5,max:100,step:1,disabled:T._volumeChanging||T._volumeRefreshing||T.volume===void 0,size:"small",class:"flex-1 max-w-[200px]"},null,8,["model-value","onInput","onChange","disabled"])])])]),_:1})]),_:1},8,["data"])),[[oe,v.value]])])]),_:1}),l(We,{label:"小米设备",name:"mi"},{default:a(()=>[n("div",mi,[he((f(),ne(Oe,{data:t.value,stripe:"",class:"w-full",height:600},{empty:a(()=>[...u[20]||(u[20]=[n("div",{class:"text-center text-gray-400 py-8"},'暂无设备，点击"扫描"开始扫描',-1)])]),default:a(()=>[l(I,{prop:"name",label:"设备名称","min-width":"150"}),l(I,{label:"详情","min-width":"400"},{default:a(({row:T})=>[n("div",gi,[n("div",pi,[u[16]||(u[16]=n("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"ID：",-1)),n("span",yi,R(T.deviceID||"-"),1)]),n("div",hi,[u[17]||(u[17]=n("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"地址：",-1)),n("span",bi,R(T.mac||"-"),1),u[18]||(u[18]=n("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"DTD：",-1)),n("span",xi,R(T.miotDID||"-"),1)])])]),_:1}),l(I,{label:"功能","min-width":"200"},{default:a(({row:T})=>[n("div",wi,[n("div",$i,[u[19]||(u[19]=n("span",{class:"text-gray-600 inline-block w-11 flex-shrink-0"},"音量：",-1)),n("span",Di,R(T.volume!==void 0?T.volume:"-"),1),l(F,{size:"small",type:"info",plain:"",circle:"",onClick:be=>G(T),loading:T._volumeRefreshing,disabled:T._volumeRefreshing||T._volumeChanging,title:"刷新音量",class:"p-0.5 !w-[17px] !h-[17px]"},{default:a(()=>[T._volumeRefreshing?ie("",!0):(f(),ne(S,{key:0},{default:a(()=>[l(o(Ye))]),_:1}))]),_:2},1032,["onClick","loading","disabled"]),l(F,{size:"small",class:"!w-8 !h-6",type:"danger",plain:"",onClick:be=>ve(T),disabled:T._stopping,title:"停止播放"},{default:a(()=>[T._stopping?(f(),ne(S,{key:0,class:"animate-spin"},{default:a(()=>[l(o(Xe))]),_:1})):(f(),P("span",Ci,"⏹"))]),_:2},1032,["onClick","disabled"])]),n("div",Fi,[l(y,{"model-value":T.volume??0,onInput:be=>T.volume=be,onChange:be=>re(T,be),min:5,max:100,step:1,disabled:T._volumeChanging||T._volumeRefreshing||T.volume===void 0,size:"small",class:"flex-1 max-w-[200px]"},null,8,["model-value","onInput","onChange","disabled"])])])]),_:1})]),_:1},8,["data"])),[[oe,D.value]])])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}}),_i={class:"flex gap-4 h-[500px]"},Pi={class:"w-64 flex flex-col border rounded p-3"},Si={class:"flex-1 overflow-y-auto space-y-2"},Bi=["onClick"],Ai={class:"text-sm flex-1 truncate"},Ti={class:"text-xs text-gray-500 ml-2 whitespace-nowrap"},Mi={key:0,class:"text-blue-600 font-medium"},Ei={key:1},Li={key:0,class:"text-xs text-gray-400 text-center py-2"},Ni={class:"flex-1 flex flex-col border rounded p-3"},Ui={key:0,class:"flex-1 overflow-y-auto"},zi={class:"mb-3"},Vi={class:"space-y-1"},Oi=["onClick"],Ri={class:"text-xs text-gray-500 whitespace-nowrap"},ji={key:0,class:"text-blue-600 font-medium"},Wi={key:1},Gi={class:"border-t pt-3"},Yi={class:"flex items-center gap-2 py-1"},Ki={class:"text-xs text-gray-500 whitespace-nowrap"},Hi={key:0,class:"text-blue-600 font-medium"},Ji={key:1},Xi={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},qi={class:"flex items-center justify-between"},Qi={class:"text-sm text-gray-500"},Zi={key:0},Ii={class:"flex gap-2"},eo=Ue({__name:"PlaylistSelectDialog",props:{visible:{type:Boolean,default:!1},playlistCollection:{default:()=>[]},selectedFiles:{default:()=>[]},onCopy:{type:Function,default:void 0},onRemove:{type:Function,default:void 0}},emits:["update:visible"],setup(e,{emit:B}){const c=e,p=B,L=Y(c.visible),i=Y(null),s=Y([]),m=Y(!1),h=ue(()=>c.playlistCollection.find(z=>z.id===i.value)||null),d=ue(()=>s.value.length>0||m.value),N=z=>{const b=h.value;if(!b||!b.pre_lists||!Array.isArray(b.pre_lists)||b.pre_lists.length!==7)return 0;const M=b.pre_lists[z];return Array.isArray(M)?M.length:0},Z=()=>{const z=h.value;return!z||!z.playlist?0:Array.isArray(z.playlist)?z.playlist.length:0},j=z=>{if(!z)return 0;const b=z.pre_lists&&Array.isArray(z.pre_lists)&&z.pre_lists.length===7?z.pre_lists.reduce((x,k)=>x+(Array.isArray(k)?k.length:0),0):0,M=Array.isArray(z.playlist)?z.playlist.length:0;return b+M},v=()=>!c.selectedFiles||c.selectedFiles.length===0?new Set:new Set(c.selectedFiles.map(z=>typeof z=="string"?z:z.uri||String(z))),t=z=>{if(!z||!c.selectedFiles||c.selectedFiles.length===0)return 0;const b=v();let M=0;return z.pre_lists&&Array.isArray(z.pre_lists)&&z.pre_lists.length===7&&z.pre_lists.forEach(x=>{Array.isArray(x)&&x.forEach(k=>{const w=k.uri||String(k);b.has(w)&&M++})}),Array.isArray(z.playlist)&&z.playlist.forEach(x=>{const k=x.uri||String(x);b.has(k)&&M++}),M},D=z=>{const b=h.value;if(!b||!c.selectedFiles||c.selectedFiles.length===0||!b.pre_lists||!Array.isArray(b.pre_lists)||b.pre_lists.length!==7)return 0;const M=b.pre_lists[z];if(!Array.isArray(M))return 0;const x=v();let k=0;return M.forEach(w=>{const ee=w.uri||String(w);x.has(ee)&&k++}),k},W=()=>{const z=h.value;if(!z||!c.selectedFiles||c.selectedFiles.length===0||!Array.isArray(z.playlist))return 0;const b=v();let M=0;return z.playlist.forEach(x=>{const k=x.uri||String(x);b.has(k)&&M++}),M},te=z=>{i.value=z,s.value=[],m.value=!1},A=z=>{const b=s.value.indexOf(z);b>-1?s.value.splice(b,1):s.value.push(z)},O=()=>{m.value=!m.value},E=async()=>{if(!h.value||!c.selectedFiles||c.selectedFiles.length===0||!d.value){_.warning("请选择播放列表和目标列表，并至少选中一个文件");return}try{const z=c.selectedFiles.map(k=>typeof k=="string"?k:k.uri||String(k)),b=s.value.length,M=m.value;let x="";if(b>0&&M)x=`${b}个前置文件列表和正式文件列表`;else if(b>0){const k=["周一","周二","周三","周四","周五","周六","周日"];x=`前置文件列表（${s.value.map(ee=>k[ee]).join("、")}）`}else M&&(x="正式文件列表");await Be.confirm(`确定要将选中的 ${z.length} 个文件复制到播放列表"${h.value.name}"的${x}吗？`,"确认复制",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),c.onCopy&&(await c.onCopy({playlistId:i.value,files:z,preLists:s.value,filesList:m.value}),_.success("文件已复制到播放列表"),J())}catch(z){z!=="cancel"&&se(z,"复制文件失败")}},le=async()=>{if(!h.value||!c.selectedFiles||c.selectedFiles.length===0||!d.value){_.warning("请选择播放列表和目标列表，并至少选中一个文件");return}try{const z=c.selectedFiles.map(k=>typeof k=="string"?k:k.uri||String(k)),b=s.value.length,M=m.value;let x="";if(b>0&&M)x=`${b}个前置文件列表和正式文件列表`;else if(b>0){const k=["周一","周二","周三","周四","周五","周六","周日"];x=`前置文件列表（${s.value.map(ee=>k[ee]).join("、")}）`}else M&&(x="正式文件列表");await Be.confirm(`确定要从播放列表"${h.value.name}"的${x}中删除选中的 ${z.length} 个文件吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),c.onRemove&&(await c.onRemove({playlistId:i.value,files:z,preLists:s.value,filesList:m.value}),_.success("文件已从播放列表删除"),J())}catch(z){z!=="cancel"&&se(z,"删除文件失败")}},J=()=>{L.value=!1,i.value=null,s.value=[],m.value=!1},me=()=>{c.playlistCollection&&c.playlistCollection.length>0&&!i.value&&(i.value=c.playlistCollection[0].id)};return Ne(()=>c.playlistCollection,z=>{z&&z.length>0&&!i.value&&(i.value=z[0].id)},{immediate:!0}),Ne(()=>c.visible,z=>{L.value=z,z&&me()}),Ne(L,z=>{z!==c.visible&&p("update:visible",z)}),ot(()=>{me()}),(z,b)=>{const M=rt,x=ze,k=Ie;return f(),ne(k,{modelValue:L.value,"onUpdate:modelValue":b[1]||(b[1]=w=>L.value=w),title:"应用到列表",width:"900","before-close":J},{footer:a(()=>[n("div",qi,[n("div",Qi,[e.selectedFiles&&e.selectedFiles.length>0?(f(),P("span",Zi," 已选择 "+R(e.selectedFiles.length)+" 个文件 ",1)):ie("",!0)]),n("div",Ii,[l(x,{onClick:J},{default:a(()=>[...b[7]||(b[7]=[X("取消",-1)])]),_:1}),l(x,{type:"primary",onClick:E,disabled:!d.value||!e.selectedFiles||e.selectedFiles.length===0},{default:a(()=>[...b[8]||(b[8]=[X(" 复制到列表 ",-1)])]),_:1},8,["disabled"]),l(x,{type:"danger",onClick:le,disabled:!d.value||!e.selectedFiles||e.selectedFiles.length===0},{default:a(()=>[...b[9]||(b[9]=[X(" 从列表删除 ",-1)])]),_:1},8,["disabled"])])])]),default:a(()=>[n("div",_i,[n("div",Pi,[b[2]||(b[2]=n("div",{class:"text-sm font-semibold mb-2"},"选择播放列表",-1)),n("div",Si,[(f(!0),P(De,null,Ae(e.playlistCollection,w=>(f(),P("div",{key:w.id,class:Te(["flex items-center justify-between px-2 py-2 rounded cursor-pointer hover:bg-gray-50 transition-colors",{"bg-blue-50 border border-blue-200":w.id===i.value}]),onClick:ee=>te(w.id)},[n("span",Ai,R(w.name),1),n("span",Ti,[e.selectedFiles&&e.selectedFiles.length>0?(f(),P("span",Mi,R(t(w))+"/"+R(j(w)),1)):(f(),P("span",Ei,R(j(w)),1))])],10,Bi))),128)),e.playlistCollection.length===0?(f(),P("div",Li," 暂无播放列表 ")):ie("",!0)])]),n("div",Ni,[b[6]||(b[6]=n("div",{class:"text-sm font-semibold mb-3"},"选择目标列表（可多选）",-1)),h.value?(f(),P("div",Ui,[n("div",zi,[b[4]||(b[4]=n("div",{class:"text-xs text-gray-600 mb-2 font-semibold"},"前置文件",-1)),n("div",Vi,[(f(),P(De,null,Ae(["周一","周二","周三","周四","周五","周六","周日"],(w,ee)=>n("div",{key:ee,class:"flex items-center gap-2 py-1"},[l(M,{"model-value":s.value.includes(ee),onChange:ye=>A(ee),size:"small"},null,8,["model-value","onChange"]),n("span",{class:Te(["text-xs flex-1 cursor-pointer hover:text-blue-500",{"text-blue-600 font-medium":s.value.includes(ee)}]),onClick:ye=>A(ee)},R(w),11,Oi),n("span",Ri,[e.selectedFiles&&e.selectedFiles.length>0?(f(),P("span",ji,R(D(ee))+"/"+R(N(ee)),1)):(f(),P("span",Wi,R(N(ee)),1)),b[3]||(b[3]=n("span",{class:"text-gray-400"}," 个文件",-1))])])),64))])]),n("div",Gi,[n("div",Yi,[l(M,{"model-value":m.value,onChange:O,size:"small"},null,8,["model-value"]),n("span",{class:Te(["text-xs font-semibold text-gray-600 cursor-pointer hover:text-blue-500 flex-1",{"text-blue-600":m.value}]),onClick:b[0]||(b[0]=w=>O())}," 正式文件 ",2),n("span",Ki,[e.selectedFiles&&e.selectedFiles.length>0?(f(),P("span",Hi,R(W())+"/"+R(Z()),1)):(f(),P("span",Ji,R(Z()),1)),b[5]||(b[5]=n("span",{class:"text-gray-400"}," 个文件",-1))])])])])):(f(),P("div",Xi," 请先选择一个播放列表 "))])])]),_:1},8,["modelValue"])}}}),to={class:"flex gap-4 h-full"},lo={class:"w-64 border rounded p-3 flex flex-col"},so={class:"flex items-center justify-between mb-3"},no={class:"flex-1 overflow-y-auto space-y-2"},ao=["onClick"],io={class:"text-sm font-medium truncate"},oo={class:"text-xs text-gray-500 mt-1"},ro={class:"flex items-center gap-1 flex-shrink-0"},uo={key:0,class:"text-sm text-gray-400 text-center py-4"},co={class:"flex-1 border rounded p-3 flex flex-col"},fo={class:"mb-3 flex items-center justify-between"},vo={class:"flex items-center gap-2"},mo={class:"text-base font-semibold"},go={key:0,class:"flex items-center gap-2"},po={key:0,class:"ml-1 text-xs"},yo={class:"flex-1 overflow-y-auto"},ho={key:0,class:"space-y-1"},bo=["onClick"],xo={class:"text-xs text-gray-500 w-8"},wo=["title"],$o={key:1,class:"text-sm text-gray-400 text-center py-8"},Do={class:"w-96 border rounded p-3 flex flex-col"},Co={class:"mb-3"},Fo={class:"flex gap-2 mb-3"},ko={class:"mb-3"},_o={class:"space-y-1 max-h-48 overflow-y-auto border rounded p-1"},Po=["onClick"],So={class:"text-sm flex-1"},Bo={class:"text-xs text-gray-500 ml-2 whitespace-nowrap"},Ao={key:0,class:"text-xs text-gray-400 text-center py-2"},To={key:0,class:"flex-1 overflow-y-auto space-y-3"},Mo={class:"border rounded p-2"},Eo={class:"space-y-1"},Lo=["onClick"],No={class:"text-xs text-gray-500 whitespace-nowrap"},Uo={class:"border rounded p-2"},zo={class:"flex items-center gap-2 mb-2"},Vo={class:"text-xs text-gray-500 whitespace-nowrap"},Oo={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},St="t_batch_list",Bt="0",Ro=7,jo=Ue({__name:"BatchDrawer",props:{visible:{type:Boolean,default:!1},playlistCollection:{default:()=>[]},onAddFiles:{type:Function,default:void 0},onRemoveFiles:{type:Function,default:void 0}},emits:["update:visible","refresh"],setup(e,{emit:B}){const c=e,p=B,L=Y([]),i=Y(null),s=Y(null),m=Y([]),h=Y(!1),d=Y([]),N=Y(!1),Z=Y(!1),j=Y(!1),v=Y(c.visible),t=ue(()=>L.value.find(y=>y.id===i.value)||null),D=ue(()=>c.playlistCollection.find(y=>y.id===s.value)||null),W=ue(()=>m.value.length>0||h.value),te=ue(()=>!t.value||!t.value.files||t.value.files.length===0?!1:d.value.length===t.value.files.length),A=ue(()=>{if(!t.value||!t.value.files||t.value.files.length===0)return!1;const y=d.value.length,V=t.value.files.length;return y>0&&y<V}),O=y=>typeof y=="string"?y:y?.uri||String(y),E=()=>t.value?.files?d.value.map(y=>t.value.files[y]).filter(y=>y!==null):[],le=()=>new Set(E().map(O)),J=y=>!!(y?.pre_lists&&Array.isArray(y.pre_lists)&&y.pre_lists.length===Ro),me=y=>!!(y?.playlist&&Array.isArray(y.playlist)),z=(y,V)=>{if(!Array.isArray(y))return 0;let H=0;return y.forEach(oe=>{V.has(O(oe))&&H++}),H},b=y=>{const V=D.value;if(!J(V))return 0;const H=V.pre_lists[y];return Array.isArray(H)?H.length:0},M=y=>{if(!t.value||!D.value)return 0;const V=le();if(V.size===0)return 0;const H=D.value;if(!J(H))return 0;const oe=H.pre_lists[y];return z(oe,V)},x=()=>{const y=D.value;return me(y)?y.playlist.length:0},k=()=>{if(!t.value||!D.value)return 0;const y=le();if(y.size===0)return 0;const V=D.value;return me(V)?z(V.playlist,y):0},w=y=>{if(!y)return 0;let V=0;return J(y)&&y.pre_lists.forEach(H=>{Array.isArray(H)&&(V+=H.length)}),me(y)&&(V+=y.playlist.length),V},ee=y=>{if(!t.value||!y)return 0;const V=le();if(V.size===0)return 0;let H=0;return J(y)&&y.pre_lists.forEach(oe=>{H+=z(oe,V)}),me(y)&&(H+=z(y.playlist,V)),H},ye=async()=>{try{j.value=!0;const y=await ts(St,Bt);let V=[];if(y!=null)if(typeof y=="string"&&y.trim()!=="")try{const H=JSON.parse(y);V=Array.isArray(H)?H:[]}catch{V=[]}else Array.isArray(y)&&(V=y);L.value=V,U()}catch(y){L.value=[],se(y,"加载Batch列表失败")}finally{j.value=!1}},g=async()=>{try{const y=JSON.stringify(L.value);await ls(St,Bt,y)}catch(y){throw se(y,"保存Batch列表失败"),y}},U=()=>{if(L.value.length===0||i.value)return;const y=L.value[0];i.value=y.id,y?.files?.length>0&&(d.value=y.files.map((V,H)=>H))},C=(y,V)=>{const H=y.indexOf(V);H>-1?y.splice(H,1):y.push(V)},q=async()=>{try{const{value:y}=await Be.prompt("请输入Batch名称","创建Batch",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:"Batch名称",inputValidator:oe=>!!oe&&oe.trim().length>0||"名称不能为空"}),V=y.trim(),H={id:Date.now().toString(),name:V,files:[],createTime:new Date().toISOString()};L.value.push(H),await g(),_.success("Batch创建成功"),i.value=H.id}catch(y){y!=="cancel"&&se(y,"创建Batch失败")}},G=async y=>{const V=L.value.find(H=>H.id===y);if(V)try{const{value:H}=await Be.prompt("请输入Batch名称","编辑Batch",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:V.name,inputPlaceholder:"Batch名称",inputValidator:oe=>!!oe&&oe.trim().length>0||"名称不能为空"});V.name=H.trim(),await g(),_.success("Batch名称已更新")}catch(H){H!=="cancel"&&se(H,"编辑Batch失败")}},re=async y=>{const V=L.value.find(H=>H.id===y);if(V)try{await Be.confirm(`确定要删除Batch "${V.name}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const H=L.value.findIndex(oe=>oe.id===y);H>-1&&(L.value.splice(H,1),await g(),i.value===y&&(i.value=null),_.success("Batch已删除"))}catch(H){H!=="cancel"&&se(H,"删除Batch失败")}},ve=y=>{i.value=y;const V=L.value.find(H=>H.id===y);V&&V.files&&V.files.length>0?d.value=V.files.map((H,oe)=>oe):d.value=[]},de=y=>{C(d.value,y)},Le=y=>{!t.value||!t.value.files||(y?d.value=t.value.files.map((V,H)=>H):d.value=[])},ke=async()=>{if(!(!t.value||d.value.length===0))try{const y=d.value.length;await Be.confirm(`确定要删除选中的 ${y} 个文件吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),[...new Set(d.value)].sort((H,oe)=>oe-H).forEach(H=>{H>=0&&H<t.value.files.length&&t.value.files.splice(H,1)}),t.value.files.length>0?d.value=t.value.files.map((H,oe)=>oe):d.value=[],await g(),_.success(`已删除 ${y} 个文件`)}catch(y){y!=="cancel"&&se(y,"删除失败")}},$e=()=>{if(!t.value){_.warning("请先选择一个Batch");return}N.value=!0},Se=async y=>{if(!(!t.value||y.length===0))try{Z.value=!0;const V=t.value,H=new Set(V.files.map(O)),oe=y.filter(T=>!H.has(T)).map(T=>({uri:T}));V.files.push(...oe),await g(),V.files.length>0&&(d.value=V.files.map((T,be)=>be)),_.success(`成功添加 ${oe.length} 个文件`),N.value=!1}catch(V){se(V,"添加文件失败")}finally{Z.value=!1}},$=()=>{N.value=!1},K=y=>{s.value=s.value===y?null:y,m.value=[],h.value=!1},r=y=>{C(m.value,y)},u=y=>{h.value=y!==void 0?y:!h.value},S=()=>!t.value||!s.value||d.value.length===0||!W.value?(_.warning("请选择Batch、播放列表和目标列表，并至少选中一个文件"),!1):!0,F=async()=>{if(S())try{const y=E().map(O);await Be.confirm(`确定要将选中的 ${y.length} 个文件添加到选中的列表吗？`,"确认添加",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),c.onAddFiles&&(await c.onAddFiles({playlistId:s.value,files:y,preLists:m.value,filesList:h.value}),_.success("文件已添加到播放列表"))}catch(y){y!=="cancel"&&se(y,"添加文件失败")}},Q=async()=>{if(S())try{const y=E().map(O);await Be.confirm(`确定要从选中的列表中删除选中的 ${y.length} 个文件吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),c.onRemoveFiles&&(await c.onRemoveFiles({playlistId:s.value,files:y,preLists:m.value,filesList:h.value}),_.success("文件已从播放列表删除"))}catch(y){y!=="cancel"&&se(y,"删除文件失败")}},I=()=>{v.value=!1},pe=()=>{m.value=[],h.value=!1,d.value=[]},Oe=()=>{i.value=null,s.value=null,pe()},We=()=>{c.playlistCollection?.length>0?s.value=c.playlistCollection[0].id:s.value=null};return Ne(()=>c.playlistCollection,y=>{y?.length>0&&!s.value&&(s.value=y[0].id)},{immediate:!0}),Ne(()=>c.visible,y=>{v.value=y,y?(pe(),We(),ye()):Oe()},{immediate:!0}),Ne(v,y=>{y!==c.visible&&p("update:visible",y)}),ot(()=>{ye()}),(y,V)=>{const H=Je,oe=ze,T=rt,be=Rt;return f(),ne(be,{modelValue:v.value,"onUpdate:modelValue":V[5]||(V[5]=ge=>v.value=ge),title:"批量模式",size:1200,direction:"rtl","header-class":"h-12 !mb-1","before-close":I},{default:a(()=>[n("div",to,[n("div",lo,[n("div",so,[V[6]||(V[6]=n("h3",{class:"text-base font-semibold"},"Batch列表",-1)),l(oe,{type:"primary",size:"small",onClick:q,plain:""},{default:a(()=>[l(H,null,{default:a(()=>[l(o(at))]),_:1})]),_:1})]),n("div",no,[(f(!0),P(De,null,Ae(L.value,ge=>(f(),P("div",{key:ge.id,class:Te(["border rounded px-3 py-2 hover:bg-gray-50 flex items-center gap-2",{"border-blue-500 bg-blue-50":ge.id===i.value}])},[n("div",{class:"flex-1 cursor-pointer",onClick:Ce=>ve(ge.id)},[n("div",io,R(ge.name),1),n("div",oo,R(ge.files?ge.files.length:0)+" 个文件 ",1)],8,ao),n("div",ro,[l(oe,{type:"default",plain:"",size:"small",circle:"",onClick:Fe(Ce=>re(ge.id),["stop"]),title:"删除"},{default:a(()=>[l(H,null,{default:a(()=>[l(o(Ve))]),_:1})]),_:1},8,["onClick"])])],2))),128)),L.value.length===0?(f(),P("div",uo,' 暂无Batch，点击"+"创建 ')):ie("",!0)])]),n("div",co,[n("div",fo,[n("div",vo,[n("h3",mo,R(t.value?t.value.name:"请选择一个Batch"),1),t.value?(f(),ne(oe,{key:0,type:"default",plain:"",size:"small",circle:"",onClick:V[0]||(V[0]=ge=>G(t.value.id)),title:"编辑"},{default:a(()=>[l(H,null,{default:a(()=>[l(o(Nt))]),_:1})]),_:1})):ie("",!0)]),t.value?(f(),P("div",go,[l(oe,{type:"default",size:"small",onClick:V[1]||(V[1]=ge=>Le(!te.value)),class:Te([{"!text-blue-600":te.value||A.value},"!w-20"]),plain:""},{default:a(()=>[te.value?(f(),ne(H,{key:0,class:"mr-1"},{default:a(()=>[l(o(Ze))]),_:1})):A.value?(f(),ne(H,{key:1,class:"mr-1"},{default:a(()=>[l(o(xt))]),_:1})):ie("",!0),V[7]||(V[7]=n("span",{class:"text-xs"},"全选",-1))]),_:1},8,["class"]),l(oe,{type:"primary",size:"small",onClick:$e,plain:"",class:"!w-20"},{default:a(()=>[l(H,null,{default:a(()=>[l(o(at))]),_:1})]),_:1}),l(oe,{type:"danger",size:"small",onClick:ke,disabled:d.value.length===0,plain:"",class:"!w-20"},{default:a(()=>[l(H,null,{default:a(()=>[l(o(Ve))]),_:1}),d.value.length>0?(f(),P("span",po,"("+R(d.value.length)+")",1)):ie("",!0)]),_:1},8,["disabled"])])):ie("",!0)]),n("div",yo,[t.value&&t.value.files&&t.value.files.length>0?(f(),P("div",ho,[(f(!0),P(De,null,Ae(t.value.files,(ge,Ce)=>(f(),P("div",{key:Ce,class:Te(["flex items-center gap-2 p-2 border border-blue-500 rounded hover:bg-gray-50 cursor-pointer",{"bg-blue-50":d.value.includes(Ce)}]),onClick:He=>de(Ce)},[l(T,{"model-value":d.value.includes(Ce),onChange:He=>de(Ce),class:"!h-6",onClick:V[2]||(V[2]=Fe(()=>{},["stop"])),size:"default"},null,8,["model-value","onChange"]),n("span",xo,R(Ce+1),1),n("span",{class:"flex-1 text-sm truncate",title:O(ge)},R(O(ge).split("/").pop()),9,wo)],10,bo))),128))])):(f(),P("div",$o,R(t.value?"该Batch暂无文件":"请先选择一个Batch"),1))])]),n("div",Do,[n("div",Co,[V[11]||(V[11]=n("h3",{class:"text-base font-semibold mb-2"},"Playlist操作",-1)),n("div",Fo,[l(oe,{type:"default",size:"small",onClick:F,disabled:!t.value||!s.value||d.value.length===0||!W.value,plain:""},{default:a(()=>[l(H,{class:"mr-1"},{default:a(()=>[l(o(at))]),_:1}),V[8]||(V[8]=X(" 添加到播放列表 ",-1))]),_:1},8,["disabled"]),l(oe,{type:"default",size:"small",onClick:Q,disabled:!t.value||!s.value||d.value.length===0||!W.value,plain:""},{default:a(()=>[l(H,{class:"mr-1"},{default:a(()=>[l(o(Ve))]),_:1}),V[9]||(V[9]=X(" 从播放列表删除 ",-1))]),_:1},8,["disabled"])]),n("div",ko,[V[10]||(V[10]=n("div",{class:"text-xs text-gray-500 mb-2"},"选择播放列表 进行批量操作",-1)),n("div",_o,[(f(!0),P(De,null,Ae(e.playlistCollection,ge=>(f(),P("div",{key:ge.id,class:Te(["flex items-center justify-between px-2 py-1.5 rounded cursor-pointer hover:bg-gray-50 transition-colors",{"bg-blue-50 border border-blue-200":ge.id===s.value}]),onClick:Ce=>K(ge.id)},[n("span",So,R(ge.name),1),n("span",Bo,R(ee(ge))+" / "+R(w(ge)),1)],10,Po))),128)),e.playlistCollection.length===0?(f(),P("div",Ao," 暂无播放列表 ")):ie("",!0)])])]),D.value?(f(),P("div",To,[n("div",Mo,[V[12]||(V[12]=n("div",{class:"text-xs font-semibold text-gray-600 mb-2"},"前置文件",-1)),n("div",Eo,[(f(),P(De,null,Ae(["周一","周二","周三","周四","周五","周六","周日"],(ge,Ce)=>n("div",{key:Ce,class:"flex items-center gap-2"},[l(T,{"model-value":m.value.includes(Ce),onChange:He=>r(Ce),size:"small"},null,8,["model-value","onChange"]),n("span",{class:Te(["text-xs flex-1 cursor-pointer hover:text-blue-500",{"text-blue-600 font-medium":m.value.includes(Ce)}]),onClick:He=>r(Ce)},R(ge),11,Lo),n("span",No,R(M(Ce))+" / "+R(b(Ce)),1)])),64))])]),n("div",Uo,[n("div",zo,[l(T,{"model-value":h.value,onChange:u,size:"small"},null,8,["model-value"]),n("span",{class:Te(["text-xs font-semibold text-gray-600 cursor-pointer hover:text-blue-500 flex-1",{"text-blue-600":h.value}]),onClick:V[3]||(V[3]=ge=>u())}," 正式文件 ",2),n("span",Vo,R(k())+" / "+R(x()),1)])])])):(f(),P("div",Oo," 请先选择一个播放列表 "))])]),l(Mt,{visible:N.value,"onUpdate:visible":V[4]||(V[4]=ge=>N.value=ge),title:"选择文件添加到Batch","confirm-button-text":"添加","confirm-loading":Z.value,onConfirm:Se,onClose:$},null,8,["visible","confirm-loading"])]),_:1},8,["modelValue"])}}});function Wo(){return{...{playlistCollection:Y([]),activePlaylistId:Y(""),playlistStatus:Y(null),playlistLoading:Y(!1),playlistRefreshing:Y(!1),playing:Y(!1),stopping:Y(!1),showMoreActions:Y(!1),editingPlaylistId:Y(null),editingPlaylistName:Y(""),fileBrowserDialogVisible:Y(!1),fileBrowserTarget:Y("files"),replaceFileInfo:Y(null),selectedWeekdayIndex:Y(null),preFilesDragMode:Y(!1),filesDragMode:Y(!1),preFilesBatchDeleteMode:Y(!1),filesBatchDeleteMode:Y(!1),selectedPreFileIndices:Y([]),selectedFileIndices:Y([]),preFilesExpanded:Y(!1),playlistSelectorVisible:Y(!1),playlistSelectorSelectedFiles:Y([]),batchDrawerVisible:Y(!1),cronBuilderVisible:Y(!1),cronPreviewVisible:Y(!1),cronPreviewTimes:Y([]),initialCronExpr:Y(""),agentListDialogVisible:Y(!1),scanDialogVisible:Y(!1),loading:Y(!1),deviceList:Y([]),connectedDeviceList:Y([]),dlnaDeviceList:Y([]),dlnaScanning:Y(!1),miDeviceList:Y([]),miScanning:Y(!1),pendingDeviceType:Y(null),preFilesSortOrder:Y(null),filesSortOrder:Y(null),preFilesOriginalOrder:Y(null),filesOriginalOrder:Y(null)}}}function Go(e,B,c,p,L,i,s,m){const h=g=>g.map(U=>({...U})),d=g=>{const U="playlist"in g&&Array.isArray(g.playlist)&&g.playlist||"files"in g&&Array.isArray(g.files)&&g.files||[];return h(lt(U,!0))},N=g=>{if(g.pre_lists&&Array.isArray(g.pre_lists)&&g.pre_lists.length===nt)return g.pre_lists.map(q=>h(lt(q||[],!0)));const U="pre_files"in g&&Array.isArray(g.pre_files)&&g.pre_files||[],C=h(lt(U,!0));return Array(nt).fill(null).map(()=>[...C])},Z=g=>Ds.includes(g)?g:$s,j=g=>({enabled:g?.enabled===1?1:0,cron:g?.cron?String(g.cron):"",duration:g?.duration||0}),v=(g,U)=>{if(typeof g=="number")return g;if(g==null)return U;const C=parseInt(String(g),10);return isNaN(C)?U:C},t=g=>g===!0||g===1,D=(g,U)=>{if(U===0)return 0;const C=v(g,0);return Math.max(0,Math.min(C,U-1))},W=()=>Array(nt).fill(null).map(()=>[]),te=g=>Array.isArray(g)&&g.length===nt&&g.every(U=>Array.isArray(U)),A=(g,U="播放列表")=>{const C=d(g),q=N(g),G=D(g?.current_index,C.length),re=g?.name&&String(g.name).trim()||U,ve=Z(g?.device?.type||g?.device_type),de=g?.device_address||g?.device?.address||null;return{id:g?.id||Ql(),name:re,playlist:C,pre_lists:q,total:C.length,current_index:G,pre_index:v(g?.pre_index,-1),device_address:de,device_type:ve,device:g?.device||{type:ve,address:de,name:g?.device?.name||null},schedule:j(g?.schedule),trigger_button:g?.trigger_button||"",updatedAt:"updatedAt"in g&&typeof g.updatedAt=="number"?g.updatedAt:Date.now(),isPlaying:t(g?.isPlaying)}},O=g=>!Array.isArray(g)||g.length===0?[A({name:Ge})]:g.map((U,C)=>"playlist"in U&&"total"in U?U:A(U,U?.name||`播放列表${C+1}`)),E=g=>{if(g&&"playlists"in g&&Array.isArray(g.playlists)){const C=g,q=O(C.playlists),G=q.some(re=>re.id===C.activePlaylistId)?C.activePlaylistId:q[0]?.id||null;return{playlists:q,activePlaylistId:G}}if(g&&!Array.isArray(g)&&("playlist"in g||"files"in g)){const C=g,q="playlist"in C&&Array.isArray(C.playlist)&&C.playlist||"files"in C&&Array.isArray(C.files)&&C.files||[],G=A({id:C.id||C.playlist_id,name:C.name||Ge,files:q,current_index:C.current_index,device_address:C.device_address});return{playlists:[G],activePlaylistId:G.id}}const U=A({name:Ge});return{playlists:[U],activePlaylistId:U.id}},le=g=>{if(!g)return null;if(!Array.isArray(g)&&Object.keys(g).length>0){const U=Object.values(g).map(C=>A(C,C.name||Ge));return{playlists:U,activePlaylistId:U[0]?.id||null}}if(Array.isArray(g)){const U=g.map(C=>A(C,C.name||Ge));return{playlists:U,activePlaylistId:U[0]?.id||null}}if(!Array.isArray(g)&&"id"in g&&typeof g.id=="string"){const U=g;return{playlists:[A(U,U.name||Ge)],activePlaylistId:U.id}}return null},J=g=>{const U={};return g.forEach(C=>{if(!C.id)return;const q=Z(C.device?.type||C.device_type),G=lt(C.playlist||[],!0),re=N(C);U[C.id]={id:C.id,name:C.name||Ge,files:G,pre_lists:re,current_index:C.current_index||0,device:{address:C.device?.address||C.device_address||"",type:q,name:C.device?.name||null},schedule:C.schedule||{enabled:0,cron:"",duration:0},trigger_button:C.trigger_button||"",create_time:C.create_time||_t(),updated_time:_t()}}),U},me=async g=>{try{const U=(g||e.value||[]).map(G=>({...G,total:Array.isArray(G.playlist)?G.playlist.length:0,updatedAt:Date.now()})),C=J(U),q=await je("updateAll","POST",C);if(q.code!==0)throw new Error(q.msg||"保存播放列表集合失败")}catch(U){se(U,"保存播放列表集合失败")}},z=async g=>{try{const C=J([g])[g.id];if(!C)throw new Error("播放列表数据格式错误");const q=await je("update","POST",C);if(q.code!==0)throw new Error(q.msg||"更新播放列表失败");return!0}catch(U){return se(U,"更新播放列表失败"),!1}},b=g=>{const U=Array.isArray(g)?g:e.value;if(!U||U.length===0){c.value=null,B.value="";return}const C=U.find(re=>re.id===B.value)||U[0];B.value=C.id;const q=D(C.current_index,C.playlist?.length||0),G=te(C.pre_lists)?C.pre_lists.map(re=>[...re||[]]):W();c.value={...C,playlist:[...C.playlist||[]],pre_lists:G,current_index:q,pre_index:v(C.pre_index,-1),in_pre_files:!1,isPlaying:t(C.isPlaying)}},M=g=>({...g,playlist:g.playlist.map(U=>({...U})),pre_lists:te(g.pre_lists)?g.pre_lists.map(U=>U.map(C=>({...C}))):W()}),x=async g=>{if(typeof g!="function")return null;let U=e.value.length>0?e.value.map(M):[A({name:Ge})],C=U.findIndex(ve=>ve.id===B.value);C===-1&&(C=0,B.value=U[0].id);const q=U[C],G=g(M(q))||q,re=A(G,q.name);return te(re.pre_lists)||(re.pre_lists=te(q.pre_lists)?q.pre_lists.map(ve=>ve.map(de=>({...de}))):W()),U[C]=re,e.value=U,await z(U[C]),b(U),c.value},k=(g,U)=>{const C=localStorage.getItem(jt);C&&g.some(q=>q.id===C)?B.value=C:B.value=U||""},w=async()=>{try{const g=await je("get","GET",{});if(g.code!==0)throw new Error(g.msg||"获取播放列表失败");const U=le(g.data),C=E(U||null);return e.value=C.playlists,k(C.playlists,C.activePlaylistId),b(C.playlists),C}catch(g){Qe.error("从接口加载播放列表失败:",g);const U=E(null);return e.value=U.playlists,k(U.playlists,U.activePlaylistId),b(U.playlists),U}},ee=g=>g?!!(L.value!==null||i.value||s.value):!1;return{normalizePlaylistItem:A,normalizePlaylistCollection:E,transformApiDataToPlaylistFormat:le,transformPlaylistToApiFormat:J,savePlaylist:me,updateSinglePlaylist:z,syncActivePlaylist:b,updateActivePlaylistData:x,loadPlaylist:w,refreshPlaylistStatus:async(g=!1,U=!1)=>{try{if(ee(U))return;if(p.value=!0,g){const C=B.value;if(!C)return;const q=await je("get","GET",{id:C});if(q.code!==0)throw new Error(q.msg||"获取播放列表状态失败");const G=le(q.data);if(!G?.playlists?.length)return;const re=G.playlists[0],ve=e.value.map(de=>de.id!==C?de:{...de,...re,playlist:re.playlist||de.playlist,pre_lists:te(re.pre_lists)?re.pre_lists.map(Le=>[...Le||[]]):de.pre_lists,current_index:re.current_index!==void 0?re.current_index:de.current_index,isPlaying:t(re?.isPlaying)});e.value=ve,b(ve)}else await w()}catch(C){Qe.error("刷新播放列表状态失败:",C)}finally{p.value=!1}}}}function Yo(e,B,c,p,L,i,s,m,h){return{loadPlaylist:async()=>{try{const A=await je("get","GET",{});if(A.code!==0)throw new Error(A.msg||"获取播放列表失败");return A.data}catch(A){throw Qe.error("从接口加载播放列表失败:",A),A}},handleSelectPlaylist:async A=>{!A||A===B.value||!e.value.find(E=>E.id===A)||(B.value=A,localStorage.setItem(jt,A),i(e.value))},handleCreatePlaylist:async()=>{try{const A=`播放列表${e.value.length+1}`,{value:O}=await Be.prompt("请输入播放列表名称","新建播放列表",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:A,inputPlaceholder:A,inputValidator:le=>!!le&&le.trim().length>0||"名称不能为空"});return{name:(O||A).trim()}}catch(A){if(A!=="cancel")throw A;return null}},handleCopyPlaylist:async A=>{if(!A)return null;const O=e.value.find(E=>E.id===A);if(!O)return null;try{const E=`${O.name}_副本`,{value:le}=await Be.prompt("请输入播放列表名称","复制播放列表",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:E,inputPlaceholder:E,inputValidator:me=>!!me&&me.trim().length>0||"名称不能为空"}),J=(le||E).trim();return{sourcePlaylist:O,name:J}}catch(E){if(E!=="cancel")throw E;return null}},handleDeletePlaylistGroup:async A=>{if(!A)return!1;if(e.value.length<=1)return _.warning("至少保留一个播放列表"),!1;const O=e.value.find(E=>E.id===A);if(!O)return!1;try{return await Be.confirm(`确认删除播放列表"${O.name}"吗？`,"删除播放列表",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),!0}catch(E){if(E!=="cancel")throw E;return!1}},handlePlayPlaylist:async()=>{const A=c.value;if(!A||!A.id){_.warning("播放列表不存在");return}if(!A.playlist||A.playlist.length===0){_.warning("播放列表为空，请先添加文件");return}try{p.value=!0,await s(E=>{const le=Array.isArray(E.playlist)?E.playlist:[];return E.current_index=Math.max(0,Math.min(E.current_index||0,le.length-1)),E.total=le.length,E});const O=await je("play","POST",{id:A.id});if(O.code!==0)throw new Error(O.msg||"播放失败");await m(!0),_.success("开始播放")}catch(O){se(O,"播放失败")}finally{p.value=!1}},handlePlayNext:async()=>{const A=c.value;if(!A||!A.id){_.warning("播放列表不存在");return}if(!A.playlist||A.playlist.length===0){_.warning("播放列表为空，无法播放下一首");return}try{p.value=!0;const O=await je("playNext","POST",{id:A.id});if(O.code!==0)throw new Error(O.msg||"播放下一首失败");await m(!0),_.success("已切换到下一首")}catch(O){se(O,"播放下一首失败")}finally{p.value=!1}},handlePlayPre:async()=>{const A=c.value;if(!A||!A.id){_.warning("播放列表不存在");return}const O=h().length>0,E=A.playlist&&A.playlist.length>0;if(!O&&!E){_.warning("播放列表为空，无法播放上一首");return}try{p.value=!0;const le=await je("playPre","POST",{id:A.id});if(le.code!==0)throw new Error(le.msg||"播放上一首失败");await m(!0),_.success("已切换到上一首")}catch(le){se(le,"播放上一首失败")}finally{p.value=!1}},handleStopPlaylist:async()=>{const A=c.value;if(!A||!A.id){_.warning("播放列表不存在");return}try{L.value=!0;const O=await je("stop","POST",{id:A.id});if(O.code!==0)throw new Error(O.msg||"停止播放失败");await m(!0),_.success("已停止播放")}catch(O){se(O,"停止播放列表失败")}finally{L.value=!1}}}}function Ko(e,B,c,p,L,i){const s=()=>{const D=e.value?.schedule?.cron||"";L.value=D,B.value=!0},m=()=>{B.value=!1},h=D=>{D&&(e.value?(Z(D),_.success("Cron 表达式已应用到当前播放列表")):_.warning("请先选择一个播放列表"))},d=D=>{p.value=D,c.value=!0},N=async D=>{e.value&&await i(W=>(W.schedule||(W.schedule={enabled:0,cron:"",duration:0}),W.schedule.enabled=D?1:0,W))},Z=async D=>{e.value&&await i(W=>(W.schedule||(W.schedule={enabled:0,cron:"",duration:0}),W.schedule.cron=D,W))};return{handleOpenCronBuilder:s,handleCloseCronBuilder:m,handleCronBuilderApply:h,handleCronBuilderPreview:d,handleTogglePlaylistCronEnabled:N,handleUpdatePlaylistCron:Z,handleUpdatePlaylistDuration:async D=>{e.value&&await i(W=>(W.schedule||(W.schedule={enabled:0,cron:"",duration:0}),W.schedule.duration=D||0,W))},handleUpdateTriggerButton:async D=>{e.value&&await i(W=>(W.trigger_button=D||"",W))},handlePreviewPlaylistCron:()=>{if(!e.value||!e.value.schedule?.cron){_.warning("请先设置 Cron 表达式");return}try{const D=e.value.schedule.cron,W=mt(D,5);W&&W.length>0?(p.value=W,c.value=!0):_.warning("无法解析 Cron 表达式")}catch(D){se(D,"预览失败")}}}}function Ho(e,B,c,p,L,i,s,m,h,d,N,Z){const j=x=>x.deviceID||x.address||"",v=async()=>{const x=e.value,k=B.value||x?.device?.type||x?.device_type||"dlna";if(!["agent","bluetooth"].includes(k)){c.value=[];return}try{s.value=!0;let w=null;k==="agent"?w=(await Ee.get("/agent/list")).data:w=await qe("paired","GET"),w.code===0?c.value=w.data||[]:_.error(w.msg||"获取设备失败")}catch(w){console.error("获取设备失败:",w),_.error("获取设备失败")}finally{s.value=!1}},t=async x=>{try{x.connecting=!0;const k=await qe("connect","POST",{address:x.address});k.code===0?(_.success(`成功连接到设备: ${x.name}`),await v(),i.value=i.value.filter(w=>w.address!==x.address)):_.error(k.msg||"连接失败")}catch(k){console.error("连接设备失败:",k),_.error("连接设备失败")}finally{x.connecting=!1}},D=async()=>{try{m.value=!0;const x=await Ee.get("/dlna/scan",{params:{timeout:5}});x.data.code===0?(p.value=x.data.data||[],_.success(`扫描到 ${p.value.length} 个 DLNA 设备`)):_.error(x.data.msg||"扫描 DLNA 设备失败")}catch(x){se(x,"扫描 DLNA 设备失败")}finally{m.value=!1}},W=async x=>{const k=j(x);if(!k)return;const w=L.value;if(!Array.isArray(w))return;const ee=w.find(ye=>j(ye)===k);if(ee){ee._volumeRefreshing=!0;try{const ye=await Ee.get("/mi/volume",{params:{device_id:k}});ye.data.code===0?ee.volume=ye.data.data?.volume??ye.data.data??void 0:_.error(ye.data.msg||`获取设备 ${ee.name||k} 音量失败`)}catch(ye){se(ye,`获取设备 ${ee.name||k} 音量失败`)}finally{ee._volumeRefreshing=!1}}},te=async()=>{try{h.value=!0;const x=await Ee.get("/mi/scan",{params:{timeout:5}});if(x.data.code===0){const k=(x.data.data||[]).map(w=>({...w,volume:void 0,_volumeChanging:!1,_volumeRefreshing:!1}));L.value=k,await Promise.allSettled(L.value.map(w=>W(w))),_.success(`扫描到 ${k.length} 个小米设备`)}else _.error(x.data.msg||"扫描小米设备失败")}catch(x){se(x,"扫描小米设备失败")}finally{h.value=!1}},A=async()=>{try{s.value=!0;const x=await qe("scan","GET");if(x.code===0){const k=Array.isArray(x.data)?x.data:[];i.value=k.map(w=>({name:w.name||"",address:w.address||"",...w,connecting:!1})),_.success(`扫描完成，找到 ${i.value.length} 个设备`)}else _.error(x.msg||"扫描失败")}catch(x){console.error("扫描设备失败:",x),_.error("扫描设备失败")}finally{s.value=!1}},O=()=>{d.value=!0},E=()=>{d.value=!1},le=async x=>{if(!e.value||!x||x==="")return;if(!["agent","dlna","bluetooth","mi"].includes(x)){_.error(`无效的设备类型: ${x}`);return}const w=x;B.value=w;const ee=e.value;ee.device_type=w,ee.device?ee.device.type=w:ee.device={type:w,address:"",name:null},await v()},J=async(x,k=null)=>{e.value&&(await Z(w=>{const ee=B.value||w.device?.type||w.device_type||"dlna";return w.device||(w.device={address:"",type:ee,name:null}),w.device.type=ee,w.device.address=x,k!==null&&(w.device.name=k),w.device_address=x,w.device_type=ee,w}),B.value=null)};return{getMiDeviceId:j,refreshConnectedList:v,handleConnectDevice:t,scanDlnaDevices:D,getMiDeviceVolume:W,scanMiDevices:te,handleUpdateDeviceList:A,handleOpenScanDialog:O,handleCloseScanDialog:E,handleUpdatePlaylistDeviceType:le,handleUpdatePlaylistDeviceAddress:J,handleSelectBluetoothDevice:async x=>{const k=c.value.find(ee=>ee.address===x),w=k?k.name:null;await J(x,w)},handleSelectAgentDevice:async x=>{const k=typeof x=="string"?x:x.address,w=typeof x=="string"?null:x.name;await J(k,w)},handleSelectMiDevice:async x=>{const k=x.deviceID||x.address||"",w=x.name||"";await J(k,w)},handleOpenAgentListDialog:async()=>{N.value=!0,await v()}}}function Jo(){const e=Il({callbacks:{onPlay:()=>{_.success("开始播放")},onError:()=>{se(new Error("音频播放失败"),"播放失败"),B()},onEnded:()=>{B()}}}),B=()=>{e.clear()};return{audioPlayer:e,clearBrowserAudioPlayer:B,handlePlayFileInBrowser:m=>{const h=m?.uri||m?.path||"";if(!h||typeof h!="string"||h.trim()===""){_.warning("文件路径无效");return}if(e.playingFilePath.value===h&&e.audio&&!e.audio.paused){B(),_.info("已停止播放");return}const d=Zl(h);if(!d||typeof d!="string"||d.trim()===""){_.error("无法生成媒体文件URL");return}if(d.includes("index.html")||d.endsWith(".html")){_.error("生成的媒体URL无效，可能是HTML页面");return}e.load(d,{playingFilePath:h}),e.play().catch(N=>{se(N,"播放失败"),B()})},isFilePlaying:m=>{const h=m?.uri||m?.path||"";return e.isFilePlaying(h)},getFilePlayProgress:m=>{const h=m?.uri||m?.path||"";return e.getFilePlayProgress(h)},getFileDuration:m=>{const h=m?.uri||m?.path||"",d=m?.duration||0;return e.getFileDuration(h,d)},handleSeekFile:(m,h)=>{const d=m?.uri||m?.path||"";e.seekFile(d,h)}}}function Xo(e,B,c,p,L,i,s,m,h,d,N,Z,j,v,t){const D=()=>s.value!==null?s.value:Ke(),W=$=>((!$.pre_lists||!Array.isArray($.pre_lists)||$.pre_lists.length!==7)&&($.pre_lists=Array(7).fill(null).map(()=>[])),$.pre_lists),te=($="请先选择一个播放列表")=>B.value?!0:(_.warning($),!1),A=($,K)=>{$!=="cancel"&&se($,K)},O=async($,K)=>{try{c.value=!0,await $()}catch(r){A(r,K)}finally{c.value=!1}},E=()=>{te()&&(p.value=!0,L.value="files",i.value=null)},le=()=>{te()&&(p.value=!0,L.value="pre_files",i.value=null)},J=async $=>{if($.length!==0){if(!B.value){_.warning("请先创建并选择一个播放列表");return}try{c.value=!0,await Z(r=>{const u=D(),S=L.value,F=S==="pre_files"?Array.isArray(r.pre_lists)&&r.pre_lists.length===7?[...r.pre_lists[u]||[]]:[]:Array.isArray(r.playlist)?[...r.playlist]:[],Q=new Set;if(F.forEach(I=>{I?.uri&&Q.add(I.uri)}),i.value&&$.length>0){const I=i.value.index;if(i.value.type==="pre_files"){W(r);const pe=[...r.pre_lists[u]||[]];I>=0&&I<pe.length&&(pe[I]={uri:$[0]},r.pre_lists[u]=pe)}else{const pe=[...r.playlist];I>=0&&I<pe.length&&(pe[I]={uri:$[0]},r.playlist=pe,r.total=pe.length)}return i.value=null,r}for(const I of $)if(!Q.has(I)){const pe={uri:I};F.push(pe),Q.add(I)}return S==="pre_files"?(W(r),r.pre_lists[u]=F):(r.playlist=F,r.total=F.length,F.length===0?r.current_index=0:r.current_index>=F.length&&(r.current_index=F.length-1)),r});const K=L.value==="pre_files"?"前置列表":"播放列表";_.success(`成功添加 ${$.length} 个文件到${K}`),p.value=!1}catch(K){se(K,"添加文件到播放列表失败")}finally{c.value=!1}}},me=()=>{p.value=!1},z=async $=>{const K=B.value;if(!(!K||$<=0||$>=K.playlist.length))try{c.value=!0,await Z(r=>{const u=[...r.playlist];return[u[$-1],u[$]]=[u[$],u[$-1]],r.playlist=u,r.current_index===$?r.current_index=$-1:r.current_index===$-1&&(r.current_index=$),r.total=u.length,r}),_.success("已上移")}catch(r){se(r,"上移失败")}finally{c.value=!1}},b=async $=>{const K=B.value;if(!(!K||$<0||$>=K.playlist.length-1))try{c.value=!0,await Z(r=>{const u=[...r.playlist];return[u[$],u[$+1]]=[u[$+1],u[$]],r.playlist=u,r.current_index===$?r.current_index=$+1:r.current_index===$+1&&(r.current_index=$),r.total=u.length,r}),_.success("已下移")}catch(r){se(r,"下移失败")}finally{c.value=!1}},M=async $=>{const K=B.value;if(!K||$<0||$>=K.playlist.length)return;const u=K.playlist[$]?.uri?.split("/").pop()||"文件";try{await Be.confirm(`确定要删除 "${u}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),c.value=!0,await Z(S=>{const F=[...S.playlist];return F.splice($,1),S.playlist=F,F.length===0?S.current_index=0:$<S.current_index?S.current_index=Math.max(0,S.current_index-1):$===S.current_index&&(S.current_index=Math.min(S.current_index,F.length-1)),S.total=F.length,S}),_.success("已删除")}catch(S){S!=="cancel"&&se(S,"删除失败")}finally{c.value=!1}},x=async $=>{const K=B.value;!K||$<0||$>=K.playlist.length||(i.value={type:"files",index:$},L.value="files",p.value=!0)},k=async $=>{const K=B.value,r=j();!K||!r||$<=0||$>=r.length||await O(async()=>{await Z(u=>{const S=D();W(u);const F=[...u.pre_lists[S]||[]];return[F[$-1],F[$]]=[F[$],F[$-1]],u.pre_lists[S]=F,u})},"上移失败")},w=async $=>{const K=B.value,r=j();!K||!r||$<0||$>=r.length-1||await O(async()=>{await Z(u=>{const S=D();W(u);const F=[...u.pre_lists[S]||[]];return[F[$],F[$+1]]=[F[$+1],F[$]],u.pre_lists[S]=F,u})},"下移失败")},ee=async $=>{const K=B.value,r=j();if(!K||!r||$<0||$>=r.length)return;const S=r[$]?.uri?.split("/").pop()||"文件";try{await Be.confirm(`确定要删除 "${S}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await O(async()=>{await Z(F=>{const Q=D();W(F);const I=[...F.pre_lists[Q]||[]];return I.splice($,1),F.pre_lists[Q]=I,F}),_.success("已删除")},"删除失败")}catch(F){A(F,"删除失败")}},ye=async $=>{const K=B.value,r=j();!K||!r||$<0||$>=r.length||(i.value={type:"pre_files",index:$},L.value="pre_files",p.value=!0)},g=()=>{m.value=!m.value,m.value||(d.value=[])},U=()=>{h.value=!h.value,h.value||(N.value=[])},C=$=>{const K=d.value,r=K.indexOf($);r>-1?K.splice(r,1):K.push($)},q=$=>{const K=N.value,r=K.indexOf($);r>-1?K.splice(r,1):K.push($)},G=async()=>{const $=B.value,K=j(),r=d.value;if(!$||!K||r.length===0)return;const u=r.length;try{await Be.confirm(`确定要删除选中的 ${u} 个前置文件吗？`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await O(async()=>{const S=[...new Set(r)].sort((F,Q)=>Q-F);await Z(F=>{const Q=D();W(F);const I=[...F.pre_lists[Q]||[]];return S.forEach(pe=>{pe>=0&&pe<I.length&&I.splice(pe,1)}),F.pre_lists[Q]=I,F}),d.value=[],m.value=!1,_.success(`已删除 ${u} 个前置文件`)},"批量删除失败")}catch(S){A(S,"批量删除失败")}},re=async()=>{const $=B.value,K=N.value;if(!$||!$.playlist||K.length===0)return;const r=K.length;try{await Be.confirm(`确定要删除选中的 ${r} 个正式文件吗？`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await O(async()=>{const u=[...new Set(K)].sort((S,F)=>F-S);await Z(S=>{const F=[...S.playlist];if(u.forEach(Q=>{Q>=0&&Q<F.length&&F.splice(Q,1)}),S.playlist=F,F.length===0)S.current_index=0;else{let Q=S.current_index;u.forEach(I=>{I<S.current_index?Q=Math.max(0,Q-1):I===S.current_index&&(Q=Math.min(Q,F.length-1))}),S.current_index=Q}return S.total=F.length,S}),N.value=[],h.value=!1,_.success(`已删除 ${r} 个正式文件`)},"批量删除失败")}catch(u){A(u,"批量删除失败")}},ve=async()=>{const $=B.value,K=j();if(!(!$||!K||K.length===0))try{await Be.confirm(`确定要清空前置文件列表吗？此操作将删除所有 ${K.length} 个前置文件。`,"确认清空",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await O(async()=>{await Z(r=>{const u=D();return W(r),r.pre_lists[u]=[],r}),_.success("已清空前置文件列表")},"清空失败")}catch(r){A(r,"清空失败")}},de=async()=>{const $=B.value;if(!(!$||!$.playlist||$.playlist.length===0))try{await Be.confirm(`确定要清空正式文件列表吗？此操作将删除所有 ${$.playlist.length} 个正式文件。`,"确认清空",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await O(async()=>{await Z(K=>(K.playlist=[],K.total=0,K.current_index=0,K)),_.success("已清空正式文件列表")},"清空失败")}catch(K){A(K,"清空失败")}},Le=async()=>{const $=B.value;if(!$)return;const K=j(),r=K&&K.length||0,u=$.playlist&&$.playlist.length||0,S=r+u;if(S!==0)try{const F=r>0&&u>0?`确定要清空播放列表 "${$.name}" 吗？此操作将删除所有 ${r} 个前置文件和 ${u} 个正式文件，共 ${S} 个文件。`:r>0?`确定要清空播放列表 "${$.name}" 吗？此操作将删除所有 ${r} 个前置文件。`:`确定要清空播放列表 "${$.name}" 吗？此操作将删除所有 ${u} 个正式文件。`;await Be.confirm(F,"确认清空",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await O(async()=>{await Z(Q=>(Q.playlist=[],W(Q),Q.pre_lists=Q.pre_lists.map(()=>[]),Q.total=0,Q.current_index=0,Q)),_.success("已清空播放列表（包括前置文件和正式文件）")},"清空失败")}catch(F){A(F,"清空失败")}},ke=$=>typeof $=="string"?{uri:$}:{...$,uri:$.uri||""};return{handleOpenFileBrowser:E,handleOpenFileBrowserForPreFiles:le,handleFileBrowserConfirm:J,handleCloseFileBrowser:me,handleMovePlaylistItemUp:z,handleMovePlaylistItemDown:b,handleDeletePlaylistItem:M,handleReplacePlaylistItem:x,handleMovePreFileUp:k,handleMovePreFileDown:w,handleDeletePreFile:ee,handleReplacePreFile:ye,handleTogglePreFilesBatchDeleteMode:g,handleToggleFilesBatchDeleteMode:U,handleTogglePreFileSelection:C,handleToggleFileSelection:q,handleBatchDeletePreFiles:G,handleBatchDeleteFiles:re,handleClearPreFiles:ve,handleClearFiles:de,handleClearPlaylist:Le,handleOpenPlaylistSelectorForPreFile:async $=>{try{if(!$){_.warning("文件信息无效");return}if(t&&v){const K=ke($);t.value=[K],v.value=!0}else _.info("请使用文件浏览器添加文件到播放列表")}catch(K){Qe.error("打开播放列表选择器失败:",K),_.error("打开对话框失败")}},handleOpenPlaylistSelectorForFile:async $=>{try{if(!$){_.warning("文件信息无效");return}const K=ke($);if(!K.uri){_.warning("文件URI无效");return}t&&v?(t.value=[K],v.value=!0):_.info("请使用文件浏览器添加文件到播放列表")}catch(K){Qe.error("打开播放列表选择器失败:",K),_.error("打开对话框失败")}}}}function qo(e,B,c,p,L,i,s,m,h,d,N,Z,j){const v=()=>d.value!==null?d.value:Ke(),t=(b,M)=>{if(!b||!M||b.length!==M.length)return!0;for(let x=0;x<b.length;x++){const k=b[x]?.uri||b[x],w=M[x]?.uri||M[x];if(k!==w)return!0}return!1};return{handleTogglePreFilesDragMode:async()=>{if(p.value){const b=B.value,M=j();if(b&&M&&M.length>0){if(t(m.value||[],M))try{c.value=!0,await N(k=>{const w=v();return(!k.pre_lists||!Array.isArray(k.pre_lists)||k.pre_lists.length!==7)&&(k.pre_lists=Array(7).fill(null).map(()=>[])),k.pre_lists[w]=[...M],k.pre_index=b.pre_index,k}),_.success("排序已保存")}catch(k){se(k,"保存排序失败")}finally{c.value=!1}m.value=null}}else{const b=B.value,M=j();b&&M&&M.length>0&&(m.value=[...M]),i.value=null}p.value=!p.value},handleToggleFilesDragMode:async()=>{if(L.value){const b=B.value;if(b&&b.playlist&&b.playlist.length>0){if(t(h.value||[],b.playlist))try{c.value=!0,await N(x=>(x.playlist=[...b.playlist||[]],x.current_index=b.current_index,x.total=b.playlist.length,x)),_.success("排序已保存")}catch(x){se(x,"保存排序失败")}finally{c.value=!1}h.value=null}}else{const b=B.value;b&&b.playlist&&b.playlist.length>0&&(h.value=[...b.playlist||[]]),s.value=null}L.value=!L.value},handlePreFileDragStart:(b,M)=>{if(!p.value){b.preventDefault();return}try{b.dataTransfer.effectAllowed="move",b.dataTransfer.setData("text/plain",M.toString())}catch(x){console.error("拖拽开始失败:",x)}},handlePreFileDragEnd:b=>{const M=b.currentTarget;M&&M.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")},handlePreFileDragOver:b=>{if(!p.value)return;b.preventDefault(),b.dataTransfer.dropEffect="move";const M=b.currentTarget;if(M){const x=M.getBoundingClientRect(),k=b.clientY,w=x.top+x.height/2;M.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500"),k<w?M.classList.add("border-t-2","border-blue-500"):M.classList.add("border-b-2","border-blue-500")}},handlePreFileDrop:(b,M)=>{if(!p.value)return;b.preventDefault();const x=b.currentTarget;x&&x.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500");const k=parseInt(b.dataTransfer.getData("text/plain"),10);if(k===M||isNaN(k))return;const w=B.value,ee=j();if(!w||!ee||k<0||k>=ee.length||M<0||M>=ee.length)return;const ye=v(),g=[...ee],[U]=g.splice(k,1);g.splice(M,0,U);let C=w.pre_index;w.pre_index!==void 0&&w.pre_index!==null&&w.pre_index>=0&&(w.pre_index===k?C=M:k<w.pre_index&&M>=w.pre_index?C=w.pre_index-1:k>w.pre_index&&M<=w.pre_index&&(C=w.pre_index+1));const q=e.value.map(G=>G.id===w.id?((!G.pre_lists||!Array.isArray(G.pre_lists)||G.pre_lists.length!==7)&&(G.pre_lists=Array(7).fill(null).map(()=>[])),{...G,pre_lists:G.pre_lists.map((re,ve)=>ve===ye?g:re),pre_index:C}):G);e.value=q,Z(q)},handleFileDragStart:(b,M)=>{if(!L.value){b.preventDefault();return}try{b.dataTransfer.effectAllowed="move",b.dataTransfer.setData("text/plain",M.toString())}catch(x){console.error("拖拽开始失败:",x)}},handleFileDragEnd:b=>{const M=b.currentTarget;M&&M.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")},handleFileDragOver:b=>{if(!L.value)return;b.preventDefault(),b.dataTransfer.dropEffect="move";const M=b.currentTarget;if(M){const x=M.getBoundingClientRect(),k=b.clientY,w=x.top+x.height/2;M.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500"),k<w?M.classList.add("border-t-2","border-blue-500"):M.classList.add("border-b-2","border-blue-500")}},handleFileDrop:(b,M)=>{if(!L.value)return;b.preventDefault();const x=b.currentTarget;x&&x.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500");const k=parseInt(b.dataTransfer.getData("text/plain"),10);if(k===M||isNaN(k))return;const w=B.value;if(!w||!w.playlist||k<0||k>=w.playlist.length||M<0||M>=w.playlist.length)return;const ee=[...w.playlist||[]],[ye]=ee.splice(k,1);ee.splice(M,0,ye);let g=w.current_index;w.current_index!==void 0&&w.current_index!==null&&w.current_index>=0&&(w.current_index===k?g=M:k<w.current_index&&M>=w.current_index?g=w.current_index-1:k>w.current_index&&M<=w.current_index&&(g=w.current_index+1));const U=e.value.map(C=>C.id===w.id?{...C,playlist:ee,current_index:g,total:ee.length}:C);e.value=U,Z(U)}}}function Qo(e,B,c,p,L,i){const s=Y(!1),m=Y(null),h=Y("");return{editNameDialogVisible:s,editNameDialogName:h,handleStartEditPlaylistName:j=>{const v=e.value.find(t=>t.id===j);v&&(m.value=j,h.value=v.name,s.value=!0)},handleSavePlaylistName:async()=>{if(!m.value)return;const j=h.value?.trim();if(!j||j.length===0){_.warning("播放列表名称不能为空");return}const v=m.value,t=e.value.find(D=>D.id===v);if(!t||t.name===j){s.value=!1,m.value=null,h.value="";return}try{const D=e.value.map(W=>W.id===v?{...W,name:j}:W);e.value=D,v===B.value&&i(D),await L(D),s.value=!1,m.value=null,h.value="",_.success("播放列表名称已更新")}catch(D){se(D,"更新播放列表名称失败")}},handleCancelEditPlaylistName:()=>{s.value=!1,m.value=null,h.value=""}}}const Zo={class:"p-1"},Io={class:"flex gap-4 h-[calc(100vh-150px)]"},cr=Ue({__name:"index",setup(e){const{playlistCollection:B,activePlaylistId:c,playlistStatus:p,playlistLoading:L,playlistRefreshing:i,playing:s,stopping:m,showMoreActions:h,editingPlaylistId:d,editingPlaylistName:N,fileBrowserDialogVisible:Z,fileBrowserTarget:j,replaceFileInfo:v,selectedWeekdayIndex:t,preFilesDragMode:D,filesDragMode:W,preFilesBatchDeleteMode:te,filesBatchDeleteMode:A,selectedPreFileIndices:O,selectedFileIndices:E,preFilesExpanded:le,playlistSelectorVisible:J,playlistSelectorSelectedFiles:me,batchDrawerVisible:z,cronBuilderVisible:b,cronPreviewVisible:M,cronPreviewTimes:x,initialCronExpr:k,agentListDialogVisible:w,scanDialogVisible:ee,loading:ye,deviceList:g,connectedDeviceList:U,dlnaDeviceList:C,dlnaScanning:q,miDeviceList:G,miScanning:re,pendingDeviceType:ve,preFilesSortOrder:de,filesSortOrder:Le,preFilesOriginalOrder:ke,filesOriginalOrder:$e}=Wo(),{audioPlayer:Se,handlePlayFileInBrowser:$,handleSeekFile:K}=Jo(),r=()=>t.value!==null?t.value:Ke(),u=()=>{const ce=p.value;if(!ce||!ce.pre_lists)return[];const ae=r();return!Array.isArray(ce.pre_lists)||ce.pre_lists.length!==7?[]:ce.pre_lists[ae]||[]},{savePlaylist:S,syncActivePlaylist:F,updateActivePlaylistData:Q,loadPlaylist:I,refreshPlaylistStatus:pe}=Go(B,c,p,i,ve,D,W),Oe=async ce=>{await Q(ce)},{handleOpenFileBrowser:We,handleOpenFileBrowserForPreFiles:y,handleFileBrowserConfirm:V,handleCloseFileBrowser:H,handleMovePlaylistItemUp:oe,handleMovePlaylistItemDown:T,handleDeletePlaylistItem:be,handleReplacePlaylistItem:ge,handleMovePreFileUp:Ce,handleMovePreFileDown:He,handleDeletePreFile:$t,handleReplacePreFile:Wt,handleTogglePreFilesBatchDeleteMode:Gt,handleToggleFilesBatchDeleteMode:Yt,handleTogglePreFileSelection:Kt,handleToggleFileSelection:Ht,handleBatchDeletePreFiles:Jt,handleBatchDeleteFiles:Xt,handleClearPreFiles:qt,handleClearFiles:Qt,handleClearPlaylist:Zt,handleOpenPlaylistSelectorForPreFile:It,handleOpenPlaylistSelectorForFile:el}=Xo(B,p,L,Z,j,v,t,te,A,O,E,Oe,u,J,me),{handleTogglePreFilesDragMode:tl,handleToggleFilesDragMode:ll,handlePreFileDragStart:sl,handlePreFileDragEnd:nl,handlePreFileDragOver:al,handlePreFileDrop:il,handleFileDragStart:ol,handleFileDragEnd:rl,handleFileDragOver:dl,handleFileDrop:ul}=qo(B,p,L,D,W,de,Le,ke,$e,t,Oe,F,u),{editNameDialogVisible:dt,editNameDialogName:ut,handleStartEditPlaylistName:cl,handleSavePlaylistName:ct,handleCancelEditPlaylistName:et}=Qo(B,c,d,N,S,F),{handleOpenCronBuilder:fl,handleCloseCronBuilder:vl,handleCronBuilderApply:ml,handleCronBuilderPreview:gl,handleTogglePlaylistCronEnabled:pl,handleUpdatePlaylistCron:yl,handleUpdatePlaylistDuration:hl,handleUpdateTriggerButton:bl,handlePreviewPlaylistCron:xl}=Ko(p,b,M,x,k,Q),{refreshConnectedList:Dt,handleConnectDevice:wl,scanDlnaDevices:$l,scanMiDevices:Dl,handleUpdateDeviceList:Cl,handleOpenScanDialog:Fl,handleCloseScanDialog:kl,handleUpdatePlaylistDeviceType:_l,handleUpdatePlaylistDeviceAddress:Pl,handleSelectBluetoothDevice:Sl,handleSelectAgentDevice:Bl,handleSelectMiDevice:Al,handleOpenAgentListDialog:Tl}=Ho(p,ve,U,C,G,g,ye,q,re,ee,w,Q),{handleSelectPlaylist:Ml,handleCreatePlaylist:El,handleCopyPlaylist:Ll,handleDeletePlaylistGroup:Nl,handlePlayPlaylist:Ul,handlePlayNext:zl,handlePlayPre:Vl,handleStopPlaylist:Ol}=Yo(B,c,p,s,m,F,Q,pe,u),Rl=async ce=>{await Ml(ce),ve.value=null,de.value=null,Le.value=null,D.value=!1,W.value=!1,ke.value=null,$e.value=null,te.value=!1,A.value=!1,O.value=[],E.value=[],await Dt()},jl=async(ce,ae)=>{ce==="delete"?await Nl(ae):ce==="copy"&&await Ll(ae)},Wl=async ce=>{try{if(L.value=!0,!B.value.find(xe=>xe.id===ce.playlistId)){_.warning("播放列表不存在");return}await Q(xe=>{if(xe.id!==ce.playlistId)return xe;if(ce.preLists.length>0&&((!xe.pre_lists||!Array.isArray(xe.pre_lists)||xe.pre_lists.length!==7)&&(xe.pre_lists=Array(7).fill(null).map(()=>[])),ce.preLists.forEach(fe=>{if(fe>=0&&fe<7){const _e=new Set((xe.pre_lists[fe]||[]).map(Me=>typeof Me=="string"?Me:Me?.uri||""));ce.files.forEach(Me=>{_e.has(Me)||(xe.pre_lists[fe]||(xe.pre_lists[fe]=[]),xe.pre_lists[fe].push({uri:Me}))})}})),ce.filesList){Array.isArray(xe.playlist)||(xe.playlist=[]);const fe=new Set(xe.playlist.map(_e=>typeof _e=="string"?_e:_e?.uri||""));ce.files.forEach(_e=>{fe.has(_e)||xe.playlist.push({uri:_e})}),xe.total=xe.playlist.length}return xe}),F(B.value),await S(B.value)}catch(ae){se(ae,"批量添加文件失败")}finally{L.value=!1}},Gl=async ce=>{try{if(L.value=!0,!B.value.find(fe=>fe.id===ce.playlistId)){_.warning("播放列表不存在");return}const xe=new Set(ce.files);await Q(fe=>(fe.id!==ce.playlistId||(ce.preLists.length>0&&fe.pre_lists&&Array.isArray(fe.pre_lists)&&fe.pre_lists.length===7&&ce.preLists.forEach(_e=>{_e>=0&&_e<7&&fe.pre_lists[_e]&&(fe.pre_lists[_e]=fe.pre_lists[_e].filter(Me=>{const vt=typeof Me=="string"?Me:Me?.uri||"";return!xe.has(vt)}))}),ce.filesList&&Array.isArray(fe.playlist)&&(fe.playlist=fe.playlist.filter(_e=>{const Me=typeof _e=="string"?_e:_e?.uri||"";return!xe.has(Me)}),fe.total=fe.playlist.length,fe.playlist.length===0?fe.current_index=0:fe.current_index>=fe.playlist.length&&(fe.current_index=fe.playlist.length-1))),fe)),F(B.value),await S(B.value)}catch(ae){se(ae,"批量删除文件失败")}finally{L.value=!1}},Yl=async()=>{await Tl()},Kl=ce=>{t.value=ce,F(B.value)},ft=Y(!0),{start:Ct,stop:Ft}=es(async()=>{await pe(!0,!0)},Cs,{immediate:!1,autoCleanup:!0}),Hl=ce=>{ft.value=ce,ce?Ct():Ft()};return ot(async()=>{await I(),await Dt(),ft.value&&Ct()}),At(()=>{Ft()}),(ce,ae)=>{const xe=zt,fe=Ut,_e=pt,Me=ze,vt=Ie;return f(),P("div",Zo,[n("div",Io,[l(nn,{"playlist-collection":o(B),"active-playlist-id":o(c),refreshing:o(i),"auto-refresh-enabled":ft.value,onSelect:Rl,onCreate:o(El),onRefresh:o(pe),onToggleAutoRefresh:Hl,onMenuCommand:jl},null,8,["playlist-collection","active-playlist-id","refreshing","auto-refresh-enabled","onCreate","onRefresh"]),l(qn,{"playlist-status":o(p),"active-playlist-id":o(c),"editing-playlist-id":o(d),"editing-playlist-name":o(N),"onUpdate:editingPlaylistName":ae[0]||(ae[0]=we=>tt(N)?N.value=we:null),"selected-weekday-index":o(t),"pre-files-drag-mode":o(D),"pre-files-batch-delete-mode":o(te),"selected-pre-file-indices":o(O),"pre-files-expanded":o(le),"files-drag-mode":o(W),"files-batch-delete-mode":o(A),"selected-file-indices":o(E),"playlist-loading":o(L),playing:o(s),stopping:o(m),"show-more-actions":o(h),"audio-player":o(Se),onStartEditName:o(cl),onSaveName:o(ct),onCancelEditName:o(et),onOpenBatchDrawer:ae[1]||(ae[1]=we=>z.value=!0),onPlay:o(Ul),onPlayPre:o(Vl),onPlayNext:o(zl),onStop:o(Ol),onClear:o(Zt),onToggleMoreActions:ae[2]||(ae[2]=we=>h.value=!o(h)),onSelectWeekday:Kl,onOpenFileBrowserForPreFiles:o(y),onTogglePreFilesDragMode:o(tl),onTogglePreFilesBatchDeleteMode:o(Gt),onBatchDeletePreFiles:o(Jt),onClearPreFiles:o(qt),onTogglePreFilesExpand:ae[3]||(ae[3]=we=>le.value=!o(le)),onTogglePreFileSelection:o(Kt),onPreFileDragStart:o(sl),onPreFileDragEnd:o(nl),onPreFileDragOver:o(al),onPreFileDrop:o(il),onOpenFileBrowser:o(We),onToggleFilesDragMode:o(ll),onToggleFilesBatchDeleteMode:o(Yt),onBatchDeleteFiles:o(Xt),onClearFiles:o(Qt),onToggleFileSelection:o(Ht),onFileDragStart:o(ol),onFileDragEnd:o(rl),onFileDragOver:o(dl),onFileDrop:o(ul),onPlayFile:o($),onSeekFile:o(K),onMovePreFileUp:o(Ce),onMovePreFileDown:o(He),onReplacePreFile:o(Wt),onOpenPlaylistSelectorForPreFile:o(It),onDeletePreFile:o($t),onMoveFileUp:o(oe),onMoveFileDown:o(T),onReplaceFile:o(ge),onOpenPlaylistSelectorForFile:o(el),onDeleteFile:o(be)},null,8,["playlist-status","active-playlist-id","editing-playlist-id","editing-playlist-name","selected-weekday-index","pre-files-drag-mode","pre-files-batch-delete-mode","selected-pre-file-indices","pre-files-expanded","files-drag-mode","files-batch-delete-mode","selected-file-indices","playlist-loading","playing","stopping","show-more-actions","audio-player","onStartEditName","onSaveName","onCancelEditName","onPlay","onPlayPre","onPlayNext","onStop","onClear","onOpenFileBrowserForPreFiles","onTogglePreFilesDragMode","onTogglePreFilesBatchDeleteMode","onBatchDeletePreFiles","onClearPreFiles","onTogglePreFileSelection","onPreFileDragStart","onPreFileDragEnd","onPreFileDragOver","onPreFileDrop","onOpenFileBrowser","onToggleFilesDragMode","onToggleFilesBatchDeleteMode","onBatchDeleteFiles","onClearFiles","onToggleFileSelection","onFileDragStart","onFileDragEnd","onFileDragOver","onFileDrop","onPlayFile","onSeekFile","onMovePreFileUp","onMovePreFileDown","onReplacePreFile","onOpenPlaylistSelectorForPreFile","onDeletePreFile","onMoveFileUp","onMoveFileDown","onReplaceFile","onOpenPlaylistSelectorForFile","onDeleteFile"]),l(za,{"playlist-status":o(p),"connected-device-list":o(U),"dlna-device-list":o(C),"mi-device-list":o(G),loading:o(ye),"dlna-scanning":o(q),"mi-scanning":o(re),"on-toggle-cron-enabled":o(pl),"on-update-cron":o(yl),"on-update-duration":o(hl),"on-update-trigger-button":o(bl),"on-open-cron-builder":o(fl),"on-preview-cron":o(xl),"on-update-device-type":o(_l),"on-update-device-address":o(Pl),"on-select-bluetooth-device":o(Sl),"on-select-agent-device":o(Bl),"on-select-mi-device":o(Al),"on-scan-dlna-devices":o($l),"on-scan-mi-devices":o(Dl),"on-open-scan-dialog":o(Fl),"on-open-device-list":Yl},null,8,["playlist-status","connected-device-list","dlna-device-list","mi-device-list","loading","dlna-scanning","mi-scanning","on-toggle-cron-enabled","on-update-cron","on-update-duration","on-update-trigger-button","on-open-cron-builder","on-preview-cron","on-update-device-type","on-update-device-address","on-select-bluetooth-device","on-select-agent-device","on-select-mi-device","on-scan-dlna-devices","on-scan-mi-devices","on-open-scan-dialog"])]),l(Mt,{visible:o(Z),"onUpdate:visible":ae[5]||(ae[5]=we=>Z.value=we),title:"选择文件添加到播放列表","confirm-button-text":"添加","confirm-loading":o(L),onConfirm:o(V),onClose:o(H)},{"footer-prepend":a(()=>[l(fe,{modelValue:o(j),"onUpdate:modelValue":ae[4]||(ae[4]=we=>tt(j)?j.value=we:null),size:"small",class:"w-[150px]"},{default:a(()=>[l(xe,{label:"添加到主列表",value:"files"}),l(xe,{label:"添加到前置列表",value:"pre_files"})]),_:1},8,["modelValue"])]),_:1},8,["visible","confirm-loading","onConfirm","onClose"]),l(Us,{visible:o(b),"initial-cron":o(k),"onUpdate:visible":ae[6]||(ae[6]=we=>b.value=we),onApply:o(ml),onPreview:o(gl),onClose:o(vl)},null,8,["visible","initial-cron","onApply","onPreview","onClose"]),l(Rs,{visible:o(M),times:o(x),"onUpdate:visible":ae[7]||(ae[7]=we=>M.value=we),onClose:ae[8]||(ae[8]=we=>M.value=!1)},null,8,["visible","times"]),l(Ra,{visible:o(ee),"device-list":o(g),loading:o(ye),"onUpdate:visible":ae[9]||(ae[9]=we=>ee.value=we),onRefresh:o(Cl),onConnect:o(wl),onClose:o(kl)},null,8,["visible","device-list","loading","onRefresh","onConnect","onClose"]),l(ki,{visible:o(w),"onUpdate:visible":ae[10]||(ae[10]=we=>w.value=we)},null,8,["visible"]),l(eo,{visible:o(J),"playlist-collection":o(B),"selected-files":o(me),"onUpdate:visible":ae[11]||(ae[11]=we=>J.value=we)},null,8,["visible","playlist-collection","selected-files"]),l(vt,{modelValue:o(dt),"onUpdate:modelValue":ae[13]||(ae[13]=we=>tt(dt)?dt.value=we:null),title:"编辑播放列表名称",width:"400",onClose:o(et)},{footer:a(()=>[l(Me,{onClick:o(et)},{default:a(()=>[...ae[15]||(ae[15]=[X("取消",-1)])]),_:1},8,["onClick"]),l(Me,{type:"primary",onClick:o(ct)},{default:a(()=>[...ae[16]||(ae[16]=[X("确定",-1)])]),_:1},8,["onClick"])]),default:a(()=>[l(_e,{modelValue:o(ut),"onUpdate:modelValue":ae[12]||(ae[12]=we=>tt(ut)?ut.value=we:null),placeholder:"请输入播放列表名称",onKeyup:[kt(o(ct),["enter"]),kt(o(et),["esc"])],clearable:"",autofocus:""},null,8,["modelValue","onKeyup"])]),_:1},8,["modelValue","onClose"]),l(jo,{visible:o(z),"playlist-collection":o(B),"onUpdate:visible":ae[14]||(ae[14]=we=>z.value=we),onRefresh:o(pe),"on-add-files":Wl,"on-remove-files":Gl},null,8,["visible","playlist-collection","onRefresh"])])}}});export{cr as default};
