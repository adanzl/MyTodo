import{a as T}from"./utils-BjcahYMR.js";import{U as y}from"./types-shared-Xm3z_OLP.js";import{l as p,a as r}from"./utils-shared-BnZFpz44.js";const l={url:"https://leo-zhao.natapp4.cc/"},U="192.168.50.171",k=8848,f=8843,d=`https://${U}:${f}`;let c=null;async function O(){try{const t=`${d}/`,e=new AbortController,n=setTimeout(()=>e.abort(),500);try{return await fetch(t,{method:"HEAD",signal:e.signal,mode:"no-cors"}),clearTimeout(n),!0}catch{return clearTimeout(n),!1}}catch{return!1}}function S(){if(c===!0)return;const t=typeof window<"u"&&window.location.protocol==="https:",e=d.startsWith("https://");if(t&&!e){console.warn(`ðŸš« æ— æ³•åˆ‡æ¢åˆ°æœ¬åœ°æœåŠ¡å™¨ï¼
åŽŸå› ï¼šå½“å‰é¡µé¢ä½¿ç”¨ HTTPSï¼Œä½†æœ¬åœ°æœåŠ¡å™¨æ˜¯ HTTP
è§£å†³æ–¹æ¡ˆï¼š
1. ä¸ºæœ¬åœ°æœåŠ¡å™¨é…ç½® HTTPS (æŽ¨è)
2. æˆ–é€šè¿‡ HTTP è®¿é—®å‰ç«¯é¡µé¢
è¯¦è§ï¼š/server/setup-local-https.md`);return}c=!0;const a=`${d}/api`;s.defaults.baseURL=a}function x(){if(c===!1)return;c=!1;const t=l.url,e=t.endsWith("/api")?t:t.endsWith("/")?`${t}api`:`${t}/api`;s.defaults.baseURL=e}let i;i=l.url;const A=i.endsWith("/api")?i:i.endsWith("/")?`${i}api`:`${i}/api`;function h(){return(s.defaults.baseURL||i).replace(/\/api$/,"")}function g(){return c===!0?d:c===!1?l.url:h()}function B(){return c}const H=d.startsWith("https://")?f:k,s=T.create({baseURL:A,timeout:3e4});s.interceptors.request.use(t=>(p.debug("[API Request]",t.method?.toUpperCase(),t.baseURL,t.url,t.params||t.data),t),t=>(p.error("API Request Error:",t),Promise.reject(t)));s.interceptors.response.use(t=>{if(t.data&&typeof t.data=="object"&&"code"in t.data&&t.data.code!==0){const e=new Error(t.data.msg||"è¯·æ±‚å¤±è´¥");return e.response=t,Promise.reject(e)}return t},t=>{if(t.code==="ECONNABORTED"||t.message?.includes("canceled")||t.message?.includes("aborted"))return Promise.reject(t);if(t.config?._isFileUpload===!0||t.config?.data instanceof FormData||typeof t.config?.headers?.["Content-Type"]=="string"&&t.config.headers["Content-Type"].includes("multipart/form-data")||t.config?.url?.includes("/pdf/upload")||t.config?.url?.includes("/upload"))return p.warn(`File upload failed, not retrying to avoid re-upload: ${t.config?.url}`,{code:t.code,message:t.message,status:t.response?.status}),Promise.reject(t);if(t.response){const a=t.response.status,o=t.response.data?.msg||`è¯·æ±‚å¤±è´¥ (${a})`;a>=500?r(t,"æœåŠ¡å™¨é”™è¯¯",{context:"API"}):a===404?r(t,"èµ„æºæœªæ‰¾åˆ°",{context:"API"}):a===403?r(t,"æ— æƒé™è®¿é—®",{context:"API"}):a===401?r(t,"æœªæŽˆæƒï¼Œè¯·é‡æ–°ç™»å½•",{context:"API"}):r(t,o,{context:"API"})}else t.request?r(t,"ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥",{context:"API"}):r(t,"è¯·æ±‚é…ç½®é”™è¯¯",{context:"API"});return Promise.reject(t)});async function j(t,e,a,n){const o={table:t};return e&&(o.conditions=JSON.stringify(e)),a&&(o.pageNum=a),n&&(o.pageSize=n),(await s.get("/getAll",{params:o})).data}async function W(t,e,a){const n={table:t,id:e};return(await s.get("/getData",{params:n})).data.data}async function q(t,e){return e.id===-1&&(e.id=null),(await s.post("/setData",{table:t,data:e})).data.data}async function N(t,e){return(await s.post("/delData",{table:t,id:e})).data.data}async function V(t){if(t===void 0)throw new Error("id is undefined");const e=await s.get("/getData",{params:{id:t,table:"t_schedule",fields:"data,user_id"}});if(e.data.code!==0)throw new Error(e.data.msg);const a=y.parseUserData(e.data.data.data);return a.userId=e.data.data.user_id,a}async function G(t,e){const a=await s.post("/setData",{table:"t_user",data:{id:t,score:e}});if(console.log("setUserInfo",a.data),a.data.code!==0)throw new Error(a.data.msg);return a.data.data}async function z(t){const e=await s.get("/getData",{params:{table:"t_user",id:t,fields:"id,score"}});if(e.data.code!==0)throw new Error(e.data.msg);return e.data.data}async function J(t,e,a,n){const o=await s.post("/addScore",{user:t,action:e,value:a,msg:n});if(console.log("addScore",o.data),o.data.code!==0)throw new Error(o.data.msg);return o.data.data}async function K(t,e,a){const n=await s.get("/getRdsList",{params:{key:t,pageSize:a,startId:e}});if(n.data.code!==0)throw new Error(n.data.msg);return n.data.data}async function Q(t,e){const a=await s.get("/getRdsData",{params:{table:t,id:e}});if(a.data.code!==0)throw new Error(a.data.msg);return a.data.data}async function X(t,e,a){const n=await s.post("/setRdsData",{table:t,data:{id:e,value:a}});if(console.log("setRdsData",n.data),n.data.code!==0)throw new Error(n.data.msg);return n.data.data}async function Y(t,e,a){let n;const o="bluetooth";return e==="GET"?n=await s.get(`/${o}/${t}`,{params:a}):n=await s.post(`/${o}/${t}`,a),n.data}async function Z(t){return(await s.get("/mi/scan",{params:{timeout:t}})).data}async function tt(t){return(await s.get("/mi/status",{params:{device_id:t}})).data}async function et(t,e){return(await s.post("/mi/volume",{device_id:t,volume:e})).data}async function at(t){return(await s.post("/mi/stop",{device_id:t})).data}async function st(t){return(await s.get("/dlna/scan",{params:{timeout:t}})).data}async function nt(t){return(await s.get("/dlna/volume",{params:{location:t}})).data}async function ot(t,e){return(await s.post("/dlna/volume",{location:t,volume:e})).data}async function rt(t){return(await s.post("/dlna/stop",{location:t})).data}async function it(t,e,a={}){let n;return e==="GET"?n=await s.get(`/playlist/${t}`,{params:a}):n=await s.post(`/playlist/${t}`,a),n.data}async function ct(){return(await s.get("/pdf/list")).data}async function dt(t,e,a){const n=new FormData;n.append("file",t);const o={headers:{"Content-Type":"multipart/form-data"},timeout:6e5,signal:a,_isFileUpload:!0,onUploadProgress:u=>{if(e&&u.total){const w=Math.round(u.loaded*100/u.total);e(w)}}};return(await s.post("/pdf/upload",n,o)).data}async function ut(t,e){const a={task_id:t};return e!=null&&e!==""&&(a.password=e),(await s.post("/pdf/decrypt",a)).data}async function pt(t){return(await s.get(`/pdf/task/${encodeURIComponent(t)}`)).data}function lt(t,e){return`${g()}/api/pdf/download/${encodeURIComponent(t)}?type=${e}`}async function ft(t){return(await s.post("/pdf/delete",{task_id:t})).data}async function D(){return(await s.get("/media/merge/list")).data}async function _(){return(await s.post("/media/merge/create",{})).data}async function v(t){return(await s.post("/media/merge/get",{task_id:t})).data}async function L(t){return(await s.post("/media/merge/delete",{task_id:t})).data}async function P(t,e){return(await s.post("/media/merge/addFileByPath",{task_id:t,file_path:e})).data}async function R(t,e){return(await s.post("/media/merge/deleteFile",{task_id:t,file_index:e})).data}async function M(t){return(await s.post("/media/merge/start",{task_id:t})).data}async function I(t,e){return(await s.post("/media/merge/reorderFiles",{task_id:t,file_indices:e})).data}function b(t){return`${g()}/api/media/merge/download?task_id=${t}`}async function $(t,e){return(await s.post("/media/merge/save",{task_id:t,target_path:e})).data}const gt=D,mt=_,wt=v,Tt=L,yt=P,Ut=R,kt=M,At=I,ht=b,Dt=$;async function _t(){return(await s.get("/media/convert/list")).data}async function vt(t){return(await s.post("/media/convert/create",t||{})).data}async function Lt(t){return(await s.post("/media/convert/get",{task_id:t})).data}async function Pt(t){return(await s.post("/media/convert/delete",{task_id:t})).data}async function Rt(t,e){return(await s.post("/media/convert/update",{task_id:t,...e})).data}async function Mt(t){return(await s.post("/media/convert/start",{task_id:t})).data}export{rt as A,it as B,ct as C,dt as D,ut as E,lt as F,ft as G,pt as H,yt as I,gt as J,mt as K,U as L,wt as M,kt as N,Dt as O,At as P,Tt as Q,Ut as R,ht as S,_t as T,vt as U,Rt as V,Lt as W,Mt as X,Pt as Y,s as a,j as b,H as c,O as d,S as e,x as f,z as g,J as h,B as i,Q as j,N as k,W as l,q as m,X as n,V as o,h as p,K as q,Y as r,G as s,Z as t,tt as u,et as v,at as w,st as x,nt as y,ot as z};
