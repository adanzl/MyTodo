import{I as P,A as B,B as M,J as A,D as G,f as I,V as R,W as Y,R as F}from"./element-plus-Cmtfo66s.js";import{b as T}from"./api-shared-DHR2pBqQ.js";import{u as j,r as H,w as J}from"./utils-Dtqx8Ray.js";import{u as Q}from"./index-CF0R6bEv.js";import{j as W,c as C,r as b,t as Z,n as f,s as y,M as $,Q as l,G as u,l as v,o as n,F as q,a6 as K,J as g,u as E,$ as O}from"./vue-vendor-C-hNZ0TW.js";import"./vendor-4xlYshH7.js";import"./types-shared-CiUQVXWn.js";import"./utils-shared-B2b8bsxo.js";import"./vant-7Cqjo8an.js";const X={class:""},ee={class:"flex items-center"},ae={key:0},te={key:1},se={class:"flex items-center gap-1 w-full"},oe={class:"flex-1 text-center"},L=10,ve=W({__name:"Score",setup(le){const w=Q(),U=C(()=>w.userList),i=C(()=>{const e=[...U.value];return e.unshift({id:0,name:"全部"}),e}),o=b({data:[],pageNum:1,pageSize:10,totalCount:0,totalPage:0}),m=b(!1),c=b(0),z=C(()=>i.value.find(e=>e.id===c.value)||i.value[0]),k=async()=>{await w.refreshUserList(),i.value.length>0&&(c.value=i.value[0].id)},x=e=>J(i.value,s=>s.id==e),h=async(e,s,p)=>{m.value=!0;try{let d;e&&e!==0&&(d={user_id:e});const a=await T("t_score_history",d,s,p);if(a&&a.data){const _=a.data.data||[];o.value.data=[],o.value.pageNum=a.data.pageNum??s,o.value.pageSize=a.data.pageSize??p,o.value.totalCount=a.data.totalCount??0,o.value.totalPage=a.data.totalPage??0,j(_,r=>{r.user=x(r.user_id),r.dt=H(r.dt).format("YYYY-MM-DD HH:mm:ss"),o.value.data.push(r)})}}catch(d){console.error("获取积分记录失败:",d)}finally{m.value=!1}},V=async()=>{const e=z.value;console.log("onUserChange",e),e&&await h(e.id,1,L)},S=(e,s)=>{h(z.value.id,e,s)};return Z(async()=>{await k(),await h(0,1,L)}),(e,s)=>{const p=F,d=P,a=G,_=I,r=M,D=A,N=B;return n(),f("div",X,[y("div",ee,[l(d,{size:"large",modelValue:c.value,"onUpdate:modelValue":s[0]||(s[0]=t=>c.value=t),onChange:V},{default:u(()=>[(n(!0),f(q,null,K(i.value,t=>(n(),v(p,{key:t.id,value:t.id},{default:u(()=>[O(g(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),$((n(),v(r,{data:o.value.data,stripe:""},{default:u(()=>[l(a,{label:"ID",prop:"id",width:"60"}),l(a,{label:"user",width:"60"},{default:u(({row:t})=>[t.user?(n(),f("span",ae,g(t.user.name),1)):(n(),f("span",te,g(t.user_id),1))]),_:1}),l(a,{label:"Action",prop:"action",width:"100"}),l(a,{label:"Date",prop:"dt",width:"180"}),l(a,{label:"Pre",prop:"pre_value",width:"70"}),l(a,{label:"Value",width:"70"},{default:u(({row:t})=>[y("div",se,[t.value>0?(n(),v(_,{key:0,color:"#67C23A",size:16},{default:u(()=>[l(E(R))]),_:1})):(n(),v(_,{key:1,color:"#F56C6C",size:16},{default:u(()=>[l(E(Y))]),_:1})),y("span",oe,g(t.value),1)])]),_:1}),l(a,{label:"Current",prop:"current",width:"80"}),l(a,{label:"MSG",prop:"msg"})]),_:1},8,["data"])),[[N,m.value]]),l(D,{layout:"sizes, prev, pager, next",total:o.value.totalCount,"page-size":o.value.pageSize,"page-sizes":[10,20,50],"current-page":o.value.pageNum,class:"mt-2",background:"",onSizeChange:s[1]||(s[1]=t=>S(o.value.pageNum,t)),onCurrentChange:s[2]||(s[2]=t=>S(t,o.value.pageSize))},null,8,["total","page-size","current-page"])])}}});export{ve as default};
