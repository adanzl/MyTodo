import{E as F}from"./element-plus-Bd8o4DEb.js";import{r as v}from"./utils-BjcahYMR.js";import{a as L}from"./api-shared-viHtHHjv.js";const R={enableInDev:!0,enableDebugInDev:!1,enableErrorInProd:!0},Y={debug:(...t)=>{},info:(...t)=>{},warn:(...t)=>{},error:(...t)=>{R.enableErrorInProd&&console.error("[ERROR]",...t)},configure:t=>{Object.assign(R,t)}};function j(t,e,s={}){const{context:o}=s,u=o?`${e} (${o})`:e;Y.error(u,t);const i=t?.response?.data?.msg||t?.message||"未知错误";F.error(`${e}: ${i}`)}function A(){const t=new Date,e=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0"),u=String(t.getHours()).padStart(2,"0"),l=String(t.getMinutes()).padStart(2,"0"),i=String(t.getSeconds()).padStart(2,"0");return`${e}-${s}-${o} ${u}:${l}:${i}`}function O(t){if(!t)return null;try{const e=t.match(/(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})/);if(!e)return t;const s=parseInt(e[1],10),o=parseInt(e[2],10)-1,u=parseInt(e[3],10),l=parseInt(e[4],10),i=parseInt(e[5],10),a=parseInt(e[6],10),g=new Date(s,o,u,l,i,a),c=["周日","周一","周二","周三","周四","周五","周六"][g.getDay()];return`${s}-${String(o+1).padStart(2,"0")}-${String(u).padStart(2,"0")} ${c} ${String(l).padStart(2,"0")}:${String(i).padStart(2,"0")}:${String(a).padStart(2,"0")}`}catch(e){return console.error("格式化日期时间失败:",e),t}}function B(){const t=new Date().getDay();return t===0?6:t-1}function z(t){return t===void 0?"":typeof t=="object"&&"format"in t&&typeof t.format=="function"?t.format("YYYY-MM-DD"):v(t).format("YYYY-MM-DD")}async function N(t,e={}){const o={...{maxWidth:800,maxHeight:600,quality:.8},...e};if(t.type==="image/svg+xml")return new Promise((l,i)=>{const a=new FileReader;a.onload=g=>{const n=g.target?.result;if(n.startsWith("data:image/svg+xml;base64,"))l(n);else{const c=btoa(new TextEncoder().encode(n).reduce((f,d)=>f+String.fromCharCode(d),""));l(`data:image/svg+xml;base64,${c}`)}},a.onerror=()=>i("SVG读取失败: 文件读取错误"),a.readAsText(t)});const u=t.type==="image/png"?"image/png":"image/jpeg";return new Promise((l,i)=>{const a=new Image;a.src=URL.createObjectURL(t),a.onload=async()=>{const g=document.createElement("canvas"),n=g.getContext("2d");if(!n){i("无法获取 canvas 上下文");return}let[c,f]=[a.width,a.height];if(c>o.maxWidth||f>o.maxHeight){const d=Math.min(o.maxWidth/c,o.maxHeight/f);c=Math.floor(c*d),f=Math.floor(f*d)}g.width=c,g.height=f,n.clearRect(0,0,c,f),n.drawImage(a,0,0,c,f);try{const d=g.toDataURL(u,o.quality);URL.revokeObjectURL(a.src),l(d)}catch(d){i(`压缩失败: ${d instanceof Error?d.message:"未知错误"}`)}},a.onerror=g=>{i(`图片加载失败: ${g instanceof Error?g.message:"未知错误"}`),URL.revokeObjectURL(a.src)}})}function _(t){if(!t||t<=0)return"";const e=Math.floor(t),s=Math.floor(e/3600),o=Math.floor(e%3600/60),u=e%60;return s>0?`${s}:${String(o).padStart(2,"0")}:${String(u).padStart(2,"0")}`:`${o}:${String(u).padStart(2,"0")}`}function q(t){if(!t)return"0 B";const e=1024,s=["B","KB","MB","GB"],o=Math.floor(Math.log(t)/Math.log(e));return Math.round(t/Math.pow(e,o)*100)/100+" "+s[o]}function y(t,e,s){if(t==="*"||!t||typeof t!="string")return null;const o=new Set,u=String(t).split(",");for(const l of u){const i=l.trim();if(i.includes("/")){const[a,g]=i.split("/"),n=parseInt(g,10);if(a==="*")for(let c=e;c<=s;c+=n)o.add(c);else if(a.includes("-")){const[c,f]=a.split("-").map(d=>parseInt(d,10));for(let d=c;d<=f;d+=n)o.add(d)}}else if(i.includes("-")){const[a,g]=i.split("-").map(n=>parseInt(n,10));for(let n=a;n<=g;n++)o.add(n)}else{const a=parseInt(i,10);!isNaN(a)&&a>=e&&a<=s&&o.add(a)}}return o.size>0?Array.from(o).sort((l,i)=>l-i):null}function G(t,e=3){try{if(!t||typeof t!="string")throw new Error("Cron 表达式必须是字符串类型");const s=String(t).trim().split(/\s+/);if(s.length!==6)throw new Error("Cron 表达式必须包含6个字段：秒 分 时 日 月 周");const[o,u,l,i,a,g]=s,n=y(o,0,59),c=y(u,0,59),f=y(l,0,23),d=y(i,1,31),M=y(a,1,12);let h=y(g,0,7);h&&h.includes(7)&&(h=h.filter(S=>S!==7),h.includes(0)||h.push(0),h.sort((S,w)=>S-w));const x=[],r=new Date;r.setMilliseconds(0),n&&!n.includes(r.getSeconds())&&(r.setSeconds(0),r.setMinutes(r.getMinutes()+1));let k=0;const H=1e4;for(;x.length<e&&k<H;){k++;const S=r.getMonth()+1;if(M&&!M.includes(S)){let m=null;for(const p of M)if(p>S){m=p;break}m===null?(m=M[0],r.setFullYear(r.getFullYear()+1,m-1,1),r.setHours(0,0,n?n[0]:0)):(r.setMonth(m-1,1),r.setHours(0,0,n?n[0]:0));continue}const w=r.getDate(),U=r.getDay();let $=!0;if(i!=="*"&&g!=="*"?$=!!(d&&d.includes(w))||!!(h&&h.includes(U)):i!=="*"?$=d?d.includes(w):!1:g!=="*"&&($=h?h.includes(U):!1),!$){r.setDate(r.getDate()+1),r.setHours(0,0,n?n[0]:0);continue}const D=r.getHours();if(f&&!f.includes(D)){let m=null;for(const p of f)if(p>D){m=p;break}m===null?(r.setDate(r.getDate()+1),r.setHours(f[0],0,n?n[0]:0)):r.setHours(m,0,n?n[0]:0);continue}const C=r.getMinutes();if(c&&!c.includes(C)){let m=null;for(const p of c)if(p>C){m=p;break}if(m===null){let p=null;for(const I of f||[D])if(I>D){p=I;break}p===null?(r.setDate(r.getDate()+1),r.setHours(f?f[0]:0,c[0],n?n[0]:0)):r.setHours(p,c[0],n?n[0]:0)}else r.setMinutes(m,n?n[0]:0);continue}const E=r.getSeconds();if(n&&!n.includes(E)){let m=null;for(const p of n)if(p>E){m=p;break}m===null?(r.setMinutes(r.getMinutes()+1),r.setSeconds(n[0])):r.setSeconds(m);continue}if(r>new Date){const m=r.getFullYear()+"-"+String(r.getMonth()+1).padStart(2,"0")+"-"+String(r.getDate()).padStart(2,"0")+" "+String(r.getHours()).padStart(2,"0")+":"+String(r.getMinutes()).padStart(2,"0")+":"+String(r.getSeconds()).padStart(2,"0");x.push(m)}n&&n.length>0&&r.setSeconds(n[0]),r.setMinutes(r.getMinutes()+1)}return x.slice(0,e)}catch(s){throw console.error("计算 Cron 执行时间失败:",s),s}}function K(t){const e=t.second==="custom"?t.secondCustom||"*":t.second||"*",s=t.minute==="custom"?t.minuteCustom||"*":t.minute||"*",o=t.hour==="custom"?t.hourCustom||"*":t.hour||"*",u=t.day==="custom"?t.dayCustom||"*":t.day||"*",l=t.month==="custom"?t.monthCustom||"*":t.month||"*",i=t.weekday==="custom"?t.weekdayCustom||"*":t.weekday||"*";return`${e} ${s} ${o} ${u} ${l} ${i}`}function V(t,e=!0){return Array.isArray(t)?t.map(s=>{if(!s||typeof s!="object")return null;const o={uri:s.uri||""};return e&&(o.duration=s.duration||null),o}).filter(s=>s!==null):[]}function J(t){return!Array.isArray(t)||t.length===0?0:t.reduce((e,s)=>{const o=s?.duration;return e+(typeof o=="number"&&o>0?o:0)},0)}function Q(t){if(!t||typeof t!="string"||t.trim()==="")return console.warn("getMediaFileUrl: 文件路径无效",t),"";try{const e=L.defaults.baseURL||"";if(!e||typeof e!="string")return console.warn("getMediaFileUrl: API baseURL无效",e),"";const s=t.startsWith("/")?t.slice(1):t;if(!s||s.trim()==="")return console.warn("getMediaFileUrl: 处理后的路径为空",t),"";const o=s.split("/").map(l=>encodeURIComponent(l)).join("/"),u=`${e}/media/files/${o}`;return u.includes("index.html")||u.endsWith(".html")?(console.error("getMediaFileUrl: 生成的URL包含HTML页面",{filePath:t,mediaUrl:u}),""):u}catch(e){return console.error("getMediaFileUrl: 生成URL时出错",e,{filePath:t}),""}}function X(){return`pl_${Date.now()}_${Math.random().toString(36).slice(2,7)}`}export{z as S,j as a,G as b,N as c,B as d,_ as e,O as f,K as g,J as h,A as i,X as j,Q as k,Y as l,q as m,V as n};
