import{a as A}from"./utils-Dtqx8Ray.js";import{U as D}from"./types-shared-DXrozTcA.js";import{l as f,a as r}from"./utils-shared-Ti8AKJ8R.js";const g="access_token";function h(){return localStorage.getItem(g)}function w(t){if(!t){localStorage.removeItem(g);return}localStorage.setItem(g,t)}async function N(t,e){const s=await a.post("/auth/login",{username:t,password:e});return s.data?.access_token&&w(s.data.access_token),s.data}async function v(){const t=await a.post("/auth/refresh"),e=t.data?.access_token;return e&&w(e),t.data}const T={url:"https://leo-zhao.natapp4.cc/"},L="192.168.50.171",R=8848,_=8843,d=`https://${L}:${_}`;let c=null;async function z(){try{const t=`${d}/`,e=new AbortController,n=setTimeout(()=>e.abort(),500);try{return await fetch(t,{method:"HEAD",signal:e.signal,mode:"no-cors"}),clearTimeout(n),!0}catch{return clearTimeout(n),!1}}catch{return!1}}function V(){if(c===!0)return;const t=typeof window<"u"&&window.location.protocol==="https:",e=d.startsWith("https://");if(t&&!e){console.warn(`ðŸš« æ— æ³•åˆ‡æ¢åˆ°æœ¬åœ°æœåŠ¡å™¨ï¼
åŽŸå› ï¼šå½“å‰é¡µé¢ä½¿ç”¨ HTTPSï¼Œä½†æœ¬åœ°æœåŠ¡å™¨æ˜¯ HTTP
è§£å†³æ–¹æ¡ˆï¼š
1. ä¸ºæœ¬åœ°æœåŠ¡å™¨é…ç½® HTTPS (æŽ¨è)
2. æˆ–é€šè¿‡ HTTP è®¿é—®å‰ç«¯é¡µé¢
è¯¦è§ï¼š/server/setup-local-https.md`);return}c=!0;const s=`${d}/api`;a.defaults.baseURL=s}function G(){if(c===!1)return;c=!1;const t=T.url,e=t.endsWith("/api")?t:t.endsWith("/")?`${t}api`:`${t}/api`;a.defaults.baseURL=e}let i;i=T.url;const P=i.endsWith("/api")?i:i.endsWith("/")?`${i}api`:`${i}/api`;function M(){return(a.defaults.baseURL||i).replace(/\/api$/,"")}function y(){return c===!0?d:c===!1?T.url:M()}function K(){return c}const J=d.startsWith("https://")?_:R,a=A.create({baseURL:P,timeout:3e4,withCredentials:!0});let l=!1,m=[];function k(t){m.forEach(e=>e(t)),m=[]}async function I(){if(l)return new Promise(t=>{m.push(t)});l=!0;try{const e=(await v())?.access_token||h();return k(e),e}catch(t){throw w(null),k(null),t}finally{l=!1}}a.interceptors.request.use(t=>{const e=h();return e&&(t.headers=t.headers||{},t.headers.Authorization=`Bearer ${e}`),f.debug("[API Request]",t.method?.toUpperCase(),t.baseURL,t.url,t.params||t.data),t},t=>(f.error("API Request Error:",t),Promise.reject(t)));a.interceptors.response.use(t=>{if(t.data&&typeof t.data=="object"&&"code"in t.data&&t.data.code!==0){const e=new Error(t.data.msg||"è¯·æ±‚å¤±è´¥");return e.response=t,Promise.reject(e)}return t},async t=>{const e=t.config;if(t.code==="ECONNABORTED"||t.message?.includes("canceled")||t.message?.includes("aborted"))return Promise.reject(t);if(e?._isFileUpload===!0||e?.data instanceof FormData||typeof e?.headers?.["Content-Type"]=="string"&&String(e?.headers?.["Content-Type"]).includes("multipart/form-data")||String(e?.url||"").includes("/pdf/upload")||String(e?.url||"").includes("/upload"))return f.warn(`File upload failed, not retrying to avoid re-upload: ${e?.url}`,{code:t.code,message:t.message,status:t.response?.status}),Promise.reject(t);if(t.response?.status===401&&e&&!e._retry){e._retry=!0;try{const n=await I();return n&&(e.headers=e.headers||{},e.headers.Authorization=`Bearer ${n}`),a.request(e)}catch{}}if(t.response){const n=t.response.status,u=t.response.data?.msg||`è¯·æ±‚å¤±è´¥ (${n})`;n>=500?r(t,"æœåŠ¡å™¨é”™è¯¯",{context:"API"}):n===404?r(t,"èµ„æºæœªæ‰¾åˆ°",{context:"API"}):n===403?r(t,"æ— æƒé™è®¿é—®",{context:"API"}):n===401?r(t,"æœªæŽˆæƒï¼Œè¯·é‡æ–°ç™»å½•",{context:"API"}):r(t,u,{context:"API"})}else t.request?r(t,"ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥",{context:"API"}):r(t,"è¯·æ±‚é…ç½®é”™è¯¯",{context:"API"});return Promise.reject(t)});async function Y(t,e,s,n){const o={table:t};return e&&(o.conditions=JSON.stringify(e)),s&&(o.pageNum=s),n&&(o.pageSize=n),(await a.get("/getAll",{params:o})).data}async function Q(t,e,s){const n={table:t,id:e};return(await a.get("/getData",{params:n})).data.data}async function X(t,e){return e.id===-1&&(e.id=null),(await a.post("/setData",{table:t,data:e})).data.data}async function Z(t,e){return(await a.post("/delData",{table:t,id:e})).data.data}async function tt(t){if(t===void 0)throw new Error("id is undefined");const e=await a.get("/getData",{params:{id:t,table:"t_schedule",fields:"data,user_id"}});if(e.data.code!==0)throw new Error(e.data.msg);const s=D.parseUserData(e.data.data.data);return s.userId=e.data.data.user_id,s}async function et(t,e){const s=await a.post("/setData",{table:"t_user",data:{id:t,score:e}});if(console.log("setUserInfo",s.data),s.data.code!==0)throw new Error(s.data.msg);return s.data.data}async function at(t){const e=await a.get("/getData",{params:{table:"t_user",id:t,fields:"id,score"}});if(e.data.code!==0)throw new Error(e.data.msg);return e.data.data}async function st(t,e,s,n){const o=await a.post("/addScore",{user:t,action:e,value:s,msg:n});if(console.log("addScore",o.data),o.data.code!==0)throw new Error(o.data.msg);return o.data.data}async function nt(t,e,s){const n=await a.get("/getRdsList",{params:{key:t,pageSize:s,startId:e}});if(n.data.code!==0)throw new Error(n.data.msg);return n.data.data}async function ot(t,e){const s=await a.get("/getRdsData",{params:{table:t,id:e}});if(s.data.code!==0)throw new Error(s.data.msg);return s.data.data}async function rt(t,e,s){const n=await a.post("/setRdsData",{table:t,data:{id:e,value:s}});if(console.log("setRdsData",n.data),n.data.code!==0)throw new Error(n.data.msg);return n.data.data}async function it(t,e,s){let n;const o="bluetooth";return e==="GET"?n=await a.get(`/${o}/${t}`,{params:s}):n=await a.post(`/${o}/${t}`,s),n.data}async function ct(t){return(await a.get("/mi/scan",{params:{timeout:t}})).data}async function dt(t){return(await a.get("/mi/status",{params:{device_id:t}})).data}async function ut(t,e){return(await a.post("/mi/volume",{device_id:t,volume:e})).data}async function pt(t){return(await a.post("/mi/stop",{device_id:t})).data}async function lt(t){return(await a.get("/dlna/scan",{params:{timeout:t}})).data}async function ft(t){return(await a.get("/dlna/volume",{params:{location:t}})).data}async function gt(t,e){return(await a.post("/dlna/volume",{location:t,volume:e})).data}async function mt(t){return(await a.post("/dlna/stop",{location:t})).data}async function wt(t,e,s={}){let n;return e==="GET"?n=await a.get(`/playlist/${t}`,{params:s}):n=await a.post(`/playlist/${t}`,s),n.data}async function Tt(){return(await a.get("/pdf/list")).data}async function yt(t,e,s){const n=new FormData;n.append("file",t);const o={headers:{"Content-Type":"multipart/form-data"},timeout:6e5,signal:s,_isFileUpload:!0,onUploadProgress:p=>{if(e&&p.total){const U=Math.round(p.loaded*100/p.total);e(U)}}};return(await a.post("/pdf/upload",n,o)).data}async function kt(t,e){const s={task_id:t};return e!=null&&e!==""&&(s.password=e),(await a.post("/pdf/decrypt",s)).data}async function ht(t){return(await a.get(`/pdf/task/${encodeURIComponent(t)}`)).data}function _t(t,e){return`${y()}/api/pdf/download/${encodeURIComponent(t)}?type=${e}`}async function Ut(t){return(await a.post("/pdf/delete",{task_id:t})).data}async function $(){return(await a.get("/media/merge/list")).data}async function E(){return(await a.post("/media/merge/create",{})).data}async function b(t){return(await a.post("/media/merge/get",{task_id:t})).data}async function C(t){return(await a.post("/media/merge/delete",{task_id:t})).data}async function S(t,e){return(await a.post("/media/merge/addFileByPath",{task_id:t,file_path:e})).data}async function F(t,e){return(await a.post("/media/merge/deleteFile",{task_id:t,file_index:e})).data}async function O(t){return(await a.post("/media/merge/start",{task_id:t})).data}async function B(t,e){return(await a.post("/media/merge/reorderFiles",{task_id:t,file_indices:e})).data}function x(t){return`${y()}/api/media/merge/download?task_id=${t}`}async function H(t,e){return(await a.post("/media/merge/save",{task_id:t,target_path:e})).data}const At=$,Dt=E,vt=b,Lt=C,Rt=S,Pt=F,Mt=O,It=B,$t=x,Et=H;async function bt(){return(await a.get("/media/convert/list")).data}async function Ct(t){return(await a.post("/media/convert/create",t||{})).data}async function St(t){return(await a.post("/media/convert/get",{task_id:t})).data}async function Ft(t){return(await a.post("/media/convert/delete",{task_id:t})).data}async function Ot(t,e){return(await a.post("/media/convert/update",{task_id:t,...e})).data}async function Bt(t){return(await a.post("/media/convert/start",{task_id:t})).data}async function xt(){return(await a.get("/tts/list")).data}async function Ht(t){return(await a.post("/tts/create",t)).data}async function Wt(t){return(await a.get("/tts/get",{params:{task_id:t}})).data}async function jt(t,e){return(await a.post("/tts/update",{task_id:t,...e})).data}async function qt(t){return(await a.post("/tts/delete",{task_id:t})).data}async function Nt(t){return(await a.post("/tts/start",{task_id:t})).data}async function zt(t){return(await a.post("/tts/stop",{task_id:t})).data}function Vt(t){return`${y()}/api/tts/download?task_id=${t}`}async function Gt(t){const e=new FormData;t.forEach(o=>{e.append("file",o)});const s={headers:{"Content-Type":"multipart/form-data"},timeout:6e4,_isFileUpload:!0};return(await a.post("/ai/ocr",e,s)).data}export{Ht as $,gt as A,mt as B,wt as C,Tt as D,yt as E,kt as F,_t as G,Ut as H,ht as I,Rt as J,At as K,L,Dt as M,vt as N,Mt as O,Et as P,It as Q,Lt as R,Pt as S,$t as T,bt as U,Ct as V,Ot as W,St as X,Bt as Y,Ft as Z,xt as _,a,Wt as a0,jt as a1,Nt as a2,zt as a3,Vt as a4,Gt as a5,qt as a6,Y as b,J as c,z as d,V as e,G as f,at as g,st as h,K as i,ot as j,Z as k,N as l,Q as m,X as n,rt as o,tt as p,M as q,nt as r,et as s,it as t,ct as u,dt as v,ut as w,pt as x,lt as y,ft as z};
