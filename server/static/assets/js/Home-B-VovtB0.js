import{d as D,e as A}from"./shared-1TZFBAIg.js";import{u as L}from"./index-gfppqctp.js";import{A as I,B as N,C as M,D as P,b as T,F as W,u as $,c as F,E as c}from"./element-plus-CEI_9LYZ.js";import{B as z,o as G,G as _,W as H,E as O,Q as o,Z as t,e as f,r as Q,D as p,a3 as m,I as w,U as b,M as Z}from"./vue-vendor-Bzw_s7xI.js";import"./utils-B-B_-3AX.js";import"./vant-DC8oOVF3.js";import"./vendor-B3rMqREe.js";const j={class:""},q={key:0},J={class:"flex mt-4"},oe=z({__name:"Home",setup(K){const n=L(),g=f(()=>n.userList),V=f(()=>n.loading),a=Q({visible:!1,data:null,value:0}),i=async()=>{await n.refreshUserList()},h=async r=>{try{const e={id:r.id,score:r.score};await D(e.id,e.score),console.log("update user",e),await i()}catch(e){console.error("更新用户失败:",e),c.error("更新用户失败")}},y=r=>{a.value.visible=!0,a.value.data=r},C=async()=>{if(!a.value.data){c.warning("请选择用户");return}try{await A(a.value.data.id,"pcAdmin",a.value.value,"管理后台变更"),await i(),a.value.visible=!1,a.value.value=0}catch(r){console.error("添加积分失败:",r),c.error("添加积分失败")}},U=()=>{a.value.visible=!1,a.value.value=0};return G(async()=>{await i()}),(r,e)=>{const s=P,k=T,E=W,v=$,d=F,x=N,S=M,B=I;return p(),_("div",j,[H((p(),O(x,{data:g.value,stripe:"",class:"w-full"},{default:o(()=>[t(s,{prop:"id",label:"ID",width:"80"}),t(s,{label:"Icon",width:"100"},{default:o(l=>[t(k,{src:l.row.icon},null,8,["src"])]),_:1}),t(s,{prop:"name",label:"Name",width:"100"}),t(s,{prop:"admin",label:"Admin",width:"100",class:"items-center text-center"}),t(s,{label:"WProgress",width:"120",class:"items-center text-center"},{default:o(({row:l})=>[t(E,{"text-inside":!0,"stroke-width":26,percentage:l.wish_progress},null,8,["percentage"])]),_:1}),t(s,{prop:"wish_list",label:"WList",width:"100",class:"items-center text-center"}),t(s,{prop:"score",label:"Score",width:"100"},{default:o(({row:l})=>[t(v,{modelValue:l.score,"onUpdate:modelValue":u=>l.score=u,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(s,{label:"Operations"},{default:o(({row:l})=>[t(d,{class:"w-16",onClick:u=>h(l),type:"primary"},{default:o(()=>[...e[3]||(e[3]=[m(" Update ",-1)])]),_:1},8,["onClick"]),t(d,{class:"w-16",onClick:u=>y(l)},{default:o(()=>[...e[4]||(e[4]=[m(" Score ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[B,V.value]]),t(S,{modelValue:a.value.visible,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.visible=l),title:"Change Score",width:"600","before-close":U},{default:o(()=>[e[6]||(e[6]=w("span",null,"输入的积分会作用在当前积分上，输入负数则会减少积分",-1)),a.value.data?(p(),_("div",q,b(a.value.data.name)+" 当前积分: "+b(a.value.data.score),1)):Z("",!0),w("div",J,[t(v,{modelValue:a.value.value,"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.value=l),style:{width:"240px"},placeholder:"Please input"},null,8,["modelValue"]),t(d,{onClick:e[1]||(e[1]=l=>C()),class:"ml-2 w-16",type:"primary"},{default:o(()=>[...e[5]||(e[5]=[m(" Submit ",-1)])]),_:1})])]),_:1},8,["modelValue"])])}}});export{oe as default};
