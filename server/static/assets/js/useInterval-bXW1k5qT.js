import{b as Y,e as ae,_ as le,l as se}from"./index-D8BRhcwO.js";import{m as ee,r as C,c as S,B as O,o as A,Q as y,q as b,O as L,Z as ie,a1 as k,ae as M,t as E,M as N,W as U,S as Q,u as te,n as X,P as re,bL as oe,D as ue}from"./vue-vendor-DIrWXCnL.js";import"./utils-C11zrYka.js";import{r as de,m as ce,d as ne,v as fe,q as me,D as pe,s as ve,Q as ge,E as G,g as ye,T as he}from"./element-plus-DKhpzu-P.js";function _e(l){if(!l||l<=0)return"";const c=Math.floor(l),e=Math.floor(c/3600),r=Math.floor(c%3600/60),n=c%60;return e>0?`${e}:${String(r).padStart(2,"0")}:${String(n).padStart(2,"0")}`:`${r}:${String(n).padStart(2,"0")}`}function be(l){if(!l)return"0 B";const c=1024,e=["B","KB","MB","GB"],r=Math.floor(Math.log(l)/Math.log(c));return Math.round(l/Math.pow(c,r)*100)/100+" "+e[r]}function We(l,c=!0){return Array.isArray(l)?l.map(e=>{if(!e||typeof e!="object")return null;const r={uri:e.uri||""};return c&&(r.duration=e.duration||null),r}).filter(e=>e!==null):[]}function He(l){return!Array.isArray(l)||l.length===0?0:l.reduce((c,e)=>{const r=e?.duration;return c+(typeof r=="number"&&r>0?r:0)},0)}function Ge(l){if(!l||typeof l!="string"||l.trim()==="")return console.warn("getMediaFileUrl: æ–‡ä»¶è·¯å¾„æ— æ•ˆ",l),"";try{const c=Y.defaults.baseURL||"";if(!c||typeof c!="string")return console.warn("getMediaFileUrl: API baseURLæ— æ•ˆ",c),"";const e=l.startsWith("/")?l.slice(1):l;if(!e||e.trim()==="")return console.warn("getMediaFileUrl: å¤„ç†åŽçš„è·¯å¾„ä¸ºç©º",l),"";const r=e.split("/").map(u=>encodeURIComponent(u)).join("/"),n=`${c}/media/files/${r}`;return n.includes("index.html")||n.endsWith(".html")?(console.error("getMediaFileUrl: ç”Ÿæˆçš„URLåŒ…å«HTMLé¡µé¢",{filePath:l,mediaUrl:n}),""):n}catch(c){return console.error("getMediaFileUrl: ç”ŸæˆURLæ—¶å‡ºé”™",c,{filePath:l}),""}}const ke={class:"m-4"},xe={class:"flex items-center gap-2 mb-2"},Fe={class:"flex items-center gap-2 mb-2"},Pe={key:0,class:"text-sm text-blue-600 ml-2"},Ce={class:"flex items-center gap-2"},Ee={key:0},Le={key:1},$e={key:0},Me={key:1},Te={class:"flex items-center justify-between"},we={class:"text-sm text-gray-500"},De={key:0},Be={key:1},Se={class:"flex gap-2 items-center"},Ue={key:0},qe=ee({__name:"FileDialog",props:{visible:{type:Boolean,default:!1},title:{default:"é€‰æ‹©æ–‡ä»¶"},defaultPath:{default:"/mnt/ext_base"},extensions:{default:"audio"},confirmButtonText:{default:"ç¡®å®š"},confirmLoading:{type:Boolean,default:!1},mode:{default:"file"}},emits:["update:visible","confirm","close"],setup(l,{emit:c}){const e=l,r=c,n=C(e.defaultPath),u=C([]),m=C(!1),f=C([]),h=C(!1);let _=e.defaultPath;const F=()=>{const i=n.value;h.value=!!(i&&i!=="/mnt/ext_base"&&i!=="/")},t=async()=>{try{m.value=!0;const i=n.value||e.defaultPath,s=await Y.get("/listDirectory",{params:{path:i,extensions:e.extensions}});s.data.code===0?(u.value=s.data.data||[],F()):G.error(s.data.msg||"èŽ·å–æ–‡ä»¶åˆ—è¡¨å¤±è´¥")}catch(i){ae(i,"èŽ·å–æ–‡ä»¶åˆ—è¡¨å¤±è´¥")}finally{m.value=!1}},x=()=>{const i=n.value;if(i&&i!=="/mnt/ext_base"&&i!=="/"){const s=String(i).split("/").filter(g=>g);s.pop(),n.value=s.length>0?"/"+s.join("/"):"/mnt/ext_base",F(),t()}},p=()=>{n.value=e.defaultPath,F(),t()},P=i=>{if(i.isDirectory){const s=n.value==="/"?`/${i.name}`:`${n.value}/${i.name}`;n.value=s,F(),t()}else w(i)},w=i=>{if(i.isDirectory)return;const s=n.value==="/"?`/${i.name}`:`${n.value}/${i.name}`,g=f.value.indexOf(s);g>-1?f.value.splice(g,1):f.value.push(s)},D=i=>{if(i.isDirectory)return!1;const s=n.value==="/"?`/${i.name}`:`${n.value}/${i.name}`;return f.value.includes(s)},R=()=>{const i=n.value;u.value.forEach(s=>{if(!s.isDirectory){const g=i==="/"?`/${s.name}`:`${i}/${s.name}`;f.value.includes(g)||f.value.push(g)}})},W=()=>{const i=n.value,s=u.value.filter(g=>!g.isDirectory).map(g=>i==="/"?`/${g.name}`:`${i}/${g.name}`);f.value=f.value.filter(g=>!s.includes(g))},H=()=>{if(String(e.mode||"file").toLowerCase().trim()==="directory"){const s=n.value||e.defaultPath||"/mnt/ext_base";if(String(s).trim()===""){G.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç›®å½•");return}r("confirm",[String(s)])}else{if(f.value.length===0){G.warning("è¯·å…ˆé€‰æ‹©è¦æ·»åŠ çš„æ–‡ä»¶");return}r("confirm",[...f.value])}_=n.value,I()},I=()=>{f.value=[],r("close")},V=S(()=>String(e.mode||"file").toLowerCase().trim()==="directory"?!1:f.value.length===0);return O(()=>e.visible,i=>{i?(n.value=_,f.value=[],t()):f.value=[]}),O(n,()=>{t()}),(i,s)=>{const g=ce,$=ne,K=pe,z=ve,Z=ge,a=me,d=de,o=fe;return b(),A(d,{"model-value":l.visible,"onUpdate:modelValue":s[1]||(s[1]=v=>i.$emit("update:visible",v)),title:l.title,width:"800","before-close":I},{footer:y(()=>[X(i.$slots,"footer",{},()=>[L("div",Te,[L("span",we,[l.mode==="file"?(b(),E("span",De,"æç¤ºï¼šç‚¹å‡»æ–‡ä»¶å¯åˆ‡æ¢é€‰æ‹©çŠ¶æ€ï¼ŒåŒå‡»ç›®å½•å¯è¿›å…¥")):(b(),E("span",Be,"æç¤ºï¼šé€‰æ‹©ç›®å½•ä½œä¸ºè½¬å­˜ç›®æ ‡ï¼ŒåŒå‡»ç›®å½•å¯è¿›å…¥"))]),L("div",Se,[X(i.$slots,"footer-prepend"),k($,{onClick:I},{default:y(()=>[...s[8]||(s[8]=[M("å–æ¶ˆ",-1)])]),_:1}),k($,{type:"primary",onClick:H,loading:l.confirmLoading,disabled:V.value},{default:y(()=>[M(U(l.confirmButtonText),1),l.mode==="file"?(b(),E("span",Ue," ("+U(f.value.length)+")",1)):N("",!0)]),_:1},8,["loading","disabled"])])])])]),default:y(()=>[L("div",ke,[L("div",xe,[k(g,{"model-value":n.value,placeholder:"å½“å‰è·¯å¾„",readonly:""},null,8,["model-value"]),k($,{type:"primary",onClick:t,loading:m.value},{default:y(()=>[...s[2]||(s[2]=[M(" åˆ·æ–° ",-1)])]),_:1},8,["loading"])]),L("div",Fe,[k($,{size:"small",onClick:x,disabled:!h.value},{default:y(()=>[...s[3]||(s[3]=[M(" ä¸Šä¸€çº§ ",-1)])]),_:1},8,["disabled"]),k($,{size:"small",onClick:p},{default:y(()=>[...s[4]||(s[4]=[M(" é¦–é¡µ ",-1)])]),_:1}),k($,{size:"small",onClick:R},{default:y(()=>[...s[5]||(s[5]=[M(" å…¨é€‰ ",-1)])]),_:1}),k($,{size:"small",onClick:W},{default:y(()=>[...s[6]||(s[6]=[M(" å–æ¶ˆå…¨é€‰ ",-1)])]),_:1}),f.value.length>0?(b(),E("span",Pe," å·²é€‰æ‹© "+U(f.value.length)+" ä¸ªæ–‡ä»¶ ",1)):N("",!0)])]),ie((b(),A(a,{data:u.value,stripe:"",class:"w-full",height:400,onRowClick:P},{default:y(()=>[k(z,{width:"55"},{default:y(({row:v})=>[v.isDirectory?N("",!0):(b(),A(K,{key:0,"model-value":D(v),onChange:j=>w(v),onClick:s[0]||(s[0]=Q(()=>{},["stop"]))},null,8,["model-value","onChange"]))]),_:1}),k(z,{prop:"name",label:"åç§°","min-width":"200"},{default:y(({row:v})=>[L("div",Ce,[v.isDirectory?(b(),E("span",Ee,"ðŸ“")):(b(),E("span",Le,"ðŸ“„")),L("span",null,U(v.name),1)])]),_:1}),k(z,{prop:"size",label:"å¤§å°",width:"100"},{default:y(({row:v})=>[v.isDirectory?(b(),E("span",Me,"-")):(b(),E("span",$e,U(te(be)(v.size)),1))]),_:1}),k(z,{label:"çŠ¶æ€",width:"100"},{default:y(({row:v})=>[!v.isDirectory&&D(v)?(b(),A(Z,{key:0,type:"success",size:"small"},{default:y(()=>[...s[7]||(s[7]=[M(" å·²é€‰æ‹© ",-1)])]),_:1})):N("",!0)]),_:1})]),_:1},8,["data"])),[[o,m.value]])]),_:3},8,["model-value","title"])}}}),Re={key:0},Ie={class:"text-xs text-gray-600 flex-shrink-0 min-width-[35px]"},ze=ee({__name:"MediaComponent",props:{file:{},player:{},isPlaying:{type:Boolean,default:!1},progress:{default:0},duration:{default:0},disabled:{type:Boolean,default:!1},widthClass:{default:"w-32"}},emits:["play","seek"],setup(l,{emit:c}){const e=l,r=c,n=p=>p?.uri||p?.path||p?.name||"",u=C(!1),m=S(()=>{if(e.player){const p=n(e.file);return e.player.isFilePlaying(p)}return e.isPlaying}),f=S(()=>{if(e.player){const p=n(e.file);return e.player.getFilePlayProgress(p)}return e.progress}),h=S(()=>{if(e.player){const p=n(e.file),P=e.file?.duration||e.duration;return e.player.getFileDuration(p,P)}return e.duration}),_=S(()=>_e(h.value)),F=S(()=>e.disabled||u.value),t=()=>{if(!F.value){if(m.value){r("play",e.file);return}u.value=!0,r("play",e.file)}},x=p=>{if(!e.disabled&&m.value){if(e.player){const P=n(e.file);e.player.seekFile(P,p)}r("seek",e.file,p)}};return O([m,h],([p,P])=>{p&&P>0&&(u.value=!1)},{immediate:!0}),O(()=>e.file,()=>{u.value=!1}),(p,P)=>{const w=ye,D=ne,R=he;return b(),E("div",{class:re(["flex items-center gap-1.5 bg-gray-50 rounded border-gray-500 pr-1",l.widthClass])},[k(D,{type:"default",plain:"",size:"small",circle:"",onClick:Q(t,["stop"]),disabled:F.value,loading:u.value&&!m.value,class:"!w-6 !h-6 !p-0 flex-shrink-0 mr-1"},{default:y(()=>[m.value?(b(),E("span",Re,"â¹")):u.value?N("",!0):(b(),A(w,{key:1,class:"!w-3 !h-3"},{default:y(()=>[k(te(oe))]),_:1}))]),_:1},8,["disabled","loading"]),k(R,{"model-value":f.value,min:0,max:100,step:.1,size:"small",class:"flex-1 min-width-[10px] player-slider","show-tooltip":!1,disabled:!m.value||l.disabled,onChange:x,onInput:x,onClick:P[0]||(P[0]=Q(()=>{},["stop"]))},null,8,["model-value","disabled"]),L("span",Ie,U(_.value),1)],2)}}}),Qe=le(ze,[["__scopeId","data-v-9b8781cc"]]),B=()=>{},T=0,q=0;function Ke(l={}){const{playingFilePath:c=null,playingFileIndex:e=null,callbacks:r={}}=l,n={onPlay:r.onPlay||B,onPause:r.onPause||B,onTimeUpdate:r.onTimeUpdate||B,onDurationUpdate:r.onDurationUpdate||B,onError:r.onError||B,onEnded:r.onEnded||B},u=C(c),m=C(q),f=C(T),h=C(T),_=C(!1),F=C(e);let t=null,x=null;const p=()=>{t&&(t.currentTime=T)},P=a=>{a>0&&isFinite(a)&&(h.value=a,n.onDurationUpdate(a))},w=()=>{m.value=q,f.value=T,h.value=T,_.value=!1},D=()=>{if(t){try{t.paused||t.pause(),t.currentTime=0,t.removeAttribute("src")}catch{}t=null}},R=()=>{if(!t)return;t.addEventListener("play",d=>{const o=d.target;!o||t!==o||(p(),_.value=!0,n.onPlay(o))});const a=d=>{const o=d.target;!o||t!==o||(p(),P(o.duration))};t.addEventListener("loadedmetadata",a),t.addEventListener("loadeddata",a),t.addEventListener("timeupdate",d=>{const o=d.target;if(!o||t!==o)return;const v=o.duration;if(v>0&&isFinite(v)){const j=o.currentTime,J=j/v*100;f.value=j,m.value=J,h.value!==v&&(h.value=v),n.onTimeUpdate(j,v,J)}}),t.addEventListener("pause",d=>{const o=d.target;!o||t!==o||(_.value=!1,o.ended?n.onEnded(o):n.onPause(o))}),t.addEventListener("error",d=>{const o=d.target;!o||t!==o||(console.error("éŸ³é¢‘æ’­æ”¾å¤±è´¥:",d,"URL:",x),_.value=!1,n.onError(d,x||""))}),t.addEventListener("ended",d=>{const o=d.target;!o||t!==o||(_.value=!1,n.onEnded(o))})},W=(a,d={})=>{if(!a||typeof a!="string"||a.trim()===""){console.error("éŸ³é¢‘URLä¸èƒ½ä¸ºç©ºæˆ–æ— æ•ˆ:",a);return}try{const o=new URL(a,window.location.origin);if(!o.pathname||o.pathname==="/"||o.pathname.endsWith(".html")){console.error("éŸ³é¢‘URLæ ¼å¼æ— æ•ˆï¼Œå¯èƒ½æ˜¯HTMLé¡µé¢:",a);return}}catch{if(a.includes("index.html")||a.endsWith(".html")){console.error("éŸ³é¢‘URLæ ¼å¼æ— æ•ˆï¼Œå¯èƒ½æ˜¯HTMLé¡µé¢:",a);return}}t&&D(),w(),t=new Audio(a),x=a,p(),d.playingFilePath!==void 0&&(u.value=d.playingFilePath),d.playingFileIndex!==void 0&&(F.value=d.playingFileIndex),R()},H=()=>t?t.play().catch(a=>{throw console.error("æ’­æ”¾å¤±è´¥:",a),a}):(console.warn("éŸ³é¢‘æœªåŠ è½½ï¼Œæ— æ³•æ’­æ”¾"),Promise.reject(new Error("éŸ³é¢‘æœªåŠ è½½"))),I=()=>{t&&t.pause()},V=a=>{if(!t){console.warn("éŸ³é¢‘æœªåŠ è½½ï¼Œæ— æ³•è·³è½¬");return}const d=t.duration;if(d>0&&isFinite(d)&&isFinite(a)){const o=Math.max(0,Math.min(a/100*d,d));t.currentTime=o,f.value=o,m.value=a}};return{get audio(){return t},playingFilePath:u,playProgress:m,currentTime:f,duration:h,isPlaying:_,playingFileIndex:F,load:W,play:H,pause:I,seek:V,clear:()=>{if(t){try{t.paused||t.pause(),t.currentTime=T}catch{}D()}x=null,u.value=null,F.value=null,w()},updateCallbacks:a=>{Object.assign(n,a)},isFilePlaying:a=>a?u.value===a&&t!==null&&!t.paused:!1,getFilePlayProgress:a=>!a||u.value!==a||!t?q:m.value,getFileCurrentTime:a=>!a||u.value!==a?T:f.value,getFileDuration:(a,d=T)=>a&&u.value===a&&h.value||d,seekFile:(a,d)=>{!t||!a||u.value===a&&V(d)}}}function Ae(l,c,e={}){const{immediate:r=!1,autoCleanup:n=!0}=e;let u=null,m=c;const f=async()=>{try{await l()}catch(x){se.error("[useInterval] å®šæ—¶å™¨å›žè°ƒæ‰§è¡Œå¤±è´¥:",x)}},h=()=>{m===null||m<=0||(_(),r&&f(),u=setInterval(f,m))},_=()=>{u!==null&&(clearInterval(u),u=null)},F=x=>{x!==void 0&&(m=x),h()},t=()=>u!==null;return c!==null&&c>0&&h(),n&&ue(()=>{_()}),{start:h,stop:_,restart:F,isRunning:t}}function Ze(l,c,e={}){let r=c;const n=Ae(l,null,{...e,autoCleanup:!0});return{start:()=>{n.restart(r)},stop:n.stop,restart:u=>{u!==void 0&&(r=u),n.restart(r)},isRunning:n.isRunning}}export{Qe as M,qe as _,Ae as a,be as b,He as c,Ze as d,_e as f,Ge as g,We as n,Ke as u};
