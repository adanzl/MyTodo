import{j as ze,r as k,t as Re,L as ut,n as m,o as i,s as t,Q as s,G as l,$ as S,D as E,E as Pe,J as C,M as dt,l as V,u as L,aa as Ae,ai as ct,c as W,y as Ge,q as I,F as Be,a6 as Ee,I as ve}from"./vue-vendor-C-hNZ0TW.js";import{c as Le,L as ft,F as et,q as vt,A as pt,D as mt,y as je,u as qe,B as _t,a1 as Ne,f as Oe,E as u,ak as pe,M as He,i as gt,a9 as We,al as Je,a8 as tt,ab as xt,K as st,am as yt,ae as ht,an as kt,a0 as bt,X as wt,C as lt,ao as at,ap as nt,t as Tt,r as Ct,Y as $t,aj as St,ai as Mt}from"./element-plus-Cmtfo66s.js";import{m as ot,a as M,k as Ie}from"./utils-shared-B2b8bsxo.js";import{D as Dt,E as Pt,F as Vt,G as Ft,H as At,I as Bt,J as Et,K as zt,M as Ut,N as Rt,O as Lt,P as jt,Q as Nt,R as Ot,S as It,T as Kt,U as Yt,V as Gt,W as Ue,X as qt,Y as Ht,Z as Wt,_ as Jt,$ as Qt,a0 as Xt,a1 as Xe,a2 as Zt,a3 as es,a4 as Ze,a5 as ts}from"./api-shared-DHR2pBqQ.js";import{u as rt,b as Qe,M as Ke,_ as Ye}from"./useInterval-D8Vt3M-n.js";import{c as it,C as ss}from"./constants-shared-BwcKRbUv.js";import"./utils-Dtqx8Ray.js";import"./vendor-4xlYshH7.js";import"./types-shared-CiUQVXWn.js";import"./index-CF0R6bEv.js";import"./vant-7Cqjo8an.js";const ls={class:"p-4 flex flex-col h-[calc(100vh-200px)]"},as={class:"mb-4 flex-shrink-0 border rounded p-3 bg-gray-50"},ns={class:"flex flex-col gap-3"},os={class:"flex items-center gap-3"},rs={class:"flex-1 min-w-0"},is={class:"flex items-center gap-2"},us=["title"],ds={key:0,class:"text-xs text-gray-500 flex-shrink-0"},cs={class:"flex items-center gap-2"},fs={class:"flex items-center justify-between"},vs={class:"flex-1 overflow-auto"},ps=["onClick","title"],ms={key:1,class:"text-gray-400"},_s={key:0,class:"flex flex-col gap-1"},gs={class:"text-sm"},xs={class:"text-xs text-gray-500"},ys={key:1,class:"text-gray-400"},hs={key:0,class:"flex flex-col gap-1"},ks={class:"text-sm"},bs={class:"text-xs text-gray-500"},ws={key:1,class:"text-gray-400"},Ts={class:"flex flex-col gap-1 items-center"},Cs=["onClick"],$s=["title"],Ss={class:"flex items-center gap-2"},Ms=ze({__name:"PdfTool",setup(Ve){const r=k(!1),T=k([]),e=k(null),j=k(""),w=k(0),D=k(""),F=k(null),b=k(null);let $=null;const U=async()=>{try{r.value=!0;const v=await Dt();if(v.code===0){const p=v.data||[];T.value=p.map(h=>({...h,_decrypting:h.status==="processing"||!1,_password:""}))}else u.error(v.msg||"获取任务列表失败")}catch(v){M(v,"获取任务列表失败")}finally{r.value=!1}},J=v=>{v.raw&&(e.value=v.raw,j.value=v.raw.name,w.value=0,D.value="",F.value&&X())},Q=v=>{if(v<60)return`${v}秒`;if(v<3600){const p=Math.floor(v/60),h=v%60;return`${p}分${h}秒`}else{const p=Math.floor(v/3600),h=Math.floor(v%3600/60),Y=v%60;return`${p}小时${h}分${Y}秒`}},K=()=>{if(b.value!==null&&w.value>0&&w.value<100){const v=Math.floor((Date.now()-b.value)/1e3);D.value=Q(v)}},X=()=>{F.value&&r.value?(F.value.abort(),F.value=null,$&&(clearInterval($),$=null),w.value=0,D.value="",b.value=null,r.value=!1,u.info("上传已取消")):(e.value=null,j.value="",w.value=0,D.value="",b.value=null,u.info("已清除选中文件"))},ye=async()=>{if(!e.value){u.warning("请选择要上传的文件");return}const v=e.value;if(!v.name.toLowerCase().endsWith(".pdf")){u.error("只支持 PDF 文件");return}F.value&&X();try{r.value=!0,w.value=0,D.value="",b.value=Date.now();const p=new AbortController;F.value=p,$=setInterval(()=>{K()},1e3);const h=await Pt(v,Y=>{w.value=Y,K()},p.signal);$&&(clearInterval($),$=null),F.value=null,h.code===0?(w.value=100,K(),u.success("文件上传成功"),setTimeout(()=>{e.value=null,j.value="",w.value=0,D.value="",b.value=null},500),await U()):(u.error(h.msg||"文件上传失败"),w.value=0,D.value="",b.value=null)}catch(p){if(p.name==="CanceledError"||p.code==="ECONNABORTED"||p.message?.includes("canceled")||p.message?.includes("aborted")){$&&(clearInterval($),$=null),F.value||(r.value=!1);return}const h=p.message||"文件上传失败",Y=w.value;p.code==="ERR_NETWORK"||p.message?.includes("Network Error")?u.error(`网络错误：上传中断。当前进度：${Y}%`):p.response?.status===413?(u.error("文件太大，超过服务器限制（最大 1000MB）"),w.value=0,D.value=""):u.error(`上传失败：${h}`),$&&(clearInterval($),$=null),F.value=null,b.value=null,r.value=!1}},G=async v=>{if(!v.uploaded_info){u.warning("请先上传文件");return}if(!(v._decrypting||v.status==="processing")&&!(v.status==="success"&&!await pe.confirm("已解密的文件已存在，是否重新解密？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{v._decrypting=!0;const p=v._password?.trim()||void 0,h=await Vt(v.task_id,p);h.code===0?(u.success(h.data?.message||"解密任务已提交，正在后台处理"),v._password="",await me(v)):u.error(h.msg||"提交解密任务失败")}catch(p){M(p,"提交解密任务失败")}finally{v._decrypting=!1}},me=async(v,p=30)=>{let h=0;const Y=async()=>{if(h>=p){u.warning("任务处理超时，请手动刷新查看状态"),await U();return}try{const te=await Bt(v.task_id);if(te.code===0){const Z=te.data;v.status=Z.status,v.unlocked_info=Z.unlocked_info,v.error_message=Z.error_message,Z.status==="success"?(u.success("文件解密成功"),v._decrypting=!1,await U()):Z.status==="failed"?(u.error(Z.error_message||"文件解密失败"),v._decrypting=!1):Z.status==="processing"?(h++,setTimeout(Y,1e3)):v._decrypting=!1}}catch(te){M(te,"查询任务状态失败"),v._decrypting=!1}};Y()},O=async(v,p)=>{const h=p==="uploaded"?v.uploaded_info:v.unlocked_info;if(!h){u.warning("文件不存在");return}try{const Y=Ft(h.name,p);window.open(Y,"_blank")}catch(Y){M(Y,"下载文件失败")}},Ce=async v=>{if(!v.uploaded_info){u.warning("请先上传文件");return}if(v.status==="processing"){u.warning("任务正在处理中，无法删除");return}if(await pe.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{r.value=!0;const h=await At(v.task_id);h.code===0?(u.success(h.data?.message||"任务删除成功"),await U()):u.error(h.msg||"任务删除失败")}catch(h){M(h,"删除任务失败")}finally{r.value=!1}},_e=ot,q=v=>v?new Date(v*1e3).toLocaleString():"-";return Re(()=>{U()}),ut(()=>{$&&(clearInterval($),$=null),F.value&&(F.value.abort(),F.value=null)}),(v,p)=>{const h=Le,Y=ft,te=et,Z=Oe,se=mt,H=je,he=qe,$e=_t,ge=vt,re=pt;return i(),m("div",ls,[p[12]||(p[12]=t("h2",{class:"text-xl font-semibold mb-4"},"PDF 解密工具",-1)),t("div",as,[t("div",ns,[t("div",os,[t("div",null,[s(h,{type:"success",size:"small",onClick:ye,loading:r.value,disabled:!e.value},{default:l(()=>[...p[0]||(p[0]=[S(" 上传 ",-1)])]),_:1},8,["loading","disabled"])]),s(Y,{"auto-upload":!1,"on-change":J,"show-file-list":!1,accept:".pdf"},{trigger:l(()=>[s(h,{type:"primary",size:"small",class:"!m-0"},{default:l(()=>[...p[1]||(p[1]=[S("选择文件",-1)])]),_:1})]),_:1}),t("div",rs,[t("div",is,[t("div",{class:Pe(["text-sm truncate flex-1 min-w-0",e.value?"text-gray-600":"text-gray-400"]),title:j.value||e.value?.name},C(j.value||e.value?.name||"未选择文件"),11,us),D.value?(i(),m("div",ds," 已用时间: "+C(D.value),1)):E("",!0)])])]),t("div",cs,[s(te,{percentage:w.value,status:w.value===100?"success":void 0,class:"flex-1"},null,8,["percentage","status"]),s(h,{type:"danger",size:"small",plain:"",onClick:X,disabled:!e.value},{default:l(()=>[...p[2]||(p[2]=[S(" 取消 ",-1)])]),_:1},8,["disabled"])])])]),s(ge,{class:"flex-1 flex flex-col overflow-hidden",shadow:"hover"},{header:l(()=>[t("div",fs,[p[4]||(p[4]=t("span",null,"文件列表",-1)),s(h,{type:"info",size:"small",plain:"",onClick:U,loading:r.value},{default:l(()=>[r.value?E("",!0):(i(),V(Z,{key:0},{default:l(()=>[s(L(Ne))]),_:1})),p[3]||(p[3]=S(" 刷新 ",-1))]),_:1},8,["loading"])])]),default:l(()=>[t("div",vs,[dt((i(),V($e,{data:T.value,stripe:"",class:"w-full"},{empty:l(()=>[...p[11]||(p[11]=[t("div",{class:"text-center text-gray-400 py-8"},"暂无文件，请上传 PDF 文件",-1)])]),default:l(()=>[s(se,{prop:"filename",label:"文件名","min-width":"200"},{default:l(({row:g})=>[g.uploaded_info?(i(),m("span",{key:0,class:"text-blue-600 cursor-pointer hover:underline",onClick:le=>O(g,"uploaded"),title:g.uploaded_info.name},C(g.uploaded_info.name||g.name||g.filename||g.task_id),9,ps)):(i(),m("span",ms,"-"))]),_:1}),s(se,{label:"上传文件","min-width":"150"},{default:l(({row:g})=>[g.uploaded_info?(i(),m("div",_s,[t("span",gs,C(L(_e)(g.uploaded_info.size)),1),t("span",xs,C(q(g.uploaded_info.modified)),1)])):(i(),m("span",ys,"-"))]),_:1}),s(se,{label:"已解密文件","min-width":"150"},{default:l(({row:g})=>[g.unlocked_info?(i(),m("div",hs,[t("span",ks,C(L(_e)(g.unlocked_info.size)),1),t("span",bs,C(q(g.unlocked_info.modified)),1)])):(i(),m("span",ws,"未解密"))]),_:1}),s(se,{label:"状态",width:"140",align:"center"},{default:l(({row:g})=>[t("div",Ts,[g.status==="success"?(i(),V(H,{key:0,type:"success",size:"small"},{default:l(()=>[...p[5]||(p[5]=[S("已解密",-1)])]),_:1})):g.status==="processing"?(i(),V(H,{key:1,type:"warning",size:"small"},{default:l(()=>[...p[6]||(p[6]=[S("处理中",-1)])]),_:1})):g.status==="pending"?(i(),V(H,{key:2,type:"info",size:"small"},{default:l(()=>[...p[7]||(p[7]=[S("等待中",-1)])]),_:1})):g.status==="failed"?(i(),V(H,{key:3,type:"danger",size:"small"},{default:l(()=>[...p[8]||(p[8]=[S("失败",-1)])]),_:1})):(i(),V(H,{key:4,type:"info",size:"small"},{default:l(()=>[...p[9]||(p[9]=[S("已上传",-1)])]),_:1})),g.unlocked_info?(i(),m("span",{key:5,class:"text-xs text-blue-600 cursor-pointer hover:underline",onClick:le=>O(g,"unlocked")}," 下载 ",8,Cs)):E("",!0),g.error_message?(i(),m("span",{key:6,class:"text-xs text-red-500",title:g.error_message}," 错误 ",8,$s)):E("",!0)])]),_:1}),s(se,{label:"操作",width:"280",fixed:"right"},{default:l(({row:g})=>[t("div",Ss,[g.uploaded_info?(i(),V(he,{key:0,modelValue:g._password,"onUpdate:modelValue":le=>g._password=le,type:"password",size:"small",placeholder:"密码（可选）","show-password":"",clearable:"",class:"w-30",disabled:g._decrypting||g.status==="processing",onKeyup:Ae(le=>G(g),["enter"])},null,8,["modelValue","onUpdate:modelValue","disabled","onKeyup"])):E("",!0),g.uploaded_info&&g.status!=="processing"?(i(),V(h,{key:1,type:"primary",size:"small",onClick:le=>G(g),loading:g._decrypting,disabled:g._decrypting||g.status==="processing"},{default:l(()=>[S(C(g.status==="success"?"重新解密":"解密"),1)]),_:2},1032,["onClick","loading","disabled"])):E("",!0),g.uploaded_info?(i(),V(h,{key:2,type:"danger",size:"small",plain:"",onClick:le=>Ce(g),disabled:g.status==="processing"},{default:l(()=>[...p[10]||(p[10]=[S(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])):E("",!0)])]),_:1})]),_:1},8,["data"])),[[re,r.value]])])]),_:1})])}}}),Ds={viewBox:"0 0 512 512",width:"1.2em",height:"1.2em"};function Ps(Ve,r){return i(),m("svg",Ds,[...r[0]||(r[0]=[t("path",{fill:"none",stroke:"currentColor","stroke-linecap":"square","stroke-width":"48",d:"m136 208l120-104l120 104m-240 96l120 104l120-104"},null,-1)])])}const Vs=ct({name:"ion-chevron-expand-sharp",render:Ps}),Fs={class:"flex gap-4 h-[calc(100vh-220px)]"},As={class:"w-64 border rounded p-3 flex flex-col"},Bs={class:"flex items-center justify-between mb-3"},Es={class:"flex items-center gap-1"},zs={key:0,class:"flex-1 overflow-y-auto space-y-2 pr-1 min-h-[400px]"},Us=["onClick"],Rs={class:"flex items-center justify-between gap-2"},Ls={class:"text-sm font-medium truncate flex-1 min-w-0"},js={class:"text-xs text-gray-500 whitespace-nowrap flex items-center gap-1 flex-shrink-0"},Ns={class:"whitespace-nowrap w-5 flex items-center justify-center"},Os={class:"flex items-center justify-between gap-2 min-h-[20px]"},Is={class:"flex items-center gap-1 flex-shrink-0"},Ks={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},Ys={key:0,class:"flex-1 border rounded p-3 flex flex-col max-w-2xl"},Gs={class:"flex items-center justify-between mb-3 flex-shrink-0"},qs={class:"text-base font-semibold"},Hs={class:"text-sm text-gray-500"},Ws={class:"flex-1 overflow-auto flex flex-col gap-3"},Js={class:"flex items-center justify-between gap-4 flex-shrink-0"},Qs={class:"flex items-center gap-4"},Xs={class:"text-red-500 text-xs truncate max-w-xs inline-block cursor-help"},Zs={class:"flex items-center gap-2"},el={class:"border rounded p-2 flex-1 flex flex-col overflow-hidden"},tl={class:"flex items-center justify-between mb-2 flex-shrink-0"},sl={class:"flex items-center gap-1 pr-1"},ll={class:"flex-1 overflow-auto"},al={key:0},nl=["draggable","onDragstart","onDrop"],ol={class:"text-xs text-gray-500 w-8"},rl=["title"],il={key:0,class:"text-xs text-gray-500 whitespace-nowrap w-20 text-right"},ul={key:1,class:"w-20"},dl={key:1,class:"text-sm text-gray-400 text-center py-1"},cl={key:1,class:"flex-1 border rounded p-3 flex flex-col max-w-2xl"},fl=ze({__name:"AudioMerge",setup(Ve){const r=k(!1),T=k([]),e=k(null),j=k(!1),w=k(!1),D=k(!1),F=k(null),b=rt({callbacks:{onPlay:()=>{u.success("开始播放")},onError:()=>{M(new Error("音频播放失败"),"播放失败"),H()},onEnded:()=>{H()}}}),$={size:"small",plain:!0,class:"!w-8 !h-6 !p-0"},U={size:"small",plain:!0,class:"!h-5 !text-xs !px-2"},J={size:"small",plain:!0,class:"!h-7 !text-xs"},Q=["bg-gray-100","border-t-2","border-b-2","border-blue-500"],K=a=>{a&&a.classList.remove(...Q)},X=a=>{if(!a)return;a.querySelectorAll('[draggable="true"]').forEach(_=>K(_))},ye=async a=>{if(e.value&&a.length!==0)try{r.value=!0;for(const d of a){const _=await Et(e.value.task_id,d);if(_.code!==0){u.error(`添加文件失败: ${_.msg||"未知错误"}`);break}}u.success(`成功添加 ${a.length} 个文件`),await O(e.value.task_id)}catch(d){M(d,"添加文件失败")}finally{r.value=!1}},G=async()=>{try{r.value=!0;const a=await zt();a.code===0?(T.value=a.data.tasks||[],T.value.length>0&&!e.value&&await O(T.value[0].task_id)):u.error(a.msg||"获取任务列表失败")}catch(a){M(a,"获取任务列表失败")}finally{r.value=!1}},me=async()=>{try{r.value=!0;const a=await Ut();a.code===0?(u.success("任务创建成功"),await G(),O(a.data.task_id)):u.error(a.msg||"创建任务失败")}catch(a){M(a,"创建任务失败")}finally{r.value=!1}},O=async a=>{e.value&&e.value.task_id!==a&&re();try{r.value=!0;const d=await Rt(a);d.code===0?e.value=d.data:u.error(d.msg||"获取任务信息失败")}catch(d){M(d,"获取任务信息失败")}finally{r.value=!1}},Ce=async a=>{if(await pe.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{r.value=!0;const _=await Ot(a);_.code===0?(u.success("任务删除成功"),await G(),e.value&&e.value.task_id===a&&(T.value&&T.value.length>0?await O(T.value[0].task_id):e.value=null)):u.error(_.msg||"删除任务失败")}catch(_){M(_,"删除任务失败")}finally{r.value=!1}},_e=()=>{if(!e.value){u.warning("请先创建或选择任务");return}j.value=!0},q=async a=>{if(!(!e.value||!await pe.confirm("确定要删除该文件吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{r.value=!0;const _=await It(e.value.task_id,a);_.code===0?(b.playingFileIndex.value===a?re():b.playingFileIndex.value!==null&&b.playingFileIndex.value>a&&(b.playingFileIndex.value=b.playingFileIndex.value-1),u.success("文件删除成功"),await O(e.value.task_id)):u.error(_.msg||"删除文件失败")}catch(_){M(_,"删除文件失败")}finally{r.value=!1}},v=async()=>{if(!(!e.value||!await pe.confirm(`确定要开始合成吗？将合并 ${xe.value} 个音频文件。`,"确认合成",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{r.value=!0;const d=await Lt(e.value.task_id);d.code===0?(u.success("合成任务已启动"),await G(),await O(e.value.task_id),Y()):u.error(d.msg||"启动任务失败")}catch(d){M(d,"启动任务失败")}finally{r.value=!1}},{start:p,stop:h}=Qe(async()=>{if(!e.value||e.value.status!=="processing"){h();return}await G(),await O(e.value.task_id)},it,{immediate:!1}),Y=()=>{p()},te=a=>{if(!a)return;const d=Kt(a);window.open(d,"_blank")},Z=()=>{e.value?.result_file&&te(e.value.task_id)},se=a=>{a?.result_file&&te(a.task_id)},H=()=>{b.clear()},he=(a,d)=>{if(!a)return;const _=a?.path||a?.name||"";b.seekFile(_,d)},$e=(a,d)=>{e.value?.result_file&&he({path:e.value.result_file},d)},ge=a=>{if(!e.value||!e.value.files||a<0||a>=e.value.files.length)return;const d=e.value.files[a],_=d.path||d.name||"";if(!_){u.warning("文件路径不存在");return}if(b.playingFilePath.value===_&&b.audio&&!b.audio.paused){H(),u.info("已停止播放");return}const R=Ie(_);if(!R){u.error("无法生成媒体文件URL");return}b.load(R,{playingFilePath:_,playingFileIndex:a}),b.play().catch(y=>{M(y,"播放失败"),H()})},re=()=>{H()},g=()=>{if(!e.value||!e.value.result_file){u.warning("结果文件不存在");return}const a=e.value.result_file;if(b.playingFilePath.value===a&&b.audio&&!b.audio.paused){H(),u.info("已停止播放");return}const d=Ie(a);if(!d){u.error("无法生成媒体文件URL");return}b.load(d,{playingFilePath:a}),b.play().catch(_=>{M(_,"播放失败"),H()})},le=()=>{if(!e.value||!e.value.result_file){u.warning("结果文件不存在");return}w.value=!0},Se=async a=>{if(!e.value||!e.value.result_file)return;if(a.length===0){u.warning("请选择转存目录");return}const d=a[0];try{r.value=!0;const _=await jt(e.value.task_id,d);_.code===0?(u.success("转存成功"),w.value=!1):u.error(_.msg||"转存失败")}catch(_){M(_,"转存失败")}finally{r.value=!1}},ne=ot,Me={pending:{tag:"info",text:"等待中"},processing:{tag:"warning",text:"处理中"},success:{tag:"success",text:"成功"},failed:{tag:"danger",text:"失败"}},ue=a=>Me[a]?.tag||"info",ke=a=>Me[a]?.text||"未知",be=W(()=>e.value?.status==="processing"),ee=W(()=>(e.value?.files||[]).length>0),xe=W(()=>(e.value?.files||[]).length),we=W(()=>e.value?.result_file),ae=W(()=>!we.value||e.value?.status!=="success"||D.value),c=W(()=>!ee.value||be.value||D.value),o=W(()=>be.value||D.value),P=W(()=>!e.value||!ee.value||be.value),z=W(()=>D.value?"点击退出拖拽排序模式":"点击进入拖拽排序模式"),f=W(()=>({path:we.value||""})),n=(a,d)=>!a||!d||a.length!==d.length?!0:a.some((_,R)=>{const y=_?.path||_?.name,Te=d[R]?.path||d[R]?.name;return y!==Te}),B=async()=>{if(D.value){if(e.value&&e.value.files&&e.value.files.length>0){if(n(F.value||[],e.value.files))try{r.value=!0;const d=e.value.files.map((R,y)=>y),_=await Nt(e.value.task_id,d);_.code===0?(u.success("排序已保存"),await O(e.value.task_id)):u.error(_.msg||"保存排序失败")}catch(d){M(d,"保存排序失败")}finally{r.value=!1}F.value=null}}else e.value&&e.value.files&&e.value.files.length>0&&(F.value=[...e.value.files||[]]);D.value=!D.value},N=(a,d)=>{if(!D.value)return a.preventDefault(),!1;try{a.dataTransfer&&(a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("text/plain",d.toString()))}catch(_){console.error("拖拽开始失败:",_)}},de=a=>{a.currentTarget&&K(a.currentTarget)},oe=a=>{a.currentTarget&&K(a.currentTarget)},ce=a=>{if(D.value&&(a.preventDefault(),a.dataTransfer&&(a.dataTransfer.dropEffect="move"),a.currentTarget)){const d=a.currentTarget.getBoundingClientRect(),_=a.clientY,R=d.top+d.height/2;K(a.currentTarget),_<R?a.currentTarget.classList.add("border-t-2","border-blue-500"):a.currentTarget.classList.add("border-b-2","border-blue-500")}},De=(a,d)=>{if(!D.value||(a.preventDefault(),a.currentTarget&&(K(a.currentTarget),X(a.currentTarget.parentElement)),!a.dataTransfer))return;const _=parseInt(a.dataTransfer.getData("text/plain"),10);if(_===d||isNaN(_)||!e.value||!e.value.files||_<0||_>=e.value.files.length||d<0||d>=e.value.files.length)return;const R=a.currentTarget?.getBoundingClientRect(),y=a.clientY,Te=R?R.top+R.height/2:0,Fe=y<Te?d:d+1,A=[...e.value.files||[]],[ie]=A.splice(_,1),fe=_<Fe?Fe-1:Fe;A.splice(fe,0,ie),e.value={...e.value,files:A}},x=()=>{j.value=!1};return Re(()=>{G()}),Ge(()=>{re(),h()}),(a,d)=>{const _=Oe,R=Le,y=je,Te=Je,Fe=Vs;return i(),m("div",Fs,[t("div",As,[t("div",Bs,[d[7]||(d[7]=t("h3",{class:"text-base font-semibold"},"任务列表",-1)),t("div",Es,[s(R,I({type:"info"},$,{onClick:G,loading:r.value}),{default:l(()=>[r.value?E("",!0):(i(),V(_,{key:0},{default:l(()=>[s(L(Ne))]),_:1}))]),_:1},16,["loading"]),s(R,I({type:"success"},$,{onClick:me,loading:r.value}),{default:l(()=>[s(_,null,{default:l(()=>[s(L(He))]),_:1})]),_:1},16,["loading"])])]),T.value&&T.value.length>0?(i(),m("div",zs,[(i(!0),m(Be,null,Ee(T.value,A=>(i(),m("div",{key:A.task_id,class:Pe(["border rounded px-3 py-2 cursor-pointer hover:bg-gray-50 group min-h-[60px] flex flex-col justify-between",{"border-blue-500 bg-blue-50":e.value&&A.task_id===e.value.task_id}]),onClick:ie=>O(A.task_id)},[t("div",Rs,[t("div",Ls,C(A.name),1),t("span",js,[s(_,null,{default:l(()=>[s(L(gt),{class:"!w-3 !h-3"})]),_:1}),t("span",Ns,C(A.files?A.files.length:0),1)])]),t("div",Os,[s(y,{type:ue(A.status),size:"small",class:"!h-5 !text-xs w-16 text-center"},{default:l(()=>[S(C(ke(A.status)),1)]),_:2},1032,["type"]),t("div",Is,[A.status==="success"&&A.result_file?(i(),V(R,I({key:0,type:"primary"},{ref_for:!0},U,{onClick:ve(ie=>se(A),["stop"])}),{default:l(()=>[...d[8]||(d[8]=[S(" 下载 ",-1)])]),_:1},16,["onClick"])):E("",!0),s(R,I({type:"danger"},{ref_for:!0},U,{onClick:ve(ie=>Ce(A.task_id),["stop"]),disabled:A.status==="processing"}),{default:l(()=>[s(_,null,{default:l(()=>[s(L(We))]),_:1})]),_:1},16,["onClick","disabled"])])])],10,Us))),128))])):(i(),m("div",Ks,' 暂无任务，请点击"新建"创建 '))]),e.value?(i(),m("div",Ys,[t("div",Gs,[t("h3",qs,"任务详情: "+C(e.value.name),1),t("span",Hs," 共 "+C(xe.value)+" 个文件 ",1)]),t("div",Ws,[t("div",Js,[t("div",Qs,[s(y,{type:ue(e.value.status),size:"small",class:"w-16 text-center"},{default:l(()=>[S(C(ke(e.value.status)),1)]),_:1},8,["type"]),we.value?(i(),V(Ke,{key:0,file:f.value,player:L(b),disabled:D.value,onPlay:g,onSeek:$e},null,8,["file","player","disabled"])):E("",!0),s(R,I({type:"primary"},J,{onClick:Z,disabled:ae.value}),{default:l(()=>[...d[9]||(d[9]=[S(" 下载 ",-1)])]),_:1},16,["disabled"]),s(R,I({type:"success"},J,{onClick:le,disabled:ae.value}),{default:l(()=>[...d[10]||(d[10]=[S(" 转存 ",-1)])]),_:1},16,["disabled"]),e.value.error_message?(i(),V(Te,{key:1,content:`错误: ${e.value.error_message}`,placement:"top"},{default:l(()=>[t("span",Xs," 错误: "+C(e.value.error_message),1)]),_:1},8,["content"])):E("",!0)]),t("div",Zs,[s(R,I({type:"success"},J,{onClick:v,disabled:c.value,loading:be.value}),{default:l(()=>[...d[11]||(d[11]=[S(" 开始合成 ",-1)])]),_:1},16,["disabled","loading"])])]),t("div",el,[t("div",tl,[d[13]||(d[13]=t("h4",{class:"text-sm font-semibold"},"文件列表",-1)),t("div",sl,[s(R,I({type:"primary"},U,{disabled:o.value,onClick:_e}),{default:l(()=>[...d[12]||(d[12]=[S(" + ",-1)])]),_:1},16,["disabled"]),s(R,I({type:D.value?"success":"default"},$,{onClick:B,disabled:P.value,title:z.value}),{default:l(()=>[D.value?(i(),V(_,{key:0},{default:l(()=>[s(L(tt))]),_:1})):(i(),V(Fe,{key:1,class:"!w-3.5 !h-3.5"}))]),_:1},16,["type","disabled","title"])])]),t("div",ll,[ee.value?(i(),m("div",al,[(i(!0),m(Be,null,Ee(e.value.files,(A,ie)=>(i(),m("div",{key:ie,class:Pe(["flex items-center gap-2 p-1 hover:bg-gray-100 rounded",{"cursor-move":D.value,"cursor-default":!D.value,"select-none":!0}]),draggable:D.value,onDragstart:fe=>N(fe,Number(ie)),onDragend:d[2]||(d[2]=fe=>de(fe)),onDragover:d[3]||(d[3]=ve(fe=>ce(fe),["prevent"])),onDragleave:oe,onDrop:ve(fe=>De(fe,Number(ie)),["prevent"])},[t("span",ol,C(Number(ie)+1),1),t("span",{class:"flex-1 text-sm truncate",title:A.path||A.name},C(A.name),9,rl),A.size?(i(),m("span",il,C(L(ne)(A.size)),1)):(i(),m("div",ul)),t("div",{class:"flex items-center gap-1 flex-shrink-0",onMousedown:d[0]||(d[0]=ve(()=>{},["stop"])),onClick:d[1]||(d[1]=ve(()=>{},["stop"]))},[s(Ke,{file:A,player:L(b),disabled:o.value,onPlay:()=>ge(Number(ie)),onSeek:he},null,8,["file","player","disabled","onPlay"]),s(R,{type:"info",size:"small",plain:"",circle:"",onClick:ve(fe=>q(Number(ie)),["stop"]),disabled:o.value,class:"!h-6 !text-xs"},{default:l(()=>[s(_,null,{default:l(()=>[s(L(xt))]),_:1})]),_:1},8,["onClick","disabled"])],32)],42,nl))),128))])):(i(),m("div",dl,"文件列表为空"))])])])])):(i(),m("div",cl,[...d[14]||(d[14]=[t("div",{class:"flex items-center justify-between mb-3 flex-shrink-0"},[t("h3",{class:"text-base font-semibold"},"任务详情")],-1),t("div",{class:"flex-1 flex items-center justify-center text-sm text-gray-400"}," 请从左侧选择一个任务查看详情 ",-1)])])),s(Ye,{visible:j.value,"onUpdate:visible":d[4]||(d[4]=A=>j.value=A),title:"选择文件添加到任务","confirm-button-text":"添加","confirm-loading":r.value,onConfirm:ye,onClose:x},null,8,["visible","confirm-loading"]),s(Ye,{visible:w.value,"onUpdate:visible":d[5]||(d[5]=A=>w.value=A),title:"选择转存目录","confirm-button-text":"转存",mode:"directory","confirm-loading":r.value,onConfirm:Se,onClose:d[6]||(d[6]=A=>w.value=!1)},null,8,["visible","confirm-loading"])])}}}),vl={class:"flex gap-4 h-[calc(100vh-220px)]"},pl={class:"w-64 border rounded p-3 flex flex-col"},ml={class:"flex items-center justify-between mb-3"},_l={class:"flex items-center gap-1"},gl={key:0,class:"flex-1 overflow-y-auto space-y-2 pr-1 min-h-[400px]"},xl=["onClick"],yl={class:"flex items-center justify-between gap-2"},hl=["title"],kl={class:"flex items-center justify-between gap-2 min-h-[20px]"},bl={class:"flex items-center gap-1 flex-shrink-0"},wl={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400 min-h-[400px]"},Tl={key:0,class:"flex-1 border rounded p-3 flex flex-col min-h-0"},Cl={class:"flex items-center justify-between mb-3 flex-shrink-0"},$l={class:"flex items-center gap-2 flex-1"},Sl={class:"text-base font-semibold"},Ml={class:"flex-1 flex flex-col gap-3 min-h-0"},Dl={class:"flex items-center gap-4 flex-shrink-0"},Pl={class:"text-red-500 text-xs truncate block max-w-md cursor-help"},Vl={class:"border rounded p-3 flex flex-col gap-2"},Fl={class:"flex items-center justify-between"},Al={class:"flex items-center gap-2"},Bl={key:0,class:"text-xs text-gray-500"},El={key:0,class:"text-sm text-gray-600"},zl=["title"],Ul={key:1,class:"text-sm text-gray-400"},Rl={class:"border rounded p-3 flex flex-col gap-2 flex-1 min-h-0 overflow-hidden"},Ll={key:0,class:"flex-1 overflow-y-scroll scrollbar-overlay space-y-1 min-h-0"},jl={class:"flex-1 min-w-0 flex items-center gap-3 text-sm"},Nl=["title"],Ol={class:"flex items-center gap-2 text-xs text-gray-500 flex-shrink-0"},Il={key:0},Kl={key:1},Yl=["title"],Gl={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400 min-h-0"},ql={key:1,class:"flex-1 border rounded p-3 flex flex-col"},Hl={key:2,class:"w-80 border rounded p-3 flex flex-col"},Wl={class:"flex-1 overflow-auto flex flex-col gap-3"},Jl={class:"border rounded p-3 flex flex-col gap-2"},Ql={class:"flex items-center gap-2"},Xl={class:"border rounded p-3 flex flex-col gap-2"},Zl={class:"flex items-center gap-2"},ea={class:"text-xs text-gray-400 flex items-center gap-1"},ta={key:0,class:"border rounded p-3 flex flex-col gap-2"},sa={key:0,class:"space-y-2"},la={class:"text-sm text-gray-600"},aa=["title"],na={key:1,class:"text-sm text-gray-400"},oa={key:1,class:"border rounded p-3 flex flex-col gap-2"},ra={class:"text-sm text-gray-600"},ia={key:0,class:"mt-2"},ua={key:3,class:"w-80 border rounded p-3 flex flex-col"},da=ze({__name:"AudioConvert",setup(Ve){const r=k(!1),T=k([]),e=k(null),j=k(!1),w=k("mp3"),D=k(!1),F=k(!0),b=k(!1),$=k(!1),U=k(""),J=k(!1),Q=k(""),K={size:"small",plain:!0,class:"!w-8 !h-6 !p-0"},X={size:"small",plain:!0,class:"!h-5 !text-xs !px-2"},ye={size:"small",plain:!0,class:"!h-7 !text-xs"},G=async()=>{try{r.value=!0;const c=await Yt();c.code===0?(T.value=c.data.tasks||[],T.value.length>0&&!e.value&&await q(T.value[0].task_id)):u.error(c.msg||"获取任务列表失败")}catch(c){M(c,"获取任务列表失败")}finally{r.value=!1}},me=()=>{const c=new Date,o=c.getFullYear(),P=String(c.getMonth()+1).padStart(2,"0"),z=String(c.getDate()).padStart(2,"0"),f=String(c.getHours()).padStart(2,"0"),n=String(c.getMinutes()).padStart(2,"0"),B=String(c.getSeconds()).padStart(2,"0");U.value=`${o}-${P}-${z} ${f}:${n}:${B}`,$.value=!0},O=async()=>{if(!U.value.trim()){u.warning("请输入任务名称");return}try{r.value=!0;const c=await Gt({name:U.value.trim()});c.code===0?(u.success("任务创建成功"),$.value=!1,U.value="",await G(),q(c.data.task_id)):u.error(c.msg||"创建任务失败")}catch(c){M(c,"创建任务失败")}finally{r.value=!1}},Ce=()=>{e.value&&(Q.value=e.value.name,J.value=!0)},_e=async()=>{if(e.value){if(!Q.value.trim()){u.warning("请输入任务名称");return}try{r.value=!0;const c=await Ue(e.value.task_id,{name:Q.value.trim()});c.code===0?(u.success("任务名称修改成功"),J.value=!1,Q.value="",await q(e.value.task_id)):u.error(c.msg||"修改任务名称失败")}catch(c){M(c,"修改任务名称失败")}finally{r.value=!1}}},q=async c=>{try{r.value=!0;const o=await qt(c);if(o.code===0){e.value=o.data;const P=T.value.findIndex(z=>z.task_id===c);P!==-1&&(T.value[P]={...o.data}),w.value=o.data.output_dir||"mp3",D.value=!1,F.value=o.data.overwrite!==!1,b.value=!1}else u.error(o.msg||"获取任务信息失败")}catch(o){M(o,"获取任务信息失败")}finally{r.value=!1}},v=async c=>{if(await pe.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{r.value=!0;const P=await Wt(c);P.code===0?(u.success("任务删除成功"),await G(),e.value&&e.value.task_id===c&&(T.value&&T.value.length>0?await q(T.value[0].task_id):e.value=null)):u.error(P.msg||"删除任务失败")}catch(P){M(P,"删除任务失败")}finally{r.value=!1}},p=()=>{if(!e.value){u.warning("请先创建或选择任务");return}j.value=!0},h=async c=>{if(!e.value||c.length===0)return;const o=c[0];try{r.value=!0;const P=await Ue(e.value.task_id,{directory:o});P.code===0?(u.success("目录设置成功"),await q(e.value.task_id),j.value=!1):u.error(P.msg||"设置目录失败")}catch(P){M(P,"设置目录失败")}finally{r.value=!1}},Y=()=>{j.value=!1},te=()=>{if(!e.value)return;const c=e.value.output_dir||"mp3";D.value=w.value!==c},Z=async()=>{if(e.value){if(!w.value.trim()){u.error("输出目录名称不能为空");return}try{r.value=!0;const c=await Ue(e.value.task_id,{output_dir:w.value.trim()});c.code===0?(u.success("输出目录名称保存成功"),await q(e.value.task_id)):u.error(c.msg||"保存输出目录名称失败")}catch(c){M(c,"保存输出目录名称失败")}finally{r.value=!1}}},se=()=>{if(!e.value)return;const c=e.value.overwrite!==!1;b.value=F.value!==c,b.value&&H()},H=async()=>{if(e.value)try{r.value=!0;const c=await Ue(e.value.task_id,{overwrite:F.value});c.code===0?(u.success("覆盖选项保存成功"),await q(e.value.task_id)):u.error(c.msg||"保存覆盖选项失败")}catch(c){M(c,"保存覆盖选项失败")}finally{r.value=!1}},he=async()=>{if(!e.value)return;if(!e.value.directory){u.warning("请先选择转码目录");return}if(await pe.confirm(`确定要开始转码吗？将转换 "${e.value.name}" 。`,"确认转码",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{r.value=!0;const o=await Ht(e.value.task_id);o.code===0?(u.success("转码任务已启动"),await G(),await q(e.value.task_id),re()):u.error(o.msg||"启动任务失败")}catch(o){M(o,"启动任务失败")}finally{r.value=!1}},{start:$e,stop:ge}=Qe(async()=>{if(!e.value){ge();return}if(await G(),e.value.status!=="processing"){await q(e.value.task_id),ge();return}await q(e.value.task_id)},ss,{immediate:!1}),re=()=>{$e()},g={pending:{tag:"info",text:"等待中"},processing:{tag:"warning",text:"处理中"},success:{tag:"success",text:"成功"},failed:{tag:"danger",text:"失败"}},le=c=>g[c]?.tag||"info",Se=c=>g[c]?.text||"未知",ne=W(()=>e.value?.status==="processing"),Me=W(()=>!e.value?.directory||ne.value),ue=W(()=>ne.value),ke=W(()=>e.value?.file_status?Object.keys(e.value.file_status).map(c=>{const o=e.value.file_status[c];return{path:c,status:o.status||"pending",error:o.error,size:o.size,duration:o.duration}}):[]),be=c=>c.path.split("/").pop()||c.path,ee=c=>c.status,xe=c=>c.error,we=c=>{if(!c)return"";const o=["B","KB","MB","GB"];let P=c,z=0;for(;P>=1024&&z<o.length-1;)P/=1024,z++;return`${P.toFixed(1)} ${o[z]}`},ae=c=>{if(!c)return"";const o=Math.floor(c/3600),P=Math.floor(c%3600/60),z=c%60;return o>0?`${o}:${P.toString().padStart(2,"0")}:${z.toString().padStart(2,"0")}`:`${P}:${z.toString().padStart(2,"0")}`};return Re(()=>{G()}),Ge(()=>{ge()}),(c,o)=>{const P=Oe,z=Le,f=je,n=Je,B=bt,N=qe,de=et,oe=nt,ce=at,De=lt;return i(),m("div",vl,[t("div",pl,[t("div",ml,[o[11]||(o[11]=t("h3",{class:"text-base font-semibold"},"任务列表",-1)),t("div",_l,[s(z,I({type:"info"},K,{onClick:G,loading:r.value}),{default:l(()=>[r.value?E("",!0):(i(),V(P,{key:0},{default:l(()=>[s(L(Ne))]),_:1}))]),_:1},16,["loading"]),s(z,I({type:"success"},K,{onClick:me,loading:r.value}),{default:l(()=>[r.value?E("",!0):(i(),V(P,{key:0},{default:l(()=>[s(L(He))]),_:1}))]),_:1},16,["loading"])])]),T.value&&T.value.length>0?(i(),m("div",gl,[(i(!0),m(Be,null,Ee(T.value,x=>(i(),m("div",{key:x.task_id,class:Pe(["border rounded px-3 py-2 cursor-pointer hover:bg-gray-50 group min-h-[60px] flex flex-col justify-between",{"border-blue-500 bg-blue-50":e.value&&x.task_id===e.value.task_id}]),onClick:a=>q(x.task_id)},[t("div",yl,[t("div",{class:"text-sm font-medium truncate flex-1 min-w-0",title:x.name},C(x.name),9,hl)]),t("div",kl,[s(f,{type:le(x.status),size:"small",class:"!h-5 !text-xs w-16 text-center"},{default:l(()=>[S(C(Se(x.status)),1)]),_:2},1032,["type"]),t("div",bl,[s(z,I({type:"danger"},{ref_for:!0},X,{onClick:ve(a=>v(x.task_id),["stop"]),disabled:x.status==="processing"}),{default:l(()=>[s(P,null,{default:l(()=>[s(L(We))]),_:1})]),_:1},16,["onClick","disabled"])])])],10,xl))),128))])):(i(),m("div",wl,' 暂无任务，请点击"新建"创建 '))]),e.value?(i(),m("div",Tl,[t("div",Cl,[t("div",$l,[t("h3",Sl,"文件列表: "+C(e.value.name),1),s(z,{type:"default",size:"small",plain:"",circle:"",disabled:ue.value,onClick:Ce,title:"编辑名称"},{default:l(()=>[s(P,null,{default:l(()=>[s(L(st))]),_:1})]),_:1},8,["disabled"])])]),t("div",Ml,[t("div",Dl,[s(f,{type:le(e.value.status),size:"small",class:"w-16 text-center flex-shrink-0"},{default:l(()=>[S(C(Se(e.value.status)),1)]),_:1},8,["type"]),e.value.error_message?(i(),V(n,{key:0,content:`错误: ${e.value.error_message}`,placement:"top",class:"flex-1 min-w-0 max-w-md"},{default:l(()=>[t("span",Pl," 错误: "+C(e.value.error_message),1)]),_:1},8,["content"])):E("",!0)]),t("div",Vl,[t("div",Fl,[t("div",Al,[o[12]||(o[12]=t("h4",{class:"text-sm font-semibold"},"转码目录",-1)),e.value.total_files!==null&&e.value.total_files!==void 0?(i(),m("span",Bl," 可处理文件数: "+C(e.value.total_files),1)):E("",!0)]),s(z,I({type:"primary"},X,{disabled:ue.value,onClick:p}),{default:l(()=>[...o[13]||(o[13]=[S(" 选择目录 ",-1)])]),_:1},16,["disabled"])]),e.value.directory?(i(),m("div",El,[t("div",{class:"truncate",title:e.value.directory},C(e.value.directory),9,zl)])):(i(),m("div",Ul," 请选择一个目录，该目录下的所有媒体文件将被转换为 MP3 格式 "))]),t("div",Rl,[o[14]||(o[14]=t("h4",{class:"text-sm font-semibold flex-shrink-0"},"文件列表",-1)),ke.value&&ke.value.length>0?(i(),m("div",Ll,[(i(!0),m(Be,null,Ee(ke.value,(x,a)=>(i(),m("div",{key:a,class:"flex items-center gap-2 p-2 rounded hover:bg-gray-50 border-b border-gray-100"},[s(P,{class:Pe(["flex-shrink-0",{"text-green-500":ee(x)==="success","text-red-500":ee(x)==="failed","text-yellow-500":ee(x)==="processing","text-gray-400":ee(x)==="pending"}])},{default:l(()=>[ee(x)==="success"?(i(),V(L(tt),{key:0})):ee(x)==="failed"?(i(),V(L(yt),{key:1})):ee(x)==="processing"?(i(),V(L(ht),{key:2})):(i(),V(L(kt),{key:3}))]),_:2},1032,["class"]),t("div",jl,[t("div",{class:"flex-1 min-w-0 truncate",title:x.path},C(be(x)),9,Nl),t("div",Ol,[x.size?(i(),m("span",Il,C(we(x.size)),1)):E("",!0),x.duration?(i(),m("span",Kl,C(ae(x.duration)),1)):E("",!0)]),xe(x)?(i(),m("div",{key:0,class:"text-xs text-red-500 truncate max-w-xs",title:xe(x)},C(xe(x)),9,Yl)):E("",!0)])]))),128))])):(i(),m("div",Gl," 暂无文件，请先选择转码目录 "))])])])):(i(),m("div",ql,[...o[15]||(o[15]=[t("div",{class:"flex items-center justify-between mb-3 flex-shrink-0"},[t("h3",{class:"text-base font-semibold"},"文件列表")],-1),t("div",{class:"flex-1 flex items-center justify-center text-sm text-gray-400"}," 请从左侧选择一个任务查看文件列表 ",-1)])])),e.value?(i(),m("div",Hl,[o[24]||(o[24]=t("div",{class:"flex items-center justify-between mb-3"},[t("h3",{class:"text-base font-semibold"},"输出信息")],-1)),t("div",Wl,[t("div",Jl,[t("div",Ql,[o[16]||(o[16]=t("span",{class:"text-sm text-gray-600"},"覆盖同名文件",-1)),s(B,{modelValue:F.value,"onUpdate:modelValue":o[0]||(o[0]=x=>F.value=x),disabled:ue.value,onChange:se},null,8,["modelValue","disabled"])]),s(z,I({type:"success"},ye,{onClick:he,disabled:Me.value,loading:ne.value,class:"w-full"}),{default:l(()=>[...o[17]||(o[17]=[S(" 开始转码 ",-1)])]),_:1},16,["disabled","loading"])]),t("div",Xl,[o[20]||(o[20]=t("div",{class:"flex items-center justify-between"},[t("h4",{class:"text-sm font-semibold"},"输出目录名称")],-1)),t("div",Zl,[s(N,{modelValue:w.value,"onUpdate:modelValue":o[1]||(o[1]=x=>w.value=x),placeholder:"输出目录名称",size:"small",disabled:ue.value,onBlur:te},null,8,["modelValue","disabled"]),s(z,I({type:"primary"},X,{disabled:ue.value||!D.value,onClick:Z}),{default:l(()=>[...o[18]||(o[18]=[S(" 保存 ",-1)])]),_:1},16,["disabled"])]),t("div",ea,[o[19]||(o[19]=t("span",null,"文件将保存在转码目录下的此文件夹中",-1)),e.value?.directory&&e.value?.output_dir?(i(),V(n,{key:0,content:`${e.value.directory}/${e.value.output_dir}`,placement:"top"},{default:l(()=>[s(P,{class:"cursor-help text-gray-400 hover:text-gray-600"},{default:l(()=>[s(L(wt))]),_:1})]),_:1},8,["content"])):E("",!0)])]),e.value.status==="processing"||e.value.progress?(i(),m("div",ta,[o[21]||(o[21]=t("h4",{class:"text-sm font-semibold"},"转码进度",-1)),e.value.progress?(i(),m("div",sa,[t("div",la," 已处理: "+C(e.value.progress.processed??0)+" / "+C(e.value.total_files??e.value.progress.total??0),1),s(de,{percentage:(e.value.total_files??e.value.progress.total??0)>0?Math.round((e.value.progress.processed??0)/(e.value.total_files??e.value.progress.total??1)*100):0,status:e.value.status==="processing"?void 0:"success"},null,8,["percentage","status"]),e.value.progress.current_file?(i(),m("div",{key:0,class:"text-xs text-gray-500 truncate",title:e.value.progress.current_file}," 正在处理: "+C(e.value.progress.current_file),9,aa)):E("",!0)])):(i(),m("div",na,"等待开始转码..."))])):E("",!0),e.value.status==="success"?(i(),m("div",oa,[o[23]||(o[23]=t("h4",{class:"text-sm font-semibold"},"转码结果",-1)),t("div",ra,[o[22]||(o[22]=t("div",null,"转码完成！所有文件已保存到输出目录",-1)),e.value.progress?(i(),m("div",ia," 共转换 "+C(e.value.total_files??e.value.progress.total??0)+" 个文件 ",1)):E("",!0)])])):E("",!0)])])):(i(),m("div",ua,[...o[25]||(o[25]=[t("h3",{class:"text-base font-semibold mb-3"},"输出信息",-1),t("div",{class:"flex-1 flex items-center justify-center text-sm text-gray-400"}," 请从左侧选择一个任务查看输出信息 ",-1)])])),s(Ye,{visible:j.value,"onUpdate:visible":o[2]||(o[2]=x=>j.value=x),title:"选择转码目录","confirm-button-text":"确定",mode:"directory","default-path":e.value?.directory||void 0,"confirm-loading":r.value,onConfirm:h,onClose:Y},null,8,["visible","default-path","confirm-loading"]),s(De,{modelValue:$.value,"onUpdate:modelValue":o[5]||(o[5]=x=>$.value=x),title:"创建转码任务",width:"400px",onClose:o[6]||(o[6]=x=>U.value="")},{footer:l(()=>[s(z,{onClick:o[4]||(o[4]=x=>$.value=!1)},{default:l(()=>[...o[26]||(o[26]=[S("取消",-1)])]),_:1}),s(z,{type:"primary",onClick:O,loading:r.value},{default:l(()=>[...o[27]||(o[27]=[S(" 确定 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[s(ce,null,{default:l(()=>[s(oe,{label:"任务名称"},{default:l(()=>[s(N,{modelValue:U.value,"onUpdate:modelValue":o[3]||(o[3]=x=>U.value=x),placeholder:"请输入任务名称",onKeyup:Ae(O,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(De,{modelValue:J.value,"onUpdate:modelValue":o[9]||(o[9]=x=>J.value=x),title:"重命名任务",width:"400px",onClose:o[10]||(o[10]=x=>Q.value="")},{footer:l(()=>[s(z,{onClick:o[8]||(o[8]=x=>J.value=!1)},{default:l(()=>[...o[28]||(o[28]=[S("取消",-1)])]),_:1}),s(z,{type:"primary",onClick:_e,loading:r.value},{default:l(()=>[...o[29]||(o[29]=[S(" 确定 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[s(ce,null,{default:l(()=>[s(oe,{label:"任务名称"},{default:l(()=>[s(N,{modelValue:Q.value,"onUpdate:modelValue":o[7]||(o[7]=x=>Q.value=x),placeholder:"请输入任务名称",onKeyup:Ae(_e,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),ca={class:"flex gap-4 h-[calc(100vh-220px)]"},fa={class:"w-64 border rounded p-3 flex flex-col"},va={class:"flex items-center justify-between mb-3"},pa={class:"flex items-center gap-1"},ma={key:0,class:"flex-1 overflow-y-auto space-y-2 pr-1 min-h-[400px]"},_a=["onClick"],ga={class:"flex items-center justify-between gap-2"},xa=["title"],ya={class:"flex items-center justify-between gap-2 min-h-[20px]"},ha={class:"flex items-center gap-1 flex-shrink-0"},ka={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},ba={key:0,class:"flex-1 border rounded p-3 flex flex-col max-w-2xl"},wa={class:"flex items-cente mb-3 flex-shrink-0"},Ta={class:"text-base font-semibold mr-2"},Ca={class:"flex-1 overflow-auto flex flex-col gap-3"},$a={class:"flex items-center gap-4 flex-shrink-0"},Sa={class:"text-red-500 text-xs truncate max-w-xs inline-block cursor-help"},Ma={class:"border rounded p-3 flex flex-col gap-2"},Da={class:"border rounded p-3 flex flex-col gap-2"},Pa={class:"grid grid-cols-3 gap-3"},Va={class:"flex flex-col gap-1"},Fa={class:"flex flex-col gap-1"},Aa={class:"flex flex-col gap-1"},Ba={class:"border rounded p-3 flex flex-col gap-2 flex-shrink-0"},Ea={key:1,class:"flex-1 border rounded p-3 flex flex-col max-w-2xl"},za=ze({__name:"TTS",setup(Ve){const r=k(!1),T=k([]),e=k(null),j=k(!1),w=k(""),D=k(""),F=k(!1),b=k(""),$=k(""),U=k(null),J=k(1),Q=k(50),K=k(!1),X=rt({callbacks:{onPlay:()=>{u.success("开始播放")},onError:()=>{M(new Error("音频播放失败"),"播放失败"),ne()},onEnded:()=>{ne()}}}),ye={size:"small",plain:!0,class:"!w-8 !h-6 !p-0"},G={size:"small",plain:!0,class:"!h-5 !text-xs !px-2"},me={size:"small",plain:!0,class:"!h-7 !text-xs"},O=async()=>{try{r.value=!0;const f=await Jt();f.code===0?(T.value=f.data||[],T.value.length>0&&!e.value&&await v(T.value[0].task_id)):u.error(f.msg||"获取任务列表失败")}catch(f){M(f,"获取任务列表失败")}finally{r.value=!1}},Ce=()=>{const f=new Date,n=f.getFullYear(),B=String(f.getMonth()+1).padStart(2,"0"),N=String(f.getDate()).padStart(2,"0"),de=String(f.getHours()).padStart(2,"0"),oe=String(f.getMinutes()).padStart(2,"0"),ce=String(f.getSeconds()).padStart(2,"0");w.value=`${n}-${B}-${N} ${de}:${oe}:${ce}`,D.value="",j.value=!0},_e=()=>{w.value=""},q=async()=>{try{r.value=!0;const f=await Qt({text:"",name:w.value.trim()||void 0});f.code===0?(u.success("任务创建成功"),j.value=!1,w.value="",await O(),v(f.data.task_id)):u.error(f.msg||"创建任务失败")}catch(f){M(f,"创建任务失败")}finally{r.value=!1}},v=async f=>{e.value&&e.value.task_id!==f&&Me();try{r.value=!0;const n=await Xt(f);if(n.code===0){e.value=n.data;const B=T.value.findIndex(N=>N.task_id===f);B!==-1&&(T.value[B]={...n.data}),$.value=n.data.text||"",U.value=n.data.role?n.data.role:null,J.value=n.data.speed??1,Q.value=n.data.vol??50,K.value=!1}else u.error(n.msg||"获取任务信息失败")}catch(n){M(n,"获取任务信息失败")}finally{r.value=!1}},p=async f=>{if(await pe.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{r.value=!0;const B=await ts(f);B.code===0?(u.success("任务删除成功"),await O(),e.value&&e.value.task_id===f&&(T.value&&T.value.length>0?await v(T.value[0].task_id):e.value=null)):u.error(B.msg||"删除任务失败")}catch(B){M(B,"删除任务失败")}finally{r.value=!1}},h=()=>{e.value&&(b.value=e.value.name,F.value=!0)},Y=async()=>{if(e.value){if(!b.value.trim()){u.warning("请输入任务名称");return}try{r.value=!0;const f=await Xe(e.value.task_id,{name:b.value.trim()});f.code===0?(u.success("任务名称修改成功"),F.value=!1,b.value="",await v(e.value.task_id)):u.error(f.msg||"修改任务名称失败")}catch(f){M(f,"修改任务名称失败")}finally{r.value=!1}}},te=()=>{if(!e.value)return;const f=e.value.text||"";K.value=$.value!==f,K.value&&H()},Z=f=>{U.value=f,se()},se=()=>{if(!e.value)return;const f=e.value.role||null,n=e.value.speed??1,B=e.value.vol??50;K.value=U.value!==f||J.value!==n||Q.value!==B,K.value&&H()},H=async()=>{if(!(!e.value||!K.value))try{r.value=!0;const f={},n=e.value.text||"";$.value!==n&&(f.text=$.value);const B=e.value.role||null;U.value!==B&&(f.role=U.value||void 0);const N=e.value.speed??1;J.value!==N&&(f.speed=J.value);const de=e.value.vol??50;Q.value!==de&&(f.vol=Q.value);const oe=await Xe(e.value.task_id,f);oe.code===0?(K.value=!1,await v(e.value.task_id)):u.error(oe.msg||"保存参数失败")}catch(f){M(f,"保存参数失败")}finally{r.value=!1}},he=async()=>{if(!e.value)return;if(!$.value.trim()){u.warning("请输入文本内容");return}if(K.value&&await H(),!!await pe.confirm(`确定要开始生成任务 "${e.value.name}" 吗？`,"确认生成",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{r.value=!0;const n=await Zt(e.value.task_id);n.code===0?(u.success("TTS 任务已启动"),await v(e.value.task_id),await O(),await v(e.value.task_id),g()):u.error(n.msg||"启动任务失败")}catch(n){M(n,"启动任务失败")}finally{r.value=!1}},$e=async()=>{if(!(!e.value||!await pe.confirm("确定要停止生成吗？","确认停止",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{r.value=!0;const n=await es(e.value.task_id);n.code===0?(u.success("任务已停止"),await O(),await v(e.value.task_id)):u.error(n.msg||"停止任务失败")}catch(n){M(n,"停止任务失败")}finally{r.value=!1}},{start:ge,stop:re}=Qe(async()=>{if(!e.value){re();return}if(await O(),e.value.status!=="processing"){await v(e.value.task_id),re();return}await v(e.value.task_id)},it,{immediate:!1}),g=()=>{ge()},le=()=>{if(!e.value?.output_file)return;const f=Ze(e.value.task_id);window.open(f,"_blank")},Se=f=>{if(!f?.output_file)return;const n=Ze(f.task_id);window.open(n,"_blank")},ne=()=>{X.clear()},Me=()=>{ne()},ue=()=>{if(!e.value||!e.value.output_file){u.warning("结果文件不存在");return}const f=e.value.output_file;if(X.playingFilePath.value===f&&X.audio&&!X.audio.paused){ne(),u.info("已停止播放");return}const n=Ie(f);if(!n){u.error("无法生成媒体文件URL");return}X.load(n,{playingFilePath:f}),X.play().catch(B=>{M(B,"播放失败"),ne()})},ke=(f,n)=>{e.value?.output_file&&be({path:e.value.output_file},n)},be=(f,n)=>{if(!f)return;const B=f?.path||f?.name||"";X.seekFile(B,n)},ee={pending:{tag:"info",text:"等待中"},processing:{tag:"warning",text:"处理中"},success:{tag:"success",text:"成功"},failed:{tag:"danger",text:"失败"}},xe=f=>ee[f]?.tag||"info",we=f=>ee[f]?.text||"未知",ae=W(()=>e.value?.status==="processing"),c=W(()=>!$.value.trim()||ae.value),o=W(()=>!e.value?.output_file||e.value.status!=="success"),P=W(()=>e.value?.output_file?{path:e.value.output_file,name:e.value.output_file.split("/").pop()||"output.mp3"}:null),z=W(()=>P.value?{path:P.value.path,name:P.value.name}:null);return Re(()=>{O()}),Ge(()=>{re(),ne()}),(f,n)=>{const B=Oe,N=Le,de=je,oe=Je,ce=qe,De=Ct,x=Tt,a=$t,d=nt,_=at,R=lt;return i(),m("div",ca,[t("div",fa,[t("div",va,[n[11]||(n[11]=t("h3",{class:"text-base font-semibold"},"任务列表",-1)),t("div",pa,[s(N,I({type:"info"},ye,{onClick:O,loading:r.value}),{default:l(()=>[r.value?E("",!0):(i(),V(B,{key:0},{default:l(()=>[s(L(Ne))]),_:1}))]),_:1},16,["loading"]),s(N,I({type:"success"},ye,{onClick:Ce,loading:r.value}),{default:l(()=>[r.value?E("",!0):(i(),V(B,{key:0},{default:l(()=>[s(L(He))]),_:1}))]),_:1},16,["loading"])])]),T.value&&T.value.length>0?(i(),m("div",ma,[(i(!0),m(Be,null,Ee(T.value,y=>(i(),m("div",{key:y.task_id,class:Pe(["border rounded px-3 py-2 cursor-pointer hover:bg-gray-50 group min-h-[60px] flex flex-col justify-between",{"border-blue-500 bg-blue-50":e.value&&y.task_id===e.value.task_id}]),onClick:Te=>v(y.task_id)},[t("div",ga,[t("div",{class:"text-sm font-medium truncate flex-1 min-w-0",title:y.name},C(y.name),9,xa)]),t("div",ya,[s(de,{type:xe(y.status),size:"small",class:"!h-5 !text-xs w-16 text-center"},{default:l(()=>[S(C(we(y.status)),1)]),_:2},1032,["type"]),t("div",ha,[y.status==="success"&&y.output_file?(i(),V(N,I({key:0,type:"primary"},{ref_for:!0},G,{onClick:ve(Te=>Se(y),["stop"])}),{default:l(()=>[...n[12]||(n[12]=[S(" 下载 ",-1)])]),_:1},16,["onClick"])):E("",!0),s(N,I({type:"danger"},{ref_for:!0},G,{onClick:ve(Te=>p(y.task_id),["stop"]),disabled:y.status==="processing"}),{default:l(()=>[s(B,null,{default:l(()=>[s(L(We))]),_:1})]),_:1},16,["onClick","disabled"])])])],10,_a))),128))])):(i(),m("div",ka,' 暂无任务，请点击"新建"创建 '))]),e.value?(i(),m("div",ba,[t("div",wa,[t("h3",Ta,"任务详情: "+C(e.value.name),1),s(N,{type:"default",size:"small",plain:"",circle:"",disabled:ae.value,onClick:h,title:"编辑名称"},{default:l(()=>[s(B,null,{default:l(()=>[s(L(st))]),_:1})]),_:1},8,["disabled"])]),t("div",Ca,[t("div",$a,[s(de,{type:xe(e.value.status),size:"small",class:"w-16 text-center"},{default:l(()=>[S(C(we(e.value.status)),1)]),_:1},8,["type"]),z.value?(i(),V(Ke,{key:0,file:z.value,player:L(X),disabled:ae.value,onPlay:ue,onSeek:ke},null,8,["file","player","disabled"])):E("",!0),s(N,I({type:"primary"},me,{onClick:le,disabled:o.value}),{default:l(()=>[...n[13]||(n[13]=[S(" 下载 ",-1)])]),_:1},16,["disabled"]),e.value.error_message?(i(),V(oe,{key:1,content:`错误: ${e.value.error_message}`,placement:"top"},{default:l(()=>[t("span",Sa," 错误: "+C(e.value.error_message),1)]),_:1},8,["content"])):E("",!0)]),t("div",Ma,[n[14]||(n[14]=t("h4",{class:"text-sm font-semibold"},"文本内容",-1)),s(ce,{modelValue:$.value,"onUpdate:modelValue":n[0]||(n[0]=y=>$.value=y),type:"textarea",rows:6,placeholder:"请输入要转换为语音的文本",disabled:ae.value,onBlur:te},null,8,["modelValue","disabled"])]),t("div",Da,[n[18]||(n[18]=t("h4",{class:"text-sm font-semibold"},"参数设置",-1)),t("div",Pa,[t("div",Va,[n[15]||(n[15]=t("label",{class:"text-xs text-gray-600"},"发音人/音色",-1)),s(x,{modelValue:U.value,"onUpdate:modelValue":n[1]||(n[1]=y=>U.value=y),size:"small",placeholder:"请选择音色（可选）",clearable:"",disabled:ae.value,onChange:Z,class:"w-full"},{default:l(()=>[s(De,{label:"灿灿",value:"cosyvoice-v3-plus-leo-34ba9eaebae44039a4a9426af6389dcd"})]),_:1},8,["modelValue","disabled"])]),t("div",Fa,[n[16]||(n[16]=t("label",{class:"text-xs text-gray-600"},"语速",-1)),s(a,{modelValue:J.value,"onUpdate:modelValue":n[2]||(n[2]=y=>J.value=y),size:"small",min:.5,max:2,step:.1,precision:1,disabled:ae.value,onChange:se,class:"w-full"},null,8,["modelValue","disabled"])]),t("div",Aa,[n[17]||(n[17]=t("label",{class:"text-xs text-gray-600"},"音量",-1)),s(a,{modelValue:Q.value,"onUpdate:modelValue":n[3]||(n[3]=y=>Q.value=y),size:"small",min:0,max:100,step:1,disabled:ae.value,onChange:se,class:"w-full"},null,8,["modelValue","disabled"])])])]),t("div",Ba,[ae.value?(i(),V(N,I({key:1,type:"warning"},me,{onClick:$e,class:"w-full"}),{default:l(()=>[...n[20]||(n[20]=[S(" 停止生成 ",-1)])]),_:1},16)):(i(),V(oe,{key:0,content:$.value.trim()?"":"请先输入文本内容",disabled:!!$.value.trim(),placement:"top"},{default:l(()=>[s(N,I({type:"success"},me,{onClick:he,disabled:c.value,class:"w-full"}),{default:l(()=>[...n[19]||(n[19]=[S(" 开始生成 ",-1)])]),_:1},16,["disabled"])]),_:1},8,["content","disabled"]))])])])):(i(),m("div",Ea,[...n[21]||(n[21]=[t("div",{class:"flex items-center justify-between mb-3 flex-shrink-0"},[t("h3",{class:"text-base font-semibold"},"任务详情")],-1),t("div",{class:"flex-1 flex items-center justify-center text-sm text-gray-400"}," 请从左侧选择一个任务查看详情 ",-1)])])),s(R,{modelValue:j.value,"onUpdate:modelValue":n[6]||(n[6]=y=>j.value=y),title:"创建 TTS 任务",width:"500px",onClose:_e},{footer:l(()=>[s(N,{onClick:n[5]||(n[5]=y=>j.value=!1)},{default:l(()=>[...n[22]||(n[22]=[S("取消",-1)])]),_:1}),s(N,{type:"primary",onClick:q,loading:r.value},{default:l(()=>[...n[23]||(n[23]=[S(" 确定 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[s(_,null,{default:l(()=>[s(d,{label:"任务名称"},{default:l(()=>[s(ce,{modelValue:w.value,"onUpdate:modelValue":n[4]||(n[4]=y=>w.value=y),placeholder:"请输入任务名称",onKeyup:Ae(q,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(R,{modelValue:F.value,"onUpdate:modelValue":n[9]||(n[9]=y=>F.value=y),title:"重命名任务",width:"400px",onClose:n[10]||(n[10]=y=>b.value="")},{footer:l(()=>[s(N,{onClick:n[8]||(n[8]=y=>F.value=!1)},{default:l(()=>[...n[24]||(n[24]=[S("取消",-1)])]),_:1}),s(N,{type:"primary",onClick:Y,loading:r.value},{default:l(()=>[...n[25]||(n[25]=[S(" 确定 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[s(_,null,{default:l(()=>[s(d,{label:"任务名称"},{default:l(()=>[s(ce,{modelValue:b.value,"onUpdate:modelValue":n[7]||(n[7]=y=>b.value=y),placeholder:"请输入任务名称",onKeyup:Ae(Y,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),Ua={class:"p-1"},Wa=ze({__name:"index",setup(Ve){const r=k("tts_tool"),T=e=>{console.log("切换到页签:",e)};return(e,j)=>{const w=Mt,D=St;return i(),m("div",Ua,[s(D,{modelValue:r.value,"onUpdate:modelValue":j[0]||(j[0]=F=>r.value=F),onTabChange:T,class:"flex-1 flex flex-col overflow-hidden h-[calc(100vh-150px)]"},{default:l(()=>[s(w,{label:"TTS",name:"tts_tool"},{default:l(()=>[s(za)]),_:1}),s(w,{label:"PDF 工具",name:"pdf_tool"},{default:l(()=>[s(Ms)]),_:1}),s(w,{label:"音频合成",name:"audio_merge"},{default:l(()=>[s(fl)]),_:1}),s(w,{label:"音频转码",name:"audio_convert"},{default:l(()=>[s(da)]),_:1})]),_:1},8,["modelValue"])])}}});export{Wa as default};
