import{m as oe,r as B,A as he,t as g,q as u,O as i,a1 as c,M as L,Q as d,ae as b,W as w,Z as qe,o as D,u as S,au as We,bK as xe,aJ as Ge,c as R,D as Qe,v as V,aW as Je,N as pe,ao as _e,P as ve,bh as Ze,S as Y,bi as He,b9 as Xe,aU as et}from"./vue-vendor-DIrWXCnL.js";import{b as ke,u as tt,d as st,M as ge,_ as me,g as ye}from"./useInterval-bXW1k5qT.js";import{b as C,e as k}from"./index-D8BRhcwO.js";import{d as be,z as at,j as lt,v as nt,s as ot,Q as we,m as it,q as rt,g as Te,E as r,V as Q,U as dt,S as ut}from"./element-plus-DKhpzu-P.js";import"./utils-C11zrYka.js";import"./vant-CsaYtkgD.js";import"./vendor-DiwfJ622.js";async function ct(){return(await C.get("/pdf/list")).data}async function ft(p){const a=new FormData;return a.append("file",p),(await C.post("/pdf/upload",a,{headers:{"Content-Type":"multipart/form-data"}})).data}async function pt(p,a){const m={task_id:p};return a!=null&&a!==""&&(m.password=a),(await C.post("/pdf/decrypt",m)).data}async function _t(p){return(await C.get(`/pdf/task/${encodeURIComponent(p)}`)).data}function vt(p,a){return`${C.defaults.baseURL||""}/pdf/download/${encodeURIComponent(p)}?type=${a}`}async function gt(p){return(await C.post("/pdf/delete",{task_id:p})).data}const mt={class:"p-4 flex flex-col h-full"},yt={class:"mb-4 flex-shrink-0 border rounded p-3 bg-gray-50"},ht={class:"flex items-center gap-3"},xt={key:0,class:"flex-1 min-w-0"},kt=["title"],bt={class:"flex items-center justify-between"},wt={class:"flex-1 overflow-auto"},Tt=["onClick"],Ct={key:1,class:"text-gray-400"},Mt={key:0,class:"flex flex-col gap-1"},Ft={class:"text-sm"},Dt={class:"text-xs text-gray-500"},Pt={key:1,class:"text-gray-400"},$t={key:0,class:"flex flex-col gap-1"},St={class:"text-sm"},Bt={class:"text-xs text-gray-500"},Lt={key:1,class:"text-gray-400"},Ut={class:"flex flex-col gap-1 items-center"},zt=["onClick"],Et=["title"],Rt={class:"flex items-center gap-2"},At=oe({__name:"PdfTool",setup(p){const a=B(!1),m=B([]),t=B(null),$=B(""),M=async()=>{try{a.value=!0;const n=await ct();if(n.code===0){const o=n.data||[];m.value=o.map(_=>({..._,_decrypting:_.status==="processing"||!1,_password:""}))}else r.error(n.msg||"获取任务列表失败")}catch(n){k(n,"获取任务列表失败")}finally{a.value=!1}},x=n=>{n.raw&&(t.value=n.raw,$.value=n.raw.name)},N=async()=>{if(!t.value){r.warning("请选择要上传的文件");return}const n=t.value;if(!n.name.toLowerCase().endsWith(".pdf")){r.error("只支持 PDF 文件");return}try{a.value=!0;const o=await ft(n);o.code===0?(r.success("文件上传成功"),t.value=null,$.value="",await M()):r.error(o.msg||"文件上传失败")}catch(o){k(o,"文件上传失败")}finally{a.value=!1}},h=async n=>{if(!n.uploaded_info){r.warning("请先上传文件");return}if(!(n._decrypting||n.status==="processing")&&!(n.status==="success"&&!await Q.confirm("已解密的文件已存在，是否重新解密？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{n._decrypting=!0;const o=n._password?.trim()||void 0,_=await pt(n.task_id,o);_.code===0?(r.success(_.data?.message||"解密任务已提交，正在后台处理"),n._password="",await q(n)):r.error(_.msg||"提交解密任务失败")}catch(o){k(o,"提交解密任务失败")}finally{n._decrypting=!1}},q=async(n,o=30)=>{let _=0;const U=async()=>{if(_>=o){r.warning("任务处理超时，请手动刷新查看状态"),await M();return}try{const T=await _t(n.task_id);if(T.code===0){const F=T.data;n.status=F.status,n.unlocked_info=F.unlocked_info,n.error_message=F.error_message,F.status==="success"?(r.success("文件解密成功"),n._decrypting=!1,await M()):F.status==="failed"?(r.error(F.error_message||"文件解密失败"),n._decrypting=!1):F.status==="processing"?(_++,setTimeout(U,1e3)):n._decrypting=!1}}catch(T){k(T,"查询任务状态失败"),n._decrypting=!1}};U()},K=async(n,o)=>{const _=o==="uploaded"?n.uploaded_info:n.unlocked_info;if(!_){r.warning("文件不存在");return}try{const U=vt(_.name,o);window.open(U,"_blank")}catch(U){k(U,"下载文件失败")}},W=async n=>{if(!n.uploaded_info){r.warning("请先上传文件");return}if(n.status==="processing"){r.warning("任务正在处理中，无法删除");return}if(await Q.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{a.value=!0;const _=await gt(n.task_id);_.code===0?(r.success(_.data?.message||"任务删除成功"),await M()):r.error(_.msg||"任务删除失败")}catch(_){k(_,"删除任务失败")}finally{a.value=!1}},J=ke,j=n=>n?new Date(n*1e3).toLocaleString():"-";return he(()=>{M()}),(n,o)=>{const _=be,U=at,T=Te,F=ot,I=we,X=it,ee=rt,te=lt,Z=nt;return u(),g("div",mt,[o[11]||(o[11]=i("h2",{class:"text-xl font-semibold mb-4"},"PDF 解密工具",-1)),i("div",yt,[i("div",ht,[i("div",null,[c(_,{type:"success",size:"small",onClick:N,loading:a.value,disabled:!t.value},{default:d(()=>[...o[0]||(o[0]=[b(" 上传 ",-1)])]),_:1},8,["loading","disabled"])]),c(U,{"auto-upload":!1,"on-change":x,"show-file-list":!1,accept:".pdf"},{trigger:d(()=>[c(_,{type:"primary",size:"small",class:"!m-0"},{default:d(()=>[...o[1]||(o[1]=[b("选择文件",-1)])]),_:1})]),_:1}),t.value?(u(),g("div",xt,[i("div",{class:"text-sm text-gray-600 truncate",title:$.value||t.value.name},w($.value||t.value.name),9,kt)])):L("",!0)])]),c(te,{class:"flex-1 flex flex-col overflow-hidden",shadow:"hover"},{header:d(()=>[i("div",bt,[o[3]||(o[3]=i("span",null,"文件列表",-1)),c(_,{type:"info",size:"small",plain:"",onClick:M,loading:a.value},{default:d(()=>[a.value?L("",!0):(u(),D(T,{key:0},{default:d(()=>[c(S(xe))]),_:1})),o[2]||(o[2]=b(" 刷新 ",-1))]),_:1},8,["loading"])])]),default:d(()=>[i("div",wt,[qe((u(),D(ee,{data:m.value,stripe:"",class:"w-full"},{empty:d(()=>[...o[10]||(o[10]=[i("div",{class:"text-center text-gray-400 py-8"},"暂无文件，请上传 PDF 文件",-1)])]),default:d(()=>[c(F,{prop:"filename",label:"文件名","min-width":"200"},{default:d(({row:f})=>[f.uploaded_info?(u(),g("span",{key:0,class:"text-blue-600 cursor-pointer hover:underline",onClick:A=>K(f,"uploaded")},w(f.filename),9,Tt)):(u(),g("span",Ct,"-"))]),_:1}),c(F,{label:"上传文件","min-width":"150"},{default:d(({row:f})=>[f.uploaded_info?(u(),g("div",Mt,[i("span",Ft,w(S(J)(f.uploaded_info.size)),1),i("span",Dt,w(j(f.uploaded_info.modified)),1)])):(u(),g("span",Pt,"-"))]),_:1}),c(F,{label:"已解密文件","min-width":"150"},{default:d(({row:f})=>[f.unlocked_info?(u(),g("div",$t,[i("span",St,w(S(J)(f.unlocked_info.size)),1),i("span",Bt,w(j(f.unlocked_info.modified)),1)])):(u(),g("span",Lt,"未解密"))]),_:1}),c(F,{label:"状态",width:"140",align:"center"},{default:d(({row:f})=>[i("div",Ut,[f.status==="success"?(u(),D(I,{key:0,type:"success",size:"small"},{default:d(()=>[...o[4]||(o[4]=[b("已解密",-1)])]),_:1})):f.status==="processing"?(u(),D(I,{key:1,type:"warning",size:"small"},{default:d(()=>[...o[5]||(o[5]=[b("处理中",-1)])]),_:1})):f.status==="pending"?(u(),D(I,{key:2,type:"info",size:"small"},{default:d(()=>[...o[6]||(o[6]=[b("等待中",-1)])]),_:1})):f.status==="failed"?(u(),D(I,{key:3,type:"danger",size:"small"},{default:d(()=>[...o[7]||(o[7]=[b("失败",-1)])]),_:1})):(u(),D(I,{key:4,type:"info",size:"small"},{default:d(()=>[...o[8]||(o[8]=[b("已上传",-1)])]),_:1})),f.unlocked_info?(u(),g("span",{key:5,class:"text-xs text-blue-600 cursor-pointer hover:underline",onClick:A=>K(f,"unlocked")}," 下载 ",8,zt)):L("",!0),f.error_message?(u(),g("span",{key:6,class:"text-xs text-red-500",title:f.error_message}," 错误 ",8,Et)):L("",!0)])]),_:1}),c(F,{label:"操作",width:"280",fixed:"right"},{default:d(({row:f})=>[i("div",Rt,[f.uploaded_info?(u(),D(X,{key:0,modelValue:f._password,"onUpdate:modelValue":A=>f._password=A,type:"password",size:"small",placeholder:"密码（可选）","show-password":"",clearable:"",class:"w-30",disabled:f._decrypting||f.status==="processing",onKeyup:We(A=>h(f),["enter"])},null,8,["modelValue","onUpdate:modelValue","disabled","onKeyup"])):L("",!0),f.uploaded_info&&f.status!=="processing"?(u(),D(_,{key:1,type:"primary",size:"small",onClick:A=>h(f),loading:f._decrypting,disabled:f._decrypting||f.status==="processing"},{default:d(()=>[b(w(f.status==="success"?"重新解密":"解密"),1)]),_:2},1032,["onClick","loading","disabled"])):L("",!0),f.uploaded_info?(u(),D(_,{key:2,type:"danger",size:"small",plain:"",onClick:A=>W(f),disabled:f.status==="processing"},{default:d(()=>[...o[9]||(o[9]=[b(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])):L("",!0)])]),_:1})]),_:1},8,["data"])),[[Z,a.value]])])]),_:1})])}}}),Vt={viewBox:"0 0 512 512",width:"1.2em",height:"1.2em"};function jt(p,a){return u(),g("svg",Vt,[...a[0]||(a[0]=[i("path",{fill:"none",stroke:"currentColor","stroke-linecap":"square","stroke-width":"48",d:"m136 208l120-104l120 104m-240 96l120 104l120-104"},null,-1)])])}const Nt=Ge({name:"ion-chevron-expand-sharp",render:jt}),It=2e3;async function Ot(){return(await C.get("/media/task/list")).data}async function Yt(){return(await C.post("/media/task/create",{})).data}async function Kt(p){return(await C.post("/media/task/get",{task_id:p})).data}async function qt(p){return(await C.post("/media/task/delete",{task_id:p})).data}async function Wt(p,a){return(await C.post("/media/task/addFileByPath",{task_id:p,file_path:a})).data}async function Gt(p,a){return(await C.post("/media/task/deleteFile",{task_id:p,file_index:a})).data}async function Qt(p){return(await C.post("/media/task/start",{task_id:p})).data}async function Jt(p,a){return(await C.post("/media/task/reorderFiles",{task_id:p,file_indices:a})).data}function Zt(p){return`${C.defaults.baseURL||""}/media/task/download?task_id=${p}`}async function Ht(p,a){return(await C.post("/media/task/save",{task_id:p,target_path:a})).data}const Xt={class:"flex gap-4 h-full"},es={class:"w-64 border rounded p-3 flex flex-col"},ts={class:"flex items-center justify-between mb-3"},ss={class:"flex items-center gap-1"},as={key:0,class:"flex-1 overflow-y-auto space-y-2 pr-1 min-h-[400px]"},ls=["onClick"],ns={class:"flex items-center justify-between gap-2"},os={class:"text-sm font-medium truncate flex-1 min-w-0"},is={class:"text-xs text-gray-500 whitespace-nowrap flex items-center gap-1 flex-shrink-0"},rs={class:"whitespace-nowrap w-5 flex items-center justify-center"},ds={class:"flex items-center justify-between gap-2 min-h-[20px]"},us={class:"flex items-center gap-1 flex-shrink-0"},cs={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},fs={key:0,class:"flex-1 border rounded p-3 flex flex-col max-w-2xl"},ps={class:"flex items-center justify-between mb-3 flex-shrink-0"},_s={class:"text-base font-semibold"},vs={class:"text-sm text-gray-500"},gs={class:"flex-1 overflow-auto flex flex-col gap-3"},ms={class:"flex items-center justify-between gap-4 flex-shrink-0"},ys={class:"flex items-center gap-4"},hs={key:1,class:"text-red-500 text-xs"},xs={class:"flex items-center gap-2"},ks={class:"border rounded p-2 flex-1 flex flex-col overflow-hidden"},bs={class:"flex items-center justify-between mb-2 flex-shrink-0"},ws={class:"flex items-center gap-1 pr-1"},Ts={class:"flex-1 overflow-auto"},Cs={key:0},Ms=["draggable","onDragstart","onDrop"],Fs={class:"text-xs text-gray-500 w-8"},Ds=["title"],Ps={key:0,class:"text-xs text-gray-500 whitespace-nowrap w-20 text-right"},$s={key:1,class:"w-20"},Ss={key:1,class:"text-sm text-gray-400 text-center py-1"},Bs={key:1,class:"flex-1 border rounded p-3 flex flex-col max-w-2xl"},Ls=oe({__name:"MediaTool",setup(p){const a=B(!1),m=B([]),t=B(null),$=B(!1),M=B(!1),x=B(!1),N=B(null),h=tt({callbacks:{onPlay:()=>{r.success("开始播放")},onError:()=>{k(new Error("音频播放失败"),"播放失败"),O()},onEnded:()=>{O()}}}),q={size:"small",plain:!0,class:"!w-8 !h-6 !p-0"},K={size:"small",plain:!0,class:"!h-5 !text-xs !px-2"},W={size:"small",plain:!0,class:"!h-7 !text-xs"},J=["bg-gray-100","border-t-2","border-b-2","border-blue-500"],j=e=>{e&&e.classList.remove(...J)},n=e=>{if(!e)return;e.querySelectorAll('[draggable="true"]').forEach(l=>j(l))},o=async e=>{if(t.value&&e.length!==0)try{a.value=!0;for(const s of e){const l=await Wt(t.value.task_id,s);if(l.code!==0){r.error(`添加文件失败: ${l.msg||"未知错误"}`);break}}r.success(`成功添加 ${e.length} 个文件`),await T(t.value.task_id)}catch(s){k(s,"添加文件失败")}finally{a.value=!1}},_=async()=>{try{a.value=!0;const e=await Ot();e.code===0?(m.value=e.data.tasks||[],m.value.length>0&&!t.value&&await T(m.value[0].task_id)):r.error(e.msg||"获取任务列表失败")}catch(e){k(e,"获取任务列表失败")}finally{a.value=!1}},U=async()=>{try{a.value=!0;const e=await Yt();e.code===0?(r.success("任务创建成功"),await _(),T(e.data.task_id)):r.error(e.msg||"创建任务失败")}catch(e){k(e,"创建任务失败")}finally{a.value=!1}},T=async e=>{t.value&&t.value.task_id!==e&&se();try{a.value=!0;const s=await Kt(e);s.code===0?t.value=s.data:r.error(s.msg||"获取任务信息失败")}catch(s){k(s,"获取任务信息失败")}finally{a.value=!1}},F=async e=>{if(await Q.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{a.value=!0;const l=await qt(e);l.code===0?(r.success("任务删除成功"),await _(),t.value&&t.value.task_id===e&&(m.value&&m.value.length>0?await T(m.value[0].task_id):t.value=null)):r.error(l.msg||"删除任务失败")}catch(l){k(l,"删除任务失败")}finally{a.value=!1}},I=()=>{if(!t.value){r.warning("请先创建或选择任务");return}$.value=!0},X=async e=>{if(!(!t.value||!await Q.confirm("确定要删除该文件吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{a.value=!0;const l=await Gt(t.value.task_id,e);l.code===0?(h.playingFileIndex.value===e?se():h.playingFileIndex.value!==null&&h.playingFileIndex.value>e&&(h.playingFileIndex.value=h.playingFileIndex.value-1),r.success("文件删除成功"),await T(t.value.task_id)):r.error(l.msg||"删除文件失败")}catch(l){k(l,"删除文件失败")}finally{a.value=!1}},ee=async()=>{if(!(!t.value||!await Q.confirm(`确定要开始合成吗？将合并 ${ce.value} 个音频文件。`,"确认合成",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{a.value=!0;const s=await Qt(t.value.task_id);s.code===0?(r.success("合成任务已启动"),await _(),await T(t.value.task_id),f()):r.error(s.msg||"启动任务失败")}catch(s){k(s,"启动任务失败")}finally{a.value=!1}},{start:te,stop:Z}=st(async()=>{if(!t.value||t.value.status!=="processing"){Z();return}await _(),await T(t.value.task_id)},It,{immediate:!1}),f=()=>{te()},A=e=>{if(!e)return;const s=Zt(e);window.open(s,"_blank")},Ce=()=>{t.value?.result_file&&A(t.value.task_id)},Me=e=>{e?.result_file&&A(e.task_id)},O=()=>{h.clear()},ie=(e,s)=>{if(!e)return;const l=e?.path||e?.name||"";h.seekFile(l,s)},Fe=(e,s)=>{t.value?.result_file&&ie({path:t.value.result_file},s)},De=e=>{if(!t.value||!t.value.files||e<0||e>=t.value.files.length)return;const s=t.value.files[e],l=s.path||s.name||"";if(!l){r.warning("文件路径不存在");return}if(h.playingFilePath.value===l&&h.audio&&!h.audio.paused){O(),r.info("已停止播放");return}const y=ye(l);if(!y){r.error("无法生成媒体文件URL");return}h.load(y,{playingFilePath:l,playingFileIndex:e}),h.play().catch(z=>{k(z,"播放失败"),O()})},se=()=>{O()},Pe=()=>{if(!t.value||!t.value.result_file){r.warning("结果文件不存在");return}const e=t.value.result_file;if(h.playingFilePath.value===e&&h.audio&&!h.audio.paused){O(),r.info("已停止播放");return}const s=ye(e);if(!s){r.error("无法生成媒体文件URL");return}h.load(s,{playingFilePath:e}),h.play().catch(l=>{k(l,"播放失败"),O()})},$e=()=>{if(!t.value||!t.value.result_file){r.warning("结果文件不存在");return}M.value=!0},Se=async e=>{if(!t.value||!t.value.result_file)return;if(e.length===0){r.warning("请选择转存目录");return}const s=e[0];try{a.value=!0;const l=await Ht(t.value.task_id,s);l.code===0?(r.success("转存成功"),M.value=!1):r.error(l.msg||"转存失败")}catch(l){k(l,"转存失败")}finally{a.value=!1}},Be=ke,re={pending:{tag:"info",text:"等待中"},processing:{tag:"warning",text:"处理中"},success:{tag:"success",text:"成功"},failed:{tag:"danger",text:"失败"}},de=e=>re[e]?.tag||"info",ue=e=>re[e]?.text||"未知",H=R(()=>t.value?.status==="processing"),ae=R(()=>(t.value?.files||[]).length>0),ce=R(()=>(t.value?.files||[]).length),le=R(()=>t.value?.result_file),fe=R(()=>!le.value||t.value?.status!=="success"||x.value),Le=R(()=>!ae.value||H.value||x.value),ne=R(()=>H.value||x.value),Ue=R(()=>!t.value||!ae.value||H.value),ze=R(()=>x.value?"点击退出拖拽排序模式":"点击进入拖拽排序模式"),Ee=R(()=>({path:le.value||""})),Re=(e,s)=>!e||!s||e.length!==s.length?!0:e.some((l,y)=>{const z=l?.path||l?.name,G=s[y]?.path||s[y]?.name;return z!==G}),Ae=async()=>{if(x.value){if(t.value&&t.value.files&&t.value.files.length>0){if(Re(N.value||[],t.value.files))try{a.value=!0;const s=t.value.files.map((y,z)=>z),l=await Jt(t.value.task_id,s);l.code===0?(r.success("排序已保存"),await T(t.value.task_id)):r.error(l.msg||"保存排序失败")}catch(s){k(s,"保存排序失败")}finally{a.value=!1}N.value=null}}else t.value&&t.value.files&&t.value.files.length>0&&(N.value=[...t.value.files||[]]);x.value=!x.value},Ve=(e,s)=>{if(!x.value)return e.preventDefault(),!1;try{e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",s.toString()))}catch(l){console.error("拖拽开始失败:",l)}},je=e=>{e.currentTarget&&j(e.currentTarget)},Ne=e=>{e.currentTarget&&j(e.currentTarget)},Ie=e=>{if(x.value&&(e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="move"),e.currentTarget)){const s=e.currentTarget.getBoundingClientRect(),l=e.clientY,y=s.top+s.height/2;j(e.currentTarget),l<y?e.currentTarget.classList.add("border-t-2","border-blue-500"):e.currentTarget.classList.add("border-b-2","border-blue-500")}},Oe=(e,s)=>{if(!x.value||(e.preventDefault(),e.currentTarget&&(j(e.currentTarget),n(e.currentTarget.parentElement)),!e.dataTransfer))return;const l=parseInt(e.dataTransfer.getData("text/plain"),10);if(l===s||isNaN(l)||!t.value||!t.value.files||l<0||l>=t.value.files.length||s<0||s>=t.value.files.length)return;const y=e.currentTarget?.getBoundingClientRect(),z=e.clientY,G=y?y.top+y.height/2:0,v=z<G?s:s+1,P=[...t.value.files||[]],[E]=P.splice(l,1),Ke=l<v?v-1:v;P.splice(Ke,0,E),t.value={...t.value,files:P}},Ye=()=>{$.value=!1};return he(()=>{_()}),Qe(()=>{se(),Z()}),(e,s)=>{const l=Te,y=be,z=we,G=Nt;return u(),g("div",Xt,[i("div",es,[i("div",ts,[s[7]||(s[7]=i("h3",{class:"text-base font-semibold"},"任务列表",-1)),i("div",ss,[c(y,V({type:"info"},q,{onClick:_,loading:a.value}),{default:d(()=>[a.value?L("",!0):(u(),D(l,{key:0},{default:d(()=>[c(S(xe))]),_:1}))]),_:1},16,["loading"]),c(y,V({type:"success"},q,{onClick:U,loading:a.value}),{default:d(()=>[c(l,null,{default:d(()=>[c(S(Je))]),_:1})]),_:1},16,["loading"])])]),m.value&&m.value.length>0?(u(),g("div",as,[(u(!0),g(pe,null,_e(m.value,v=>(u(),g("div",{key:v.task_id,class:ve(["border rounded px-3 py-2 cursor-pointer hover:bg-gray-50 group min-h-[60px] flex flex-col justify-between",{"border-blue-500 bg-blue-50":t.value&&v.task_id===t.value.task_id}]),onClick:P=>T(v.task_id)},[i("div",ns,[i("div",os,w(v.name),1),i("span",is,[c(l,null,{default:d(()=>[c(S(Ze),{class:"!w-3 !h-3"})]),_:1}),i("span",rs,w(v.files?v.files.length:0),1)])]),i("div",ds,[c(z,{type:de(v.status),size:"small",class:"!h-5 !text-xs w-16 text-center"},{default:d(()=>[b(w(ue(v.status)),1)]),_:2},1032,["type"]),i("div",us,[v.status==="success"&&v.result_file?(u(),D(y,V({key:0,type:"primary"},{ref_for:!0},K,{onClick:Y(P=>Me(v),["stop"])}),{default:d(()=>[...s[8]||(s[8]=[b(" 下载 ",-1)])]),_:1},16,["onClick"])):L("",!0),c(y,V({type:"danger"},{ref_for:!0},K,{onClick:Y(P=>F(v.task_id),["stop"]),disabled:v.status==="processing"}),{default:d(()=>[c(l,null,{default:d(()=>[c(S(He))]),_:1})]),_:1},16,["onClick","disabled"])])])],10,ls))),128))])):(u(),g("div",cs,' 暂无任务，请点击"新建"创建 '))]),t.value?(u(),g("div",fs,[i("div",ps,[i("h3",_s,"任务详情: "+w(t.value.name),1),i("span",vs," 共 "+w(ce.value)+" 个文件 ",1)]),i("div",gs,[i("div",ms,[i("div",ys,[c(z,{type:de(t.value.status),size:"small",class:"w-16 text-center"},{default:d(()=>[b(w(ue(t.value.status)),1)]),_:1},8,["type"]),le.value?(u(),D(ge,{key:0,file:Ee.value,player:S(h),disabled:x.value,onPlay:Pe,onSeek:Fe},null,8,["file","player","disabled"])):L("",!0),c(y,V({type:"primary"},W,{onClick:Ce,disabled:fe.value}),{default:d(()=>[...s[9]||(s[9]=[b(" 下载 ",-1)])]),_:1},16,["disabled"]),c(y,V({type:"success"},W,{onClick:$e,disabled:fe.value}),{default:d(()=>[...s[10]||(s[10]=[b(" 转存 ",-1)])]),_:1},16,["disabled"]),t.value.error_message?(u(),g("span",hs," 错误: "+w(t.value.error_message),1)):L("",!0)]),i("div",xs,[c(y,V({type:"success"},W,{onClick:ee,disabled:Le.value,loading:H.value}),{default:d(()=>[...s[11]||(s[11]=[b(" 开始合成 ",-1)])]),_:1},16,["disabled","loading"])])]),i("div",ks,[i("div",bs,[s[13]||(s[13]=i("h4",{class:"text-sm font-semibold"},"文件列表",-1)),i("div",ws,[c(y,V({type:"primary"},K,{disabled:ne.value,onClick:I}),{default:d(()=>[...s[12]||(s[12]=[b(" + ",-1)])]),_:1},16,["disabled"]),c(y,V({type:x.value?"success":"default"},q,{onClick:Ae,disabled:Ue.value,title:ze.value}),{default:d(()=>[x.value?(u(),D(l,{key:0},{default:d(()=>[c(S(Xe))]),_:1})):(u(),D(G,{key:1,class:"!w-3.5 !h-3.5"}))]),_:1},16,["type","disabled","title"])])]),i("div",Ts,[ae.value?(u(),g("div",Cs,[(u(!0),g(pe,null,_e(t.value.files,(v,P)=>(u(),g("div",{key:P,class:ve(["flex items-center gap-2 p-1 hover:bg-gray-100 rounded",{"cursor-move":x.value,"cursor-default":!x.value,"select-none":!0}]),draggable:x.value,onDragstart:E=>Ve(E,Number(P)),onDragend:s[2]||(s[2]=E=>je(E)),onDragover:s[3]||(s[3]=Y(E=>Ie(E),["prevent"])),onDragleave:Ne,onDrop:Y(E=>Oe(E,Number(P)),["prevent"])},[i("span",Fs,w(Number(P)+1),1),i("span",{class:"flex-1 text-sm truncate",title:v.path||v.name},w(v.name),9,Ds),v.size?(u(),g("span",Ps,w(S(Be)(v.size)),1)):(u(),g("div",$s)),i("div",{class:"flex items-center gap-1 flex-shrink-0",onMousedown:s[0]||(s[0]=Y(()=>{},["stop"])),onClick:s[1]||(s[1]=Y(()=>{},["stop"]))},[c(ge,{file:v,player:S(h),disabled:ne.value,onPlay:()=>De(Number(P)),onSeek:ie},null,8,["file","player","disabled","onPlay"]),c(y,{type:"info",size:"small",plain:"",circle:"",onClick:Y(E=>X(Number(P)),["stop"]),disabled:ne.value,class:"!h-6 !text-xs"},{default:d(()=>[c(l,null,{default:d(()=>[c(S(et))]),_:1})]),_:1},8,["onClick","disabled"])],32)],42,Ms))),128))])):(u(),g("div",Ss,"文件列表为空"))])])])])):(u(),g("div",Bs,[...s[14]||(s[14]=[i("div",{class:"flex items-center justify-between mb-3 flex-shrink-0"},[i("h3",{class:"text-base font-semibold"},"任务详情")],-1),i("div",{class:"flex-1 flex items-center justify-center text-sm text-gray-400"}," 请从左侧选择一个任务查看详情 ",-1)])])),c(me,{visible:$.value,"onUpdate:visible":s[4]||(s[4]=v=>$.value=v),title:"选择文件添加到任务","confirm-button-text":"添加","confirm-loading":a.value,onConfirm:o,onClose:Ye},null,8,["visible","confirm-loading"]),c(me,{visible:M.value,"onUpdate:visible":s[5]||(s[5]=v=>M.value=v),title:"选择转存目录","confirm-button-text":"转存",mode:"directory","confirm-loading":a.value,onConfirm:Se,onClose:s[6]||(s[6]=v=>M.value=!1)},null,8,["visible","confirm-loading"])])}}}),Us={class:"p-1"},Is=oe({__name:"index",setup(p){const a=B("pdf_tool"),m=t=>{console.log("切换到页签:",t)};return(t,$)=>{const M=ut,x=dt;return u(),g("div",Us,[c(x,{modelValue:a.value,"onUpdate:modelValue":$[0]||($[0]=N=>a.value=N),onTabChange:m,class:"flex-1 flex flex-col overflow-hidden h-[calc(100vh-150px)]"},{default:d(()=>[c(M,{label:"PDF 工具",name:"pdf_tool"},{default:d(()=>[c(At)]),_:1}),c(M,{label:"音频合成",name:"audio_merge"},{default:d(()=>[c(Ls)]),_:1})]),_:1},8,["modelValue"])])}}});export{Is as default};
