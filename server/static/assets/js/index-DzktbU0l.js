import{m as Ee,r as H,B as Le,o as ae,Q as i,q as m,O as n,a1 as l,ae as J,G as Jl,t as A,N as De,ao as Be,W,M as ie,u as d,bK as Ve,aW as nt,P as Ae,bL as Ql,S as we,bM as ql,bN as Bt,Z as ye,$ as Pe,b9 as Je,bw as gt,bi as ze,bO as At,aU as pt,aV as Xl,aI as Zl,c as ve,v as Oe,bG as Tt,bP as es,af as He,bQ as ts,A as it,D as Mt,f as et,au as Ft}from"./vue-vendor-DxceCm8D.js";import{e as ne,b as _e,l as Qe}from"./index-DBu4nike.js";import{f as yt,c as at,M as Et,_ as Lt,n as tt,u as ls,g as ss,a as ns}from"./useInterval-_JCymJaY.js";import"./utils-C11zrYka.js";import{r as qe,J as as,x as is,m as ht,d as Ne,E,K as os,L as rs,M as Nt,g as Ye,N as ds,O as us,P as cs,Q as bt,D as ot,I as fs,l as Ut,v as xt,k as zt,q as Ot,s as Vt,R as Rt,S as vs,T as Se}from"./element-plus-BqLbxx0O.js";import{g as je,f as ms,a as kt}from"./date-SVbh1ddk.js";import{g as gs,s as ps}from"./rds-DLGzeFqC.js";import"./vant-DyMlv9MZ.js";import"./vendor-DiwfJ622.js";function Ge(e,P,u){if(e==="*"||!e||typeof e!="string")return null;const v=new Set,T=String(e).split(",");for(const r of T){const s=r.trim();if(s.includes("/")){const[c,h]=s.split("/"),a=parseInt(h,10);if(c==="*")for(let B=P;B<=u;B+=a)v.add(B);else if(c.includes("-")){const[B,G]=c.split("-").map(O=>parseInt(O,10));for(let O=B;O<=G;O+=a)v.add(O)}}else if(s.includes("-")){const[c,h]=s.split("-").map(a=>parseInt(a,10));for(let a=c;a<=h;a++)v.add(a)}else{const c=parseInt(s,10);!isNaN(c)&&c>=P&&c<=u&&v.add(c)}}return v.size>0?Array.from(v).sort((r,s)=>r-s):null}function wt(e,P=3){try{if(!e||typeof e!="string")throw new Error("Cron 表达式必须是字符串类型");const u=String(e).trim().split(/\s+/);if(u.length!==6)throw new Error("Cron 表达式必须包含6个字段：秒 分 时 日 月 周");const[v,T,r,s,c,h]=u,a=Ge(v,0,59),B=Ge(T,0,59),G=Ge(r,0,23),O=Ge(s,1,31),f=Ge(c,1,12);let t=Ge(h,0,7);t&&t.includes(7)&&(t=t.filter(z=>z!==7),t.includes(0)||t.push(0),t.sort((z,L)=>z-L));const _=[],D=new Date;D.setMilliseconds(0),a&&!a.includes(D.getSeconds())&&(D.setSeconds(0),D.setMinutes(D.getMinutes()+1));let te=0;const M=1e4;for(;_.length<P&&te<M;){te++;const z=D.getMonth()+1;if(f&&!f.includes(z)){let $=null;for(const p of f)if(p>z){$=p;break}$===null?($=f[0],D.setFullYear(D.getFullYear()+1,$-1,1),D.setHours(0,0,a?a[0]:0)):(D.setMonth($-1,1),D.setHours(0,0,a?a[0]:0));continue}const L=D.getDate(),ee=D.getDay();let j=!0;if(s!=="*"&&h!=="*"?j=!!(O&&O.includes(L))||!!(t&&t.includes(ee)):s!=="*"?j=O?O.includes(L):!1:h!=="*"&&(j=t?t.includes(ee):!1),!j){D.setDate(D.getDate()+1),D.setHours(0,0,a?a[0]:0);continue}const re=D.getHours();if(G&&!G.includes(re)){let $=null;for(const p of G)if(p>re){$=p;break}$===null?(D.setDate(D.getDate()+1),D.setHours(G[0],0,a?a[0]:0)):D.setHours($,0,a?a[0]:0);continue}const U=D.getMinutes();if(B&&!B.includes(U)){let $=null;for(const p of B)if(p>U){$=p;break}if($===null){let p=null;for(const S of G||[re])if(S>re){p=S;break}p===null?(D.setDate(D.getDate()+1),D.setHours(G?G[0]:0,B[0],a?a[0]:0)):D.setHours(p,B[0],a?a[0]:0)}else D.setMinutes($,a?a[0]:0);continue}const x=D.getSeconds();if(a&&!a.includes(x)){let $=null;for(const p of a)if(p>x){$=p;break}$===null?(D.setMinutes(D.getMinutes()+1),D.setSeconds(a[0])):D.setSeconds($);continue}if(D>new Date){const $=D.getFullYear()+"-"+String(D.getMonth()+1).padStart(2,"0")+"-"+String(D.getDate()).padStart(2,"0")+" "+String(D.getHours()).padStart(2,"0")+":"+String(D.getMinutes()).padStart(2,"0")+":"+String(D.getSeconds()).padStart(2,"0");_.push($)}a&&a.length>0&&D.setSeconds(a[0]),D.setMinutes(D.getMinutes()+1)}return _.slice(0,P)}catch(u){throw console.error("计算 Cron 执行时间失败:",u),u}}function ys(e){const P=e.second==="custom"?e.secondCustom||"*":e.second||"*",u=e.minute==="custom"?e.minuteCustom||"*":e.minute||"*",v=e.hour==="custom"?e.hourCustom||"*":e.hour||"*",T=e.day==="custom"?e.dayCustom||"*":e.day||"*",r=e.month==="custom"?e.monthCustom||"*":e.month||"*",s=e.weekday==="custom"?e.weekdayCustom||"*":e.weekday||"*";return`${P} ${u} ${v} ${T} ${r} ${s}`}function hs(){return`pl_${Date.now()}_${Math.random().toString(36).slice(2,7)}`}const bs={class:"space-y-4 m-4"},xs={class:"flex items-center gap-2"},ws={class:"flex items-center gap-2"},Ds={class:"flex items-center gap-2"},$s={class:"flex items-center gap-2"},Cs={class:"flex items-center gap-2"},Fs={class:"flex items-center gap-2"},ks={class:"border-t pt-4"},Ps={class:"flex gap-2"},_s={class:"border-t pt-4"},Ss={class:"space-y-2"},Bs={class:"flex items-center gap-2 flex-wrap"},As=Ee({__name:"CronDialog",props:{visible:{type:Boolean,default:!1},initialCron:{default:""}},emits:["update:visible","apply","preview","close"],setup(e,{emit:P}){const u=e,v=P,T=H(u.visible),r=H({second:"*",secondCustom:"",minute:"*",minuteCustom:"",hour:"*",hourCustom:"",day:"*",dayCustom:"",month:"*",monthCustom:"",weekday:"*",weekdayCustom:"",generated:""}),s=f=>{f.second="*",f.secondCustom="",f.minute="*",f.minuteCustom="",f.hour="*",f.hourCustom="",f.day="*",f.dayCustom="",f.month="*",f.monthCustom="",f.weekday="*",f.weekdayCustom="",f.generated=""},c=(f,t)=>{try{if(!f||typeof f!="string"){s(t);return}const _=String(f).trim().split(/\s+/);let D,te,M,z,L,ee;if(_.length===5){const[j,re,U,x,$]=_;j==="0"&&re&&re.startsWith("*/")?(D="0",te=re,M=U||"*",z=x||"*",L=$||"*",ee="*"):(te=j,M=re,z=U,L=x,ee=$,D="0")}else if(_.length===6)[D,te,M,z,L,ee]=_;else{console.warn("Cron 表达式格式错误，部分数量:",_.length),s(t);return}_.length===5||_.length===6?(D==="*"?(t.second="*",t.secondCustom=""):D==="0"?(t.second="0",t.secondCustom=""):(t.second="custom",t.secondCustom=D),te==="*"?(t.minute="*",t.minuteCustom=""):te==="0"?(t.minute="0",t.minuteCustom=""):(te.startsWith("*/"),t.minute="custom",t.minuteCustom=te),M==="*"?(t.hour="*",t.hourCustom=""):M==="0"?(t.hour="0",t.hourCustom=""):(t.hour="custom",t.hourCustom=M),z==="*"?(t.day="*",t.dayCustom=""):(t.day="custom",t.dayCustom=z),L==="*"?(t.month="*",t.monthCustom=""):(t.month="custom",t.monthCustom=L),ee==="*"?(t.weekday="*",t.weekdayCustom=""):ee==="1-5"?(t.weekday="1-5",t.weekdayCustom=""):ee==="0,6"||ee==="6,0"?(t.weekday="0,6",t.weekdayCustom=""):(t.weekday="custom",t.weekdayCustom=ee)):(console.warn("Cron 表达式格式错误，部分数量:",_.length),s(t))}catch(_){console.error("解析 Cron 表达式失败:",_),s(t)}},h=()=>{r.value.generated=ys(r.value)},a=()=>{T.value=!1,v("close")},B=()=>{if(!r.value.generated){E.warning("请先生成 Cron 表达式");return}v("apply",r.value.generated),a()},G=()=>{const f=r.value.generated;if(!f){E.warning("请先生成 Cron 表达式");return}try{const t=wt(f,5);v("preview",t)}catch(t){ne(t,"预览失败")}},O=f=>{try{c(f,r.value),h(),Jl(()=>{r.value.generated&&(v("apply",r.value.generated),E.success("示例已应用"))})}catch(t){ne(t,"应用示例失败")}};return Le(()=>u.visible,f=>{T.value=f,f&&(u.initialCron?c(u.initialCron,r.value):s(r.value),h())},{immediate:!0}),Le(()=>u.initialCron,f=>{u.visible&&f&&(c(f,r.value),h())}),Le(T,f=>{f!==u.visible&&v("update:visible",f)}),(f,t)=>{const _=as,D=is,te=ht,M=Ne,z=qe;return m(),ae(z,{modelValue:T.value,"onUpdate:modelValue":t[17]||(t[17]=L=>T.value=L),title:"Cron 表达式生成器",width:"700","before-close":a},{default:i(()=>[n("div",bs,[n("div",null,[t[22]||(t[22]=n("div",{class:"text-sm font-medium mb-2"},"秒 (0-59)",-1)),n("div",xs,[l(D,{modelValue:r.value.second,"onUpdate:modelValue":t[0]||(t[0]=L=>r.value.second=L),onChange:h,class:"flex items-center"},{default:i(()=>[l(_,{label:"*",class:"!w-[80px]"},{default:i(()=>[...t[18]||(t[18]=[J("每秒钟",-1)])]),_:1}),l(_,{label:"0",class:"!w-[80px]"},{default:i(()=>[...t[19]||(t[19]=[J("第0秒",-1)])]),_:1}),l(_,{label:"30",class:"!w-[80px]"},{default:i(()=>[...t[20]||(t[20]=[J("第30秒",-1)])]),_:1}),l(_,{label:"custom",class:"!w-[80px]"},{default:i(()=>[...t[21]||(t[21]=[J("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),l(te,{modelValue:r.value.secondCustom,"onUpdate:modelValue":t[1]||(t[1]=L=>r.value.secondCustom=L),placeholder:"例如: 0,30 或 */10",disabled:r.value.second!=="custom",class:"!w-[200px]",onInput:h},null,8,["modelValue","disabled"])])]),n("div",null,[t[27]||(t[27]=n("div",{class:"text-sm font-medium mb-2"},"分 (0-59)",-1)),n("div",ws,[l(D,{modelValue:r.value.minute,"onUpdate:modelValue":t[2]||(t[2]=L=>r.value.minute=L),onChange:h,class:"flex items-center"},{default:i(()=>[l(_,{label:"*",class:"!w-[80px]"},{default:i(()=>[...t[23]||(t[23]=[J("每分钟",-1)])]),_:1}),l(_,{label:"0",class:"!w-[80px]"},{default:i(()=>[...t[24]||(t[24]=[J("第0分",-1)])]),_:1}),l(_,{label:"30",class:"!w-[80px]"},{default:i(()=>[...t[25]||(t[25]=[J("第30分",-1)])]),_:1}),l(_,{label:"custom",class:"!w-[80px]"},{default:i(()=>[...t[26]||(t[26]=[J("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),l(te,{modelValue:r.value.minuteCustom,"onUpdate:modelValue":t[3]||(t[3]=L=>r.value.minuteCustom=L),placeholder:"例如: 0,30 或 */15",disabled:r.value.minute!=="custom",class:"!w-[200px]",onInput:h},null,8,["modelValue","disabled"])])]),n("div",null,[t[32]||(t[32]=n("div",{class:"text-sm font-medium mb-2"},"时 (0-23)",-1)),n("div",Ds,[l(D,{modelValue:r.value.hour,"onUpdate:modelValue":t[4]||(t[4]=L=>r.value.hour=L),onChange:h,class:"flex items-center"},{default:i(()=>[l(_,{label:"*",class:"!w-[80px]"},{default:i(()=>[...t[28]||(t[28]=[J("每小时",-1)])]),_:1}),l(_,{label:"0",class:"!w-[80px]"},{default:i(()=>[...t[29]||(t[29]=[J("0点",-1)])]),_:1}),l(_,{label:"9",class:"!w-[80px]"},{default:i(()=>[...t[30]||(t[30]=[J("9点",-1)])]),_:1}),l(_,{label:"custom",class:"!w-[80px]"},{default:i(()=>[...t[31]||(t[31]=[J("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),l(te,{modelValue:r.value.hourCustom,"onUpdate:modelValue":t[5]||(t[5]=L=>r.value.hourCustom=L),placeholder:"例如: 9,12,18 或 */2",disabled:r.value.hour!=="custom",class:"!w-[200px]",onInput:h},null,8,["modelValue","disabled"])])]),n("div",null,[t[37]||(t[37]=n("div",{class:"text-sm font-medium mb-2"},"日 (1-31)",-1)),n("div",$s,[l(D,{modelValue:r.value.day,"onUpdate:modelValue":t[6]||(t[6]=L=>r.value.day=L),onChange:h,class:"flex items-center"},{default:i(()=>[l(_,{label:"*",class:"!w-[80px]"},{default:i(()=>[...t[33]||(t[33]=[J("每天",-1)])]),_:1}),l(_,{label:"1",class:"!w-[80px]"},{default:i(()=>[...t[34]||(t[34]=[J("每月1号",-1)])]),_:1}),l(_,{label:"15",class:"!w-[80px]"},{default:i(()=>[...t[35]||(t[35]=[J("每月15号",-1)])]),_:1}),l(_,{label:"custom",class:"!w-[80px]"},{default:i(()=>[...t[36]||(t[36]=[J("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),l(te,{modelValue:r.value.dayCustom,"onUpdate:modelValue":t[7]||(t[7]=L=>r.value.dayCustom=L),placeholder:"例如: 1,15 或 */5",disabled:r.value.day!=="custom",class:"!w-[200px]",onInput:h},null,8,["modelValue","disabled"])])]),n("div",null,[t[42]||(t[42]=n("div",{class:"text-sm font-medium mb-2"},"月 (1-12)",-1)),n("div",Cs,[l(D,{modelValue:r.value.month,"onUpdate:modelValue":t[8]||(t[8]=L=>r.value.month=L),onChange:h,class:"flex items-center"},{default:i(()=>[l(_,{label:"*",class:"!w-[80px]"},{default:i(()=>[...t[38]||(t[38]=[J("每月",-1)])]),_:1}),l(_,{label:"1",class:"!w-[80px]"},{default:i(()=>[...t[39]||(t[39]=[J("1月",-1)])]),_:1}),l(_,{label:"6",class:"!w-[80px]"},{default:i(()=>[...t[40]||(t[40]=[J("6月",-1)])]),_:1}),l(_,{label:"custom",class:"!w-[80px]"},{default:i(()=>[...t[41]||(t[41]=[J("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),l(te,{modelValue:r.value.monthCustom,"onUpdate:modelValue":t[9]||(t[9]=L=>r.value.monthCustom=L),placeholder:"例如: 1,6,12 或 */3",disabled:r.value.month!=="custom",class:"!w-[200px]",onInput:h},null,8,["modelValue","disabled"])])]),n("div",null,[t[47]||(t[47]=n("div",{class:"text-sm font-medium mb-2"},"周 (0-7, 0和7表示周日)",-1)),n("div",Fs,[l(D,{modelValue:r.value.weekday,"onUpdate:modelValue":t[10]||(t[10]=L=>r.value.weekday=L),onChange:h,class:"flex items-center"},{default:i(()=>[l(_,{label:"*",class:"!w-[80px]"},{default:i(()=>[...t[43]||(t[43]=[J("每天",-1)])]),_:1}),l(_,{label:"1-5",class:"!w-[80px]"},{default:i(()=>[...t[44]||(t[44]=[J("工作日",-1)])]),_:1}),l(_,{label:"0,6",class:"!w-[80px]"},{default:i(()=>[...t[45]||(t[45]=[J("周末",-1)])]),_:1}),l(_,{label:"custom",class:"!w-[80px]"},{default:i(()=>[...t[46]||(t[46]=[J("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),l(te,{modelValue:r.value.weekdayCustom,"onUpdate:modelValue":t[11]||(t[11]=L=>r.value.weekdayCustom=L),placeholder:"例如: 1,3,5 或 1-5",disabled:r.value.weekday!=="custom",class:"!w-[200px]",onInput:h},null,8,["modelValue","disabled"])])]),n("div",ks,[t[50]||(t[50]=n("div",{class:"text-sm font-medium mb-2"},"生成的 Cron 表达式：",-1)),l(te,{modelValue:r.value.generated,"onUpdate:modelValue":t[12]||(t[12]=L=>r.value.generated=L),readonly:"",class:"mb-2"},null,8,["modelValue"]),n("div",Ps,[l(M,{type:"primary",size:"small",onClick:B},{default:i(()=>[...t[48]||(t[48]=[J(" 应用 ",-1)])]),_:1}),l(M,{type:"info",size:"small",onClick:G},{default:i(()=>[...t[49]||(t[49]=[J(" 预览执行时间 ",-1)])]),_:1})])]),n("div",_s,[t[55]||(t[55]=n("div",{class:"text-sm font-medium mb-2"},"常用示例：",-1)),n("div",Ss,[n("div",Bs,[l(M,{size:"small",onClick:t[13]||(t[13]=L=>O("0 0 * * *"))},{default:i(()=>[...t[51]||(t[51]=[J(" 每天0点 ",-1)])]),_:1}),l(M,{size:"small",onClick:t[14]||(t[14]=L=>O("0 */30 * * *"))},{default:i(()=>[...t[52]||(t[52]=[J(" 每30分钟 ",-1)])]),_:1}),l(M,{size:"small",onClick:t[15]||(t[15]=L=>O("0 0 9 * * 1-5"))},{default:i(()=>[...t[53]||(t[53]=[J(" 工作日9点 ",-1)])]),_:1}),l(M,{size:"small",onClick:t[16]||(t[16]=L=>O("0 0 0 1 * *"))},{default:i(()=>[...t[54]||(t[54]=[J(" 每月1号0点 ",-1)])]),_:1})])])])])]),_:1},8,["modelValue"])}}}),Ts={key:0},Ms={class:"font-medium"},Es={key:1,class:"text-center text-gray-400 py-4"},Ls=Ee({__name:"CronPreviewDialog",props:{visible:{type:Boolean,default:!1},times:{default:()=>[]}},emits:["update:visible","close"],setup(e,{emit:P}){const u=P,v=()=>{u("update:visible",!1),u("close")};return(T,r)=>{const s=os,c=rs,h=qe;return m(),ae(h,{"model-value":e.visible,title:"Cron 执行时间预览",width:"500","onUpdate:modelValue":r[0]||(r[0]=a=>T.$emit("update:visible",a)),"before-close":v},{default:i(()=>[e.times&&e.times.length>0?(m(),A("div",Ts,[r[1]||(r[1]=n("div",{class:"text-sm text-gray-600 mb-3"},"下5次执行时间：",-1)),l(c,null,{default:i(()=>[(m(!0),A(De,null,Be(e.times,(a,B)=>(m(),ae(s,{key:B,timestamp:a,placement:"top"},{default:i(()=>[n("div",Ms,"第 "+W(B+1)+" 次执行",1)]),_:2},1032,["timestamp"]))),128))]),_:1})])):(m(),A("div",Es," 无法解析 Cron 表达式，请检查格式是否正确 "))]),_:1},8,["model-value"])}}}),Ns={class:"w-64 border rounded p-3 flex flex-col"},Us={class:"flex items-center justify-between mb-3"},zs={class:"flex items-center gap-1"},Os={key:0,class:"flex-1 overflow-y-auto space-y-2 pr-1"},Vs=["onClick"],Rs={class:"flex items-center justify-between gap-2"},Ws={class:"text-sm font-medium truncate flex-1 min-w-0"},js={class:"flex items-center gap-2 flex-shrink-0"},Ys={class:"text-xs text-gray-500 whitespace-nowrap flex items-center gap-1"},Gs={class:"whitespace-nowrap w-5 flex items-center justify-center"},Hs={class:"flex items-center justify-center"},Ks={class:"text-[10px] text-blue-600 min-h-[14px] flex items-center justify-between"},Is={key:0,class:"flex items-center gap-1"},Js={key:1,class:"invisible"},Qs={key:2,class:"text-gray-500 flex items-center gap-1"},qs={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},Xs=Ee({__name:"PlaylistList",props:{playlistCollection:{},activePlaylistId:{},refreshing:{type:Boolean},autoRefreshEnabled:{type:Boolean}},emits:["select","create","refresh","toggle-auto-refresh","menu-command"],setup(e){const P=u=>{if(!u||!u.schedule||u.schedule.enabled!==1||!u.schedule.cron||typeof u.schedule.cron!="string")return null;try{const v=String(u.schedule.cron).trim();if(!v)return null;const T=wt(v,1);return T&&T.length>0?ms(T[0]):null}catch{return null}};return(u,v)=>{const T=Nt,r=Ye,s=Ne,c=us,h=ds,a=cs;return m(),A("div",Ns,[n("div",Us,[v[4]||(v[4]=n("h3",{class:"text-base font-semibold"},"播放列表",-1)),n("div",zs,[l(T,{"model-value":e.autoRefreshEnabled,"onUpdate:modelValue":v[0]||(v[0]=B=>u.$emit("toggle-auto-refresh",B)),"active-text":"","inactive-text":"","active-color":"#409eff",size:"small",title:"自动刷新",class:"mr-1"},null,8,["model-value"]),l(s,{type:"primary",size:"small",plain:"",onClick:v[1]||(v[1]=B=>u.$emit("refresh")),loading:e.refreshing,title:"刷新播放列表",class:"!w-8 !h-6 !p-0"},{default:i(()=>[e.refreshing?ie("",!0):(m(),ae(r,{key:0},{default:i(()=>[l(d(Ve))]),_:1}))]),_:1},8,["loading"]),l(s,{type:"success",size:"small",onClick:v[2]||(v[2]=B=>u.$emit("create")),title:"新建播放列表",class:"!w-8 !h-6 !p-0"},{default:i(()=>[l(r,null,{default:i(()=>[l(d(nt))]),_:1})]),_:1})])]),e.playlistCollection&&e.playlistCollection.length>0?(m(),A("div",Os,[(m(!0),A(De,null,Be(e.playlistCollection,B=>(m(),A("div",{key:B.id,class:Ae(["border rounded px-3 py-2 cursor-pointer hover:bg-gray-50 group min-h-[60px] flex flex-col justify-between",{"border-blue-500 bg-blue-50":B.id===e.activePlaylistId}]),onClick:G=>u.$emit("select",B.id)},[n("div",Rs,[n("div",Ws,W(B.name),1),n("div",js,[n("span",Ys,[l(r,null,{default:i(()=>[l(d(Ql),{class:"!w-3 !h-3"})]),_:1}),n("span",Gs,W((B.pre_lists&&B.pre_lists[d(je)()]&&B.pre_lists[d(je)()].length||0)+(B.playlist&&B.playlist.length||0)),1)]),n("div",Hs,[l(a,{trigger:"click",onCommand:G=>u.$emit("menu-command",G,B.id),onClick:v[3]||(v[3]=we(()=>{},["stop"]))},{dropdown:i(()=>[l(h,null,{default:i(()=>[l(c,{command:"copy"},{default:i(()=>[...v[6]||(v[6]=[n("span",null,"复制",-1)])]),_:1}),e.playlistCollection.length>1?(m(),ae(c,{key:0,command:"delete",divided:""},{default:i(()=>[...v[7]||(v[7]=[n("span",{class:"text-[#f56c6c]"},"删除",-1)])]),_:1})):ie("",!0)]),_:1})]),default:i(()=>[l(s,{type:"default",size:"small",plain:"",circle:"",class:"!w-5 !h-5 !min-w-5 !p-0 text-xs",title:"更多"},{default:i(()=>[...v[5]||(v[5]=[n("span",{class:"text-base leading-none mb-1"},"»",-1)])]),_:1})]),_:1},8,["onCommand"])])])]),n("div",Ks,[P(B)?(m(),A("span",Is,[l(r,{class:"!w-3 !h-4"},{default:i(()=>[l(d(ql))]),_:1}),J(" "+W(P(B)),1)])):(m(),A("span",Js,"占位")),B.trigger_button?(m(),A("span",Qs,[l(r,{class:"!w-3 !h-4"},{default:i(()=>[l(d(Bt))]),_:1}),J(" "+W(B.trigger_button),1)])):ie("",!0)])],10,Vs))),128))])):(m(),A("div",qs,' 暂无播放列表，请点击"新建"创建 '))])}}}),Zs={class:"border rounded p-2 mb-2"},en={class:"flex items-center justify-between mb-2"},tn={class:"flex items-center gap-1"},ln={class:"flex items-center gap-1"},sn={class:"text-[10px]"},nn={class:"flex items-center justify-between text-xs text-gray-500 mb-2 pr-2.5"},an={class:"flex items-center"},on={key:0},rn={class:"flex items-center gap-1"},dn=["draggable","onClick","onDragstart","onDrop"],un={class:"text-xs text-gray-500 w-8"},cn=["title"],fn={key:1,class:"w-full border-t border-gray-200"},vn={key:2,class:"text-sm text-gray-400 text-center py-1"},mn=Ee({__name:"PreFilesList",props:{playlistStatus:{},selectedWeekdayIndex:{},preFilesDragMode:{type:Boolean},preFilesBatchDeleteMode:{type:Boolean},selectedPreFileIndices:{},preFilesExpanded:{type:Boolean},playlistLoading:{type:Boolean},showMoreActions:{type:Boolean},audioPlayer:{}},emits:["select-weekday","open-file-browser","toggle-drag-mode","toggle-batch-delete-mode","batch-delete","clear","toggle-expand","toggle-selection","drag-start","drag-end","drag-over","drop","play-file","seek-file","move-up","move-down","replace","open-playlist-selector","delete"],setup(e){const P=e,u=()=>P.selectedWeekdayIndex!==null?P.selectedWeekdayIndex:je(),v=()=>{const s=P.playlistStatus;if(!s||!s.pre_lists)return[];const c=u();return!Array.isArray(s.pre_lists)||s.pre_lists.length!==7?[]:s.pre_lists[c]||[]},T=s=>{const c=P.playlistStatus;if(!c||!c.pre_lists||!Array.isArray(c.pre_lists)||c.pre_lists.length!==7)return 0;const h=c.pre_lists[s];return Array.isArray(h)?h.length:0},r=()=>{const s=v();return at(s)};return(s,c)=>{const h=Ne,a=bt,B=Ye,G=ot;return m(),A("div",Zs,[n("div",en,[c[12]||(c[12]=n("div",{class:"text-xs font-semibold text-gray-600 w-39"},"前置文件（播放时优先播放）",-1)),n("div",tn,[n("div",ln,[(m(),A(De,null,Be(["周一","周二","周三","周四","周五","周六","周日"],(O,f)=>l(h,{key:f,type:e.selectedWeekdayIndex===f||e.selectedWeekdayIndex===null&&d(je)()===f?"primary":"default",size:"small",plain:"",onClick:t=>s.$emit("select-weekday",f),title:O,class:"!w-16 !h-6 !p-0 text-xs"},{default:i(()=>[J(W(O),1),n("span",sn,"["+W(T(f))+"]",1)]),_:2},1032,["type","onClick","title"])),64))])])]),n("div",nn,[n("div",an,[r()>0?(m(),A("span",on," 总时长："+W(d(yt)(r())),1)):ie("",!0),v()&&v().length>0?(m(),A("span",{key:1,class:Ae(r()>0?"ml-2":"")}," 共 "+W(v().length)+" 首， 当前: "+W(e.playlistStatus?.pre_index!==void 0&&e.playlistStatus.pre_index!==null&&e.playlistStatus.pre_index>=0?e.playlistStatus.pre_index+1:"-")+" / "+W(v().length),3)):ie("",!0),e.playlistStatus?.isPlaying&&e.playlistStatus.in_pre_files===!0?(m(),ae(a,{key:2,type:"success",size:"small",class:"ml-2"},{default:i(()=>[...c[13]||(c[13]=[J(" 播放中 ",-1)])]),_:1})):ie("",!0)]),n("div",rn,[l(h,{type:"primary",size:"small",plain:"",onClick:c[0]||(c[0]=O=>s.$emit("open-file-browser")),disabled:!e.playlistStatus||e.preFilesDragMode||e.preFilesBatchDeleteMode},{default:i(()=>[...c[14]||(c[14]=[J(" + ",-1)])]),_:1},8,["disabled"]),l(h,{type:e.preFilesDragMode?"success":"default",size:"small",plain:"",class:"!w-8 !h-6",onClick:c[1]||(c[1]=O=>s.$emit("toggle-drag-mode")),disabled:!e.playlistStatus||!v()||v().length===0||e.preFilesBatchDeleteMode,title:e.preFilesDragMode?"点击退出拖拽排序模式":"点击进入拖拽排序模式"},{default:i(()=>[e.preFilesDragMode?(m(),ae(B,{key:0},{default:i(()=>[l(d(Je))]),_:1})):(m(),ae(B,{key:1},{default:i(()=>[l(d(gt))]),_:1}))]),_:1},8,["type","disabled","title"]),l(h,{type:e.preFilesBatchDeleteMode?"success":"default",size:"small",plain:"",class:"!w-8 !h-6",onClick:c[2]||(c[2]=O=>s.$emit("toggle-batch-delete-mode")),disabled:!e.playlistStatus||!v()||v().length===0||e.preFilesDragMode,title:e.preFilesBatchDeleteMode?"点击退出批量删除模式":"点击进入批量删除模式"},{default:i(()=>[e.preFilesBatchDeleteMode?(m(),ae(B,{key:0},{default:i(()=>[l(d(Je))]),_:1})):(m(),ae(B,{key:1},{default:i(()=>[l(d(ze))]),_:1}))]),_:1},8,["type","disabled","title"]),ye(l(h,{type:"danger",size:"small",plain:"",class:"!w-8 !h-6",onClick:c[3]||(c[3]=O=>s.$emit("batch-delete")),disabled:e.playlistLoading||e.selectedPreFileIndices.length===0,title:`删除选中的 ${e.selectedPreFileIndices.length} 项`},{default:i(()=>[l(B,null,{default:i(()=>[l(d(ze))]),_:1})]),_:1},8,["disabled","title"]),[[Pe,e.preFilesBatchDeleteMode]]),ye(l(h,{type:"default",size:"small",plain:"",class:"!w-8 !h-6",onClick:c[4]||(c[4]=O=>s.$emit("clear")),disabled:!e.playlistStatus||!v()||v().length===0||e.playlistLoading||e.preFilesDragMode,title:"清空列表"},{default:i(()=>[l(B,null,{default:i(()=>[l(d(ze))]),_:1})]),_:1},8,["disabled"]),[[Pe,e.showMoreActions&&!e.preFilesBatchDeleteMode]])])]),v()&&v().length>0?(m(),A("div",{key:0,class:Ae(["overflow-y-scroll scrollbar-overlay",{"max-h-[192px]":!e.preFilesExpanded}])},[(m(!0),A(De,null,Be(v(),(O,f)=>(m(),A("div",{key:"pre-"+f,class:Ae(["flex items-center gap-2 p-1 hover:bg-gray-100 rounded",{"bg-blue-50":Number(e.playlistStatus?.pre_index)===f,"bg-blue-100":e.preFilesBatchDeleteMode&&e.selectedPreFileIndices.includes(Number(f)),"cursor-move":e.preFilesDragMode,"cursor-pointer":e.preFilesBatchDeleteMode&&!e.preFilesDragMode,"cursor-default":!e.preFilesDragMode&&!e.preFilesBatchDeleteMode,"select-none":!0}]),draggable:e.preFilesDragMode,onClick:t=>e.preFilesBatchDeleteMode&&!e.preFilesDragMode?s.$emit("toggle-selection",Number(f)):null,onDragstart:t=>s.$emit("drag-start",t,Number(f)),onDragend:c[8]||(c[8]=t=>s.$emit("drag-end",t)),onDragover:c[9]||(c[9]=we(t=>s.$emit("drag-over",t),["prevent"])),onDragleave:c[10]||(c[10]=t=>{const _=t.currentTarget;_&&_.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")}),onDrop:we(t=>s.$emit("drop",t,Number(f)),["prevent"])},[n("span",un,W(Number(f)+1),1),n("span",{class:Ae(["flex-1 text-sm truncate",{"text-blue-600":Number(e.playlistStatus?.pre_index)===f}]),title:O.uri||""},W(O.uri?O.uri.split("/").pop():""),11,cn),n("div",{class:"flex items-center gap-1 flex-shrink-0",onMousedown:c[6]||(c[6]=we(()=>{},["stop"])),onClick:c[7]||(c[7]=we(()=>{},["stop"]))},[ye(l(Et,{file:O,player:e.audioPlayer,disabled:e.playlistLoading,onPlay:t=>s.$emit("play-file",O),onSeek:(t,_)=>s.$emit("seek-file",t,_)},null,8,["file","player","disabled","onPlay","onSeek"]),[[Pe,!e.preFilesBatchDeleteMode]]),ye(l(G,{class:"!h-6","model-value":e.selectedPreFileIndices.includes(Number(f)),onChange:t=>s.$emit("toggle-selection",Number(f)),onClick:c[5]||(c[5]=we(()=>{},["stop"]))},null,8,["model-value","onChange"]),[[Pe,e.preFilesBatchDeleteMode]]),ye(l(h,{type:"default",size:"small",plain:"",circle:"",onClick:we(t=>s.$emit("move-up",Number(f)),["stop"]),disabled:Number(f)===0||e.playlistLoading,title:"上移"},{default:i(()=>[...c[15]||(c[15]=[J(" ↑ ",-1)])]),_:1},8,["onClick","disabled"]),[[Pe,e.showMoreActions&&!e.preFilesDragMode&&!e.preFilesBatchDeleteMode]]),ye(l(h,{type:"default",size:"small",plain:"",circle:"",onClick:we(t=>s.$emit("move-down",Number(f)),["stop"]),disabled:Number(f)===v().length-1||e.playlistLoading,title:"下移"},{default:i(()=>[...c[16]||(c[16]=[J(" ↓ ",-1)])]),_:1},8,["onClick","disabled"]),[[Pe,e.showMoreActions&&!e.preFilesDragMode&&!e.preFilesBatchDeleteMode]]),ye(l(h,{type:"default",size:"small",plain:"",circle:"",onClick:we(t=>s.$emit("replace",Number(f)),["stop"]),disabled:e.playlistLoading,title:"替换"},{default:i(()=>[l(B,null,{default:i(()=>[l(d(Ve))]),_:1})]),_:1},8,["onClick","disabled"]),[[Pe,e.showMoreActions&&!e.preFilesDragMode&&!e.preFilesBatchDeleteMode]]),ye(l(h,{type:"info",size:"small",plain:"",circle:"",onClick:we(t=>s.$emit("open-playlist-selector",O),["stop"]),disabled:e.playlistLoading,title:"应用到列表"},{default:i(()=>[l(B,null,{default:i(()=>[l(d(At))]),_:1})]),_:1},8,["onClick","disabled"]),[[Pe,!e.preFilesBatchDeleteMode&&!e.preFilesDragMode]]),ye(l(h,{type:"default",size:"small",plain:"",circle:"",onClick:we(t=>s.$emit("delete",Number(f)),["stop"]),disabled:e.playlistLoading||e.preFilesDragMode,title:"删除"},{default:i(()=>[l(B,null,{default:i(()=>[l(d(pt))]),_:1})]),_:1},8,["onClick","disabled"]),[[Pe,!e.preFilesBatchDeleteMode]])],32)],42,dn))),128))],2)):ie("",!0),v()&&v().length>0?(m(),A("div",fn,[l(h,{type:"default",size:"small",plain:"",class:"!w-full !h-4 !p-0 !text-xs",onClick:c[11]||(c[11]=O=>s.$emit("toggle-expand")),title:e.preFilesExpanded?"折叠":"展开"},{default:i(()=>[e.preFilesExpanded?(m(),ae(B,{key:0},{default:i(()=>[l(d(Xl))]),_:1})):(m(),ae(B,{key:1},{default:i(()=>[l(d(Zl))]),_:1}))]),_:1},8,["title"])])):(m(),A("div",vn,"前置文件列表为空"))])}}}),gn={key:0,class:"border rounded p-2"},pn={class:"flex items-center justify-between mb-2 pr-2.5"},yn={class:"text-xs font-semibold text-gray-600"},hn={key:0,class:"ml-2 text-gray-500"},bn={key:1,class:"ml-2 text-gray-500"},xn={class:"flex items-center gap-1"},wn={key:0,class:"overflow-y-scroll scrollbar-overlay"},Dn=["draggable","onClick","onDragstart","onDrop"],$n={class:"text-xs text-gray-500 w-8"},Cn=["title"],Fn={key:1,class:"text-sm text-gray-400 text-center py-1"},kn=Ee({__name:"FilesList",props:{playlistStatus:{},filesDragMode:{type:Boolean},filesBatchDeleteMode:{type:Boolean},selectedFileIndices:{},playlistLoading:{type:Boolean},showMoreActions:{type:Boolean},audioPlayer:{}},emits:["open-file-browser","toggle-drag-mode","toggle-batch-delete-mode","batch-delete","clear","toggle-selection","drag-start","drag-end","drag-over","drop","play-file","seek-file","move-up","move-down","replace","open-playlist-selector","delete"],setup(e,{emit:P}){const u=e,v=P,T={plain:!0,size:"small",class:"!w-8 !h-6"},r={type:"default",size:"small",plain:!0,circle:!0},s=ve(()=>u.playlistStatus?.playlist||[]),c=ve(()=>s.value.length),h=ve(()=>u.playlistStatus?.current_index??-1),a=ve(()=>h.value>=0?h.value+1:"-"),B=ve(()=>u.playlistStatus?.isPlaying&&!u.playlistStatus.in_pre_files),G=ve(()=>c.value>0),O=ve(()=>G.value?at(s.value):0),f=ve(()=>u.filesBatchDeleteMode&&G.value&&!u.filesDragMode),t=ve(()=>u.showMoreActions&&!u.filesDragMode&&!u.filesBatchDeleteMode),_=ve(()=>u.showMoreActions&&!u.filesBatchDeleteMode),D=ve(()=>!u.filesBatchDeleteMode&&!u.filesDragMode),te=ve(()=>!u.playlistStatus||u.filesDragMode||u.filesBatchDeleteMode),M=ve(()=>!G.value||u.filesBatchDeleteMode),z=ve(()=>!G.value||u.filesDragMode),L=ve(()=>u.playlistLoading||u.selectedFileIndices.length===0),ee=ve(()=>`删除选中的 ${u.selectedFileIndices.length} 项`),j=ve(()=>!G.value||u.playlistLoading||u.filesDragMode),re=k=>k?k.split("/").pop():"",U=k=>u.selectedFileIndices.includes(k),x=k=>k===h.value,$=k=>({"bg-blue-50":x(k),"bg-blue-100":f.value&&U(k),"cursor-move":u.filesDragMode,"cursor-pointer":f.value,"cursor-default":!u.filesDragMode&&!u.filesBatchDeleteMode}),p=ve(()=>u.playlistLoading||u.filesDragMode),S=k=>{f.value&&v("toggle-selection",k)},C=(k,F)=>{v("drag-start",k,F)},q=k=>{v("drag-end",k)},me=k=>{v("drag-over",k)},y=k=>{const F=k.currentTarget;F?.classList&&F.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")},g=(k,F)=>{v("drop",k,F)},o=(k,F)=>{v("seek-file",k,F)};return(k,F)=>{const K=bt,le=Ne,de=Ye,Me=ot;return e.playlistStatus?.playlist?(m(),A("div",gn,[n("div",pn,[n("div",yn,[F[9]||(F[9]=J(" 正式文件（播放时记录进度） ",-1)),O.value>0?(m(),A("span",hn," 总时长："+W(d(yt)(O.value)),1)):ie("",!0),G.value?(m(),A("span",bn," 共 "+W(c.value)+" 首， 当前: "+W(a.value)+" / "+W(c.value),1)):ie("",!0),B.value?(m(),ae(K,{key:2,type:"success",size:"small",class:"ml-2"},{default:i(()=>[...F[8]||(F[8]=[J(" 播放中 ",-1)])]),_:1})):ie("",!0)]),n("div",xn,[l(le,Oe({type:"primary"},T,{onClick:F[0]||(F[0]=Ce=>v("open-file-browser")),disabled:te.value}),{default:i(()=>[...F[10]||(F[10]=[J(" + ",-1)])]),_:1},16,["disabled"]),l(le,Oe({type:e.filesDragMode?"success":"default"},T,{onClick:F[1]||(F[1]=Ce=>v("toggle-drag-mode")),disabled:M.value,title:e.filesDragMode?"点击退出拖拽排序模式":"点击进入拖拽排序模式"}),{default:i(()=>[e.filesDragMode?(m(),ae(de,{key:0},{default:i(()=>[l(d(Je))]),_:1})):(m(),ae(de,{key:1},{default:i(()=>[l(d(gt))]),_:1}))]),_:1},16,["type","disabled","title"]),l(le,Oe({type:e.filesBatchDeleteMode?"success":"default"},T,{onClick:F[2]||(F[2]=Ce=>v("toggle-batch-delete-mode")),disabled:z.value,title:e.filesBatchDeleteMode?"点击退出批量删除模式":"点击进入批量删除模式"}),{default:i(()=>[e.filesBatchDeleteMode?(m(),ae(de,{key:0},{default:i(()=>[l(d(Je))]),_:1})):(m(),ae(de,{key:1},{default:i(()=>[l(d(ze))]),_:1}))]),_:1},16,["type","disabled","title"]),ye(l(le,Oe({type:"danger"},T,{onClick:F[3]||(F[3]=Ce=>v("batch-delete")),disabled:L.value,title:ee.value}),{default:i(()=>[l(de,null,{default:i(()=>[l(d(ze))]),_:1})]),_:1},16,["disabled","title"]),[[Pe,e.filesBatchDeleteMode]]),ye(l(le,Oe({type:"default"},T,{onClick:F[4]||(F[4]=Ce=>v("clear")),disabled:j.value,title:"清空正式文件列表"}),{default:i(()=>[l(de,null,{default:i(()=>[l(d(ze))]),_:1})]),_:1},16,["disabled"]),[[Pe,_.value]])])]),G.value?(m(),A("div",wn,[(m(!0),A(De,null,Be(s.value,(Ce,he)=>(m(),A("div",{key:Ce.uri||he,class:Ae(["flex items-center gap-2 p-1 hover:bg-gray-100 rounded select-none",$(he)]),draggable:e.filesDragMode,onClick:R=>S(he),onDragstart:R=>C(R,he),onDragend:q,onDragover:we(me,["prevent"]),onDragleave:y,onDrop:we(R=>g(R,he),["prevent"])},[n("span",$n,W(he+1),1),n("span",{class:Ae(["flex-1 text-sm truncate",{"text-blue-600":x(he)}]),title:Ce.uri||""},W(re(Ce.uri)),11,Cn),n("div",{class:"flex items-center gap-1 flex-shrink-0",onMousedown:F[6]||(F[6]=we(()=>{},["stop"])),onClick:F[7]||(F[7]=we(()=>{},["stop"]))},[ye(l(Et,{file:Ce,player:e.audioPlayer,disabled:e.playlistLoading,onPlay:R=>v("play-file",Ce),onSeek:o},null,8,["file","player","disabled","onPlay"]),[[Pe,!e.filesBatchDeleteMode]]),ye(l(Me,{class:"!h-6","model-value":U(he),onChange:R=>v("toggle-selection",he),onClick:F[5]||(F[5]=we(()=>{},["stop"]))},null,8,["model-value","onChange"]),[[Pe,e.filesBatchDeleteMode]]),ye(l(le,Oe({ref_for:!0},r,{onClick:we(R=>v("move-up",he),["stop"]),disabled:he===0||e.playlistLoading,title:"上移"}),{default:i(()=>[...F[11]||(F[11]=[J(" ↑ ",-1)])]),_:1},16,["onClick","disabled"]),[[Pe,t.value]]),ye(l(le,Oe({ref_for:!0},r,{onClick:we(R=>v("move-down",he),["stop"]),disabled:he===c.value-1||e.playlistLoading,title:"下移"}),{default:i(()=>[...F[12]||(F[12]=[J(" ↓ ",-1)])]),_:1},16,["onClick","disabled"]),[[Pe,t.value]]),ye(l(le,Oe({ref_for:!0},r,{onClick:we(R=>v("replace",he),["stop"]),disabled:e.playlistLoading,title:"替换"}),{default:i(()=>[l(de,null,{default:i(()=>[l(d(Ve))]),_:1})]),_:1},16,["onClick","disabled"]),[[Pe,t.value]]),ye(l(le,{type:"info",size:"small",plain:"",circle:"",onClick:we(R=>v("open-playlist-selector",Ce),["stop"]),disabled:e.playlistLoading,title:"应用到列表"},{default:i(()=>[l(de,null,{default:i(()=>[l(d(At))]),_:1})]),_:1},8,["onClick","disabled"]),[[Pe,D.value]]),ye(l(le,Oe({ref_for:!0},r,{onClick:we(R=>v("delete",he),["stop"]),disabled:p.value,title:"删除"}),{default:i(()=>[l(de,null,{default:i(()=>[l(d(pt))]),_:1})]),_:1},16,["onClick","disabled"]),[[Pe,!e.filesBatchDeleteMode]])],32)],42,Dn))),128))])):(m(),A("div",Fn,"正式文件列表为空"))])):ie("",!0)}}}),Pn={class:"flex-1 border rounded p-3 flex flex-col"},_n={class:"flex items-center justify-between mb-3"},Sn={class:"flex-1"},Bn={key:0,class:"flex items-center gap-2 mb-1"},An={class:"flex items-center gap-2 flex-1"},Tn={class:"text-lg font-semibold truncate"},Mn={key:1},En={key:2,class:"text-sm text-gray-500"},Ln={key:0,class:"mr-2"},Nn={class:"flex flex-wrap gap-2"},Un={key:1},zn={key:1},On={key:1},Vn={key:1},Rn={key:0,class:"flex-1 overflow-y-scroll scrollbar-overlay"},Wn={key:0,class:"text-sm text-gray-400 text-center py-8"},jn={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},Yn=Ee({__name:"FileListPanel",props:{playlistStatus:{},activePlaylistId:{},editingPlaylistId:{},editingPlaylistName:{},selectedWeekdayIndex:{},preFilesDragMode:{type:Boolean},preFilesBatchDeleteMode:{type:Boolean},selectedPreFileIndices:{},preFilesExpanded:{type:Boolean},filesDragMode:{type:Boolean},filesBatchDeleteMode:{type:Boolean},selectedFileIndices:{},playlistLoading:{type:Boolean},playing:{type:Boolean},stopping:{type:Boolean},showMoreActions:{type:Boolean},audioPlayer:{}},emits:["update:editingPlaylistName","start-edit-name","save-name","cancel-edit-name","open-batch-drawer","play","play-pre","play-next","stop","clear","toggle-more-actions","select-weekday","open-file-browser-for-pre-files","toggle-pre-files-drag-mode","toggle-pre-files-batch-delete-mode","batch-delete-pre-files","clear-pre-files","toggle-pre-files-expand","toggle-pre-file-selection","pre-file-drag-start","pre-file-drag-end","pre-file-drag-over","pre-file-drop","open-file-browser","toggle-files-drag-mode","toggle-files-batch-delete-mode","batch-delete-files","clear-files","toggle-file-selection","file-drag-start","file-drag-end","file-drag-over","file-drop","play-file","seek-file","move-pre-file-up","move-pre-file-down","replace-pre-file","open-playlist-selector-for-pre-file","delete-pre-file","move-file-up","move-file-down","replace-file","open-playlist-selector-for-file","delete-file"],setup(e){const P=e,u=()=>P.selectedWeekdayIndex!==null?P.selectedWeekdayIndex:je(),v=()=>{const r=P.playlistStatus;if(!r||!r.pre_lists)return[];const s=u();return!Array.isArray(r.pre_lists)||r.pre_lists.length!==7?[]:r.pre_lists[s]||[]},T=()=>{const r=P.playlistStatus;if(!r)return 0;const s=v(),c=at(s),h=r.playlist||[],a=at(h);return c+a};return(r,s)=>{const c=Ye,h=Ne;return m(),A("div",Pn,[n("div",_n,[n("div",Sn,[e.playlistStatus?(m(),A("div",Bn,[n("div",An,[n("h3",Tn,W(e.playlistStatus.name),1),l(h,{type:"default",size:"small",plain:"",circle:"",onClick:s[0]||(s[0]=a=>r.$emit("start-edit-name",e.activePlaylistId)),title:"编辑名称"},{default:i(()=>[l(c,null,{default:i(()=>[l(d(Tt))]),_:1})]),_:1})])])):(m(),A("div",Mn,[...s[44]||(s[44]=[n("h3",{class:"text-lg font-semibold"},"播放列表文件",-1)])])),e.playlistStatus?(m(),A("div",En,[T()>0?(m(),A("span",Ln," 总时长："+W(d(yt)(T())),1)):ie("",!0),e.playlistStatus?(m(),A(De,{key:1},[(v()?.length||0)+(e.playlistStatus.playlist?.length||0)>0?(m(),A(De,{key:0},[J(" 共 "+W((v()?.length||0)+(e.playlistStatus.playlist?.length||0))+" 首， 当前: ",1),e.playlistStatus.pre_index!==void 0&&e.playlistStatus.pre_index!==null&&e.playlistStatus.pre_index>=0?(m(),A(De,{key:0},[J(W(e.playlistStatus.pre_index+1),1)],64)):e.playlistStatus.current_index!==void 0&&e.playlistStatus.current_index!==null&&e.playlistStatus.current_index>=0?(m(),A(De,{key:1},[J(W((v()?.length||0)+e.playlistStatus.current_index+1),1)],64)):(m(),A(De,{key:2},[J(" - ")],64)),J(" / "+W((v()?.length||0)+(e.playlistStatus.playlist?.length||0)),1)],64)):(m(),A(De,{key:1},[J(" 共 0 首， 当前: - / 0 ")],64))],64)):ie("",!0)])):ie("",!0)]),n("div",Nn,[l(h,{type:"default",size:"small",plain:"",circle:"",onClick:s[1]||(s[1]=a=>r.$emit("open-batch-drawer")),title:"批量模式"},{default:i(()=>[l(c,null,{default:i(()=>[l(d(es))]),_:1})]),_:1}),l(h,{type:"default",size:"small",plain:"",circle:"",onClick:s[2]||(s[2]=a=>r.$emit("play")),class:"items-center justify-center",disabled:!e.playlistStatus||!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0||!!e.playlistStatus.isPlaying,title:"播放"},{default:i(()=>[e.playing?(m(),ae(c,{key:0,size:"12",class:"animate-spin"},{default:i(()=>[l(d(He))]),_:1})):(m(),A("span",Un,"▶"))]),_:1},8,["disabled"]),l(h,{type:"default",size:"small",plain:"",circle:"",onClick:s[3]||(s[3]=a=>r.$emit("play-pre")),disabled:!e.playlistStatus||(!v()||v().length===0)&&(!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0),title:"上一首"},{default:i(()=>[e.playing?(m(),ae(c,{key:0,size:"12",class:"animate-spin"},{default:i(()=>[l(d(He))]),_:1})):(m(),A("span",zn,"⏮"))]),_:1},8,["disabled"]),l(h,{type:"default",size:"small",plain:"",circle:"",onClick:s[4]||(s[4]=a=>r.$emit("play-next")),disabled:!e.playlistStatus||(!v()||v().length===0)&&(!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0),title:"下一首"},{default:i(()=>[e.playing?(m(),ae(c,{key:0,size:"12",class:"animate-spin"},{default:i(()=>[l(d(He))]),_:1})):(m(),A("span",On,"⏭"))]),_:1},8,["disabled"]),l(h,{type:"default",size:"small",plain:"",circle:"",onClick:s[5]||(s[5]=a=>r.$emit("stop")),title:"停止"},{default:i(()=>[e.stopping?(m(),ae(c,{key:0,size:"12",class:"animate-spin"},{default:i(()=>[l(d(He))]),_:1})):(m(),A("span",Vn,"⏹"))]),_:1}),ye(l(h,{type:"default",size:"small",plain:"",circle:"",onClick:s[6]||(s[6]=a=>r.$emit("clear")),disabled:!e.playlistStatus||(!v()||v().length===0)&&(!e.playlistStatus.playlist||e.playlistStatus.playlist.length===0)||e.playlistLoading,title:"清空列表（包括前置文件和正式文件）"},{default:i(()=>[l(c,null,{default:i(()=>[l(d(ze))]),_:1})]),_:1},8,["disabled"]),[[Pe,e.showMoreActions]]),l(h,{type:"default",size:"small",plain:"",circle:"",onClick:s[7]||(s[7]=a=>r.$emit("toggle-more-actions")),title:"更多"},{default:i(()=>[l(c,null,{default:i(()=>[l(d(gt))]),_:1})]),_:1})])]),e.playlistStatus?(m(),A("div",Rn,[l(mn,{"playlist-status":e.playlistStatus,"selected-weekday-index":e.selectedWeekdayIndex,"pre-files-drag-mode":e.preFilesDragMode,"pre-files-batch-delete-mode":e.preFilesBatchDeleteMode,"selected-pre-file-indices":e.selectedPreFileIndices,"pre-files-expanded":e.preFilesExpanded,"playlist-loading":e.playlistLoading,"show-more-actions":e.showMoreActions,"audio-player":e.audioPlayer,onSelectWeekday:s[8]||(s[8]=a=>r.$emit("select-weekday",a)),onOpenFileBrowser:s[9]||(s[9]=a=>r.$emit("open-file-browser-for-pre-files")),onToggleDragMode:s[10]||(s[10]=a=>r.$emit("toggle-pre-files-drag-mode")),onToggleBatchDeleteMode:s[11]||(s[11]=a=>r.$emit("toggle-pre-files-batch-delete-mode")),onBatchDelete:s[12]||(s[12]=a=>r.$emit("batch-delete-pre-files")),onClear:s[13]||(s[13]=a=>r.$emit("clear-pre-files")),onToggleExpand:s[14]||(s[14]=a=>r.$emit("toggle-pre-files-expand")),onToggleSelection:s[15]||(s[15]=a=>r.$emit("toggle-pre-file-selection",a)),onDragStart:s[16]||(s[16]=(a,B)=>r.$emit("pre-file-drag-start",a,B)),onDragEnd:s[17]||(s[17]=a=>r.$emit("pre-file-drag-end",a)),onDragOver:s[18]||(s[18]=a=>r.$emit("pre-file-drag-over",a)),onDrop:s[19]||(s[19]=(a,B)=>r.$emit("pre-file-drop",a,B)),onPlayFile:s[20]||(s[20]=a=>r.$emit("play-file",a)),onSeekFile:s[21]||(s[21]=(a,B)=>r.$emit("seek-file",a,B)),onMoveUp:s[22]||(s[22]=a=>r.$emit("move-pre-file-up",a)),onMoveDown:s[23]||(s[23]=a=>r.$emit("move-pre-file-down",a)),onReplace:s[24]||(s[24]=a=>r.$emit("replace-pre-file",a)),onOpenPlaylistSelector:s[25]||(s[25]=a=>r.$emit("open-playlist-selector-for-pre-file",a)),onDelete:s[26]||(s[26]=a=>r.$emit("delete-pre-file",a))},null,8,["playlist-status","selected-weekday-index","pre-files-drag-mode","pre-files-batch-delete-mode","selected-pre-file-indices","pre-files-expanded","playlist-loading","show-more-actions","audio-player"]),l(kn,{"playlist-status":e.playlistStatus,"files-drag-mode":e.filesDragMode,"files-batch-delete-mode":e.filesBatchDeleteMode,"selected-file-indices":e.selectedFileIndices,"playlist-loading":e.playlistLoading,"show-more-actions":e.showMoreActions,"audio-player":e.audioPlayer,onOpenFileBrowser:s[27]||(s[27]=a=>r.$emit("open-file-browser")),onToggleDragMode:s[28]||(s[28]=a=>r.$emit("toggle-files-drag-mode")),onToggleBatchDeleteMode:s[29]||(s[29]=a=>r.$emit("toggle-files-batch-delete-mode")),onBatchDelete:s[30]||(s[30]=a=>r.$emit("batch-delete-files")),onClear:s[31]||(s[31]=a=>r.$emit("clear-files")),onToggleSelection:s[32]||(s[32]=a=>r.$emit("toggle-file-selection",a)),onDragStart:s[33]||(s[33]=(a,B)=>r.$emit("file-drag-start",a,B)),onDragEnd:s[34]||(s[34]=a=>r.$emit("file-drag-end",a)),onDragOver:s[35]||(s[35]=a=>r.$emit("file-drag-over",a)),onDrop:s[36]||(s[36]=(a,B)=>r.$emit("file-drop",a,B)),onPlayFile:s[37]||(s[37]=a=>r.$emit("play-file",a)),onSeekFile:s[38]||(s[38]=(a,B)=>r.$emit("seek-file",a,B)),onMoveUp:s[39]||(s[39]=a=>r.$emit("move-file-up",a)),onMoveDown:s[40]||(s[40]=a=>r.$emit("move-file-down",a)),onReplace:s[41]||(s[41]=a=>r.$emit("replace-file",a)),onOpenPlaylistSelector:s[42]||(s[42]=a=>r.$emit("open-playlist-selector-for-file",a)),onDelete:s[43]||(s[43]=a=>r.$emit("delete-file",a))},null,8,["playlist-status","files-drag-mode","files-batch-delete-mode","selected-file-indices","playlist-loading","show-more-actions","audio-player"]),(!v()||v().length===0)&&(!e.playlistStatus?.playlist||e.playlistStatus.playlist.length===0)?(m(),A("div",Wn,' 当前播放列表为空，点击"添加文件"开始构建播放列表 ')):ie("",!0)])):(m(),A("div",jn," 请先在左侧选择一个播放列表查看详情 "))])}}}),Gn=["agent","dlna","bluetooth","mi"],Hn=1e4,Pt=5,Kn=5e3,We="默认播放列表",In=1440,lt=7,Jn=[...Gn],Qn="dlna",Wt="active_playlist_id",st={NONE:"",BUTTON_1:"B1",BUTTON_2:"B2",BUTTON_3:"B3"},qn={class:"w-80 min-w-75 border rounded p-3 flex flex-col"},Xn={key:0,class:"mb-3 flex items-center gap-2 flex-wrap"},Zn={key:1,class:"flex-1 overflow-y-auto space-y-4"},ea={class:"border rounded p-3"},ta={class:"flex items-center justify-between mb-2"},la={class:"space-y-2"},sa={class:"flex items-center gap-2"},na={class:"flex items-start gap-4"},aa={class:"flex-1"},ia={class:"flex-1"},oa={key:0},ra={class:"border rounded p-3"},da={class:"space-y-2"},ua={class:"text-xs text-gray-600 mb-1 flex items-center gap-2"},ca={key:0,class:"text-xs text-gray-500"},fa={class:"flex items-center gap-2"},va={class:"mt-3"},ma={class:"flex items-center justify-between mb-2"},ga={class:"text-xs font-semibold text-gray-700"},pa={key:0},ya={class:"space-y-2 max-h-[200px] overflow-y-auto"},ha={class:"flex-1 min-w-0"},ba={class:"text-sm font-medium truncate"},xa={class:"text-xs text-gray-500 truncate"},wa={class:"flex-shrink-0"},Da={key:0,class:"text-xs text-gray-400 text-center py-4"},$a={key:1},Ca={class:"space-y-2 max-h-[200px] overflow-y-auto"},Fa={class:"flex-1 min-w-0"},ka={class:"text-sm font-medium truncate"},Pa=["title"],_a={class:"flex-shrink-0"},Sa={key:0,class:"text-xs text-gray-400 text-center py-4"},Ba={key:2},Aa={class:"space-y-2 max-h-[200px] overflow-y-auto"},Ta={class:"flex-1 min-w-0"},Ma={class:"text-sm font-medium truncate"},Ea=["title"],La={class:"flex-shrink-0"},Na={key:0,class:"text-xs text-gray-400 text-center py-4"},Ua={key:2,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},za=Ee({__name:"ConfigPanel",props:{playlistStatus:{},connectedDeviceList:{},dlnaDeviceList:{},miDeviceList:{},loading:{type:Boolean},dlnaScanning:{type:Boolean},miScanning:{type:Boolean},onToggleCronEnabled:{type:Function},onUpdateCron:{type:Function},onUpdateDuration:{type:Function},onUpdateTriggerButton:{type:Function},onOpenCronBuilder:{type:Function},onPreviewCron:{type:Function},onUpdateDeviceType:{type:Function},onUpdateDeviceAddress:{type:Function},onSelectBluetoothDevice:{type:Function},onSelectAgentDevice:{type:Function},onSelectMiDevice:{type:Function},onScanDlnaDevices:{type:Function},onScanMiDevices:{type:Function},onOpenScanDialog:{type:Function},onOpenDeviceList:{type:Function}},setup(e){const P=e,u=ve(()=>P.playlistStatus?.device?.type||P.playlistStatus?.device_type||null),v=ve(()=>P.playlistStatus?.device?.address||P.playlistStatus?.device_address||""),T=O=>ve(()=>u.value===O),r=ve(()=>{const O=u.value;return O==="agent"||O==="bluetooth"}),s=T("dlna"),c=T("mi"),h=ve(()=>r.value?"已配对的设备":s.value?"DLNA 设备":c.value?"小米设备":"设备列表"),a=ve(()=>r.value?"扫描设备":s.value?"扫描 DLNA 设备":c.value?"扫描小米设备":"扫描设备"),B=ve(()=>P.dlnaScanning||P.miScanning),G=()=>{r.value?P.onOpenScanDialog():s.value?P.onScanDlnaDevices():c.value&&P.onScanMiDevices()};return(O,f)=>{const t=Ye,_=Ne,D=Nt,te=ht,M=fs,z=zt,L=Ut,ee=xt;return m(),A("div",qn,[f[20]||(f[20]=n("h3",{class:"text-lg font-semibold mb-3"},"配置详情",-1)),e.playlistStatus?(m(),A("div",Xn,[l(_,{type:"default",onClick:e.onOpenDeviceList,title:"打开设备列表"},{default:i(()=>[l(t,null,{default:i(()=>[l(d(ts))]),_:1}),f[4]||(f[4]=n("span",{class:"ml-1"},"设备列表",-1))]),_:1},8,["onClick"])])):ie("",!0),e.playlistStatus?(m(),A("div",Zn,[n("div",ea,[n("div",ta,[f[5]||(f[5]=n("h4",{class:"text-sm font-semibold"},"定时任务 (Cron)",-1)),l(D,{"model-value":e.playlistStatus.schedule?.enabled===1,onChange:f[0]||(f[0]=j=>e.onToggleCronEnabled(j)),"active-text":"开启","inactive-text":"关闭"},null,8,["model-value"])]),n("div",la,[n("div",null,[f[7]||(f[7]=n("div",{class:"text-xs text-gray-600 mb-1"},"Cron 表达式",-1)),n("div",sa,[l(te,{"model-value":e.playlistStatus.schedule?.cron||"",onInput:f[1]||(f[1]=j=>e.onUpdateCron(j)),placeholder:"例如: 0 0 * * *",size:"small",disabled:e.playlistStatus.schedule?.enabled!==1},null,8,["model-value","disabled"]),l(_,{type:"info",size:"small",onClick:e.onOpenCronBuilder,disabled:e.playlistStatus.schedule?.enabled!==1},{default:i(()=>[...f[6]||(f[6]=[J(" 助手 ",-1)])]),_:1},8,["onClick","disabled"])])]),n("div",na,[n("div",aa,[f[8]||(f[8]=n("div",{class:"text-xs text-gray-600 mb-1"},"持续时间（分钟）",-1)),l(M,{"model-value":e.playlistStatus.schedule?.duration||0,onChange:e.onUpdateDuration,min:0,max:d(In),step:1,size:"small",disabled:e.playlistStatus.schedule?.enabled!==1,class:"w-full"},null,8,["model-value","onChange","max","disabled"]),f[9]||(f[9]=n("div",{class:"text-xs text-gray-500 mt-1"},"0表示不自动停止",-1))]),n("div",ia,[f[10]||(f[10]=n("div",{class:"text-xs text-gray-600 mb-1"},"触发按钮",-1)),l(L,{"model-value":e.playlistStatus.trigger_button||"",onChange:e.onUpdateTriggerButton,placeholder:"选择触发按钮",size:"small",class:"w-full",clearable:""},{default:i(()=>[l(z,{label:"空",value:d(st).NONE},null,8,["value"]),l(z,{label:"按钮对-1",value:d(st).BUTTON_1},null,8,["value"]),l(z,{label:"按钮对-2",value:d(st).BUTTON_2},null,8,["value"]),l(z,{label:"按钮对-3",value:d(st).BUTTON_3},null,8,["value"])]),_:1},8,["model-value","onChange"])])]),e.playlistStatus.schedule?.cron&&e.playlistStatus.schedule?.enabled===1?(m(),A("div",oa,[l(_,{type:"success",size:"small",onClick:e.onPreviewCron,class:"w-full"},{default:i(()=>[...f[11]||(f[11]=[J(" 预览执行时间 ",-1)])]),_:1},8,["onClick"])])):ie("",!0)])]),n("div",ra,[f[19]||(f[19]=n("h4",{class:"text-sm font-semibold mb-2"},"设备配置",-1)),n("div",da,[n("div",null,[f[12]||(f[12]=n("div",{class:"text-xs text-gray-600 mb-1"},"设备类型",-1)),l(L,{"model-value":u.value,onChange:e.onUpdateDeviceType,placeholder:"选择设备类型",size:"small",class:"w-full"},{default:i(()=>[l(z,{label:"蓝牙",value:"bluetooth"}),l(z,{label:"DLNA",value:"dlna"}),l(z,{label:"设备代理",value:"agent"}),l(z,{label:"小米设备",value:"mi"})]),_:1},8,["model-value","onChange"])]),n("div",null,[n("div",ua,[f[13]||(f[13]=n("span",null,"设备地址",-1)),e.playlistStatus.device?.name?(m(),A("span",ca,W(e.playlistStatus.device.name),1)):ie("",!0)]),n("div",fa,[l(te,{"model-value":v.value,onInput:f[2]||(f[2]=j=>e.onUpdateDeviceAddress(j)),placeholder:"设备地址",size:"small",class:"flex-1"},null,8,["model-value"]),l(_,{size:"small",type:"danger",plain:"",onClick:f[3]||(f[3]=j=>e.onUpdateDeviceAddress("")),disabled:!v.value,title:"清空设备地址"},{default:i(()=>[...f[14]||(f[14]=[J(" 清空 ",-1)])]),_:1},8,["disabled"])])])]),n("div",va,[n("div",ma,[n("h5",ga,W(h.value),1),u.value?(m(),ae(_,{key:0,size:"small",type:"primary",plain:"",onClick:G,loading:B.value,disabled:B.value,title:a.value},{default:i(()=>[B.value?ie("",!0):(m(),ae(t,{key:0},{default:i(()=>[l(d(Ve))]),_:1})),f[15]||(f[15]=n("span",{class:"ml-1"},"扫描设备",-1))]),_:1},8,["loading","disabled","title"])):ie("",!0)]),r.value?(m(),A("div",pa,[ye((m(),A("div",ya,[(m(!0),A(De,null,Be(e.connectedDeviceList,j=>(m(),A("div",{key:j.address,class:"flex items-center gap-2 p-2 border rounded hover:bg-gray-50"},[n("div",ha,[n("div",ba,W(j.name),1),n("div",xa,W(j.address),1)]),n("div",wa,[l(_,{size:"small",type:"primary",onClick:re=>u.value==="agent"?e.onSelectAgentDevice(j):e.onSelectBluetoothDevice(j.address),disabled:j.address===v.value},{default:i(()=>[...f[16]||(f[16]=[J(" 选择 ",-1)])]),_:1},8,["onClick","disabled"])])]))),128)),e.connectedDeviceList.length===0?(m(),A("div",Da," 暂无设备 ")):ie("",!0)])),[[ee,e.loading]])])):d(s)?(m(),A("div",$a,[ye((m(),A("div",Ca,[(m(!0),A(De,null,Be(e.dlnaDeviceList,j=>(m(),A("div",{key:j.location,class:"flex items-center gap-2 p-2 border rounded hover:bg-gray-50"},[n("div",Fa,[n("div",ka,W(j.name),1),n("div",{class:"text-xs text-gray-500 truncate",title:j.location},W(j.location),9,Pa)]),n("div",_a,[l(_,{size:"small",type:"primary",onClick:re=>e.onUpdateDeviceAddress(j.location||j.address||"",j.name),disabled:(j.location||j.address)===v.value},{default:i(()=>[...f[17]||(f[17]=[J(" 选择 ",-1)])]),_:1},8,["onClick","disabled"])])]))),128)),e.dlnaDeviceList.length===0&&!e.dlnaScanning?(m(),A("div",Sa,' 暂无设备，点击"扫描设备"开始扫描 ')):ie("",!0)])),[[ee,e.dlnaScanning]])])):d(c)?(m(),A("div",Ba,[ye((m(),A("div",Aa,[(m(!0),A(De,null,Be(e.miDeviceList,j=>(m(),A("div",{key:j.deviceID||j.address,class:"flex items-center gap-2 p-2 border rounded hover:bg-gray-50"},[n("div",Ta,[n("div",Ma,W(j.name),1),n("div",{class:"text-xs text-gray-500 truncate",title:j.deviceID||j.address},W(j.deviceID||j.address),9,Ea)]),n("div",La,[l(_,{size:"small",type:"primary",onClick:re=>e.onSelectMiDevice(j),disabled:(j.deviceID||j.address)===v.value},{default:i(()=>[...f[18]||(f[18]=[J(" 选择 ",-1)])]),_:1},8,["onClick","disabled"])])]))),128)),e.miDeviceList.length===0&&!e.miScanning?(m(),A("div",Na,' 暂无设备，点击"扫描设备"开始扫描 ')):ie("",!0)])),[[ee,e.miScanning]])])):ie("",!0)])])])):(m(),A("div",Ua," 请先选择一个播放列表 "))])}}}),Oa={class:"mb-4"},Va={key:0,class:"text-center text-gray-400 mt-4 py-8"},Ra=Ee({__name:"ScanDeviceDialog",props:{visible:{type:Boolean},deviceList:{},loading:{type:Boolean}},emits:["update:visible","refresh","connect","close"],setup(e,{emit:P}){const u=P,v=s=>{u("update:visible",s),s||u("close")},T=()=>{u("refresh")},r=s=>{u("connect",s)};return(s,c)=>{const h=Ne,a=Vt,B=Ot,G=qe,O=xt;return m(),ae(G,{"model-value":e.visible,"onUpdate:modelValue":v,title:"扫描到的设备",width:"800"},{default:i(()=>[n("div",Oa,[l(h,{type:"primary",onClick:T,loading:e.loading},{default:i(()=>[...c[0]||(c[0]=[J("刷新扫描",-1)])]),_:1},8,["loading"])]),ye((m(),ae(B,{data:e.deviceList,stripe:"",class:"w-full",height:400},{default:i(()=>[l(a,{prop:"name",label:"设备名称","min-width":"150"}),l(a,{prop:"address",label:"地址","min-width":"120"}),l(a,{prop:"rssi",label:"信号强度",width:"100"},{default:i(({row:f})=>[n("span",null,W(f.rssi)+" dBm",1)]),_:1}),l(a,{label:"操作",width:"100"},{default:i(({row:f})=>[l(h,{size:"small",type:"primary",onClick:t=>r(f),loading:f.connecting,disabled:f.connecting},{default:i(()=>[...c[1]||(c[1]=[J(" 连接 ",-1)])]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1},8,["data"])),[[O,e.loading]]),e.deviceList.length===0&&!e.loading?(m(),A("div",Va,' 暂无扫描到的设备，点击"刷新扫描"按钮开始扫描 ')):ie("",!0)]),_:1},8,["model-value"])}}}),Wa={class:"flex flex-col gap-4 h-full overflow-y-auto"},ja={class:"flex items-center justify-between mb-2"},Ya={class:"flex items-center gap-2"},Ga={class:"flex flex-col gap-1"},Ha={class:"text-sm flex items-start"},Ka={class:"text-gray-800"},Ia={class:"text-sm flex items-start"},Ja={class:"text-gray-800"},Qa={key:0,class:"text-gray-400"},qa={class:"flex flex-col items-center gap-1"},Xa={class:"text-xs text-gray-500"},Za={class:"flex flex-col gap-1"},ei={class:"text-[12px] mr-1 !w-4"},ti={class:"flex items-center justify-between mb-2"},li={class:"flex items-center gap-2"},si={class:"flex flex-col gap-1"},ni={class:"text-sm flex items-start"},ai={class:"text-gray-800"},ii={class:"text-sm flex items-start"},oi={class:"text-gray-800 w-40"},ri={class:"text-gray-800 w-40"},di={class:"flex flex-col gap-2"},ui={class:"flex items-center gap-2"},ci={class:"text-gray-800 w-5"},fi={key:1},vi={class:"flex items-center gap-2"},mi={class:"flex items-center justify-between mb-2"},gi={class:"flex items-center gap-2"},pi={class:"flex flex-col gap-1"},yi={class:"text-sm flex items-start"},hi=["title"],bi={key:0,class:"text-sm flex items-start"},xi={class:"text-gray-800"},wi={class:"flex flex-col gap-2"},Di={class:"flex items-center gap-2"},$i={class:"text-gray-800 w-5"},Ci={key:1},Fi={class:"flex items-center gap-2"},ki=Ee({__name:"DevicesDrawer",props:{visible:{type:Boolean,default:!1}},emits:["update:visible"],setup(e,{emit:P}){const u=e,v=P,T=H(u.visible),r=H([]),s=H(!1),c=H([]),h=H(!1),a=H([]),B=H(!1);let G=null;const O=[{label:"B1",keys:["F13","F14"]},{label:"B2",keys:["F15","F16"]},{label:"B3",keys:["F17","F18"]}],f=async(g=!0,o=!1)=>{try{g&&(B.value=!0);const F=(await _e.get("/agent/list")).data;F?.code===0?(a.value=F.data||[],o&&E.success(`已获取 ${a.value.length} 个 Agent 设备`)):((o||g)&&E.error(F?.msg||"获取设备列表失败"),a.value=[])}catch(k){console.error("获取Agent设备列表失败:",k),(o||g)&&ne(k,"获取设备列表失败"),a.value=[]}finally{g&&(B.value=!1)}},t=async(g,o)=>{const k=a.value.find(le=>le.agent_id===g);if(!k){E.error("设备不存在");return}const F=`testing_${o}`,K=k;K[F]=!0;try{const de=(await _e.post("/agent/mock",{agent_id:g,action:"keyboard",key:o,value:"test"})).data;de?.code===0?E.success(`测试按钮 ${o} 成功`):E.error(de?.msg||`测试按钮 ${o} 失败`)}catch(le){ne(le,`测试按钮 ${o} 失败`)}finally{K[F]=!1}},_=()=>{f(!0,!1),D(),G=setInterval(()=>{f(!1,!1)},Hn)},D=()=>{G&&(clearInterval(G),G=null)},te=()=>f(!0,!1),M=(g,o)=>t(g,o),z=g=>g.deviceID||g.address||"",L=g=>Math.max(0,Math.min(100,g)),ee=g=>({...g,volume:void 0,_volumeChanging:!1,_volumeRefreshing:!1}),j=async()=>{try{s.value=!0;const o=(await _e.get("/mi/scan",{params:{timeout:Pt}})).data;if(o?.code===0){const k=(o.data||[]).map(F=>ee(F));r.value=k,await Promise.allSettled(k.map(F=>re(F))),E.success(`扫描到 ${k.length} 个小米设备`)}else E.error(o?.msg||"扫描小米设备失败")}catch(g){ne(g,"扫描小米设备失败")}finally{s.value=!1}},re=async g=>{const o=z(g);if(!o)return;const k=r.value.find(F=>z(F)===o);if(k){k._volumeRefreshing=!0;try{const K=(await _e.get("/mi/volume",{params:{device_id:o}})).data;if(K?.code===0)k.volume=K.data?.volume??K.data??void 0;else{const le=k.name||o;E.error(K?.msg||`获取设备 ${le} 音量失败`)}}catch(F){const K=k.name||o;ne(F,`获取设备 ${K} 音量失败`)}finally{k._volumeRefreshing=!1}}},U=async(g,o)=>{const k=z(g);if(!k){E.error("设备ID无效");return}const F=L(o);g._volumeChanging=!0;try{const le=(await _e.post("/mi/volume",{device_id:k,volume:F})).data;le?.code===0?(g.volume=F,E.success("音量设置成功")):E.error(le?.msg||"设置音量失败")}catch(K){ne(K,"设置小米设备音量失败")}finally{g._volumeChanging=!1}},x=async g=>{const o=z(g);if(!o){E.warning("设备ID无效");return}try{g._stopping=!0;const F=(await _e.post("/mi/stop",{device_id:o})).data;F?.code===0?E.success("停止播放成功"):E.error(F?.msg||"停止播放失败")}catch(k){ne(k,"停止小米设备播放失败")}finally{g._stopping=!1}},$=g=>g.location||g.address||"",p=g=>({...g,volume:void 0,_volumeChanging:!1,_volumeRefreshing:!1}),S=async()=>{try{h.value=!0;const o=(await _e.get("/dlna/scan",{params:{timeout:Pt}})).data;if(o?.code===0){const k=(o.data||[]).map(F=>p(F));c.value=k,await Promise.allSettled(k.map(F=>C(F))),E.success(`扫描到 ${k.length} 个 DLNA 设备`)}else E.error(o?.msg||"扫描 DLNA 设备失败")}catch(g){ne(g,"扫描 DLNA 设备失败")}finally{h.value=!1}},C=async g=>{const o=$(g);if(!o)return;const k=c.value.find(F=>$(F)===o);if(k){k._volumeRefreshing=!0;try{const K=(await _e.get("/dlna/volume",{params:{location:o}})).data;if(K?.code===0)k.volume=K.data?.volume??K.data??void 0;else{const le=k.name||o;E.error(K?.msg||`获取设备 ${le} 音量失败`)}}catch(F){const K=k.name||o;ne(F,`获取设备 ${K} 音量失败`)}finally{k._volumeRefreshing=!1}}},q=async(g,o)=>{const k=$(g);if(!k){E.error("设备位置无效");return}const F=L(o);g._volumeChanging=!0;try{const le=(await _e.post("/dlna/volume",{location:k,volume:F})).data;le?.code===0?(g.volume=F,E.success("音量设置成功")):E.error(le?.msg||"设置音量失败")}catch(K){ne(K,"设置 DLNA 设备音量失败")}finally{g._volumeChanging=!1}},me=async g=>{const o=$(g);if(!o){E.warning("设备位置无效");return}try{g._stopping=!0;const F=(await _e.post("/dlna/stop",{location:o})).data;F?.code===0?E.success("停止播放成功"):E.error(F?.msg||"停止播放失败")}catch(k){ne(k,"停止 DLNA 设备播放失败")}finally{g._stopping=!1}},y=()=>{T.value=!1};return Le(()=>u.visible,g=>{T.value=g,g?_():D()},{immediate:!0}),Le(T,g=>{g!==u.visible&&v("update:visible",g)}),it(()=>{u.visible&&_()}),Mt(()=>{D()}),(g,o)=>{const k=Ye,F=Ne,K=Vt,le=bt,de=Ot,Me=vs,Ce=Rt,he=xt;return m(),ae(Ce,{modelValue:T.value,"onUpdate:modelValue":o[0]||(o[0]=R=>T.value=R),size:1200,direction:"rtl","before-close":y,title:"设备管理","header-class":"h-12 !mb-1"},{default:i(()=>[n("div",Wa,[n("div",null,[n("div",ja,[n("div",Ya,[o[2]||(o[2]=n("h4",{class:"text-base font-semibold w-24"},"Agent设备",-1)),l(F,{type:"primary",plain:"",size:"small",onClick:te,loading:B.value},{default:i(()=>[B.value?ie("",!0):(m(),ae(k,{key:0},{default:i(()=>[l(d(Ve))]),_:1})),o[1]||(o[1]=n("span",{class:"ml-1"},"刷新",-1))]),_:1},8,["loading"])])]),ye((m(),ae(de,{data:a.value,stripe:"",class:"w-full",height:200},{empty:i(()=>[...o[5]||(o[5]=[n("div",{class:"text-center text-gray-400 py-8"},"暂无设备，请等待设备注册",-1)])]),default:i(()=>[l(K,{prop:"name",label:"设备名称","min-width":"150"}),l(K,{label:"详情","min-width":"250"},{default:i(({row:R})=>[n("div",Ga,[n("div",Ha,[o[3]||(o[3]=n("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"地址：",-1)),n("span",Ka,W(R.address),1)]),n("div",Ia,[o[4]||(o[4]=n("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"ID：",-1)),n("span",Ja,W(R.agent_id),1)])])]),_:1}),l(K,{label:"支持的操作","min-width":"100"},{default:i(({row:R})=>[(m(!0),A(De,null,Be(R.actions,b=>(m(),ae(le,{key:b,size:"small",type:"info",class:"mr-1"},{default:i(()=>[J(W(b),1)]),_:2},1024))),128)),!R.actions||R.actions.length===0?(m(),A("span",Qa,"无")):ie("",!0)]),_:1}),l(K,{label:"状态/心跳",width:"90"},{default:i(({row:R})=>[n("div",qa,[l(le,{type:R.is_online?"success":"danger",size:"small"},{default:i(()=>[J(W(R.is_online?"在线":"离线"),1)]),_:2},1032,["type"]),n("span",Xa,W(R.last_heartbeat_ago)+"秒前 ",1)])]),_:1}),l(K,{label:"测试按钮",width:"180"},{default:i(({row:R})=>[n("div",Za,[(m(),A(De,null,Be(O,(b,Y)=>n("div",{key:Y,class:"flex gap-1 items-center"},[l(k,{class:"!w-4 !h-5"},{default:i(()=>[l(d(Bt))]),_:1}),n("span",ei,W(b.label),1),(m(!0),A(De,null,Be(b.keys,(N,X)=>(m(),ae(F,{key:X,size:"small",type:"primary",plain:"",onClick:Z=>M(R.agent_id,N),loading:R[`testing_${N}`],class:"flex-1"},{default:i(()=>[J(W(N),1)]),_:2},1032,["onClick","loading"]))),128))])),64))])]),_:1})]),_:1},8,["data"])),[[he,B.value]])]),n("div",null,[n("div",ti,[n("div",li,[o[7]||(o[7]=n("h4",{class:"text-base font-semibold w-24"},"小米设备",-1)),l(F,{type:"primary",plain:"",size:"small",onClick:j,loading:s.value},{default:i(()=>[s.value?ie("",!0):(m(),ae(k,{key:0},{default:i(()=>[l(d(Ve))]),_:1})),o[6]||(o[6]=n("span",{class:"ml-1"},"扫描",-1))]),_:1},8,["loading"])])]),ye((m(),ae(de,{data:r.value,stripe:"",class:"w-full",height:280},{empty:i(()=>[...o[12]||(o[12]=[n("div",{class:"text-center text-gray-400 py-8"},'暂无设备，点击"扫描设备"开始扫描',-1)])]),default:i(()=>[l(K,{prop:"name",label:"设备名称","min-width":"150"}),l(K,{label:"详情","min-width":"400"},{default:i(({row:R})=>[n("div",si,[n("div",ni,[o[8]||(o[8]=n("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"ID：",-1)),n("span",ai,W(R.deviceID||"-"),1)]),n("div",ii,[o[9]||(o[9]=n("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"地址：",-1)),n("span",oi,W(R.mac||"-"),1),o[10]||(o[10]=n("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"DTD：",-1)),n("span",ri,W(R.miotDID||"-"),1)])])]),_:1}),l(K,{label:"功能","min-width":"200"},{default:i(({row:R})=>[n("div",di,[n("div",ui,[o[11]||(o[11]=n("span",{class:"text-gray-600 inline-block w-11 flex-shrink-0"},"音量：",-1)),n("span",ci,W(R.volume!==void 0?R.volume:"-"),1),l(F,{size:"small",type:"info",plain:"",circle:"",onClick:b=>re(R),loading:R._volumeRefreshing,disabled:R._volumeRefreshing||R._volumeChanging,title:"刷新音量",class:"p-0.5 !w-[17px] !h-[17px]"},{default:i(()=>[R._volumeRefreshing?ie("",!0):(m(),ae(k,{key:0},{default:i(()=>[l(d(Ve))]),_:1}))]),_:2},1032,["onClick","loading","disabled"]),l(F,{size:"small",class:"!w-8 !h-6",type:"danger",plain:"",onClick:b=>x(R),disabled:R._stopping,title:"停止播放"},{default:i(()=>[R._stopping?(m(),ae(k,{key:0,class:"animate-spin"},{default:i(()=>[l(d(He))]),_:1})):(m(),A("span",fi,"⏹"))]),_:2},1032,["onClick","disabled"])]),n("div",vi,[l(Me,{"model-value":R.volume??0,onInput:b=>R.volume=b,onChange:b=>U(R,b),min:5,max:100,step:1,disabled:R._volumeChanging||R._volumeRefreshing||R.volume===void 0,size:"small",class:"flex-1 max-w-[200px]"},null,8,["model-value","onInput","onChange","disabled"])])])]),_:1})]),_:1},8,["data"])),[[he,s.value]])]),n("div",null,[n("div",mi,[n("div",gi,[o[14]||(o[14]=n("h4",{class:"text-base font-semibold w-24"},"DLNA设备",-1)),l(F,{type:"primary",plain:"",size:"small",onClick:S,loading:h.value},{default:i(()=>[h.value?ie("",!0):(m(),ae(k,{key:0},{default:i(()=>[l(d(Ve))]),_:1})),o[13]||(o[13]=n("span",{class:"ml-1"},"扫描",-1))]),_:1},8,["loading"])])]),ye((m(),ae(de,{data:c.value,stripe:"",class:"w-full",height:280},{empty:i(()=>[...o[18]||(o[18]=[n("div",{class:"text-center text-gray-400 py-8"},'暂无设备，点击"扫描设备"开始扫描',-1)])]),default:i(()=>[l(K,{prop:"name",label:"设备名称","min-width":"150"}),l(K,{label:"详情","min-width":"400"},{default:i(({row:R})=>[n("div",pi,[n("div",yi,[o[15]||(o[15]=n("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"位置：",-1)),n("span",{class:"text-gray-800 flex-1 truncate",title:R.location},W(R.location||"-"),9,hi)]),R.manufacturer||R.model_name?(m(),A("div",bi,[o[16]||(o[16]=n("span",{class:"text-gray-600 inline-block w-12 flex-shrink-0"},"型号：",-1)),n("span",xi,W(R.manufacturer||"")+" "+W(R.model_name||""),1)])):ie("",!0)])]),_:1}),l(K,{label:"功能","min-width":"200"},{default:i(({row:R})=>[n("div",wi,[n("div",Di,[o[17]||(o[17]=n("span",{class:"text-gray-600 inline-block w-11 flex-shrink-0"},"音量：",-1)),n("span",$i,W(R.volume!==void 0?R.volume:"-"),1),l(F,{size:"small",type:"info",plain:"",circle:"",onClick:b=>C(R),loading:R._volumeRefreshing,disabled:R._volumeRefreshing||R._volumeChanging,title:"刷新音量",class:"p-0.5 !w-[17px] !h-[17px]"},{default:i(()=>[R._volumeRefreshing?ie("",!0):(m(),ae(k,{key:0},{default:i(()=>[l(d(Ve))]),_:1}))]),_:2},1032,["onClick","loading","disabled"]),l(F,{size:"small",class:"!w-8 !h-6",type:"danger",plain:"",onClick:b=>me(R),disabled:R._stopping,title:"停止播放"},{default:i(()=>[R._stopping?(m(),ae(k,{key:0,class:"animate-spin"},{default:i(()=>[l(d(He))]),_:1})):(m(),A("span",Ci,"⏹"))]),_:2},1032,["onClick","disabled"])]),n("div",Fi,[l(Me,{"model-value":R.volume??0,onInput:b=>R.volume=b,onChange:b=>q(R,b),min:5,max:100,step:1,disabled:R._volumeChanging||R._volumeRefreshing||R.volume===void 0,size:"small",class:"flex-1 max-w-[200px]"},null,8,["model-value","onInput","onChange","disabled"])])])]),_:1})]),_:1},8,["data"])),[[he,h.value]])])])]),_:1},8,["modelValue"])}}}),Pi={class:"flex gap-4 h-[500px]"},_i={class:"w-64 flex flex-col border rounded p-3"},Si={class:"flex-1 overflow-y-auto space-y-2"},Bi=["onClick"],Ai={class:"text-sm flex-1 truncate"},Ti={class:"text-xs text-gray-500 ml-2 whitespace-nowrap"},Mi={key:0,class:"text-blue-600 font-medium"},Ei={key:1},Li={key:0,class:"text-xs text-gray-400 text-center py-2"},Ni={class:"flex-1 flex flex-col border rounded p-3"},Ui={key:0,class:"flex-1 overflow-y-auto"},zi={class:"mb-3"},Oi={class:"space-y-1"},Vi=["onClick"],Ri={class:"text-xs text-gray-500 whitespace-nowrap"},Wi={key:0,class:"text-blue-600 font-medium"},ji={key:1},Yi={class:"border-t pt-3"},Gi={class:"flex items-center gap-2 py-1"},Hi={class:"text-xs text-gray-500 whitespace-nowrap"},Ki={key:0,class:"text-blue-600 font-medium"},Ii={key:1},Ji={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},Qi={class:"flex items-center justify-between"},qi={class:"text-sm text-gray-500"},Xi={key:0},Zi={class:"flex gap-2"},eo=Ee({__name:"PlaylistSelectDialog",props:{visible:{type:Boolean,default:!1},playlistCollection:{default:()=>[]},selectedFiles:{default:()=>[]},onCopy:{type:Function,default:void 0},onRemove:{type:Function,default:void 0}},emits:["update:visible"],setup(e,{emit:P}){const u=e,v=P,T=H(u.visible),r=H(null),s=H([]),c=H(!1),h=ve(()=>u.playlistCollection.find(U=>U.id===r.value)||null),a=ve(()=>s.value.length>0||c.value),B=U=>{const x=h.value;if(!x||!x.pre_lists||!Array.isArray(x.pre_lists)||x.pre_lists.length!==7)return 0;const $=x.pre_lists[U];return Array.isArray($)?$.length:0},G=()=>{const U=h.value;return!U||!U.playlist?0:Array.isArray(U.playlist)?U.playlist.length:0},O=U=>{if(!U)return 0;const x=U.pre_lists&&Array.isArray(U.pre_lists)&&U.pre_lists.length===7?U.pre_lists.reduce((p,S)=>p+(Array.isArray(S)?S.length:0),0):0,$=Array.isArray(U.playlist)?U.playlist.length:0;return x+$},f=()=>!u.selectedFiles||u.selectedFiles.length===0?new Set:new Set(u.selectedFiles.map(U=>typeof U=="string"?U:U.uri||String(U))),t=U=>{if(!U||!u.selectedFiles||u.selectedFiles.length===0)return 0;const x=f();let $=0;return U.pre_lists&&Array.isArray(U.pre_lists)&&U.pre_lists.length===7&&U.pre_lists.forEach(p=>{Array.isArray(p)&&p.forEach(S=>{const C=S.uri||String(S);x.has(C)&&$++})}),Array.isArray(U.playlist)&&U.playlist.forEach(p=>{const S=p.uri||String(p);x.has(S)&&$++}),$},_=U=>{const x=h.value;if(!x||!u.selectedFiles||u.selectedFiles.length===0||!x.pre_lists||!Array.isArray(x.pre_lists)||x.pre_lists.length!==7)return 0;const $=x.pre_lists[U];if(!Array.isArray($))return 0;const p=f();let S=0;return $.forEach(C=>{const q=C.uri||String(C);p.has(q)&&S++}),S},D=()=>{const U=h.value;if(!U||!u.selectedFiles||u.selectedFiles.length===0||!Array.isArray(U.playlist))return 0;const x=f();let $=0;return U.playlist.forEach(p=>{const S=p.uri||String(p);x.has(S)&&$++}),$},te=U=>{r.value=U,s.value=[],c.value=!1},M=U=>{const x=s.value.indexOf(U);x>-1?s.value.splice(x,1):s.value.push(U)},z=()=>{c.value=!c.value},L=async()=>{if(!h.value||!u.selectedFiles||u.selectedFiles.length===0||!a.value){E.warning("请选择播放列表和目标列表，并至少选中一个文件");return}try{const U=u.selectedFiles.map(S=>typeof S=="string"?S:S.uri||String(S)),x=s.value.length,$=c.value;let p="";if(x>0&&$)p=`${x}个前置文件列表和正式文件列表`;else if(x>0){const S=["周一","周二","周三","周四","周五","周六","周日"];p=`前置文件列表（${s.value.map(q=>S[q]).join("、")}）`}else $&&(p="正式文件列表");await Se.confirm(`确定要将选中的 ${U.length} 个文件复制到播放列表"${h.value.name}"的${p}吗？`,"确认复制",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),u.onCopy&&(await u.onCopy({playlistId:r.value,files:U,preLists:s.value,filesList:c.value}),E.success("文件已复制到播放列表"),j())}catch(U){U!=="cancel"&&ne(U,"复制文件失败")}},ee=async()=>{if(!h.value||!u.selectedFiles||u.selectedFiles.length===0||!a.value){E.warning("请选择播放列表和目标列表，并至少选中一个文件");return}try{const U=u.selectedFiles.map(S=>typeof S=="string"?S:S.uri||String(S)),x=s.value.length,$=c.value;let p="";if(x>0&&$)p=`${x}个前置文件列表和正式文件列表`;else if(x>0){const S=["周一","周二","周三","周四","周五","周六","周日"];p=`前置文件列表（${s.value.map(q=>S[q]).join("、")}）`}else $&&(p="正式文件列表");await Se.confirm(`确定要从播放列表"${h.value.name}"的${p}中删除选中的 ${U.length} 个文件吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),u.onRemove&&(await u.onRemove({playlistId:r.value,files:U,preLists:s.value,filesList:c.value}),E.success("文件已从播放列表删除"),j())}catch(U){U!=="cancel"&&ne(U,"删除文件失败")}},j=()=>{T.value=!1,r.value=null,s.value=[],c.value=!1},re=()=>{u.playlistCollection&&u.playlistCollection.length>0&&!r.value&&(r.value=u.playlistCollection[0].id)};return Le(()=>u.playlistCollection,U=>{U&&U.length>0&&!r.value&&(r.value=U[0].id)},{immediate:!0}),Le(()=>u.visible,U=>{T.value=U,U&&re()}),Le(T,U=>{U!==u.visible&&v("update:visible",U)}),it(()=>{re()}),(U,x)=>{const $=ot,p=Ne,S=qe;return m(),ae(S,{modelValue:T.value,"onUpdate:modelValue":x[1]||(x[1]=C=>T.value=C),title:"应用到列表",width:"900","before-close":j},{footer:i(()=>[n("div",Qi,[n("div",qi,[e.selectedFiles&&e.selectedFiles.length>0?(m(),A("span",Xi," 已选择 "+W(e.selectedFiles.length)+" 个文件 ",1)):ie("",!0)]),n("div",Zi,[l(p,{onClick:j},{default:i(()=>[...x[7]||(x[7]=[J("取消",-1)])]),_:1}),l(p,{type:"primary",onClick:L,disabled:!a.value||!e.selectedFiles||e.selectedFiles.length===0},{default:i(()=>[...x[8]||(x[8]=[J(" 复制到列表 ",-1)])]),_:1},8,["disabled"]),l(p,{type:"danger",onClick:ee,disabled:!a.value||!e.selectedFiles||e.selectedFiles.length===0},{default:i(()=>[...x[9]||(x[9]=[J(" 从列表删除 ",-1)])]),_:1},8,["disabled"])])])]),default:i(()=>[n("div",Pi,[n("div",_i,[x[2]||(x[2]=n("div",{class:"text-sm font-semibold mb-2"},"选择播放列表",-1)),n("div",Si,[(m(!0),A(De,null,Be(e.playlistCollection,C=>(m(),A("div",{key:C.id,class:Ae(["flex items-center justify-between px-2 py-2 rounded cursor-pointer hover:bg-gray-50 transition-colors",{"bg-blue-50 border border-blue-200":C.id===r.value}]),onClick:q=>te(C.id)},[n("span",Ai,W(C.name),1),n("span",Ti,[e.selectedFiles&&e.selectedFiles.length>0?(m(),A("span",Mi,W(t(C))+"/"+W(O(C)),1)):(m(),A("span",Ei,W(O(C)),1))])],10,Bi))),128)),e.playlistCollection.length===0?(m(),A("div",Li," 暂无播放列表 ")):ie("",!0)])]),n("div",Ni,[x[6]||(x[6]=n("div",{class:"text-sm font-semibold mb-3"},"选择目标列表（可多选）",-1)),h.value?(m(),A("div",Ui,[n("div",zi,[x[4]||(x[4]=n("div",{class:"text-xs text-gray-600 mb-2 font-semibold"},"前置文件",-1)),n("div",Oi,[(m(),A(De,null,Be(["周一","周二","周三","周四","周五","周六","周日"],(C,q)=>n("div",{key:q,class:"flex items-center gap-2 py-1"},[l($,{"model-value":s.value.includes(q),onChange:me=>M(q),size:"small"},null,8,["model-value","onChange"]),n("span",{class:Ae(["text-xs flex-1 cursor-pointer hover:text-blue-500",{"text-blue-600 font-medium":s.value.includes(q)}]),onClick:me=>M(q)},W(C),11,Vi),n("span",Ri,[e.selectedFiles&&e.selectedFiles.length>0?(m(),A("span",Wi,W(_(q))+"/"+W(B(q)),1)):(m(),A("span",ji,W(B(q)),1)),x[3]||(x[3]=n("span",{class:"text-gray-400"}," 个文件",-1))])])),64))])]),n("div",Yi,[n("div",Gi,[l($,{"model-value":c.value,onChange:z,size:"small"},null,8,["model-value"]),n("span",{class:Ae(["text-xs font-semibold text-gray-600 cursor-pointer hover:text-blue-500 flex-1",{"text-blue-600":c.value}]),onClick:x[0]||(x[0]=C=>z())}," 正式文件 ",2),n("span",Hi,[e.selectedFiles&&e.selectedFiles.length>0?(m(),A("span",Ki,W(D())+"/"+W(G()),1)):(m(),A("span",Ii,W(G()),1)),x[5]||(x[5]=n("span",{class:"text-gray-400"}," 个文件",-1))])])])])):(m(),A("div",Ji," 请先选择一个播放列表 "))])])]),_:1},8,["modelValue"])}}}),to={class:"flex gap-4 h-full"},lo={class:"w-64 border rounded p-3 flex flex-col"},so={class:"flex items-center justify-between mb-3"},no={class:"flex-1 overflow-y-auto space-y-2"},ao=["onClick"],io={class:"text-sm font-medium truncate"},oo={class:"text-xs text-gray-500 mt-1"},ro={class:"flex items-center gap-1 flex-shrink-0"},uo={key:0,class:"text-sm text-gray-400 text-center py-4"},co={class:"flex-1 border rounded p-3 flex flex-col"},fo={class:"mb-3 flex items-center justify-between"},vo={class:"flex items-center gap-2"},mo={class:"text-base font-semibold"},go={key:0,class:"flex items-center gap-2"},po={key:0,class:"ml-1 text-xs"},yo={class:"flex-1 overflow-y-auto"},ho={key:0,class:"space-y-1"},bo=["onClick"],xo={class:"text-xs text-gray-500 w-8"},wo=["title"],Do={key:1,class:"text-sm text-gray-400 text-center py-8"},$o={class:"w-96 border rounded p-3 flex flex-col"},Co={class:"mb-3"},Fo={class:"flex gap-2 mb-3"},ko={class:"mb-3"},Po={class:"space-y-1 max-h-48 overflow-y-auto border rounded p-1"},_o=["onClick"],So={class:"text-sm flex-1"},Bo={class:"text-xs text-gray-500 ml-2 whitespace-nowrap"},Ao={key:0,class:"text-xs text-gray-400 text-center py-2"},To={key:0,class:"flex-1 overflow-y-auto space-y-3"},Mo={class:"border rounded p-2"},Eo={class:"space-y-1"},Lo=["onClick"],No={class:"text-xs text-gray-500 whitespace-nowrap"},Uo={class:"border rounded p-2"},zo={class:"flex items-center gap-2 mb-2"},Oo={class:"text-xs text-gray-500 whitespace-nowrap"},Vo={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},_t="t_batch_list",St="0",Ro=7,Wo=Ee({__name:"BatchDrawer",props:{visible:{type:Boolean,default:!1},playlistCollection:{default:()=>[]},onAddFiles:{type:Function,default:void 0},onRemoveFiles:{type:Function,default:void 0}},emits:["update:visible","refresh"],setup(e,{emit:P}){const u=e,v=P,T=H([]),r=H(null),s=H(null),c=H([]),h=H(!1),a=H([]),B=H(!1),G=H(!1),O=H(!1),f=H(u.visible),t=ve(()=>T.value.find(w=>w.id===r.value)||null),_=ve(()=>u.playlistCollection.find(w=>w.id===s.value)||null),D=ve(()=>c.value.length>0||h.value),te=ve(()=>!t.value||!t.value.files||t.value.files.length===0?!1:a.value.length===t.value.files.length),M=ve(()=>{if(!t.value||!t.value.files||t.value.files.length===0)return!1;const w=a.value.length,V=t.value.files.length;return w>0&&w<V}),z=w=>typeof w=="string"?w:w?.uri||String(w),L=()=>t.value?.files?a.value.map(w=>t.value.files[w]).filter(w=>w!==null):[],ee=()=>new Set(L().map(z)),j=w=>!!(w?.pre_lists&&Array.isArray(w.pre_lists)&&w.pre_lists.length===Ro),re=w=>!!(w?.playlist&&Array.isArray(w.playlist)),U=(w,V)=>{if(!Array.isArray(w))return 0;let I=0;return w.forEach(ue=>{V.has(z(ue))&&I++}),I},x=w=>{const V=_.value;if(!j(V))return 0;const I=V.pre_lists[w];return Array.isArray(I)?I.length:0},$=w=>{if(!t.value||!_.value)return 0;const V=ee();if(V.size===0)return 0;const I=_.value;if(!j(I))return 0;const ue=I.pre_lists[w];return U(ue,V)},p=()=>{const w=_.value;return re(w)?w.playlist.length:0},S=()=>{if(!t.value||!_.value)return 0;const w=ee();if(w.size===0)return 0;const V=_.value;return re(V)?U(V.playlist,w):0},C=w=>{if(!w)return 0;let V=0;return j(w)&&w.pre_lists.forEach(I=>{Array.isArray(I)&&(V+=I.length)}),re(w)&&(V+=w.playlist.length),V},q=w=>{if(!t.value||!w)return 0;const V=ee();if(V.size===0)return 0;let I=0;return j(w)&&w.pre_lists.forEach(ue=>{I+=U(ue,V)}),re(w)&&(I+=U(w.playlist,V)),I},me=async()=>{try{O.value=!0;const w=await gs(_t,St);let V=[];if(w!=null)if(typeof w=="string"&&w.trim()!=="")try{const I=JSON.parse(w);V=Array.isArray(I)?I:[]}catch{V=[]}else Array.isArray(w)&&(V=w);T.value=V,g()}catch(w){T.value=[],ne(w,"加载Batch列表失败")}finally{O.value=!1}},y=async()=>{try{const w=JSON.stringify(T.value);await ps(_t,St,w)}catch(w){throw ne(w,"保存Batch列表失败"),w}},g=()=>{if(T.value.length===0||r.value)return;const w=T.value[0];r.value=w.id,w?.files?.length>0&&(a.value=w.files.map((V,I)=>I))},o=(w,V)=>{const I=w.indexOf(V);I>-1?w.splice(I,1):w.push(V)},k=async()=>{try{const{value:w}=await Se.prompt("请输入Batch名称","创建Batch",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:"Batch名称",inputValidator:ue=>!!ue&&ue.trim().length>0||"名称不能为空"}),V=w.trim(),I={id:Date.now().toString(),name:V,files:[],createTime:new Date().toISOString()};T.value.push(I),await y(),E.success("Batch创建成功"),r.value=I.id}catch(w){w!=="cancel"&&ne(w,"创建Batch失败")}},F=async w=>{const V=T.value.find(I=>I.id===w);if(V)try{const{value:I}=await Se.prompt("请输入Batch名称","编辑Batch",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:V.name,inputPlaceholder:"Batch名称",inputValidator:ue=>!!ue&&ue.trim().length>0||"名称不能为空"});V.name=I.trim(),await y(),E.success("Batch名称已更新")}catch(I){I!=="cancel"&&ne(I,"编辑Batch失败")}},K=async w=>{const V=T.value.find(I=>I.id===w);if(V)try{await Se.confirm(`确定要删除Batch "${V.name}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const I=T.value.findIndex(ue=>ue.id===w);I>-1&&(T.value.splice(I,1),await y(),r.value===w&&(r.value=null),E.success("Batch已删除"))}catch(I){I!=="cancel"&&ne(I,"删除Batch失败")}},le=w=>{r.value=w;const V=T.value.find(I=>I.id===w);V&&V.files&&V.files.length>0?a.value=V.files.map((I,ue)=>ue):a.value=[]},de=w=>{o(a.value,w)},Me=w=>{!t.value||!t.value.files||(w?a.value=t.value.files.map((V,I)=>I):a.value=[])},Ce=async()=>{if(!(!t.value||a.value.length===0))try{const w=a.value.length;await Se.confirm(`确定要删除选中的 ${w} 个文件吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),[...new Set(a.value)].sort((I,ue)=>ue-I).forEach(I=>{I>=0&&I<t.value.files.length&&t.value.files.splice(I,1)}),t.value.files.length>0?a.value=t.value.files.map((I,ue)=>ue):a.value=[],await y(),E.success(`已删除 ${w} 个文件`)}catch(w){w!=="cancel"&&ne(w,"删除失败")}},he=()=>{if(!t.value){E.warning("请先选择一个Batch");return}B.value=!0},R=async w=>{if(!(!t.value||w.length===0))try{G.value=!0;const V=t.value,I=new Set(V.files.map(z)),ue=w.filter(Ue=>!I.has(Ue)).map(Ue=>({uri:Ue}));V.files.push(...ue),await y(),V.files.length>0&&(a.value=V.files.map((Ue,Ke)=>Ke)),E.success(`成功添加 ${ue.length} 个文件`),B.value=!1}catch(V){ne(V,"添加文件失败")}finally{G.value=!1}},b=()=>{B.value=!1},Y=w=>{s.value=s.value===w?null:w,c.value=[],h.value=!1},N=w=>{o(c.value,w)},X=w=>{h.value=w!==void 0?w:!h.value},Z=()=>!t.value||!s.value||a.value.length===0||!D.value?(E.warning("请选择Batch、播放列表和目标列表，并至少选中一个文件"),!1):!0,Q=async()=>{if(Z())try{const w=L().map(z);await Se.confirm(`确定要将选中的 ${w.length} 个文件添加到选中的列表吗？`,"确认添加",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),u.onAddFiles&&(await u.onAddFiles({playlistId:s.value,files:w,preLists:c.value,filesList:h.value}),E.success("文件已添加到播放列表"))}catch(w){w!=="cancel"&&ne(w,"添加文件失败")}},oe=async()=>{if(Z())try{const w=L().map(z);await Se.confirm(`确定要从选中的列表中删除选中的 ${w.length} 个文件吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),u.onRemoveFiles&&(await u.onRemoveFiles({playlistId:s.value,files:w,preLists:c.value,filesList:h.value}),E.success("文件已从播放列表删除"))}catch(w){w!=="cancel"&&ne(w,"删除文件失败")}},pe=()=>{f.value=!1},$e=()=>{c.value=[],h.value=!1,a.value=[]},Xe=()=>{r.value=null,s.value=null,$e()},rt=()=>{u.playlistCollection?.length>0?s.value=u.playlistCollection[0].id:s.value=null};return Le(()=>u.playlistCollection,w=>{w?.length>0&&!s.value&&(s.value=w[0].id)},{immediate:!0}),Le(()=>u.visible,w=>{f.value=w,w?($e(),rt(),me()):Xe()},{immediate:!0}),Le(f,w=>{w!==u.visible&&v("update:visible",w)}),it(()=>{me()}),(w,V)=>{const I=Ye,ue=Ne,Ue=ot,Ke=Rt;return m(),ae(Ke,{modelValue:f.value,"onUpdate:modelValue":V[5]||(V[5]=ge=>f.value=ge),title:"批量模式",size:1200,direction:"rtl","header-class":"h-12 !mb-1","before-close":pe},{default:i(()=>[n("div",to,[n("div",lo,[n("div",so,[V[6]||(V[6]=n("h3",{class:"text-base font-semibold"},"Batch列表",-1)),l(ue,{type:"primary",size:"small",onClick:k,plain:""},{default:i(()=>[l(I,null,{default:i(()=>[l(d(nt))]),_:1})]),_:1})]),n("div",no,[(m(!0),A(De,null,Be(T.value,ge=>(m(),A("div",{key:ge.id,class:Ae(["border rounded px-3 py-2 hover:bg-gray-50 flex items-center gap-2",{"border-blue-500 bg-blue-50":ge.id===r.value}])},[n("div",{class:"flex-1 cursor-pointer",onClick:ke=>le(ge.id)},[n("div",io,W(ge.name),1),n("div",oo,W(ge.files?ge.files.length:0)+" 个文件 ",1)],8,ao),n("div",ro,[l(ue,{type:"default",plain:"",size:"small",circle:"",onClick:we(ke=>K(ge.id),["stop"]),title:"删除"},{default:i(()=>[l(I,null,{default:i(()=>[l(d(ze))]),_:1})]),_:1},8,["onClick"])])],2))),128)),T.value.length===0?(m(),A("div",uo,' 暂无Batch，点击"+"创建 ')):ie("",!0)])]),n("div",co,[n("div",fo,[n("div",vo,[n("h3",mo,W(t.value?t.value.name:"请选择一个Batch"),1),t.value?(m(),ae(ue,{key:0,type:"default",plain:"",size:"small",circle:"",onClick:V[0]||(V[0]=ge=>F(t.value.id)),title:"编辑"},{default:i(()=>[l(I,null,{default:i(()=>[l(d(Tt))]),_:1})]),_:1})):ie("",!0)]),t.value?(m(),A("div",go,[l(ue,{type:"default",size:"small",onClick:V[1]||(V[1]=ge=>Me(!te.value)),class:Ae([{"!text-blue-600":te.value||M.value},"!w-20"]),plain:""},{default:i(()=>[te.value?(m(),ae(I,{key:0,class:"mr-1"},{default:i(()=>[l(d(Je))]),_:1})):M.value?(m(),ae(I,{key:1,class:"mr-1"},{default:i(()=>[l(d(pt))]),_:1})):ie("",!0),V[7]||(V[7]=n("span",{class:"text-xs"},"全选",-1))]),_:1},8,["class"]),l(ue,{type:"primary",size:"small",onClick:he,plain:"",class:"!w-20"},{default:i(()=>[l(I,null,{default:i(()=>[l(d(nt))]),_:1})]),_:1}),l(ue,{type:"danger",size:"small",onClick:Ce,disabled:a.value.length===0,plain:"",class:"!w-20"},{default:i(()=>[l(I,null,{default:i(()=>[l(d(ze))]),_:1}),a.value.length>0?(m(),A("span",po,"("+W(a.value.length)+")",1)):ie("",!0)]),_:1},8,["disabled"])])):ie("",!0)]),n("div",yo,[t.value&&t.value.files&&t.value.files.length>0?(m(),A("div",ho,[(m(!0),A(De,null,Be(t.value.files,(ge,ke)=>(m(),A("div",{key:ke,class:Ae(["flex items-center gap-2 p-2 border border-blue-500 rounded hover:bg-gray-50 cursor-pointer",{"bg-blue-50":a.value.includes(ke)}]),onClick:Ie=>de(ke)},[l(Ue,{"model-value":a.value.includes(ke),onChange:Ie=>de(ke),class:"!h-6",onClick:V[2]||(V[2]=we(()=>{},["stop"])),size:"default"},null,8,["model-value","onChange"]),n("span",xo,W(ke+1),1),n("span",{class:"flex-1 text-sm truncate",title:z(ge)},W(z(ge).split("/").pop()),9,wo)],10,bo))),128))])):(m(),A("div",Do,W(t.value?"该Batch暂无文件":"请先选择一个Batch"),1))])]),n("div",$o,[n("div",Co,[V[11]||(V[11]=n("h3",{class:"text-base font-semibold mb-2"},"Playlist操作",-1)),n("div",Fo,[l(ue,{type:"default",size:"small",onClick:Q,disabled:!t.value||!s.value||a.value.length===0||!D.value,plain:""},{default:i(()=>[l(I,{class:"mr-1"},{default:i(()=>[l(d(nt))]),_:1}),V[8]||(V[8]=J(" 添加到播放列表 ",-1))]),_:1},8,["disabled"]),l(ue,{type:"default",size:"small",onClick:oe,disabled:!t.value||!s.value||a.value.length===0||!D.value,plain:""},{default:i(()=>[l(I,{class:"mr-1"},{default:i(()=>[l(d(ze))]),_:1}),V[9]||(V[9]=J(" 从播放列表删除 ",-1))]),_:1},8,["disabled"])]),n("div",ko,[V[10]||(V[10]=n("div",{class:"text-xs text-gray-500 mb-2"},"选择播放列表 进行批量操作",-1)),n("div",Po,[(m(!0),A(De,null,Be(e.playlistCollection,ge=>(m(),A("div",{key:ge.id,class:Ae(["flex items-center justify-between px-2 py-1.5 rounded cursor-pointer hover:bg-gray-50 transition-colors",{"bg-blue-50 border border-blue-200":ge.id===s.value}]),onClick:ke=>Y(ge.id)},[n("span",So,W(ge.name),1),n("span",Bo,W(q(ge))+" / "+W(C(ge)),1)],10,_o))),128)),e.playlistCollection.length===0?(m(),A("div",Ao," 暂无播放列表 ")):ie("",!0)])])]),_.value?(m(),A("div",To,[n("div",Mo,[V[12]||(V[12]=n("div",{class:"text-xs font-semibold text-gray-600 mb-2"},"前置文件",-1)),n("div",Eo,[(m(),A(De,null,Be(["周一","周二","周三","周四","周五","周六","周日"],(ge,ke)=>n("div",{key:ke,class:"flex items-center gap-2"},[l(Ue,{"model-value":c.value.includes(ke),onChange:Ie=>N(ke),size:"small"},null,8,["model-value","onChange"]),n("span",{class:Ae(["text-xs flex-1 cursor-pointer hover:text-blue-500",{"text-blue-600 font-medium":c.value.includes(ke)}]),onClick:Ie=>N(ke)},W(ge),11,Lo),n("span",No,W($(ke))+" / "+W(x(ke)),1)])),64))])]),n("div",Uo,[n("div",zo,[l(Ue,{"model-value":h.value,onChange:X,size:"small"},null,8,["model-value"]),n("span",{class:Ae(["text-xs font-semibold text-gray-600 cursor-pointer hover:text-blue-500 flex-1",{"text-blue-600":h.value}]),onClick:V[3]||(V[3]=ge=>X())}," 正式文件 ",2),n("span",Oo,W(S())+" / "+W(p()),1)])])])):(m(),A("div",Vo," 请先选择一个播放列表 "))])]),l(Lt,{visible:B.value,"onUpdate:visible":V[4]||(V[4]=ge=>B.value=ge),title:"选择文件添加到Batch","confirm-button-text":"添加","confirm-loading":G.value,onConfirm:R,onClose:b},null,8,["visible","confirm-loading"])]),_:1},8,["modelValue"])}}});function jo(){return{...{playlistCollection:H([]),activePlaylistId:H(""),playlistStatus:H(null),playlistLoading:H(!1),playlistRefreshing:H(!1),playing:H(!1),stopping:H(!1),showMoreActions:H(!1),editingPlaylistId:H(null),editingPlaylistName:H(""),fileBrowserDialogVisible:H(!1),fileBrowserTarget:H("files"),replaceFileInfo:H(null),selectedWeekdayIndex:H(null),preFilesDragMode:H(!1),filesDragMode:H(!1),preFilesBatchDeleteMode:H(!1),filesBatchDeleteMode:H(!1),selectedPreFileIndices:H([]),selectedFileIndices:H([]),preFilesExpanded:H(!1),playlistSelectorVisible:H(!1),playlistSelectorSelectedFiles:H([]),batchDrawerVisible:H(!1),cronBuilderVisible:H(!1),cronPreviewVisible:H(!1),cronPreviewTimes:H([]),initialCronExpr:H(""),agentListDialogVisible:H(!1),scanDialogVisible:H(!1),loading:H(!1),deviceList:H([]),connectedDeviceList:H([]),dlnaDeviceList:H([]),dlnaScanning:H(!1),miDeviceList:H([]),miScanning:H(!1),pendingDeviceType:H(null),preFilesSortOrder:H(null),filesSortOrder:H(null),preFilesOriginalOrder:H(null),filesOriginalOrder:H(null)}}}async function Re(e,P,u={}){let v;return P==="GET"?v=await _e.get(`/playlist/${e}`,{params:u}):v=await _e.post(`/playlist/${e}`,u),v.data}function Yo(e,P,u,v,T,r,s,c){const h=y=>y.map(g=>({...g})),a=y=>{const g="playlist"in y&&Array.isArray(y.playlist)&&y.playlist||"files"in y&&Array.isArray(y.files)&&y.files||[];return h(tt(g,!0))},B=y=>{if(y.pre_lists&&Array.isArray(y.pre_lists)&&y.pre_lists.length===lt)return y.pre_lists.map(k=>h(tt(k||[],!0)));const g="pre_files"in y&&Array.isArray(y.pre_files)&&y.pre_files||[],o=h(tt(g,!0));return Array(lt).fill(null).map(()=>[...o])},G=y=>Jn.includes(y)?y:Qn,O=y=>({enabled:y?.enabled===1?1:0,cron:y?.cron?String(y.cron):"",duration:y?.duration||0}),f=(y,g)=>{if(typeof y=="number")return y;if(y==null)return g;const o=parseInt(String(y),10);return isNaN(o)?g:o},t=y=>y===!0||y===1,_=(y,g)=>{if(g===0)return 0;const o=f(y,0);return Math.max(0,Math.min(o,g-1))},D=()=>Array(lt).fill(null).map(()=>[]),te=y=>Array.isArray(y)&&y.length===lt&&y.every(g=>Array.isArray(g)),M=(y,g="播放列表")=>{const o=a(y),k=B(y),F=_(y?.current_index,o.length),K=y?.name&&String(y.name).trim()||g,le=G(y?.device?.type||y?.device_type),de=y?.device_address||y?.device?.address||null;return{id:y?.id||hs(),name:K,playlist:o,pre_lists:k,total:o.length,current_index:F,pre_index:f(y?.pre_index,-1),device_address:de,device_type:le,device:y?.device||{type:le,address:de,name:y?.device?.name||null},schedule:O(y?.schedule),trigger_button:y?.trigger_button||"",updatedAt:"updatedAt"in y&&typeof y.updatedAt=="number"?y.updatedAt:Date.now(),isPlaying:t(y?.isPlaying)}},z=y=>!Array.isArray(y)||y.length===0?[M({name:We})]:y.map((g,o)=>"playlist"in g&&"total"in g?g:M(g,g?.name||`播放列表${o+1}`)),L=y=>{if(y&&"playlists"in y&&Array.isArray(y.playlists)){const o=y,k=z(o.playlists),F=k.some(K=>K.id===o.activePlaylistId)?o.activePlaylistId:k[0]?.id||null;return{playlists:k,activePlaylistId:F}}if(y&&!Array.isArray(y)&&("playlist"in y||"files"in y)){const o=y,k="playlist"in o&&Array.isArray(o.playlist)&&o.playlist||"files"in o&&Array.isArray(o.files)&&o.files||[],F=M({id:o.id||o.playlist_id,name:o.name||We,files:k,current_index:o.current_index,device_address:o.device_address});return{playlists:[F],activePlaylistId:F.id}}const g=M({name:We});return{playlists:[g],activePlaylistId:g.id}},ee=y=>{if(!y)return null;if(!Array.isArray(y)&&Object.keys(y).length>0){const g=Object.values(y).map(o=>M(o,o.name||We));return{playlists:g,activePlaylistId:g[0]?.id||null}}if(Array.isArray(y)){const g=y.map(o=>M(o,o.name||We));return{playlists:g,activePlaylistId:g[0]?.id||null}}if(!Array.isArray(y)&&"id"in y&&typeof y.id=="string"){const g=y;return{playlists:[M(g,g.name||We)],activePlaylistId:g.id}}return null},j=y=>{const g={};return y.forEach(o=>{if(!o.id)return;const k=G(o.device?.type||o.device_type),F=tt(o.playlist||[],!0),K=B(o);g[o.id]={id:o.id,name:o.name||We,files:F,pre_lists:K,current_index:o.current_index||0,device:{address:o.device?.address||o.device_address||"",type:k,name:o.device?.name||null},schedule:o.schedule||{enabled:0,cron:"",duration:0},trigger_button:o.trigger_button||"",create_time:o.create_time||kt(),updated_time:kt()}}),g},re=async y=>{try{const g=(y||e.value||[]).map(F=>({...F,total:Array.isArray(F.playlist)?F.playlist.length:0,updatedAt:Date.now()})),o=j(g),k=await Re("updateAll","POST",o);if(k.code!==0)throw new Error(k.msg||"保存播放列表集合失败")}catch(g){ne(g,"保存播放列表集合失败")}},U=async y=>{try{const o=j([y])[y.id];if(!o)throw new Error("播放列表数据格式错误");const k=await Re("update","POST",o);if(k.code!==0)throw new Error(k.msg||"更新播放列表失败");return!0}catch(g){return ne(g,"更新播放列表失败"),!1}},x=y=>{const g=Array.isArray(y)?y:e.value;if(!g||g.length===0){u.value=null,P.value="";return}const o=g.find(K=>K.id===P.value)||g[0];P.value=o.id;const k=_(o.current_index,o.playlist?.length||0),F=te(o.pre_lists)?o.pre_lists.map(K=>[...K||[]]):D();u.value={...o,playlist:[...o.playlist||[]],pre_lists:F,current_index:k,pre_index:f(o.pre_index,-1),in_pre_files:!1,isPlaying:t(o.isPlaying)}},$=y=>({...y,playlist:y.playlist.map(g=>({...g})),pre_lists:te(y.pre_lists)?y.pre_lists.map(g=>g.map(o=>({...o}))):D()}),p=async y=>{if(typeof y!="function")return null;let g=e.value.length>0?e.value.map($):[M({name:We})],o=g.findIndex(le=>le.id===P.value);o===-1&&(o=0,P.value=g[0].id);const k=g[o],F=y($(k))||k,K=M(F,k.name);return te(K.pre_lists)||(K.pre_lists=te(k.pre_lists)?k.pre_lists.map(le=>le.map(de=>({...de}))):D()),g[o]=K,e.value=g,await U(g[o]),x(g),u.value},S=(y,g)=>{const o=localStorage.getItem(Wt);o&&y.some(k=>k.id===o)?P.value=o:P.value=g||""},C=async()=>{try{const y=await Re("get","GET",{});if(y.code!==0)throw new Error(y.msg||"获取播放列表失败");const g=ee(y.data),o=L(g||null);return e.value=o.playlists,S(o.playlists,o.activePlaylistId),x(o.playlists),o}catch(y){Qe.error("从接口加载播放列表失败:",y);const g=L(null);return e.value=g.playlists,S(g.playlists,g.activePlaylistId),x(g.playlists),g}},q=y=>y?!!(T.value!==null||r.value||s.value):!1;return{normalizePlaylistItem:M,normalizePlaylistCollection:L,transformApiDataToPlaylistFormat:ee,transformPlaylistToApiFormat:j,savePlaylist:re,updateSinglePlaylist:U,syncActivePlaylist:x,updateActivePlaylistData:p,loadPlaylist:C,refreshPlaylistStatus:async(y=!1,g=!1)=>{try{if(q(g))return;if(v.value=!0,y){const o=P.value;if(!o)return;const k=await Re("get","GET",{id:o});if(k.code!==0)throw new Error(k.msg||"获取播放列表状态失败");const F=ee(k.data);if(!F?.playlists?.length)return;const K=F.playlists[0],le=e.value.map(de=>de.id!==o?de:{...de,...K,playlist:K.playlist||de.playlist,pre_lists:te(K.pre_lists)?K.pre_lists.map(Me=>[...Me||[]]):de.pre_lists,current_index:K.current_index!==void 0?K.current_index:de.current_index,isPlaying:t(K?.isPlaying)});e.value=le,x(le)}else await C()}catch(o){Qe.error("刷新播放列表状态失败:",o)}finally{v.value=!1}}}}function Go(e,P,u,v,T,r,s,c,h){return{loadPlaylist:async()=>{try{const M=await Re("get","GET",{});if(M.code!==0)throw new Error(M.msg||"获取播放列表失败");return M.data}catch(M){throw Qe.error("从接口加载播放列表失败:",M),M}},handleSelectPlaylist:async M=>{!M||M===P.value||!e.value.find(L=>L.id===M)||(P.value=M,localStorage.setItem(Wt,M),r(e.value))},handleCreatePlaylist:async()=>{try{const M=`播放列表${e.value.length+1}`,{value:z}=await Se.prompt("请输入播放列表名称","新建播放列表",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:M,inputPlaceholder:M,inputValidator:ee=>!!ee&&ee.trim().length>0||"名称不能为空"});return{name:(z||M).trim()}}catch(M){if(M!=="cancel")throw M;return null}},handleCopyPlaylist:async M=>{if(!M)return null;const z=e.value.find(L=>L.id===M);if(!z)return null;try{const L=`${z.name}_副本`,{value:ee}=await Se.prompt("请输入播放列表名称","复制播放列表",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:L,inputPlaceholder:L,inputValidator:re=>!!re&&re.trim().length>0||"名称不能为空"}),j=(ee||L).trim();return{sourcePlaylist:z,name:j}}catch(L){if(L!=="cancel")throw L;return null}},handleDeletePlaylistGroup:async M=>{if(!M)return!1;if(e.value.length<=1)return E.warning("至少保留一个播放列表"),!1;const z=e.value.find(L=>L.id===M);if(!z)return!1;try{return await Se.confirm(`确认删除播放列表"${z.name}"吗？`,"删除播放列表",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),!0}catch(L){if(L!=="cancel")throw L;return!1}},handlePlayPlaylist:async()=>{const M=u.value;if(!M||!M.id){E.warning("播放列表不存在");return}if(!M.playlist||M.playlist.length===0){E.warning("播放列表为空，请先添加文件");return}try{v.value=!0,await s(L=>{const ee=Array.isArray(L.playlist)?L.playlist:[];return L.current_index=Math.max(0,Math.min(L.current_index||0,ee.length-1)),L.total=ee.length,L});const z=await Re("play","POST",{id:M.id});if(z.code!==0)throw new Error(z.msg||"播放失败");await c(!0),E.success("开始播放")}catch(z){ne(z,"播放失败")}finally{v.value=!1}},handlePlayNext:async()=>{const M=u.value;if(!M||!M.id){E.warning("播放列表不存在");return}if(!M.playlist||M.playlist.length===0){E.warning("播放列表为空，无法播放下一首");return}try{v.value=!0;const z=await Re("playNext","POST",{id:M.id});if(z.code!==0)throw new Error(z.msg||"播放下一首失败");await c(!0),E.success("已切换到下一首")}catch(z){ne(z,"播放下一首失败")}finally{v.value=!1}},handlePlayPre:async()=>{const M=u.value;if(!M||!M.id){E.warning("播放列表不存在");return}const z=h().length>0,L=M.playlist&&M.playlist.length>0;if(!z&&!L){E.warning("播放列表为空，无法播放上一首");return}try{v.value=!0;const ee=await Re("playPre","POST",{id:M.id});if(ee.code!==0)throw new Error(ee.msg||"播放上一首失败");await c(!0),E.success("已切换到上一首")}catch(ee){ne(ee,"播放上一首失败")}finally{v.value=!1}},handleStopPlaylist:async()=>{const M=u.value;if(!M||!M.id){E.warning("播放列表不存在");return}try{T.value=!0;const z=await Re("stop","POST",{id:M.id});if(z.code!==0)throw new Error(z.msg||"停止播放失败");await c(!0),E.success("已停止播放")}catch(z){ne(z,"停止播放列表失败")}finally{T.value=!1}}}}function Ho(e,P,u,v,T,r){const s=()=>{const _=e.value?.schedule?.cron||"";T.value=_,P.value=!0},c=()=>{P.value=!1},h=_=>{_&&(e.value?(G(_),E.success("Cron 表达式已应用到当前播放列表")):E.warning("请先选择一个播放列表"))},a=_=>{v.value=_,u.value=!0},B=async _=>{e.value&&await r(D=>(D.schedule||(D.schedule={enabled:0,cron:"",duration:0}),D.schedule.enabled=_?1:0,D))},G=async _=>{e.value&&await r(D=>(D.schedule||(D.schedule={enabled:0,cron:"",duration:0}),D.schedule.cron=_,D))};return{handleOpenCronBuilder:s,handleCloseCronBuilder:c,handleCronBuilderApply:h,handleCronBuilderPreview:a,handleTogglePlaylistCronEnabled:B,handleUpdatePlaylistCron:G,handleUpdatePlaylistDuration:async _=>{e.value&&await r(D=>(D.schedule||(D.schedule={enabled:0,cron:"",duration:0}),D.schedule.duration=_||0,D))},handleUpdateTriggerButton:async _=>{e.value&&await r(D=>(D.trigger_button=_||"",D))},handlePreviewPlaylistCron:()=>{if(!e.value||!e.value.schedule?.cron){E.warning("请先设置 Cron 表达式");return}try{const _=e.value.schedule.cron,D=wt(_,5);D&&D.length>0?(v.value=D,u.value=!0):E.warning("无法解析 Cron 表达式")}catch(_){ne(_,"预览失败")}}}}async function mt(e,P,u){let v;const T="bluetooth";return P==="GET"?v=await _e.get(`/${T}/${e}`,{params:u}):v=await _e.post(`/${T}/${e}`,u),v.data}function Ko(e,P,u,v,T,r,s,c,h,a,B,G){const O=p=>p.deviceID||p.address||"",f=async()=>{const p=e.value,S=P.value||p?.device?.type||p?.device_type||"dlna";if(!["agent","bluetooth"].includes(S)){u.value=[];return}try{s.value=!0;let C=null;S==="agent"?C=(await _e.get("/agent/list")).data:C=await mt("paired","GET"),C.code===0?u.value=C.data||[]:E.error(C.msg||"获取设备失败")}catch(C){console.error("获取设备失败:",C),E.error("获取设备失败")}finally{s.value=!1}},t=async p=>{try{p.connecting=!0;const S=await mt("connect","POST",{address:p.address});S.code===0?(E.success(`成功连接到设备: ${p.name}`),await f(),r.value=r.value.filter(C=>C.address!==p.address)):E.error(S.msg||"连接失败")}catch(S){console.error("连接设备失败:",S),E.error("连接设备失败")}finally{p.connecting=!1}},_=async()=>{try{c.value=!0;const p=await _e.get("/dlna/scan",{params:{timeout:5}});p.data.code===0?(v.value=p.data.data||[],E.success(`扫描到 ${v.value.length} 个 DLNA 设备`)):E.error(p.data.msg||"扫描 DLNA 设备失败")}catch(p){ne(p,"扫描 DLNA 设备失败")}finally{c.value=!1}},D=async p=>{const S=O(p);if(!S)return;const C=T.value;if(!Array.isArray(C))return;const q=C.find(me=>O(me)===S);if(q){q._volumeRefreshing=!0;try{const me=await _e.get("/mi/volume",{params:{device_id:S}});me.data.code===0?q.volume=me.data.data?.volume??me.data.data??void 0:E.error(me.data.msg||`获取设备 ${q.name||S} 音量失败`)}catch(me){ne(me,`获取设备 ${q.name||S} 音量失败`)}finally{q._volumeRefreshing=!1}}},te=async()=>{try{h.value=!0;const p=await _e.get("/mi/scan",{params:{timeout:5}});if(p.data.code===0){const S=(p.data.data||[]).map(C=>({...C,volume:void 0,_volumeChanging:!1,_volumeRefreshing:!1}));T.value=S,await Promise.allSettled(T.value.map(C=>D(C))),E.success(`扫描到 ${S.length} 个小米设备`)}else E.error(p.data.msg||"扫描小米设备失败")}catch(p){ne(p,"扫描小米设备失败")}finally{h.value=!1}},M=async()=>{try{s.value=!0;const p=await mt("scan","GET");if(p.code===0){const S=Array.isArray(p.data)?p.data:[];r.value=S.map(C=>({name:C.name||"",address:C.address||"",...C,connecting:!1})),E.success(`扫描完成，找到 ${r.value.length} 个设备`)}else E.error(p.msg||"扫描失败")}catch(p){console.error("扫描设备失败:",p),E.error("扫描设备失败")}finally{s.value=!1}},z=()=>{a.value=!0},L=()=>{a.value=!1},ee=async p=>{if(!e.value||!p||p==="")return;if(!["agent","dlna","bluetooth","mi"].includes(p)){E.error(`无效的设备类型: ${p}`);return}const C=p;P.value=C;const q=e.value;q.device_type=C,q.device?q.device.type=C:q.device={type:C,address:"",name:null},await f()},j=async(p,S=null)=>{e.value&&(await G(C=>{const q=P.value||C.device?.type||C.device_type||"dlna";return C.device||(C.device={address:"",type:q,name:null}),C.device.type=q,C.device.address=p,S!==null&&(C.device.name=S),C.device_address=p,C.device_type=q,C}),P.value=null)};return{getMiDeviceId:O,refreshConnectedList:f,handleConnectDevice:t,scanDlnaDevices:_,getMiDeviceVolume:D,scanMiDevices:te,handleUpdateDeviceList:M,handleOpenScanDialog:z,handleCloseScanDialog:L,handleUpdatePlaylistDeviceType:ee,handleUpdatePlaylistDeviceAddress:j,handleSelectBluetoothDevice:async p=>{const S=u.value.find(q=>q.address===p),C=S?S.name:null;await j(p,C)},handleSelectAgentDevice:async p=>{const S=typeof p=="string"?p:p.address,C=typeof p=="string"?null:p.name;await j(S,C)},handleSelectMiDevice:async p=>{const S=p.deviceID||p.address||"",C=p.name||"";await j(S,C)},handleOpenAgentListDialog:async()=>{B.value=!0,await f()}}}function Io(){const e=ls({callbacks:{onPlay:()=>{E.success("开始播放")},onError:()=>{ne(new Error("音频播放失败"),"播放失败"),P()},onEnded:()=>{P()}}}),P=()=>{e.clear()};return{audioPlayer:e,clearBrowserAudioPlayer:P,handlePlayFileInBrowser:c=>{const h=c?.uri||c?.path||"";if(!h||typeof h!="string"||h.trim()===""){E.warning("文件路径无效");return}if(e.playingFilePath.value===h&&e.audio&&!e.audio.paused){P(),E.info("已停止播放");return}const a=ss(h);if(!a||typeof a!="string"||a.trim()===""){E.error("无法生成媒体文件URL");return}if(a.includes("index.html")||a.endsWith(".html")){E.error("生成的媒体URL无效，可能是HTML页面");return}e.load(a,{playingFilePath:h}),e.play().catch(B=>{ne(B,"播放失败"),P()})},isFilePlaying:c=>{const h=c?.uri||c?.path||"";return e.isFilePlaying(h)},getFilePlayProgress:c=>{const h=c?.uri||c?.path||"";return e.getFilePlayProgress(h)},getFileDuration:c=>{const h=c?.uri||c?.path||"",a=c?.duration||0;return e.getFileDuration(h,a)},handleSeekFile:(c,h)=>{const a=c?.uri||c?.path||"";e.seekFile(a,h)}}}function Jo(e,P,u,v,T,r,s,c,h,a,B,G,O,f,t){const _=()=>s.value!==null?s.value:je(),D=b=>((!b.pre_lists||!Array.isArray(b.pre_lists)||b.pre_lists.length!==7)&&(b.pre_lists=Array(7).fill(null).map(()=>[])),b.pre_lists),te=(b="请先选择一个播放列表")=>P.value?!0:(E.warning(b),!1),M=(b,Y)=>{b!=="cancel"&&ne(b,Y)},z=async(b,Y)=>{try{u.value=!0,await b()}catch(N){M(N,Y)}finally{u.value=!1}},L=()=>{te()&&(v.value=!0,T.value="files",r.value=null)},ee=()=>{te()&&(v.value=!0,T.value="pre_files",r.value=null)},j=async b=>{if(b.length!==0){if(!P.value){E.warning("请先创建并选择一个播放列表");return}try{u.value=!0,await G(N=>{const X=_(),Z=T.value,Q=Z==="pre_files"?Array.isArray(N.pre_lists)&&N.pre_lists.length===7?[...N.pre_lists[X]||[]]:[]:Array.isArray(N.playlist)?[...N.playlist]:[],oe=new Set;if(Q.forEach(pe=>{pe?.uri&&oe.add(pe.uri)}),r.value&&b.length>0){const pe=r.value.index;if(r.value.type==="pre_files"){D(N);const $e=[...N.pre_lists[X]||[]];pe>=0&&pe<$e.length&&($e[pe]={uri:b[0]},N.pre_lists[X]=$e)}else{const $e=[...N.playlist];pe>=0&&pe<$e.length&&($e[pe]={uri:b[0]},N.playlist=$e,N.total=$e.length)}return r.value=null,N}for(const pe of b)if(!oe.has(pe)){const $e={uri:pe};Q.push($e),oe.add(pe)}return Z==="pre_files"?(D(N),N.pre_lists[X]=Q):(N.playlist=Q,N.total=Q.length,Q.length===0?N.current_index=0:N.current_index>=Q.length&&(N.current_index=Q.length-1)),N});const Y=T.value==="pre_files"?"前置列表":"播放列表";E.success(`成功添加 ${b.length} 个文件到${Y}`),v.value=!1}catch(Y){ne(Y,"添加文件到播放列表失败")}finally{u.value=!1}}},re=()=>{v.value=!1},U=async b=>{const Y=P.value;if(!(!Y||b<=0||b>=Y.playlist.length))try{u.value=!0,await G(N=>{const X=[...N.playlist];return[X[b-1],X[b]]=[X[b],X[b-1]],N.playlist=X,N.current_index===b?N.current_index=b-1:N.current_index===b-1&&(N.current_index=b),N.total=X.length,N}),E.success("已上移")}catch(N){ne(N,"上移失败")}finally{u.value=!1}},x=async b=>{const Y=P.value;if(!(!Y||b<0||b>=Y.playlist.length-1))try{u.value=!0,await G(N=>{const X=[...N.playlist];return[X[b],X[b+1]]=[X[b+1],X[b]],N.playlist=X,N.current_index===b?N.current_index=b+1:N.current_index===b+1&&(N.current_index=b),N.total=X.length,N}),E.success("已下移")}catch(N){ne(N,"下移失败")}finally{u.value=!1}},$=async b=>{const Y=P.value;if(!Y||b<0||b>=Y.playlist.length)return;const X=Y.playlist[b]?.uri?.split("/").pop()||"文件";try{await Se.confirm(`确定要删除 "${X}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),u.value=!0,await G(Z=>{const Q=[...Z.playlist];return Q.splice(b,1),Z.playlist=Q,Q.length===0?Z.current_index=0:b<Z.current_index?Z.current_index=Math.max(0,Z.current_index-1):b===Z.current_index&&(Z.current_index=Math.min(Z.current_index,Q.length-1)),Z.total=Q.length,Z}),E.success("已删除")}catch(Z){Z!=="cancel"&&ne(Z,"删除失败")}finally{u.value=!1}},p=async b=>{const Y=P.value;!Y||b<0||b>=Y.playlist.length||(r.value={type:"files",index:b},T.value="files",v.value=!0)},S=async b=>{const Y=P.value,N=O();!Y||!N||b<=0||b>=N.length||await z(async()=>{await G(X=>{const Z=_();D(X);const Q=[...X.pre_lists[Z]||[]];return[Q[b-1],Q[b]]=[Q[b],Q[b-1]],X.pre_lists[Z]=Q,X})},"上移失败")},C=async b=>{const Y=P.value,N=O();!Y||!N||b<0||b>=N.length-1||await z(async()=>{await G(X=>{const Z=_();D(X);const Q=[...X.pre_lists[Z]||[]];return[Q[b],Q[b+1]]=[Q[b+1],Q[b]],X.pre_lists[Z]=Q,X})},"下移失败")},q=async b=>{const Y=P.value,N=O();if(!Y||!N||b<0||b>=N.length)return;const Z=N[b]?.uri?.split("/").pop()||"文件";try{await Se.confirm(`确定要删除 "${Z}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await z(async()=>{await G(Q=>{const oe=_();D(Q);const pe=[...Q.pre_lists[oe]||[]];return pe.splice(b,1),Q.pre_lists[oe]=pe,Q}),E.success("已删除")},"删除失败")}catch(Q){M(Q,"删除失败")}},me=async b=>{const Y=P.value,N=O();!Y||!N||b<0||b>=N.length||(r.value={type:"pre_files",index:b},T.value="pre_files",v.value=!0)},y=()=>{c.value=!c.value,c.value||(a.value=[])},g=()=>{h.value=!h.value,h.value||(B.value=[])},o=b=>{const Y=a.value,N=Y.indexOf(b);N>-1?Y.splice(N,1):Y.push(b)},k=b=>{const Y=B.value,N=Y.indexOf(b);N>-1?Y.splice(N,1):Y.push(b)},F=async()=>{const b=P.value,Y=O(),N=a.value;if(!b||!Y||N.length===0)return;const X=N.length;try{await Se.confirm(`确定要删除选中的 ${X} 个前置文件吗？`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await z(async()=>{const Z=[...new Set(N)].sort((Q,oe)=>oe-Q);await G(Q=>{const oe=_();D(Q);const pe=[...Q.pre_lists[oe]||[]];return Z.forEach($e=>{$e>=0&&$e<pe.length&&pe.splice($e,1)}),Q.pre_lists[oe]=pe,Q}),a.value=[],c.value=!1,E.success(`已删除 ${X} 个前置文件`)},"批量删除失败")}catch(Z){M(Z,"批量删除失败")}},K=async()=>{const b=P.value,Y=B.value;if(!b||!b.playlist||Y.length===0)return;const N=Y.length;try{await Se.confirm(`确定要删除选中的 ${N} 个正式文件吗？`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await z(async()=>{const X=[...new Set(Y)].sort((Z,Q)=>Q-Z);await G(Z=>{const Q=[...Z.playlist];if(X.forEach(oe=>{oe>=0&&oe<Q.length&&Q.splice(oe,1)}),Z.playlist=Q,Q.length===0)Z.current_index=0;else{let oe=Z.current_index;X.forEach(pe=>{pe<Z.current_index?oe=Math.max(0,oe-1):pe===Z.current_index&&(oe=Math.min(oe,Q.length-1))}),Z.current_index=oe}return Z.total=Q.length,Z}),B.value=[],h.value=!1,E.success(`已删除 ${N} 个正式文件`)},"批量删除失败")}catch(X){M(X,"批量删除失败")}},le=async()=>{const b=P.value,Y=O();if(!(!b||!Y||Y.length===0))try{await Se.confirm(`确定要清空前置文件列表吗？此操作将删除所有 ${Y.length} 个前置文件。`,"确认清空",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await z(async()=>{await G(N=>{const X=_();return D(N),N.pre_lists[X]=[],N}),E.success("已清空前置文件列表")},"清空失败")}catch(N){M(N,"清空失败")}},de=async()=>{const b=P.value;if(!(!b||!b.playlist||b.playlist.length===0))try{await Se.confirm(`确定要清空正式文件列表吗？此操作将删除所有 ${b.playlist.length} 个正式文件。`,"确认清空",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await z(async()=>{await G(Y=>(Y.playlist=[],Y.total=0,Y.current_index=0,Y)),E.success("已清空正式文件列表")},"清空失败")}catch(Y){M(Y,"清空失败")}},Me=async()=>{const b=P.value;if(!b)return;const Y=O(),N=Y&&Y.length||0,X=b.playlist&&b.playlist.length||0,Z=N+X;if(Z!==0)try{const Q=N>0&&X>0?`确定要清空播放列表 "${b.name}" 吗？此操作将删除所有 ${N} 个前置文件和 ${X} 个正式文件，共 ${Z} 个文件。`:N>0?`确定要清空播放列表 "${b.name}" 吗？此操作将删除所有 ${N} 个前置文件。`:`确定要清空播放列表 "${b.name}" 吗？此操作将删除所有 ${X} 个正式文件。`;await Se.confirm(Q,"确认清空",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await z(async()=>{await G(oe=>(oe.playlist=[],D(oe),oe.pre_lists=oe.pre_lists.map(()=>[]),oe.total=0,oe.current_index=0,oe)),E.success("已清空播放列表（包括前置文件和正式文件）")},"清空失败")}catch(Q){M(Q,"清空失败")}},Ce=b=>typeof b=="string"?{uri:b}:{...b,uri:b.uri||""};return{handleOpenFileBrowser:L,handleOpenFileBrowserForPreFiles:ee,handleFileBrowserConfirm:j,handleCloseFileBrowser:re,handleMovePlaylistItemUp:U,handleMovePlaylistItemDown:x,handleDeletePlaylistItem:$,handleReplacePlaylistItem:p,handleMovePreFileUp:S,handleMovePreFileDown:C,handleDeletePreFile:q,handleReplacePreFile:me,handleTogglePreFilesBatchDeleteMode:y,handleToggleFilesBatchDeleteMode:g,handleTogglePreFileSelection:o,handleToggleFileSelection:k,handleBatchDeletePreFiles:F,handleBatchDeleteFiles:K,handleClearPreFiles:le,handleClearFiles:de,handleClearPlaylist:Me,handleOpenPlaylistSelectorForPreFile:async b=>{try{if(!b){E.warning("文件信息无效");return}if(t&&f){const Y=Ce(b);t.value=[Y],f.value=!0}else E.info("请使用文件浏览器添加文件到播放列表")}catch(Y){Qe.error("打开播放列表选择器失败:",Y),E.error("打开对话框失败")}},handleOpenPlaylistSelectorForFile:async b=>{try{if(!b){E.warning("文件信息无效");return}const Y=Ce(b);if(!Y.uri){E.warning("文件URI无效");return}t&&f?(t.value=[Y],f.value=!0):E.info("请使用文件浏览器添加文件到播放列表")}catch(Y){Qe.error("打开播放列表选择器失败:",Y),E.error("打开对话框失败")}}}}function Qo(e,P,u,v,T,r,s,c,h,a,B,G,O){const f=()=>a.value!==null?a.value:je(),t=(x,$)=>{if(!x||!$||x.length!==$.length)return!0;for(let p=0;p<x.length;p++){const S=x[p]?.uri||x[p],C=$[p]?.uri||$[p];if(S!==C)return!0}return!1};return{handleTogglePreFilesDragMode:async()=>{if(v.value){const x=P.value,$=O();if(x&&$&&$.length>0){if(t(c.value||[],$))try{u.value=!0,await B(S=>{const C=f();return(!S.pre_lists||!Array.isArray(S.pre_lists)||S.pre_lists.length!==7)&&(S.pre_lists=Array(7).fill(null).map(()=>[])),S.pre_lists[C]=[...$],S.pre_index=x.pre_index,S}),E.success("排序已保存")}catch(S){ne(S,"保存排序失败")}finally{u.value=!1}c.value=null}}else{const x=P.value,$=O();x&&$&&$.length>0&&(c.value=[...$]),r.value=null}v.value=!v.value},handleToggleFilesDragMode:async()=>{if(T.value){const x=P.value;if(x&&x.playlist&&x.playlist.length>0){if(t(h.value||[],x.playlist))try{u.value=!0,await B(p=>(p.playlist=[...x.playlist||[]],p.current_index=x.current_index,p.total=x.playlist.length,p)),E.success("排序已保存")}catch(p){ne(p,"保存排序失败")}finally{u.value=!1}h.value=null}}else{const x=P.value;x&&x.playlist&&x.playlist.length>0&&(h.value=[...x.playlist||[]]),s.value=null}T.value=!T.value},handlePreFileDragStart:(x,$)=>{if(!v.value){x.preventDefault();return}try{x.dataTransfer.effectAllowed="move",x.dataTransfer.setData("text/plain",$.toString())}catch(p){console.error("拖拽开始失败:",p)}},handlePreFileDragEnd:x=>{const $=x.currentTarget;$&&$.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")},handlePreFileDragOver:x=>{if(!v.value)return;x.preventDefault(),x.dataTransfer.dropEffect="move";const $=x.currentTarget;if($){const p=$.getBoundingClientRect(),S=x.clientY,C=p.top+p.height/2;$.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500"),S<C?$.classList.add("border-t-2","border-blue-500"):$.classList.add("border-b-2","border-blue-500")}},handlePreFileDrop:(x,$)=>{if(!v.value)return;x.preventDefault();const p=x.currentTarget;p&&p.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500");const S=parseInt(x.dataTransfer.getData("text/plain"),10);if(S===$||isNaN(S))return;const C=P.value,q=O();if(!C||!q||S<0||S>=q.length||$<0||$>=q.length)return;const me=f(),y=[...q],[g]=y.splice(S,1);y.splice($,0,g);let o=C.pre_index;C.pre_index!==void 0&&C.pre_index!==null&&C.pre_index>=0&&(C.pre_index===S?o=$:S<C.pre_index&&$>=C.pre_index?o=C.pre_index-1:S>C.pre_index&&$<=C.pre_index&&(o=C.pre_index+1));const k=e.value.map(F=>F.id===C.id?((!F.pre_lists||!Array.isArray(F.pre_lists)||F.pre_lists.length!==7)&&(F.pre_lists=Array(7).fill(null).map(()=>[])),{...F,pre_lists:F.pre_lists.map((K,le)=>le===me?y:K),pre_index:o}):F);e.value=k,G(k)},handleFileDragStart:(x,$)=>{if(!T.value){x.preventDefault();return}try{x.dataTransfer.effectAllowed="move",x.dataTransfer.setData("text/plain",$.toString())}catch(p){console.error("拖拽开始失败:",p)}},handleFileDragEnd:x=>{const $=x.currentTarget;$&&$.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500")},handleFileDragOver:x=>{if(!T.value)return;x.preventDefault(),x.dataTransfer.dropEffect="move";const $=x.currentTarget;if($){const p=$.getBoundingClientRect(),S=x.clientY,C=p.top+p.height/2;$.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500"),S<C?$.classList.add("border-t-2","border-blue-500"):$.classList.add("border-b-2","border-blue-500")}},handleFileDrop:(x,$)=>{if(!T.value)return;x.preventDefault();const p=x.currentTarget;p&&p.classList.remove("bg-gray-100","border-t-2","border-b-2","border-blue-500");const S=parseInt(x.dataTransfer.getData("text/plain"),10);if(S===$||isNaN(S))return;const C=P.value;if(!C||!C.playlist||S<0||S>=C.playlist.length||$<0||$>=C.playlist.length)return;const q=[...C.playlist||[]],[me]=q.splice(S,1);q.splice($,0,me);let y=C.current_index;C.current_index!==void 0&&C.current_index!==null&&C.current_index>=0&&(C.current_index===S?y=$:S<C.current_index&&$>=C.current_index?y=C.current_index-1:S>C.current_index&&$<=C.current_index&&(y=C.current_index+1));const g=e.value.map(o=>o.id===C.id?{...o,playlist:q,current_index:y,total:q.length}:o);e.value=g,G(g)}}}function qo(e,P,u,v,T,r){const s=H(!1),c=H(null),h=H("");return{editNameDialogVisible:s,editNameDialogName:h,handleStartEditPlaylistName:O=>{const f=e.value.find(t=>t.id===O);f&&(c.value=O,h.value=f.name,s.value=!0)},handleSavePlaylistName:async()=>{if(!c.value)return;const O=h.value?.trim();if(!O||O.length===0){E.warning("播放列表名称不能为空");return}const f=c.value,t=e.value.find(_=>_.id===f);if(!t||t.name===O){s.value=!1,c.value=null,h.value="";return}try{const _=e.value.map(D=>D.id===f?{...D,name:O}:D);e.value=_,f===P.value&&r(_),await T(_),s.value=!1,c.value=null,h.value="",E.success("播放列表名称已更新")}catch(_){ne(_,"更新播放列表名称失败")}},handleCancelEditPlaylistName:()=>{s.value=!1,c.value=null,h.value=""}}}const Xo={class:"p-1"},Zo={class:"flex gap-4 h-[calc(100vh-150px)]"},dr=Ee({__name:"index",setup(e){const{playlistCollection:P,activePlaylistId:u,playlistStatus:v,playlistLoading:T,playlistRefreshing:r,playing:s,stopping:c,showMoreActions:h,editingPlaylistId:a,editingPlaylistName:B,fileBrowserDialogVisible:G,fileBrowserTarget:O,replaceFileInfo:f,selectedWeekdayIndex:t,preFilesDragMode:_,filesDragMode:D,preFilesBatchDeleteMode:te,filesBatchDeleteMode:M,selectedPreFileIndices:z,selectedFileIndices:L,preFilesExpanded:ee,playlistSelectorVisible:j,playlistSelectorSelectedFiles:re,batchDrawerVisible:U,cronBuilderVisible:x,cronPreviewVisible:$,cronPreviewTimes:p,initialCronExpr:S,agentListDialogVisible:C,scanDialogVisible:q,loading:me,deviceList:y,connectedDeviceList:g,dlnaDeviceList:o,dlnaScanning:k,miDeviceList:F,miScanning:K,pendingDeviceType:le,preFilesSortOrder:de,filesSortOrder:Me,preFilesOriginalOrder:Ce,filesOriginalOrder:he}=jo(),{audioPlayer:R,handlePlayFileInBrowser:b,handleSeekFile:Y}=Io(),N=()=>t.value!==null?t.value:je(),X=()=>{const ce=v.value;if(!ce||!ce.pre_lists)return[];const se=N();return!Array.isArray(ce.pre_lists)||ce.pre_lists.length!==7?[]:ce.pre_lists[se]||[]},{savePlaylist:Z,syncActivePlaylist:Q,updateActivePlaylistData:oe,loadPlaylist:pe,refreshPlaylistStatus:$e}=Yo(P,u,v,r,le,_,D),Xe=async ce=>{await oe(ce)},{handleOpenFileBrowser:rt,handleOpenFileBrowserForPreFiles:w,handleFileBrowserConfirm:V,handleCloseFileBrowser:I,handleMovePlaylistItemUp:ue,handleMovePlaylistItemDown:Ue,handleDeletePlaylistItem:Ke,handleReplacePlaylistItem:ge,handleMovePreFileUp:ke,handleMovePreFileDown:Ie,handleDeletePreFile:jt,handleReplacePreFile:Yt,handleTogglePreFilesBatchDeleteMode:Gt,handleToggleFilesBatchDeleteMode:Ht,handleTogglePreFileSelection:Kt,handleToggleFileSelection:It,handleBatchDeletePreFiles:Jt,handleBatchDeleteFiles:Qt,handleClearPreFiles:qt,handleClearFiles:Xt,handleClearPlaylist:Zt,handleOpenPlaylistSelectorForPreFile:el,handleOpenPlaylistSelectorForFile:tl}=Jo(P,v,T,G,O,f,t,te,M,z,L,Xe,X,j,re),{handleTogglePreFilesDragMode:ll,handleToggleFilesDragMode:sl,handlePreFileDragStart:nl,handlePreFileDragEnd:al,handlePreFileDragOver:il,handlePreFileDrop:ol,handleFileDragStart:rl,handleFileDragEnd:dl,handleFileDragOver:ul,handleFileDrop:cl}=Qo(P,v,T,_,D,de,Me,Ce,he,t,Xe,Q,X),{editNameDialogVisible:dt,editNameDialogName:ut,handleStartEditPlaylistName:fl,handleSavePlaylistName:ct,handleCancelEditPlaylistName:Ze}=qo(P,u,a,B,Z,Q),{handleOpenCronBuilder:vl,handleCloseCronBuilder:ml,handleCronBuilderApply:gl,handleCronBuilderPreview:pl,handleTogglePlaylistCronEnabled:yl,handleUpdatePlaylistCron:hl,handleUpdatePlaylistDuration:bl,handleUpdateTriggerButton:xl,handlePreviewPlaylistCron:wl}=Ho(v,x,$,p,S,oe),{refreshConnectedList:Dt,handleConnectDevice:Dl,scanDlnaDevices:$l,scanMiDevices:Cl,handleUpdateDeviceList:Fl,handleOpenScanDialog:kl,handleCloseScanDialog:Pl,handleUpdatePlaylistDeviceType:_l,handleUpdatePlaylistDeviceAddress:Sl,handleSelectBluetoothDevice:Bl,handleSelectAgentDevice:Al,handleSelectMiDevice:Tl,handleOpenAgentListDialog:Ml}=Ko(v,le,g,o,F,y,me,k,K,q,C,oe),{handleSelectPlaylist:El,handleCreatePlaylist:Ll,handleCopyPlaylist:Nl,handleDeletePlaylistGroup:Ul,handlePlayPlaylist:zl,handlePlayNext:Ol,handlePlayPre:Vl,handleStopPlaylist:Rl}=Go(P,u,v,s,c,Q,oe,$e,X),Wl=async ce=>{await El(ce),le.value=null,de.value=null,Me.value=null,_.value=!1,D.value=!1,Ce.value=null,he.value=null,te.value=!1,M.value=!1,z.value=[],L.value=[],await Dt()},jl=async(ce,se)=>{ce==="delete"?await Ul(se):ce==="copy"&&await Nl(se)},Yl=async ce=>{try{if(T.value=!0,!P.value.find(be=>be.id===ce.playlistId)){E.warning("播放列表不存在");return}await oe(be=>{if(be.id!==ce.playlistId)return be;if(ce.preLists.length>0&&((!be.pre_lists||!Array.isArray(be.pre_lists)||be.pre_lists.length!==7)&&(be.pre_lists=Array(7).fill(null).map(()=>[])),ce.preLists.forEach(fe=>{if(fe>=0&&fe<7){const Fe=new Set((be.pre_lists[fe]||[]).map(Te=>typeof Te=="string"?Te:Te?.uri||""));ce.files.forEach(Te=>{Fe.has(Te)||(be.pre_lists[fe]||(be.pre_lists[fe]=[]),be.pre_lists[fe].push({uri:Te}))})}})),ce.filesList){Array.isArray(be.playlist)||(be.playlist=[]);const fe=new Set(be.playlist.map(Fe=>typeof Fe=="string"?Fe:Fe?.uri||""));ce.files.forEach(Fe=>{fe.has(Fe)||be.playlist.push({uri:Fe})}),be.total=be.playlist.length}return be}),Q(P.value),await Z(P.value)}catch(se){ne(se,"批量添加文件失败")}finally{T.value=!1}},Gl=async ce=>{try{if(T.value=!0,!P.value.find(fe=>fe.id===ce.playlistId)){E.warning("播放列表不存在");return}const be=new Set(ce.files);await oe(fe=>(fe.id!==ce.playlistId||(ce.preLists.length>0&&fe.pre_lists&&Array.isArray(fe.pre_lists)&&fe.pre_lists.length===7&&ce.preLists.forEach(Fe=>{Fe>=0&&Fe<7&&fe.pre_lists[Fe]&&(fe.pre_lists[Fe]=fe.pre_lists[Fe].filter(Te=>{const vt=typeof Te=="string"?Te:Te?.uri||"";return!be.has(vt)}))}),ce.filesList&&Array.isArray(fe.playlist)&&(fe.playlist=fe.playlist.filter(Fe=>{const Te=typeof Fe=="string"?Fe:Fe?.uri||"";return!be.has(Te)}),fe.total=fe.playlist.length,fe.playlist.length===0?fe.current_index=0:fe.current_index>=fe.playlist.length&&(fe.current_index=fe.playlist.length-1))),fe)),Q(P.value),await Z(P.value)}catch(se){ne(se,"批量删除文件失败")}finally{T.value=!1}},Hl=async()=>{await Ml()},Kl=ce=>{t.value=ce,Q(P.value)},ft=H(!0),{start:$t,stop:Ct}=ns(async()=>{await $e(!0,!0)},Kn,{immediate:!1,autoCleanup:!0}),Il=ce=>{ft.value=ce,ce?$t():Ct()};return it(async()=>{await pe(),await Dt(),ft.value&&$t()}),Mt(()=>{Ct()}),(ce,se)=>{const be=zt,fe=Ut,Fe=ht,Te=Ne,vt=qe;return m(),A("div",Xo,[n("div",Zo,[l(Xs,{"playlist-collection":d(P),"active-playlist-id":d(u),refreshing:d(r),"auto-refresh-enabled":ft.value,onSelect:Wl,onCreate:d(Ll),onRefresh:d($e),onToggleAutoRefresh:Il,onMenuCommand:jl},null,8,["playlist-collection","active-playlist-id","refreshing","auto-refresh-enabled","onCreate","onRefresh"]),l(Yn,{"playlist-status":d(v),"active-playlist-id":d(u),"editing-playlist-id":d(a),"editing-playlist-name":d(B),"onUpdate:editingPlaylistName":se[0]||(se[0]=xe=>et(B)?B.value=xe:null),"selected-weekday-index":d(t),"pre-files-drag-mode":d(_),"pre-files-batch-delete-mode":d(te),"selected-pre-file-indices":d(z),"pre-files-expanded":d(ee),"files-drag-mode":d(D),"files-batch-delete-mode":d(M),"selected-file-indices":d(L),"playlist-loading":d(T),playing:d(s),stopping:d(c),"show-more-actions":d(h),"audio-player":d(R),onStartEditName:d(fl),onSaveName:d(ct),onCancelEditName:d(Ze),onOpenBatchDrawer:se[1]||(se[1]=xe=>U.value=!0),onPlay:d(zl),onPlayPre:d(Vl),onPlayNext:d(Ol),onStop:d(Rl),onClear:d(Zt),onToggleMoreActions:se[2]||(se[2]=xe=>h.value=!d(h)),onSelectWeekday:Kl,onOpenFileBrowserForPreFiles:d(w),onTogglePreFilesDragMode:d(ll),onTogglePreFilesBatchDeleteMode:d(Gt),onBatchDeletePreFiles:d(Jt),onClearPreFiles:d(qt),onTogglePreFilesExpand:se[3]||(se[3]=xe=>ee.value=!d(ee)),onTogglePreFileSelection:d(Kt),onPreFileDragStart:d(nl),onPreFileDragEnd:d(al),onPreFileDragOver:d(il),onPreFileDrop:d(ol),onOpenFileBrowser:d(rt),onToggleFilesDragMode:d(sl),onToggleFilesBatchDeleteMode:d(Ht),onBatchDeleteFiles:d(Qt),onClearFiles:d(Xt),onToggleFileSelection:d(It),onFileDragStart:d(rl),onFileDragEnd:d(dl),onFileDragOver:d(ul),onFileDrop:d(cl),onPlayFile:d(b),onSeekFile:d(Y),onMovePreFileUp:d(ke),onMovePreFileDown:d(Ie),onReplacePreFile:d(Yt),onOpenPlaylistSelectorForPreFile:d(el),onDeletePreFile:d(jt),onMoveFileUp:d(ue),onMoveFileDown:d(Ue),onReplaceFile:d(ge),onOpenPlaylistSelectorForFile:d(tl),onDeleteFile:d(Ke)},null,8,["playlist-status","active-playlist-id","editing-playlist-id","editing-playlist-name","selected-weekday-index","pre-files-drag-mode","pre-files-batch-delete-mode","selected-pre-file-indices","pre-files-expanded","files-drag-mode","files-batch-delete-mode","selected-file-indices","playlist-loading","playing","stopping","show-more-actions","audio-player","onStartEditName","onSaveName","onCancelEditName","onPlay","onPlayPre","onPlayNext","onStop","onClear","onOpenFileBrowserForPreFiles","onTogglePreFilesDragMode","onTogglePreFilesBatchDeleteMode","onBatchDeletePreFiles","onClearPreFiles","onTogglePreFileSelection","onPreFileDragStart","onPreFileDragEnd","onPreFileDragOver","onPreFileDrop","onOpenFileBrowser","onToggleFilesDragMode","onToggleFilesBatchDeleteMode","onBatchDeleteFiles","onClearFiles","onToggleFileSelection","onFileDragStart","onFileDragEnd","onFileDragOver","onFileDrop","onPlayFile","onSeekFile","onMovePreFileUp","onMovePreFileDown","onReplacePreFile","onOpenPlaylistSelectorForPreFile","onDeletePreFile","onMoveFileUp","onMoveFileDown","onReplaceFile","onOpenPlaylistSelectorForFile","onDeleteFile"]),l(za,{"playlist-status":d(v),"connected-device-list":d(g),"dlna-device-list":d(o),"mi-device-list":d(F),loading:d(me),"dlna-scanning":d(k),"mi-scanning":d(K),"on-toggle-cron-enabled":d(yl),"on-update-cron":d(hl),"on-update-duration":d(bl),"on-update-trigger-button":d(xl),"on-open-cron-builder":d(vl),"on-preview-cron":d(wl),"on-update-device-type":d(_l),"on-update-device-address":d(Sl),"on-select-bluetooth-device":d(Bl),"on-select-agent-device":d(Al),"on-select-mi-device":d(Tl),"on-scan-dlna-devices":d($l),"on-scan-mi-devices":d(Cl),"on-open-scan-dialog":d(kl),"on-open-device-list":Hl},null,8,["playlist-status","connected-device-list","dlna-device-list","mi-device-list","loading","dlna-scanning","mi-scanning","on-toggle-cron-enabled","on-update-cron","on-update-duration","on-update-trigger-button","on-open-cron-builder","on-preview-cron","on-update-device-type","on-update-device-address","on-select-bluetooth-device","on-select-agent-device","on-select-mi-device","on-scan-dlna-devices","on-scan-mi-devices","on-open-scan-dialog"])]),l(Lt,{visible:d(G),"onUpdate:visible":se[5]||(se[5]=xe=>G.value=xe),title:"选择文件添加到播放列表","confirm-button-text":"添加","confirm-loading":d(T),onConfirm:d(V),onClose:d(I)},{"footer-prepend":i(()=>[l(fe,{modelValue:d(O),"onUpdate:modelValue":se[4]||(se[4]=xe=>et(O)?O.value=xe:null),size:"small",class:"w-[150px]"},{default:i(()=>[l(be,{label:"添加到主列表",value:"files"}),l(be,{label:"添加到前置列表",value:"pre_files"})]),_:1},8,["modelValue"])]),_:1},8,["visible","confirm-loading","onConfirm","onClose"]),l(As,{visible:d(x),"initial-cron":d(S),"onUpdate:visible":se[6]||(se[6]=xe=>x.value=xe),onApply:d(gl),onPreview:d(pl),onClose:d(ml)},null,8,["visible","initial-cron","onApply","onPreview","onClose"]),l(Ls,{visible:d($),times:d(p),"onUpdate:visible":se[7]||(se[7]=xe=>$.value=xe),onClose:se[8]||(se[8]=xe=>$.value=!1)},null,8,["visible","times"]),l(Ra,{visible:d(q),"device-list":d(y),loading:d(me),"onUpdate:visible":se[9]||(se[9]=xe=>q.value=xe),onRefresh:d(Fl),onConnect:d(Dl),onClose:d(Pl)},null,8,["visible","device-list","loading","onRefresh","onConnect","onClose"]),l(ki,{visible:d(C),"onUpdate:visible":se[10]||(se[10]=xe=>C.value=xe)},null,8,["visible"]),l(eo,{visible:d(j),"playlist-collection":d(P),"selected-files":d(re),"onUpdate:visible":se[11]||(se[11]=xe=>j.value=xe)},null,8,["visible","playlist-collection","selected-files"]),l(vt,{modelValue:d(dt),"onUpdate:modelValue":se[13]||(se[13]=xe=>et(dt)?dt.value=xe:null),title:"编辑播放列表名称",width:"400",onClose:d(Ze)},{footer:i(()=>[l(Te,{onClick:d(Ze)},{default:i(()=>[...se[15]||(se[15]=[J("取消",-1)])]),_:1},8,["onClick"]),l(Te,{type:"primary",onClick:d(ct)},{default:i(()=>[...se[16]||(se[16]=[J("确定",-1)])]),_:1},8,["onClick"])]),default:i(()=>[l(Fe,{modelValue:d(ut),"onUpdate:modelValue":se[12]||(se[12]=xe=>et(ut)?ut.value=xe:null),placeholder:"请输入播放列表名称",onKeyup:[Ft(d(ct),["enter"]),Ft(d(Ze),["esc"])],clearable:"",autofocus:""},null,8,["modelValue","onKeyup"])]),_:1},8,["modelValue","onClose"]),l(Wo,{visible:d(U),"playlist-collection":d(P),"onUpdate:visible":se[14]||(se[14]=xe=>U.value=xe),onRefresh:d($e),"on-add-files":Yl,"on-remove-files":Gl},null,8,["visible","playlist-collection","onRefresh"])])}}});export{dr as default};
