import{j as be,r as T,t as Se,n as p,o as u,s as a,Q as n,D as A,G as o,$ as b,J as x,M as Xe,l as V,u as B,aa as Me,ai as Ze,c as O,y as Ue,q as E,F as De,a6 as Pe,E as Fe,I as Z}from"./vue-vendor-C-hNZ0TW.js";import{c as Ve,K as et,q as tt,z as st,C as at,a7 as Be,u as Re,A as lt,a0 as Ee,f as ze,E as i,ak as ee,L as Oe,i as nt,a9 as Ne,a8 as ot,ab as rt,J as it,$ as ut,D as dt,B as ct,al as ft,am as vt,aj as pt,ah as gt}from"./element-plus-DX9Oi7VD.js";import{m as Ie,a as h,k as Le}from"./utils-shared-DQS5Jh_s.js";import{n as _t,u as mt,o as yt,q as xt,r as ht,t as kt,v as bt,w as wt,x as Ct,y as Tt,z as $t,A as Mt,B as Dt,C as Pt,D as Ft,E as At,F as St,G as Vt,H as ke,I as Bt,J as Et,K as zt}from"./api-shared-6GZjsi5J.js";import{u as Lt,b as Ke,M as je,_ as Ae}from"./useInterval-iNHjXJ54.js";import{c as jt,C as Ut}from"./constants-shared-BwcKRbUv.js";import"./utils-BjcahYMR.js";import"./vendor-CJeEfH0b.js";import"./types-shared-Ce9iq5aR.js";import"./index-Diqrh8tc.js";import"./vant-Bv_herco.js";const Rt={class:"p-4 flex flex-col h-full"},Ot={class:"mb-4 flex-shrink-0 border rounded p-3 bg-gray-50"},Nt={class:"flex items-center gap-3"},It={key:0,class:"flex-1 min-w-0"},Kt=["title"],Yt={class:"flex items-center justify-between"},Gt={class:"flex-1 overflow-auto"},qt=["onClick"],Jt={key:1,class:"text-gray-400"},Ht={key:0,class:"flex flex-col gap-1"},Qt={class:"text-sm"},Wt={class:"text-xs text-gray-500"},Xt={key:1,class:"text-gray-400"},Zt={key:0,class:"flex flex-col gap-1"},es={class:"text-sm"},ts={class:"text-xs text-gray-500"},ss={key:1,class:"text-gray-400"},as={class:"flex flex-col gap-1 items-center"},ls=["onClick"],ns=["title"],os={class:"flex items-center gap-2"},rs=be({__name:"PdfTool",setup(de){const r=T(!1),w=T([]),e=T(null),P=T(""),$=async()=>{try{r.value=!0;const c=await _t();if(c.code===0){const v=c.data||[];w.value=v.map(_=>({..._,_decrypting:_.status==="processing"||!1,_password:""}))}else i.error(c.msg||"获取任务列表失败")}catch(c){h(c,"获取任务列表失败")}finally{r.value=!1}},C=c=>{c.raw&&(e.value=c.raw,P.value=c.raw.name)},U=async()=>{if(!e.value){i.warning("请选择要上传的文件");return}const c=e.value;if(!c.name.toLowerCase().endsWith(".pdf")){i.error("只支持 PDF 文件");return}try{r.value=!0;const v=await mt(c);v.code===0?(i.success("文件上传成功"),e.value=null,P.value="",await $()):i.error(v.msg||"文件上传失败")}catch(v){h(v,"文件上传失败")}finally{r.value=!1}},k=async c=>{if(!c.uploaded_info){i.warning("请先上传文件");return}if(!(c._decrypting||c.status==="processing")&&!(c.status==="success"&&!await ee.confirm("已解密的文件已存在，是否重新解密？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{c._decrypting=!0;const v=c._password?.trim()||void 0,_=await yt(c.task_id,v);_.code===0?(i.success(_.data?.message||"解密任务已提交，正在后台处理"),c._password="",await K(c)):i.error(_.msg||"提交解密任务失败")}catch(v){h(v,"提交解密任务失败")}finally{c._decrypting=!1}},K=async(c,v=30)=>{let _=0;const I=async()=>{if(_>=v){i.warning("任务处理超时，请手动刷新查看状态"),await $();return}try{const D=await kt(c.task_id);if(D.code===0){const S=D.data;c.status=S.status,c.unlocked_info=S.unlocked_info,c.error_message=S.error_message,S.status==="success"?(i.success("文件解密成功"),c._decrypting=!1,await $()):S.status==="failed"?(i.error(S.error_message||"文件解密失败"),c._decrypting=!1):S.status==="processing"?(_++,setTimeout(I,1e3)):c._decrypting=!1}}catch(D){h(D,"查询任务状态失败"),c._decrypting=!1}};I()},z=async(c,v)=>{const _=v==="uploaded"?c.uploaded_info:c.unlocked_info;if(!_){i.warning("文件不存在");return}try{const I=xt(_.name,v);window.open(I,"_blank")}catch(I){h(I,"下载文件失败")}},Y=async c=>{if(!c.uploaded_info){i.warning("请先上传文件");return}if(c.status==="processing"){i.warning("任务正在处理中，无法删除");return}if(await ee.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{r.value=!0;const _=await ht(c.task_id);_.code===0?(i.success(_.data?.message||"任务删除成功"),await $()):i.error(_.msg||"任务删除失败")}catch(_){h(_,"删除任务失败")}finally{r.value=!1}},N=Ie,G=c=>c?new Date(c*1e3).toLocaleString():"-";return Se(()=>{$()}),(c,v)=>{const _=Ve,I=et,D=ze,S=at,J=Be,L=Re,ae=lt,le=tt,te=st;return u(),p("div",Rt,[v[11]||(v[11]=a("h2",{class:"text-xl font-semibold mb-4"},"PDF 解密工具",-1)),a("div",Ot,[a("div",Nt,[a("div",null,[n(_,{type:"success",size:"small",onClick:U,loading:r.value,disabled:!e.value},{default:o(()=>[...v[0]||(v[0]=[b(" 上传 ",-1)])]),_:1},8,["loading","disabled"])]),n(I,{"auto-upload":!1,"on-change":C,"show-file-list":!1,accept:".pdf"},{trigger:o(()=>[n(_,{type:"primary",size:"small",class:"!m-0"},{default:o(()=>[...v[1]||(v[1]=[b("选择文件",-1)])]),_:1})]),_:1}),e.value?(u(),p("div",It,[a("div",{class:"text-sm text-gray-600 truncate",title:P.value||e.value.name},x(P.value||e.value.name),9,Kt)])):A("",!0)])]),n(le,{class:"flex-1 flex flex-col overflow-hidden",shadow:"hover"},{header:o(()=>[a("div",Yt,[v[3]||(v[3]=a("span",null,"文件列表",-1)),n(_,{type:"info",size:"small",plain:"",onClick:$,loading:r.value},{default:o(()=>[r.value?A("",!0):(u(),V(D,{key:0},{default:o(()=>[n(B(Ee))]),_:1})),v[2]||(v[2]=b(" 刷新 ",-1))]),_:1},8,["loading"])])]),default:o(()=>[a("div",Gt,[Xe((u(),V(ae,{data:w.value,stripe:"",class:"w-full"},{empty:o(()=>[...v[10]||(v[10]=[a("div",{class:"text-center text-gray-400 py-8"},"暂无文件，请上传 PDF 文件",-1)])]),default:o(()=>[n(S,{prop:"filename",label:"文件名","min-width":"200"},{default:o(({row:g})=>[g.uploaded_info?(u(),p("span",{key:0,class:"text-blue-600 cursor-pointer hover:underline",onClick:q=>z(g,"uploaded")},x(g.filename),9,qt)):(u(),p("span",Jt,"-"))]),_:1}),n(S,{label:"上传文件","min-width":"150"},{default:o(({row:g})=>[g.uploaded_info?(u(),p("div",Ht,[a("span",Qt,x(B(N)(g.uploaded_info.size)),1),a("span",Wt,x(G(g.uploaded_info.modified)),1)])):(u(),p("span",Xt,"-"))]),_:1}),n(S,{label:"已解密文件","min-width":"150"},{default:o(({row:g})=>[g.unlocked_info?(u(),p("div",Zt,[a("span",es,x(B(N)(g.unlocked_info.size)),1),a("span",ts,x(G(g.unlocked_info.modified)),1)])):(u(),p("span",ss,"未解密"))]),_:1}),n(S,{label:"状态",width:"140",align:"center"},{default:o(({row:g})=>[a("div",as,[g.status==="success"?(u(),V(J,{key:0,type:"success",size:"small"},{default:o(()=>[...v[4]||(v[4]=[b("已解密",-1)])]),_:1})):g.status==="processing"?(u(),V(J,{key:1,type:"warning",size:"small"},{default:o(()=>[...v[5]||(v[5]=[b("处理中",-1)])]),_:1})):g.status==="pending"?(u(),V(J,{key:2,type:"info",size:"small"},{default:o(()=>[...v[6]||(v[6]=[b("等待中",-1)])]),_:1})):g.status==="failed"?(u(),V(J,{key:3,type:"danger",size:"small"},{default:o(()=>[...v[7]||(v[7]=[b("失败",-1)])]),_:1})):(u(),V(J,{key:4,type:"info",size:"small"},{default:o(()=>[...v[8]||(v[8]=[b("已上传",-1)])]),_:1})),g.unlocked_info?(u(),p("span",{key:5,class:"text-xs text-blue-600 cursor-pointer hover:underline",onClick:q=>z(g,"unlocked")}," 下载 ",8,ls)):A("",!0),g.error_message?(u(),p("span",{key:6,class:"text-xs text-red-500",title:g.error_message}," 错误 ",8,ns)):A("",!0)])]),_:1}),n(S,{label:"操作",width:"280",fixed:"right"},{default:o(({row:g})=>[a("div",os,[g.uploaded_info?(u(),V(L,{key:0,modelValue:g._password,"onUpdate:modelValue":q=>g._password=q,type:"password",size:"small",placeholder:"密码（可选）","show-password":"",clearable:"",class:"w-30",disabled:g._decrypting||g.status==="processing",onKeyup:Me(q=>k(g),["enter"])},null,8,["modelValue","onUpdate:modelValue","disabled","onKeyup"])):A("",!0),g.uploaded_info&&g.status!=="processing"?(u(),V(_,{key:1,type:"primary",size:"small",onClick:q=>k(g),loading:g._decrypting,disabled:g._decrypting||g.status==="processing"},{default:o(()=>[b(x(g.status==="success"?"重新解密":"解密"),1)]),_:2},1032,["onClick","loading","disabled"])):A("",!0),g.uploaded_info?(u(),V(_,{key:2,type:"danger",size:"small",plain:"",onClick:q=>Y(g),disabled:g.status==="processing"},{default:o(()=>[...v[9]||(v[9]=[b(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])):A("",!0)])]),_:1})]),_:1},8,["data"])),[[te,r.value]])])]),_:1})])}}}),is={viewBox:"0 0 512 512",width:"1.2em",height:"1.2em"};function us(de,r){return u(),p("svg",is,[...r[0]||(r[0]=[a("path",{fill:"none",stroke:"currentColor","stroke-linecap":"square","stroke-width":"48",d:"m136 208l120-104l120 104m-240 96l120 104l120-104"},null,-1)])])}const ds=Ze({name:"ion-chevron-expand-sharp",render:us}),cs={class:"flex gap-4 h-full"},fs={class:"w-64 border rounded p-3 flex flex-col"},vs={class:"flex items-center justify-between mb-3"},ps={class:"flex items-center gap-1"},gs={key:0,class:"flex-1 overflow-y-auto space-y-2 pr-1 min-h-[400px]"},_s=["onClick"],ms={class:"flex items-center justify-between gap-2"},ys={class:"text-sm font-medium truncate flex-1 min-w-0"},xs={class:"text-xs text-gray-500 whitespace-nowrap flex items-center gap-1 flex-shrink-0"},hs={class:"whitespace-nowrap w-5 flex items-center justify-center"},ks={class:"flex items-center justify-between gap-2 min-h-[20px]"},bs={class:"flex items-center gap-1 flex-shrink-0"},ws={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400"},Cs={key:0,class:"flex-1 border rounded p-3 flex flex-col max-w-2xl"},Ts={class:"flex items-center justify-between mb-3 flex-shrink-0"},$s={class:"text-base font-semibold"},Ms={class:"text-sm text-gray-500"},Ds={class:"flex-1 overflow-auto flex flex-col gap-3"},Ps={class:"flex items-center justify-between gap-4 flex-shrink-0"},Fs={class:"flex items-center gap-4"},As={key:1,class:"text-red-500 text-xs"},Ss={class:"flex items-center gap-2"},Vs={class:"border rounded p-2 flex-1 flex flex-col overflow-hidden"},Bs={class:"flex items-center justify-between mb-2 flex-shrink-0"},Es={class:"flex items-center gap-1 pr-1"},zs={class:"flex-1 overflow-auto"},Ls={key:0},js=["draggable","onDragstart","onDrop"],Us={class:"text-xs text-gray-500 w-8"},Rs=["title"],Os={key:0,class:"text-xs text-gray-500 whitespace-nowrap w-20 text-right"},Ns={key:1,class:"w-20"},Is={key:1,class:"text-sm text-gray-400 text-center py-1"},Ks={key:1,class:"flex-1 border rounded p-3 flex flex-col max-w-2xl"},Ys=be({__name:"AudioMerge",setup(de){const r=T(!1),w=T([]),e=T(null),P=T(!1),$=T(!1),C=T(!1),U=T(null),k=Lt({callbacks:{onPlay:()=>{i.success("开始播放")},onError:()=>{h(new Error("音频播放失败"),"播放失败"),W()},onEnded:()=>{W()}}}),K={size:"small",plain:!0,class:"!w-8 !h-6 !p-0"},z={size:"small",plain:!0,class:"!h-5 !text-xs !px-2"},Y={size:"small",plain:!0,class:"!h-7 !text-xs"},N=["bg-gray-100","border-t-2","border-b-2","border-blue-500"],G=t=>{t&&t.classList.remove(...N)},c=t=>{if(!t)return;t.querySelectorAll('[draggable="true"]').forEach(d=>G(d))},v=async t=>{if(e.value&&t.length!==0)try{r.value=!0;for(const s of t){const d=await bt(e.value.task_id,s);if(d.code!==0){i.error(`添加文件失败: ${d.msg||"未知错误"}`);break}}i.success(`成功添加 ${t.length} 个文件`),await D(e.value.task_id)}catch(s){h(s,"添加文件失败")}finally{r.value=!1}},_=async()=>{try{r.value=!0;const t=await wt();t.code===0?(w.value=t.data.tasks||[],w.value.length>0&&!e.value&&await D(w.value[0].task_id)):i.error(t.msg||"获取任务列表失败")}catch(t){h(t,"获取任务列表失败")}finally{r.value=!1}},I=async()=>{try{r.value=!0;const t=await Ct();t.code===0?(i.success("任务创建成功"),await _(),D(t.data.task_id)):i.error(t.msg||"创建任务失败")}catch(t){h(t,"创建任务失败")}finally{r.value=!1}},D=async t=>{e.value&&e.value.task_id!==t&&ne();try{r.value=!0;const s=await Tt(t);s.code===0?e.value=s.data:i.error(s.msg||"获取任务信息失败")}catch(s){h(s,"获取任务信息失败")}finally{r.value=!1}},S=async t=>{if(await ee.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{r.value=!0;const d=await Pt(t);d.code===0?(i.success("任务删除成功"),await _(),e.value&&e.value.task_id===t&&(w.value&&w.value.length>0?await D(w.value[0].task_id):e.value=null)):i.error(d.msg||"删除任务失败")}catch(d){h(d,"删除任务失败")}finally{r.value=!1}},J=()=>{if(!e.value){i.warning("请先创建或选择任务");return}P.value=!0},L=async t=>{if(!(!e.value||!await ee.confirm("确定要删除该文件吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{r.value=!0;const d=await Ft(e.value.task_id,t);d.code===0?(k.playingFileIndex.value===t?ne():k.playingFileIndex.value!==null&&k.playingFileIndex.value>t&&(k.playingFileIndex.value=k.playingFileIndex.value-1),i.success("文件删除成功"),await D(e.value.task_id)):i.error(d.msg||"删除文件失败")}catch(d){h(d,"删除文件失败")}finally{r.value=!1}},ae=async()=>{if(!(!e.value||!await ee.confirm(`确定要开始合成吗？将合并 ${j.value} 个音频文件。`,"确认合成",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1)))try{r.value=!0;const s=await $t(e.value.task_id);s.code===0?(i.success("合成任务已启动"),await _(),await D(e.value.task_id),g()):i.error(s.msg||"启动任务失败")}catch(s){h(s,"启动任务失败")}finally{r.value=!1}},{start:le,stop:te}=Ke(async()=>{if(!e.value||e.value.status!=="processing"){te();return}await _(),await D(e.value.task_id)},jt,{immediate:!1}),g=()=>{le()},q=t=>{if(!t)return;const s=At(t);window.open(s,"_blank")},we=()=>{e.value?.result_file&&q(e.value.task_id)},Ce=t=>{t?.result_file&&q(t.task_id)},W=()=>{k.clear()},ce=(t,s)=>{if(!t)return;const d=t?.path||t?.name||"";k.seekFile(d,s)},Te=(t,s)=>{e.value?.result_file&&ce({path:e.value.result_file},s)},fe=t=>{if(!e.value||!e.value.files||t<0||t>=e.value.files.length)return;const s=e.value.files[t],d=s.path||s.name||"";if(!d){i.warning("文件路径不存在");return}if(k.playingFilePath.value===d&&k.audio&&!k.audio.paused){W(),i.info("已停止播放");return}const M=Le(d);if(!M){i.error("无法生成媒体文件URL");return}k.load(M,{playingFilePath:d,playingFileIndex:t}),k.play().catch(H=>{h(H,"播放失败"),W()})},ne=()=>{W()},ve=()=>{if(!e.value||!e.value.result_file){i.warning("结果文件不存在");return}const t=e.value.result_file;if(k.playingFilePath.value===t&&k.audio&&!k.audio.paused){W(),i.info("已停止播放");return}const s=Le(t);if(!s){i.error("无法生成媒体文件URL");return}k.load(s,{playingFilePath:t}),k.play().catch(d=>{h(d,"播放失败"),W()})},pe=()=>{if(!e.value||!e.value.result_file){i.warning("结果文件不存在");return}$.value=!0},ge=async t=>{if(!e.value||!e.value.result_file)return;if(t.length===0){i.warning("请选择转存目录");return}const s=t[0];try{r.value=!0;const d=await Mt(e.value.task_id,s);d.code===0?(i.success("转存成功"),$.value=!1):i.error(d.msg||"转存失败")}catch(d){h(d,"转存失败")}finally{r.value=!1}},oe=Ie,_e={pending:{tag:"info",text:"等待中"},processing:{tag:"warning",text:"处理中"},success:{tag:"success",text:"成功"},failed:{tag:"danger",text:"失败"}},X=t=>_e[t]?.tag||"info",f=t=>_e[t]?.text||"未知",l=O(()=>e.value?.status==="processing"),F=O(()=>(e.value?.files||[]).length>0),j=O(()=>(e.value?.files||[]).length),se=O(()=>e.value?.result_file),me=O(()=>!se.value||e.value?.status!=="success"||C.value),re=O(()=>!F.value||l.value||C.value),ie=O(()=>l.value||C.value),ye=O(()=>!e.value||!F.value||l.value),xe=O(()=>C.value?"点击退出拖拽排序模式":"点击进入拖拽排序模式"),he=O(()=>({path:se.value||""})),m=(t,s)=>!t||!s||t.length!==s.length?!0:t.some((d,M)=>{const H=d?.path||d?.name,ue=s[M]?.path||s[M]?.name;return H!==ue}),$e=async()=>{if(C.value){if(e.value&&e.value.files&&e.value.files.length>0){if(m(U.value||[],e.value.files))try{r.value=!0;const s=e.value.files.map((M,H)=>H),d=await Dt(e.value.task_id,s);d.code===0?(i.success("排序已保存"),await D(e.value.task_id)):i.error(d.msg||"保存排序失败")}catch(s){h(s,"保存排序失败")}finally{r.value=!1}U.value=null}}else e.value&&e.value.files&&e.value.files.length>0&&(U.value=[...e.value.files||[]]);C.value=!C.value},Ye=(t,s)=>{if(!C.value)return t.preventDefault(),!1;try{t.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",s.toString()))}catch(d){console.error("拖拽开始失败:",d)}},Ge=t=>{t.currentTarget&&G(t.currentTarget)},qe=t=>{t.currentTarget&&G(t.currentTarget)},Je=t=>{if(C.value&&(t.preventDefault(),t.dataTransfer&&(t.dataTransfer.dropEffect="move"),t.currentTarget)){const s=t.currentTarget.getBoundingClientRect(),d=t.clientY,M=s.top+s.height/2;G(t.currentTarget),d<M?t.currentTarget.classList.add("border-t-2","border-blue-500"):t.currentTarget.classList.add("border-b-2","border-blue-500")}},He=(t,s)=>{if(!C.value||(t.preventDefault(),t.currentTarget&&(G(t.currentTarget),c(t.currentTarget.parentElement)),!t.dataTransfer))return;const d=parseInt(t.dataTransfer.getData("text/plain"),10);if(d===s||isNaN(d)||!e.value||!e.value.files||d<0||d>=e.value.files.length||s<0||s>=e.value.files.length)return;const M=t.currentTarget?.getBoundingClientRect(),H=t.clientY,ue=M?M.top+M.height/2:0,y=H<ue?s:s+1,R=[...e.value.files||[]],[Q]=R.splice(d,1),We=d<y?y-1:y;R.splice(We,0,Q),e.value={...e.value,files:R}},Qe=()=>{P.value=!1};return Se(()=>{_()}),Ue(()=>{ne(),te()}),(t,s)=>{const d=ze,M=Ve,H=Be,ue=ds;return u(),p("div",cs,[a("div",fs,[a("div",vs,[s[7]||(s[7]=a("h3",{class:"text-base font-semibold"},"任务列表",-1)),a("div",ps,[n(M,E({type:"info"},K,{onClick:_,loading:r.value}),{default:o(()=>[r.value?A("",!0):(u(),V(d,{key:0},{default:o(()=>[n(B(Ee))]),_:1}))]),_:1},16,["loading"]),n(M,E({type:"success"},K,{onClick:I,loading:r.value}),{default:o(()=>[n(d,null,{default:o(()=>[n(B(Oe))]),_:1})]),_:1},16,["loading"])])]),w.value&&w.value.length>0?(u(),p("div",gs,[(u(!0),p(De,null,Pe(w.value,y=>(u(),p("div",{key:y.task_id,class:Fe(["border rounded px-3 py-2 cursor-pointer hover:bg-gray-50 group min-h-[60px] flex flex-col justify-between",{"border-blue-500 bg-blue-50":e.value&&y.task_id===e.value.task_id}]),onClick:R=>D(y.task_id)},[a("div",ms,[a("div",ys,x(y.name),1),a("span",xs,[n(d,null,{default:o(()=>[n(B(nt),{class:"!w-3 !h-3"})]),_:1}),a("span",hs,x(y.files?y.files.length:0),1)])]),a("div",ks,[n(H,{type:X(y.status),size:"small",class:"!h-5 !text-xs w-16 text-center"},{default:o(()=>[b(x(f(y.status)),1)]),_:2},1032,["type"]),a("div",bs,[y.status==="success"&&y.result_file?(u(),V(M,E({key:0,type:"primary"},{ref_for:!0},z,{onClick:Z(R=>Ce(y),["stop"])}),{default:o(()=>[...s[8]||(s[8]=[b(" 下载 ",-1)])]),_:1},16,["onClick"])):A("",!0),n(M,E({type:"danger"},{ref_for:!0},z,{onClick:Z(R=>S(y.task_id),["stop"]),disabled:y.status==="processing"}),{default:o(()=>[n(d,null,{default:o(()=>[n(B(Ne))]),_:1})]),_:1},16,["onClick","disabled"])])])],10,_s))),128))])):(u(),p("div",ws,' 暂无任务，请点击"新建"创建 '))]),e.value?(u(),p("div",Cs,[a("div",Ts,[a("h3",$s,"任务详情: "+x(e.value.name),1),a("span",Ms," 共 "+x(j.value)+" 个文件 ",1)]),a("div",Ds,[a("div",Ps,[a("div",Fs,[n(H,{type:X(e.value.status),size:"small",class:"w-16 text-center"},{default:o(()=>[b(x(f(e.value.status)),1)]),_:1},8,["type"]),se.value?(u(),V(je,{key:0,file:he.value,player:B(k),disabled:C.value,onPlay:ve,onSeek:Te},null,8,["file","player","disabled"])):A("",!0),n(M,E({type:"primary"},Y,{onClick:we,disabled:me.value}),{default:o(()=>[...s[9]||(s[9]=[b(" 下载 ",-1)])]),_:1},16,["disabled"]),n(M,E({type:"success"},Y,{onClick:pe,disabled:me.value}),{default:o(()=>[...s[10]||(s[10]=[b(" 转存 ",-1)])]),_:1},16,["disabled"]),e.value.error_message?(u(),p("span",As," 错误: "+x(e.value.error_message),1)):A("",!0)]),a("div",Ss,[n(M,E({type:"success"},Y,{onClick:ae,disabled:re.value,loading:l.value}),{default:o(()=>[...s[11]||(s[11]=[b(" 开始合成 ",-1)])]),_:1},16,["disabled","loading"])])]),a("div",Vs,[a("div",Bs,[s[13]||(s[13]=a("h4",{class:"text-sm font-semibold"},"文件列表",-1)),a("div",Es,[n(M,E({type:"primary"},z,{disabled:ie.value,onClick:J}),{default:o(()=>[...s[12]||(s[12]=[b(" + ",-1)])]),_:1},16,["disabled"]),n(M,E({type:C.value?"success":"default"},K,{onClick:$e,disabled:ye.value,title:xe.value}),{default:o(()=>[C.value?(u(),V(d,{key:0},{default:o(()=>[n(B(ot))]),_:1})):(u(),V(ue,{key:1,class:"!w-3.5 !h-3.5"}))]),_:1},16,["type","disabled","title"])])]),a("div",zs,[F.value?(u(),p("div",Ls,[(u(!0),p(De,null,Pe(e.value.files,(y,R)=>(u(),p("div",{key:R,class:Fe(["flex items-center gap-2 p-1 hover:bg-gray-100 rounded",{"cursor-move":C.value,"cursor-default":!C.value,"select-none":!0}]),draggable:C.value,onDragstart:Q=>Ye(Q,Number(R)),onDragend:s[2]||(s[2]=Q=>Ge(Q)),onDragover:s[3]||(s[3]=Z(Q=>Je(Q),["prevent"])),onDragleave:qe,onDrop:Z(Q=>He(Q,Number(R)),["prevent"])},[a("span",Us,x(Number(R)+1),1),a("span",{class:"flex-1 text-sm truncate",title:y.path||y.name},x(y.name),9,Rs),y.size?(u(),p("span",Os,x(B(oe)(y.size)),1)):(u(),p("div",Ns)),a("div",{class:"flex items-center gap-1 flex-shrink-0",onMousedown:s[0]||(s[0]=Z(()=>{},["stop"])),onClick:s[1]||(s[1]=Z(()=>{},["stop"]))},[n(je,{file:y,player:B(k),disabled:ie.value,onPlay:()=>fe(Number(R)),onSeek:ce},null,8,["file","player","disabled","onPlay"]),n(M,{type:"info",size:"small",plain:"",circle:"",onClick:Z(Q=>L(Number(R)),["stop"]),disabled:ie.value,class:"!h-6 !text-xs"},{default:o(()=>[n(d,null,{default:o(()=>[n(B(rt))]),_:1})]),_:1},8,["onClick","disabled"])],32)],42,js))),128))])):(u(),p("div",Is,"文件列表为空"))])])])])):(u(),p("div",Ks,[...s[14]||(s[14]=[a("div",{class:"flex items-center justify-between mb-3 flex-shrink-0"},[a("h3",{class:"text-base font-semibold"},"任务详情")],-1),a("div",{class:"flex-1 flex items-center justify-center text-sm text-gray-400"}," 请从左侧选择一个任务查看详情 ",-1)])])),n(Ae,{visible:P.value,"onUpdate:visible":s[4]||(s[4]=y=>P.value=y),title:"选择文件添加到任务","confirm-button-text":"添加","confirm-loading":r.value,onConfirm:v,onClose:Qe},null,8,["visible","confirm-loading"]),n(Ae,{visible:$.value,"onUpdate:visible":s[5]||(s[5]=y=>$.value=y),title:"选择转存目录","confirm-button-text":"转存",mode:"directory","confirm-loading":r.value,onConfirm:ge,onClose:s[6]||(s[6]=y=>$.value=!1)},null,8,["visible","confirm-loading"])])}}}),Gs={class:"flex gap-4 h-full"},qs={class:"w-64 border rounded p-3 flex flex-col"},Js={class:"flex items-center justify-between mb-3"},Hs={class:"flex items-center gap-1"},Qs={key:0,class:"flex-1 overflow-y-auto space-y-2 pr-1 min-h-[400px]"},Ws=["onClick"],Xs={class:"flex items-center justify-between gap-2"},Zs=["title"],ea={class:"flex items-center justify-between gap-2 min-h-[20px]"},ta={class:"flex items-center gap-1 flex-shrink-0"},sa={key:1,class:"flex-1 flex items-center justify-center text-sm text-gray-400 min-h-[400px]"},aa={key:0,class:"flex-1 border rounded p-3 flex flex-col max-w-2xl"},la={class:"flex items-center justify-between mb-3 flex-shrink-0"},na={class:"flex items-center gap-2 flex-1"},oa={class:"text-base font-semibold"},ra={class:"flex-1 overflow-auto flex flex-col gap-3"},ia={class:"flex items-center justify-between gap-4 flex-shrink-0"},ua={class:"flex items-center gap-4"},da={key:0,class:"text-red-500 text-xs"},ca={class:"flex items-center gap-3"},fa={class:"flex items-center gap-2"},va={class:"border rounded p-3 flex flex-col gap-2"},pa={class:"flex items-center justify-between"},ga={key:0,class:"text-sm text-gray-600 flex flex-col gap-1"},_a=["title"],ma={key:0,class:"text-xs text-gray-500"},ya={key:1,class:"text-sm text-gray-400"},xa={class:"border rounded p-3 flex flex-col gap-2"},ha={class:"flex items-center gap-2"},ka={key:0,class:"border rounded p-3 flex flex-col gap-2"},ba={key:0,class:"space-y-2"},wa={class:"text-sm text-gray-600"},Ca=["title"],Ta={key:1,class:"text-sm text-gray-400"},$a={key:1,class:"border rounded p-3 flex flex-col gap-2"},Ma={class:"text-sm text-gray-600"},Da={key:0,class:"mt-2"},Pa={key:1,class:"flex-1 border rounded p-3 flex flex-col max-w-2xl"},Fa=be({__name:"AudioConvert",setup(de){const r=T(!1),w=T([]),e=T(null),P=T(!1),$=T("mp3"),C=T(!1),U=T(!0),k=T(!1),K=T(!1),z=T(""),Y=T(!1),N=T(""),G={size:"small",plain:!0,class:"!w-8 !h-6 !p-0"},c={size:"small",plain:!0,class:"!h-5 !text-xs !px-2"},v={size:"small",plain:!0,class:"!h-7 !text-xs"},_=async()=>{try{r.value=!0;const f=await St();f.code===0?(w.value=f.data.tasks||[],w.value.length>0&&!e.value&&await L(w.value[0].task_id)):i.error(f.msg||"获取任务列表失败")}catch(f){h(f,"获取任务列表失败")}finally{r.value=!1}},I=()=>{z.value="",K.value=!0},D=async()=>{if(!z.value.trim()){i.warning("请输入任务名称");return}try{r.value=!0;const f=await Vt({name:z.value.trim()});f.code===0?(i.success("任务创建成功"),K.value=!1,z.value="",await _(),L(f.data.task_id)):i.error(f.msg||"创建任务失败")}catch(f){h(f,"创建任务失败")}finally{r.value=!1}},S=()=>{e.value&&(N.value=e.value.name,Y.value=!0)},J=async()=>{if(e.value){if(!N.value.trim()){i.warning("请输入任务名称");return}try{r.value=!0;const f=await ke(e.value.task_id,{name:N.value.trim()});f.code===0?(i.success("任务名称修改成功"),Y.value=!1,N.value="",await L(e.value.task_id)):i.error(f.msg||"修改任务名称失败")}catch(f){h(f,"修改任务名称失败")}finally{r.value=!1}}},L=async f=>{try{r.value=!0;const l=await Bt(f);l.code===0?(e.value=l.data,$.value=l.data.output_dir||"mp3",C.value=!1,U.value=l.data.overwrite!==!1,k.value=!1):i.error(l.msg||"获取任务信息失败")}catch(l){h(l,"获取任务信息失败")}finally{r.value=!1}},ae=async f=>{if(await ee.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{r.value=!0;const F=await zt(f);F.code===0?(i.success("任务删除成功"),await _(),e.value&&e.value.task_id===f&&(w.value&&w.value.length>0?await L(w.value[0].task_id):e.value=null)):i.error(F.msg||"删除任务失败")}catch(F){h(F,"删除任务失败")}finally{r.value=!1}},le=()=>{if(!e.value){i.warning("请先创建或选择任务");return}P.value=!0},te=async f=>{if(!e.value||f.length===0)return;const l=f[0];try{r.value=!0;const F=await ke(e.value.task_id,{directory:l});F.code===0?(i.success("目录设置成功"),await L(e.value.task_id),P.value=!1):i.error(F.msg||"设置目录失败")}catch(F){h(F,"设置目录失败")}finally{r.value=!1}},g=()=>{P.value=!1},q=()=>{if(!e.value)return;const f=e.value.output_dir||"mp3";C.value=$.value!==f},we=async()=>{if(e.value){if(!$.value.trim()){i.error("输出目录名称不能为空");return}try{r.value=!0;const f=await ke(e.value.task_id,{output_dir:$.value.trim()});f.code===0?(i.success("输出目录名称保存成功"),await L(e.value.task_id)):i.error(f.msg||"保存输出目录名称失败")}catch(f){h(f,"保存输出目录名称失败")}finally{r.value=!1}}},Ce=()=>{if(!e.value)return;const f=e.value.overwrite!==!1;k.value=U.value!==f,k.value&&W()},W=async()=>{if(e.value)try{r.value=!0;const f=await ke(e.value.task_id,{overwrite:U.value});f.code===0?(i.success("覆盖选项保存成功"),await L(e.value.task_id)):i.error(f.msg||"保存覆盖选项失败")}catch(f){h(f,"保存覆盖选项失败")}finally{r.value=!1}},ce=async()=>{if(!e.value)return;if(!e.value.directory){i.warning("请先选择转码目录");return}if(await ee.confirm(`确定要开始转码吗？将转换目录 "${e.value.directory}" 下的所有音频文件为 MP3 格式。`,"确认转码",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(()=>!1))try{r.value=!0;const l=await Et(e.value.task_id);l.code===0?(i.success("转码任务已启动"),await _(),await L(e.value.task_id),ne()):i.error(l.msg||"启动任务失败")}catch(l){h(l,"启动任务失败")}finally{r.value=!1}},{start:Te,stop:fe}=Ke(async()=>{if(!e.value||e.value.status!=="processing"){fe();return}await _(),await L(e.value.task_id)},Ut,{immediate:!1}),ne=()=>{Te()},ve={pending:{tag:"info",text:"等待中"},processing:{tag:"warning",text:"处理中"},success:{tag:"success",text:"成功"},failed:{tag:"danger",text:"失败"}},pe=f=>ve[f]?.tag||"info",ge=f=>ve[f]?.text||"未知",oe=O(()=>e.value?.status==="processing"),_e=O(()=>!e.value?.directory||oe.value),X=O(()=>oe.value);return Se(()=>{_()}),Ue(()=>{fe()}),(f,l)=>{const F=ze,j=Ve,se=Be,me=ut,re=Re,ie=dt,ye=vt,xe=ft,he=ct;return u(),p("div",Gs,[a("div",qs,[a("div",Js,[l[11]||(l[11]=a("h3",{class:"text-base font-semibold"},"任务列表",-1)),a("div",Hs,[n(j,E({type:"info"},G,{onClick:_,loading:r.value}),{default:o(()=>[r.value?A("",!0):(u(),V(F,{key:0},{default:o(()=>[n(B(Ee))]),_:1}))]),_:1},16,["loading"]),n(j,E({type:"success"},G,{onClick:I,loading:r.value}),{default:o(()=>[n(F,null,{default:o(()=>[n(B(Oe))]),_:1})]),_:1},16,["loading"])])]),w.value&&w.value.length>0?(u(),p("div",Qs,[(u(!0),p(De,null,Pe(w.value,m=>(u(),p("div",{key:m.task_id,class:Fe(["border rounded px-3 py-2 cursor-pointer hover:bg-gray-50 group min-h-[60px] flex flex-col justify-between",{"border-blue-500 bg-blue-50":e.value&&m.task_id===e.value.task_id}]),onClick:$e=>L(m.task_id)},[a("div",Xs,[a("div",{class:"text-sm font-medium truncate flex-1 min-w-0",title:m.name},x(m.name),9,Zs)]),a("div",ea,[n(se,{type:pe(m.status),size:"small",class:"!h-5 !text-xs w-16 text-center"},{default:o(()=>[b(x(ge(m.status)),1)]),_:2},1032,["type"]),a("div",ta,[n(j,E({type:"danger"},{ref_for:!0},c,{onClick:Z($e=>ae(m.task_id),["stop"]),disabled:m.status==="processing"}),{default:o(()=>[n(F,null,{default:o(()=>[n(B(Ne))]),_:1})]),_:1},16,["onClick","disabled"])])])],10,Ws))),128))])):(u(),p("div",sa,' 暂无任务，请点击"新建"创建 '))]),e.value?(u(),p("div",aa,[a("div",la,[a("div",na,[a("h3",oa,"任务详情: "+x(e.value.name),1),n(j,{type:"default",size:"small",plain:"",circle:"",disabled:X.value,onClick:S,title:"编辑名称"},{default:o(()=>[n(F,null,{default:o(()=>[n(B(it))]),_:1})]),_:1},8,["disabled"])])]),a("div",ra,[a("div",ia,[a("div",ua,[n(se,{type:pe(e.value.status),size:"small",class:"w-16 text-center"},{default:o(()=>[b(x(ge(e.value.status)),1)]),_:1},8,["type"]),e.value.error_message?(u(),p("span",da," 错误: "+x(e.value.error_message),1)):A("",!0)]),a("div",ca,[a("div",fa,[l[12]||(l[12]=a("span",{class:"text-sm text-gray-600"},"覆盖同名文件",-1)),n(me,{modelValue:U.value,"onUpdate:modelValue":l[0]||(l[0]=m=>U.value=m),disabled:X.value,onChange:Ce},null,8,["modelValue","disabled"])]),n(j,E({type:"success"},v,{onClick:ce,disabled:_e.value,loading:oe.value}),{default:o(()=>[...l[13]||(l[13]=[b(" 开始转码 ",-1)])]),_:1},16,["disabled","loading"])])]),a("div",va,[a("div",pa,[l[15]||(l[15]=a("h4",{class:"text-sm font-semibold"},"转码目录",-1)),n(j,E({type:"primary"},c,{disabled:X.value,onClick:le}),{default:o(()=>[...l[14]||(l[14]=[b(" 选择目录 ",-1)])]),_:1},16,["disabled"])]),e.value.directory?(u(),p("div",ga,[a("div",{class:"truncate",title:e.value.directory},x(e.value.directory),9,_a),e.value.total_files!==null&&e.value.total_files!==void 0?(u(),p("div",ma," 可处理文件数: "+x(e.value.total_files),1)):A("",!0)])):(u(),p("div",ya," 请选择一个目录，该目录下的所有媒体文件将被转换为 MP3 格式 "))]),a("div",xa,[l[17]||(l[17]=a("div",{class:"flex items-center justify-between"},[a("h4",{class:"text-sm font-semibold"},"输出目录名称")],-1)),a("div",ha,[n(re,{modelValue:$.value,"onUpdate:modelValue":l[1]||(l[1]=m=>$.value=m),placeholder:"输出目录名称",size:"small",disabled:X.value,onBlur:q},null,8,["modelValue","disabled"]),n(j,E({type:"primary"},c,{disabled:X.value||!C.value,onClick:we}),{default:o(()=>[...l[16]||(l[16]=[b(" 保存 ",-1)])]),_:1},16,["disabled"])]),l[18]||(l[18]=a("div",{class:"text-xs text-gray-400"},' 转码后的文件将保存在转码目录下的此文件夹中，默认为 "mp3" ',-1))]),e.value.status==="processing"||e.value.progress?(u(),p("div",ka,[l[19]||(l[19]=a("h4",{class:"text-sm font-semibold"},"转码进度",-1)),e.value.progress?(u(),p("div",ba,[a("div",wa," 已处理: "+x(e.value.progress.processed??0)+" / "+x(e.value.progress.total??0),1),n(ie,{percentage:(e.value.progress.total??0)>0?Math.round((e.value.progress.processed??0)/(e.value.progress.total??1)*100):0,status:e.value.status==="processing"?void 0:"success"},null,8,["percentage","status"]),e.value.progress.current_file?(u(),p("div",{key:0,class:"text-xs text-gray-500 truncate",title:e.value.progress.current_file}," 正在处理: "+x(e.value.progress.current_file),9,Ca)):A("",!0)])):(u(),p("div",Ta,"等待开始转码..."))])):A("",!0),e.value.status==="success"?(u(),p("div",$a,[l[21]||(l[21]=a("h4",{class:"text-sm font-semibold"},"转码结果",-1)),a("div",Ma,[l[20]||(l[20]=a("div",null,"转码完成！所有文件已保存到目录下的 mp3 文件夹中",-1)),e.value.progress?(u(),p("div",Da," 共转换 "+x(e.value.progress.total||0)+" 个文件 ",1)):A("",!0)])])):A("",!0)])])):(u(),p("div",Pa,[...l[22]||(l[22]=[a("div",{class:"flex items-center justify-between mb-3 flex-shrink-0"},[a("h3",{class:"text-base font-semibold"},"任务详情")],-1),a("div",{class:"flex-1 flex items-center justify-center text-sm text-gray-400"}," 请从左侧选择一个任务查看详情 ",-1)])])),n(Ae,{visible:P.value,"onUpdate:visible":l[2]||(l[2]=m=>P.value=m),title:"选择转码目录","confirm-button-text":"确定",mode:"directory","default-path":e.value?.directory||void 0,"confirm-loading":r.value,onConfirm:te,onClose:g},null,8,["visible","default-path","confirm-loading"]),n(he,{modelValue:K.value,"onUpdate:modelValue":l[5]||(l[5]=m=>K.value=m),title:"创建转码任务",width:"400px",onClose:l[6]||(l[6]=m=>z.value="")},{footer:o(()=>[n(j,{onClick:l[4]||(l[4]=m=>K.value=!1)},{default:o(()=>[...l[23]||(l[23]=[b("取消",-1)])]),_:1}),n(j,{type:"primary",onClick:D,loading:r.value},{default:o(()=>[...l[24]||(l[24]=[b(" 确定 ",-1)])]),_:1},8,["loading"])]),default:o(()=>[n(xe,null,{default:o(()=>[n(ye,{label:"任务名称"},{default:o(()=>[n(re,{modelValue:z.value,"onUpdate:modelValue":l[3]||(l[3]=m=>z.value=m),placeholder:"请输入任务名称",onKeyup:Me(D,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(he,{modelValue:Y.value,"onUpdate:modelValue":l[9]||(l[9]=m=>Y.value=m),title:"重命名任务",width:"400px",onClose:l[10]||(l[10]=m=>N.value="")},{footer:o(()=>[n(j,{onClick:l[8]||(l[8]=m=>Y.value=!1)},{default:o(()=>[...l[25]||(l[25]=[b("取消",-1)])]),_:1}),n(j,{type:"primary",onClick:J,loading:r.value},{default:o(()=>[...l[26]||(l[26]=[b(" 确定 ",-1)])]),_:1},8,["loading"])]),default:o(()=>[n(xe,null,{default:o(()=>[n(ye,{label:"任务名称"},{default:o(()=>[n(re,{modelValue:N.value,"onUpdate:modelValue":l[7]||(l[7]=m=>N.value=m),placeholder:"请输入任务名称",onKeyup:Me(J,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),Aa={class:"p-1"},Ia=be({__name:"index",setup(de){const r=T("pdf_tool"),w=e=>{console.log("切换到页签:",e)};return(e,P)=>{const $=gt,C=pt;return u(),p("div",Aa,[n(C,{modelValue:r.value,"onUpdate:modelValue":P[0]||(P[0]=U=>r.value=U),onTabChange:w,class:"flex-1 flex flex-col overflow-hidden h-[calc(100vh-150px)]"},{default:o(()=>[n($,{label:"PDF 工具",name:"pdf_tool"},{default:o(()=>[n(rs)]),_:1}),n($,{label:"音频合成",name:"audio_merge"},{default:o(()=>[n(Ys)]),_:1}),n($,{label:"音频转码",name:"audio_convert"},{default:o(()=>[n(Fa)]),_:1})]),_:1},8,["modelValue"])])}}});export{Ia as default};
