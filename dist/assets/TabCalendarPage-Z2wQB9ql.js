import{a0 as de,o as f,e as E,j as I,d as ue,i as F,C as y,w as we,c as q,a as l,r as x,b as n,t as U,Z as te,h as Q,u as i,f as R,F as G,X as ye,q as be,n as ae,R as xe,K as Se,H as fe,$ as ke,J as le,s as De,v as Ce,L as Me,W as Oe,Y as pe,a1 as Te,D as $e,E as Ie,k as Ee,U as ze,V as Pe,a2 as He,I as re,g as ie,l as Ve}from"./index-UZuNqsf6.js";import{g as se,c as qe,d as Ue,S as Be,a as he,I as me,K as ve,b as _e}from"./swiper-vue-BsDFOcFw.js";import{a as L,S as Ne,U as Ye}from"./UserData-DjzkXb57.js";import"./ImgMgr-3mLux0k_.js";function Ae(z){const{effect:o,swiper:s,on:c,setTranslate:b,setTransition:w,overwriteParams:m,perspective:a,recreateShadows:_,getEffectParams:S}=z;c("beforeInit",()=>{if(s.params.effect!==o)return;s.classNames.push("".concat(s.params.containerModifierClass).concat(o)),a&&a()&&s.classNames.push("".concat(s.params.containerModifierClass,"3d"));const d=m?m():{};Object.assign(s.params,d),Object.assign(s.originalParams,d)}),c("setTranslate",()=>{s.params.effect===o&&b()}),c("setTransition",(d,k)=>{s.params.effect===o&&w(k)}),c("transitionEnd",()=>{if(s.params.effect===o&&_){if(!S||!S().slideShadows)return;s.slides.forEach(d=>{d.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(k=>k.remove())}),_()}});let u;c("virtualUpdate",()=>{s.params.effect===o&&(s.slides.length||(u=!0),requestAnimationFrame(()=>{u&&s.slides&&s.slides.length&&(b(),u=!1)}))})}function Fe(z,o){const s=se(o);return s!==o&&(s.style.backfaceVisibility="hidden",s.style["-webkit-backface-visibility"]="hidden"),s}function ce(z,o,s){const c="swiper-slide-shadow".concat(s?"-".concat(s):"").concat(" swiper-slide-shadow-".concat(z)),b=se(o);let w=b.querySelector(".".concat(c.split(" ").join(".")));return w||(w=qe("div",c.split(" ")),b.append(w)),w}function Le(z){let{swiper:o,extendParams:s,on:c}=z;s({coverflowEffect:{rotate:50,stretch:0,depth:100,scale:1,modifier:1,slideShadows:!0}}),Ae({effect:"coverflow",swiper:o,on:c,setTranslate:()=>{const{width:m,height:a,slides:_,slidesSizesGrid:S}=o,u=o.params.coverflowEffect,d=o.isHorizontal(),k=o.translate,M=d?-k+m/2:-k+a/2,B=d?u.rotate:-u.rotate,j=u.depth,W=Ue(o);for(let N=0,J=_.length;N<J;N+=1){const D=_[N],Y=S[N],K=D.swiperSlideOffset,X=(M-K-Y/2)/Y,e=typeof u.modifier=="function"?u.modifier(X):X*u.modifier;let t=d?B*e:0,r=d?0:B*e,h=-j*Math.abs(e),v=u.stretch;typeof v=="string"&&v.indexOf("%")!==-1&&(v=parseFloat(u.stretch)/100*Y);let C=d?0:v*e,P=d?v*e:0,H=1-(1-u.scale)*Math.abs(e);Math.abs(P)<.001&&(P=0),Math.abs(C)<.001&&(C=0),Math.abs(h)<.001&&(h=0),Math.abs(t)<.001&&(t=0),Math.abs(r)<.001&&(r=0),Math.abs(H)<.001&&(H=0);const V="translate3d(".concat(P,"px,").concat(C,"px,").concat(h,"px)  rotateX(").concat(W(r),"deg) rotateY(").concat(W(t),"deg) scale(").concat(H,")"),A=Fe(u,D);if(A.style.transform=V,D.style.zIndex=-Math.abs(Math.round(e))+1,u.slideShadows){let g=d?D.querySelector(".swiper-slide-shadow-left"):D.querySelector(".swiper-slide-shadow-top"),O=d?D.querySelector(".swiper-slide-shadow-right"):D.querySelector(".swiper-slide-shadow-bottom");g||(g=ce("coverflow",D,d?"left":"top")),O||(O=ce("coverflow",D,d?"right":"bottom")),g&&(g.style.opacity=e>0?e:0),O&&(O.style.opacity=-e>0?-e:0)}}},setTransition:m=>{o.slides.map(_=>se(_)).forEach(_=>{_.style.transitionDuration="".concat(m,"ms"),_.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(S=>{S.style.transitionDuration="".concat(m,"ms")})})},perspective:()=>!0,overwriteParams:()=>({watchSlidesProgress:!0})})}const Re={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Ge(z,o){return f(),E("svg",Re,o[0]||(o[0]=[I("path",{fill:"currentColor",d:"M16.5 11L13 7.5l1.4-1.4l2.1 2.1L20.7 4l1.4 1.4zM11 7H2v2h9zm10 6.4L19.6 12L17 14.6L14.4 12L13 13.4l2.6 2.6l-2.6 2.6l1.4 1.4l2.6-2.6l2.6 2.6l1.4-1.4l-2.6-2.6zM11 15H2v2h9z"},null,-1)]))}const We=de({name:"mdi-list-status",render:Ge}),Xe={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function je(z,o){return f(),E("svg",Xe,o[0]||(o[0]=[I("path",{fill:"currentColor",d:"M19 3h-1V1h-2v2H8V1H6v2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.11 0 2-.89 2-2V5c0-1.11-.89-2-2-2m0 16H5V9h14zm0-12H5V5h14M7 11h5v5H7"},null,-1)]))}const Je=de({name:"mdi-calendar-today-outline",render:je}),Ke={class:"text-xl font-bold text-white"},Ze=["onClick"],Qe={class:"truncate"},et={class:"flex"},tt={class:"schedule-lb-sub"},at={class:"schedule-lb-group"},st=ue({__name:"CalendarCover",props:{dt:{type:Object,default:F()},userData:{type:Object,required:!0}},emits:["update:data"],setup(z,{emit:o}){const s=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],c=z,b=o,w=y([{},{},{}]),m=y(),a=y(F(c.dt)),_=y(),S=y(),u=y(),d=y(),k=y(!1);we(()=>c.dt,e=>{a.value=e,M()},{deep:!0});const M=()=>{w.value=[L.createDayData(a.value.subtract(1,"day"),c.userData),L.createDayData(a.value,c.userData),L.createDayData(a.value.add(1,"day"),c.userData)]};function B(e){if(e.activeIndex===1)return;const t=e.activeIndex,r=e.previousIndex;t<r?(a.value=a.value.subtract(1,"day"),M(),e.slideTo(1,0,!1)):t>r&&(a.value=a.value.add(1,"day"),M(),e.slideTo(1,0,!1))}const j=e=>{m.value=e,e.slideTo(1,0,!1)},W=(e,t)=>{var r;try{return(r=t==null?void 0:t.subtasks)==null?void 0:r.filter(h=>{var v,C;return(((v=e.save[t.id])==null?void 0:v.subtasks)&&((C=e.save[t.id])==null?void 0:C.subtasks[h.id])||0)===1}).length}catch(h){return console.log("countFinishedSubtask",h),0}},N=(e,t,r)=>{if(t){const h=t.save[r]||new Ne;h.state=e.detail.checked?1:0,t.save[r]=h,Oe(()=>{t.events.sort((v,C)=>{var V,A,g,O;const P=((V=t.save[v.id])==null?void 0:V.state)||0,H=((A=t.save[C.id])==null?void 0:A.state)||0;return P===H?((g=v.id)!=null?g:0)-((O=C.id)!=null?O:0):P-H})}),Y(),b("update:data",a.value)}},J=(e,t,r)=>{k.value=!0,u.value=t,d.value=r.save[t.id]},D=e=>{if(k.value=!1,e.detail.role==="backdrop")return;const[t,r]=e.detail.data,h=a.value;L.updateSchedularData(c.userData,t,r,h,e.detail.role)&&(M(),Y(),b("update:data",a.value))};function Y(){ye(c.userData.id,c.userData.name,JSON.stringify(c.userData)).then(e=>{console.log("doSaveUserData",e)}).catch(e=>{console.log("doSaveUserData",e)})}function K(){var e;a.value=F(),M(),(e=m==null?void 0:m.value)==null||e.slideTo(1,0,!1)}const X=()=>{u.value=void 0,d.value=void 0,k.value=!0};return(e,t)=>{const r=Je,h=x("ion-button"),v=x("ion-item"),C=We,P=x("ion-icon"),H=x("ion-label"),V=x("ion-content"),A=x("ion-modal");return f(),q(A,{mode:"ios","aria-hidden":"false",ref_key:"selfRef",ref:_},{default:l(()=>[n(V,{class:"main_content"},{default:l(()=>[n(v,{class:"transparent"},{default:l(()=>[I("h2",Ke,U(a.value.format("YYYY-MM-DD")+" "+s[a.value.day()]),1),n(h,{slot:"end",color:"danger",onClick:K,size:"default",style:te({padding:"0px 10px",opacity:a.value.isToday()?"0":"1"})},{default:l(()=>[n(r,{height:"16",slot:"start"}),t[1]||(t[1]=Q(" 今天 "))]),_:1},8,["style"])]),_:1}),n(i(he),{onTransitionEnd:B,onSwiper:j,"centered-slides":!0,modules:[i(me),i(ve),i(Le)],effect:"coverflow",slidesPerView:"auto",freeMode:!1,coverflowEffect:{rotate:10,stretch:0,depth:100,modifier:1,slideShadows:!1},keyboard:!0,class:"h-[90%]"},{default:l(()=>[(f(!0),E(G,null,R(w.value,(g,O)=>(f(),q(i(_e),{key:O,class:"data-content"},{default:l(()=>[n(V,null,{default:l(()=>[n(v,{color:"light"},{default:l(()=>[n(C,{class:"text-blue-500",height:"30",width:"30",slot:"start"}),t[2]||(t[2]=I("div",{class:"h-12"},null,-1))]),_:1}),(f(!0),E(G,null,R(g.events,(p,ee)=>(f(),q(v,{key:ee},{default:l(()=>{var Z,T;return[n(i(be),{style:{"--size":"26px"},slot:"start",checked:((Z=g.save[p.id])==null?void 0:Z.state)===1,onIonChange:$=>N($,g,p.id)},null,8,["checked","onIonChange"]),I("div",{onClick:$=>J($,p,g),class:"flex w-full items-center"},[n(H,{class:ae([{"text-line-through":((T=g.save[p.id])==null?void 0:T.state)===1},"p-2.5 flex-1"])},{default:l(()=>{var $;return[I("h2",Qe,U(p.title),1),I("div",et,[I("p",tt,[n(P,{icon:i(xe),class:"relative top-0.5"},null,8,["icon"]),Q(" "+U(W(g,p))+" / "+U(($=p==null?void 0:p.subtasks)==null?void 0:$.length),1)]),I("p",at,U(i(Se)(p.groupId).label),1)])]}),_:2},1032,["class"]),I("span",{class:"v-dot ml-2.5",style:te({"background-color":i(fe)(p.color).tag})},null,4),(f(),q(ke(i(le)(p.priority).icon),{height:"36px",width:"36px",color:i(le)(p.priority).color},null,8,["color"]))],8,Ze)]}),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modules"]),n(i(De),{slot:"fixed",vertical:"bottom",horizontal:"end"},{default:l(()=>[n(i(Ce),{onClick:X},{default:l(()=>[n(P,{icon:i(Me),size:"large"},null,8,["icon"])]),_:1})]),_:1})]),_:1}),I("div",{class:"w-full h-[10%]",onClick:t[0]||(t[0]=g=>_.value.$el.dismiss())}),n(Be,{id:"pop-modal","aria-hidden":"false",ref_key:"scheduleModal",ref:S,"is-open":k.value,modal:S.value,schedule:u.value,save:d.value,onWillDismiss:D},null,8,["is-open","modal","schedule","save"])]),_:1},512)}}}),ot=pe(st,[["__scopeId","data-v-f12fe43e"]]),nt={key:0},lt={key:1},rt={class:"bg-gray-200 text-left text-sm/4 block"},it=ue({__name:"TabCalendarPage",setup(z){const o=["日","一","二","三","四","五","六"],s=y({isOpen:!1,duration:3e3,text:""}),c=y([{},{},{}]),b=y(new Ye),w=y(),m=y(),a=y(F().startOf("day")),_=y(!1),S=y({}),u=Te("eventBus"),d=async()=>{const e=await ze.create({message:"Loading..."});e.present(),Pe(1).then(t=>{b.value=L.parseUserData(t),M(),setTimeout(()=>{var r;(r=w==null?void 0:w.value)==null||r.update()},100)}).catch(t=>{console.log("getSave",t),s.value.isOpen=!0,s.value.text=JSON.stringify(t)}).finally(()=>{e.dismiss()})};$e(async()=>{d(),Ie(()=>{d()}),u.$on("menuClose",e=>{S.value=e})});function k(e){const[t,r,h]=[S.value.group,S.value.color,S.value.priority];return!(t&&t.get(e.groupId)===!1||r&&r.get(e.color)===!1||h&&h.get(e.priority)===!1)}const M=()=>{c.value=[L.createMonthData(a.value.subtract(1,"months"),b.value),L.createMonthData(a.value,b.value),L.createMonthData(a.value.add(1,"months"),b.value)]},B=e=>{M(),e.slideTo(1,0,!1),e.update(),m.value&&m.value.dt.month()!==a.value.month()&&(m.value=void 0)},j=e=>{a.value=a.value.add(1,"months").startOf("month"),B(e)},W=e=>{a.value=a.value.subtract(1,"months").startOf("month"),B(e)},N=e=>{w.value=e,e.slideTo(1,0,!1)},J=(e,t)=>{m.value=t,_.value=!0};function D(){_.value=!1}function Y(){a.value=F().startOf("day"),M()}function K(){const e=F().startOf("day");return e.month()===a.value.month()&&e.year()===a.value.year()}function X(){M(),B(w.value)}return(e,t)=>{const r=x("ion-buttons"),h=x("ion-title"),v=x("ion-button"),C=x("ion-toolbar"),P=x("ion-header"),H=x("ion-chip"),V=x("ion-content"),A=x("ion-toast"),g=x("ion-page");return f(),q(g,{id:"main-content",main:""},{default:l(()=>{var O;return[n(P,null,{default:l(()=>[n(C,null,{default:l(()=>[n(r,{slot:"start"},{default:l(()=>[n(i(He))]),_:1}),n(h,{class:"ion-text-center"},{default:l(()=>[a.value?(f(),E("div",nt,U(a.value.format("YY年MM月")),1)):(f(),E("div",lt,"日历"))]),_:1}),n(r,{slot:"end"},{default:l(()=>[K()?Ee("",!0):(f(),q(v,{key:0,style:{position:"absolute",right:"50px"},onClick:Y},{default:l(()=>t[1]||(t[1]=[Q(" 今 ")])),_:1}))]),_:1})]),_:1})]),_:1}),n(i(re),{style:{"background-color":"antiquewhite",color:"blue"}},{default:l(()=>[(f(),E(G,null,R(o,p=>n(i(ie),{class:"ion-text-center",key:p},{default:l(()=>[Q(U(p),1)]),_:2},1024)),64))]),_:1}),n(V,null,{default:l(()=>[n(i(he),{onSlideNextTransitionEnd:j,onSlidePrevTransitionEnd:W,onSwiper:N,"centered-slides":!0,autoHeight:!0,modules:[i(me),i(ve)]},{default:l(()=>[(f(!0),E(G,null,R(c.value,(p,ee)=>(f(),q(i(_e),{key:ee},{default:l(()=>[n(i(Ve),{style:{height:"auto"}},{default:l(()=>[(f(!0),E(G,null,R(p.weekArr,Z=>(f(),q(i(re),{key:Z},{default:l(()=>[(f(!0),E(G,null,R(Z,T=>(f(),q(i(ie),{class:"p-0 min-h-32 border-[1px] border-gray-100 border-solid flex-1",onClick:$=>J(p,T),key:T},{default:l(()=>[I("span",rt,[n(H,{class:ae([{transparent:T.dt.unix()!==i(F)().startOf("day").unix(),today:T.dt.unix()===i(F)().startOf("day").unix(),gray:T.dt.month()!==p.month},"py-[1px] px-1 min-h-0"])},{default:l(()=>[Q(U(T.dt.date()),1)]),_:2},1032,["class"])]),(f(!0),E(G,null,R(T.events.filter(k),($,ge)=>{var oe,ne;return f(),E("div",{key:ge,class:ae([{"text-line-through":((oe=T.save[$.id])==null?void 0:oe.state)===1,gray:((ne=T.save[$.id])==null?void 0:ne.state)===1},"text-xs text-left truncate mt-[1px] rounded-sm py-[1px] px-1"]),style:te({"background-color":i(fe)($.color).tag})},U($.title),7)}),128))]),_:2},1032,["onClick"]))),128))]),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modules"])]),_:1}),n(A,{"is-open":s.value.isOpen,message:s.value.text,duration:s.value.duration,onDidDismiss:t[0]||(t[0]=()=>s.value.isOpen=!1)},null,8,["is-open","message","duration"]),n(ot,{ref:"scheduleModal","is-open":_.value,dt:(O=m.value)==null?void 0:O.dt,userData:b.value,"onUpdate:data":X,onWillDismiss:D},null,8,["is-open","dt","userData"])]}),_:1})}}}),pt=pe(it,[["__scopeId","data-v-d779e640"]]);export{pt as default};
