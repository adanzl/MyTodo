import{g as se,c as ge,d as we,S as ye,a as de,I as ue,K as fe,b as pe}from"./swiper-vue-npxDqG0O.js";import{d as ve,i as F,C as b,w as be,c as V,a as l,r as y,o as m,b as o,j as $,t as z,Z as te,h as Q,u as i,e as P,f as G,F as R,X as Se,q as De,n as ae,R as ke,K as xe,H as he,J as le,s as Ce,v as Me,L as Ie,W as Oe,Y as me,$ as Te,D as Ee,E as $e,k as Pe,U as qe,V as ze,a0 as Ue,I as ie,g as re,l as Ne}from"./index-CitHbwVn.js";import{a as H,S as Ye,U as Ae}from"./UserData-B9K-9VU0.js";import"./ImgMgr-CX4hNcG1.js";function Be(q){const{effect:c,swiper:s,on:d,setTranslate:S,setTransition:g,overwriteParams:v,perspective:a,recreateShadows:_,getEffectParams:D}=q;d("beforeInit",()=>{if(s.params.effect!==c)return;s.classNames.push("".concat(s.params.containerModifierClass).concat(c)),a&&a()&&s.classNames.push("".concat(s.params.containerModifierClass,"3d"));const u=v?v():{};Object.assign(s.params,u),Object.assign(s.originalParams,u)}),d("setTranslate",()=>{s.params.effect===c&&S()}),d("setTransition",(u,C)=>{s.params.effect===c&&g(C)}),d("transitionEnd",()=>{if(s.params.effect===c&&_){if(!D||!D().slideShadows)return;s.slides.forEach(u=>{u.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(C=>C.remove())}),_()}});let f;d("virtualUpdate",()=>{s.params.effect===c&&(s.slides.length||(f=!0),requestAnimationFrame(()=>{f&&s.slides&&s.slides.length&&(S(),f=!1)}))})}function Fe(q,c){const s=se(c);return s!==c&&(s.style.backfaceVisibility="hidden",s.style["-webkit-backface-visibility"]="hidden"),s}function ce(q,c,s){const d="swiper-slide-shadow".concat(s?"-".concat(s):"").concat(" swiper-slide-shadow-".concat(q)),S=se(c);let g=S.querySelector(".".concat(d.split(" ").join(".")));return g||(g=ge("div",d.split(" ")),S.append(g)),g}function Ve(q){let{swiper:c,extendParams:s,on:d}=q;s({coverflowEffect:{rotate:50,stretch:0,depth:100,scale:1,modifier:1,slideShadows:!0}}),Be({effect:"coverflow",swiper:c,on:d,setTranslate:()=>{const{width:v,height:a,slides:_,slidesSizesGrid:D}=c,f=c.params.coverflowEffect,u=c.isHorizontal(),C=c.translate,I=u?-C+v/2:-C+a/2,U=u?f.rotate:-f.rotate,j=f.depth,W=we(c);for(let N=0,J=_.length;N<J;N+=1){const M=_[N],Y=D[N],K=M.swiperSlideOffset,X=(I-K-Y/2)/Y,e=typeof f.modifier=="function"?f.modifier(X):X*f.modifier;let t=u?U*e:0,n=u?0:U*e,p=-j*Math.abs(e),h=f.stretch;typeof h=="string"&&h.indexOf("%")!==-1&&(h=parseFloat(f.stretch)/100*Y);let k=u?0:h*e,E=u?h*e:0,O=1-(1-f.scale)*Math.abs(e);Math.abs(E)<.001&&(E=0),Math.abs(k)<.001&&(k=0),Math.abs(p)<.001&&(p=0),Math.abs(t)<.001&&(t=0),Math.abs(n)<.001&&(n=0),Math.abs(O)<.001&&(O=0);const A="translate3d(".concat(E,"px,").concat(k,"px,").concat(p,"px)  rotateX(").concat(W(n),"deg) rotateY(").concat(W(t),"deg) scale(").concat(O,")"),x=Fe(f,M);if(x.style.transform=A,M.style.zIndex=-Math.abs(Math.round(e))+1,f.slideShadows){let T=u?M.querySelector(".swiper-slide-shadow-left"):M.querySelector(".swiper-slide-shadow-top"),r=u?M.querySelector(".swiper-slide-shadow-right"):M.querySelector(".swiper-slide-shadow-bottom");T||(T=ce("coverflow",M,u?"left":"top")),r||(r=ce("coverflow",M,u?"right":"bottom")),T&&(T.style.opacity=e>0?e:0),r&&(r.style.opacity=-e>0?-e:0)}}},setTransition:v=>{c.slides.map(_=>se(_)).forEach(_=>{_.style.transitionDuration="".concat(v,"ms"),_.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(D=>{D.style.transitionDuration="".concat(v,"ms")})})},perspective:()=>!0,overwriteParams:()=>({watchSlidesProgress:!0})})}const He={style:{"font-size":"20px",color:"white"}},Ge=["onClick"],Re={class:"flex"},We={class:"schedule-lb-sub"},Xe={class:"schedule-lb-group"},je=ve({__name:"CalendarCover",props:{dt:{type:Object,default:F()},userData:{type:Object,required:!0}},emits:["update:data"],setup(q,{emit:c}){const s=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],d=q,S=c,g=b([{},{},{}]),v=b(),a=b(F(d.dt)),_=b(),D=b(),f=b(),u=b(),C=b(!1);be(()=>d.dt,e=>{a.value=e,I()},{deep:!0});const I=()=>{g.value=[H.createDayData(a.value.subtract(1,"day"),d.userData),H.createDayData(a.value,d.userData),H.createDayData(a.value.add(1,"day"),d.userData)]};function U(e){if(e.activeIndex===1)return;const t=e.activeIndex,n=e.previousIndex;t<n?(a.value=a.value.subtract(1,"day"),I(),e.slideTo(1,0,!1)):t>n&&(a.value=a.value.add(1,"day"),I(),e.slideTo(1,0,!1))}const j=e=>{v.value=e,e.slideTo(1,0,!1)},W=(e,t)=>{var n;try{return(n=t==null?void 0:t.subtasks)==null?void 0:n.filter(p=>{var h,k;return(((h=e.save[t.id])==null?void 0:h.subtasks)&&((k=e.save[t.id])==null?void 0:k.subtasks[p.id])||0)===1}).length}catch(p){return console.log("countFinishedSubtask",p),0}},N=(e,t,n)=>{if(t){const p=t.save[n]||new Ye;p.state=e.detail.checked?1:0,t.save[n]=p,Oe(()=>{t.events.sort((h,k)=>{var A,x,T,r;const E=((A=t.save[h.id])==null?void 0:A.state)||0,O=((x=t.save[k.id])==null?void 0:x.state)||0;return E===O?((T=h.id)!=null?T:0)-((r=k.id)!=null?r:0):E-O})}),Y(),S("update:data",a.value)}},J=(e,t,n)=>{C.value=!0,f.value=t,u.value=n.save[t.id]},M=e=>{if(C.value=!1,e.detail.role==="backdrop")return;const[t,n]=e.detail.data,p=a.value;H.updateSchedularData(d.userData,t,n,p,e.detail.role)&&(I(),Y(),S("update:data",a.value))};function Y(){Se(d.userData.id,d.userData.name,JSON.stringify(d.userData)).then(e=>{console.log("doSaveUserData",e)}).catch(e=>{console.log("doSaveUserData",e)})}function K(){var e;a.value=F(),I(),(e=v==null?void 0:v.value)==null||e.slideTo(1,0,!1)}const X=()=>{f.value=void 0,u.value=void 0,C.value=!0};return(e,t)=>{const n=y("Icon"),p=y("ion-button"),h=y("ion-item"),k=y("ion-icon"),E=y("ion-label"),O=y("ion-content"),A=y("ion-modal");return m(),V(A,{mode:"ios","aria-hidden":"false",ref_key:"selfRef",ref:_},{default:l(()=>[o(O,{class:"main_content"},{default:l(()=>[o(h,{class:"transparent"},{default:l(()=>[$("h2",He,z(a.value.format("YYYY-MM-DD")+" "+s[a.value.day()]),1),o(p,{slot:"end",color:"danger",onClick:K,size:"default",style:te({padding:"0px 10px",opacity:a.value.isToday()?"0":"1"})},{default:l(()=>[o(n,{icon:"mdi:calendar-today-outline",height:"16",slot:"start"}),t[1]||(t[1]=Q(" 今天 "))]),_:1},8,["style"])]),_:1}),o(i(de),{onTransitionEnd:U,onSwiper:j,"centered-slides":!0,modules:[i(ue),i(fe),i(Ve)],effect:"coverflow",slidesPerView:"auto",freeMode:!1,coverflowEffect:{rotate:10,stretch:0,depth:100,modifier:1,slideShadows:!1},keyboard:!0,style:{height:"90%"}},{default:l(()=>[(m(!0),P(R,null,G(g.value,(x,T)=>(m(),V(i(pe),{key:T,class:"data-content"},{default:l(()=>[o(O,null,{default:l(()=>[o(h,{color:"light"},{default:l(()=>[o(n,{icon:"mdi:list-status",style:{color:"var(--ion-color-tertiary)"},height:"40",slot:"start"}),t[2]||(t[2]=$("div",{style:{height:"50px"}},null,-1))]),_:1}),(m(!0),P(R,null,G(x.events,(r,B)=>(m(),V(h,{key:B},{default:l(()=>{var ee,L;return[o(i(De),{style:{"--size":"26px","padding-right":"5px"},slot:"start",checked:((ee=x.save[r.id])==null?void 0:ee.state)===1,onIonChange:w=>N(w,x,r.id)},null,8,["checked","onIonChange"]),$("div",{onClick:w=>J(w,r,x),class:"scheduleItem"},[o(E,{class:ae({"text-line-through":((L=x.save[r.id])==null?void 0:L.state)===1})},{default:l(()=>{var w;return[$("h2",null,z(r.title),1),$("div",Re,[$("p",We,[o(k,{icon:i(ke),style:{position:"relative",top:"3px"}},null,8,["icon"]),Q(" "+z(W(x,r))+" / "+z((w=r==null?void 0:r.subtasks)==null?void 0:w.length),1)]),$("p",Xe,z(i(xe)(r.groupId).label),1)])]}),_:2},1032,["class"]),$("span",{class:"v-dot",style:te({"background-color":i(he)(r.color).tag,"margin-left":"10px"})},null,4),o(n,{icon:i(le)(r.priority).icon,height:"36",color:i(le)(r.priority).color},null,8,["icon","color"])],8,Ge)]}),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modules"]),o(i(Ce),{slot:"fixed",vertical:"bottom",horizontal:"end"},{default:l(()=>[o(i(Me),{onClick:X},{default:l(()=>[o(k,{icon:i(Ie),size:"large"},null,8,["icon"])]),_:1})]),_:1})]),_:1}),$("div",{style:{width:"100%",height:"10%"},onClick:t[0]||(t[0]=x=>_.value.$el.dismiss())}),o(ye,{id:"pop-modal",ref_key:"scheduleModal",ref:D,"is-open":C.value,modal:D.value,schedule:f.value,save:u.value,onWillDismiss:M},null,8,["is-open","modal","schedule","save"])]),_:1},512)}}}),Je=me(je,[["__scopeId","data-v-2049650d"]]),Ke={key:0},Le={key:1},Ze=ve({__name:"TabCalendarPage",setup(q){const c=["日","一","二","三","四","五","六"],s=b({isOpen:!1,duration:3e3,text:""}),d=b([{},{},{}]),S=b(new Ae),g=b(),v=b(),a=b(F().startOf("day")),_=b(!1),D=b({}),f=Te("eventBus"),u=async()=>{const e=await qe.create({message:"Loading..."});e.present(),ze(1).then(t=>{S.value=H.parseUserData(t),I(),setTimeout(()=>{var n;(n=g==null?void 0:g.value)==null||n.update()},100)}).catch(t=>{console.log("getSave",t),s.value.isOpen=!0,s.value.text=JSON.stringify(t)}).finally(()=>{e.dismiss()})};Ee(async()=>{u(),$e(()=>{u()}),f.$on("menuClose",e=>{console.log("menuClose",e),D.value=e})});function C(e){const[t,n,p]=[D.value.group,D.value.color,D.value.priority];return!(t&&t.get(e.groupId)===!1||n&&n.get(e.color)===!1||p&&p.get(e.priority)===!1)}const I=()=>{d.value=[H.createMonthData(a.value.subtract(1,"months"),S.value),H.createMonthData(a.value,S.value),H.createMonthData(a.value.add(1,"months"),S.value)]},U=e=>{I(),e.slideTo(1,0,!1),e.update(),v.value&&v.value.dt.month()!==a.value.month()&&(v.value=void 0)},j=e=>{a.value=a.value.add(1,"months").startOf("month"),U(e)},W=e=>{a.value=a.value.subtract(1,"months").startOf("month"),U(e)},N=e=>{g.value=e,e.slideTo(1,0,!1)},J=(e,t)=>{v.value=t,_.value=!0};function M(){_.value=!1}function Y(){a.value=F().startOf("day"),I()}function K(){const e=F().startOf("day");return e.month()===a.value.month()&&e.year()===a.value.year()}function X(){I(),U(g.value)}return(e,t)=>{const n=y("ion-buttons"),p=y("ion-title"),h=y("ion-button"),k=y("ion-toolbar"),E=y("ion-header"),O=y("ion-chip"),A=y("ion-content"),x=y("ion-toast"),T=y("ion-page");return m(),V(T,{id:"main-content",main:""},{default:l(()=>{var r;return[o(E,null,{default:l(()=>[o(k,null,{default:l(()=>[o(n,{slot:"start"},{default:l(()=>[o(i(Ue))]),_:1}),o(p,{class:"ion-text-center"},{default:l(()=>[a.value?(m(),P("div",Ke,z(a.value.format("YY年MM月")),1)):(m(),P("div",Le,"日历"))]),_:1}),o(n,{slot:"end"},{default:l(()=>[K()?Pe("",!0):(m(),V(h,{key:0,style:{position:"absolute",right:"50px"},onClick:Y},{default:l(()=>t[1]||(t[1]=[Q(" 今 ")])),_:1}))]),_:1})]),_:1})]),_:1}),o(i(ie),{style:{"background-color":"antiquewhite",color:"blue"}},{default:l(()=>[(m(),P(R,null,G(c,B=>o(i(re),{class:"ion-text-center",key:B},{default:l(()=>[Q(z(B),1)]),_:2},1024)),64))]),_:1}),o(A,null,{default:l(()=>[o(i(de),{onSlideNextTransitionEnd:j,onSlidePrevTransitionEnd:W,onSwiper:N,"centered-slides":!0,autoHeight:!0,modules:[i(ue),i(fe)]},{default:l(()=>[(m(!0),P(R,null,G(d.value,(B,ee)=>(m(),V(i(pe),{key:ee},{default:l(()=>[o(i(Ne),{style:{height:"auto"},fixed:""},{default:l(()=>[(m(!0),P(R,null,G(B.weekArr,L=>(m(),V(i(ie),{key:L},{default:l(()=>[(m(!0),P(R,null,G(L,w=>(m(),V(i(re),{class:"day-item",onClick:Z=>J(B,w),key:w},{default:l(()=>[$("span",null,[o(O,{class:ae({transparent:w.dt.unix()!==i(F)().startOf("day").unix(),today:w.dt.unix()===i(F)().startOf("day").unix(),gray:w.dt.month()!==B.month})},{default:l(()=>[Q(z(w.dt.date()),1)]),_:2},1032,["class"])]),(m(!0),P(R,null,G(w.events.filter(C),(Z,_e)=>{var oe,ne;return m(),P("div",{key:_e,class:ae({"text-line-through":((oe=w.save[Z.id])==null?void 0:oe.state)===1,gray:((ne=w.save[Z.id])==null?void 0:ne.state)===1}),style:te({"background-color":i(he)(Z.color).tag})},z(Z.title),7)}),128))]),_:2},1032,["onClick"]))),128))]),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modules"])]),_:1}),o(x,{"is-open":s.value.isOpen,message:s.value.text,duration:s.value.duration,onDidDismiss:t[0]||(t[0]=()=>s.value.isOpen=!1)},null,8,["is-open","message","duration"]),o(Je,{ref:"scheduleModal","is-open":_.value,dt:(r=v.value)==null?void 0:r.dt,userData:S.value,"onUpdate:data":X,onWillDismiss:M},null,8,["is-open","dt","userData"])]}),_:1})}}}),st=me(Ze,[["__scopeId","data-v-1697f356"]]);export{st as default};
