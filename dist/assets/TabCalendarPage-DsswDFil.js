import{g as ee,c as _e,d as ge,S as we,a as re,I as ce,K as de,b as ue}from"./swiper-vue-Dj-OUrex.js";import{c as R,I as se,b as be,g as fe,a as oe,S as ye,_ as pe,U as Se}from"./UserData-CwZyRbKM.js";import{d as he,i as G,C as k,w as De,c as Y,a as n,f as D,o as h,b as l,j as F,t as z,u as o,h as K,k as ve,e as q,r as W,F as X,T as ke,q as xe,n as Z,N as Ce,U as me,s as Me,v as Te,G as Oe,S as Ie,D as Ee,E as $e,Q as Pe,R as qe,I as ne,g as le,l as ze}from"./index-CE6wyhGh.js";import"./ImgMgr-CPGmVIE-.js";function Ue(U){const{effect:d,swiper:a,on:u,setTranslate:y,setTransition:b,overwriteParams:v,perspective:t,recreateShadows:g,getEffectParams:O}=U;u("beforeInit",()=>{if(a.params.effect!==d)return;a.classNames.push("".concat(a.params.containerModifierClass).concat(d)),t&&t()&&a.classNames.push("".concat(a.params.containerModifierClass,"3d"));const r=v?v():{};Object.assign(a.params,r),Object.assign(a.originalParams,r)}),u("setTranslate",()=>{a.params.effect===d&&y()}),u("setTransition",(r,x)=>{a.params.effect===d&&b(x)}),u("transitionEnd",()=>{if(a.params.effect===d&&g){if(!O||!O().slideShadows)return;a.slides.forEach(r=>{r.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(x=>x.remove())}),g()}});let i;u("virtualUpdate",()=>{a.params.effect===d&&(a.slides.length||(i=!0),requestAnimationFrame(()=>{i&&a.slides&&a.slides.length&&(y(),i=!1)}))})}function Ne(U,d){const a=ee(d);return a!==d&&(a.style.backfaceVisibility="hidden",a.style["-webkit-backface-visibility"]="hidden"),a}function ie(U,d,a){const u="swiper-slide-shadow".concat(a?"-".concat(a):"").concat(" swiper-slide-shadow-".concat(U)),y=ee(d);let b=y.querySelector(".".concat(u.split(" ").join(".")));return b||(b=_e("div",u.split(" ")),y.append(b)),b}function Ae(U){let{swiper:d,extendParams:a,on:u}=U;a({coverflowEffect:{rotate:50,stretch:0,depth:100,scale:1,modifier:1,slideShadows:!0}}),Ue({effect:"coverflow",swiper:d,on:u,setTranslate:()=>{const{width:v,height:t,slides:g,slidesSizesGrid:O}=d,i=d.params.coverflowEffect,r=d.isHorizontal(),x=d.translate,N=r?-x+v/2:-x+t/2,j=r?i.rotate:-i.rotate,L=i.depth,J=ge(d);for(let V=0,Q=g.length;V<Q;V+=1){const C=g[V],c=O[V],S=C.swiperSlideOffset,A=(N-S-c/2)/c,e=typeof i.modifier=="function"?i.modifier(A):A*i.modifier;let s=r?j*e:0,p=r?0:j*e,m=-L*Math.abs(e),w=i.stretch;typeof w=="string"&&w.indexOf("%")!==-1&&(w=parseFloat(i.stretch)/100*c);let M=r?0:w*e,$=r?w*e:0,P=1-(1-i.scale)*Math.abs(e);Math.abs($)<.001&&($=0),Math.abs(M)<.001&&(M=0),Math.abs(m)<.001&&(m=0),Math.abs(s)<.001&&(s=0),Math.abs(p)<.001&&(p=0),Math.abs(P)<.001&&(P=0);const _="translate3d(".concat($,"px,").concat(M,"px,").concat(m,"px)  rotateX(").concat(J(p),"deg) rotateY(").concat(J(s),"deg) scale(").concat(P,")"),T=Ne(i,C);if(T.style.transform=_,C.style.zIndex=-Math.abs(Math.round(e))+1,i.slideShadows){let f=r?C.querySelector(".swiper-slide-shadow-left"):C.querySelector(".swiper-slide-shadow-top"),I=r?C.querySelector(".swiper-slide-shadow-right"):C.querySelector(".swiper-slide-shadow-bottom");f||(f=ie("coverflow",C,r?"left":"top")),I||(I=ie("coverflow",C,r?"right":"bottom")),f&&(f.style.opacity=e>0?e:0),I&&(I.style.opacity=-e>0?-e:0)}}},setTransition:v=>{d.slides.map(g=>ee(g)).forEach(g=>{g.style.transitionDuration="".concat(v,"ms"),g.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(O=>{O.style.transitionDuration="".concat(v,"ms")})})},perspective:()=>!0,overwriteParams:()=>({watchSlidesProgress:!0})})}const Fe={style:{"font-size":"20px",color:"white"}},Ye=["onClick"],Ve={class:"flex"},Be={class:"schedule-lb-sub"},He={class:"schedule-lb-group"},Ge=he({__name:"CalendarCover",props:{dt:{type:Object,default:G()},userData:{type:Object,required:!0}},emits:["update:data"],setup(U,{emit:d}){const a=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],u=U,y=d,b=k([{},{},{}]),v=k(),t=k(G(u.dt)),g=k(),O=k(),i=k(),r=k(),x=k(!1);De(()=>u.dt,e=>{t.value=e,N()},{deep:!0});const N=()=>{b.value=[R.createDayData(t.value.subtract(1,"day"),u.userData),R.createDayData(t.value,u.userData),R.createDayData(t.value.add(1,"day"),u.userData)]};function j(e){if(e.activeIndex===1)return;const s=e.activeIndex,p=e.previousIndex;s<p?(t.value=t.value.subtract(1,"day"),N(),e.slideTo(1,0,!1)):s>p&&(t.value=t.value.add(1,"day"),N(),e.slideTo(1,0,!1))}const L=e=>{v.value=e,e.slideTo(1,0,!1)},J=(e,s)=>{var p;try{return(p=s==null?void 0:s.subtasks)==null?void 0:p.filter(m=>{var w,M;return(((w=e.save[s.id])==null?void 0:w.subtasks)&&((M=e.save[s.id])==null?void 0:M.subtasks[m.id])||0)===1}).length}catch(m){return console.log("countFinishedSubtask",m),0}},V=(e,s,p)=>{if(s){const m=s.save[p]||new ye;m.state=e.detail.checked?1:0,s.save[p]=m,Ie(()=>{s.events.sort((w,M)=>{var _,T,f,I;const $=((_=s.save[w.id])==null?void 0:_.state)||0,P=((T=s.save[M.id])==null?void 0:T.state)||0;return $===P?((f=w.id)!=null?f:0)-((I=M.id)!=null?I:0):$-P})}),c(),y("update:data",t.value)}},Q=(e,s,p)=>{x.value=!0,i.value=s,r.value=p.save[s.id]},C=e=>{if(x.value=!1,e.detail.role==="backdrop")return;const[s,p]=e.detail.data,m=t.value;R.updateSchedularData(u.userData,s,p,m,e.detail.role)&&(N(),c(),y("update:data",t.value))};function c(){ke(u.userData.id,u.userData.name,JSON.stringify(u.userData)).then(e=>{console.log("doSaveUserData",e)}).catch(e=>{console.log("doSaveUserData",e)})}function S(){var e;t.value=G(),N(),(e=v==null?void 0:v.value)==null||e.slideTo(1,0,!1)}const A=()=>{i.value=void 0,r.value=void 0,x.value=!0};return(e,s)=>{const p=D("ion-button"),m=D("ion-item"),w=D("ion-icon"),M=D("ion-label"),$=D("ion-content"),P=D("ion-modal");return h(),Y(P,{mode:"ios","aria-hidden":"false",ref_key:"selfRef",ref:g},{default:n(()=>[l($,{class:"main_content"},{default:n(()=>[l(m,{class:"transparent"},{default:n(()=>[F("h2",Fe,z(t.value.format("YYYY-MM-DD")+" "+a[t.value.day()]),1),t.value.isToday()?ve("",!0):(h(),Y(p,{key:0,slot:"end",color:"danger",onClick:S,size:"medium"},{default:n(()=>[l(o(se),{icon:"mdi:calendar-today-outline",height:"16"}),s[1]||(s[1]=K(" 今天 "))]),_:1}))]),_:1}),l(o(re),{onTransitionEnd:j,onSwiper:L,"centered-slides":!0,modules:[o(ce),o(de),o(Ae)],effect:"coverflow",slidesPerView:"auto",freeMode:!1,coverflowEffect:{rotate:10,stretch:0,depth:100,modifier:1,slideShadows:!1},keyboard:!0,style:{height:"90%"}},{default:n(()=>[(h(!0),q(X,null,W(b.value,(_,T)=>(h(),Y(o(ue),{key:T,class:"data-content"},{default:n(()=>[l($,null,{default:n(()=>[l(m,null,{default:n(()=>[K("日程 "+z(_==null?void 0:_.dt.format("MM-DD")),1)]),_:2},1024),(h(!0),q(X,null,W(_.events,(f,I)=>(h(),Y(m,{key:I},{default:n(()=>{var E,B;return[l(o(xe),{style:{"--size":"26px","padding-right":"5px"},slot:"start",checked:((E=_.save[f.id])==null?void 0:E.state)===1,onIonChange:H=>V(H,_,f.id)},null,8,["checked","onIonChange"]),F("div",{onClick:H=>Q(H,f,_),class:"scheduleItem"},[l(M,{class:Z({"text-line-through":((B=_.save[f.id])==null?void 0:B.state)===1})},{default:n(()=>{var H;return[F("h2",null,z(f.title),1),F("div",Ve,[F("p",Be,[l(w,{icon:o(Ce),style:{position:"relative",top:"3px"}},null,8,["icon"]),K(" "+z(J(_,f))+" / "+z((H=f==null?void 0:f.subtasks)==null?void 0:H.length),1)]),F("p",He,z(o(be)(f.groupId).label),1)])]}),_:2},1032,["class"]),F("span",{class:"v-dot",style:me({"background-color":o(fe)(f.color).tag,"margin-left":"10px"})},null,4),l(o(se),{icon:o(oe)(f.priority).icon,height:"36",color:o(oe)(f.priority).color},null,8,["icon","color"])],8,Ye)]}),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modules"]),l(o(Me),{slot:"fixed",vertical:"bottom",horizontal:"end"},{default:n(()=>[l(o(Te),{onClick:A},{default:n(()=>[l(w,{icon:o(Oe),size:"large"},null,8,["icon"])]),_:1})]),_:1})]),_:1}),F("div",{style:{width:"100%",height:"10%"},onClick:s[0]||(s[0]=_=>g.value.$el.dismiss())}),l(we,{id:"pop-modal",ref_key:"scheduleModal",ref:O,"is-open":x.value,modal:O.value,schedule:i.value,save:r.value,onWillDismiss:C},null,8,["is-open","modal","schedule","save"])]),_:1},512)}}}),Re=pe(Ge,[["__scopeId","data-v-0910cf82"]]),We={key:0},Xe={key:1},je=he({__name:"TabCalendarPage",setup(U){const d=["日","一","二","三","四","五","六"],a=k({isOpen:!1,duration:3e3,text:""}),u=k([{},{},{}]),y=k(new Se),b=k(),v=k(),t=k(G().startOf("day")),g=k(!1),O=async()=>{const c=await Pe.create({message:"Loading..."});c.present(),qe(1).then(S=>{y.value=R.parseUserData(S),i(),setTimeout(()=>{var A;(A=b==null?void 0:b.value)==null||A.update()},100)}).catch(S=>{console.log("getSave",S),a.value.isOpen=!0,a.value.text=JSON.stringify(S)}).finally(()=>{c.dismiss()})};Ee(async()=>{O(),$e(()=>{O()})});const i=()=>{u.value=[R.createMonthData(t.value.subtract(1,"months"),y.value),R.createMonthData(t.value,y.value),R.createMonthData(t.value.add(1,"months"),y.value)]},r=c=>{i(),c.slideTo(1,0,!1),c.update(),v.value&&v.value.dt.month()!==t.value.month()&&(v.value=void 0)},x=c=>{t.value=t.value.add(1,"months").startOf("month"),r(c)},N=c=>{t.value=t.value.subtract(1,"months").startOf("month"),r(c)},j=c=>{b.value=c,c.slideTo(1,0,!1)},L=(c,S)=>{v.value=S,g.value=!0};function J(){g.value=!1}function V(){t.value=G().startOf("day"),i()}function Q(){const c=G().startOf("day");return c.month()===t.value.month()&&c.year()===t.value.year()}function C(){i(),r(b.value)}return(c,S)=>{const A=D("ion-title"),e=D("ion-button"),s=D("ion-buttons"),p=D("ion-toolbar"),m=D("ion-header"),w=D("ion-chip"),M=D("ion-content"),$=D("ion-toast"),P=D("ion-page");return h(),Y(P,null,{default:n(()=>{var _;return[l(m,null,{default:n(()=>[l(p,null,{default:n(()=>[l(A,{class:"ion-text-center"},{default:n(()=>[t.value?(h(),q("div",We,z(t.value.format("YY年MM月")),1)):(h(),q("div",Xe,"日历"))]),_:1}),l(s,{slot:"end"},{default:n(()=>[Q()?ve("",!0):(h(),Y(e,{key:0,style:{position:"absolute",right:"50px"},onClick:V},{default:n(()=>S[1]||(S[1]=[K(" 今 ")])),_:1}))]),_:1})]),_:1})]),_:1}),l(o(ne),{style:{"background-color":"antiquewhite",color:"blue"}},{default:n(()=>[(h(),q(X,null,W(d,T=>l(o(le),{class:"ion-text-center",key:T},{default:n(()=>[K(z(T),1)]),_:2},1024)),64))]),_:1}),l(M,null,{default:n(()=>[l(o(re),{onSlideNextTransitionEnd:x,onSlidePrevTransitionEnd:N,onSwiper:j,"centered-slides":!0,autoHeight:!0,modules:[o(ce),o(de)]},{default:n(()=>[(h(!0),q(X,null,W(u.value,(T,f)=>(h(),Y(o(ue),{key:f},{default:n(()=>[l(o(ze),{style:{height:"auto"},fixed:""},{default:n(()=>[(h(!0),q(X,null,W(T.weekArr,I=>(h(),Y(o(ne),{key:I},{default:n(()=>[(h(!0),q(X,null,W(I,E=>(h(),Y(o(le),{class:"day-item",onClick:B=>L(T,E),key:E},{default:n(()=>[F("span",null,[l(w,{class:Z({transparent:E.dt.unix()!==o(G)().startOf("day").unix(),today:E.dt.unix()===o(G)().startOf("day").unix(),gray:E.dt.month()!==T.month})},{default:n(()=>[K(z(E.dt.date()),1)]),_:2},1032,["class"])]),(h(!0),q(X,null,W(E.events,(B,H)=>{var te,ae;return h(),q("div",{key:H,class:Z({"text-line-through":((te=E.save[B.id])==null?void 0:te.state)===1,gray:((ae=E.save[B.id])==null?void 0:ae.state)===1}),style:me({"background-color":o(fe)(B.color).tag})},z(B.title),7)}),128))]),_:2},1032,["onClick"]))),128))]),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modules"])]),_:1}),l($,{"is-open":a.value.isOpen,message:a.value.text,duration:a.value.duration,onDidDismiss:S[0]||(S[0]=()=>a.value.isOpen=!1)},null,8,["is-open","message","duration"]),l(Re,{ref:"scheduleModal","is-open":g.value,dt:(_=v.value)==null?void 0:_.dt,userData:y.value,"onUpdate:data":C,onWillDismiss:J},null,8,["is-open","dt","userData"])]}),_:1})}}}),Ze=pe(je,[["__scopeId","data-v-fd605a90"]]);export{Ze as default};
