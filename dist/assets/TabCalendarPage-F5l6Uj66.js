import{a0 as de,o as f,e as I,j as $,d as ue,i as Y,C as b,w as we,c as P,a as r,r as x,b as n,t as H,Z as te,h as Q,u as i,f as F,F as L,X as be,q as Se,n as ae,R as xe,K as ye,H as fe,$ as De,J as le,s as ke,v as Ce,L as Me,W as Te,Y as pe,a1 as Oe,D as $e,E as Ie,k as Ee,U as ze,V as Pe,a2 as He,I as re,g as ie,l as Ve}from"./index-CC0wanHv.js";import{g as se,c as qe,d as Ue,S as Be,a as ve,I as he,K as me,b as _e}from"./swiper-vue-DiRZkDYd.js";import{a as V,b as Ne,S as Ye,U as Ae}from"./UserData-COZURHve.js";import"./ImgMgr-B66r0HH6.js";function Fe(E){const{effect:o,swiper:s,on:c,setTranslate:S,setTransition:g,overwriteParams:m,perspective:a,recreateShadows:_,getEffectParams:y}=E;c("beforeInit",()=>{if(s.params.effect!==o)return;s.classNames.push("".concat(s.params.containerModifierClass).concat(o)),a&&a()&&s.classNames.push("".concat(s.params.containerModifierClass,"3d"));const d=m?m():{};Object.assign(s.params,d),Object.assign(s.originalParams,d)}),c("setTranslate",()=>{s.params.effect===o&&S()}),c("setTransition",(d,k)=>{s.params.effect===o&&g(k)}),c("transitionEnd",()=>{if(s.params.effect===o&&_){if(!y||!y().slideShadows)return;s.slides.forEach(d=>{d.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(k=>k.remove())}),_()}});let u;c("virtualUpdate",()=>{s.params.effect===o&&(s.slides.length||(u=!0),requestAnimationFrame(()=>{u&&s.slides&&s.slides.length&&(S(),u=!1)}))})}function Le(E,o){const s=se(o);return s!==o&&(s.style.backfaceVisibility="hidden",s.style["-webkit-backface-visibility"]="hidden"),s}function ce(E,o,s){const c="swiper-slide-shadow".concat(s?"-".concat(s):"").concat(" swiper-slide-shadow-".concat(E)),S=se(o);let g=S.querySelector(".".concat(c.split(" ").join(".")));return g||(g=qe("div",c.split(" ")),S.append(g)),g}function Re(E){let{swiper:o,extendParams:s,on:c}=E;s({coverflowEffect:{rotate:50,stretch:0,depth:100,scale:1,modifier:1,slideShadows:!0}}),Fe({effect:"coverflow",swiper:o,on:c,setTranslate:()=>{const{width:m,height:a,slides:_,slidesSizesGrid:y}=o,u=o.params.coverflowEffect,d=o.isHorizontal(),k=o.translate,M=d?-k+m/2:-k+a/2,q=d?u.rotate:-u.rotate,X=u.depth,R=Ue(o);for(let U=0,j=_.length;U<j;U+=1){const C=_[U],B=y[U],J=C.swiperSlideOffset,G=(M-J-B/2)/B,e=typeof u.modifier=="function"?u.modifier(G):G*u.modifier;let t=d?q*e:0,l=d?0:q*e,v=-X*Math.abs(e),h=u.stretch;typeof h=="string"&&h.indexOf("%")!==-1&&(h=parseFloat(u.stretch)/100*B);let T=d?0:h*e,N=d?h*e:0,A=1-(1-u.scale)*Math.abs(e);Math.abs(N)<.001&&(N=0),Math.abs(T)<.001&&(T=0),Math.abs(v)<.001&&(v=0),Math.abs(t)<.001&&(t=0),Math.abs(l)<.001&&(l=0),Math.abs(A)<.001&&(A=0);const W="translate3d(".concat(N,"px,").concat(T,"px,").concat(v,"px)  rotateX(").concat(R(l),"deg) rotateY(").concat(R(t),"deg) scale(").concat(A,")"),K=Le(u,C);if(K.style.transform=W,C.style.zIndex=-Math.abs(Math.round(e))+1,u.slideShadows){let w=d?C.querySelector(".swiper-slide-shadow-left"):C.querySelector(".swiper-slide-shadow-top"),z=d?C.querySelector(".swiper-slide-shadow-right"):C.querySelector(".swiper-slide-shadow-bottom");w||(w=ce("coverflow",C,d?"left":"top")),z||(z=ce("coverflow",C,d?"right":"bottom")),w&&(w.style.opacity=e>0?e:0),z&&(z.style.opacity=-e>0?-e:0)}}},setTransition:m=>{o.slides.map(_=>se(_)).forEach(_=>{_.style.transitionDuration="".concat(m,"ms"),_.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(y=>{y.style.transitionDuration="".concat(m,"ms")})})},perspective:()=>!0,overwriteParams:()=>({watchSlidesProgress:!0})})}const Ge={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function We(E,o){return f(),I("svg",Ge,o[0]||(o[0]=[$("path",{fill:"currentColor",d:"M16.5 11L13 7.5l1.4-1.4l2.1 2.1L20.7 4l1.4 1.4zM11 7H2v2h9zm10 6.4L19.6 12L17 14.6L14.4 12L13 13.4l2.6 2.6l-2.6 2.6l1.4 1.4l2.6-2.6l2.6 2.6l1.4-1.4l-2.6-2.6zM11 15H2v2h9z"},null,-1)]))}const Xe=de({name:"mdi-list-status",render:We}),je={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Je(E,o){return f(),I("svg",je,o[0]||(o[0]=[$("path",{fill:"currentColor",d:"M19 3h-1V1h-2v2H8V1H6v2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.11 0 2-.89 2-2V5c0-1.11-.89-2-2-2m0 16H5V9h14zm0-12H5V5h14M7 11h5v5H7"},null,-1)]))}const Ke=de({name:"mdi-calendar-today-outline",render:Je}),Ze={class:"text-xl font-bold text-white"},Qe=["onClick"],et={class:"truncate"},tt={class:"flex"},at={class:"schedule-lb-sub"},st={class:"schedule-lb-group"},ot=ue({__name:"CalendarCover",props:{dt:{type:Object,default:Y()},userData:{type:Object,required:!0}},emits:["update:data"],setup(E,{emit:o}){const s=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],c=E,S=o,g=b([{},{},{}]),m=b(),a=b(Y(c.dt)),_=b(),y=b(),u=b(),d=b(),k=b(!1);we(()=>c.dt,e=>{a.value=e,M()},{deep:!0});const M=()=>{g.value=[V.createDayData(a.value.subtract(1,"day"),c.userData),V.createDayData(a.value,c.userData),V.createDayData(a.value.add(1,"day"),c.userData)]};function q(e){if(e.activeIndex===1)return;const t=e.activeIndex,l=e.previousIndex;t<l?(a.value=a.value.subtract(1,"day"),M(),e.slideTo(1,0,!1)):t>l&&(a.value=a.value.add(1,"day"),M(),e.slideTo(1,0,!1))}const X=e=>{m.value=e,e.slideTo(1,0,!1)},R=(e,t)=>{var l;try{return(l=t==null?void 0:t.subtasks)==null?void 0:l.filter(v=>{var h,T;return(e.save&&((h=e.save[t.id])==null?void 0:h.subtasks)&&((T=e.save[t.id])==null?void 0:T.subtasks[v.id])||0)===1}).length}catch(v){return console.log("countFinishedSubtask",v),0}},U=(e,t,l)=>{if(t){if(t.save===void 0){t.save={};const h=c.userData.save;h[Ne(t.dt)]=t.save}const v=t.save[l]||new Ye;v.state=e.detail.checked?1:0,t.save[l]=v,Te(()=>{t.events.sort((h,T)=>V.CmpScheduleData(h,T,t.save))}),B(),S("update:data",a.value)}},j=(e,t,l)=>{k.value=!0,u.value=t,d.value=l.save?l.save[t.id]:void 0},C=e=>{if(k.value=!1,e.detail.role==="backdrop")return;const[t,l]=e.detail.data,v=a.value;V.updateSchedularData(c.userData,t,l,v,e.detail.role)&&(M(),B(),S("update:data",a.value))};function B(){be(c.userData.id,c.userData.name,JSON.stringify(c.userData)).then(e=>{console.log("doSaveUserData",e)}).catch(e=>{console.log("doSaveUserData",e)})}function J(){var e;a.value=Y(),M(),(e=m==null?void 0:m.value)==null||e.slideTo(1,0,!1)}const G=()=>{u.value=void 0,d.value=void 0,k.value=!0};return(e,t)=>{const l=Ke,v=x("ion-button"),h=x("ion-item"),T=Xe,N=x("ion-icon"),A=x("ion-label"),W=x("ion-content"),K=x("ion-modal");return f(),P(K,{mode:"ios",ref_key:"selfRef",ref:_},{default:r(()=>[n(W,{class:"main_content"},{default:r(()=>[n(h,{class:"transparent"},{default:r(()=>[$("h2",Ze,H(a.value.format("YYYY-MM-DD")+" "+s[a.value.day()]),1),n(v,{slot:"end",color:"danger",onClick:J,size:"default",style:te({padding:"0px 10px",opacity:a.value.isToday()?"0":"1"})},{default:r(()=>[n(l,{height:"16",slot:"start"}),t[1]||(t[1]=Q(" 今天 "))]),_:1},8,["style"])]),_:1}),n(i(ve),{onTransitionEnd:q,onSwiper:X,"centered-slides":!0,modules:[i(he),i(me),i(Re)],effect:"coverflow",slidesPerView:"auto",freeMode:!1,coverflowEffect:{rotate:10,stretch:0,depth:100,modifier:1,slideShadows:!1},keyboard:!0,class:"h-[90%]"},{default:r(()=>[(f(!0),I(L,null,F(g.value,(w,z)=>(f(),P(i(_e),{key:z,class:"data-content"},{default:r(()=>[n(W,null,{default:r(()=>[n(h,{color:"light"},{default:r(()=>[n(T,{class:"text-blue-500",height:"30",width:"30",slot:"start"}),t[2]||(t[2]=$("div",{class:"h-12"},null,-1))]),_:1}),(f(!0),I(L,null,F(w.events,(p,ee)=>(f(),P(h,{key:ee},{default:r(()=>{var Z,D;return[n(i(Se),{style:{"--size":"26px"},slot:"start",checked:w.save&&((Z=w.save[p.id])==null?void 0:Z.state)===1,onIonChange:O=>U(O,w,p.id)},null,8,["checked","onIonChange"]),$("div",{onClick:O=>j(O,p,w),class:"flex w-full items-center"},[n(A,{class:ae([{"text-line-through":w.save&&((D=w.save[p.id])==null?void 0:D.state)===1},"p-2.5 flex-1"])},{default:r(()=>{var O;return[$("h2",et,H(p.title),1),$("div",tt,[$("p",at,[n(N,{icon:i(xe),class:"relative top-0.5"},null,8,["icon"]),Q(" "+H(R(w,p))+" / "+H((O=p==null?void 0:p.subtasks)==null?void 0:O.length),1)]),$("p",st,H(i(ye)(p.groupId).label),1)])]}),_:2},1032,["class"]),$("span",{class:"v-dot ml-2.5",style:te({"background-color":i(fe)(p.color).tag})},null,4),(f(),P(De(i(le)(p.priority).icon),{height:"36px",width:"36px",color:i(le)(p.priority).color},null,8,["color"]))],8,Qe)]}),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modules"]),n(i(ke),{slot:"fixed",vertical:"bottom",horizontal:"end"},{default:r(()=>[n(i(Ce),{onClick:G},{default:r(()=>[n(N,{icon:i(Me),size:"large"},null,8,["icon"])]),_:1})]),_:1})]),_:1}),$("div",{class:"w-full h-[10%]",onClick:t[0]||(t[0]=w=>_.value.$el.dismiss())}),n(Be,{id:"pop-modal","aria-hidden":"false",ref_key:"scheduleModal",ref:y,"is-open":k.value,modal:y.value,schedule:u.value,save:d.value,onWillDismiss:C},null,8,["is-open","modal","schedule","save"])]),_:1},512)}}}),nt=pe(ot,[["__scopeId","data-v-ccbe50c9"]]),lt={key:0},rt={key:1},it={class:"bg-gray-200 text-left text-sm/4 block"},ct=ue({__name:"TabCalendarPage",setup(E){const o=["日","一","二","三","四","五","六"],s=b({isOpen:!1,duration:3e3,text:""}),c=b([{},{},{}]),S=b(new Ae),g=b(),m=b(),a=b(Y().startOf("day")),_=b(!1),y=b({}),u=Oe("eventBus"),d=async()=>{const e=await ze.create({message:"Loading..."});e.present(),Pe(1).then(t=>{S.value=V.parseUserData(t),M(),setTimeout(()=>{var l;(l=g==null?void 0:g.value)==null||l.update()},100)}).catch(t=>{console.log("getSave",t),s.value.isOpen=!0,s.value.text=JSON.stringify(t)}).finally(()=>{e.dismiss()})};$e(async()=>{d(),Ie(()=>{d()}),u.$on("menuClose",e=>{y.value=e})});function k(e){const[t,l,v]=[y.value.group,y.value.color,y.value.priority];return!(t&&t.get(e.groupId)===!1||l&&l.get(e.color)===!1||v&&v.get(e.priority)===!1)}const M=()=>{c.value=[V.createMonthData(a.value.subtract(1,"months"),S.value),V.createMonthData(a.value,S.value),V.createMonthData(a.value.add(1,"months"),S.value)]},q=e=>{M(),e.slideTo(1,0,!1),e.update(),m.value&&m.value.dt.month()!==a.value.month()&&(m.value=void 0)},X=e=>{a.value=a.value.add(1,"months").startOf("month"),q(e)},R=e=>{a.value=a.value.subtract(1,"months").startOf("month"),q(e)},U=e=>{g.value=e,e.slideTo(1,0,!1)},j=(e,t)=>{m.value=t,_.value=!0};function C(){_.value=!1}function B(){a.value=Y().startOf("day"),M()}function J(){const e=Y().startOf("day");return e.month()===a.value.month()&&e.year()===a.value.year()}function G(){M(),q(g.value)}return(e,t)=>{const l=x("ion-buttons"),v=x("ion-title"),h=x("ion-button"),T=x("ion-toolbar"),N=x("ion-header"),A=x("ion-chip"),W=x("ion-content"),K=x("ion-toast"),w=x("ion-page");return f(),P(w,{id:"main-content",main:""},{default:r(()=>{var z;return[n(N,null,{default:r(()=>[n(T,null,{default:r(()=>[n(l,{slot:"start"},{default:r(()=>[n(i(He))]),_:1}),n(v,{class:"ion-text-center"},{default:r(()=>[a.value?(f(),I("div",lt,H(a.value.format("YY年MM月")),1)):(f(),I("div",rt,"日历"))]),_:1}),n(l,{slot:"end"},{default:r(()=>[J()?Ee("",!0):(f(),P(h,{key:0,style:{position:"absolute",right:"50px"},onClick:B},{default:r(()=>t[1]||(t[1]=[Q(" 今 ")])),_:1}))]),_:1})]),_:1})]),_:1}),n(i(re),{style:{"background-color":"antiquewhite",color:"blue"}},{default:r(()=>[(f(),I(L,null,F(o,p=>n(i(ie),{class:"ion-text-center flex-1",key:p},{default:r(()=>[Q(H(p),1)]),_:2},1024)),64))]),_:1}),n(W,null,{default:r(()=>[n(i(ve),{onSlideNextTransitionEnd:X,onSlidePrevTransitionEnd:R,onSwiper:U,"centered-slides":!0,autoHeight:!0,modules:[i(he),i(me)]},{default:r(()=>[(f(!0),I(L,null,F(c.value,(p,ee)=>(f(),P(i(_e),{key:ee},{default:r(()=>[n(i(Ve),{class:"w-full"},{default:r(()=>[(f(!0),I(L,null,F(p.weekArr,Z=>(f(),P(i(re),{key:Z,class:"flex-nowrap"},{default:r(()=>[(f(!0),I(L,null,F(Z,D=>(f(),P(i(ie),{class:"p-0 min-h-32 border-[1px] border-gray-100 border-solid w-[14.28%]",onClick:O=>j(p,D),key:D},{default:r(()=>[$("span",it,[n(A,{class:ae([{transparent:D.dt.unix()!==i(Y)().startOf("day").unix(),today:D.dt.unix()===i(Y)().startOf("day").unix(),gray:D.dt.month()!==p.month},"py-[1px] px-1 min-h-0"])},{default:r(()=>[Q(H(D.dt.date()),1)]),_:2},1032,["class"])]),(f(!0),I(L,null,F(D.events.filter(k),(O,ge)=>{var oe,ne;return f(),I("div",{key:ge,class:ae([{"text-line-through":D.save&&((oe=D.save[O.id])==null?void 0:oe.state)===1,gray:D.save&&((ne=D.save[O.id])==null?void 0:ne.state)===1},"text-left truncate mt-[1px] rounded-sm py-[1px] px-1"]),style:te({"background-color":i(fe)(O.color).tag,"font-size":"clamp(9px, 2.8vw, 16px)"})},H(O.title),7)}),128))]),_:2},1032,["onClick"]))),128))]),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modules"])]),_:1}),n(K,{"is-open":s.value.isOpen,message:s.value.text,duration:s.value.duration,onDidDismiss:t[0]||(t[0]=()=>s.value.isOpen=!1)},null,8,["is-open","message","duration"]),n(nt,{ref:"scheduleModal","is-open":_.value,dt:(z=m.value)==null?void 0:z.dt,userData:S.value,"onUpdate:data":G,onWillDismiss:C},null,8,["is-open","dt","userData"])]}),_:1})}}}),vt=pe(ct,[["__scopeId","data-v-d1bd742b"]]);export{vt as default};
