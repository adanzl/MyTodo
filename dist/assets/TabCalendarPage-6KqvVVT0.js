import{g as Q,c as ue,d as fe,S as pe,a as ne,I as le,K as ie,b as re}from"./swiper-vue-ClC_cqZI.js";import{U as F,I as ee,b as he,g as ve,a as te,S as me,_ as ce,c as _e}from"./UserData-CEifgoE-.js";import{d as de,i as X,C as y,w as ge,c as V,a as c,f as C,o as g,b as d,j as Y,t as N,u as n,h as K,k as we,e as q,r as H,F as B,R as Se,q as be,n as L,N as De,S as ye,Q as ke,D as xe,E as Ce,I as ae,g as se,l as Me}from"./index-DxqavktZ.js";import"./ImgMgr-GqnYifhv.js";function Te(U){const{effect:l,swiper:t,on:i,setTranslate:S,setTransition:b,overwriteParams:m,perspective:s,recreateShadows:w,getEffectParams:k}=U;i("beforeInit",()=>{if(t.params.effect!==l)return;t.classNames.push("".concat(t.params.containerModifierClass).concat(l)),s&&s()&&t.classNames.push("".concat(t.params.containerModifierClass,"3d"));const f=m?m():{};Object.assign(t.params,f),Object.assign(t.originalParams,f)}),i("setTranslate",()=>{t.params.effect===l&&S()}),i("setTransition",(f,M)=>{t.params.effect===l&&b(M)}),i("transitionEnd",()=>{if(t.params.effect===l&&w){if(!k||!k().slideShadows)return;t.slides.forEach(f=>{f.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(M=>M.remove())}),w()}});let u;i("virtualUpdate",()=>{t.params.effect===l&&(t.slides.length||(u=!0),requestAnimationFrame(()=>{u&&t.slides&&t.slides.length&&(S(),u=!1)}))})}function Oe(U,l){const t=Q(l);return t!==l&&(t.style.backfaceVisibility="hidden",t.style["-webkit-backface-visibility"]="hidden"),t}function oe(U,l,t){const i="swiper-slide-shadow".concat(t?"-".concat(t):"").concat(" swiper-slide-shadow-".concat(U)),S=Q(l);let b=S.querySelector(".".concat(i.split(" ").join(".")));return b||(b=ue("div",i.split(" ")),S.append(b)),b}function Ee(U){let{swiper:l,extendParams:t,on:i}=U;t({coverflowEffect:{rotate:50,stretch:0,depth:100,scale:1,modifier:1,slideShadows:!0}}),Te({effect:"coverflow",swiper:l,on:i,setTranslate:()=>{const{width:m,height:s,slides:w,slidesSizesGrid:k}=l,u=l.params.coverflowEffect,f=l.isHorizontal(),M=l.translate,z=f?-M+m/2:-M+s/2,R=f?u.rotate:-u.rotate,j=u.depth,G=fe(l);for(let r=0,O=w.length;r<O;r+=1){const x=w[r],A=k[r],J=x.swiperSlideOffset,a=(z-J-A/2)/A,e=typeof u.modifier=="function"?u.modifier(a):a*u.modifier;let p=f?R*e:0,_=f?0:R*e,D=-j*Math.abs(e),h=u.stretch;typeof h=="string"&&h.indexOf("%")!==-1&&(h=parseFloat(u.stretch)/100*A);let E=f?0:h*e,I=f?h*e:0,o=1-(1-u.scale)*Math.abs(e);Math.abs(I)<.001&&(I=0),Math.abs(E)<.001&&(E=0),Math.abs(D)<.001&&(D=0),Math.abs(p)<.001&&(p=0),Math.abs(_)<.001&&(_=0),Math.abs(o)<.001&&(o=0);const $="translate3d(".concat(I,"px,").concat(E,"px,").concat(D,"px)  rotateX(").concat(G(_),"deg) rotateY(").concat(G(p),"deg) scale(").concat(o,")"),v=Oe(u,x);if(v.style.transform=$,x.style.zIndex=-Math.abs(Math.round(e))+1,u.slideShadows){let T=f?x.querySelector(".swiper-slide-shadow-left"):x.querySelector(".swiper-slide-shadow-top"),P=f?x.querySelector(".swiper-slide-shadow-right"):x.querySelector(".swiper-slide-shadow-bottom");T||(T=oe("coverflow",x,f?"left":"top")),P||(P=oe("coverflow",x,f?"right":"bottom")),T&&(T.style.opacity=e>0?e:0),P&&(P.style.opacity=-e>0?-e:0)}}},setTransition:m=>{l.slides.map(w=>Q(w)).forEach(w=>{w.style.transitionDuration="".concat(m,"ms"),w.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(k=>{k.style.transitionDuration="".concat(m,"ms")})})},perspective:()=>!0,overwriteParams:()=>({watchSlidesProgress:!0})})}const Ie={style:{"font-size":"20px",color:"white"}},$e=["onClick"],Pe={class:"flex"},qe={class:"schedule-lb-sub"},Ne={class:"schedule-lb-group"},Ue=de({__name:"CalendarCover",props:{dt:{type:Object,default:X()},userData:{type:Object,required:!0}},emits:["update:data"],setup(U,{emit:l}){const t=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],i=U,S=l,b=y([{},{},{}]),m=y(),s=y(X(i.dt)),w=y(),k=y(),u=y(),f=y(),M=y(!1);ge(()=>i.dt,a=>{s.value=a,z()},{deep:!0});const z=()=>{b.value=[F.createDayData(s.value.subtract(1,"day"),i.userData),F.createDayData(s.value,i.userData),F.createDayData(s.value.add(1,"day"),i.userData)]};function R(a){if(a.activeIndex===1)return;const e=a.activeIndex,p=a.previousIndex;e<p?(s.value=s.value.subtract(1,"day"),z(),a.slideTo(1,0,!1)):e>p&&(s.value=s.value.add(1,"day"),z(),a.slideTo(1,0,!1))}const j=a=>{m.value=a,a.slideTo(1,0,!1)},G=(a,e)=>{var p;try{return(p=e==null?void 0:e.subtasks)==null?void 0:p.filter(_=>{var D,h;return(((D=a.save[e.id])==null?void 0:D.subtasks)&&((h=a.save[e.id])==null?void 0:h.subtasks[_.id])||0)===1}).length}catch(_){return console.log("countFinishedSubtask",_),0}},r=(a,e,p)=>{if(e){const _=e.save[p]||new me;_.state=a.detail.checked?1:0,e.save[p]=_,ke(()=>{e.events.sort((D,h)=>{var o,$,v,T;const E=((o=e.save[D.id])==null?void 0:o.state)||0,I=(($=e.save[h.id])==null?void 0:$.state)||0;return E===I?((v=D.id)!=null?v:0)-((T=h.id)!=null?T:0):E-I})}),A(),S("update:data",s.value)}},O=(a,e,p)=>{M.value=!0,u.value=e,f.value=p.save[e.id]},x=a=>{if(M.value=!1,a.detail.role==="backdrop")return;const[e,p]=a.detail.data,_=s.value;F.updateSchedularData(i.userData,e,p,_,a.detail.role)&&(z(),A(),S("update:data",s.value))};function A(){Se(i.userData.id,i.userData.name,JSON.stringify(i.userData)).then(a=>{console.log("doSaveUserData",a)}).catch(a=>{console.log("doSaveUserData",a)})}function J(){var a;s.value=X(),z(),(a=m==null?void 0:m.value)==null||a.slideTo(1,0,!1)}return(a,e)=>{const p=C("ion-button"),_=C("ion-item"),D=C("ion-icon"),h=C("ion-label"),E=C("ion-content"),I=C("ion-modal");return g(),V(I,{mode:"ios","aria-hidden":"false",ref_key:"selfRef",ref:w},{default:c(()=>[d(E,{class:"main_content"},{default:c(()=>[d(_,{class:"transparent"},{default:c(()=>[Y("h2",Ie,N(s.value.format("YYYY-MM-DD")+" "+t[s.value.day()]),1),s.value.isToday()?we("",!0):(g(),V(p,{key:0,slot:"end",color:"danger",onClick:J},{default:c(()=>[d(n(ee),{icon:"mdi:calendar-today-outline",height:"16"}),e[1]||(e[1]=K(" 今天 "))]),_:1}))]),_:1}),d(n(ne),{onTransitionEnd:R,onSwiper:j,"centered-slides":!0,modules:[n(le),n(ie),n(Ee)],effect:"coverflow",slidesPerView:"auto",freeMode:!1,coverflowEffect:{rotate:10,stretch:0,depth:100,modifier:1,slideShadows:!1},keyboard:!0,style:{height:"90%"}},{default:c(()=>[(g(!0),q(B,null,H(b.value,(o,$)=>(g(),V(n(re),{key:$,class:"data-content"},{default:c(()=>[d(E,null,{default:c(()=>[d(_,null,{default:c(()=>[K("日程 "+N(o==null?void 0:o.dt.format("MM-DD")),1)]),_:2},1024),(g(!0),q(B,null,H(o.events,(v,T)=>(g(),V(_,{key:T},{default:c(()=>{var P,Z;return[d(n(be),{style:{"--size":"26px","padding-right":"5px"},slot:"start",checked:((P=o.save[v.id])==null?void 0:P.state)===1,onIonChange:W=>r(W,o,v.id)},null,8,["checked","onIonChange"]),Y("div",{onClick:W=>O(W,v,o),class:"scheduleItem"},[d(h,{class:L({"text-line-through":((Z=o.save[v.id])==null?void 0:Z.state)===1})},{default:c(()=>{var W;return[Y("h2",null,N(v.title),1),Y("div",Pe,[Y("p",qe,[d(D,{icon:n(De),style:{position:"relative",top:"3px"}},null,8,["icon"]),K(" "+N(G(o,v))+" / "+N((W=v==null?void 0:v.subtasks)==null?void 0:W.length),1)]),Y("p",Ne,N(n(he)(v.groupId).label),1)])]}),_:2},1032,["class"]),Y("span",{class:"v-dot",style:ye({"background-color":n(ve)(v.color).tag,"margin-left":"10px"})},null,4),d(n(ee),{icon:n(te)(v.priority).icon,height:"36",color:n(te)(v.priority).color},null,8,["icon","color"])],8,$e)]}),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modules"])]),_:1}),Y("div",{style:{width:"100%",height:"20%"},onClick:e[0]||(e[0]=o=>w.value.$el.dismiss())}),d(pe,{id:"pop-modal",ref_key:"scheduleModal",ref:k,"is-open":M.value,modal:k.value,schedule:u.value,save:f.value,onWillDismiss:x},null,8,["is-open","modal","schedule","save"])]),_:1},512)}}}),ze=ce(Ue,[["__scopeId","data-v-d952788b"]]),Ye={key:0},Ae={key:1},Fe=de({__name:"TabCalendarPage",setup(U){const l=["日","一","二","三","四","五","六"],t=y({isOpen:!1,duration:3e3,text:""}),i=y([{},{},{}]),S=y(new _e),b=y(),m=y(),s=y(X().startOf("day")),w=y(!1);xe(()=>{Ce(1).then(r=>{S.value=F.parseUserData(r),console.log("getSave",S.value),k(),setTimeout(()=>{var O;(O=b==null?void 0:b.value)==null||O.update()},100)}).catch(r=>{console.log("getSave",r),t.value.isOpen=!0,t.value.text=JSON.stringify(r)})});const k=()=>{i.value=[F.createMonthData(s.value.subtract(1,"months"),S.value),F.createMonthData(s.value,S.value),F.createMonthData(s.value.add(1,"months"),S.value)]},u=r=>{k(),r.slideTo(1,0,!1),r.update(),m.value&&m.value.dt.month()!==s.value.month()&&(m.value=void 0)},f=r=>{s.value=s.value.add(1,"months").startOf("month"),u(r)},M=r=>{s.value=s.value.subtract(1,"months").startOf("month"),u(r)},z=r=>{b.value=r,r.slideTo(1,0,!1)},R=(r,O)=>{m.value=O,w.value=!0};function j(){w.value=!1}function G(){k()}return(r,O)=>{const x=C("ion-title"),A=C("ion-toolbar"),J=C("ion-header"),a=C("ion-chip"),e=C("ion-content"),p=C("ion-toast"),_=C("ion-page");return g(),V(_,null,{default:c(()=>{var D;return[d(J,null,{default:c(()=>[d(A,null,{default:c(()=>[d(x,null,{default:c(()=>[s.value?(g(),q("h3",Ye,N(s.value.format("YY年MM月")),1)):(g(),q("h3",Ae,"日历"))]),_:1})]),_:1})]),_:1}),d(n(ae),{style:{"background-color":"antiquewhite",color:"blue"}},{default:c(()=>[(g(),q(B,null,H(l,h=>d(n(se),{class:"ion-text-center",key:h},{default:c(()=>[K(N(h),1)]),_:2},1024)),64))]),_:1}),d(e,null,{default:c(()=>[d(n(ne),{onSlideNextTransitionEnd:f,onSlidePrevTransitionEnd:M,onSwiper:z,"centered-slides":!0,autoHeight:!0,modules:[n(le),n(ie)]},{default:c(()=>[(g(!0),q(B,null,H(i.value,(h,E)=>(g(),V(n(re),{key:E},{default:c(()=>[d(n(Me),{style:{height:"auto"},fixed:""},{default:c(()=>[(g(!0),q(B,null,H(h.weekArr,I=>(g(),V(n(ae),{key:I},{default:c(()=>[(g(!0),q(B,null,H(I,o=>(g(),V(n(se),{class:"day-item",onClick:$=>R(h,o),key:o},{default:c(()=>[Y("span",null,[d(a,{class:L({transparent:o.dt.unix()!==n(X)().startOf("day").unix(),today:o.dt.unix()===n(X)().startOf("day").unix(),gray:o.dt.month()!==h.month})},{default:c(()=>[K(N(o.dt.date()),1)]),_:2},1032,["class"])]),(g(!0),q(B,null,H(o.events,($,v)=>{var T,P;return g(),q("div",{key:v,class:L({"text-line-through":((T=o.save[$.id])==null?void 0:T.state)===1,gray:((P=o.save[$.id])==null?void 0:P.state)===1})},N($.title),3)}),128))]),_:2},1032,["onClick"]))),128))]),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modules"])]),_:1}),d(p,{"is-open":t.value.isOpen,message:t.value.text,duration:t.value.duration,onDidDismiss:O[0]||(O[0]=()=>t.value.isOpen=!1)},null,8,["is-open","message","duration"]),d(ze,{ref:"scheduleModal","is-open":w.value,dt:(D=m.value)==null?void 0:D.dt,userData:S.value,"onUpdate:data":G,onWillDismiss:j},null,8,["is-open","dt","userData"])]}),_:1})}}}),Ge=ce(Fe,[["__scopeId","data-v-7ce697fa"]]);export{Ge as default};
