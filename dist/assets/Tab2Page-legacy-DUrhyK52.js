System.register(["./index-legacy-CzYkv4eQ.js"],(function(e,t){"use strict";var a,l,n,o,i,d,c,u,s,r,v,g,f,h,w,m,_,p,y,b,k,C,R,x,L,I;return{setters:[e=>{a=e.d,l=e.r,n=e.p,o=e.aj,i=e.o,d=e.c,c=e.a,u=e.b,s=e.u,r=e.i,v=e.j,g=e.e,f=e.f,h=e.F,w=e.ak,m=e.g,_=e.al,p=e.a6,y=e.t,b=e.a5,k=e.a4,C=e.am,R=e.ah,x=e.an,L=e.ao,I=e.ap}],execute:function(){const t=["width","height"],F=["src"];e("default",a({__name:"Tab2Page",setup(e){const a=l(),A=l(400),D=l(300),E=l([]),H=(e,t,a)=>{const l=e.width/e.height;let n,o;return l>t/a?(n=t,o=t/l):(o=a,n=a*l),{dx:(t-n)/2,dy:(a-o)/2,drawWidth:n,drawHeight:o}},P=()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.addEventListener("change",(async e=>{var t;const l=null===(t=e.target)||void 0===t?void 0:t.files[0];if(!l)return;const n=new FileReader;n.onload=e=>{const t=e.target.result,l=new Image;l.src=t,l.onload=()=>{if(a.value){const e=a.value.getContext("2d");if(e){const{dx:t,dy:n,drawWidth:i,drawHeight:d}=H(l,A.value,D.value);e.clearRect(0,0,A.value,D.value),e.drawImage(l,t,n,i,d),a.value.toBlob((e=>{const t=new FileReader;t.onload=()=>{const e=t.result;w(void 0,e).then((e=>{console.log("setPic",e),o().then((e=>{E.value=e}))}))},t.readAsDataURL(e)}),"image/webp")}}}},n.readAsDataURL(l)})),e.click()};return n((()=>{o().then((e=>{E.value=e,console.log("picList",E.value)}))})),(e,l)=>{const n=m("ion-title"),U=m("ion-header"),W=m("ion-button"),j=m("ion-buttons"),T=m("ion-label"),B=m("ion-item"),z=m("ion-icon"),K=m("ion-list"),O=m("ion-content");return i(),d(s(x),null,{default:c((()=>[u(U,null,{default:c((()=>[u(s(_),null,{default:c((()=>[u(n,null,{default:c((()=>l[0]||(l[0]=[r("Tab 2")]))),_:1})])),_:1})])),_:1}),u(O,{fullscreen:!0},{default:c((()=>[u(U,{collapse:"condense"},{default:c((()=>[u(s(_),null,{default:c((()=>[u(n,{size:"large"},{default:c((()=>l[1]||(l[1]=[r("Tab 2")]))),_:1}),u(j,{slot:"end"},{default:c((()=>[u(W,{onClick:P},{default:c((()=>l[2]||(l[2]=[r("选择图片")]))),_:1})])),_:1})])),_:1})])),_:1}),v("canvas",{ref_key:"canvasRef",ref:a,width:A.value,height:D.value},null,8,t),u(K,null,{default:c((()=>[(i(!0),g(h,null,f(E.value,((e,t)=>(i(),d(s(p),{key:t},{default:c((()=>[u(B,{onClick:t=>((e,t)=>{const l=new Image;l.src=t.data,l.onload=()=>{if(a.value){const e=a.value.getContext("2d");if(e){const{dx:t,dy:a,drawWidth:n,drawHeight:o}=H(l,A.value,D.value);e.clearRect(0,0,A.value,D.value),e.drawImage(l,t,a,n,o)}}}})(0,e)},{default:c((()=>[u(T,null,{default:c((()=>[r(y(e.id),1)])),_:2},1024),v("img",{src:e.data,style:{height:"60px"}},null,8,F)])),_:2},1032,["onClick"]),u(s(b),{side:"end"},{default:c((()=>[u(s(k),{onClick:t=>((e,t)=>{const l=document.createElement("input");l.type="file",l.accept="image/*",l.addEventListener("change",(async e=>{var l;const n=null===(l=e.target)||void 0===l?void 0:l.files[0];if(!n)return;const i=new FileReader;i.onload=e=>{const l=e.target.result,n=new Image;n.src=l,n.onload=()=>{if(a.value){const e=a.value.getContext("2d");if(e){const{dx:l,dy:i,drawWidth:d,drawHeight:c}=H(n,A.value,D.value);e.clearRect(0,0,A.value,D.value),e.drawImage(n,l,i,d,c),a.value.toBlob((e=>{const a=new FileReader;a.onload=()=>{const e=a.result;w(t.id,e).then((e=>{console.log("setPic",e),o().then((e=>{E.value=e}))}))},a.readAsDataURL(e)}),"image/webp")}}}},i.readAsDataURL(n)})),l.click()})(0,e)},{default:c((()=>[u(z,{icon:s(C)},null,8,["icon"])])),_:2},1032,["onClick"]),u(s(k),{color:"danger",onClick:t=>(async(e,t)=>{const a=await L.create({header:"Confirm",message:"确认删除这张图片么 ["+t.id+"]",buttons:[{text:"OK",handler:()=>{console.log("btnRemoveClk",t.id),I(t.id).then((e=>{console.log("delPic",e),o().then((e=>{E.value=e}))}))}},"Cancel"]});await a.present()})(0,e)},{default:c((()=>[u(z,{icon:s(R)},null,8,["icon"])])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})}}}))}}}));
